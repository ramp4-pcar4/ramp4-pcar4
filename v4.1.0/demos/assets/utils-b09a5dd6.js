import{r as b,aH as D,e1 as A,bj as x,f as C}from"./main-e6c796d9.js";import{h as y,E as O,S as T}from"./color-efbded4a.js";import{U as H}from"./MaterialKey-596a8b14.js";import{Q as F,W as N}from"./definitions-19bfb61c.js";import{C as t}from"./enums-64ab819c.js";class d{static getStorageSpec(e){return null}static createOrUpdateRendererSchema(e,a){return b(e)&&e.type==="default"?e:{type:"default"}}static getVariation(e){return{}}static getVariationHash(e){return 0}}d.type="default",d.programSpec=null;let g=class extends d{static getStorageSpec({attributes:e}){return{visualVariables:!1,attributes:e??null}}static _createRendererSchema(){return{type:"dot-density",colors:new Float32Array(32),dotValue:-1,dotSize:-1,dotScale:-1,dotBlending:!1,backgroundColor:new Float32Array(4),activeDots:new Float32Array(8),seed:-1}}static createOrUpdateRendererSchema(e,a){const{attributes:l,dotValue:u,referenceScale:h,dotSize:p,dotBlendingEnabled:m,seed:r,backgroundColor:c}=a,i=b(e)&&e.type==="dot-density"?e:this._createRendererSchema();i.dotValue=u,i.dotSize=p,i.dotScale=h,i.dotBlending=m,i.seed=r;const{colors:E,activeDots:S,backgroundColor:n}=i;for(let o=0;o<F;o++){const R=o>=l.length?null:l[o].color;y(E,R,4*o)}for(let o=0;o<8;o++)S[o]=o<a.attributes.length?1:0;return y(n,c),i}static getVariation(e){return{ddDotBlending:e.dotBlending}}static getVariationHash(e){return e.dotBlending?1:0}};g.type="dot-density",g.programSpec={shader:"materials/fill",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:t.SHORT},{location:1,name:"a_id",count:3,type:t.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:t.UNSIGNED_BYTE},{location:3,name:"a_inverseArea",count:1,type:t.FLOAT}]}};class f extends d{static getStorageSpec({field:e,valueExpression:a}){return{visualVariables:!1,attributes:e||a?[{field:e,valueExpression:a}]:null}}static _createRendererSchema(){return{type:"heatmap",radius:-1,referenceScale:-1,isFieldActive:0,minDensity:-1,densityRange:-1,kernel:null,gradient:null,gradientHash:"invalid"}}static createOrUpdateRendererSchema(e,a){const{radius:l,minDensity:u,maxDensity:h,referenceScale:p,field:m,valueExpression:r,colorStops:c}=a,i=h-u,E=m||r?1:0,S=c.map(({color:R,ratio:v})=>`${v}:${R.toString()}`).join();let n,o=!0;return b(e)&&e.type==="heatmap"?(n=e,o=S!==e.gradientHash):n=this._createRendererSchema(),n.radius=D(l),n.minDensity=u,n.densityRange=i,n.referenceScale=p,n.isFieldActive=E,o&&(n.gradient=A(c),n.gradientHash=S),n}}f.type="heatmap",f.programSpec={shader:"materials/icon/heatmapAccumulate",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:t.SHORT},{location:1,name:"a_vertexOffset",count:2,type:t.SHORT},{location:4,name:"a_id",count:4,type:t.UNSIGNED_BYTE}]}};class _ extends d{static getStorageSpec({attributes:e}){return{visualVariables:!0,attributes:e??null}}static _createRendererSchema(){return{type:"pie-chart",colors:new Float32Array(4*N),defaultColor:new Float32Array(4),othersColor:new Float32Array(4),outlineColor:new Float32Array(4),holePercentage:0,sectorThreshold:0,outlineWidth:1,numberOfFields:10}}static createOrUpdateRendererSchema(e,a){const{attributes:l,defaultColor:u,holePercentage:h,othersCategory:p,outline:m}=a,r=b(e)&&e.type==="pie-chart"?e:this._createRendererSchema();for(let c=0;c<N;c++){const i=c>=l.length?new x([0,0,0,0]):l[c].color;y(r.colors,i,4*c)}return y(r.defaultColor,u),y(r.othersColor,p?.color),y(r.outlineColor,m?.color),r.outlineWidth=D(m?.width||0),r.holePercentage=h,r.sectorThreshold=p?.threshold||0,r.numberOfFields=l.length,r}static getVariation(e){return{numberOfFields:e.numberOfFields}}static getVariationHash(e){return e.numberOfFields}}_.type="pie-chart",_.programSpec={shader:"materials/pie",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:t.SHORT},{location:1,name:"a_vertexOffset",count:2,type:t.SHORT},{location:2,name:"a_texCoords",count:2,type:t.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:t.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:t.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:t.UNSIGNED_BYTE,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:t.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:t.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:t.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};function G(s,e){if(s.type!==e)throw new C("material-view-model:unexpected-renderer-schema",`expected to find renderer schema of type "${e}" but found type "${s.type}"`)}function Y(s){switch(s?.type){case"dot-density":return g;case"heatmap":return f;case"pie-chart":return _;default:return d}}function z(s){const{geometryType:e,symbologyType:a}=H.load(s);switch(e){case O.FILL:if(a===T.DOT_DENSITY)return g;break;case O.MARKER:switch(a){case T.HEATMAP:return f;case T.PIE_CHART:return _}}return d}export{Y as c,d as e,z as p,G as s};
