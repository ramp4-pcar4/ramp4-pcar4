import{E as d,t as T,x as g,j as m}from"./main-e6c796d9.js";import{a as L}from"./lazyLayerLoader-ee560691.js";import{selectLayerClassPath as G}from"./portalLayers-10c454ba.js";import"./preload-helper-388ac9d5.js";import"./layersLoader-7214db72.js";import"./fetchService-ef4ecfd2.js";import"./jsonContext-756dc443.js";function f(e){return S(e,"notes")}function M(e){return S(e,"markup")}function A(e){return S(e,"route")}function S(e,r){return!(!e.layerType||e.layerType!=="ArcGISFeatureLayer")&&e.featureCollectionType===r}async function v(e,r,t){if(!r)return;const a=[];for(const y of r){const i=V(y,t);y.layerType==="GroupLayer"?a.push(U(i,y,t)):a.push(i)}const n=await d(a);for(const y of n)y.value&&e.add(y.value)}const w={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},b={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},W={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",ArcGISSceneServiceLayer:"SceneLayer",DefaultTileLayer:"TileLayer"},F={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",MediaLayer:"MediaLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},C={ArcGISFeatureLayer:"FeatureLayer"},O={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};async function V(e,r){return B(await h(e,r),e,r)}async function B(e,r,t){const a=new e;return a.read(r,t.context),a.type==="group"&&u(r)&&await x(a,r,t.context),await T(a,t.context),a}async function h(e,r){const t=r.context,a=D(t);let n=e.layerType||e.type;!n&&r&&r.defaultLayerType&&(n=r.defaultLayerType);const y=a[n];let i=y?L[y]:L.UnknownLayer;if(I(e)){const s=t?.portal;if(e.itemId){const o=new g({id:e.itemId,portal:s});await o.load();const c=(await G(o)).className||"UnknownLayer";i=L[c]}}else n==="ArcGISFeatureLayer"?f(e)||M(e)?i=L.MapNotesLayer:A(e)?i=L.RouteLayer:u(e)&&(i=L.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?i=L.WMTSLayer:n==="WFS"&&e.wfsInfo?.version!=="2.0.0"&&(i=L.UnsupportedLayer);return i()}function u(e){return e.layerType!=="ArcGISFeatureLayer"||I(e)?!1:(e.featureCollection?.layers?.length??0)>1}function I(e){return e.type==="Feature Collection"}function D(e){let r;if(e.origin==="web-scene")switch(e.layerContainerType){case"basemap":r=W;break;case"ground":r=b;break;default:r=w}else switch(e.layerContainerType){case"basemap":r=O;break;case"tables":r=C;break;default:r=F}return r}async function U(e,r,t){const a=new m,n=v(a,Array.isArray(r.layers)?r.layers:[],t),y=await e;if(await n,y.type==="group")return y.layers.addMany(a),y}async function x(e,r,t){const a=L.FeatureLayer,n=await a(),y=r.featureCollection,i=y?.showLegend,s=y?.layers?.map((o,c)=>{const l=new n;l.read(o,t);const p={...t,ignoreDefaults:!0};return l.read({id:`${e.id}-sublayer-${c}`,visibility:r.visibleLayers?.includes(c)??!0},p),i!=null&&l.read({showLegend:i},p),l});e.layers.addMany(s??[])}export{v as populateOperationalLayers};
