{"version":3,"file":"MemCache-qDGoejB7.js","sources":["../../node_modules/@arcgis/core/core/MemCache.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nconst t=-3,i=t-1;var s;!function(t){t[t.ALL=0]=\"ALL\",t[t.SOME=1]=\"SOME\"}(s||(s={}));class e{constructor(t,i,s,e=0){this.name=t,this._storage=i,this.removeFunc=s,this._defaultPriority=e,this.id=`${r++}${_}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(t){return this._storage.getSize(this,t)}set maxSize(t){this._storage.setMaxSize(this,t)}resetHitRate(){this._hit=this._miss=0}put(t,i,s=this._defaultPriority){this._storage.put(this,t,i,i.cachedMemory,s)}pop(t){const i=this._storage.pop(this,t);return void 0===i?++this._miss:++this._hit,i}get(t){const i=this._storage.get(this,t);return void 0===i?++this._miss:++this._hit,i}peek(t){return this._storage.peek(this,t)}updateSize(t,i){this._storage.updateSize(this,t,i,i.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class h{get size(){return this._size}constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear()}register(t){this._users.set(t.id.slice(0,-1),t)}deregister(t){this.clear(t),this._sizeLimits.delete(t),this._users.delete(t.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,-1),this._checkSize()}getSize(t,i){const s=this._db.get(t.id+i);return s?.size??0}put(e,h,r,_,n){h=e.id+h;const a=this._db.get(h);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(h),a.entry!==r&&this._notifyRemove(h,a.entry,a.size,s.ALL)),_>this._maxSize)return void this._notifyRemove(h,r,_,s.ALL);if(void 0===r)return void console.warn(\"Refusing to cache undefined entry \");if(!_||_<0)return console.warn(`Refusing to cache entry with size ${_} for key ${h}`),void this._notifyRemove(h,r,0,s.ALL);const c=1+Math.max(n,i)-t;this._db.set(h,new o(r,_,c)),this._size+=_,e.size+=_,this._checkSize()}updateSize(t,i,e,h){i=t.id+i;const r=this._db.get(i);if(r&&r.entry===e){for(this._size-=r.size,t.size-=r.size;h>this._maxSize;){const t=this._notifyRemove(i,e,h,s.SOME);if(!(null!=t&&t>0))return void this._db.delete(i);h=t}r.size=h,this._size+=h,t.size+=h,this._checkSize()}}pop(t,i){i=t.id+i;const s=this._db.get(i);if(s)return this._size-=s.size,t.size-=s.size,this._db.delete(i),++this._hit,s.entry;++this._miss}get(t,i){i=t.id+i;const s=this._db.get(i);if(void 0!==s)return this._db.delete(i),s.lives=s.lifetime,this._db.set(i,s),++this._hit,s.entry;++this._miss}peek(t,i){const s=this._db.get(t.id+i);return s?++this._hit:++this._miss,s?.entry}get performanceInfo(){const i={Size:Math.round(this._size/1048576)+\"/\"+Math.round(this._maxSize/1048576)+\"MB\",\"Hit rate\":Math.round(100*this._getHitRate())+\"%\",Entries:this._db.size.toString()},s={},e=new Array;this._db.forEach(((t,i)=>{const h=t.lifetime;e[h]=(e[h]||0)+t.size,this._users.forEach((e=>{const{id:h,name:r}=e;if(i.startsWith(h)){const i=s[r]||0;s[r]=i+t.size}}))}));const h={};this._users.forEach((t=>{const i=t.name;if(\"hitRate\"in t&&\"number\"==typeof t.hitRate&&!isNaN(t.hitRate)&&t.hitRate>0){const e=s[i]||0;s[i]=e,h[i]=Math.round(100*t.hitRate)+\"%\"}else h[i]=\"0%\"}));const r=Object.keys(s);r.sort(((t,i)=>s[i]-s[t])),r.forEach((t=>i[t]=Math.round(s[t]/2**20)+\"MB / \"+h[t]));for(let o=e.length-1;o>=0;--o){const s=e[o];s&&(i[\"Priority \"+(o+t-1)]=Math.round(s/this._size*100)+\"%\")}return i}resetStats(){this._hit=this._miss=0,this._users.forEach((t=>t.resetHitRate()))}clear(t){const i=t.id;this._db.forEach(((t,e)=>{e.startsWith(i)&&(this._size-=t.size,this._db.delete(e),this._notifyRemove(e,t.entry,t.size,s.ALL))})),t.size=0}clearAll(){this._db.forEach(((t,i)=>this._notifyRemove(i,t.entry,t.size,s.ALL))),this._users.forEach((t=>t.size=0)),this._size=0,this._db.clear()}*values(t){for(const[i,s]of this._db)i.startsWith(t.id)&&(yield s.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,s,e){const h=this._users.get(t.split(_)[0])?.removeFunc,r=h?.(i,e,s);return\"number\"==typeof r?r:null}_checkSize(){this._sizeLimits.forEach(((t,i)=>this._checkSizeLimits(t,i))),this._checkSizeLimits(this.maxSize)}setMaxSize(t,i){null==i||i<=0?this._sizeLimits.delete(t):this._sizeLimits.set(t,i)}_checkSizeLimits(t,i){const s=i??this;if(s.size<=t)return;const e=i?.id;let h=!0;for(;h;){h=!1;for(const[r,o]of this._db)if(0===o.lifetime&&(!e||r.startsWith(e))){const e=i??this._users.get(r.split(_)[0]);if(this._purgeItem(r,o,e),s.size<=.9*t)return;h||=this._db.has(r)}}for(const[r,o]of this._db)if(!e||r.startsWith(e)){const e=i??this._users.get(r.split(_)[0]);if(this._purgeItem(r,o,e),s.size<=.9*t)return}}_purgeItem(t,i,e){if(this._db.delete(t),i.lives<=1){this._size-=i.size,e&&(e.size-=i.size);const h=this._notifyRemove(t,i.entry,i.size,s.SOME);null!=h&&h>0&&(this._size+=h,e&&(e.size+=h),i.lives=i.lifetime,i.size=h,this._db.set(t,i))}else--i.lives,this._db.set(t,i)}}let r=0;class o{constructor(t,i,s){this.entry=t,this.size=i,this.lifetime=s,this.lives=s}}const _=\":\";export{e as MemCache,h as MemCacheStorage,t as MinPriority,i as NoPriority,s as RemoveMode};\n"],"names":["t","s","h","i","r","_","a","c","o","e"],"mappings":"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","x_google_ignoreList":[0]}