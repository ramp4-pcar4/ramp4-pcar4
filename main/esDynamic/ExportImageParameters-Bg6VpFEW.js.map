{"version":3,"file":"ExportImageParameters-Bg6VpFEW.js","sources":["../../node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import r from\"../../core/Accessor.js\";import{sqlAnd as s}from\"../../core/sql.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{isInScaleRange as a}from\"../../geometry/support/scaleUtils.js\";import{getLayerFloorFilterClause as o}from\"./floorFilterUtils.js\";import{isExportDynamic as l}from\"./sublayerUtils.js\";const n={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let y=class extends r{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(e=>{const r=o(this.floors,e);return e.toExportImageJSON(r)});return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&l(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.removeHandles(\"layer\"),e&&this.addHandles([e.allSublayers.on(\"change\",()=>this.notifyChange(\"visibleSublayers\")),e.on(\"sublayer-update\",e=>this.notifyChange(n[e.propertyName]))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map(e=>e.id).join(\",\"):\"show:-1\":null}get layerDefs(){const e=!!this.floors?.length,r=this.visibleSublayers.filter(r=>null!=r.definitionExpression||e&&null!=r.floorInfo);return r.length?JSON.stringify(r.reduce((e,r)=>{const t=o(this.floors,r),i=s(t,r.definitionExpression);return null!=i&&(e[r.id]=i),e},{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=this.scale,t=r=>{r.visible&&(0===s||a(s,r.minScale,r.maxScale))&&(r.sublayers?r.sublayers.forEach(t):e.unshift(r))};r?.forEach(t);const i=this._get(\"visibleSublayers\");return!i||i.length!==e.length||i.some((r,s)=>e[s]!==r)?e:i}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([t({readOnly:!0})],y.prototype,\"dynamicLayers\",null),e([t()],y.prototype,\"floors\",void 0),e([t({readOnly:!0})],y.prototype,\"hasDynamicLayers\",null),e([t()],y.prototype,\"layer\",null),e([t({readOnly:!0})],y.prototype,\"layers\",null),e([t({readOnly:!0})],y.prototype,\"layerDefs\",null),e([t({type:Number})],y.prototype,\"scale\",void 0),e([t({readOnly:!0})],y.prototype,\"version\",null),e([t({readOnly:!0})],y.prototype,\"visibleSublayers\",null),y=e([i(\"esri.layers.support.ExportImageParameters\")],y);export{y as ExportImageParameters};\n"],"names":["n","y","r","e","o","l","t","i","s","a"],"mappings":";;;;AAIkiB,MAAMA,IAAE,EAAC,SAAQ,oBAAmB,sBAAqB,aAAY,cAAa,oBAAmB,eAAc,oBAAmB,SAAQ,oBAAmB,UAAS,oBAAmB,UAAS,oBAAmB,UAAS,oBAAmB,QAAO,mBAAkB;AAAK,IAACC,IAAE,cAAcC,EAAC;AAAA,EAAC,YAAY,GAAE;AAAC,UAAM,CAAC,GAAE,KAAK,SAAO,MAAK,KAAK,QAAM;AAAA,EAAC;AAAA,EAAC,UAAS;AAAC,SAAK,QAAM;AAAA,EAAI;AAAA,EAAC,IAAI,gBAAe;AAAC,QAAG,CAAC,KAAK,iBAAiB,QAAO;AAAK,UAAM,IAAE,KAAK,iBAAiB,IAAI,CAAAC,MAAG;AAAC,YAAMD,IAAEE,EAAE,KAAK,QAAOD,CAAC;AAAE,aAAOA,EAAE,kBAAkBD,CAAC;AAAA,IAAC,CAAC;AAAE,WAAO,EAAE,SAAO,KAAK,UAAU,CAAC,IAAE;AAAA,EAAI;AAAA,EAAC,IAAI,mBAAkB;AAAC,WAAO,KAAK,SAAOG,EAAE,KAAK,kBAAiB,KAAK,MAAM,kBAAiB,KAAK,MAAM,UAAU;AAAA,EAAC;AAAA,EAAC,IAAI,MAAM,GAAE;AAAC,SAAK,KAAK,OAAO,MAAI,MAAI,KAAK,KAAK,SAAQ,CAAC,GAAE,KAAK,cAAc,OAAO,GAAE,KAAG,KAAK,WAAW,CAAC,EAAE,aAAa,GAAG,UAAS,MAAI,KAAK,aAAa,kBAAkB,CAAC,GAAE,EAAE,GAAG,mBAAkB,CAAAF,MAAG,KAAK,aAAaH,EAAEG,EAAE,YAAY,CAAC,CAAC,CAAC,GAAE,OAAO;AAAA,EAAE;AAAA,EAAC,IAAI,SAAQ;AAAC,UAAM,IAAE,KAAK;AAAiB,WAAO,IAAE,EAAE,SAAO,UAAQ,EAAE,IAAI,CAAAA,MAAGA,EAAE,EAAE,EAAE,KAAK,GAAG,IAAE,YAAU;AAAA,EAAI;AAAA,EAAC,IAAI,YAAW;AAAC,UAAM,IAAE,CAAC,CAAC,KAAK,QAAQ,QAAO,IAAE,KAAK,iBAAiB,OAAO,CAAAD,MAASA,EAAE,wBAAR,QAA8B,KAASA,EAAE,aAAR,IAAiB;AAAE,WAAO,EAAE,SAAO,KAAK,UAAU,EAAE,OAAO,CAACC,GAAED,MAAI;AAAC,YAAMI,IAAEF,EAAE,KAAK,QAAOF,CAAC,GAAEK,IAAEC,EAAEF,GAAEJ,EAAE,oBAAoB;AAAE,aAAaK,KAAN,SAAUJ,EAAED,EAAE,EAAE,IAAEK,IAAGJ;AAAA,IAAC,GAAE,CAAA,CAAE,CAAC,IAAE;AAAA,EAAI;AAAA,EAAC,IAAI,UAAS;AAAC,SAAK,eAAe,QAAQ,GAAE,KAAK,eAAe,WAAW,GAAE,KAAK,eAAe,eAAe;AAAE,UAAM,IAAE,KAAK;AAAM,WAAO,MAAI,EAAE,eAAe,KAAK,GAAE,EAAE,eAAe,aAAa,GAAE,EAAE,eAAe,mBAAmB,GAAE,EAAE,eAAe,YAAY,KAAI,KAAK,KAAK,SAAS,KAAG,KAAG;AAAA,EAAC;AAAA,EAAC,IAAI,mBAAkB;AAAC,UAAM,IAAE,CAAA;AAAG,QAAG,CAAC,KAAK,MAAM,QAAO;AAAE,UAAM,IAAE,KAAK,MAAM,WAAUK,IAAE,KAAK,OAAMF,IAAE,CAAAJ,MAAG;AAAC,MAAAA,EAAE,YAAcM,MAAJ,KAAOC,EAAED,GAAEN,EAAE,UAASA,EAAE,QAAQ,OAAKA,EAAE,YAAUA,EAAE,UAAU,QAAQI,CAAC,IAAE,EAAE,QAAQJ,CAAC;AAAA,IAAE;AAAE,OAAG,QAAQI,CAAC;AAAE,UAAMC,IAAE,KAAK,KAAK,kBAAkB;AAAE,WAAM,CAACA,KAAGA,EAAE,WAAS,EAAE,UAAQA,EAAE,KAAK,CAACL,GAAEM,MAAI,EAAEA,CAAC,MAAIN,CAAC,IAAE,IAAEK;AAAA,EAAC;AAAA,EAAC,SAAQ;AAAC,UAAM,IAAE,KAAK;AAAM,QAAI,IAAE,EAAC,KAAI,EAAE,KAAI,QAAO,EAAE,aAAY,aAAY,EAAE,mBAAkB,YAAW,EAAE,cAAY,KAAI;AAAE,WAAO,KAAK,oBAAkB,KAAK,gBAAc,EAAE,gBAAc,KAAK,gBAAc,IAAE,EAAC,GAAG,GAAE,QAAO,KAAK,QAAO,WAAU,KAAK,UAAS,GAAE;AAAA,EAAC;AAAC;AAAEJ,EAAE,CAACG,EAAE,EAAC,UAAS,GAAE,CAAC,CAAC,GAAEL,EAAE,WAAU,iBAAgB,IAAI,GAAEE,EAAE,CAACG,EAAC,CAAE,GAAEL,EAAE,WAAU,UAAS,MAAM,GAAEE,EAAE,CAACG,EAAE,EAAC,UAAS,GAAE,CAAC,CAAC,GAAEL,EAAE,WAAU,oBAAmB,IAAI,GAAEE,EAAE,CAACG,EAAC,CAAE,GAAEL,EAAE,WAAU,SAAQ,IAAI,GAAEE,EAAE,CAACG,EAAE,EAAC,UAAS,GAAE,CAAC,CAAC,GAAEL,EAAE,WAAU,UAAS,IAAI,GAAEE,EAAE,CAACG,EAAE,EAAC,UAAS,GAAE,CAAC,CAAC,GAAEL,EAAE,WAAU,aAAY,IAAI,GAAEE,EAAE,CAACG,EAAE,EAAC,MAAK,OAAM,CAAC,CAAC,GAAEL,EAAE,WAAU,SAAQ,MAAM,GAAEE,EAAE,CAACG,EAAE,EAAC,UAAS,GAAE,CAAC,CAAC,GAAEL,EAAE,WAAU,WAAU,IAAI,GAAEE,EAAE,CAACG,EAAE,EAAC,UAAS,GAAE,CAAC,CAAC,GAAEL,EAAE,WAAU,oBAAmB,IAAI,GAAEA,IAAEE,EAAE,CAACI,EAAE,2CAA2C,CAAC,GAAEN,CAAC;","x_google_ignoreList":[0]}