{"version":3,"file":"BufferObject-4qg9W3U8.js","sources":["../../node_modules/@arcgis/core/views/webgl/BufferObject.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{isArrayLike as t}from\"../../core/arrayUtils.js\";import has from\"../../core/has.js\";import e from\"../../core/Logger.js\";import{isUint8Array as s,isUint16Array as i,isUint32Array as r}from\"../../core/typedArrayUtil.js\";import{checkWebGLError as n}from\"./checkWebGLError.js\";import{ResourceType as u,DataType as a}from\"./enums.js\";const f=()=>e.getLogger(\"esri.views.webgl.BufferObject\"),h=null,c=!!has(\"esri-tests-disable-gpu-memory-measurements\");class o{static createIndex(t,e,s){return new o(t,34963,e,s)}static createUniform(t,e,s){return new o(t,35345,e,s)}static createPixelPack(t,e=35041,s){const i=new o(t,35051,e);return s&&i.setSize(s),i}static createPixelUnpack(t,e=35040,s){return new o(t,35052,e,s)}static createTransformFeedback(t,e=35044,s){const i=new o(t,35982,e);return i.setSize(s),i}constructor(t,e,s,i){this._context=t,this.bufferType=e,this.usage=s,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(u.BufferObject,this),this._glName=this._context.gl.createBuffer(),n(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(34963===this.bufferType){if(this._indexType===a.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return c?0:this.sizeBytes}get _isVAOAware(){return 34963===this.bufferType||34962===this.bufferType}dispose(){if(this._context?.gl){if(this._glName){this._context.gl.deleteBuffer(this._glName),this._glName=null}this._context.instanceCounter.decrement(u.BufferObject,this),this._context=null}else this._glName&&f().warn(\"Leaked WebGL buffer object\")}setSize(t,e=null){if(34963===this.bufferType&&null!=e)switch(this._indexType=e,e){case a.UNSIGNED_SHORT:t*=2;break;case a.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;34963===this.bufferType&&(s(t)?this._indexType=a.UNSIGNED_BYTE:i(t)?(e/=2,this._indexType=a.UNSIGNED_SHORT):r(t)&&(e/=4,this._indexType=a.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=e?i.bufferData(this.bufferType,e,this.usage):i.bufferData(this.bufferType,t,this.usage),n(i),this._isVAOAware&&this._context.bindVAO(s)}setSubData(t,e,s,i){if(!t)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:u}=this._context;u.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,s,i-s),n(u),this._isVAOAware&&this._context.bindVAO(r)}getSubData(t,e=0,s,i){if(s<0||i<0)return;const r=_(t)?t.BYTES_PER_ELEMENT:1;if(r*((s??0)+(i??0))>t.byteLength)return;e+r*(i??0)>this.usedMemory&&f().warn(\"Potential problem getting subdata: requested data exceeds buffer size!\");const n=this._context.gl;35982===this.bufferType?(this._context.bindBuffer(this,35982),n.getBufferSubData(35982,e,t,s,i),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),n.getBufferSubData(36662,e,t,s,i),this._context.unbindBuffer(36662))}async getSubDataAsync(t,e=0,s,i){await this._context.clientWaitAsync(),this.getSubData(t,e,s,i)}}function _(e){return t(e)}export{o as BufferObject,h as tracer};\n"],"names":["f","e","c","has","o$1","o","t","u","n","a","s","i","r","_"],"mappings":"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","x_google_ignoreList":[0]}