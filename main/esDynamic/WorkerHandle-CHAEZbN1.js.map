{"version":3,"file":"WorkerHandle-CHAEZbN1.js","sources":["../../node_modules/@arcgis/core/core/workers/WorkerHandle.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{remove as e}from\"../arrayUtils.js\";import{makeHandle as t}from\"../handleUtils.js\";import s from\"../Logger.js\";import{throwIfAborted as r}from\"../promiseUtils.js\";import{open as i}from\"./workers.js\";class o{constructor(e,t,r,o,h={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=i(e,{...h,schedule:o}).then(e=>{if(void 0===this._thread){this._thread=e,this._promise=null,h.hasInitialize&&this.broadcast({},\"initialize\");for(const e of this._listeners)this._connectListener(e)}else e.close()}),this._promise.catch(t=>s.getLogger(\"esri.core.workers.WorkerHandle\").error(`Failed to initialize ${e} worker: ${t}`))}on(s,r){const i={removed:!1,eventName:s,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),t(()=>{i.removed=!0,e(this._listeners,i),this._thread&&null!=i.threadHandle&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t,s){return this.invokeMethod(this._mainMethod,e,t,s)}invokeMethod(e,t,s,i){if(this._thread){const r=this._transferLists[e],o=r?r(t):[];return this._thread.invoke(e,t,{transferList:o,signal:s,priority:i})}return this._promise?this._promise.then(()=>(r(s),this.invokeMethod(e,t,s))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then(h):this._promise?this._promise.then(()=>this.broadcast(e,t)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(t=>{e.removed||(e.threadHandle=t)})}}function h(){}export{o as WorkerHandle};\n"],"names":["o","r","h","i","e","t","s"],"mappings":";;AAI6M,MAAMA,EAAC;AAAA,EAAC,YAAY,GAAE,GAAEC,GAAED,GAAEE,IAAE,CAAA,GAAG;AAAC,SAAK,cAAY,GAAE,KAAK,iBAAeD,GAAE,KAAK,aAAW,CAAA,GAAG,KAAK,WAASE,EAAE,GAAE,EAAC,GAAGD,GAAE,UAASF,EAAC,CAAC,EAAE,KAAK,CAAAI,MAAG;AAAC,UAAY,KAAK,YAAd,QAAsB;AAAC,aAAK,UAAQA,GAAE,KAAK,WAAS,MAAKF,EAAE,iBAAe,KAAK,UAAU,CAAA,GAAG,YAAY;AAAE,mBAAUE,KAAK,KAAK,WAAW,MAAK,iBAAiBA,CAAC;AAAA,MAAC,MAAM,CAAAA,EAAE,MAAK;AAAA,IAAE,CAAC,GAAE,KAAK,SAAS,MAAM,CAAAC,MAAGC,EAAE,UAAU,gCAAgC,EAAE,MAAM,wBAAwB,CAAC,YAAYD,CAAC,EAAE,CAAC;AAAA,EAAC;AAAA,EAAC,GAAGC,GAAEL,GAAE;AAAC,UAAME,IAAE,EAAC,SAAQ,IAAG,WAAUG,GAAE,UAASL,GAAE,cAAa,KAAI;AAAE,WAAO,KAAK,WAAW,KAAKE,CAAC,GAAE,KAAK,iBAAiBA,CAAC,GAAEE,EAAE,MAAI;AAAC,MAAAF,EAAE,UAAQ,IAAGC,EAAE,KAAK,YAAWD,CAAC,GAAE,KAAK,WAAeA,EAAE,gBAAR,QAAsBA,EAAE,aAAa,OAAM;AAAA,IAAE,CAAC;AAAA,EAAC;AAAA,EAAC,UAAS;AAAC,SAAK,YAAU,KAAK,QAAQ,MAAK,GAAG,KAAK,UAAQ,OAAM,KAAK,WAAS,MAAK,KAAK,WAAW,SAAO,GAAE,KAAK,iBAAe,CAAA;AAAA,EAAE;AAAA,EAAC,OAAO,GAAE,GAAE,GAAE;AAAC,WAAO,KAAK,aAAa,KAAK,aAAY,GAAE,GAAE,CAAC;AAAA,EAAC;AAAA,EAAC,aAAa,GAAE,GAAE,GAAEA,GAAE;AAAC,QAAG,KAAK,SAAQ;AAAC,YAAM,IAAE,KAAK,eAAe,CAAC,GAAEH,IAAE,IAAE,EAAE,CAAC,IAAE,CAAA;AAAG,aAAO,KAAK,QAAQ,OAAO,GAAE,GAAE,EAAC,cAAaA,GAAE,QAAO,GAAE,UAASG,EAAC,CAAC;AAAA,IAAC;AAAC,WAAO,KAAK,WAAS,KAAK,SAAS,KAAK,OAAKF,EAAE,CAAC,GAAE,KAAK,aAAa,GAAE,GAAE,CAAC,EAAE,IAAE,QAAQ,OAAO,IAAI;AAAA,EAAC;AAAA,EAAC,UAAU,GAAE,GAAE;AAAC,WAAO,KAAK,UAAQ,QAAQ,IAAI,KAAK,QAAQ,UAAU,GAAE,CAAC,CAAC,EAAE,KAAKC,CAAC,IAAE,KAAK,WAAS,KAAK,SAAS,KAAK,MAAI,KAAK,UAAU,GAAE,CAAC,CAAC,IAAE,QAAQ,OAAM;AAAA,EAAE;AAAA,EAAC,IAAI,UAAS;AAAC,WAAO,KAAK;AAAA,EAAQ;AAAA,EAAC,iBAAiB,GAAE;AAAC,SAAK,WAAS,KAAK,QAAQ,GAAG,EAAE,WAAU,EAAE,QAAQ,EAAE,KAAK,OAAG;AAAC,QAAE,YAAU,EAAE,eAAa;AAAA,IAAE,CAAC;AAAA,EAAC;AAAC;AAAC,SAASA,IAAG;AAAC;","x_google_ignoreList":[0]}