{"version":3,"file":"GridSnappingEngine-UClpgUvp.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/GridSnappingEngine.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Accessor.js\";import r from\"../../../core/Logger.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{convertUnit as n}from\"../../../core/unitUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{K as a}from\"../../../chunks/vec32.js\";import{isLoadedOrLoadFor as p,project as l}from\"../../../geometry/projectionUtils.js\";import{getClosestDenormalizedXToReference as c}from\"../../../geometry/support/normalizeUtils.js\";import{getResolutionForScale as u}from\"../../../geometry/support/scaleUtils.js\";import{minimumPixelsPerStrideForDisplayWhenScalingOff as d}from\"../../2d/grid/constants.js\";import{getScaleFactor as g,measureMetersPerUnitAtReferencePoint as f}from\"../../2d/grid/gridUtils.js\";import{create as h,createWritable as m}from\"../sketch/normalizedPoint.js\";import{gridPlacementGraphicSymbol as S}from\"./snappingUtils.js\";import{IntersectionSnappingCandidate as y}from\"./candidates/IntersectionSnappingCandidate.js\";import{LineSnappingCandidate as v}from\"./candidates/LineSnappingCandidate.js\";let w=class extends e{constructor(t){super(t),this.options=null}destroy(){this._set(\"options\",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:i(this.view.rotation??0)}get gridRotation(){return i(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:t,grid:e}=this;if(!e||!t||!p(e.center.spatialReference,t))return null;try{const r=l(e.center,t),i=t.isWrappable&&null!=this.view?.center?c(r.x,this.view.center.x,t):r.x;return h(i,r.y,r.z)}catch(i){return r.getLogger(this).errorOnce(\"Grid Snapping - Failed to project grid center.\",i),null}}get offsetScaleFactor(){const{pixelsPerStride:t,grid:e}=this;if(!e||!t)return 1;const{majorLineInterval:r,dynamicScaling:i}=e;return r<1?null:g(r,t,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:t}=this;return t?n(t.spacing,t.units,\"meters\"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:t}=this;return null==t?null:t*u(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:t}=this.view;return this.gridCenter?f(this.gridCenter[0],this.gridCenter[1],t):null}get pixelsPerStride(){const{gridMetersPerStride:t,viewMetersPerPixel:e}=this;return e&&t?t/e:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(t,e,r){const{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||r.feature?.attributes&&S in r.feature.attributes)return[];const o=r.coordinateHelper.arrayToPoint(t),s=i.distance*(\"touch\"===r.pointer?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(o,s)}fetchCandidatesSync(t,e){const r=[],{grid:i,effectiveViewRotation:n,gridRotation:o,gridCenter:s,viewMetersPerPixel:a,viewMetersPerSRUnit:c,offsetScaleFactor:u,spatialReference:g,gridMetersPerStride:f,pixelsPerStride:m}=this;if(!(i&&a&&c&&s&&g&&u&&f&&m))return r;if(!i.dynamicScaling&&m<d)return r;if(!p(t.spatialReference,g))return r;const S=l(t,g),w=h(S.x,S.y,S.z),x=P(w,-o,s,-n),C=f/c*u,U=j(x,C,s),{shouldSnapX:b,shouldSnapY:L}=R(U,x,e,a,c);if(!b&&!L)return[];const z=h((b?U:x)[0],(L?U:x)[1]),E=P(z,o,s,n),F=P(U,o,s,n);if(L){const t=M(U,x,C,\"y\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}if(b){const t=M(U,x,C,\"x\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}return b&&L&&r.push(new y(E,r[0],r[1],!1)),r}};t([o({constructOnly:!0})],w.prototype,\"view\",void 0),t([o()],w.prototype,\"options\",void 0),t([o()],w.prototype,\"grid\",null),t([o()],w.prototype,\"effectiveViewRotation\",null),t([o()],w.prototype,\"gridRotation\",null),t([o()],w.prototype,\"gridCenter\",null),t([o()],w.prototype,\"offsetScaleFactor\",null),t([o()],w.prototype,\"spatialReference\",null),t([o()],w.prototype,\"gridMetersPerStride\",null),t([o()],w.prototype,\"viewMetersPerPixel\",null),t([o()],w.prototype,\"viewMetersPerSRUnit\",null),t([o()],w.prototype,\"pixelsPerStride\",null),t([o()],w.prototype,\"updating\",null),w=t([s(\"esri.views.interactive.snapping.GridSnappingEngine\")],w);const P=(t,e,r,i)=>{const n=m(t[0],t[1],t[2]);return a(n,a(n,n,r,e),r,i)},j=(t,e,r)=>{const i=(t[0]-r[0])/e,n=(t[1]-r[1])/e,o=Math.trunc(i),s=Math.trunc(n),a=Math.round(i%1),p=Math.round(n%1),l=r[0]+(o+a)*e,c=r[1]+(s+p)*e;return h(l,c)},R=(t,e,r,i,n)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};const o=(t[0]-e[0])/i,s=(t[1]-e[1])/i;return{shouldSnapX:Math.abs(o*n)<r,shouldSnapY:Math.abs(s*n)<r}},M=(t,e,r,i)=>{if(\"y\"===i){const i=e[0]>t[0]?1:-1;return h(t[0]+r*i,t[1])}const n=e[1]>t[1]?1:-1;return h(t[0],t[1]+r*n)};export{w as GridSnappingEngine};\n"],"names":["w","e","t","i","p","r","l","c","h","g","n","u","f","S","o","s","a","m","d","x","P","C","U","j","b","L","R","z","E","F","M","v","y"],"mappings":";;;;;;;AAI8vC,IAACA,IAAE,cAAcC,EAAC;AAAA,EAAC,YAAYC,GAAE;AAAC,UAAMA,CAAC,GAAE,KAAK,UAAQ;AAAA,EAAI;AAAA,EAAC,UAAS;AAAC,SAAK,KAAK,WAAU,IAAI;AAAA,EAAC;AAAA,EAAC,IAAI,OAAM;AAAC,WAAO,KAAK,KAAK;AAAA,EAAI;AAAA,EAAC,IAAI,wBAAuB;AAAC,WAAO,KAAK,MAAM,gBAAc,IAAEC,EAAE,KAAK,KAAK,YAAU,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,eAAc;AAAC,WAAOA,EAAE,KAAK,MAAM,YAAU,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,aAAY;AAAC,UAAK,EAAC,kBAAiBD,GAAE,MAAKD,EAAC,IAAE;AAAK,QAAG,CAACA,KAAG,CAACC,KAAG,CAACE,EAAEH,EAAE,OAAO,kBAAiBC,CAAC,EAAE,QAAO;AAAK,QAAG;AAAC,YAAMG,IAAEC,EAAEL,EAAE,QAAOC,CAAC,GAAE,IAAEA,EAAE,eAAmB,KAAK,MAAM,UAAjB,OAAwBK,EAAEF,EAAE,GAAE,KAAK,KAAK,OAAO,GAAEH,CAAC,IAAEG,EAAE;AAAE,aAAOG,EAAE,GAAEH,EAAE,GAAEA,EAAE,CAAC;AAAA,IAAC,SAAOF,GAAE;AAAC,aAAOE,EAAE,UAAU,IAAI,EAAE,UAAU,kDAAiDF,CAAC,GAAE;AAAA,IAAI;AAAA,EAAC;AAAA,EAAC,IAAI,oBAAmB;AAAC,UAAK,EAAC,iBAAgBD,GAAE,MAAKD,EAAC,IAAE;AAAK,QAAG,CAACA,KAAG,CAACC,EAAE,QAAO;AAAE,UAAK,EAAC,mBAAkBG,GAAE,gBAAe,EAAC,IAAEJ;AAAE,WAAOI,IAAE,IAAE,OAAKI,EAAEJ,GAAEH,GAAE,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,mBAAkB;AAAC,WAAO,KAAK,KAAK;AAAA,EAAgB;AAAA,EAAC,IAAI,sBAAqB;AAAC,UAAK,EAAC,MAAKA,EAAC,IAAE;AAAK,WAAOA,IAAEQ,EAAER,EAAE,SAAQA,EAAE,OAAM,QAAQ,IAAE;AAAA,EAAI;AAAA,EAAC,IAAI,qBAAoB;AAAC,UAAK,EAAC,qBAAoBA,EAAC,IAAE;AAAK,WAAaA,KAAN,OAAQ,OAAKA,IAAES,EAAE,KAAK,KAAK,OAAM,KAAK,KAAK,gBAAgB;AAAA,EAAC;AAAA,EAAC,IAAI,sBAAqB;AAAC,UAAK,EAAC,kBAAiBT,EAAC,IAAE,KAAK;AAAK,WAAO,KAAK,aAAWU,EAAE,KAAK,WAAW,CAAC,GAAE,KAAK,WAAW,CAAC,GAAEV,CAAC,IAAE;AAAA,EAAI;AAAA,EAAC,IAAI,kBAAiB;AAAC,UAAK,EAAC,qBAAoBA,GAAE,oBAAmBD,EAAC,IAAE;AAAK,WAAOA,KAAGC,IAAEA,IAAED,IAAE;AAAA,EAAI;AAAA,EAAC,IAAI,WAAU;AAAC,WAAa,KAAK,QAAX,QAAuB,KAAK,oBAAX,QAAmC,KAAK,uBAAX;AAAA,EAA8B;AAAA,EAAC,MAAM,gBAAgBC,GAAED,GAAEI,GAAE;AAAC,UAAK,EAAC,SAAQ,GAAE,MAAK,EAAC,IAAE;AAAK,QAAG,CAAC,GAAG,wBAAsB,CAAC,EAAE,QAAMA,EAAE,SAAS,cAAYQ,KAAKR,EAAE,QAAQ,WAAW,QAAM,CAAA;AAAG,UAAMS,IAAET,EAAE,iBAAiB,aAAaH,CAAC,GAAEa,IAAE,EAAE,YAAoBV,EAAE,YAAZ,UAAoB,EAAE,6BAA2B;AAAG,WAAO,KAAK,oBAAoBS,GAAEC,CAAC;AAAA,EAAC;AAAA,EAAC,oBAAoBb,GAAED,GAAE;AAAC,UAAMI,IAAE,CAAA,GAAG,EAAC,MAAK,GAAE,uBAAsB,GAAE,cAAaS,GAAE,YAAWC,GAAE,oBAAmBC,GAAE,qBAAoBT,GAAE,mBAAkBI,GAAE,kBAAiB,GAAE,qBAAoBC,GAAE,iBAAgBK,EAAC,IAAE;AAA8E,QAAtE,EAAE,KAAGD,KAAGT,KAAGQ,KAAG,KAAGJ,KAAGC,KAAGK,MAAe,CAAC,EAAE,kBAAgBA,IAAEC,KAAc,CAACd,EAAEF,EAAE,kBAAiB,CAAC,EAAE,QAAOG;AAAE,UAAMQ,IAAEP,EAAEJ,GAAE,CAAC,GAAEF,IAAEQ,EAAEK,EAAE,GAAEA,EAAE,GAAEA,EAAE,CAAC,GAAEM,IAAEC,EAAEpB,GAAE,CAACc,GAAEC,GAAE,CAAC,CAAC,GAAEM,IAAET,IAAEL,IAAEI,GAAEW,IAAEC,EAAEJ,GAAEE,GAAEN,CAAC,GAAE,EAAC,aAAYS,GAAE,aAAYC,EAAC,IAAEC,EAAEJ,GAAEH,GAAElB,GAAEe,GAAET,CAAC;AAAE,QAAG,CAACiB,KAAG,CAACC,EAAE,QAAM,CAAA;AAAG,UAAME,IAAEnB,GAAGgB,IAAEF,IAAEH,GAAG,CAAC,IAAGM,IAAEH,IAAEH,GAAG,CAAC,CAAC,GAAES,IAAER,EAAEO,GAAEb,GAAEC,GAAE,CAAC,GAAEc,IAAET,EAAEE,GAAER,GAAEC,GAAE,CAAC;AAAE,QAAGU,GAAE;AAAC,YAAMvB,IAAE4B,EAAER,GAAEH,GAAEE,GAAE,GAAG,GAAEpB,IAAEmB,EAAElB,GAAEY,GAAEC,GAAE,CAAC;AAAEV,MAAAA,EAAE,KAAK,IAAI0B,EAAE,EAAC,WAAUF,GAAE,SAAQ5B,GAAE,aAAY2B,GAAE,UAAS,GAAE,CAAC,CAAC;AAAA,IAAC;AAAC,QAAGJ,GAAE;AAAC,YAAMtB,IAAE4B,EAAER,GAAEH,GAAEE,GAAE,GAAG,GAAEpB,IAAEmB,EAAElB,GAAEY,GAAEC,GAAE,CAAC;AAAEV,MAAAA,EAAE,KAAK,IAAI0B,EAAE,EAAC,WAAUF,GAAE,SAAQ5B,GAAE,aAAY2B,GAAE,UAAS,GAAE,CAAC,CAAC;AAAA,IAAC;AAAC,WAAOJ,KAAGC,KAAGpB,EAAE,KAAK,IAAI2B,EAAEJ,GAAEvB,EAAE,CAAC,GAAEA,EAAE,CAAC,GAAE,EAAE,CAAC,GAAEA;AAAAA,EAAC;AAAC;AAAEH,EAAE,CAACY,EAAE,EAAC,eAAc,GAAE,CAAC,CAAC,GAAEd,EAAE,WAAU,QAAO,MAAM,GAAEE,EAAE,CAACY,GAAG,GAAEd,EAAE,WAAU,WAAU,MAAM,GAAEE,EAAE,CAACY,EAAC,CAAE,GAAEd,EAAE,WAAU,QAAO,IAAI,GAAEE,EAAE,CAACY,EAAC,CAAE,GAAEd,EAAE,WAAU,yBAAwB,IAAI,GAAEE,EAAE,CAACY,EAAC,CAAE,GAAEd,EAAE,WAAU,gBAAe,IAAI,GAAEE,EAAE,CAACY,EAAC,CAAE,GAAEd,EAAE,WAAU,cAAa,IAAI,GAAEE,EAAE,CAACY,GAAG,GAAEd,EAAE,WAAU,qBAAoB,IAAI,GAAEE,EAAE,CAACY,EAAC,CAAE,GAAEd,EAAE,WAAU,oBAAmB,IAAI,GAAEE,EAAE,CAACY,GAAG,GAAEd,EAAE,WAAU,uBAAsB,IAAI,GAAEE,EAAE,CAACY,EAAC,CAAE,GAAEd,EAAE,WAAU,sBAAqB,IAAI,GAAEE,EAAE,CAACY,EAAC,CAAE,GAAEd,EAAE,WAAU,uBAAsB,IAAI,GAAEE,EAAE,CAACY,GAAG,GAAEd,EAAE,WAAU,mBAAkB,IAAI,GAAEE,EAAE,CAACY,EAAC,CAAE,GAAEd,EAAE,WAAU,YAAW,IAAI,GAAEA,IAAEE,EAAE,CAACa,EAAE,oDAAoD,CAAC,GAAEf,CAAC;AAAE,MAAMoB,IAAE,CAAClB,GAAED,GAAEI,GAAE,MAAI;AAAC,QAAM,IAAEY,EAAEf,EAAE,CAAC,GAAEA,EAAE,CAAC,GAAEA,EAAE,CAAC,CAAC;AAAE,SAAOc,EAAE,GAAEA,EAAE,GAAE,GAAEX,GAAEJ,CAAC,GAAEI,GAAE,CAAC;AAAC,GAAEkB,IAAE,CAACrB,GAAED,GAAEI,MAAI;AAAC,QAAM,KAAGH,EAAE,CAAC,IAAEG,EAAE,CAAC,KAAGJ,GAAE,KAAGC,EAAE,CAAC,IAAEG,EAAE,CAAC,KAAGJ,GAAEa,IAAE,KAAK,MAAM,CAAC,GAAEC,IAAE,KAAK,MAAM,CAAC,GAAEC,IAAE,KAAK,MAAM,IAAE,CAAC,GAAEZ,IAAE,KAAK,MAAM,IAAE,CAAC,GAAEE,IAAED,EAAE,CAAC,KAAGS,IAAEE,KAAGf,GAAEM,IAAEF,EAAE,CAAC,KAAGU,IAAEX,KAAGH;AAAE,SAAOO,EAAEF,GAAEC,CAAC;AAAC,GAAEmB,IAAE,CAACxB,GAAED,GAAEI,GAAE,GAAE,MAAI;AAAC,MAAG,KAAG,EAAE,QAAM,EAAC,aAAY,IAAG,aAAY,GAAE;AAAE,QAAMS,KAAGZ,EAAE,CAAC,IAAED,EAAE,CAAC,KAAG,GAAEc,KAAGb,EAAE,CAAC,IAAED,EAAE,CAAC,KAAG;AAAE,SAAM,EAAC,aAAY,KAAK,IAAIa,IAAE,CAAC,IAAET,GAAE,aAAY,KAAK,IAAIU,IAAE,CAAC,IAAEV,EAAC;AAAC,GAAEyB,IAAE,CAAC5B,GAAED,GAAEI,GAAE,MAAI;AAAC,MAAS,MAAN,KAAQ;AAAC,UAAMF,IAAEF,EAAE,CAAC,IAAEC,EAAE,CAAC,IAAE,IAAE;AAAG,WAAOM,EAAEN,EAAE,CAAC,IAAEG,IAAEF,GAAED,EAAE,CAAC,CAAC;AAAA,EAAC;AAAC,QAAM,IAAED,EAAE,CAAC,IAAEC,EAAE,CAAC,IAAE,IAAE;AAAG,SAAOM,EAAEN,EAAE,CAAC,GAAEA,EAAE,CAAC,IAAEG,IAAE,CAAC;AAAC;","x_google_ignoreList":[0]}