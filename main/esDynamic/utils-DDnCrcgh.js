import{dr as $,ds as m,b as d,dt as w,du as Z,dv as U,b2 as g,dw as b,dx as C,bM as S,b7 as h}from"./main-6gYsRPh_.js";import"./mat4f32-BdRMyjXW.js";import"./mat4-BV6dbHOa.js";import"./messages-CmaHiSwa.js";import{h as v}from"./timeZoneUtils-CXoSeXhc.js";const D=",",F={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},M=new Set(["integer","small-integer"]);let c=null;function N(t){return g(t)||b(t)||C(t)}async function x(t){const{field:n,field2:e,field3:r,normalizationField:i,valueExpression:u,fields:s}=t;let o=[];if(u){if(!c){const{arcadeUtils:l}=await S();c=l}o=c.extractFieldNames(u)}return n&&o.push(n),e&&o.push(e),r&&o.push(r),i&&o.push(i),s&&o.push(...s),o}function f(t){return String(t).padStart(2,"0")}function y(t,n,e){let r;return n==="date"||n==="number"?(n==="number"&&(t=new Date(t)),r=`TIMESTAMP'${e?t.getFullYear():t.getUTCFullYear()}-${f((e?t.getMonth():t.getUTCMonth())+1)}-${f(e?t.getDate():t.getUTCDate())} ${f(e?t.getHours():t.getUTCHours())}:${f(e?t.getMinutes():t.getUTCMinutes())}:${f(e?t.getSeconds():t.getUTCSeconds())}'`):r=t,r}function E(t,n,e,r){const{hasQueryEngine:i}=t,u=`(${y(e,T(t,e),i)} - ${y(n,T(t,n),i)})`;let s=F[r],o="/";return s<1&&(s=1/s,o="*"),{sqlExpression:s===1?u:`(${u} ${o} ${s})`,sqlWhere:null}}function T(t,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const e=t.getField(n);if(n.toLowerCase()==="<now>")return;if(g(e))return"field"}}function q(t,n){const e=n&&t.getField(n);return!!e&&M.has(e.type)}function z(t){return`cast(${t} as float)`}function H(t,n){const{format:e,fieldFormat:r,timeZoneOptions:i,fieldType:u}=n??{},s=r?$(r):null;let o,l;if(i&&({timeZone:o,timeZoneName:l}=v(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,s||m(e||"short-date-short-time"),u)),typeof t=="string"&&isNaN(Date.parse(u==="time-only"?`1970-01-01T${t}Z`:t)))return t;switch(u){case"date-only":{const a=s||m(e||"short-date");return typeof t=="string"?U(t,{...a}):d(t,{...a,timeZone:h})}case"time-only":{const a=s||m(e||"short-time");return typeof t=="string"?Z(t,a):d(t,{...a,timeZone:h})}case"timestamp-offset":{if(!o&&typeof t=="string"&&new Date(t).toISOString()!==t)return t;const a=e||s||i?s||m(e||"short-date-short-time"):void 0,p=a?{...a,timeZone:o,timeZoneName:l}:void 0;return typeof t=="string"?w(t,p):d(t,p)}default:{const a=e||s||i?s||m(e||"short-date-short-time"):void 0;return d(typeof t=="string"?new Date(t):t,a?{...a,timeZone:o,timeZoneName:l}:void 0)}}}export{E as C,q as M,z as N,N as U,D as c,x as w,H as x};
