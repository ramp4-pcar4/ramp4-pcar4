import{v as n,x as r,z as O,n as st,V as at,gb as lt,bL as ct,bH as X,ah as zt,ce as Ht,bZ as Ft,cG as Lt,ab as Dt,b1 as pt,e8 as Nt,ae as Zt,N as $,bv as jt,a4 as Z,da as Yt,gM as dt}from"./main-CnDVnExo.js";import{h as Bt}from"./UpdatingHandles-BRsO5JmU.js";import{d as Kt}from"./asyncUtils-Bt7pGkXn.js";import{r as T,V as Qt,R as Wt,E as Xt,f as $t,H as qt}from"./SketchTooltipInfo-C8QFTbSU.js";import Jt from"./GraphicsLayer-BFz-x5ra.js";import{Z as te,n as ee,c as ie,k as ut,a as oe,b as ht,U as ne,T as re,j as yt,d as se,R as ae}from"./drawSurfaces-Dq8GDRqp.js";import{d as C,h as I,f as le,a as ce,j as pe}from"./quantityUtils-CeuINKqm.js";import{a as de,b as ue,j as he,E as ye}from"./elevationInfoUtils-IwFHKcCU.js";import{o as gt,u as q,w as mt,g as ft}from"./vec32-wzgHRfsM.js";import{h as G,k as ge,R as me,y as vt,F as wt,Q as fe,w as ve}from"./TooltipInfoWithCoordinates-Bref0KSP.js";import{ab as we,ac as Oe,R as _e,l as Ot}from"./SketchViewModel-Bswg1_Ha.js";import{o as z,j as _t,f as ke,M as xe,e as be,u as Ue,l as kt,k as xt}from"./vec2-BnynUbeJ.js";import{W as Ve,K as j}from"./boundedPlane-CB1c2wHX.js";import{t as H}from"./vectorStacks-Du5l6qOg.js";import{t as Te,b as Ie,c as Me,d as Re}from"./SnappingContext-SQEe2imj.js";var m;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(m||(m={}));var _;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(_||(_={}));const Y={[_.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[_.UndoInvalidError]:"There are no items to Undo",[_.RedoInvalidError]:"There are no items to Redo",[_.ApplyInvalidError]:"Cannot apply an item that is already applied"};let F=class extends Error{constructor(){super(Y[_.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},J=class extends Error{constructor(){super(Y[_.UndoInvalidError]),this.type="undo-redo-undo-error"}},bt=class extends Error{constructor(){super(Y[_.RedoInvalidError]),this.type="undo-redo-redo-error"}},Pe=class extends Error{constructor(){super(Y[_.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var b;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(b||(b={}));let B=class extends st{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=m.NeverApplied}get canUndo(){return this.status===m.Applied}get canRedo(){return this.status===m.Undone}async executeUndoRedoOperation(t){switch(t){case b.Apply:if(this.status!==m.NeverApplied)throw new Pe;return await this.apply(),void(this.status=m.Applied);case b.Undo:if(this.status!==m.Applied)throw new J;return await this.undo(),void(this.status=m.Undone);case b.Redo:if(this.status!==m.Undone)throw new J;return await this.redo(),void(this.status=m.Applied)}}};n([r()],B.prototype,"name",void 0),n([r()],B.prototype,"tag",void 0),B=n([O("esri.undoredo.UndoableOperation")],B);let k=class extends st{constructor(){super(...arguments),this._stack=new at,this._stackPosition=-1,this._updatingHandles=new Bt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new J;if(this.updating)throw new F;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(b.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new bt;if(this.updating)throw new F;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new bt;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(b.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new F;await this._updatingHandles.addPromise((async()=>{t.status===m.NeverApplied&&await t.executeUndoRedoOperation(b.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new F;await this._updatingHandles.addPromise((async()=>{t.status===m.NeverApplied&&await t.executeUndoRedoOperation(b.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await lt(()=>!this.updating);const i=new at;for(let o=0;o<this._stack.length;o++){const s=this._stack.getItemAt(o);s&&(s.tag===t?(s.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new F;await lt(()=>!this.updating),this._drainStack()}};n([r()],k.prototype,"_stack",void 0),n([r()],k.prototype,"_stackPosition",void 0),n([r()],k.prototype,"updating",null),n([r({readOnly:!0})],k.prototype,"canUndo",null),n([r({readOnly:!0})],k.prototype,"hasUndo",null),n([r({readOnly:!0})],k.prototype,"canRedo",null),n([r({readOnly:!0})],k.prototype,"hasRedo",null),k=n([O("esri.UndoRedo")],k);let Se=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function P(t,e,i){if(t==null)return"noTool";switch(t){case"point":return Ee();case"multipoint":return"multipoint";case"polyline":return Ae(e,i);case"polygon":return Ce(e,i);case"rectangle":case"circle":return Ge(e,i);default:return}}function Ee(t){return"point"}function Ae(t,e){const i=t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0;return e==="freehand"?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}function Ce(t,e){const i=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;if(i<3)switch(e){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return e==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function Ge(t,e){if((t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0)<3)switch(e){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(e){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function ze(t,e){const i=t?.geometry;if(!t||i?.type!=="mesh"||!e)return;const{renderCoordsHelper:o,elevationProvider:s}=e,{camera:u}=e.state,{extent:l}=i,{center:c,spatialReference:a}=l,h=ct(a),y=X(a),g=ct(o.spatialReference),v=l.width*h,p=l.height*y,V=(l.zmax??0)*y,w=V-(l.zmin??0)*y,M=Math.max(v,p,w)/g,{x:R,y:W}=c,nt=c.z??0;gt(K,R,W,nt),o.toRenderCoords(K,a,K);const rt=M/u.computeScreenPixelSizeAt(K);if(rt>u.width*Fe)return"meshTooClose";if(rt<He)return"meshTooFar";const Ct=de(t),{absoluteZ:Gt}=ue(R,W,V,a,e,Ct);return Gt<(s.getElevation(R,W,nt,a,"ground")??0)*y+w*Le?"meshUnderground":"mesh"}const He=20,Fe=1,Le=.1,K=zt();let x=class extends T{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=C}get allFields(){return[]}};n([r()],x.prototype,"type",void 0),n([r()],x.prototype,"radius",void 0),n([r()],x.prototype,"xSize",void 0),n([r()],x.prototype,"ySize",void 0),n([r()],x.prototype,"area",void 0),n([r()],x.prototype,"helpMessage",void 0),n([r()],x.prototype,"allFields",null),x=n([O("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],x);let L=class extends G(T){constructor(t){super(t),this.type="draw-mesh",this.orientation=ge({lockable:!1}),this.scale=me({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};n([r()],L.prototype,"helpMessage",void 0),n([r()],L.prototype,"allFields",null),L=n([O("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],L);let D=class extends G(T){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],D.prototype,"helpMessage",void 0),n([r()],D.prototype,"allFields",null),D=n([O("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],D);let N=class extends G(T){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],N.prototype,"helpMessage",void 0),n([r()],N.prototype,"allFields",null),N=n([O("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],N);let S=class extends G(T){constructor(t){super(t),this.type="draw-polygon",this.direction=vt(),this.distance=wt(),this.area=fe(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};n([r()],S.prototype,"xyMode",void 0),n([r()],S.prototype,"helpMessage",void 0),n([r()],S.prototype,"allFields",null),S=n([O("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],S);let E=class extends G(T){constructor(t){super(t),this.type="draw-polyline",this.direction=vt(),this.distance=wt(),this.totalLength=ve(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};n([r()],E.prototype,"helpMessage",void 0),n([r()],E.prototype,"xyMode",void 0),n([r()],E.prototype,"allFields",null),E=n([O("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],E);let U=class extends T{constructor(t){super(t),this.type="draw-rectangle",this.xSize=I,this.ySize=I,this.area=C}get allFields(){return[]}};n([r()],U.prototype,"type",void 0),n([r()],U.prototype,"xSize",void 0),n([r()],U.prototype,"ySize",void 0),n([r()],U.prototype,"area",void 0),n([r()],U.prototype,"helpMessage",void 0),n([r()],U.prototype,"allFields",null),U=n([O("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],U);function De(t,e){return{point:new N({sketchOptions:e,viewType:t}),multipoint:new D({sketchOptions:e,viewType:t}),polyline:new E({sketchOptions:e,viewType:t}),polygon:new S({sketchOptions:e,viewType:t}),mesh:new L({sketchOptions:e,viewType:t}),rectangle:new U({sketchOptions:e}),circle:new x({sketchOptions:e})}}function Ut(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:s}=t,u=c=>{const a=Q(t).mode,h=s[c].elevation;a==="relative-to-ground"||a==="relative-to-scene"||a==="on-the-ground"?h.lock(it(t)):h.unlock()},l=c=>{if(e){const a=s[c].direction;a.committed=e.angle,a.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":u(i),l(i);break;case"point":case"mesh":u(i)}}function Ne(t,e){const{drawOperation:i,view:o}=e,s=tt(e),u=Q(e);if(o.type==="2d"||!t||u.mode!=="absolute-height"||i?.numCommittedVertices!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[l,c,a]=t,h=ei(l,c,a,u,e);h!=null&&s.elevation.lock(h)}function Vt(t){tt(t)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function tt({geometryType:t,graphic:e,tooltipInfos:i}){return e?.geometry?.type!==Ze[t]?t==="circle"||t==="rectangle"?i[t]:null:i[t]}const Ze={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function je(t,e){switch(t?.type){case"draw-point":Ye(t,e);break;case"draw-multipoint":Be(t,e);break;case"draw-polyline":Qe(t,e);break;case"draw-polygon":We(t,e);break;case"draw-rectangle":$e(t,e);break;case"draw-circle":qe(t,e);break;case"draw-mesh":Ke(t,e)}}function Ye(t,e){const i=e.graphic?.geometry;i?.type==="point"&&(et(t,i,e),t.helpMessage=P("point",i,e.drawOperation.drawingMode))}function Be(t,e){const i=e.graphic?.geometry;i?.type==="multipoint"&&(et(t,i,e),t.helpMessage=P("multipoint",i,e.drawOperation.drawingMode))}function Ke(t,e){const{graphic:i,view:o}=e,s=i?.geometry;o.type!=="3d"||s&&s.type!=="mesh"||(et(t,s?.origin,e),s&&Qt(t,s),t.helpMessage=ze(i,o))}function et(t,e,i){const{drawOperation:o,view:s,sketchOptions:u}=i,{cursorVertex:l}=o;t.sketchOptions=u,t.viewType=s.type;const c=e?.type==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(c,A(i)),Mt(t.elevation,i),!l)return void(o.constraints=void 0);const a=l;o.constraints={context:Et(a,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function Qe(t,e){const{createOperationGeometry:i,drawOperation:o,automaticLengthMeasurementUtils:s}=e,u=i!=null?i.full:null;u&&u.type!=="polyline"||(It(t,e),t.totalLength.actual=o.lastVertex?(u?s.autoLength2D(u):null)??I:null,t.helpMessage=P("polyline",u,e.drawOperation.drawingMode))}function We(t,e){const{createOperationGeometry:i,drawOperation:o}=e,s=i!=null?i.full:null;s&&s.type!=="polygon"||(It(t,e),t.area.actual=o.lastVertex?(s?e.automaticAreaMeasurementUtils.autoArea2D(s):null)??C:null,t.helpMessage=P("polygon",s,e.drawOperation.drawingMode))}const Tt=Ht(Ft);function It(t,e){const{drawOperation:i,sketchOptions:o,view:s,automaticLengthMeasurementUtils:u}=e,{cursorVertex:l,lastVertex:c,secondToLastVertex:a}=i,h=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=s.type;const y=c&&l?u.autoDistanceBetweenPoints2D(Tt(c),Tt(l))??I:null;if(t.distance.actual=y,t.distance.readOnly=c==null,t.direction.actual=null,t.direction.readOnly=!0,c&&l&&(h==="absolute"||a)){const p=Oe(a,c,l,h);t.direction.actual=p??pe,t.direction.readOnly=!1}t.setLocationFromPoint(l,A(e)),Mt(t.elevation,e);const g=Xe(c,e);t.xyMode=g,t.direction.visible=g==="direction-distance",t.distance.visible=g==="direction-distance",t.effectiveX.visible=g==="coordinates",t.effectiveY.visible=g==="coordinates";const v=l??c;i.constraints=v?{context:Et(v,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Xe(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function $e(t,e){t.sketchOptions=e.sketchOptions,t.xSize=Pt(e),t.ySize=St(e),t.area=Rt(e),t.helpMessage=P("rectangle",e.graphic?.geometry,e.drawOperation.drawingMode)}function qe(t,e){const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Je(e):null,t.xSize=i?null:Pt(e),t.ySize=i?null:St(e),t.area=Rt(e),t.helpMessage=P("circle",e.graphic?.geometry,e.drawOperation.drawingMode)}function Mt(t,e){const{drawOperation:i}=e,o=i?.cursorVertex??i?.lastVertex;t.actual=_e(o)??it(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Rt(t){const e=t.createOperationGeometry?.full;return e?.type!=="polygon"?C:t.automaticAreaMeasurementUtils.autoArea2D(e)??C}function Pt({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){const i=t?.rectangle?.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.left,i.right):null)??I}function St({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){const i=t?.rectangle?.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.top,i.bottom):null)??I}function Je({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){return(t?.circle?.center!=null&&t.circle.edge!=null?e.autoDistanceBetweenPoints2D(t.circle.center,t.circle.edge):null)??I}function ti(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?le(o,"meters")/X(A(t)):void 0}default:return}}function ei(t,e,i,o,s){const{view:u,drawOperation:l}=s;if(u.type!=="3d"||!l)return;i??=0;const c=A(s),a=Q(s),h=ye(u,t,e,i,c,a,o);return we(h,c)??it(s)}function Q(t){return t.drawOperation.elevationInfo??he}function A(t){return t.drawOperation.coordinateHelper.spatialReference}function it(t){const e=X(A(t));return ce(t.defaultZ*e,"meters")}function Et(t,e){return te(t,e.view,A(e),Q(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let d=class extends Lt.EventedMixin(ee){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Ot}initialize(){const{view:t}=this;this.internalGraphicsLayer=new Jt({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=De(t.type,this.sketchOptions);const i=Wt(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,Ut(this._tooltipsContext),this._coordinateFormatterLoadTask=Kt(()=>Xt()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>$t(o,this.activeTooltipInfo)),Dt(()=>this.cursor,o=>{e.cursor=o},Nt),pt(()=>{const{activeTooltipInfo:o,sketchOptions:s}=this;je(o,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?o:null}),pt(()=>{e.constraintZ=ti(this._tooltipsContext)},Zt)]),this.finishToolCreation()}destroy(){this.drawOperation=$(this.drawOperation),this.tooltip=$(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=$(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:t,directionOptions:e,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:u,sketchOptions:l,tooltipInfos:c,view:a,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:y}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:t,directionOptions:e,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:u,sketchOptions:l,tooltipInfos:c,view:a,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:y}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof k?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||qt(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Ut(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(f.outline),this.removeHandles(f.regularVertices),this.removeHandles(f.activeVertex),this.removeHandles(f.activeEdge),this.removeHandles(ot)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new jt({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(Z(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),ot),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:s,committedVertices:u,geometryIncludingUncommittedVertices:l,numCommittedVertices:c}=this.drawOperation;if(!(c>0||o!=null))return;const a=t.operationComplete?u:l,h=a.length,y=o!=null?e.pointToArray(o):null,g=this._drawSpatialReference,v=i.type==="3d"&&i.viewingMode==="global",p=new Se;p.committedVertices=u,p.cursorVertex=y;const{geometryType:V}=this;switch(V){case"point":case"mesh":p.full=e.arrayToPoint(a[0]);break;case"multipoint":p.full=h>0?ae(a,g):null;break;case"polyline":case"polygon":h>0&&(p.full=V==="polygon"?re([a],g,v,!0):yt([a],g,v),p.cursorEdge=y!=null&&s&&!se(o,s)?yt([[y,e.pointToArray(s)]],g,v):null,p.outline=h>1?p.full:null);break;case"circle":case"rectangle":{if(p.committedVertices=p.cursorVertex=null,!h)break;const w=ie(i,a[0]),M=a[0],R=w.makeMapPoint(M[0]+oi*i.resolution,M[1]);V==="circle"?h===1&&t.operationComplete?p.circle=ut([M,R],w,!0):h===2&&(this.forceUniformSize?p.circle=ut(a,w,this.centered):p.rectangle=oe(a,w,this.centered)):h===1&&t.operationComplete?p.rectangle=ht([M,R],w,!0):h===2&&(p.rectangle=this.forceUniformSize?ht(a,w,this.centered):ne(a,w,this.centered)),p.full=p.circle!=null?p.circle.geometry:p.rectangle?.geometry,p.outline=p.full?.type==="polygon"?p.full:null;break}default:return null}return p}initializeGraphic(t){return Z()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return Z()}onCursorEdgeChanged(t){return Z()}onVertexAdd(t){Vt(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Ne(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){Vt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),f.activeEdge):this.removeHandles(f.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),f.outline):this.removeHandles(f.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),f.regularVertices):this.removeHandles(f.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),f.activeVertex):this.removeHandles(f.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(ot)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?tt(this._tooltipsContext):null}};n([r()],d.prototype,"_coordinateFormatterLoadTask",void 0),n([r()],d.prototype,"_createOperationGeometry",void 0),n([r()],d.prototype,"_tooltipsContext",null),n([r({value:!0})],d.prototype,"centered",null),n([r()],d.prototype,"cursor",null),n([r({nonNullable:!0})],d.prototype,"defaultZ",void 0),n([r({constructOnly:!0})],d.prototype,"directionOptions",void 0),n([r()],d.prototype,"drawOperation",void 0),n([r()],d.prototype,"elevationLockOnVertexAddDisabled",void 0),n([r({value:!0})],d.prototype,"enabled",null),n([r({value:!0})],d.prototype,"forceUniformSize",null),n([r({constructOnly:!0})],d.prototype,"geometryType",void 0),n([r()],d.prototype,"graphic",null),n([r({constructOnly:!0})],d.prototype,"graphicProperties",void 0),n([r()],d.prototype,"graphicSymbol",null),n([r({constructOnly:!0})],d.prototype,"hasZ",void 0),n([r({constructOnly:!0})],d.prototype,"geometryToPlace",void 0),n([r()],d.prototype,"mode",null),n([r()],d.prototype,"snappingManager",void 0),n([r()],d.prototype,"snapToScene",void 0),n([r()],d.prototype,"tooltip",void 0),n([r()],d.prototype,"tooltipInfos",void 0),n([r({constructOnly:!0,type:Ot})],d.prototype,"sketchOptions",void 0),n([r()],d.prototype,"updating",null),n([r({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0),n([r({constructOnly:!0})],d.prototype,"automaticAreaMeasurementUtils",void 0),n([r({constructOnly:!0})],d.prototype,"automaticLengthMeasurementUtils",void 0),n([r({constructOnly:!0})],d.prototype,"undoRedo",null),n([r()],d.prototype,"activeTooltipInfo",null),d=n([O("esri.views.draw.DrawGraphicTool")],d);const ot=Symbol("create-operation-graphic"),f={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function ii(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const oi=48;function ni(t,e){return At(t,e,!1)}function ri(t,e){return At(t,e,!0)}function At(t,e,i){if(t instanceof Te){if(t.operation instanceof Ie)return si(t.operation,e,i),!0;if(t.operation instanceof Me)return ai(t.operation,e,i),!0;if(t.operation instanceof Re)return li(t.operation,e,i),!0}return!1}function si(t,e,i=!1){const o=i?-1:1,s=Yt(o*t.dx,o*t.dy,o*t.dz);q(e.origin,e.origin,s),j(e)}function ai(t,e,i=!1){const o=i?-t.angle:t.angle;mt(e.basis1,e.basis1,dt,o),mt(e.basis2,e.basis2,dt,o),j(e)}function li(t,e,i=!1){const o=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;ft(e.basis1,e.basis1,o),ft(e.basis2,e.basis2,s),xt(e.origin,e.origin,t.origin,t.axis1,o),xt(e.origin,e.origin,t.origin,t.axis2,s),j(e)}function ci(t,e,i,o,s=!1){o||(o=Ve());const u=z(H.get(),t[1],-t[0]),l=z(H.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=z(H.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=H.get(),h=e.allVertices;h.forEach(({pos:p})=>{z(a,_t(t,p),_t(u,p)),ke(l,l,a),xe(c,c,a)});const y=1e-6,g=z(H.get(),c[0]-l[0]<y?i/2:0,c[1]-l[1]<y?i/2:0);be(l,l,g),Ue(c,c,g);const v=s?h.reduce((p,V)=>p+(V.pos[2]??0),0)/h.length:0;return kt(o.basis1,t,(c[0]-l[0])/2),kt(o.basis2,u,(c[1]-l[1])/2),gt(o.origin,l[0]*t[0]+l[1]*u[0],l[0]*t[1]+l[1]*u[1],v),q(o.origin,o.origin,o.basis1),q(o.origin,o.origin,o.basis2),j(o),o}export{d as E,ii as F,ci as S,ri as T,ni as d};
