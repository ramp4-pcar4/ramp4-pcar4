import{_ as o,X as s,Y as M,N as Z,O as oe,a8 as Ae,bJ as ue,eM as $e,cu as at,gX as hi,gW as ui,jW as gi,n9 as Et,na as Pt,nb as yi,nc as mi,nd as It,bW as vi,eE as ct,cr as bi,a as wi,cl as Ue,gV as fi,aH as se,V as _i,ai as Ti,i as ge,h6 as ki,av as x,l as Ge,kq as We,h3 as dt,ax as pt,eC as Dt,fc as U,ne as xi,nf as Ci,ng as Mi,hy as Ke,cy as Si,s as Li,gx as Oi,aw as Ei,fd as At,nh as Pi,ni as Ii,nj as Di,nk as Ai,nl as Ri,nm as Fi,nn as Bi,cE as Gi,cF as zi,no as ze,np as Vi,cO as Ni,nq as Hi,fy as $i,fz as Ui,fN as Wi,as as Ki,fQ as Rt,fR as ji,fS as qi,fq as Ft,mO as Qi,e8 as Yi,e9 as Xi,iA as Zi,d9 as je,d5 as Bt,d7 as Ji,bP as ke,aG as xe,F as eo,hg as to}from"./main-6gYsRPh_.js";import{u as ht}from"./draw-store-DiyYGnDy.js";import io from"./GraphicsLayer-BPINIw3R.js";import"./intl-B5LjarAi.js";import{Q as oo,w as Gt,o as zt,S as Vt,a3 as so,a4 as no,m as Nt}from"./SketchViewModel-oZSiDZG2.js";import{n as p,p as lo,B as ne,a as ye,b as Ht,e as me,j as ro}from"./jsxFactory-B_nmUb2n.js";import{a as qe,m as ao,e as ut}from"./utils-BaVnR4_x.js";import{o as Qe}from"./layerViewUtils-Cpr0CNY9.js";import{d as $t}from"./asyncUtils-K8P6uJAi.js";import{r as co,o as po}from"./drapedUtils-BxupuBK2.js";import{c as ho}from"./messages-CmaHiSwa.js";import{e as Ut}from"./utils-C0LvbFCo.js";import{e as Wt,a as uo}from"./widget-B63TKHPO.js";import{s as Kt}from"./substitute-C0v-bl_n.js";const go=(e,t,i)=>{const n=e[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((l,r)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(r.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==i?". Note that variables only represent file names one level deep.":""))))})};let W=class extends Z{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};o([s({type:Boolean,nonNullable:!0})],W.prototype,"colorSelection",void 0),o([s({type:Boolean,nonNullable:!0})],W.prototype,"dynamicScaleToggle",void 0),o([s({type:Boolean,nonNullable:!0})],W.prototype,"gridEnabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],W.prototype,"numericInputs",void 0),o([s({type:Boolean,nonNullable:!0})],W.prototype,"gridSnapEnabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],W.prototype,"lineIntervalInput",void 0),o([s({type:Boolean,nonNullable:!0})],W.prototype,"outOfScaleWarning",void 0),o([s({type:Boolean,nonNullable:!0})],W.prototype,"placementButtons",void 0),o([s({type:Boolean,nonNullable:!0})],W.prototype,"rotateWithMapToggle",void 0),W=o([M("esri.widgets.support.GridControls.VisibleElements")],W);const gt=W;let K=class extends Z{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new gt({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};o([s({type:Boolean,nonNullable:!0})],K.prototype,"enabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],K.prototype,"featureEnabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],K.prototype,"gridEnabledToggle",void 0),o([s({type:Boolean,nonNullable:!0})],K.prototype,"header",void 0),o([s({type:Boolean,nonNullable:!0})],K.prototype,"layerList",void 0),o([s({type:Boolean,nonNullable:!0})],K.prototype,"gridControls",void 0),o([s({type:gt,nonNullable:!0})],K.prototype,"gridControlsElements",void 0),o([s({type:Boolean,nonNullable:!0})],K.prototype,"layerListToggleLayersButton",void 0),o([s({type:Boolean,nonNullable:!0})],K.prototype,"selfEnabledToggle",void 0),K=o([M("esri.widgets.support.SnappingControls.VisibleElements")],K);const Ye=K;let z=class extends Z{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1,this.text=!1}};o([s({type:Boolean,nonNullable:!0})],z.prototype,"point",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"polyline",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"polygon",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"rectangle",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"circle",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"multipoint",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"mesh",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"freehandPolyline",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"freehandPolygon",void 0),o([s({type:Boolean,nonNullable:!0})],z.prototype,"text",void 0),z=o([M("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],z);let Ce=class extends Z{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};o([s({nonNullable:!0})],Ce.prototype,"rectangle-selection",void 0),o([s({nonNullable:!0})],Ce.prototype,"lasso-selection",void 0),o([s({nonNullable:!0})],Ce.prototype,"custom-selection",void 0),Ce=o([M("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],Ce);let R=class extends Z{constructor(e){super(e),this.createTools=new z,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new Ce,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new Ye,this.tooltipsToggle=!0,this.undoRedoMenu=!0}};o([s({type:z,nonNullable:!0})],R.prototype,"createTools",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"directionModePicker",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"duplicateButton",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"deleteButton",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"selectionCountLabel",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"labelsToggle",void 0),o([s({type:Ce,nonNullable:!0})],R.prototype,"selectionTools",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"settingsMenu",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"snappingControls",void 0),o([s({type:Ye,nonNullable:!0})],R.prototype,"snappingControlsElements",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"tooltipsToggle",void 0),o([s({type:Boolean,nonNullable:!0})],R.prototype,"undoRedoMenu",void 0),R=o([M("esri.widgets.Sketch.VisibleElements")],R);const P={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},jt={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function qt(e,t){return e.vnodeSelector===t?[e]:e.children?.flatMap(i=>qt(i,t))??[]}const yt=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(n){const l=this._get("measurementManager");n!==l&&(l&&l.managedElements.remove(this),this._set("measurementManager",n),n?.managedElements.add(this))}set budgetedLength(n){this.budgetedLength!==n&&(this._set("budgetedLength",n),this.scheduleRender())}get actionChildren(){return this.children?.flatMap(n=>qt(n,"calcite-action"))??[]}get activeChildElement(){const n=this.actionChildren.find(l=>l.properties?.active===!0);return n?(this._set("lastActiveKey",n.properties?.key),n):this.lastActiveKey?this.actionChildren.find(l=>l.properties?.key===this.lastActiveKey):void 0}_handleClick(n){n?.dataset&&"dataset"in n&&n.dataset.actionKey&&(this.lastActiveKey=n.dataset.actionKey)}};return o([s()],i.prototype,"priority",void 0),o([s()],i.prototype,"measurementManager",null),o([s()],i.prototype,"budgetedLength",null),o([s()],i.prototype,"actionChildren",null),o([s()],i.prototype,"activeChildElement",null),o([s()],i.prototype,"scale",void 0),o([s()],i.prototype,"slot",void 0),o([s()],i.prototype,"lastActiveKey",void 0),o([s()],i.prototype,"layout",void 0),i=o([M("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],i),i},Qt=Symbol("on-resize-handle-key");let Me=class extends yt(ne){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return[this.layout==="horizontal"?this._measuredWidth:this._measuredHeight]}render(){return p("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles(lo(this._measuredElement,()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0}),Qt)},afterRemoved:()=>this.removeHandles(Qt)},this.children)}};o([s()],Me.prototype,"_measuredWidth",void 0),o([s()],Me.prototype,"_measuredHeight",void 0),o([s()],Me.prototype,"lengthOptions",null),o([s()],Me.prototype,"_measuredElement",void 0),Me=o([M("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],Me);let Se=class extends yt(ne){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return ye({action:()=>import("./index-BJaYRsNY.js"),"action-group":()=>import("./index-DGnH-ftj.js").then(e=>e.i),"action-menu":()=>import("./index-Dyjb1Jci.js").then(e=>e.i)})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?P.groupSeparator+P.action[t]*Math.min(e.length,2):P.groupSeparator+P.action[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:i,allowCollapse:n,priority:l}=this,r=[i];if(e.length<=2||!n||l<1)return r;for(let a=1;a<e.length-1;a++)r.push(i+P.action[t]*a);return r}render(){if(!this.actionChildren.length)return p(Ht,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:i,layout:n,slot:l,scale:r}=this,a=Math.floor(e/P.action[r]),d=[],c=[];if(a>=t.length)d.push(...t);else{const u=i??d.at(0);if(d.push(...t.slice(0,a-1)),c.push(...t.slice(a-1)),u&&c.includes(u)){const[v]=c.splice(c.indexOf(u),1),g=d.pop();d.push(v),g&&c.unshift(g)}}return p("calcite-action-group",{key:"overflow-button-group",layout:n,onclick:u=>this._handleClick(u.target),slot:l},d.map(u=>this._renderManagedAction(u)),c.length>0?p("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},p("calcite-action",{icon:jt.overflow,key:"split-button-dropdown-trigger",scale:r,slot:"trigger",text:this.messagesCommon.more}),c.map(u=>this._renderManagedAction(u))):void 0)}_renderManagedAction(e){return p("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};o([s()],Se.prototype,"allowCollapse",void 0),o([s()],Se.prototype,"minimumLength",null),o([s(),me("esri/t9n/common")],Se.prototype,"messagesCommon",void 0),o([s()],Se.prototype,"lengthOptions",null),Se=o([M("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],Se);let ve=class extends Z{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new oe,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((e,t)=>t.priority-e.priority)}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:i}=this;let n=0;for(const l of i){const r=l.lengthOptions[0];e.set(l,r),n+=r}for(const l of i)for(;n<t;){const r=e.get(l);if(!r)break;const a=l.lengthOptions.find(c=>c>r);if(!a)break;const d=n-r+a;if(d>t)break;e.set(l,a),n=d}for(const[l,r]of e)l.budgetedLength=r}_measure(){const e=this.measuredElement;this.availableLength=e?this.layout==="horizontal"?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};o([s()],ve.prototype,"measuredElement",void 0),o([s()],ve.prototype,"managedElements",void 0),o([s()],ve.prototype,"_sortedElements",null),o([s()],ve.prototype,"availableLength",void 0),o([s()],ve.prototype,"layout",void 0),ve=o([M("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],ve);const yo={splitButtonBase:"esri-split-button--split-part"};let Le=class extends yt(ne){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return ye({action:()=>import("./index-BJaYRsNY.js"),"action-group":()=>import("./index-DGnH-ftj.js").then(e=>e.i),"action-menu":()=>import("./index-Dyjb1Jci.js").then(e=>e.i)})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const e=this.actionChildren;return e.length?e.length===1?P.action[this.scale]+P.groupSeparator:this.allowCollapse?P.action[this.scale]+P.splitButtonPart[this.layout][this.scale]+P.groupSeparator:P.action[this.scale]*e.length+P.groupSeparator:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:i,scale:n,priority:l,allowCollapse:r}=this;if(e.length<2||l<0||!r)return[t];const a=P.groupSeparator+P.action[n]*e.length;return[P.groupSeparator+P.action[n]+P.splitButtonPart[i][n],a]}render(){if(!this.actionChildren.length)return p(Ht,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:i,layout:n,slot:l,allowCollapse:r}=this,a=!r||e.length<2||i>t;return p("calcite-action-group",{key:"split-button-group",layout:n,onclick:d=>this._handleClick(d.target),slot:l},a?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:i,scale:n,messagesCommon:l}=this,r=e??i.at(0);if(!r)return;const a=i.filter(d=>d!==r);return[this._renderManagedAction(r),p("calcite-action-menu",{key:"split-button-dropdown",label:l.more,overlayPositioning:"fixed",placement:t==="horizontal"?"bottom-end":"right-end"},p("calcite-action",{class:`${yo.splitButtonBase}--${t}--${this.scale}`,compact:t==="horizontal",icon:jt.splitButton[t],key:"split-button-dropdown-trigger",scale:n,slot:"trigger",text:l.more}),a?.map(d=>this._renderManagedAction(d)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){return p("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};o([s()],Le.prototype,"minimumLength",null),o([s()],Le.prototype,"allowCollapse",void 0),o([s()],Le.prototype,"lengthOptions",null),o([s(),me("esri/t9n/common")],Le.prototype,"messagesCommon",void 0),Le=o([M("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],Le);const j="esri-responsive-toolbar",q={rulerBase:`${j}__ruler`,rulerBarHorizontal:`${j}__ruler--bar`,rulerBarVertical:`${j}__ruler--bar--vertical`,rulerPadVertical:`${j}__ruler--pad--vertical`,rulerPadHorizontal:`${j}__ruler--pad--horizontal`,bar:`${j}__bar`,barHorizontal:`${j}__bar--horizontal`,barVertical:`${j}__bar--vertical`,pad:`${j}__pad`,padVertical:`${j}__pad--vertical`,padHorizontal:`${j}__pad--horizontal`};let J=class extends ne{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new ve,this._managedWidgets=new Map}loadDependencies(){return ye({"action-bar":()=>import("./index-CYmx6QLI.js")})}destroy(){this._measurementManager=Ae(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}get _barClasses(){const e=this.barStyle==="docked",t=this.layout==="vertical";return{[q.barHorizontal]:e&&!t,[q.barVertical]:e&&t,[q.bar]:e,[q.padHorizontal]:!e&&!t,[q.padVertical]:!e&&t,[q.pad]:!e}}render(){const{layout:e,scale:t,barStyle:i}=this,n={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},l=i==="docked"?e==="vertical"?q.rulerBarVertical:q.rulerBarHorizontal:e==="horizontal"?q.rulerPadHorizontal:q.rulerPadVertical;return p("div",null,p("div",{afterCreate:r=>{this._measurementManager?.connect(r)},class:this.classes(q.rulerBase,l)}),p("calcite-action-bar",{...n,classes:this._barClasses,floating:i!=="docked",overflowActionsDisabled:!0},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter(n=>n.properties?.key!==void 0&&"group-kind"in n.properties),t=new Set,i=e.map(n=>{const l=n.properties,r=l.key;t.add(r);const a=this.barStyle==="docked"?l.slot??void 0:void 0,d=l.priority??0,c=l["group-kind"]??"overflow-group",u=l["allow-collapse"]??!0,v=this._managedWidgets.get(r);if(v)return v.children=n.children,v.priority=d,"allowCollapse"in v&&(v.allowCollapse=u),v.slot=a,v.layout=this.layout,v.scale=this.scale,v.measurementManager=this._measurementManager,v;const g={scale:this.scale,priority:d,measurementManager:this._measurementManager,children:n.children,slot:a,layout:this.layout};switch(c){case"split-button":{const f=new Le({...g,allowCollapse:u});return this._managedWidgets.set(r,f),f}case"overflow-group":{const f=new Se({...g,allowCollapse:u});return this._managedWidgets.set(r,f),f}case"measured-content":{const f=new Me({...g});return this._managedWidgets.set(r,f),f}}}).filter(ue);return Array.from(this._managedWidgets.keys()).filter(n=>!t.has(n)).forEach(n=>{this._managedWidgets.get(n)?.destroy(),this._managedWidgets.delete(n)}),this._measurementManager?.allocate(),i.map(n=>n.render())}};o([s()],J.prototype,"scale",void 0),o([s({value:"horizontal"})],J.prototype,"layout",null),o([s()],J.prototype,"barStyle",void 0),o([s()],J.prototype,"_measurementManager",void 0),o([s()],J.prototype,"_managedWidgets",void 0),o([s()],J.prototype,"_barClasses",null),J=o([M("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],J);async function mo(e){const{returnFeatureTitleFields:t,returnGeometry:i,selector:n,signal:l,sources:r,view:a}=e;if(!r?.length)return[];const{layers:d,layerViews:c,graphicsLayers:u}=vo(r),v=[];return await $e(at(Promise.all([fo({candidates:v,layers:d,returnFeatureTitleFields:t,returnGeometry:i,selector:n,signal:l,view:a}),bo({candidates:v,layerViews:c,returnGeometry:i,selector:n,signal:l,view:a}),xo({candidates:v,graphicsLayers:u,selector:n})]),l)),v}function vo(e){const t=[],i=[],n=[];return e.forEach(l=>{hi(l)||ui(l)||gi(l)?t.push(l):(Et(l)||Pt(l))&&l.layers?.length?t.push(...l.layers.toArray()):yi(l)&&l.sublayers?.length?n.push(...l.sublayers.toArray()):mi(l)?n.push(l):Qe(l)&&i.push(l)}),{layers:t,layerViews:i,graphicsLayers:n}}async function bo(e){const{candidates:t,layerViews:i,returnGeometry:n,selector:l,signal:r,view:a}=e;l.type!=="point"?await at(Promise.allSettled(i.map(async d=>{const c=To(d,l,a,n),u=await d.queryFeatures(c,{signal:r});It(t,u.features)})),r):await wo({candidates:t,layerViews:i,selector:l,view:a})}async function wo({candidates:e,layerViews:t,selector:i,view:n}){const l=n.toScreen(i);if(!l)return;const r=t.map(d=>d.layer),{results:a}=await n.hitTest(l,{include:r});a.forEach(d=>{"graphic"in d&&d.graphic&&e.push(d.graphic)})}async function fo(e){const{candidates:t,layers:i,returnFeatureTitleFields:n,returnGeometry:l,selector:r,signal:a,view:d}=e;await at(Promise.allSettled(i.map(async c=>{if("isTable"in c&&c.isTable)return;const u=ko(c,r,d,n,l),v=await c.queryFeatures(u,{signal:a});It(t,v.features)})),a)}function Yt(e,t,i){return e.type==="point"?co(e,"renderer"in t?po({renderer:t.renderer}):0,i):e}function _o(e,t,i){const{fields:n,fieldsIndex:l}=e,r=new Set([e.objectIdField]);"globalIdField"in e&&e.globalIdField!=null&&l.has(e.globalIdField)&&r.add(l.get(e.globalIdField).name);const a="displayField"in e?e.displayField:null,d=vi({displayField:a,fields:n});if(d!=null&&l.has(d)&&r.add(d),"subtypeField"in e&&e.subtypeField!=null){const c=l.get(e.subtypeField)?.name;if(c!=null&&r.add(c),"utilityNetworks"in t.map&&t.map.utilityNetworks?.length){const u=l.get("assetgroup");u?.name&&r.add(u.name);const v=l.get("assettype");v?.name&&r.add(v.name)}}return(i||t.requiredFieldsOptions.featureTitleFields)&&"featureTitleFields"in e&&e.featureTitleFields&&e.featureTitleFields.forEach(c=>r.add(c)),Array.from(r.values())}function To(e,t,i,n=!0){const l=e.createQuery();return l.outFields=["*"],l.geometry=Yt(t,e.layer,i),l.returnGeometry=n,l.outSpatialReference=i.spatialReference,l}function ko(e,t,i,n=!1,l=!0){const r=e.createQuery();return r.outFields=_o(e,i,n),r.geometry=Yt(t,e,i),r.returnGeometry=l,r.outSpatialReference=i.spatialReference,r}async function xo(e){const{candidates:t,graphicsLayers:i,selector:n}=e,l=i.flatMap(a=>a.graphics.toArray())??[];if(!l?.length||!n)return;const r=await import("./intersectsOperator-DJ1MSacb.js").then(a=>a.i);r.accelerateGeometry(n),l.forEach(a=>{a.geometry&&a.geometry.type!=="mesh"&&r.execute(n,a.geometry)&&t.push(a)})}const Co=100;let S=class extends ct{constructor(e){super(e),this._completed=!1,this._isConstraintKeyDown=!1,this._processTask=null,this.createTool="rectangle",this.mode=null,this.persistSelection=!0,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selection=new oe,this.selectionManager=null,this.selectOnComplete=!0,this.sources=null,this.toolName="",this.type="add",this._process=bi(async(t,i)=>{const{callback:n,selector:l,completed:r}=t,a=$t(async d=>{const{effectiveSelectionManager:c,returnFeatureTitleFields:u,returnGeometry:v,selection:g,sources:f,view:ce}=this;if(!(!f?.length&&!c.sources.length)&&ce){if(l&&f!=null){const V=await mo({returnFeatureTitleFields:u,returnGeometry:v,selector:l,signal:d,sources:f,view:ce});if(g.removeAll(),g.addMany(V),r&&this.persistSelection)switch(this.effectiveType){case"remove":c.updateSelection({current:[],added:[],removed:V});break;case"replace":c.clear(),c.updateSelection({current:V,added:[],removed:[]});break;default:c.updateSelection({current:V,added:[],removed:[]})}}n&&n()}else g.removeAll()});return wi(i,()=>a.abort()),this._processTask=a,a.promise},Co),this._onOperationFinish=this._onOperationFinish.bind(this)}initialize(){this._setup()}get _defaultMode(){return this.createTool==="polygon"?"click":"hybrid"}get _selectionArea(){const e=this._tool.coordinates;if(e.length===0)return;const t=ki(),i=this.view.spatialReference,n=r=>{t.x=r[0],t.y=r[1];const a=this.view.toMap(t);return[a?.x??0,a?.y??0]};if(e.length===1||e.every(([r,a])=>r===e[0][0]&&a===e[0][1])){const[r,a]=n(e[0]);return new Ue({x:r,y:a,spatialReference:i})}const l=e.map(n);if(l.length!==0)return fi(l)||l.reverse(),new se({spatialReference:i,rings:[l]})}get completed(){return this._completed}get effectiveSelectionManager(){return this.selectionManager??this.view.selectionManager}get effectiveType(){const e=this.type??"add";if(this._isConstraintKeyDown)switch(e){case"add":return"remove";case"remove":case"replace":return"add";default:return e}return e}get processingFinalSelection(){return!(!this._processTask||!this._tool?.drawOperation?.isCompleted)}cancel(){this.selection.removeAll(),this._onOperationFinish(!0)}destroy(){this._toolImportController=_i(this._toolImportController)}async _setup(){const{createTool:e,view:t}=this;if(await t.whenReady(),this.destroyed||this._toolImportController)return;const i=new AbortController;this._toolImportController=i;const[n,l]=await Promise.all([import("./DrawScreenTool-B0IS28uB.js"),oo()]);if(i.signal.aborted)return;const r=Symbol();try{this._tool=new n.DrawScreenTool({view:t,mode:this.mode??this._defaultMode,geometryType:e,cursor:e==="point"?"default":"crosshair",automaticLengthMeasurementUtils:l})}finally{this._toolImportController=null}this._tool?(this.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>{this._syncConstraintKeyDown(),$e(this._process({selector:this._selectionArea}))}),r),this._syncConstraintKeyDown(),this.addHandles([t.on("key-down",a=>{if(!a.repeat)switch(this._syncConstraintKeyDown(),a.key){case qe.constraint:this._tool.uniformSizeToggled=!0,a.stopPropagation();break;case qe.center:this._tool.centeredToggled=!0,a.stopPropagation()}}),t.on("key-up",a=>{switch(this._syncConstraintKeyDown(),a.key){case qe.constraint:this._tool.uniformSizeToggled=!1,a.stopPropagation();break;case qe.center:this._tool.centeredToggled=!1,a.stopPropagation()}}),this.selection.on("change",({added:a,removed:d})=>this.emit("selection-change",{operationType:this.effectiveType,added:a,removed:d})),this._tool.on("complete",async a=>{this._syncConstraintKeyDown(),this.removeHandles(r),a.aborted?this.cancel():(this._tool.cursor="progress",await this._process({selector:this._selectionArea,callback:this._onOperationFinish,completed:!0}))})],r),this.addHandles(Ti(()=>t.tools.remove(this._tool))),t.addAndActivateTool(this._tool)):ge.getLogger(this).warn("Unable to import Draw module. SelectionOperation failed to load.")}_syncConstraintKeyDown(){const{inputManager:e}=this.view;this._isConstraintKeyDown=ao.invertType.some(t=>e.isModifierKeyDown(t))}_onOperationFinish(e=!1){this.removeAllHandles(),this._processTask?.abort(),this.emit("complete",{aborted:e,operationType:this.effectiveType,selection:this.selection.toArray(),toolName:this.toolName}),this._completed=!0}};o([s()],S.prototype,"_completed",void 0),o([s()],S.prototype,"_defaultMode",null),o([s()],S.prototype,"_isConstraintKeyDown",void 0),o([s()],S.prototype,"_processTask",void 0),o([s()],S.prototype,"_selectionArea",null),o([s()],S.prototype,"completed",null),o([s({constructOnly:!0})],S.prototype,"createTool",void 0),o([s()],S.prototype,"effectiveSelectionManager",null),o([s()],S.prototype,"effectiveType",null),o([s({constructOnly:!0})],S.prototype,"mode",void 0),o([s()],S.prototype,"persistSelection",void 0),o([s()],S.prototype,"processingFinalSelection",null),o([s()],S.prototype,"returnFeatureTitleFields",void 0),o([s()],S.prototype,"returnGeometry",void 0),o([s({readOnly:!0})],S.prototype,"selection",void 0),o([s({constructOnly:!0})],S.prototype,"selectionManager",void 0),o([s({constructOnly:!0})],S.prototype,"selectOnComplete",void 0),o([s()],S.prototype,"sources",void 0),o([s({constructOnly:!0})],S.prototype,"toolName",void 0),o([s()],S.prototype,"type",void 0),o([s({constructOnly:!0})],S.prototype,"view",void 0),S=o([M("esri.widgets.support.Selector2D.SelectionOperation")],S);const Mo=S;let L=class extends ct{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.continuousSelectionEnabled=!1,this.defaultLassoToolOptions={createTool:"polygon",mode:"hybrid",toolName:"lasso"},this.defaultOperationType="add",this.defaultPointToolOptions={createTool:"point",toolName:"point"},this.defaultRectangleToolOptions={createTool:"rectangle",toolName:"rectangle"},this.layerViewPreferenceEnabled=!0,this.persistSelection=!0,this.selectionManager=null,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selectOnComplete=!0,this.sources=null,this.toolConfigs=[]}initialize(){this.addHandles([x(()=>this.effectiveSources,e=>{this.activeOperation&&(this.activeOperation.sources=e)}),x(()=>this.defaultOperationType,e=>{this.activeOperation&&(this.activeOperation.type=e)})])}destroy(){this.activeOperation?.cancel(),this.activeOperation?.destroy(),this._operationHandlesGroup=Ge(this._operationHandlesGroup)}get effectiveSelectionManager(){return this.selectionManager??this.view?.selectionManager}get effectiveSources(){const{layerViewPreferenceEnabled:e,sources:t,view:i}=this,n=t??this.effectiveSelectionManager?.sources;if(!n?.length)return[];const l=[];return n.forEach(r=>{if(Qe(r))l.push(r);else if(Et(r)||Pt(r))(r.layers||[]).forEach(a=>{const d=i?Gt(i,a):void 0,c=e&&Qe(d)?d:a;l.push(c)});else if(e){const a=i?Gt(i,r):void 0,d=Qe(a)?a:r;l.push(d)}else l.push(r)}),l}get layers(){return We(ge.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){We(ge.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){return this.activeOperation?"active":this.view?.ready&&this.effectiveSources.length?"ready":"disabled"}activate(e){const{state:t}=this,i=e?.view||this.view,n=e?.sources||this.effectiveSources;if(t==="disabled"||!i)return void ge.getLogger(this).warn("Unable to start selection operation.");t==="active"&&this.cancel();const l=new CustomEvent("before-activate",{cancelable:!0,detail:{toolName:e?.toolName??null}});if(this.emit("before-activate",l),l.defaultPrevented)return;const r={type:this.defaultOperationType,persistSelection:this.persistSelection,returnFeatureTitleFields:this.returnFeatureTitleFields,returnGeometry:this.returnGeometry,selectOnComplete:this.selectOnComplete,selectionManager:this.effectiveSelectionManager,...e,sources:n,view:i},a=new Mo({...r});return this._operationHandlesGroup=dt([a.on("selection-change",d=>this.emit("selection-change",d)),a.once("complete",d=>this._onOperationComplete(d,r))]),this._set("activeOperation",a),a}activateTool(e){this.cancel();const t=this._getToolOptions(e);if(t)return this.activate(t);ge.getLogger(this).warn("Unable to activate tool: unable to determine options.")}cancel(){this.activeOperation?.cancel(),this._set("activeOperation",null)}toggleTool(e){const{activeOperation:t}=this;if(t){const i=t.toolName;if(this.cancel(),i===e)return}return this.activateTool(e)}_onOperationComplete(e,t){const i=this.activeOperation?.type??e.operationType;this._operationHandlesGroup=Ge(this._operationHandlesGroup),this.activeOperation?.destroy(),this._set("activeOperation",null),this.emit("complete",e),this.continuousSelectionEnabled&&!e.aborted&&this.activate({...t,type:i})}_getToolOptions(e){return this.toolConfigs.find(t=>t.toolName===e)||(e==="lasso"?this.defaultLassoToolOptions:e==="point"?this.defaultPointToolOptions:e==="rectangle"?this.defaultRectangleToolOptions:void 0)}};o([s({readOnly:!0})],L.prototype,"activeOperation",void 0),o([s()],L.prototype,"continuousSelectionEnabled",void 0),o([s()],L.prototype,"defaultLassoToolOptions",void 0),o([s()],L.prototype,"defaultOperationType",void 0),o([s()],L.prototype,"defaultPointToolOptions",void 0),o([s()],L.prototype,"defaultRectangleToolOptions",void 0),o([s()],L.prototype,"effectiveSelectionManager",null),o([s()],L.prototype,"effectiveSources",null),o([s()],L.prototype,"layers",null),o([s()],L.prototype,"layerViewPreferenceEnabled",void 0),o([s()],L.prototype,"persistSelection",void 0),o([s()],L.prototype,"selectionManager",void 0),o([s()],L.prototype,"returnFeatureTitleFields",void 0),o([s()],L.prototype,"returnGeometry",void 0),o([s()],L.prototype,"selectOnComplete",void 0),o([s()],L.prototype,"sources",void 0),o([s({readOnly:!0})],L.prototype,"state",null),o([s()],L.prototype,"toolConfigs",void 0),o([s()],L.prototype,"view",void 0),L=o([M("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],L);const So=L;let le=class extends Z{constructor(e){super(e),this.chip=!0,this.lassoTool=!0,this.operationTypeControls=!0,this.pan=!0,this.pointTool=!0,this.rectangleTool=!0}};o([s({type:Boolean,nonNullable:!0})],le.prototype,"chip",void 0),o([s({type:Boolean,nonNullable:!0})],le.prototype,"lassoTool",void 0),o([s({type:Boolean,nonNullable:!0})],le.prototype,"operationTypeControls",void 0),o([s({type:Boolean,nonNullable:!0})],le.prototype,"pan",void 0),o([s({type:Boolean,nonNullable:!0})],le.prototype,"pointTool",void 0),o([s({type:Boolean,nonNullable:!0})],le.prototype,"rectangleTool",void 0),le=o([M("esri.widgets.support.SelectionToolbar.VisibleElements")],le);const mt=le,vt="esri-selection-toolbar",Xe={base:vt,container:`${vt}__container`,toolButton:`${vt}__tool-button`};let _=class extends ne{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.availableOperationTypes=["replace","add","remove"],this.disabled=!1,this.layout="horizontal",this.messages=null,this.scale="s",this.viewModel=new So,this.visibleElements=new mt}initialize(){this._viewModelHandlesGroup=dt([pt(()=>this.viewModel,"before-activate",e=>this.emit("before-activate",e)),pt(()=>this.viewModel,"complete",e=>this.emit("complete",e)),pt(()=>this.viewModel,"selection-change",e=>this.emit("selection-change",e))])}destroy(){this._viewModelHandlesGroup=Ge(this._viewModelHandlesGroup)}loadDependencies(){return ye({action:()=>import("./index-BJaYRsNY.js"),"action-bar":()=>import("./index-CYmx6QLI.js"),"action-group":()=>import("./index-DGnH-ftj.js").then(e=>e.i),chip:()=>import("./index-BH6atTkj.js"),dropdown:()=>import("./index-B9zngf-Y.js"),"dropdown-item":()=>import("./index-BlYMsfZG.js"),"dropdown-group":()=>import("./index-kZDumf30.js"),icon:()=>import("./index-Bk9GZ3D-.js").then(e=>e.i)})}get _effectiveDisabled(){return this.disabled||this.state==="disabled"}get _effectiveOperationType(){return this.activeOperation?.effectiveType||this.defaultOperationType}get activeOperation(){return this.viewModel.activeOperation}get continuousSelectionEnabled(){return this.viewModel.continuousSelectionEnabled}set continuousSelectionEnabled(e){this.viewModel.continuousSelectionEnabled=e}get defaultLassoToolOptions(){return this.viewModel.defaultLassoToolOptions}set defaultLassoToolOptions(e){this.viewModel.defaultLassoToolOptions=e}get defaultOperationType(){return this.viewModel.defaultOperationType}set defaultOperationType(e){this.viewModel.defaultOperationType=e}get defaultPointToolOptions(){return this.viewModel.defaultPointToolOptions}set defaultPointToolOptions(e){this.viewModel.defaultPointToolOptions=e}get defaultRectangleToolOptions(){return this.viewModel.defaultRectangleToolOptions}set defaultRectangleToolOptions(e){this.viewModel.defaultRectangleToolOptions=e}get effectiveSelectionManager(){return this.viewModel.effectiveSelectionManager}get effectiveSources(){return this.viewModel.effectiveSources}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return We(ge.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){We(ge.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get persistSelection(){return this.viewModel.persistSelection}set persistSelection(e){this.viewModel.persistSelection=e}get returnFeatureTitleFields(){return this.viewModel.returnFeatureTitleFields}set returnFeatureTitleFields(e){this.viewModel.returnFeatureTitleFields=e}get returnGeometry(){return this.viewModel.returnGeometry}set returnGeometry(e){this.viewModel.returnGeometry=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get selectionManager(){return this.viewModel.selectionManager}set selectionManager(e){this.viewModel.selectionManager=e}get state(){return this.viewModel.state}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get toolConfigs(){return this.viewModel.toolConfigs}set toolConfigs(e){this.viewModel.toolConfigs=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visibleToolCount(){const{visibleElements:e}=this;return this.toolConfigs.length+(e.lassoTool?1:0)+(e.rectangleTool?1:0)}activate(e){if(this.cancel(),!this._effectiveDisabled)return this.viewModel.activate(e)}activateTool(e){if(!this._effectiveDisabled)return this.viewModel.activateTool(e)}cancel(){this.viewModel.cancel()}toggleTool(e){if(!this._effectiveDisabled)return this.viewModel.toggleTool(e)}render(){return p("div",{"aria-label":this.label,class:this.classes(Xe.base,ut.widget)},p("div",{class:Xe.container},p("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",overflowActionsDisabled:!0,scale:this.scale},this._renderOperationTypeControls(),this._renderToolsGroup(),this._renderChip())))}_renderToolsGroup(){return p("calcite-action-group",{key:"tools-group"},this._renderDefaultTools(),this._renderCustomTools())}_renderDefaultTools(){return[this._renderPanAction(),this._renderPointTool(),this._renderRectangleTool(),this._renderLassoTool()]}_renderPanAction(){if(!this.visibleElements.pan)return;const e=this.messages.pan,t=`${this.id}-tool-pan`;return this._renderAction({active:!this.activeOperation,disabled:this._effectiveDisabled,icon:"pan",id:t,key:t,onclick:()=>this.cancel(),text:e,title:e})}_renderChip(){if(!this.visibleElements.chip)return;const{effectiveSelectionManager:e}=this,t=e?.count??0,i=ho(t);return p("calcite-chip",{appearance:"outline",closable:t>0,closed:t===0,disabled:this._effectiveDisabled||t===0,label:i,scale:this.scale,slot:"actions-end",title:this.messages.clearSelection,onCalciteChipClose:()=>e?.clear()},i)}_renderCustomTools(){return this.toolConfigs.map(({toolName:e,icon:t})=>this._renderToolWithTooltip(e,t))}_renderPointTool(){if(this.visibleElements.pointTool)return this._renderToolWithTooltip("point","selection-set",this.messages.selectByPoint)}_renderLassoTool(){if(this.visibleElements.lassoTool)return this._renderToolWithTooltip("lasso","lasso-select",this.messages.selectByLasso)}_renderRectangleTool(){if(this.visibleElements.rectangleTool)return this._renderToolWithTooltip("rectangle","cursor-marquee",this.messages.selectByRectangle)}_renderOperationTypeControls(){const{availableOperationTypes:e}=this;if(!this.visibleElements.operationTypeControls||!e.length)return;const{_effectiveOperationType:t,scale:i}=this,n=this._getIconForSelectionOperationType(t),l=this._getLabelForSelectionOperationType(t);return p("calcite-action-group",{key:"toggle-group"},p("calcite-dropdown",{overlayPositioning:"fixed",placement:"bottom-start",scale:i},p("calcite-action",{class:Xe.toolButton,disabled:this._effectiveDisabled,icon:n,scale:i,slot:"trigger",text:l,title:l},p("calcite-icon",{icon:"chevron-down",scale:"s"})),p("calcite-dropdown-group",null,e.map(r=>this._renderOperationTypeDropdownItem(r)))))}_renderOperationTypeDropdownItem(e){return p("calcite-dropdown-item",{iconStart:this._getIconForSelectionOperationType(e),selected:this.defaultOperationType===e,onCalciteDropdownItemSelect:()=>this.defaultOperationType=e},this._getLabelForSelectionOperationType(e))}_renderToolWithTooltip(e,t,i=e){const n=`${this.id}-tool-${e}`;return this._renderAction({active:this.activeOperation?.toolName===e,disabled:this._effectiveDisabled,icon:t||"selection",id:n,key:n,onclick:()=>this.toggleTool(e),text:i,title:i})}_renderAction(e){return p("calcite-action",{...e,bind:this,class:Xe.toolButton,scale:this.scale})}_getIconForSelectionOperationType(e){switch(e){case"replace":return"overwrite-features";case"add":return"cursor-plus";case"remove":return"cursor-minus"}}_getLabelForSelectionOperationType(e){const{messages:t}=this;switch(e){case"replace":return t.replaceSelection;case"add":return t.addToSelection;case"remove":return t.removeFromSelection}}};o([s()],_.prototype,"_effectiveDisabled",null),o([s()],_.prototype,"_effectiveOperationType",null),o([s()],_.prototype,"activeOperation",null),o([s()],_.prototype,"availableOperationTypes",void 0),o([s()],_.prototype,"continuousSelectionEnabled",null),o([s()],_.prototype,"defaultLassoToolOptions",null),o([s()],_.prototype,"defaultOperationType",null),o([s()],_.prototype,"defaultPointToolOptions",null),o([s()],_.prototype,"defaultRectangleToolOptions",null),o([s()],_.prototype,"disabled",void 0),o([s()],_.prototype,"effectiveSelectionManager",null),o([s()],_.prototype,"effectiveSources",null),o([s()],_.prototype,"label",null),o([s()],_.prototype,"layers",null),o([s()],_.prototype,"layerViewPreferenceEnabled",null),o([s()],_.prototype,"layout",void 0),o([s(),me("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],_.prototype,"messages",void 0),o([s()],_.prototype,"persistSelection",null),o([s()],_.prototype,"returnFeatureTitleFields",null),o([s()],_.prototype,"returnGeometry",null),o([s()],_.prototype,"selectOnComplete",null),o([s()],_.prototype,"scale",void 0),o([s()],_.prototype,"selectionManager",null),o([s()],_.prototype,"state",null),o([s()],_.prototype,"sources",null),o([s()],_.prototype,"toolConfigs",null),o([s()],_.prototype,"view",null),o([s()],_.prototype,"viewModel",void 0),o([s({type:mt,nonNullable:!0})],_.prototype,"visibleElements",void 0),o([s()],_.prototype,"visibleToolCount",null),_=o([M("esri.widgets.support.SelectionToolbar")],_);const Lo=_,Xt={absolute:"absolute-direction",relative:"relative-direction"},bt=()=>ye({icon:()=>import("./index-Bk9GZ3D-.js").then(e=>e.i),label:()=>import("./index-DAzAihR6.js"),switch:()=>import("./index-QdxntT_c.js"),tooltip:()=>import("./index-CNthpfrR.js")}),Ve="esri-labeled-switch",Ne={label:`${Ve}__label`,labelContent:`${Ve}__label-content`,iconInfo:`${Ve}__icon_info`,iconWarning:`${Ve}__icon_warning`,tooltip:`${Ve}__tooltip`};function Oe({checked:e,disabled:t,hint:i,key:n,label:l,onChange:r,hintIcon:a,hintKind:d}){return p("calcite-label",{class:Ne.label,disabled:t,key:n,layout:"inline-space-between",scale:"s"},i?p("div",{class:Ne.labelContent,key:"label-content"},p("div",null,l),p("calcite-icon",{class:d!=="warning"?Ne.iconInfo:Ne.iconWarning,icon:a??"information",id:n,onclick:c=>c.stopPropagation(),onpointerdown:c=>{c.preventDefault(),c.stopPropagation();const u=c.target.nextElementSibling;u.open=!u.open},scale:"s",tabIndex:0}),p("calcite-tooltip",{class:Ne.tooltip,overlayPositioning:"fixed",referenceElement:n},i)):l,p("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:c=>r(c.currentTarget.checked)}))}let Ee=class extends Z{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};o([s({type:Boolean,nonNullable:!0})],Ee.prototype,"directionModePicker",void 0),o([s({type:Boolean,nonNullable:!0})],Ee.prototype,"header",void 0),o([s({type:Boolean,nonNullable:!0})],Ee.prototype,"labelsToggle",void 0),o([s({type:Boolean,nonNullable:!0})],Ee.prototype,"tooltipsToggle",void 0),Ee=o([M("esri.widgets.support.SketchTooltipControls.VisibleElements")],Ee);const wt=Ee,Ze="esri-sketch-tooltip-controls",Je={base:Ze,block:`${Ze}__block`,blockContent:`${Ze}__block-content`,radioButtonLabelWrapper:`${Ze}__radio-button-label-wrapper`};let be=class extends ne{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new wt,this.sketchOptions=new zt,this.viewType=void 0,this._onTooltipsEnabledChange=i=>{this.sketchOptions.tooltips.enabled=i},this._onLabelsEnabledChange=i=>{this.sketchOptions.labels.enabled=i},this._onDirectionModeChange=i=>{this.sketchOptions.values.directionMode=i.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([ye({block:()=>import("./index-BT0kn34R.js"),label:()=>import("./index-DAzAihR6.js"),icon:()=>import("./index-Bk9GZ3D-.js").then(e=>e.i),"radio-button":()=>import("./index-7nm7wyzb.js"),"radio-button-group":()=>import("./index-DRha5F-I.js")}),bt()])}render(){const{label:e,visibleElements:t}=this,i=this._renderContent();return p("div",{"aria-label":e,class:this.classes(Je.base,ut.widget)},i?p("calcite-block",{class:Je.block,expanded:!0,heading:t.header?this.label:"",key:"content-block",label:this.label},p("div",{class:Je.blockContent,key:"content"},i)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){const{visibleElements:e,viewType:t}=this,i=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&t!=="2d"?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(ue);return i.length===0?null:i}_renderTooltipsToggle(){const{messages:e,sketchOptions:t}=this;return p(Oe,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,sketchOptions:t}=this;return p(Oe,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:e,sketchOptions:t}=this,{directionMode:i}=t.values;return p("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,p("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:i,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",i,e.directionModeRelative),this._renderDirectionModeOption("absolute",i,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,i){return p("calcite-label",{key:e,layout:"inline",scale:"s"},p("calcite-radio-button",{checked:e===t,scale:"s",value:e}),p("div",{class:Je.radioButtonLabelWrapper,key:"label-wrapper"},p("calcite-icon",{icon:Xt[e],scale:"s"}),i))}};o([s()],be.prototype,"label",null),o([s({type:wt,nonNullable:!0})],be.prototype,"visibleElements",void 0),o([s(),me("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],be.prototype,"messages",void 0),o([s({nonNullable:!0,type:zt})],be.prototype,"sketchOptions",void 0),o([s({type:String})],be.prototype,"viewType",void 0),be=o([M("esri.widgets.support.SketchTooltipControls")],be);const Oo=be,Eo={hide:"hide"};function et(e){return e?.listMode??void 0}function Po(e){return e!=null&&"minScale"in e&&e.minScale!=null?e.minScale:void 0}function Io(e){return e!=null&&"maxScale"in e&&e.maxScale!=null?e.maxScale:void 0}function Do(e){if(!e)return"inherited";const t=Ro(ei(e)?e.layer:e);return t!=null?t?"independent":"inherited":"visibilityMode"in e&&e.visibilityMode!=null?e.visibilityMode:"independent"}function Zt(e){if(e&&(!("type"in e)||e.type!=="wmts"))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function ft(e){return et(e)!==Eo.hide}function Ao(e,t){if(!e||t==null||isNaN(t))return!1;const i=Po(e),n=Io(e),l=i!=null&&!isNaN(i)&&i>0&&t>i,r=n!=null&&!isNaN(n)&&n>0&&t<n;return l||r}function Jt(e){const t=e?.layer;return t&&"layers"in t?t.layers:null}function ei(e){return e!=null&&"layer"in e&&e.layer!=null}function Ro(e){const t=Fo(e);return t!=null&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}function Fo(e){return e&&"capabilities"in e&&e.capabilities!=null&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}let F=class extends Dt(ne){constructor(e,t){super(e,t),this._legend=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([x(()=>this._canCreateLegend,()=>this._createLegend(),U),x(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),U)])}destroy(){this._legend=Ae(this._legend)}get _canCreateLegend(){const{content:e,listItem:t}=this;if(!t)return!1;const i="legend";return e===i||e!=null&&!!Array.isArray(e)&&e.includes(i)}get _legendOptions(){const{listItem:e,_legendLayerInfo:t}=this,i=e?.view;return t&&i?{view:i,layerInfos:[t]}:{}}get _legendLayerInfo(){const e=this.listItem?.layer;if(!e||e.type==="subtype-sublayer")return null;const t=ei(e)?e:null,i=e?.parent,n=i!=null&&"type"in i&&i.type==="map-image"?t?.source:null,l="";return n&&i?{layer:i,title:l,sublayerIds:[n.mapLayerId]}:{layer:e,title:l}}get disabled(){const{listItem:e,_legend:t,content:i}=this;return!e||!(Array.isArray(i)&&i.length>1)&&!!t&&(!t.activeLayerInfos?.length||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){return this._get("title")||(this._getFirstWidget()?.label??"")}set title(e){this._override("title",e)}render(){return p("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i,open:n}=this;return e&&!i&&n?e==="legend"&&t?p("div",{key:"legend-widget"},t.render()):typeof e=="string"?p("div",{innerHTML:e,key:e}):Wt(e)?p("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?p("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:t}=this;return t?Array.isArray(e)?e.map(i=>this._renderContent(i)):this._renderContent(e):null}async _createLegend(){if(Ae(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:e}=await import("./Legend-B0lNJARs.js"),t=new e(this._legendOptions);this._legend=t}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return e==="legend"?this._legend:Wt(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(t=>this._getWidget(t)).find(t=>t):this._getWidget(e)}};o([s()],F.prototype,"_legend",void 0),o([s()],F.prototype,"_canCreateLegend",null),o([s()],F.prototype,"_legendOptions",null),o([s()],F.prototype,"_legendLayerInfo",null),o([s()],F.prototype,"content",void 0),o([s()],F.prototype,"disabled",null),o([s()],F.prototype,"flowEnabled",void 0),o([s()],F.prototype,"icon",null),o([s()],F.prototype,"image",void 0),o([s()],F.prototype,"listItem",void 0),o([s()],F.prototype,"open",void 0),o([s()],F.prototype,"title",null),o([s()],F.prototype,"visible",void 0),F=o([M("esri.widgets.LayerList.ListItemPanel")],F);const ti=F;var He;const Bo=oe.ofType({key:"type",defaultKeyValue:"button",base:Mi,typeMap:{button:Ci,toggle:xi}}),ii=oe.ofType(Bo),_t="layer",tt="child-list-mode",Go="hide";let T=He=class extends Dt(Z){constructor(e){super(e),this.actionsSections=new ii,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(oe.ofType(He)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.parent=null,this.view=null}initialize(){if(this.addHandles([x(()=>[this.layer,this.layer?.listMode,this.listModeDisabled],()=>this._watchLayerProperties(this.layer),U),x(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),U),x(()=>this.view,e=>this._updateChildrenView(e),U),x(()=>this.panel,e=>this._setListItemOnPanel(e),U)]),typeof this.listItemCreatedFunction=="function"){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e))&&!e.spatialReferenceSupported}get layerView(){const{layer:e,view:t}=this;if(!e||!t||e.type==="sublayer")return null;const i=e.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(n=>n.layer===i)??null}set panel(e){const t=this._get("panel");e!==t&&e&&t?.destroy(),this._set("panel",e)}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new ti(e):null}get sortable(){return this.layer?.type!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){const e=Ke(this,"layer.layer");return(!e||e&&Ke(this,"layer.layer.loaded"))&&Ke(this,"layer.title")||Ke(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){const{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&e.publishingInfo?.status==="publishing")}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:n}=this;return!n&&!t&&(e?e.updating:i?.loadStatus==="loading"||!1)}get visible(){return!!this.layer?.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!Ao(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return Do(this.layer)}clone(){return new He({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){this.children?.forEach(t=>t.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(i=>i.view=e)}_createChildren(e){const{listModeDisabled:t,children:i}=this,n=e.filter(l=>!i.some(r=>r.layer===l));i.addMany(this._createChildItems(n,t))}_destroyChildren(e){const{children:t}=this,i=t.filter(n=>!!n.layer&&!e.includes(n.layer));t.destroyMany(i)}_sortChildren(e){this.children.sort((t,i)=>e.indexOf(i.layer)-e.indexOf(t.layer))}_destroyAllChildren(){this.removeHandles(tt),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(tt),this.listModeDisabled||this.addHandles(e.toArray().map(t=>x(()=>t.listMode,()=>this._compileChildren(e))),tt)}_compileChildren(e){const t=this.listModeDisabled?e:e?.filter(i=>et(i)!==Go);e?.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",()=>this._compileChildren(e)),_t)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map(i=>t||ft(i)?new He({layer:i,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(ue)}_watchLayerProperties(e){if(this.removeHandles(_t),this.removeHandles(tt),!e)return;if((!this.listModeDisabled&&et(e))==="hide-children")return void this.children.destroyAll();const t=Zt(e);t&&this.addHandles(x(()=>e[t],i=>{e.hasOwnProperty(t)&&this._initializeChildLayers(i)},U),_t)}};o([s({type:ii})],T.prototype,"actionsSections",void 0),o([s()],T.prototype,"actionsOpen",void 0),o([s()],T.prototype,"checkPublishStatusEnabled",void 0),o([s({type:oe.ofType(T)})],T.prototype,"children",void 0),o([s()],T.prototype,"childrenSortable",void 0),o([s({readOnly:!0})],T.prototype,"connectionStatus",null),o([s({readOnly:!0})],T.prototype,"error",null),o([s()],T.prototype,"hidden",void 0),o([s({readOnly:!0})],T.prototype,"incompatible",null),o([s()],T.prototype,"layer",void 0),o([s({readOnly:!0})],T.prototype,"layerView",null),o([s()],T.prototype,"listItemCreatedFunction",void 0),o([s({nonNullable:!0})],T.prototype,"listModeDisabled",void 0),o([s()],T.prototype,"open",void 0),o([s({type:ti})],T.prototype,"panel",null),o([Si("panel")],T.prototype,"castPanel",null),o([s()],T.prototype,"parent",void 0),o([s({value:!0})],T.prototype,"sortable",null),o([s()],T.prototype,"title",null),o([s({readOnly:!0})],T.prototype,"publishing",null),o([s({readOnly:!0})],T.prototype,"updating",null),o([s()],T.prototype,"view",void 0),o([s()],T.prototype,"visible",null),o([s({readOnly:!0})],T.prototype,"visibleAtCurrentScale",null),o([s({readOnly:!0})],T.prototype,"visibleAtCurrentTimeExtent",null),o([s({readOnly:!0})],T.prototype,"visibilityMode",null),T=He=o([M("esri.widgets.LayerList.ListItem")],T);const Tt=T,Q={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},zo="hide",oi=oe.ofType(Tt);let ee=class extends ct{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new oi,this.view=null}initialize(){this.addHandles([x(()=>this.view?.ready===!0,()=>this._viewHandles(),U),x(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),x(()=>Ut(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],Q.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,n){const l=e?.layer;if(!l||l.type==="subtype-sublayer"||l.type==="sublayer")return;const r=this.view?.map?.layers,a=t?Jt(t):r,d=i?Jt(i):r;if(!a||!d)return;const{operationalItems:c}=this,u=t?.children||c,v=i?.children||c,g=d.length-n;e.parent=i||null,u.remove(e),a.remove(l),v.includes(e)||v.add(e,g),d.includes(l)||d.add(l,g),this._compileList()}_createLayerViewHandles(e){this.removeHandles(Q.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),Q.layerViews)}_createMapLayerHandles(e){this.removeHandles(Q.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),Q.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:n,listModeDisabled:l}=this;return new Tt({checkPublishStatusEnabled:n,listModeDisabled:l,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>et(t)!==zo):void 0}_watchLayersListMode(e){this.removeHandles(Q.layerListMode),e&&!this.listModeDisabled&&this.addHandles(x(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),Q.layerListMode)}_compileList(){const e=this.view?.map?.layers,t=Ut(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:n})=>n==="link-chart"):e;this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.some(n=>n.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach(n=>{n&&e&&e.includes(n.layer)||i.push(n)}),t.destroyMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,n)=>{const l=e.indexOf(i.layer),r=e.indexOf(n.layer);return l>r?-1:l<r?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([Q.mapLayers,Q.layerViews,Q.viewLayers]),e?.ready?this.addHandles([x(()=>this.view?.map?.allLayers,t=>this._createMapLayerHandles(t),U),x(()=>this.view?.allLayerViews,t=>this._createLayerViewHandles(t),U)],Q.viewLayers):this._removeAllItems()}};o([s()],ee.prototype,"checkPublishStatusEnabled",void 0),o([s()],ee.prototype,"listItemCreatedFunction",void 0),o([s({nonNullable:!0})],ee.prototype,"listModeDisabled",void 0),o([s({type:oi})],ee.prototype,"operationalItems",void 0),o([s({readOnly:!0})],ee.prototype,"state",null),o([s()],ee.prototype,"totalItems",null),o([s()],ee.prototype,"view",void 0),ee=o([M("esri.widgets.LayerList.LayerListViewModel")],ee);const Vo=ee,kt=e=>No(e)||Ho(e),No=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},Ho=e=>{const t=Zt(e);if(t!=null&&e.hasOwnProperty(t)&&e[t]!=null){for(const i of e[t])if(kt(i))return!0}return!1},it=(e,t)=>t!=null&&e!=null&&(t.test(e.title)?"self":!!e.children.some(i=>it(i,t)!==!1)&&"children");var xt;let re=xt=class extends Tt{constructor(e){super(e),this.children=new oe,this.parent=null}get enabled(){const{children:e}=this;if(e.length===0)return this.featureSource!=null&&this.featureSource.enabled?"enabled":"disabled";let t=!1,i=!1;for(const n of e){if(n.enabled==="indeterminate")return n.enabled;if(n.enabled==="enabled"?t=!0:n.enabled==="disabled"&&(i=!0),i&&t)return"indeterminate"}return i?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>[e.layer?.id,...e.childLayerIds])}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find(i=>i.layer===e)}_initializeChildLayers(e){if(!e)return;const t=e.filter(kt);super._initializeChildLayers(t)}_createChildItems(e){return e.map(t=>ft(t)?new xt({layer:t,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(ue).reverse()}};o([s()],re.prototype,"enabled",null),o([s()],re.prototype,"children",void 0),o([s()],re.prototype,"childLayerIds",null),o([s()],re.prototype,"featureSource",null),o([s({constructOnly:!0})],re.prototype,"getFeatureSnappingSources",void 0),o([s()],re.prototype,"parent",void 0),re=xt=o([M("esri.widgets.support.SnappingControls.SnappingListItem")],re);let Pe=class extends Vo{constructor(){super(...arguments),this.featureSnappingSources=new oe}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>!e.children?.length)}_compileList(){const e=this.view?.map?.layers;if(!e)return;const t=e.filter(kt);this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createListItem(e){return new re({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};o([s()],Pe.prototype,"featureSnappingSources",void 0),o([s()],Pe.prototype,"operationalItems",void 0),o([s()],Pe.prototype,"operationalItemsFlat",null),o([s()],Pe.prototype,"selectableItems",null),Pe=o([M("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],Pe);let te=class extends Z{constructor(e){super(e),this.layerListViewModel=new Pe,this.snappingOptions=new Vt,this.view=null}initialize(){this.addHandles([x(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},U),x(()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources}),({viewModel:e,sources:t})=>{e.featureSnappingSources=t},U)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>e.enabled==="enabled")}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>!e.enabled)}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter(e=>e.enabled==="enabled").length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach(i=>t?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{const i=t?.id;e?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i)})}enableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)ft(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){const t=this.layerListViewModel.operationalItemsFlat.find(n=>n.layer?.id===e)?.layer;if(!t)throw new Li("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if(t.type==="group")return;const i=new so({layer:t});return this.snappingOptions.featureSources.add(i),i}};o([s()],te.prototype,"allLayersEnabled",null),o([s()],te.prototype,"allLayersDisabled",null),o([s({constructOnly:!0})],te.prototype,"layerListViewModel",void 0),o([s()],te.prototype,"layersEnabledCount",null),o([s({type:Vt,nonNullable:!0})],te.prototype,"snappingOptions",void 0),o([s()],te.prototype,"state",null),o([s()],te.prototype,"view",void 0),te=o([M("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],te);const $o=te,ie="esri-snapping-controls",Y={base:ie,container:`${ie}__container`,toggleBlock:`${ie}__toggle-block`,layerListBlock:`${ie}__layer-list-block`,layerList:`${ie}__layer-list`,layerListFilter:`${ie}__layer-list__filter`,layerListButton:`${ie}__layer-list__button`,layerListItem:`${ie}__layer-list__item`,layerListGroup:`${ie}__layer-list__group`,nestedContainer:`${ie}__nested-container`};let E=class extends ne{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new Ye,this._enableSnappingSwitchChange=r=>{this.snappingOptions.enabled=r},this._featureEnabledSwitchChange=r=>{this.snappingOptions.featureEnabled=r},this._gridEnabledSwitchChange=r=>{this.snappingOptions.gridEnabled=r,r&&this._startLoadGrid()},this._selfEnabledSwitchChange=r=>{this.snappingOptions.selfEnabled=r},this._onToggleLayersButtonClick=r=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),ro(r.target)};const{snappingOptions:i,view:n,viewModel:l}=e;this.viewModel=l??(this._defaultViewModel=new $o({snappingOptions:i,view:n}))}normalizeCtorArgs(e){const{snappingOptions:t,view:i,viewModel:n,...l}=e;return l}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=Ae(this._defaultViewModel))}loadDependencies(){return Promise.all([ye({block:()=>import("./index-BT0kn34R.js"),button:()=>import("./index-CNVUNsUF.js"),input:()=>import("./index-BxF77MXj.js"),list:()=>import("./index-CZuEENrt.js"),"list-item":()=>import("./index-gkXqgZTq.js"),checkbox:()=>import("./index-CVwBoleO.js"),loader:()=>import("./index-BkTYIhIE.js")}),bt()])}initialize(){this.addHandles(x(()=>this.view?.type==="2d"&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=Ae(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return p("div",{"aria-label":e,class:this.classes(Y.base,ut.widget)},p("div",{class:Y.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),this.view?.type==="2d"&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:t}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&t?.type==="2d"?this._renderGridEnabledToggle():null].filter(ue),n=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?p("div",{class:Y.nestedContainer},i):null].filter(ue);return n.length===0?null:p("calcite-block",{class:Y.toggleBlock,expanded:!0,heading:e.header?this.label:"",key:"toggle-block",label:this.label},n)}_renderEnabledToggle(){return p(Oe,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return p(Oe,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return p(Oe,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return p(Oe,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,i=t.layerListViewModel.operationalItems.length>9?p("calcite-input",{class:Y.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:a}})=>{this._layerListFilter=a===""?null:new RegExp(a,"i")}}):null,n=this._secondaryElementsDisabled,l=this.layerListOpen&&!n,r=t.layerListViewModel.operationalItems?.find(a=>!!a.children.length);return p("calcite-block",{class:Y.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,expanded:l,heading:e.snappingLayers,key:"list-block",onCalciteBlockToggle:a=>this.layerListOpen=a.currentTarget.expanded},i,this._renderToggleLayersButton(),p("calcite-list",{class:Y.layerList,displayMode:r?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){const{view:e,visibleElements:t,snappingManager:i,snappingOptions:n,_openAndReady:l}=this,{gridEnabled:r,enabled:a}=n;(l||e?.type==="2d"&&e.grid)&&this._startLoadGrid();const d=this._gridLoadTask?.value,c=d&&e?.type==="2d"&&p(d,{snappingManager:i,snappingOptions:n,view:e,visibleElements:t.gridControlsElements});return p("calcite-block",{class:Y.layerListBlock,collapsible:!0,disabled:!r||!a,expanded:l,heading:this.messages.gridOptionsHeading,key:"grid-block",onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},c??p("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}_startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&this.view?.type==="2d"&&(this._gridLoadTask=$t(async()=>(await import("./GridControls-FwFv7amK.js")).default))}_renderLayerListItemCollection(e){const t=this._layerListFilter;return e.map(i=>{switch(t?it(i,t):null){case"children":{const n=i.children.filter(l=>it(l,t)!==!1);return this._renderLayerListItemGroup(i,n)}case"self":case null:return this._renderLayerListItemOrGroup(i);case!1:return it(i.parent,t)==="self"?this._renderLayerListItemOrGroup(i):null}}).toArray().filter(ue)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return p("calcite-button",{appearance:"transparent",class:Y.layerListButton,label:i,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},i)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,i=e.title||t,n=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],e.enabled!=="enabled")};return p("calcite-list-item",{class:Y.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:i,onCalciteListItemSelect:l=>{l.stopPropagation(),n()}},p("calcite-checkbox",{checked:e.enabled==="enabled",slot:"actions-start",onCalciteCheckboxChange:n}))}_renderLayerListItemGroup(e,t){const{messages:i}=this,{children:n,title:l}=e,r=l||i.untitledLayer,a=l&&l!==""?l:Oi(),d=!!t?.length,c=t??n,u=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,e.enabled!=="enabled")},v=c?.find(g=>!!g.children.length);return p("calcite-list-item",{class:Y.layerListGroup,expanded:d,key:a,label:r,onCalciteListItemSelect:g=>{g.stopPropagation(),u()}},p("calcite-checkbox",{checked:e.enabled==="enabled",indeterminate:e.enabled==="indeterminate",slot:"actions-start",onCalciteCheckboxChange:u}),p("calcite-list",{displayMode:v?"nested":"flat",label:i?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(c)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};o([s()],E.prototype,"_defaultViewModel",void 0),o([s()],E.prototype,"_layerListFilter",void 0),o([s()],E.prototype,"_gridLoadTask",void 0),o([s()],E.prototype,"_openAndReady",null),o([s()],E.prototype,"label",null),o([s({type:Boolean,nonNullable:!0})],E.prototype,"layerListOpen",void 0),o([s({type:Boolean,nonNullable:!0})],E.prototype,"gridOptionsOpen",void 0),o([s(),me("esri/widgets/support/SnappingControls/t9n/SnappingControls")],E.prototype,"messages",void 0),o([s(),me("esri/t9n/common")],E.prototype,"messagesCommon",void 0),o([s()],E.prototype,"snappingOptions",null),o([s()],E.prototype,"snappingManager",void 0),o([s()],E.prototype,"view",null),o([s()],E.prototype,"viewModel",null),o([s({type:Ye,nonNullable:!0})],E.prototype,"visibleElements",void 0),o([s()],E.prototype,"_enabledToggleDisabled",null),o([s()],E.prototype,"_secondaryElementsDisabled",null),E=o([M("esri.widgets.support.SnappingControls")],E);const Uo=E,we="esri-sketch",ae={base:we,vertical:`${we}--vertical`,docked:`${we}-bar`,floating:`${we}-pad`,chipHorizontal:`${we}__selection-count-chip--horizontal`,chipVertical:`${we}__selection-count-chip--vertical`,chipVerticalSmall:`${we}__selection-count-chip--vertical--s`,popoverWrapper:`${we}__popover-wrapper`},Wo={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand",text:"add-text"};let b=class extends ne{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.groupAllowCollapseOptions=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new R,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new Nt({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,i=t?.type==="2d",n=new Lo({persistSelection:!1,visibleElements:new mt({chip:!1,lassoTool:i,operationTypeControls:!1,pan:!1,pointTool:!1,rectangleTool:i}),view:t,sources:e?[e]:null,scale:this.scale});this.addHandles([x(()=>this.viewModel,l=>{this._viewModelHandlesGroup=Ge(this._viewModelHandlesGroup),l&&(this._viewModelHandlesGroup=dt([l.on("create",()=>this.scheduleRender()),l.on("update",()=>this.scheduleRender()),l.on("delete",r=>this.emit("delete",r)),l.on("undo",()=>this.scheduleRender()),l.on("redo",()=>this.scheduleRender()),x(()=>l.layer,r=>{this._selectionToolbar&&(this._selectionToolbar.sources=r?[r]:null)}),x(()=>l.view,r=>{this._selectionToolbar&&(this._selectionToolbar.view=r)}),x(()=>l.state,()=>this.notifyChange("state"))]))},At),Ei(()=>n.activeOperation,()=>this.viewModel.cancel()),n.on("complete",l=>this._onSelectionOperationComplete(l)),x(()=>{const{view:l,visibleElements:{selectionTools:r}}=this;return{lassoTool:l?.type!=="3d"&&!!r?.["lasso-selection"],rectangleTool:l?.type!=="3d"&&!!r?.["rectangle-selection"]}},l=>{Object.assign(n.visibleElements,l)},At)]),this._selectionToolbar=n}loadDependencies(){return ye({action:()=>import("./index-BJaYRsNY.js"),chip:()=>import("./index-BH6atTkj.js"),popover:()=>import("./index-BNG4zE2I.js").then(e=>e.i)})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=Ge(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeOperation;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:i,activeCreateToolDrawMode:n}=this.viewModel;return i==="polygon"&&n==="freehand"&&t?.includes("freehandPolygon")?"freehandPolygon":i==="polyline"&&n==="freehand"&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeOperation?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&Ae(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:i}=this,n=e?.filter(l=>!!i.createTools?.[l]);return t?.type==="3d"?n?.filter(l=>l!=="multipoint"):n}create(e,t,i){const n=i?.createOptions??t;return this._activeCustomToolOptions=i,$e(this.viewModel.create(e,n))}update(e,t){return $e(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:i}=this,n=this.customActions?.filter(l=>l.position==="selection-toolbar");return p("div",null,p("div",{classes:{[ae.base]:!0,[ae.floating]:e==="floating",[ae.docked]:e==="docked",[ae.vertical]:t==="vertical"}},p(J,{barStyle:e,layout:t,scale:i},this._renderSelectionSetItemGroupInline(),p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionTools")??!0,"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??0},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),n?.map(l=>this._renderToolbarItem(l))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:i,viewModel:n,visibleElements:l}=this;if(!this._calcitePopoverReferenceElement)return;const r={directionModePicker:l.directionModePicker,labelsToggle:l.labelsToggle,tooltipsToggle:l.tooltipsToggle},a=this.layout==="horizontal"?this._relativeLocation==="top"?"bottom-end":"top-end":"right-end";return p("calcite-popover",{closable:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:a,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:d=>this._remeasurePopoverSizes(d.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},p("div",{class:ae.popoverWrapper},Object.values(r).includes(!0)?p(Oo,{sketchOptions:n.sketchOptions,viewType:i?.type,visibleElements:new wt(r)}):void 0,l.snappingControls&&i&&t?p(Uo,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:i,visibleElements:l.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if(this.contextualToolLocation!=="separate")return;const e=this._renderSelectionSetItemGroup();return e?.length?p(J,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return this.contextualToolLocation==="separate"?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("undoRedo")??!0,"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??10,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],t=[];this.customActions?.forEach(n=>{n.position==="settings-before"?t.push(n):n.position==="settings-after"&&e.push(n)});const i=[...t.map(n=>this._renderToolbarItem(n)),this._renderSettingsMenuButton(),...e.map(n=>this._renderToolbarItem(n))].filter(ue);if(i.length)return p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("settings")??!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??1e3,slot:"actions-end"},i)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e=this.contextualToolLocation==="inline-end"?"actions-end":void 0,t=this.customActions?.filter(l=>l.position==="before-selection-set"),i=this.customActions?.filter(l=>l.position==="after-selection-set"),n=this.groupCollapsePriorities?.get("selectionSet")??100;return[p("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:n,slot:e},this._renderFeatureCountChip()),p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionSet")??!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:n,slot:e},t?.map(l=>this._renderToolbarItem(l)),this._renderDuplicateButton(),this._renderDeleteButton(),i?.map(l=>this._renderToolbarItem(l)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:t==="ready"})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap(i=>this._renderBuiltInCreateToolItem(i))??[],t=this.customToolOptions?.flatMap(i=>this._renderCustomToolItem(i))??[];return p("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("createTools")??!0,"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??100},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:Wo[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:i,id:n,updateGraphics:{length:l}}=this,r=Kt(t.selectedCount,{count:l}),a=i==="s"?99:999,d=l>a?Kt(t.selectedCountTruncated,{truncated:a}):l,c=i==="s"&&e==="vertical",u=c?`${n}-selection-chip-small`:`${n}-selection-chip`;return[c?p("span",{classes:{[ae.chipVertical]:!0,[ae.chipVerticalSmall]:this.scale==="s"},id:u,tabIndex:0,title:r},d):p("calcite-chip",{appearance:"outline",class:e==="horizontal"?ae.chipHorizontal:ae.chipVertical,id:u,kind:"brand",label:r,scale:i==="l"?"m":"s",tabIndex:0,title:e==="vertical"?r:void 0},e==="vertical"?d:r)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:i,disabled:n,onclick:l,active:r,flipRTL:a,afterCreate:d,afterUpdate:c,afterRemoved:u}){const v=`${this.id}-${e}`;return[p("calcite-action",{active:r,afterCreate:d,afterRemoved:u,afterUpdate:c,bind:this,"data-testid":e,disabled:n||this.state==="disabled",icon:i,iconFlipRtl:a??!1,id:v,key:e,onclick:l,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,i=this?.view?.container?.getBoundingClientRect(),n=t?.style;if(!(t&&i&&n&&this.view?.container?.contains(t)))return;const l=this._calcitePopoverReferenceElement;if(!l)return;const{bottom:r,top:a}=l.getBoundingClientRect();if(this.layout==="horizontal"){const c=r<i.height/2;c!==(this._relativeLocation==="top")&&(this._relativeLocation=c?"top":"bottom"),c?(n?.setProperty("--sketch-view-height-offset",r-i.top+"px"),n?.setProperty("--sketch-view-margin-offset","30px")):(n?.setProperty("--sketch-view-height-offset",i.bottom-a+"px"),n?.setProperty("--sketch-view-margin-offset","15px"))}else this.layout==="vertical"&&(n.setProperty("--sketch-view-height-offset","15px"),n.setProperty("--sketch-view-margin-offset","15px"));const d=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;n.setProperty("--sketch-popover-header-offset",`${d}px`)}catch(t){ge.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",t)}}_activateCreateTool(e,t,i){const n=this._activeCustomToolOptions;if(i||n){if(i?.toolKey===n?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,i)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;t!=="transform"&&t!=="reshape"||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const n=t.tool,l=i.length>1&&n==="reshape"?"transform":n;this.update(i,{...t,tool:l})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};o([s()],b.prototype,"_activeCustomToolOptions",void 0),o([s()],b.prototype,"activeTool",null),o([s({readOnly:!0})],b.prototype,"activeTooltip",null),o([s({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh","text"]);return e.filter(i=>t.has(i))}})],b.prototype,"availableCreateTools",void 0),o([s({readOnly:!0})],b.prototype,"createGraphic",null),o([s()],b.prototype,"creationMode",null),o([s()],b.prototype,"customToolOptions",void 0),o([s()],b.prototype,"customActions",void 0),o([s()],b.prototype,"defaultCreateOptions",null),o([s()],b.prototype,"defaultUpdateOptions",null),o([s()],b.prototype,"icon",null),o([s()],b.prototype,"label",null),o([s()],b.prototype,"labelOptions",null),o([s()],b.prototype,"layer",null),o([s({type:["horizontal","vertical"],value:"horizontal"})],b.prototype,"layout",null),o([s({value:"m"})],b.prototype,"scale",null),o([s()],b.prototype,"toolbarKind",void 0),o([s()],b.prototype,"contextualToolLocation",void 0),o([s()],b.prototype,"groupCollapsePriorities",void 0),o([s()],b.prototype,"groupAllowCollapseOptions",void 0),o([s(),me("esri/widgets/Sketch/t9n/Sketch")],b.prototype,"messages",void 0),o([s(),me("esri/t9n/common")],b.prototype,"messagesCommon",void 0),o([s()],b.prototype,"snappingOptions",null),o([s()],b.prototype,"state",null),o([s()],b.prototype,"tooltipOptions",null),o([s({readOnly:!0})],b.prototype,"updateGraphics",null),o([s({type:no,nonNullable:!0})],b.prototype,"valueOptions",null),o([s()],b.prototype,"view",null),o([s({type:Nt}),uo(["create","update","undo","redo"])],b.prototype,"viewModel",null),o([s({type:R,nonNullable:!0})],b.prototype,"visibleElements",void 0),o([s()],b.prototype,"_effectiveAvailableCreateTools",null),o([s()],b.prototype,"_defaultViewModel",void 0),o([s()],b.prototype,"_calcitePopoverReferenceElement",void 0),o([s()],b.prototype,"_relativeLocation",void 0),o([s()],b.prototype,"_popoverOpen",void 0),b=o([M("esri.widgets.Sketch")],b);const Ko=b,jo=(e,t)=>i=>Qo(i,e);class qo extends Ii{#i=new Map;#e;#t;constructor(t,i){super(t,i),new Di(t);const n=this,l=n.instance;let r=l.viewModel,a=l.visibleElements;const d=new Proxy(this.exports,{get(c,u,v){return u==="viewModel"?r:u==="visibleElements"?a:Reflect.get(c,u,v)}});if(n.#t=l,n.instance=d,n.exports=d,r){const c={component:t,get exports(){return n.instance.viewModel}};Ai(n).set("viewModel","viewModel"),t.addController(c),r=Ri(t,new WeakRef(c),Fi(t)-1,r,n.#i)}n.instance.visibleElements&&(a=n.#o(l))}hostConnected(){this.instance=this.#t,super.hostConnected()}hostLoad(){this.#e=x(()=>this.component.el.view,t=>{const i=this.instance;!("view"in i)&&typeof i.viewModel=="object"?i.viewModel.view=t:i.view=t,!("map"in i)&&typeof i.viewModel=="object"?i.viewModel.map=t?.map:i.map=t?.map},{sync:!0,initial:!0})}hostUpdate(t){t.has("closed")&&(this.instance.visible=!this.component.closed)}hostLoaded(){const{el:t}=this.component;t.childElem??=document.createElement("div"),this.instance.container=t.childElem,(this.component.el.shadowRoot??this.component.el).appendChild(this.instance.container),this.component.closed!==void 0&&this.onLifecycle(()=>x(()=>this.instance.visible,i=>this.component.closed=!i,{initial:!0}))}#o(t){return new Proxy(t.visibleElements,{get:(i,n)=>{if(typeof n=="symbol"||n in Promise.prototype)return i[n];const l=[n],r=this.#s(l);return Bi(this.component,a=>{const d=a;this.component[d]=!1;let c=t.visibleElements??{},u;for(const g of l.slice(0,-1))if(typeof c[g]=="object"&&c[g]!==null)c=c[g];else{u=!!c[g];break}u===void 0&&(u=!!(c[l.slice(-1)[0]]??!0));const v=d.startsWith("hide")||d.startsWith("show")?d.startsWith("hide"):u;this.onUpdate(g=>{if(g.has(d)){const f=this.component[d];this.#n(l,f,v)}})},r)}})}#s(t){const i=new Proxy({},{get:(n,l)=>{const r=Reflect.get(n,l);return typeof l=="symbol"||l in Promise.prototype?r:(t.push(l),i)}});return i}#n(t,i,n){let l=this.instance.visibleElements??{};for(const a of t.slice(0,-1))(typeof l[a]!="object"||l[a]===null)&&(l[a]={}),l=l[a];const r=!!(n?!i:i);l[t.at(-1)]=r}hostDestroy(){this.#e?.remove(),super.hostDestroy()}}const Qo=Pi(qo),Yo=Gi`.esri-widget__heading{color:var(--calcite-color-text-2);margin:0 0 .5rem;font-weight:var(--calcite-font-weight-semibold)}h1.esri-widget__heading{font-size:var(--calcite-font-size-xl)}h2.esri-widget__heading{font-size:var(--calcite-font-size-md)}h3.esri-widget__heading,h4.esri-widget__heading,h5.esri-widget__heading,h6.esri-widget__heading{font-size:var(--calcite-font-size)}.esri-widget{--esri-widget-padding-x: 15px;--esri-widget-padding-y: var(--calcite-spacing-md);--esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);box-sizing:border-box;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);font-size:var(--calcite-font-size);line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget *,.esri-widget :before,.esri-widget :after{box-sizing:inherit}.esri-widget.esri-widget--disabled>*{opacity:.4;pointer-events:none}.esri-widget.esri-widget--compact{--esri-widget-padding-y: 0;--esri-widget-padding-x: 0}.esri-widget__anchor{color:var(--calcite-color-text-2)}.esri-widget__anchor:hover{color:var(--calcite-color-text-3)}.esri-widget__anchor:hover,.esri-widget__anchor:focus{text-decoration:underline}.esri-widget__anchor--disabled{opacity:.4;pointer-events:none}.esri-widget__header{background-color:var(--calcite-color-foreground-1);flex:1 0 100%;justify-content:space-between;align-items:center;width:100%;min-height:48px;padding:12px 0 12px 15px;display:flex}.esri-widget__header .esri-widget__heading{width:calc(100% - 48px);text-align:initial;color:var(--calcite-color-text-1);align-items:center;margin:0;padding:0;display:flex}.esri-widget__header-button{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background-color:var(--calcite-color-foreground-1);border:none;flex:0 0 48px;justify-content:center;align-self:stretch;align-items:center;width:48px;padding:0;display:flex}.esri-widget__footer{background-color:var(--calcite-color-foreground-1);justify-content:center;align-items:center;width:100%;min-height:48px;display:flex}.esri-widget__footer-pagination{color:var(--calcite-color-text-2);justify-content:space-between;align-items:center;display:flex}.esri-widget__footer-pagination-previous-button,.esri-widget__footer-pagination-next-button{cursor:pointer;background-color:var(--calcite-color-foreground-1);border:0;margin:0 7px;padding:12px 15px;transition:background-color .125s ease-in-out}.esri-widget__footer-pagination-previous-button:hover,.esri-widget__footer-pagination-previous-button:focus,.esri-widget__footer-pagination-next-button:hover,.esri-widget__footer-pagination-next-button:focus{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1)}.esri-menu{visibility:hidden;z-index:1;background-clip:padding;background-color:var(--calcite-color-foreground-1);background-clip:padding-box;width:100%;max-height:0;margin:2px 0 0;padding:0;font-size:var(--calcite-font-size);line-height:var(--calcite-spacing-xl);position:absolute;top:100%;left:0;overflow:hidden;box-shadow:0 1px 2px #0000004d}.esri-menu .esri-menu__header{color:var(--calcite-color-text-inverse);background-color:var(--calcite-color-inverse);padding:6px 12px}.esri-menu__list{margin:0;padding:0;list-style:none}.esri-menu__list-item{cursor:pointer;border-top:1px solid #adadad4d;border-left:3px solid #0000;padding:.8em 1em}.esri-menu__list-item [class^=esri-icon-],.esri-menu__list-item [class*=" esri-icon-"]{padding-right:2.8px}.esri-menu__list-item:first-child{border-top:none}.esri-menu__list-item--focus,.esri-menu__list-item:hover,.esri-menu__list-item:focus{background-color:var(--calcite-color-foreground-1)}.esri-menu__list-item:active{background-color:var(--calcite-color-foreground-current)}.esri-menu__list-item--active,.esri-menu__list-item--active:hover,.esri-menu__list-item--active:focus{background-color:var(--calcite-color-foreground-1);border-left-color:var(--calcite-color-brand)}.esri-widget__table{border-collapse:collapse;color:var(--calcite-color-text-1);border:none;width:100%;line-height:var(--calcite-font-line-height-relative-tight)}.esri-widget__table tr:nth-child(odd){background-color:var(--calcite-color-transparent)}.esri-widget__table tr:nth-child(2n){background-color:var(--calcite-color-transparent-press)}.esri-widget__table tr a{color:var(--calcite-color-text-2)}.esri-widget__table tr a:hover,.esri-widget__table tr a:focus{color:var(--calcite-color-text-1)}.esri-widget__table tr td,.esri-widget__table tr th{vertical-align:top;word-break:break-word;padding:.5em .7em;font-size:var(--calcite-font-size-sm);font-weight:var(--calcite-font-weight-regular)}.esri-widget__table tr th{text-align:left;border-right:3px solid #0000000d;width:50%}.esri-widget__table tr td{width:50%}.esri-input{color:var(--calcite-color-text-1);background-color:var(--calcite-color-foreground-1);border:1px solid #959595;font-size:var(--calcite-font-size)}.esri-input::-ms-clear{display:none}.esri-input::placeholder{opacity:1;color:var(--calcite-color-text-2)}.esri-input:placeholder-shown{text-overflow:ellipsis}.esri-input[type=text],.esri-input[type=password],.esri-input[type=number]{height:32px;padding:0 .5em}calcite-combobox.esri-input{border:none}.esri-widget__content--empty{text-align:center;color:var(--calcite-color-border-input);flex-flow:column wrap;align-items:center;padding:18px 22px;display:flex}.esri-widget__content--empty h1.esri-widget__heading,.esri-widget__content--empty h2.esri-widget__heading,.esri-widget__content--empty h3.esri-widget__heading,.esri-widget__content--empty h4.esri-widget__heading,.esri-widget__content--empty h5.esri-widget__heading{font-weight:var(--calcite-font-weight-regular)}.esri-widget__content-illustration--empty{width:128px;padding:1rem 0}.esri-widget__content-icon--empty{width:32px;padding:.5rem 0}.esri-select{appearance:none;cursor:pointer;color:var(--calcite-color-text-2);background:var(--calcite-color-foreground-1) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-8 -8 32 32' width='32' height='32'%3E%3Cpath d='M8 11.207l-4-4V5.793l4 4 4-4v1.414z' fill='%23adadad' fillrule='nonzero'/%3E%3C/svg%3E") 100% no-repeat;border:1px solid #959595;border-radius:0;width:100%;height:32px;margin:0;padding:0 .5em;font-family:inherit;font-size:.85em;display:block}.esri-select[disabled]{cursor:auto}.esri-select::-ms-expand{display:none}.esri-disabled a,.esri-disabled [role=menu],.esri-disabled [role=checkbox],.esri-disabled [class^=esri-icon-],.esri-disabled [class*=" esri-icon-"]{color:var(--calcite-color-text-3)}.keynav-mode .esri-widget:focus,.keynav-mode .esri-widget :focus{z-index:1;outline-offset:2px;outline:2px solid #adadad}.esri-widget__loader-animation{border:.15em solid #adadad4d;border-top-color:var(--calcite-color-border-input);border-radius:100%;width:1em;height:1em;font-size:var(--calcite-font-size-md);animation:1.25s linear infinite esri-rotate;display:block;transform:translateZ(0)}:dir(rtl) .esri-widget__table th{text-align:right;border-left:3px solid #0000000d;border-right:none}:dir(rtl) .esri-select{background-position:0}:dir(rtl) .esri-menu__list-item{border-left:none;border-right:3px solid #0000}:dir(rtl) .esri-menu__list-item [class^=esri-icon-],:dir(rtl) .esri-menu__list-item [class*=" esri-icon-"]{padding-left:2px;padding-right:0}:dir(rtl) .esri-menu__list-item--active{border-right-color:var(--calcite-color-brand)}.esri-icon-font-fallback-text{clip:rect(0 0 0 0);width:1px;height:1px;position:absolute;overflow:hidden}.esri-rotating{animation:1.25s linear infinite esri-rotate;transform:translateZ(0)}.esri-clearfix:before,.esri-clearfix:after{content:" ";display:table}.esri-clearfix:after{clear:both}.esri-interactive{cursor:pointer}.esri-hidden{display:none!important}.esri-invisible{visibility:hidden!important}.esri-offscreen{position:absolute;top:-999em;left:-999em}.esri-match-height{flex-direction:column;flex:auto;display:flex;overflow:hidden}:host{display:flex}.arcgis-grid-controls{user-select:none;display:flex;flex-flow:column wrap;padding:var(--calcite-spacing-sm);overflow-y:auto;width:100%;.container{display:flex;flex:1 1 auto;flex-direction:column;gap:var(--calcite-spacing-sm)}.numeric-inputs-container{display:grid;grid-auto-columns:1fr;grid-auto-flow:column;gap:var(--calcite-spacing-sm)}arcgis-labeled-switch{margin-block-end:var(--calcite-spacing-sm)}.switch--bordered{border-width:0 0 var(--calcite-spacing-px) 0;border-style:solid;border-color:var(--calcite-color-border-1);padding-block-end:var(--calcite-spacing-sm)}.tile-group{display:flex;column-gap:var(--calcite-spacing-md);align-items:start;margin-bottom:calc(0px - var(--calcite-spacing-sm))}.tile{position:relative;.content{display:flex;flex-direction:column;row-gap:var(--calcite-spacing-md);align-items:center;padding:var(--calcite-spacing-md);color:var(--calcite-color-text-2)}&.disabled{opacity:var(--calcite-opacity-disabled)}&:focus-within{outline:var(--calcite-spacing-base) solid var(--calcite-color-brand);outline-offset:var(--calcite-spacing-base)}input[type=radio]{appearance:none;position:absolute;inset:0;opacity:.001;border:var(--calcite-spacing-px) solid transparent;cursor:pointer;&:checked+.content{border:var(--calcite-spacing-px) solid var(--calcite-color-brand)}+.content{border:var(--calcite-spacing-px) solid transparent;calcite-label{margin-bottom:calc(0px - var(--calcite-label-margin-bottom, .75rem));font-weight:var(--calcite-font-weight-medium)}}}}.inline-icon{margin-left:var(--calcite-spacing-xs);vertical-align:top;color:var(--calcite-color-status-warning)}}calcite-block>.esri-grid-controls{background:0 0;padding:0}.esri-grid-controls{-webkit-user-select:none;user-select:none;padding:var(--esri-widget-padding);flex-flow:column wrap;display:flex;calcite-label.esri-labeled-switch__label{margin-block-end:var(--calcite-spacing-sm, .5rem)}}.esri-grid-controls__switch--bordered{border-width:0 0 var(--calcite-spacing-px) 0;border-style:solid;border-color:var(--calcite-color-border-1)}.esri-grid-controls__container{gap:var(--calcite-spacing-sm);flex-direction:column;flex:auto;display:flex}.esri-grid-controls__tilegroup{column-gap:var(--calcite-spacing-md);align-items:start;display:flex}.esri-grid-controls__tile__content{row-gap:var(--calcite-spacing-md);padding:var(--calcite-spacing-md);color:var(--calcite-color-text-2);flex-direction:column;align-items:center;display:flex}.esri-grid-controls__tile__content calcite-label{margin-bottom:calc(0px - var(--calcite-label-margin-bottom, .75rem));font-weight:var(--calcite-font-weight-medium)}.esri-grid-controls__tile{position:relative}.esri-grid-controls__tile:focus-within{outline:2px solid var(--calcite-color-brand);outline-offset:2px}.esri-grid-controls__tile--disabled{opacity:var(--calcite-opacity-disabled)}.esri-grid-controls__tile input[type=radio]{appearance:none;opacity:.001;border:var(--calcite-spacing-px) solid transparent;cursor:pointer;position:absolute;inset:0}.esri-grid-controls__tile input[type=radio]:checked+.esri-grid-controls__tile__content{border:var(--calcite-spacing-px) solid var(--calcite-color-brand)}.esri-grid-controls__tile input[type=radio]+.esri-grid-controls__tile__content{border:var(--calcite-spacing-px) solid transparent}.esri-grid-controls__numeric-inputs__container{gap:var(--calcite-spacing-sm);grid-auto-columns:1fr;grid-auto-flow:column;display:grid}.esri-grid-controls__inline-icon{margin-left:var(--calcite-spacing-xs);vertical-align:top;color:var(--calcite-color-status-warning)}:host{--response-toolbar-vert-width: 0;--response-toolbar-vert-height: 100%;--response-toolbar-horiz-width: 100%;--response-toolbar-horiz-height: 0}.esri-responsive-toolbar__ruler{opacity:0;pointer-events:none;position:absolute}.esri-responsive-toolbar__ruler--bar{visibility:hidden;height:0;display:block;position:absolute;top:0;left:0;right:0}.esri-responsive-toolbar__ruler--bar--vertical,.esri-responsive-toolbar__ruler--pad--vertical{width:var(--response-toolbar-vert-width);height:var(--response-toolbar-vert-height)}.esri-responsive-toolbar__ruler--pad--horizontal{width:var(--response-toolbar-horiz-width);height:var(--response-toolbar-horiz-height)}.esri-responsive-toolbar__bar>div{display:contents}.esri-responsive-toolbar__bar--horizontal{min-width:100%}.esri-responsive-toolbar__bar--vertical{min-height:100%}.esri-responsive-toolbar__pad{width:min-content;display:contents}.esri-responsive-toolbar__pad>div{display:contents}.esri-responsive-toolbar__ruler--pad--vertical{width:0;height:min(100vh - 120px,100cqh - 120px)}.esri-responsive-toolbar__ruler--pad--horizontal{width:min(100vw - 60px,100cqw - 60px);height:0}.esri-split-button--split-part--vertical--s{max-height:16px}.esri-split-button--split-part--vertical--m{max-height:24px}.esri-split-button--split-part--vertical--l{max-height:40px}.esri-split-button--split-part--horizontal--s,.esri-split-button--split-part--horizontal--m{max-width:16px}.esri-split-button--split-part--horizontal--l{max-width:24px}.esri-snapping-controls__toggle-block{min-width:100%;margin:0}.esri-snapping-controls__layer-list-block{border-bottom:none;min-width:225px}.esri-snapping-controls__layer-list-block[open]{margin-block:0}.esri-snapping-controls__layer-list{overflow:auto}.esri-snapping-controls__layer-list__filter{margin-bottom:10px}.esri-snapping-controls__layer-list__button{margin-bottom:6px}.esri-snapping-controls__layer-list__item calcite-accordion-item calcite-icon,.esri-snapping-controls__layer-list__item calcite-action calcite-icon{margin-inline-start:0}.esri-snapping-controls__layer-list__item calcite-icon{color:var(--calcite-color-brand);margin-inline-start:var(--calcite-list-item-spacing-indent)}.esri-snapping-controls{flex-flow:column wrap;display:flex}.esri-snapping-controls__container{flex-direction:column;flex:auto;display:flex}.esri-snapping-controls__container :only-child{border-block-end:none}.esri-snapping-controls__panel{width:320px}.esri-snapping-controls__item{border:1px solid #adadad4d;cursor:pointer;background-color:var(--calcite-color-foreground-2);border-color:var(--calcite-color-border-1);border-radius:2px;justify-content:space-between;margin:3px 0;padding:3px;transition:border-color .125s ease-in-out;display:flex;box-shadow:0 1px #adadad4d}.esri-snapping-controls__item-action-icon{flex:0 0 16px;width:16px;height:16px;margin-top:.1em;font-size:var(--calcite-font-size-md);display:inline-block}.esri-snapping-controls__action-toggle{opacity:1;cursor:pointer;border:1px solid var(--calcite-color-border-1);flex-flow:row-reverse;justify-content:space-between;align-items:flex-start;width:100%;margin:0;padding:6px 15px;font-size:var(--calcite-font-size-sm);transition:opacity .25s ease-in-out .25s,background-color .25s ease-in-out;display:flex}.esri-snapping-controls__action-toggle .esri-snapping-controls__item-action-title{margin-left:0}.esri-snapping-controls__action-toggle .esri-snapping-controls__item-action-icon{background-color:var(--calcite-color-foreground-1);border-radius:16px;flex:0 0 28px;width:16px;height:16px;padding:0;transition:background-color .125s ease-in-out;position:relative;overflow:hidden;box-shadow:0 0 0 1px #adadad}.esri-snapping-controls__action-toggle .esri-snapping-controls__item-action-icon:before{content:"";background-color:var(--calcite-color-foreground-2);border-radius:100%;width:12px;height:12px;margin:2px;transition:background-color .125s ease-in-out,left .125s ease-in-out;display:block;position:absolute;top:0;left:0;box-shadow:0 0 0 1px #242424}.esri-snapping-controls__action-toggle--on .esri-snapping-controls__item-action-icon{background-color:var(--calcite-color-foreground-1);box-shadow:0 0 0 1px #adadad}.esri-snapping-controls__action-toggle--on .esri-snapping-controls__item-action-icon:before{background-color:var(--calcite-color-foreground-3);left:12px}.esri-snapping-controls__nested-container{flex-direction:column;gap:6px;display:flex}.esri-snapping-controls__nested-container:not(:empty){padding-top:6px;padding-inline-start:1em}.esri-labeled-switch__label{--calcite-label-margin-bottom: 0}.esri-labeled-switch__label-content{text-wrap:balance;flex:1;align-items:center;gap:7px;display:flex}.esri-labeled-switch__label-content>div{flex-grow:1}.esri-labeled-switch__icon{margin-top:-1px}.esri-labeled-switch__icon_info{color:var(--calcite-color-status-info)}.esri-labeled-switch__icon_warning{color:var(--calcite-color-status-warning)}.esri-labeled-switch__tooltip{text-wrap:wrap}:host{display:flex;max-width:100%;justify-content:flex-end;pointer-events:none;--sketch-pad-flex-flow: wrap;--sketch-view-height-offset: 63px ;--sketch-view-margin-offset: 30px;--sketch-popover-header-offset: 49px}:host([scale="s"]){--sketch-view-height-offset: 47px ;--sketch-view-margin-offset: 30px;--sketch-popover-header-offset: 33px}:host([scale="l"]){--sketch-view-height-offset: 79px ;--sketch-view-margin-offset: 30px;--sketch-popover-header-offset: 65px}div:has(>.esri-sketch){display:contents}.esri-sketch{-webkit-user-select:none;user-select:none;pointer-events:none;display:flex}.esri-sketch-pad{gap:var(--arcgis-internal-sketch-gap, var(--calcite-spacing-sm));flex-flow:var(--sketch-pad-flex-flow);justify-content:var(--arcgis-internal-sketch-justify-content, flex-start)}.esri-sketch-pad:dir(rtl){flex-flow:row-reverse wrap}.esri-sketch-pad.esri-sketch--vertical{flex-flow:var(--sketch-pad-flex-flow, column wrap);justify-content:flex-start;--sketch-view-height-offset: 30px;--sketch-view-margin-offset: 15px}.esri-sketch-pad.esri-sketch--vertical:dir(rtl){flex-flow:var(--sketch-pad-flex-flow, column wrap-reverse)}.esri-sketch-pad.esri-sketch--vertical .esri-selection-toolbar__container{flex-direction:column}.esri-sketch>*{pointer-events:initial;display:flex}.esri-sketch-bar{flex-direction:column;gap:0;margin:0;flex-basis:100%}.esri-sketch-bar.esri-sketch--vertical{flex-flow:row}.esri-sketch__popover-wrapper{inline-size:max-content;min-inline-size:300px;max-height:calc(100cqh - (var(--sketch-view-height-offset, 90px)) - var(--sketch-view-margin-offset, 15px) - var(--sketch-popover-header-offset, 1000px));-webkit-user-select:none;user-select:none;max-inline-size:400px;overflow-y:auto}.esri-sketch__popover-wrapper .esri-sketch-tooltip-controls:not(:only-child) calcite-block{border-block-end-width:1px;border-style:solid;border-color:var(--calcite-color-border-3)}.esri-sketch__selection-count-chip--horizontal{margin-block:var(--calcite-spacing-xxs);margin-inline:var(--calcite-spacing-xs);align-self:center}.esri-sketch__selection-count-chip--vertical{margin-block:calc(var(--calcite-spacing-md) * var(--sketch-chip-margin-scale-factor, 1));scale:var(--sketch-chip-rescale, 1);align-self:center;margin-inline:0}.esri-sketch__selection-count-chip--vertical--s{--sketch-chip-rescale: .8;--sketch-chip-margin-scale-factor: .5}.esri-sketch--vertical{max-height:min(100vh - 120px,100cqh - 120px)}.esri-expand__popover-content .esri-sketch{gap:0}.esri-sketch-tooltip-controls{flex-flow:column wrap;min-width:100%;display:flex}.esri-sketch-tooltip-controls__block{border-block-end:none;margin:0}.esri-sketch-tooltip-controls__block-content{flex-direction:column;gap:6px;display:flex}.esri-sketch-tooltip-controls__radio-button-label-wrapper{align-items:center;gap:2px;display:flex}.esri-sketch-tooltip-controls calcite-label:last-child{--calcite-label-margin-bottom: 0}`,Xo=jo(Ko);class Zo extends zi{constructor(){super(),this.widget=Xo(this),this.viewModel=this.widget.viewModel,this._defaultGraphicsLayer=null,this.view=this.widget.view,this.activeTool=this.widget.activeTool,this.autoDestroyDisabled=!1,this.availableCreateTools=this.widget.availableCreateTools,this.createGraphic=this.widget.createGraphic,this.creationMode=this.widget.creationMode,this.defaultCreateOptions=this.widget.defaultCreateOptions,this.defaultGraphicsLayerDisabled=!1,this.defaultUpdateOptions=this.widget.defaultUpdateOptions,this.hideCreateToolsCircle=this.widget.visibleElements.createTools.circle,this.hideCreateToolsMultipoint=this.widget.visibleElements.createTools.multipoint,this.hideCreateToolsPoint=this.widget.visibleElements.createTools.point,this.hideCreateToolsPolygon=this.widget.visibleElements.createTools.polygon,this.hideCreateToolsPolyline=this.widget.visibleElements.createTools.polyline,this.hideCreateToolsRectangle=this.widget.visibleElements.createTools.rectangle,this.hideDuplicateButton=this.widget.visibleElements.duplicateButton,this.hideDeleteButton=this.widget.visibleElements.deleteButton,this.hideSelectionCountLabel=this.widget.visibleElements.selectionCountLabel,this.hideLabelsToggle=this.widget.visibleElements.labelsToggle,this.hideSelectionToolsLassoSelection=this.widget.visibleElements.selectionTools["lasso-selection"],this.hideSelectionToolsRectangleSelection=this.widget.visibleElements.selectionTools["rectangle-selection"],this.hideSettingsMenu=this.widget.visibleElements.settingsMenu,this.hideSnappingControls=this.widget.visibleElements.snappingControls,this.hideSnappingControlsElementsEnabledToggle=this.widget.visibleElements.snappingControlsElements.enabledToggle,this.hideSnappingControlsElementsFeatureEnabledToggle=this.widget.visibleElements.snappingControlsElements.featureEnabledToggle,this.hideSnappingControlsElementsLayerList=this.widget.visibleElements.snappingControlsElements.layerList,this.hideSnappingControlsElementsSelfEnabledToggle=this.widget.visibleElements.snappingControlsElements.selfEnabledToggle,this.hideTooltipsToggle=this.widget.visibleElements.tooltipsToggle,this.hideUndoRedoMenu=this.widget.visibleElements.undoRedoMenu,this.icon=this.widget.icon,this.label=this.widget.label,this.labelOptions=this.widget.labelOptions,this.layer=this.widget.layer,this.layout=this.widget.layout,this.pointSymbol=this.viewModel.pointSymbol,this.polygonSymbol=this.viewModel.polygonSymbol,this.polylineSymbol=this.viewModel.polylineSymbol,this.scale=this.widget.scale,this.toolbarKind=this.widget.toolbarKind,this.showSnappingControlsElementsHeader=this.widget.visibleElements.snappingControlsElements.header,this.showCreateToolsFreehandPolygon=this.widget.visibleElements.createTools.freehandPolygon,this.showCreateToolsFreehandPolyline=this.widget.visibleElements.createTools.freehandPolyline,this.snappingOptions=this.widget.snappingOptions,this.state=this.widget.state,this.tooltipOptions=this.widget.tooltipOptions,this.updateGraphics=this.widget.updateGraphics,this.arcgisCreate=ze(()=>this.widget,"create"),this.arcgisDelete=ze(()=>this.widget,"delete"),this.arcgisPropertyChange=Vi()("state"),this.arcgisReady=Ni(),this.arcgisRedo=ze(()=>this.widget,"redo"),this.arcgisUndo=ze(()=>this.widget,"undo"),this.arcgisUpdate=ze(()=>this.widget,"update"),this.listen("arcgisReady",this._arcgisReadyHandler)}static{this.properties={view:0,activeTool:3,autoDestroyDisabled:5,availableCreateTools:0,createGraphic:0,creationMode:1,defaultCreateOptions:0,defaultGraphicsLayerDisabled:5,defaultUpdateOptions:0,hideCreateToolsCircle:5,hideCreateToolsMultipoint:5,hideCreateToolsPoint:5,hideCreateToolsPolygon:5,hideCreateToolsPolyline:5,hideCreateToolsRectangle:5,hideDuplicateButton:5,hideDeleteButton:5,hideSelectionCountLabel:5,hideLabelsToggle:5,hideSelectionToolsLassoSelection:5,hideSelectionToolsRectangleSelection:5,hideSettingsMenu:5,hideSnappingControls:5,hideSnappingControlsElementsEnabledToggle:5,hideSnappingControlsElementsFeatureEnabledToggle:5,hideSnappingControlsElementsLayerList:5,hideSnappingControlsElementsSelfEnabledToggle:5,hideTooltipsToggle:5,hideUndoRedoMenu:5,icon:1,label:1,labelOptions:0,layer:0,layout:1,pointSymbol:0,polygonSymbol:0,polylineSymbol:0,position:1,referenceElement:1,scale:1,toolbarKind:1,showSnappingControlsElementsHeader:5,showCreateToolsFreehandPolygon:5,showCreateToolsFreehandPolyline:5,snappingOptions:0,state:3,tooltipOptions:0,updateGraphics:0}}static{this.styles=Yo}async cancel(){this.widget?.cancel()}async complete(){this.widget?.complete()}async create(t,i){await this.widget?.create(t,i)}async delete(){this.widget?.delete()}async destroy(){await this.manager.destroy()}async duplicate(){this.widget?.duplicate()}async redo(){this.widget?.redo()}async triggerUpdate(t,i){this.widget?.update(t,i)}async undo(){this.widget?.undo()}_arcgisReadyHandler(){this.defaultGraphicsLayerDisabled||(this._defaultGraphicsLayer=new io({title:"Sketch Layer"}),this.widget.availableCreateTools=["point","polyline","freehandPolyline","polygon","freehandPolygon","rectangle","circle"],this.widget.layer=this._defaultGraphicsLayer,this.el.view?.map?.add(this.widget.layer),this.manager.onLifecycle(()=>x(()=>this.el.view?.map,(t,i)=>{const n=this._defaultGraphicsLayer;!n||this.widget.layer!==n||(i?.allLayers.includes(n)&&i.remove(n),t?.add(n))})),this.manager.onDestroy(()=>{this._defaultGraphicsLayer&&this.el.view?.map?.allLayers.includes(this._defaultGraphicsLayer)&&this.el.view?.map?.remove(this._defaultGraphicsLayer),this._defaultGraphicsLayer?.destroy(),this._defaultGraphicsLayer=null}))}}Hi("arcgis-sketch",Zo);const ot="RampDrawGraphicsLayer",Jo=$i({__name:"draw",setup(e){const{t,availableLocales:i,locale:n}=Ui(),l=h=>t(h?`draw.${h}`:"draw.unknown"),r=qi("iApi"),a=ht(),d=h=>{const w=i.length?i:[n.value],y={};for(const k of w)y[k]=t(h,{},{locale:k});return y};let c=null;const u=Wi("sketchEl");let v=null,g=null,f=null,ce=null,V=!1,B=null,I=[];const Ct=Ki([]);let de;async function ni(){const h=r.keyboardNav;if(!h){console.warn("Keyboard navigation fixture is not available; draw shortcuts are disabled.");return}de&&(h.unregister(de),de=void 0),de=h.register("D",{name:d("draw.keyboard.namespace"),activeHandler:()=>{a.setActiveTool("")},deactiveHandler:()=>{a.setActiveTool(null)},keys:[{key:"P",description:d("draw.keyboard.key.point"),handler:()=>{a.setActiveTool("point")}},{key:"L",description:d("draw.keyboard.key.polyline"),handler:()=>{a.setActiveTool("polyline")}},{key:"G",description:d("draw.keyboard.key.polygon"),handler:()=>{a.setActiveTool("polygon")}},{key:"C",description:d("draw.keyboard.key.circle"),handler:()=>{a.setActiveTool("circle")}},{key:"R",description:d("draw.keyboard.key.rectangle"),handler:()=>{a.setActiveTool("rectangle")}},{key:"E",description:d("draw.keyboard.key.edit"),handler:()=>{a.setActiveTool("edit")}}]})}const pe=h=>{if(ce&&(g?.remove(ce),ce=null),!h)return;let w;switch(h.geometry?.type){case"point":case"multipoint":w=new Ji({color:[255,255,0,.8],size:16,outline:{color:[255,165,0,1],width:3}});break;case"polyline":w=new Bt({color:[255,255,0,.8],width:6});break;default:w=new je({color:[255,255,0,.3],outline:{color:[255,165,0,1],width:3}})}ce=new ke({geometry:h.geometry,symbol:w}),g?.add(ce)};Rt(()=>a.selectedGraphicId,(h,w)=>{if(!(!c||!g)){if(!h)c.cancel(),pe();else if(h!==w){const y=g.graphics.toArray().find(k=>k.attributes&&k.attributes.id===h);y&&(c.triggerUpdate([y]),pe(y))}}});const li=async()=>{if(!g||!c||a.activeTool!=="edit")return;await r.geo.map.viewPromise;const h=r.geo.map.esriView,w={x:h.width/2,y:h.height/2},y={x:w.x,y:w.y,width:20,height:20},k=(await h.hitTest(y)).results.filter(G=>!("graphic"in G)||G.graphic.layer!==g?!1:!!G.graphic.attributes?.id);k.length>0?(f=k[0].graphic,c.triggerUpdate([f]),f.attributes?.id&&a.selectGraphic(f.attributes.id),r.updateAlert(t("draw.graphic.selected",{type:l(f.attributes?.type)}))):(c.cancel(),f=null,a.clearSelection())},ri=async()=>{if(!c||!a.activeTool)return;await r.geo.map.viewPromise;const h=r.geo.map.esriView,w={x:Math.floor(h.width/2),y:Math.floor(h.height/2)},y=h.toMap(w),k=h.extent,G=k.width,X=k.height,he=Math.min(G,X)/10;let N;switch(a.activeTool){case"point":N=new ke({geometry:new Ue({x:y.x,y:y.y,spatialReference:h.spatialReference}),symbol:c.pointSymbol});break;case"polyline":N=new ke({geometry:new xe({paths:[[[y.x-he/2,y.y],[y.x+he/2,y.y]]],spatialReference:h.spatialReference}),symbol:c.polylineSymbol});break;case"polygon":case"rectangle":const m=he/2;N=new ke({geometry:new se({rings:[[[y.x-m,y.y-m],[y.x+m,y.y-m],[y.x+m,y.y+m],[y.x-m,y.y+m],[y.x-m,y.y-m]]],spatialReference:h.spatialReference}),symbol:c.polygonSymbol||new je({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})});break;case"circle":const C=he/2,Ie=36,Re=[];for(let fe=0;fe<=Ie;fe++){const De=fe/Ie*2*Math.PI,D=y.x+C*Math.cos(De),O=y.y+C*Math.sin(De);Re.push([D,O])}N=new ke({geometry:new se({rings:[Re],spatialReference:h.spatialReference}),symbol:c.polygonSymbol||new je({color:[255,0,255,.3],outline:{color:[255,0,255,1],width:1}})});break;default:console.warn("Unknown tool type:",a.activeTool);return}if(N){const m=`graphic-${Date.now()}`;N.attributes={id:m,type:a.activeTool},g?.add(N),a.addGraphic({id:m,type:a.activeTool,geometry:N.geometry,attributes:N.attributes}),a.activeTool!=="point"&&(a.clearSelection(),a.setActiveTool(""),r.keyboardNav?.reset(),c.cancel()),r.updateAlert(t("draw.graphic.created",{type:l(a.activeTool)}))}},Mt=h=>{const w=r.geo.map.esriView?.container;if(!(!document.activeElement||!w?.contains(document.activeElement)))switch(h.key){case"Enter":if(h.preventDefault(),a.activeTool&&a.activeTool!=="edit")if((a.activeTool==="polyline"||a.activeTool==="polygon")&&(V||I.length===0)){const k=r.geo.map.esriView,G={x:Math.floor(k.width/2),y:Math.floor(k.height/2)},X=k.toMap(G);V?(I.push([X.x,X.y]),a.activeTool==="polyline"?B.geometry=new xe({paths:[I],spatialReference:k.spatialReference}):B.geometry=new se({rings:[I],spatialReference:k.spatialReference}),r.updateAlert(t("draw.multiPoint.pointAdded",{type:l(a.activeTool),count:I.length}))):(V=!0,I=[[X.x,X.y]],a.activeTool==="polyline"?B=new ke({geometry:new xe({paths:[I],spatialReference:k.spatialReference}),symbol:c?.polylineSymbol||new Bt({color:[0,0,255,1],width:2})}):B=new ke({geometry:new se({rings:[I],spatialReference:k.spatialReference}),symbol:c?.polygonSymbol||new je({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})}),B.attributes={id:`temp-graphic-${Date.now()}`,type:a.activeTool},g?.add(B),r.updateAlert(t("draw.multiPoint.started",{type:l(a.activeTool),count:1})))}else ri();else li();break;case"Delete":case"Backspace":const y=r.geo.map.esriView;V&&I.length>1?(h.preventDefault(),I.pop(),a.activeTool==="polyline"?B.geometry=new xe({paths:[I],spatialReference:y.spatialReference}):B.geometry=new se({rings:[I],spatialReference:y.spatialReference}),B.set("geometry",B?.geometry),r.updateAlert(t("draw.multiPoint.pointRemoved",{type:l(a.activeTool??void 0),count:I.length}))):V&&I.length===1?(h.preventDefault(),B&&g?.remove(B),B=null,I=[],V=!1,r.updateAlert(t("draw.multiPoint.canceled"))):f&&(h.preventDefault(),c?.delete(),g?.remove(f),typeof a.removeGraphic=="function"&&a.removeGraphic(f.attributes.id),f=null,pe(void 0),r.updateAlert(t("draw.graphic.deleted")));break;case"Escape":a.setActiveTool(null),c?.cancel(),f=null,pe(void 0),a.clearSelection(),r.updateAlert(t("draw.tool.canceled"));break}},St=h=>{const w=r.geo.map.esriView.container;if(!document.activeElement||!w?.contains(document.activeElement)||!f||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(h.key))return;h.preventDefault(),h.stopPropagation();const y=10,k=h.shiftKey,G=h.altKey,X=r.geo.map.esriView;let he=0,N=0;h.key==="ArrowLeft"&&(he=-y),h.key==="ArrowRight"&&(he=y),h.key==="ArrowUp"&&(N=-y),h.key==="ArrowDown"&&(N=y);const m=f.geometry;let C;if(m.type==="point")C={x:m.x,y:m.y};else{const O=m.extent;C={x:(O.xmin+O.xmax)/2,y:(O.ymin+O.ymax)/2}}const Ie=X.toScreen(new Ue({x:C.x,y:C.y,spatialReference:X.spatialReference}));Ie.x+=he,Ie.y+=N;const Re=X.toMap(Ie),fe=Re.x-C.x,De=Re.y-C.y;let D;if(m.type==="point")!k&&!G?D=new Ue({x:m.x+fe,y:m.y+De,spatialReference:m.spatialReference}):k?(D=m.clone(),r.updateAlert(t("draw.point.resize.unsupported"))):G&&(D=m.clone(),r.updateAlert(t("draw.point.rotate.unsupported")));else if(m.type==="polyline"){if(!k&&!G){const O=m.paths.map(A=>A.map(([H,$])=>[H+fe,$+De]));D=new xe({paths:O,spatialReference:m.spatialReference})}else if(k){const O=m,A=h.key==="ArrowUp"||h.key==="ArrowRight"?1.05:.95,H=O.paths.map($=>$.map(([_e,Te])=>[C.x+(_e-C.x)*A,C.y+(Te-C.y)*A]));D=new xe({paths:H,spatialReference:m.spatialReference})}else if(G){const O=m,A=h.key==="ArrowLeft"?-.05:h.key==="ArrowRight"?.05:0;if(A!==0){const H=Math.cos(A),$=Math.sin(A),_e=O.paths.map(Te=>Te.map(([st,nt])=>{const Fe=st-C.x,Be=nt-C.y,lt=Fe*H-Be*$,rt=Fe*$+Be*H;return[C.x+lt,C.y+rt]}));D=new xe({paths:_e,spatialReference:m.spatialReference})}else D=m.clone()}}else if(m.type==="polygon"){if(!k&&!G){const O=m.rings.map(A=>A.map(([H,$])=>[H+fe,$+De]));D=new se({rings:O,spatialReference:m.spatialReference})}else if(k){const O=m,A=h.key==="ArrowUp"||h.key==="ArrowRight"?1.05:.95,H=O.rings.map($=>$.map(([_e,Te])=>[C.x+(_e-C.x)*A,C.y+(Te-C.y)*A]));D=new se({rings:H,spatialReference:m.spatialReference})}else if(G){const O=m,A=h.key==="ArrowLeft"?-.05:h.key==="ArrowRight"?.05:0;if(A!==0){const H=Math.cos(A),$=Math.sin(A),_e=O.rings.map(Te=>Te.map(([st,nt])=>{const Fe=st-C.x,Be=nt-C.y,lt=Fe*H-Be*$,rt=Fe*$+Be*H;return[C.x+lt,C.y+rt]}));D=new se({rings:_e,spatialReference:m.spatialReference})}else D=m.clone()}}if(D){f.geometry=D,f.set("geometry",D),pe(f),f.attributes?.id&&a.updateGraphicGeometry(f.attributes.id,D);const O=k?"resized":G?"rotated":"moved";r.updateAlert(t(`draw.graphic.${O}`))}},ai=async h=>{const w=(await r.geo.map.esriView.hitTest(h)).results.find(y=>"graphic"in y&&y.graphic.layer===g&&!!y.graphic.attributes?.id);w&&a.activeTool==="edit"?c?.triggerUpdate([w.graphic]):(c?.cancel(),f=null,a.clearSelection(),pe())},ci=async()=>{await r.geo.map.viewPromise,r.geo.layer.getLayer(ot)?g=r.geo.layer.getLayer(ot).esriLayer:(g=r.geo.layer.createLayer({id:ot,layerType:Zi.GRAPHIC,cosmetic:!0,system:!0,url:""}),await r.geo.map.addLayer(g)),g?.esriLayer&&(g=g.esriLayer),Object.assign(u.value,{view:r.geo.map.esriView,layer:g,availableCreateTools:["point","multipoint","polyline","polygon","rectangle","circle"],updateOnGraphicClick:!0,visibleElements:{createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{enable:!0},settingsMenu:!1},defaultUpdateOptions:{highlightOptions:{enabled:!1}}}),r.geo.map.esriView.ui.add(u.value,"bottom-right"),u.value?.addEventListener("arcgisCreate",h=>Ot(h.detail)),u.value?.addEventListener("arcgisUpdate",h=>pi(h.detail)),v={remove:()=>u.value?.removeEventListener("arcgisCreate",h=>Ot(h.detail))},c=u.value,r.geo.map.esriView.on("click",ai),document.addEventListener("keydown",Mt),document.addEventListener("keydown",St,{capture:!0})},di=()=>{if(!de)return;const h=r.keyboardNav;if(!h){de=void 0;return}h.unregister(de),de=void 0},Lt=()=>{di(),c&&(r.geo.map.esriView&&r.geo.map.esriView.ui.remove(c),v&&v.remove(),c.destroy()),document.removeEventListener("keydown",Mt),document.removeEventListener("keydown",St,{capture:!0}),V=!1,B=null,I=[],c=null,g=null},Ot=h=>{if(h.state==="complete"){const w=h.graphic,y=`graphic-${Date.now()}`;w.attributes=w.attributes||{},w.attributes.id=y,a.addGraphic({id:y,type:h.tool,geometry:w.geometry,attributes:w.attributes}),h.tool!=="point"&&(a.setActiveTool(""),r.keyboardNav?.reset())}},pi=h=>{const w=h.graphics[0];if(w)if(h.state==="start"){if(a.activeTool!=="edit"){c.cancel();return}f=w,w.attributes?.id&&(a.selectGraphic(w.attributes.id),r.updateAlert(t("draw.graphic.selected",{type:l(w.attributes?.type)})))}else h.state==="active"?pe(w):h.state==="complete"&&w.attributes?.id&&(a.updateGraphicGeometry(w.attributes.id,w.geometry),r.updateAlert(t("draw.graphic.updated")))};return ji(()=>{ni(),ci(),Ct.push(r.event.on(Ft.MAP_DESTROYED,()=>{Lt()}))}),Rt(()=>a.activeTool,h=>{c.cancel(),pe(),B=null,I=[],V=!1,h&&h!="edit"&&c.create(h)}),Qi(()=>{Lt(),Ct.forEach(h=>r.event.off(h))}),(h,w)=>(Xi(),Yi("arcgis-sketch",{ref_key:"sketchEl",ref:u,style:{display:"none"}},null,512))}}),si=[{type:"point"},{type:"polyline"},{type:"polygon"},{type:"circle"},{type:"rectangle"}];class es extends eo{store;constructor(t,i){super(t,i),this.store=ht(this.$vApp.$pinia)}_parseConfig(t){if(!t){this.store.setSupportedTypes(si);return}if(t.types!==void 0){const i=(t.types===null?[]:t.types).filter(n=>n.enabled!==!1);this.store.setSupportedTypes(i)}else this.store.setSupportedTypes(si);t.defaultTool&&this.store.setActiveTool(t.defaultTool)}get graphicsLayerId(){return ot}}const ts={en:{"draw.multiPoint.started":"{type} drawing started with 1 point","draw.multiPoint.pointAdded":"Point added {count} points total","draw.multiPoint.pointRemoved":"Point removed {count} points remaining","draw.multiPoint.canceled":"Drawing canceled","draw.multiPoint.completed":"{type} completed with {count} points","draw.multiPoint.notEnoughPoints":"Not enough points for {type} minimum {min} required","draw.graphic.created":"{type} created","draw.graphic.selected":"{type} selected","draw.graphic.deselected":"Graphic deselected","draw.graphic.deleted":"Graphic deleted","draw.graphic.updated":"Graphic updated","draw.graphic.none":"No graphic found","draw.tool.canceled":"Drawing tool canceled","draw.point.resize.unsupported":"Resizing not supported for point graphics","draw.point.rotate.unsupported":"Rotation not supported for point graphics","draw.move.up":"Moved up","draw.move.down":"Moved down","draw.move.left":"Moved left","draw.move.right":"Moved right","draw.resize.increase":"Increased size","draw.resize.decrease":"Decreased size","draw.rotate.clockwise":"Rotated clockwise","draw.rotate.counterclockwise":"Rotated counter-clockwise","draw.button.point":"Draw point","draw.button.polyline":"Draw line","draw.button.polygon":"Draw polygon","draw.button.rectangle":"Draw rectangle","draw.button.circle":"Draw circle","draw.point.tooltip":"Draw point","draw.polyline.tooltip":"Draw polyline","draw.polygon.tooltip":"Draw polygon","draw.circle.tooltip":"Draw circle","draw.rectangle.tooltip":"Draw rectangle","draw.edit.tooltip":"Edit Mode","draw.keyboard.namespace":"Draw Tools","draw.keyboard.key.point":"Draw a point","draw.keyboard.key.polyline":"Draw a line","draw.keyboard.key.polygon":"Draw a polygon","draw.keyboard.key.circle":"Draw a circle","draw.keyboard.key.rectangle":"Draw a rectangle","draw.keyboard.key.edit":"Edit geometry","draw.graphic.moved":"Graphic moved","draw.shape":"shape","draw.point":"point","draw.multipoint":"multipoint","draw.polyline":"polyline","draw.polygon":"polygon","draw.rectangle":"rectangle","draw.circle":"circle","draw.unknown":"unknown"},fr:{"draw.multiPoint.started":"Dessin de {type} commenc\xE9 avec 1 point","draw.multiPoint.pointAdded":"Point ajout\xE9","draw.multiPoint.pointRemoved":"Point supprim\xE9","draw.multiPoint.canceled":"Dessin annul\xE9","draw.multiPoint.completed":"{type} termin\xE9 avec {count} points","draw.multiPoint.notEnoughPoints":"Pas assez de points pour {type}","draw.graphic.created":"{type} cr\xE9\xE9","draw.graphic.selected":"{type} s\xE9lectionn\xE9","draw.graphic.deselected":"Graphique d\xE9s\xE9lectionn\xE9","draw.graphic.deleted":"Graphique supprim\xE9","draw.graphic.updated":"Graphique mis \xE0 jour","draw.graphic.none":"Aucun graphique trouv\xE9","draw.tool.canceled":"Outil de dessin annul\xE9","draw.point.resize.unsupported":"Le redimensionnement n'est pas pris en charge pour les points","draw.point.rotate.unsupported":"La rotation n'est pas prise en charge pour les points","draw.move.up":"D\xE9plac\xE9 vers le haut","draw.move.down":"D\xE9plac\xE9 vers le bas","draw.move.left":"D\xE9plac\xE9 vers la gauche","draw.move.right":"D\xE9plac\xE9 vers la droite","draw.resize.increase":"Taille augment\xE9e","draw.resize.decrease":"Taille r\xE9duite","draw.rotate.clockwise":"Rotation dans le sens horaire","draw.rotate.counterclockwise":"Rotation dans le sens antihoraire","draw.button.point":"Dessiner un point","draw.button.polyline":"Dessiner une ligne","draw.button.polygon":"Dessiner un polygone","draw.button.rectangle":"Dessiner un rectangle","draw.button.circle":"Dessiner un cercle","draw.point.tooltip":"Dessiner un point","draw.polyline.tooltip":"Dessiner une polyligne","draw.polygon.tooltip":"Dessiner un polygone","draw.circle.tooltip":"Dessiner un cercle","draw.rectangle.tooltip":"Dessiner un rectangle","draw.edit.tooltip":"Mode \xE9dition","draw.keyboard.namespace":"Outils de dessin","draw.keyboard.key.point":"Dessine un point","draw.keyboard.key.polyline":"Dessine une ligne","draw.keyboard.key.polygon":"Dessine un polygone","draw.keyboard.key.circle":"Dessine un cercle","draw.keyboard.key.rectangle":"Dessine un rectangle","draw.keyboard.key.edit":"Mode \xE9dition","draw.graphic.moved":"Graphique d\xE9plac\xE9","draw.shape":"forme","draw.point":"indiquer","draw.multipoint":"multipoint","draw.polyline":"polyligne","draw.polygon":"polygone","draw.rectangle":"rectangle","draw.circle":"cercle","draw.unknown":"inconnue"}};class is extends es{async init(){Object.entries(ts).forEach(i=>this.$iApi.$i18n.mergeLocaleMessage(...i)),this._parseConfig(this.config),ht(this.$vApp.$pinia).supportedTypes.forEach(i=>{const n=`${i.type}-icon`;this.$iApi.component(n,to(go(Object.assign({"./icons/circle-icon.vue":()=>import("./circle-icon-D1s6aq5r.js"),"./icons/edit-icon.vue":()=>import("./edit-icon-Bvy5yElH.js"),"./icons/point-icon.vue":()=>import("./point-icon-5wWrBoxA.js"),"./icons/polygon-icon.vue":()=>import("./polygon-icon-CV_tVWdR.js"),"./icons/polyline-icon.vue":()=>import("./polyline-icon-BWRJ8nl9.js"),"./icons/rectangle-icon.vue":()=>import("./rectangle-icon-C_eA1re1.js")}),`./icons/${i.type}-icon.vue`,3)))});const{el:t}=this.mount(Jo,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(t.childNodes[0])}async added(){this.$iApi.event.on(Ft.MAP_CREATED,()=>{this.init()})}}const os=Object.freeze(Object.defineProperty({__proto__:null,default:is},Symbol.toStringTag,{value:"Module"}));export{os as a,Oe as c,Xt as e,bt as i,gt as r};
