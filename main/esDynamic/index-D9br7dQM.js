import{fy as K,jk as v,jl as N,fz as j,fC as T,fN as _,ar as M,fQ as B,e8 as h,fU as z,fG as d,e9 as m,ea as t,fM as g,fJ as C,fI as A,fS as V,fL as R,jm as $,F as U,jn as y,jo as I}from"./main-6gYsRPh_.js";const q={en:{"keyboardnav.activeNamespace":"Namespace Active: {name}","keyboardnav.helpTitle":"Keyboard Shortcuts","keyboardnav.keysTitle":"Keys for {name}","keyboardnav.helpDescription":'Press <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">S</span> to start fixture shortcuts then type the fixture key (for example <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">D</span>) followed by an action key like <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Use <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Escape</span> to clear the chain or <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Backspace</span> to undo the last key.',"keyboardnav.noShortcuts":"No shortcuts available.","keyboardnav.mainShortcuts.title":"Global controls","keyboardnav.mainShortcuts.numbers":"Focus on an open panel (1 being leftmost)","keyboardnav.mainShortcuts.escape":"Clear the chain or close the focused panel","keyboardnav.mainShortcuts.start":"Start or reset fixture shortcuts","keyboardnav.mainShortcuts.backspace":"Remove the last key in the chain","keyboardnav.chain.help":"Toggle shortcut guide"},fr:{"keyboardnav.activeNamespace":"Espace de noms actif : {name}","keyboardnav.helpTitle":"Raccourcis clavier","keyboardnav.keysTitle":"Raccourcis pour {name}","keyboardnav.helpDescription":`Appuyez sur <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">S</span> pour d\xE9marrer les raccourcis de module puis saisissez la touche du module (par exemple <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">D</span>) suivie d'une touche d'action comme <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Utilisez <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">\xC9chap</span> pour effacer la cha\xEEne ou <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Retour</span> pour enlever la derni\xE8re touche.`,"keyboardnav.noShortcuts":"Aucun raccourci disponible.","keyboardnav.mainShortcuts.title":"Contr\xF4les globaux","keyboardnav.mainShortcuts.numbers":"Concentrer sur un panneau ouvert (1 \xE9tant le plus \xE0 gauche)","keyboardnav.mainShortcuts.escape":"Effacer la cha\xEEne ou fermer le panneau actif","keyboardnav.mainShortcuts.start":"D\xE9marrer ou r\xE9initialiser les raccourcis de module","keyboardnav.mainShortcuts.backspace":"Retirer la derni\xE8re touche de la cha\xEEne","keyboardnav.chain.help":"Afficher ou masquer le guide des raccourcis"}},O=["aria-label"],F={class:"border-b border-gray-200 bg-white px-4 py-20 sm:px-24"},G={class:"text-base font-semibold text-gray-900"},J=["innerHTML"],P={role:"list",class:"m-0 max-w-[calc(var(--container-lg)-(--spacing(8)))] list-none divide-y divide-zinc-900/5 p-0 dark:divide-white/5"},Q={class:"pl-24 mb-8 py-16"},W={class:"flex items-center gap-x-12"},X={class:"font-mono text-md text-zinc-600"},Y={class:"space-y-4 p-16 pl-24"},Z={class:"flex items-center gap-x-12"},ee={class:"font-mono text-md text-zinc-600"},ne={class:"flex items-center gap-x-12"},te={class:"font-mono text-md text-zinc-600"},ae={class:"flex items-center gap-x-12"},ie={class:"font-mono text-md text-zinc-600"},re={class:"flex items-center gap-x-12"},se={class:"font-mono text-md text-zinc-600"},ce={key:0,class:"pl-24 mb-8 py-16 border-b"},oe={class:"font-mono text-md text-zinc-600"},le={class:"flex items-center gap-x-4"},de={class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},pe={class:"font-mono text-md text-zinc-600"},ue={key:0,class:"space-y-4 p-16 pl-24"},ge={class:"flex items-center gap-x-4"},be={class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},he={class:"font-mono text-md text-zinc-600"},E='button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])',me=K({__name:"keyboardnav",setup(w){const a=v(),{activeNamespace:n,namespaces:e,helpVisible:p}=N(a),{t:s}=j(),u=T(()=>Object.entries(e.value).map(([r,i])=>({id:r,keys:i?.keys??[]}))),c=_("dialogRef"),l=V("iApi"),o=M(null);function f(r){return r?(r.tabIndex<0&&r.setAttribute("tabindex","-1"),r):null}function x(){const r=c.value;if(!r)return;const i=r.querySelector(E);f(i??r)?.focus({preventScroll:!0})}function L(){const r=l?.geo?.map?.esriView?.container??document.getElementById("esriMap");return r?r.querySelector(".esri-view-surface")??r.querySelector(E)??r:null}function H(){const r=L(),i=o.value&&document.contains(o.value)?o.value:null;f(r??i)?.focus({preventScroll:!0}),o.value=null}function S(){a.setHelpVisible(!1),a.resetChain({suppressHandler:!0})}function D(r){r.target===r.currentTarget&&S()}return B(p,async r=>{r?(o.value=document.activeElement instanceof HTMLElement?document.activeElement:null,await $(),p.value&&x()):(await $(),p.value||H())}),(r,i)=>d(p)?(m(),h("div",{key:0,class:"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity pointer-events-auto",tabindex:"-1",onClick:D},[t("div",{ref_key:"dialogRef",ref:c,class:"relative w-[640px] max-h-[80vh] overflow-y-auto rounded-xl bg-white py-8 px-10 shadow-xl",role:"dialog","aria-modal":"true","aria-live":"polite"},[t("button",{type:"button",class:"absolute right-8 top-8 text-gray-500 hover:text-black focus:text-black p-4","aria-label":d(s)("panels.controls.close"),onClick:S},i[0]||(i[0]=[t("svg",{class:"fill-current w-16 h-16",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512"},[t("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})],-1)]),8,O),t("div",F,[t("h3",G,g(d(s)("keyboardnav.helpTitle")),1),t("div",{innerHTML:d(s)("keyboardnav.helpDescription"),class:"mt-6 text-sm text-gray-500"},null,8,J)]),t("ul",P,[t("li",Q,[t("div",W,[t("span",X,g(d(s)("keyboardnav.mainShortcuts.title")),1)]),t("div",Y,[t("div",Z,[i[1]||(i[1]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," 1-5 ",-1)),i[2]||(i[2]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",ee,g(d(s)("keyboardnav.mainShortcuts.numbers")),1)]),t("div",ne,[i[3]||(i[3]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," ESC ",-1)),i[4]||(i[4]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",te,g(d(s)("keyboardnav.mainShortcuts.escape")),1)]),t("div",ae,[i[5]||(i[5]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," S ",-1)),i[6]||(i[6]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",ie,g(d(s)("keyboardnav.mainShortcuts.start")),1)]),t("div",re,[i[7]||(i[7]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," Backspace ",-1)),i[8]||(i[8]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",se,g(d(s)("keyboardnav.mainShortcuts.backspace")),1)])])]),u.value.length===0?(m(),h("li",ce,[t("p",oe,g(d(s)("keyboardnav.noShortcuts")),1)])):z("",!0),(m(!0),h(C,null,A(u.value,b=>(m(),h("li",{key:b.id,class:"pl-24 mb-8 py-16 border-b"},[t("div",{class:R(["flex items-center gap-x-12",{"opacity-60":d(n)&&d(n)!==b.id}])},[t("div",le,[i[9]||(i[9]=t("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},"S",-1)),t("span",de,g(b.id),1)]),i[10]||(i[10]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",pe,g(d(s)(`keyboardnav.ns.${b.id}`)),1)],2),b.keys.length?(m(),h("div",ue,[(m(!0),h(C,null,A(b.keys,k=>(m(),h("div",{key:k.key,class:"flex items-center gap-x-12"},[t("div",ge,[t("span",be,g(k.key),1)]),i[11]||(i[11]=t("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),t("span",he,g(d(s)(`keyboardnav.key.${b.id}.${k.key}`)),1)]))),128))])):z("",!0)]))),128))])],512)])):z("",!0)}});class fe extends U{keyboardnavStore=v(this.$vApp.$pinia);_isInput(a){return!a||!(a instanceof HTMLElement)?!1:!!a.closest('input, textarea, [contenteditable="true"]')}register(a,n){const e=a.toUpperCase(),p=this.keyboardnavStore.register(e,n),s=`keyboardnav.ns.${p}`;return Object.entries(n.name).forEach(([u,c])=>{this.$iApi.$i18n.mergeLocaleMessage(u,{[s]:c})}),n.keys.forEach(u=>{const c=`keyboardnav.key.${p}.${u.key}`;Object.entries(u.description).forEach(([l,o])=>{this.$iApi.$i18n.mergeLocaleMessage(l,{[c]:o})})}),p}unregister(a){this.keyboardnavStore.unregister(a.toUpperCase())}reset(){const a=this.keyboardnavStore,n=a.activeNamespace??a.keyChain[1];return n?(a.setChain([y,n]),a.setLastAction(void 0),a.setChainState("awaitAction"),a.activeNamespace=n,"reset"):(a.resetChain({suppressHandler:!0}),"reset")}clear(a){return this.keyboardnavStore.resetChain({event:a,suppressHandler:!0}),"clear"}added(){const a=this.$iApi.$rootEl;a?.addEventListener("keydown",this._handleKeyDown),a?.addEventListener("blur",this._handleBlur)}removed(){const a=this.$iApi.$rootEl;a?.removeEventListener("keydown",this._handleKeyDown),a?.removeEventListener("blur",this._handleBlur)}_handleKeyDown=a=>{if(!(a instanceof KeyboardEvent))return;const n=a;if(this._isInput(n.target))return;const e=this.keyboardnavStore,p=e.keyChain,s=n.altKey||n.ctrlKey||n.metaKey;if(!n.shiftKey&&!s&&!p.length&&/^[1-5]$/.test(n.key)){const l=parseInt(n.key,10)-1,o=this.$iApi.panel.visible[l];o&&(n.preventDefault(),this.$iApi.panel.focus(o));return}const u=n.key,c=u.length===1?u.toUpperCase():u;if(!s&&c==="Escape"&&e.helpVisible){n.preventDefault(),e.setHelpVisible(!1),e.resetChain({suppressHandler:!0});return}if(!n.shiftKey&&!s&&c===y){n.preventDefault();const l=e.chainState==="complete";e.resetChain({suppressHandler:l}),e.setChain([y]),e.setLastAction(void 0),e.setChainState("awaitNamespace");return}if(e.chainState==="idle"){if(c==="Escape"&&!n.shiftKey&&!s){const l=n.target.closest("[data-cy]");if(l&&this.$iApi.$rootEl?.querySelector(".panel-container")?.contains(l)){n.preventDefault();const o=l.getAttribute("data-cy");o&&this.$iApi.panel.close(o)}}return}if(c==="Escape"){n.preventDefault(),e.resetChain({event:n});return}if(c==="Backspace"){if(!p.length)return;n.preventDefault();const l=e.chainState;if(e.setLastAction(void 0),e.popChain(),!e.keyChain.length){e.resetChain({suppressHandler:!0});return}if(e.keyChain.length===1){e.setChainState("awaitNamespace"),e.deactivate(n);return}if(e.keyChain.length===2){e.setChainState("awaitAction");const o=e.keyChain[1];l==="complete"&&o&&e.activate(o,n,{suppressHandler:!1});return}return}if(!(n.shiftKey||s)){if(e.chainState==="awaitNamespace"){const l=Object.keys(e.namespaces);if(c==="H"){n.preventDefault(),e.appendKey("H"),e.setLastAction({namespace:I,key:"H"}),e.finalizeChain({event:n}),e.setHelpVisible(!e.helpVisible);return}if(l.includes(c)){n.preventDefault(),e.appendKey(c),e.setLastAction(void 0),e.activate(c,n),e.setChainState("awaitAction");return}return}if(e.chainState==="awaitAction"){const l=e.activeNamespace??(p[1]||""),o=e.namespaces[l];if(!o){e.resetChain({suppressHandler:!0});return}if(!o.keys.map(x=>x.key.toUpperCase()).includes(c))return;n.preventDefault(),e.appendKey(c);const f=e.trigger(c,n);if(f?.chainAction)return;f&&e.setLastAction(f),e.finalizeChain({event:n});return}}};_handleBlur=()=>{this.keyboardnavStore.resetChain(),this.keyboardnavStore.setHelpVisible(!1)}}class xe extends fe{added(){Object.entries(q).forEach(e=>this.$iApi.$i18n.mergeLocaleMessage(...e));const{destroy:a,el:n}=this.mount(me,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(n.childNodes[0]),super.added(),this.removed=()=>{super.removed(),a(),v(this.$vApp.$pinia).$reset()}}}export{xe as default};
