import{F as p,i4 as i,iw as c,ix as s,iy as u,iz as g,iA as m,fy as L,fz as f,fE as v,e9 as I,fH as b,ea as y,fG as S,fF as x,fS as C,hg as A,hh as E,hi as w}from"./main-6gYsRPh_.js";class R extends p{_parseConfig(e){const l=e?.headerControls?.slice()??["wizard","layerReorder","groupToggle","visibilityToggle"];if(i(this.$vApp.$pinia).headerControls=l,!e||!e.root.children)return;i(this.$vApp.$pinia).multilineItems=e.multilineItems?.enabled??!0;const r=[1,2,3,4,5,6];!e.multilineItems?.maxLines||!r.includes(e.multilineItems?.maxLines)?i(this.$vApp.$pinia).maxLines=3:i(this.$vApp.$pinia).maxLines=e.multilineItems.maxLines,this.handlePanelWidths(["legend"]),this.handlePanelTeleports(["legend"]);const a=this.getLayerFixtureConfigs();e.root.children.forEach(t=>{t.layerLegendConfigs=a,this.addItem(t)}),this.$iApi.geo.layer.allLayers().forEach(t=>{this.updateLegend(t)})}createItem(e,l){let r;e.layerId===void 0?r=new c(this.$iApi,e,l):(e.sublayerIndex!==void 0&&(e.layerId=this.$iApi.geo.layer.sublayerId(e.layerId,e.sublayerIndex)),r=new s(this.$iApi,e,l));const a=e.children;return a&&a.forEach(t=>{e.layerLegendConfigs!==void 0&&(t.layerLegendConfigs=e.layerLegendConfigs),r.children.push(this.createItem(t,r))}),r}addItem(e,l){const r=e instanceof u?e:this.createItem(e,l);return this._insertItem(r,l),r}async addLayerItem(e,l){const r=new s(this.$iApi,{layerId:e.id,sublayerIndex:e.isSublayer?e.layerIdx:void 0,name:e.name},l);return this._insertItem(r,l),this.updateLegend(e),r}get config(){return super.config}getLegend(){return i(this.$vApp.$pinia).children||[]}getLegendConfig(){return{root:{children:this.getLegend().map(e=>e.getConfig())}}}getItem(e){const l=this.getLegend();let r;return l.some(a=>(r=this.searchTreeFirst(a,t=>t.uid===e),r!==void 0)),r}getLayerItem(e){let l,r,a;return typeof e=="string"?(r=e,l=e):(r=e.id,l=e.uid),this.getLegend().some(t=>(a=this.searchTreeFirst(t,n=>n instanceof s&&(n.layerId===r||n.uid===l)),a!==void 0)),a}getAllExpanded(e){const l=e??!0;return this.searchLegend(r=>r.children.length>0&&r.expanded===l)}getAllVisible(e){const l=e??!0;return this.searchLegend(r=>r.visibility===l)}getLayerBoundItems(e){let l="";const r=e instanceof g?e:this.$iApi.geo.layer.getLayer(e);if(r)l=r.isSublayer?r.parentLayer?.id||"":r.id;else return[];return this.searchLegend(a=>a instanceof s&&(a.layerId===l||a.parentLayerId===l))}updateLegend(e){const l=(r,a)=>{const t=this.getLayerItem(r);a?(t&&r instanceof g&&(t.layer=r),t?.error()):t?.load(r instanceof g?r:void 0)};e.loadPromise().then(()=>{let r=this.getLayerItem(e);if(e.layerType===m.MAPIMAGE){const a=t=>{if(t.isLayerRoot&&!t.isLogicalLayer)r=this.getLayerItem(e),l(e,!1),r&&!r.treeGrown&&(t.children.map(n=>this._treeWalker(e,n)).map(n=>this.addItem(n,r)),r.treeGrown=!0),t.children.forEach(n=>a(n));else if(!t.isLayerRoot&&!t.isLogicalLayer){if(r=this.getLayerItem(this.$iApi.geo.layer.sublayerId(e.id,t.layerIdx)),r){const n=r.getConfig();delete n.layerId,delete n.sublayerIndex,delete n.children,n.name||delete n.name;const o={...this._treeWalker(e,t),...n},d=this.createItem(o);this._replaceItem(r,d)}t.children.forEach(n=>a(n))}else t.isLogicalLayer&&l(this._treeWalker(e,t).layer,!1)};a(e.getLayerTree())}else l(e,!1)}).catch(()=>{l(e,!0),e.supportsSublayers&&e.config.sublayers.forEach(r=>{l(this.$iApi.geo.layer.sublayerId(e.id,r.index),!0)})})}expandItems(e,l){const r=this.getLegend(),a=l===void 0?r:l.children;l!==void 0&&this._toggleState(l,{expanded:e}),a.forEach(t=>{this._toggleState(t,{expanded:e})})}showItems(e,l){const r=this.getLegend(),a=l===void 0?r:l.children;l!==void 0&&this._toggleState(l,{visibility:e}),a.forEach(t=>{this._toggleState(t,{visibility:e})})}reloadLayerItem(e){const l=this.getLayerBoundItems(e);return l.forEach(r=>r.reload()),l.length>0}removeItem(e){const l=typeof e=="string"?this.getItem(e):e;return l!==void 0?this._deleteItem(l):!1}removeLayerItem(e){const l=this.getLayerItem(e);return l!==void 0?this._deleteItem(l):!1}searchTreeFirst(e,l){if(l(e))return e;{let r;return e.children.some(a=>(r=this.searchTreeFirst(a,l),r!==void 0)),r}}searchTreeAll(e,l){const r=[],a=[e];for(;a.length>0;){const t=a.shift();t&&l(t)&&r.push(t),t&&a.push(...t.children)}return r}searchLegend(e){return this.getLegend().map(l=>this.searchTreeAll(l,e)).flat()}_toggleState(e,l){const r=l.visibility,a=l.expanded;r!==void 0&&e.toggleVisibility(r),a!==void 0&&e.children.length>0&&e.toggleExpanded(a),e.children&&e.children.length>0&&e.children.forEach(t=>{this._toggleState(t,l)})}_insertItem(e,l){i(this.$vApp.$pinia).addItem({item:e,parent:l})}_deleteItem(e){const l=i(this.$vApp.$pinia),r=a=>{a.children.length>0&&a.children.forEach(t=>{r(t)}),a instanceof s&&a.handlers.forEach(t=>this.$iApi.event.off(t)),l.removeItem(a)};return r(e),!0}_replaceItem(e,l){i(this.$vApp.$pinia).replaceItem({oldItem:e,newItem:l})}_treeWalker(e,l,r){const a=(n=>{const o=[e];for(;o.length>0;){const d=o.shift();if(d&&d.uid===n)return d;d&&o.push(...d.sublayers)}})(l.uid),t={};return l.isLayerRoot&&!l.isLogicalLayer?(t.layer=a,t.name=a.name,t.children=l.children.map(n=>this._treeWalker(e,n,r))):!l.isLayerRoot&&!l.isLogicalLayer?(t.name=l.name,t.children=l.children.map(n=>this._treeWalker(e,n,r))):l.isLogicalLayer&&(t.layer=a,t.name=a.name,t.layerId=a.id,t.sublayerIndex=e.isSublayer?e.layerIdx:void 0),{...t,...r}}}const $=L({__name:"nav-button",setup(h){const{t:e}=f(),l=C("iApi"),r=()=>{l.panel.toggle("legend")};return(a,t)=>{const n=x("mapnav-button");return I(),v(n,{onClickFunction:r,tooltip:S(e)("legend.title")},{default:b(()=>t[0]||(t[0]=[y("svg",{class:"fill-current w-32 h-20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[y("path",{d:"M0 0h24v24H0z",fill:"none"}),y("path",{d:"M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"})],-1)])),_:1},8,["tooltip"])}}}),_={en:{"legend.title":"Legend","legend.header.addlayer":"Add Layer","legend.header.reorderlayers":"Reorder Layers","legend.header.groups":"Toggle Groups","legend.header.groups.expand":"Expand All","legend.header.groups.collapse":"Collapse All","legend.header.visible":"Toggle Visibility","legend.header.visible.show":"Show All Layers","legend.header.visible.hide":"Hide All Layers","legend.group.expand":"Expand Group","legend.group.collapse":"Collapse Group","legend.visibility.showLayer":"Show layer","legend.visibility.hideLayer":"Hide layer","legend.visibility.showSymbol":"Show symbol","legend.visibility.hideSymbol":"Hide symbol","legend.visibility.showGroup":"Show group","legend.visibility.hideGroup":"Hide group","legend.symbology.expand":"Expand legend","legend.symbology.hide":"Hide legend","legend.symbology.loading":"Loading...","legend.layer.data":"Show more data","legend.layer.data.only":"Layer not on map","legend.layer.offscale":"Layer out of scale","legend.layer.zoomToVisible":"Zoom to visible scale","legend.layer.options":"More options","legend.layer.controls.metadata":"Metadata","legend.layer.controls.settings":"Settings","legend.layer.controls.datatable":"Datatable","legend.layer.controls.symbology":"Legend","legend.layer.controls.boundaryzoom":"Zoom to Layer Boundary","legend.layer.controls.cancel":"Cancel","legend.layer.controls.remove":"Remove","legend.layer.controls.reload":"Reload","legend.layer.controls.reloadDisabled":"Layer cannot be reloaded","legend.layer.features.count":"{count} features","legend.layer.type.ESRIFeature":"ESRI Feature Layer","legend.layer.type.ESRIMapImage":"ESRI Map Image Layer","legend.layer.type.ESRITile":"ESRI Tile Layer","legend.layer.type.ESRIImagery":"ESRI Image Service","legend.layer.type.ESRIGraphic":"ESRI Graphic Layer","legend.layer.type.wfs":"OGC WFS 3.0 Layer","legend.layer.type.wms":"OGC WMS Layer","legend.layer.type.geoJson":"GeoJSON Layer","legend.layer.type.csv":"CSV File Layer","legend.layer.type.shapefile":"Shapefile Layer","legend.layer.type.osm":"OpenStreetMap Tile Layer","legend.layer.type.datatable":"ESRI Table Layer","legend.layer.type.dataCsv":"Non-Spatial CSV File Layer","legend.layer.type.dataJson":"Compact JSON File Layer","legend.layer.type.sublayer":"Sublayer","legend.layer.type.unknown":"Unknown Layer Type","legend.alert.symbologyExpanded":"Layer legend expanded","legend.alert.symbologyCollapsed":"Layer legend collapsed","legend.alert.groupExpanded":"Legend group expanded","legend.alert.groupCollapsed":"Legend group collapsed","legend.alert.layerAdded":"{name} layer added to legend","legend.alert.layerRemoved":"{name} layer removed from legend"},fr:{"legend.title":"L\xE9gende","legend.header.addlayer":"Ajouter une couche","legend.header.reorderlayers":"R\xE9organiser les couches","legend.header.groups":"Basculer les Groupes","legend.header.groups.expand":"\xC9largir les groupes","legend.header.groups.collapse":"R\xE9duire les groupes","legend.header.visible":"Basculer la Visibilit\xE9","legend.header.visible.show":"Montrer tous les couches","legend.header.visible.hide":"Cacher tous les couches","legend.group.expand":"D\xE9velopper un groupe","legend.group.collapse":"R\xE9duire un groupe","legend.visibility.showLayer":"Afficher la couche","legend.visibility.hideLayer":"Masquer la couche","legend.visibility.showSymbol":"Afficher le symbole","legend.visibility.hideSymbol":"Masquer le symbole","legend.visibility.showGroup":"Afficher le groupe","legend.visibility.hideGroup":"Masquer le groupe","legend.symbology.expand":"D\xE9velopper la l\xE9gende","legend.symbology.hide":"Masquer la l\xE9gende","legend.symbology.loading":"Chargement en cours...","legend.layer.data":"Afficher plus de donn\xE9es","legend.layer.data.only":"Couche non visualisable","legend.layer.offscale":"Couche hors de port\xE9e","legend.layer.zoomToVisible":"Zoom sur l'\xE9chelle visible","legend.layer.options":"Plus d'options","legend.layer.controls.metadata":"M\xE9tadonn\xE9es","legend.layer.controls.settings":"Param\xE8tres","legend.layer.controls.datatable":"Tableau de donn\xE9es","legend.layer.controls.symbology":"L\xE9gende","legend.layer.controls.boundaryzoom":"Zoomer \xE0 la limite","legend.layer.controls.cancel":"Annuler","legend.layer.controls.remove":"Retirer","legend.layer.controls.reload":"Recharger","legend.layer.controls.reloadDisabled":"Le calque ne peut pas \xEAtre recharg\xE9","legend.layer.features.count":"{count} fonctionnalit\xE9s","legend.layer.type.ESRIFeature":"Couche d'entit\xE9s ESRI","legend.layer.type.ESRIMapImage":"Couche d'image cartographique ESRI","legend.layer.type.ESRITile":"Couche de tuiles ESRI","legend.layer.type.ESRIImagery":"Service d'images ESRI","legend.layer.type.ESRIGraphic":"Couche graphique ESRI","legend.layer.type.wfs":"Couche OGC WFS 3.0","legend.layer.type.wms":"Couche WMS OGC","legend.layer.type.geoJson":"Couche GeoJSON","legend.layer.type.csv":"Couche de fichier CSV","legend.layer.type.shapefile":"Couche Shapefile","legend.layer.type.osm":"Couche de tuiles OpenStreetMap","legend.layer.type.datatable":"Couche de table ESRI","legend.layer.type.dataCsv":"Couche de fichier CSV non spatiale","legend.layer.type.dataJson":"Couche de fichiers JSON compacte","legend.layer.type.sublayer":"Sous-couche","legend.layer.type.unknown":"Type de couche inconnu","legend.alert.symbologyExpanded":"L\xE9gende de la couche d\xE9velopp\xE9e","legend.alert.symbologyCollapsed":"L\xE9gende de la couche r\xE9duite","legend.alert.groupExpanded":"Groupe de l\xE9gende d\xE9velopp\xE9","legend.alert.groupCollapsed":"Groupe de l\xE9gende r\xE9duit","legend.alert.layerAdded":"{name} couche ajout\xE9e \xE0 la l\xE9gende","legend.alert.layerRemoved":"Couche {name} retir\xE9 de la l\xE9gende"}};class M extends R{added(){this.$iApi.component("legend-nav-button",$),this.$iApi.panel.register({legend:{screens:{"legend-screen":()=>A(import("./screen-DFVDA4uZ.js"))},style:{width:"350px"},alertName:"legend.title",button:{tooltip:"legend.title",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none" /><path d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z" /></svg>'}}},{i18n:{messages:_}}),this._parseConfig(this.config!==void 0?JSON.parse(JSON.stringify(this.config)):void 0);const e=this.$vApp.$watch(()=>this.config,l=>this._parseConfig(l!==void 0?JSON.parse(JSON.stringify(l)):void 0));this.removed=()=>{e(),this.$iApi.fixture.exists("appbar")&&E(this.$vApp.$pinia).removeButton("legend"),this.$iApi.fixture.exists("mapnav")&&w(this.$vApp.$pinia).removeItem("legend"),i().$reset(),this.$iApi.panel.remove("legend")}}}export{M as default};
