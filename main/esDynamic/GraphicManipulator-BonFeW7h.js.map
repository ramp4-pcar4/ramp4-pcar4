{"version":3,"file":"GraphicManipulator-BonFeW7h.js","sources":["../../node_modules/@arcgis/core/views/interactive/support/utils.js","../../node_modules/@arcgis/core/views/interactive/GraphicManipulator.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{pt2px as o}from\"../../../core/screenUtils.js\";function s(s){let t=0,a=0,e=0;return s?(\"cim\"===s.type&&s.data.symbol&&\"symbolLayers\"in s.data.symbol&&s.data.symbol.symbolLayers&&s.data.symbol.symbolLayers.map(o=>{\"CIMVectorMarker\"===o.type&&o.anchorPoint&&(Math.abs(o.anchorPoint.x)>t&&(t=o.anchorPoint.x),Math.abs(o.anchorPoint.y)>a&&(a=o.anchorPoint.y),null!=o.size&&o.size>e&&(e=o.size))}),t=o(t),a=o(a),e=o(e),{offsetX:t,offsetY:a,size:e}):{offsetX:t,offsetY:a,size:e}}export{s as getSymbolInfo};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as t}from\"tslib\";import e from\"../../core/Accessor.js\";import{EventEmitter as o}from\"../../core/Evented.js\";import{watch as i,sync as s}from\"../../core/reactiveUtils.js\";import{screenPointObjectToArray as r,pt2px as l,createScreenPointArray as n}from\"../../core/screenUtils.js\";import{property as a}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as c}from\"../../core/accessorSupport/decorators/subclass.js\";import{squaredDistance as h}from\"../../core/libs/gl-matrix-2/math/vec2.js\";import{k as p}from\"../../chunks/vec32.js\";import{create as m}from\"../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{canProjectWithoutEngine as u,project as y}from\"../../geometry/projectionUtils.js\";import{projectPointToVector as g}from\"../../geometry/projection/projectPointToVector.js\";import{getGraphicEffectiveElevationMode as b}from\"../../support/elevationInfoUtils.js\";import{getDefaultSymbol2D as d}from\"../../symbols/support/defaults.js\";import f from\"../../symbols/support/ElevationInfo.js\";import{getSymbolInfo as _}from\"./support/utils.js\";import{intersectsDrapedGeometry as v}from\"../support/drapedUtils.js\";let S=class extends e{set graphic(t){this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set(\"graphic\",t),this.attachSymbolChanged()}get elevationInfo(){const{layer:t}=this.graphic,e=t&&\"elevationInfo\"in t?t.elevationInfo:null,o=b(this.graphic),i=e?e.offset:0;return new f({mode:o,offset:i})}set focusedSymbol(t){t!==this._get(\"focusedSymbol\")&&(this._set(\"focusedSymbol\",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get(\"grabbing\")&&(this._set(\"grabbing\",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get(\"hovering\")&&(this._set(\"hovering\",t),this._updateGraphicSymbol())}set selected(t){t!==this._get(\"selected\")&&(this._set(\"selected\",t),this._updateGraphicSymbol(),this.events.emit(\"select-changed\",{action:t?\"select\":\"deselect\"}))}get _focused(){return this._get(\"hovering\")||this._get(\"grabbing\")}constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new o,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set(\"view\",null)}intersectionDistance(t){const e=this.graphic;if(!1===e.visible)return null;const o=e.geometry;if(null==o)return null;const i=this._get(\"focusedSymbol\"),s=null!=i?i:e.symbol;return\"2d\"===this.view.type?this._intersectDistance2D(this.view,t,o,s):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=i(()=>this.graphic?.symbol,t=>{null!=t&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))},s)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,o,i){if(null==(i=i||d(o)))return null;const s=1;let n=this._circleCollisionCache;if(\"point\"===o.type&&\"cim\"===i.type&&\"CIMPointSymbol\"===i.data.symbol?.type&&i.data.symbol.symbolLayers){const{offsetX:l,offsetY:n,size:a}=_(i),c=r(e,j),p=a/2,m=t.toScreen(o),u=m.x+l,y=m.y+n;return h(c,[u,y])<p*p?s:null}if(\"point\"!==o.type||\"simple-marker\"!==i.type)return v(e,o,t)?s:null;if(null==n||!n.originalPoint.equals(o)){const e=o,s=t.spatialReference;if(u(e.spatialReference,s)){const t=y(e,s);n={originalPoint:e.clone(),mapPoint:t,radiusPx:l(i.size)},this._circleCollisionCache=n}}if(null!=n){const o=r(e,j),a=t.toScreen?.(n.mapPoint);if(!a)return null;const c=n.radiusPx,p=a.x+l(i.xoffset),m=a.y-l(i.yoffset);return h(o,[p,m])<c*c?s:null}return null}_intersectDistance3D(t,e,o){const i=t.toMap(e,{include:[o]});return i&&g(i,C,t.renderSpatialReference)?p(C,t.state.camera.eye):null}};t([a({constructOnly:!0,nonNullable:!0})],S.prototype,\"graphic\",null),t([a()],S.prototype,\"elevationInfo\",null),t([a({constructOnly:!0,nonNullable:!0})],S.prototype,\"view\",void 0),t([a({value:null})],S.prototype,\"focusedSymbol\",null),t([a({constructOnly:!0})],S.prototype,\"layer\",void 0),t([a()],S.prototype,\"interactive\",void 0),t([a()],S.prototype,\"selectable\",void 0),t([a()],S.prototype,\"grabbable\",void 0),t([a({value:!1})],S.prototype,\"grabbing\",null),t([a()],S.prototype,\"dragging\",void 0),t([a()],S.prototype,\"hovering\",null),t([a({value:!1})],S.prototype,\"selected\",null),t([a()],S.prototype,\"cursor\",void 0),S=t([c(\"esri.views.interactive.GraphicManipulator\")],S);const C=m(),j=n();export{S as GraphicManipulator};\n"],"names":["s","t","a","e","o","S","b","i","f","d","n","l","_","c","r","j","m","u","y","h","v","p","g","C"],"mappings":"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","x_google_ignoreList":[0,1]}