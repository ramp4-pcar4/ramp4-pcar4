{"version":3,"file":"index-DTxjHeNj.js","sources":["../../src/fixtures/swipe/swipe.vue","../../src/fixtures/swipe/index.ts"],"sourcesContent":["<template>\n    <div class=\"swipe-container\">\n        <div class=\"verticalLine\" :style=\"{ left: linePosition, height: lineHeight, bottom: lineBottom }\"></div>\n        <input\n            v-model=\"sliderPosition\"\n            :id=\"'layerSlider' + iApi.$element._uid\"\n            class=\"layerSliderElement\"\n            type=\"range\"\n            ref=\"slider\"\n            min=\"0\"\n            aria-valuemin=\"0\"\n            aria-valuemax=\"90\"\n            :aria-valuenow=\"sliderPosition\"\n            :aria-label=\"$t('map.layerSwipe.label')\"\n            max=\"90\"\n            step=\"0.5\"\n            :content=\"$t('map.layerSwipe.drag')\"\n            v-tippy=\"{ followCursor: true, trigger: 'mouseenter' }\"\n            :style=\"{ 'z-index': 10 }\"\n        />\n        <arcgis-swipe\n            direction=\"horizontal\"\n            :swipe-position=\"swipeComponentPosition\"\n            :view=\"view\"\n            auto-destroy-disable\n            ref=\"swipeComponent\"\n        ></arcgis-swipe>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { FixtureInstance, GlobalEvents } from '@/api';\nimport { computed, inject, onBeforeMount, onBeforeUnmount, onMounted, ref, useTemplateRef } from 'vue';\nimport { usePanelStore } from '@/stores/panel';\nimport type { InstanceAPI, LayerInstance } from '@/api';\nimport type { EsriMapView } from '@/geo/esri';\nimport type { BasemapChange } from '@/geo/api';\n\nconst iApi = inject('iApi') as InstanceAPI;\n\nconst panelStore = usePanelStore();\nconst slider = useTemplateRef('slider');\nconst sliderPosition = ref<number>(45);\nconst clientHeight = ref<number>(0);\nconst refreshCounter = ref(0);\nconst swipeComponentPosition = ref<number>(50);\nconst view = ref<EsriMapView>();\nconst swipeComponent = ref<HTMLArcgisSwipeElement | null | undefined>();\n\nconst linePosition = computed(() => {\n    const thumbWidth = 30 + refreshCounter.value - refreshCounter.value;\n    const sliderWidth = slider.value?.getBoundingClientRect()\n        ? slider.value?.getBoundingClientRect().right - slider.value?.getBoundingClientRect().left\n        : 0;\n    const inputToPercentage = +sliderPosition.value / 90; // Percentage of the slider that the slider thumb has surpassed\n    const sliderOffset = (sliderWidth - thumbWidth) * inputToPercentage; // Number of pixels within slider that slider thumb has surpassed\n    const pos = (slider.value?.getBoundingClientRect().x ?? 0) + sliderOffset + (thumbWidth - 5.25) / 2; // Left position of the vertical line\n\n    // eslint-disable-next-line vue/no-side-effects-in-computed-properties\n    swipeComponentPosition.value = (pos / iApi.$rootEl.clientWidth) * 100 + 0.2;\n\n    return `${pos}px`;\n});\n\nconst lineHeight = computed(() => {\n    return `${clientHeight.value}px`;\n});\n\nconst lineBottom = computed(() => {\n    return `${-clientHeight.value / 2 - 18}px`;\n});\n\ndefineProps({\n    fixture: {\n        type: FixtureInstance,\n        required: true\n    },\n    message: String\n});\n\nonBeforeMount(() => {\n    clientHeight.value = iApi.$rootEl?.clientHeight ?? 1200;\n});\n\nconst resizeHandler = () => {\n    clientHeight.value = iApi.$rootEl?.clientHeight ?? clientHeight.value;\n    refreshCounter.value++; // used to force update on window resize\n    setTimeout(() => {\n        refreshCounter.value++; // window minimizing/maximizing requires a second, delayed update\n    }, 50);\n};\n\nconst sliderFocus = () => {\n    panelStore.setOpacity(0.1);\n    slider.value!.style.background = '';\n};\n\nconst sliderBlur = () => {\n    panelStore.setOpacity(1);\n    slider.value!.style.background = 'inherit';\n};\n\nonMounted(async () => {\n    // Used to detect if device has touch capabilities and no mouse. If not, then we make the slider track invisible\n    const isTouch = 'ontouchstart' in document.documentElement || !window.matchMedia('(pointer:fine)').matches;\n    if (!isTouch) {\n        slider.value!.style.background = 'inherit';\n    }\n    window.addEventListener('resize', resizeHandler);\n    slider.value?.addEventListener('focus', sliderFocus);\n    slider.value?.addEventListener('blur', sliderBlur);\n    slider.value?.addEventListener('mouseover', sliderFocus);\n    slider.value?.addEventListener('mouseleave', sliderBlur);\n    slider.value?.addEventListener('touchstart', sliderFocus);\n    slider.value?.addEventListener('touchend', sliderBlur);\n    // TODO: make tooltip follow touch location\n\n    setTimeout(() => {\n        refreshCounter.value++;\n    }, 50);\n\n    await initializeSwipe();\n\n    const clearArcgisTabindex = () => {\n        const swipeContainer = swipeComponent.value?.querySelector('.arcgis-swipe__container');\n        if (swipeContainer) {\n            swipeContainer.removeAttribute('tabindex');\n            return true;\n        }\n        return false;\n    };\n\n    if (!clearArcgisTabindex()) {\n        // remove tabindex from element in arcgis-swipe component that was duplicating our custom slider logic\n        const observer = new MutationObserver((mutations, obs) => {\n            if (clearArcgisTabindex()) {\n                obs.disconnect();\n            }\n        });\n\n        observer.observe(swipeComponent.value!, {\n            childList: true,\n            subtree: true,\n            attributes: false\n        });\n\n        // Fallback: stop observing after 5 seconds\n        setTimeout(() => observer.disconnect(), 5000);\n    }\n\n    // Upon a basemap schema change, geo.map.esriView gets set to a new MapView, meaning that the one used by the\n    // swipe component wouldn't exist. So, we must reinitialize the swipe component\n    iApi.event.on(GlobalEvents.MAP_BASEMAPCHANGE, async (payload: BasemapChange) => {\n        if (payload.schemaChanged) {\n            // Remove all layers\n            swipeComponent.value?.trailingLayers.forEach(layer => {\n                swipeComponent.value?.trailingLayers.remove(layer);\n            });\n            swipeComponent.value?.leadingLayers.forEach(layer => {\n                swipeComponent.value?.leadingLayers.remove(layer);\n            });\n\n            await initializeSwipe();\n        }\n    });\n\n    // When a layer is reloaded, remove it and add it back to the swipe component. Note that timing\n    // will not be considered. Layers will be re-added based on what reloads fastest\n    iApi.event.on(GlobalEvents.LAYER_RELOAD_END, (reloadedLayer: LayerInstance) => {\n        swipeComponent.value?.trailingLayers.forEach(layer => {\n            if (layer.id === reloadedLayer.id) {\n                swipeComponent.value?.trailingLayers.remove(layer);\n                swipeComponent.value?.trailingLayers.add(reloadedLayer.esriLayer!);\n            }\n        });\n\n        swipeComponent.value?.leadingLayers.forEach(layer => {\n            if (layer.id === reloadedLayer.id) {\n                swipeComponent.value?.leadingLayers.remove(layer);\n                swipeComponent.value?.leadingLayers.add(reloadedLayer.esriLayer!);\n            }\n        });\n    });\n\n    // When a layer is removed, remove it from the swipe component\n    iApi.event.on(GlobalEvents.LAYER_REMOVE, (removedLayer: LayerInstance) => {\n        swipeComponent.value?.trailingLayers.forEach(layer => {\n            if (layer.id === removedLayer.id) {\n                swipeComponent.value?.trailingLayers.remove(layer);\n            }\n        });\n\n        swipeComponent.value?.leadingLayers.forEach(layer => {\n            if (layer.id === removedLayer.id) {\n                swipeComponent.value?.leadingLayers.remove(layer);\n            }\n        });\n    });\n});\n\nconst initializeSwipe = async (): Promise<void> => {\n    await iApi.geo.map.viewPromise;\n    view.value = iApi.geo.map.esriView;\n\n    const trailing = ['Nature', 'WFSLayer'];\n    const leading = ['Water', 'GeoMet'];\n\n    trailing.forEach(layerId => {\n        iApi.geo.layer.awaitLayer(layerId, true).then((layerInstance: LayerInstance) => {\n            if (layerInstance.esriLayer) {\n                swipeComponent.value?.trailingLayers.add(layerInstance.esriLayer);\n            } else {\n                console.warn(`Invalid layer instance: ${layerId}`);\n            }\n        });\n    });\n\n    leading.forEach(layerId => {\n        iApi.geo.layer.awaitLayer(layerId, true).then((layerInstance: LayerInstance) => {\n            if (layerInstance.esriLayer) {\n                swipeComponent.value?.leadingLayers.add(layerInstance.esriLayer);\n            } else {\n                console.warn(`Invalid layer instance: ${layerId}`);\n            }\n        });\n    });\n};\n\nonBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeHandler);\n    slider.value?.removeEventListener('focus', () => sliderFocus);\n    slider.value?.removeEventListener('blur', () => sliderBlur);\n    slider.value?.removeEventListener('mouseover', sliderFocus);\n    slider.value?.removeEventListener('mouseleave', sliderBlur);\n    slider.value?.removeEventListener('touchstart', sliderFocus);\n    slider.value?.removeEventListener('touchend', sliderBlur);\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.swipe-container {\n    display: flex;\n    justify-content: center;\n    position: absolute;\n    width: 100%;\n    bottom: 50%;\n    z-index: 0;\n}\n\n.layerSliderElement {\n    height: 5px;\n    width: 90%;\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.layerSliderElement:focus {\n    border: none;\n    outline: none;\n}\n\n.layerSliderElement::-webkit-slider-thumb {\n    width: 30px;\n    height: 25px;\n    -webkit-appearance: none;\n    appearance: none;\n    background: black;\n    cursor: col-resize;\n}\n\n.layerSliderElement::-moz-range-thumb {\n    width: 30px;\n    height: 25px;\n    -webkit-appearance: none;\n    appearance: none;\n    background: black;\n    cursor: col-resize;\n}\n\n.verticalLine {\n    display: flex;\n    align-items: center;\n    position: absolute;\n    padding-right: 5px;\n    z-index: -15;\n    background-color: black;\n}\n</style>\n","import SwipeV from './swipe.vue'; // import on-map component\nimport { FixtureInstance } from '@/api';\n\nclass SwipeFixture extends FixtureInstance {\n    async added(): Promise<void> {\n        const { el, destroy } = this.mount(SwipeV, {\n            app: this.$element,\n            props: { fixture: this }\n        });\n\n        if (el.childNodes[0]) this.$vApp.$el.appendChild(el.childNodes[0]);\n\n        this.removed = (): void => {\n            destroy();\n        };\n    }\n}\n\nexport default SwipeFixture;\n"],"names":["iApi","inject","panelStore","usePanelStore","slider","useTemplateRef","sliderPosition","ref","clientHeight","refreshCounter","swipeComponentPosition","view","swipeComponent","linePosition","computed","thumbWidth","sliderWidth","inputToPercentage","sliderOffset","pos","lineHeight","lineBottom","onBeforeMount","resizeHandler","sliderFocus","sliderBlur","onMounted","initializeSwipe","clearArcgisTabindex","swipeContainer","observer","mutations","obs","GlobalEvents","payload","layer","reloadedLayer","removedLayer","trailing","leading","layerId","layerInstance","onBeforeUnmount","SwipeFixture","FixtureInstance","el","destroy","SwipeV"],"mappings":"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"}