{"version":3,"file":"VertexArrayObject-Afv3uO4x.js","sources":["../../node_modules/@arcgis/core/views/webgl/VertexArrayObject.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{toConst as e}from\"../../core/compilerUtils.js\";import t from\"../../core/Logger.js\";import{disposeMaybe as r}from\"../../core/maybe.js\";import{baseTypedArrayMemory as s}from\"../../core/memoryEstimations.js\";import{ResourceType as i}from\"./enums.js\";import{bindVertexBufferLayout as n}from\"./Util.js\";import{fromBuffers as o}from\"./VertexAttributeLocations.js\";const f=()=>t.getLogger(\"esri.views.webgl.VertexArrayObject\");let h=class t{constructor(t,r,s,i){this._context=t,this._indexBuffer=s,this._buffers=r instanceof Map?r:new Map([[\"geometry\",r]]),this._baseInstances=null==i?new Map:\"number\"==typeof i?new Map([[\"geometry\",i]]):i,this.locations=e(o(this._buffers))}get glName(){return this._glName}get context(){return this._context}get buffers(){return e(this._buffers)}buffer(e=\"geometry\"){return this.buffers.get(e)}get indexBuffer(){return this._indexBuffer}getByteLength(e){return this.buffer(e)?.sizeBytes??0}vertexCount(e){const t=this.buffer(e);return t?t.sizeBytes/t.layout[0].stride:0}get usedMemory(){return Array.from(this._buffers.values()).reduce((e,t)=>e+t.usedMemory,this._indexBuffer?.usedMemory??0+(this._buffers.size+(this._indexBuffer?1:0))*s)}dispose(){this._context?(this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this._indexBuffer=r(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&f().warn(\"Leaked WebGL VAO\")}disposeVAOOnly(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(i.VertexArrayObject,this)),this._context=null):this._glName&&f().warn(\"Leaked WebGL VAO\")}bind(e=this.locations){const t=this._context.gl;this._glName?t.bindVertexArray(this._glName):(this._context.instanceCounter.increment(i.VertexArrayObject,this),this._glName=t.createVertexArray(),t.bindVertexArray(this._glName),this._bindLayout(e))}_bindLayout(e){const{_buffers:t,_indexBuffer:r}=this;if(t||f().error(\"Vertex buffer dictionary is empty!\"),t.forEach((t,r)=>n(this._context,e,t,this._baseInstances.get(r)??0)),null!=r){const e=this._context.gl;this._context.gl.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.glName)}}unbind(){this._context.gl.bindVertexArray(null)}shallowCloneWithBaseInstances(e){return new t(this._context,this._buffers,this._indexBuffer,e)}};export{h as VertexArrayObject};\n"],"names":["f","t","h","r","s","i","e","o","n"],"mappings":"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","x_google_ignoreList":[0]}