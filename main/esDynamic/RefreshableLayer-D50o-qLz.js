import{V as d,b1 as u,ae as m,v as n,x as h,cc as p,z as v,c4 as g,fa as y,i as I}from"./main-CnDVnExo.js";import{a as b}from"./layerContainerType-ChWdCT09.js";const a=new d,o=new WeakMap;function w(r){D(r)&&a.push(new WeakRef(r))}function C(r){const e=a.find(s=>s.deref()===r);e&&a.remove(e)}function D(r){return r!=null&&typeof r=="object"&&"refreshInterval"in r&&"refresh"in r}function l(r,e){return Number.isFinite(r)&&Number.isFinite(e)?e<=0?r:l(e,r%e):0}let f=0,i=0;function R(){const r=Date.now();let e=!1;for(const s of a){const t=s.deref();t?t.refreshInterval&&r-(o.get(t)??0)+5>=6e4*t.refreshInterval&&(o.set(t,r),t.refresh(r)):e=!0}if(e)for(let s=a.length-1;s>=0;s--)a.at(s).deref()||a.removeAt(s)}u(()=>{const r=Date.now();let e=0;for(const s of a){const t=s.deref();t&&(e=l(Math.round(6e4*t.refreshInterval),e),t.refreshInterval?o.get(t)||o.set(t,r):o.delete(t))}if(e!==i){if(i=e,clearInterval(f),i===0)return void(f=0);f=setInterval(R,i)}},m);const c=.1,T=r=>{let e=class extends r{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=g(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||w(this)},()=>{})}destroy(){C(this)}castRefreshInterval(s){return s>=c?s:s<=0?0:c}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){y(this._debounceHasDataChanged()).then(t=>{t&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:t})},t=>{I.getLogger(this).error(t),this.emit("refresh",{dataChanged:!1,error:t})})}async hasDataChanged(){return!0}get test(){}};return n([h({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:b}}}}})],e.prototype,"refreshInterval",void 0),n([p("refreshInterval")],e.prototype,"castRefreshInterval",null),n([h({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),n([h({readOnly:!0})],e.prototype,"refreshParameters",null),e=n([v("esri.layers.mixins.RefreshableLayer")],e),e};export{T as f};
