import{t as S}from"./quickselect-DHTstthl.js";function p(t,n){if(!(this instanceof p))return new p(t,n);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&(typeof n=="function"?this.toBBox=n:this._initFormat(n)),this.clear()}function b(t,n,i){if(!i)return n.indexOf(t);for(var e=0;e<n.length;e++)if(i(t,n[e]))return e;return-1}function u(t,n){x(t,0,t.children.length,n,t)}function x(t,n,i,e,h){h||(h=f(null)),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(var r,a=n;a<i;a++)r=t.children[a],d(h,t.leaf?e(r):r);return h}function d(t,n){return t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),t}function _(t,n){return t.minX-n.minX}function v(t,n){return t.minY-n.minY}function g(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function M(t){return t.maxX-t.minX+(t.maxY-t.minY)}function w(t,n){return(Math.max(n.maxX,t.maxX)-Math.min(n.minX,t.minX))*(Math.max(n.maxY,t.maxY)-Math.min(n.minY,t.minY))}function F(t,n){var i=Math.max(t.minX,n.minX),e=Math.max(t.minY,n.minY),h=Math.min(t.maxX,n.maxX),r=Math.min(t.maxY,n.maxY);return Math.max(0,h-i)*Math.max(0,r-e)}function B(t,n){return t.minX<=n.minX&&t.minY<=n.minY&&n.maxX<=t.maxX&&n.maxY<=t.maxY}function X(t,n){return n.minX<=t.maxX&&n.minY<=t.maxY&&n.maxX>=t.minX&&n.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(t,n,i,e,h){for(var r,a=[n,i];a.length;)(i=a.pop())-(n=a.pop())<=e||(r=n+Math.ceil((i-n)/e/2)*e,S(t,r,n,i,h),a.push(n,r,r,i))}p.prototype={all:function(){return this._all(this.data,[])},search:function(t){var n=this.data,i=[],e=this.toBBox;if(!X(t,n))return i;for(var h,r,a,s,o=[];n;){for(h=0,r=n.children.length;h<r;h++)a=n.children[h],X(t,s=n.leaf?e(a):a)&&(n.leaf?i.push(a):B(t,s)?this._all(a,i):o.push(a));n=o.pop()}return i},collides:function(t){var n=this.data,i=this.toBBox;if(!X(t,n))return!1;for(var e,h,r,a,s=[];n;){for(e=0,h=n.children.length;e<h;e++)if(r=n.children[e],X(t,a=n.leaf?i(r):r)){if(n.leaf||B(t,a))return!0;s.push(r)}n=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var n=0,i=t.length;n<i;n++)this.insert(t[n]);return this}var e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){var h=this.data;this.data=e,e=h}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this},insert:function(t){return t!=null&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=f([]),this},remove:function(t,n){if(t==null)return this;for(var i,e,h,r,a=this.data,s=this.toBBox(t),o=[],l=[];a||o.length;){if(a||(a=o.pop(),e=o[o.length-1],i=l.pop(),r=!0),a.leaf&&(h=b(t,a.children,n))!==-1)return a.children.splice(h,1),o.push(a),this._condense(o),this;r||a.leaf||!B(a,s)?e?(i++,a=e.children[i],r=!1):a=null:(o.push(a),l.push(i),i=0,e=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:_,compareMinY:v,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,n){for(var i=[];t;)t.leaf?n.push.apply(n,t.children):i.push.apply(i,t.children),t=i.pop();return n},_build:function(t,n,i,e){var h,r=i-n+1,a=this._maxEntries;if(r<=a)return u(h=f(t.slice(n,i+1)),this.toBBox),h;e||(e=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,e-1))),(h=f([])).leaf=!1,h.height=e;var s,o,l,c,m=Math.ceil(r/a),Y=m*Math.ceil(Math.sqrt(a));for(E(t,n,i,Y,this.compareMinX),s=n;s<=i;s+=Y)for(E(t,s,l=Math.min(s+Y-1,i),m,this.compareMinY),o=s;o<=l;o+=m)c=Math.min(o+m-1,l),h.children.push(this._build(t,o,c,e-1));return u(h,this.toBBox),h},_chooseSubtree:function(t,n,i,e){for(var h,r,a,s,o,l,c,m;e.push(n),!n.leaf&&e.length-1!==i;){for(c=m=1/0,h=0,r=n.children.length;h<r;h++)o=g(a=n.children[h]),(l=w(t,a)-o)<m?(m=l,c=o<c?o:c,s=a):l===m&&o<c&&(c=o,s=a);n=s||n.children[0]}return n},_insert:function(t,n,i){var e=this.toBBox,h=i?t:e(t),r=[],a=this._chooseSubtree(h,this.data,n,r);for(a.children.push(t),d(a,h);n>=0&&r[n].children.length>this._maxEntries;)this._split(r,n),n--;this._adjustParentBBoxes(h,r,n)},_split:function(t,n){var i=t[n],e=i.children.length,h=this._minEntries;this._chooseSplitAxis(i,h,e);var r=this._chooseSplitIndex(i,h,e),a=f(i.children.splice(r,i.children.length-r));a.height=i.height,a.leaf=i.leaf,u(i,this.toBBox),u(a,this.toBBox),n?t[n-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(t,n){this.data=f([t,n]),this.data.height=t.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},_chooseSplitIndex:function(t,n,i){var e,h,r,a,s,o,l,c;for(o=l=1/0,e=n;e<=i-n;e++)a=F(h=x(t,0,e,this.toBBox),r=x(t,e,i,this.toBBox)),s=g(h)+g(r),a<o?(o=a,c=e,l=s<l?s:l):a===o&&s<l&&(l=s,c=e);return c},_chooseSplitAxis:function(t,n,i){var e=t.leaf?this.compareMinX:_,h=t.leaf?this.compareMinY:v;this._allDistMargin(t,n,i,e)<this._allDistMargin(t,n,i,h)&&t.children.sort(e)},_allDistMargin:function(t,n,i,e){t.children.sort(e);var h,r,a=this.toBBox,s=x(t,0,n,a),o=x(t,i-n,i,a),l=M(s)+M(o);for(h=n;h<i-n;h++)r=t.children[h],d(s,t.leaf?a(r):r),l+=M(s);for(h=i-n-1;h>=n;h--)r=t.children[h],d(o,t.leaf?a(r):r),l+=M(o);return l},_adjustParentBBoxes:function(t,n,i){for(var e=i;e>=0;e--)d(n[e],t)},_condense:function(t){for(var n,i=t.length-1;i>=0;i--)t[i].children.length===0?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():u(t[i],this.toBBox)},_initFormat:function(t){var n=["return a"," - b",";"];this.compareMinX=new Function("a","b",n.join(t[0])),this.compareMinY=new Function("a","b",n.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function y(t,{timeZone:n,timeExtent:i}){return{$view:{scale:t,timeZone:n,timeProperties:{currentStart:i?.start,currentEnd:i?.end}}}}export{y as e,p as i};
