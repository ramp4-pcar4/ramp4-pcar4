{"version":3,"file":"FieldsIndex-DW5_kq4b.js","sources":["../../node_modules/@arcgis/core/layers/support/FieldsIndex.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import i from\"../../core/Logger.js\";import{getOrCreateMapValue as t}from\"../../core/MapUtils.js\";import{UnknownTimeZone as s}from\"../../core/sql/UnknownTimeZone.js\";import{isSerializable as n}from\"../../core/support/jsonUtils.js\";import{isDateField as r,isNumericField as l,isObjectIDField as o,isGlobalIDField as d,getFieldDefaultValue as a,isTimeOnlyField as m,normalizeFieldName as u}from\"./fieldUtils.js\";import{utc as f,unknown as F}from\"../../time/constants.js\";import{fromTimeReference as h}from\"../../time/timeZoneUtils.js\";import{FixedOffsetZone as c,IANAZone as p}from\"luxon\";function y(e){return\"timeZone\"in e}function _(e){return\"timeZone\"in e}function g(e){return\"dateFieldsTimeZone\"in e}const T=new Map;class Z{static fromJSON(e){return new Z(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new Z(e.fields??[],S(e))}static fromLayerJSON(e){return new Z(e.fields??[],S(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const t=[];for(const s of this.fields){const e=s?.name,i=M(e);if(e&&i){const n=w(e);this._fieldsMap.set(e,s),this._fieldsMap.set(n,s),this._normalizedFieldsMap.set(i,s),t.push(`${n}:${s.type}:${this._timeZoneByFieldName?.get(e)}`),r(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):l(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),o(s)||d(s)||(s.editable=null==s.editable||!!s.editable,s.nullable=null==s.nullable||!!s.nullable)}}t.sort(),this.uid=t.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)o(e)||d(e)||e.nullable||void 0!==a(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(w(e))??this._normalizedFieldsMap.get(M(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(t){const s=this.get(t&&\"string\"!=typeof t?t.name:t);return s?this._timeZoneByFieldName?this._timeZoneByFieldName.get(s.name):\"date\"===s.type||\"esriFieldTypeDate\"===s.type?(i.getLogger(\"esri.layers.support.FieldsIndex\").errorOnce(new e(\"getTimeZone:no-timezone-information\",`no time zone information for field '${s.name}'`)),f):N.has(s.type)?F:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===F?s.instance:i===f?c.utcInstance:t(T,i,()=>p.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return m(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>n(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function w(e){return e.trim().toLowerCase()}function M(e){return u(e)?.toLowerCase()??\"\"}const N=new Set([\"time-only\",\"date-only\",\"timestamp-offset\",\"esriFieldTypeDateOnly\",\"esriFieldTypeTimeOnly\",\"esriFieldTypeTimestampOffset\"]);function S(e){const i=new Map;if(!e.fields)return i;const t=!0===e.datesInUnknownTimezone,{timeInfo:s,editFieldsInfo:n}=e,r=(s?\"startField\"in s?s.startField:s.startTimeField:\"\")??\"\",l=(s?\"endField\"in s?s.endField:s.endTimeField:\"\")??\"\",o=g(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?h(e.dateFieldsTimeReference):null,d=n?y(n)?n.timeZone??o:n.dateFieldsTimeReference?h(n.dateFieldsTimeReference):o??f:null,a=s?_(s)?s.timeZone??o:s.timeReference?h(s.timeReference):o:null,m=new Map([[w(n?.creationDateField??\"\"),d],[w(n?.editDateField??\"\"),d],[w(r),a],[w(l),a]]);for(const{name:u,type:f}of e.fields)if(N.has(f))i.set(u,F);else if(\"date\"!==f&&\"esriFieldTypeDate\"!==f)i.set(u,null);else if(t)i.set(u,F);else{const e=m.get(w(u??\"\"))??o;i.set(u,e)}return i}export{Z as default};\n"],"names":["y","e","_","g","T","Z","S","i","t","s","M","n","w","r","l","o","d","a","f","N","F","c","p","m","u","h"],"mappings":"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","x_google_ignoreList":[0]}