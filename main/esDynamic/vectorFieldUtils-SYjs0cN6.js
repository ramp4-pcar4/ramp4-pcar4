import{g2 as ct,aQ as vt}from"./main-6gYsRPh_.js";import{c as C}from"./PixelBlock-CIPHcvhA.js";import{u as ut}from"./pixelRangeUtils-DcEknavd.js";const nt=9,Pt="PixelID";function B(t){return t!=null&&t.pixels?.length>0}function St(t){if(!t?.length||t.some(h=>!B(h)))return null;if(t.length===1)return t[0]?.clone()??null;const l=t,{width:e,height:i,pixelType:s}=l[0];if(l.some(h=>h.width!==e||h.height!==i))return null;const n=l.map(({mask:h})=>h).filter(h=>h!=null);let a=null;n.length&&(a=new Uint8Array(e*i),a.set(n[0]),n.length>1&&xt(n.slice(1),a));const m=[];l.forEach(({pixels:h})=>m.push(...h));const r=l.map(({statistics:h})=>h).filter(h=>h?.length),o=[];return r.forEach(h=>o.push(...h)),new C({pixelType:s,width:e,height:i,mask:a,pixels:m,statistics:o.length?o:null})}function It(t){if(!t)return;const l=t.colormap;if(!l||l.length===0)return;const e=l.sort((r,o)=>r[0]-o[0]),i=e[0][0]<0?e[0][0]:0,s=Math.max(256,e[e.length-1][0]-i+1),n=new Uint8Array(4*s),a=[],m=e[0].length===5;if(s>65536)return e.forEach(r=>{a[r[0]-i]=m?r.slice(1):r.slice(1).concat([255])}),{indexed2DColormap:a,offset:i,alphaSpecified:m};if(t.fillUnspecified){let r=e[0];for(let o=r[0]-i,h=0;o<s;o++)n[4*o]=r[1],n[4*o+1]=r[2],n[4*o+2]=r[3],n[4*o+3]=m?r[4]:255,o===r[0]-i&&(r=h===e.length-1?r:e[++h])}else for(let r=0;r<e.length;r++){const o=e[r],h=4*(o[0]-i);n[h]=o[1],n[h+1]=o[2],n[h+2]=o[3],n[h+3]=m?o[4]:255}return{indexedColormap:n,offset:i,alphaSpecified:m}}function Tt(t,l){if(!B(t)||!l||!l.indexedColormap&&!l.indexed2DColormap)return t;const e=t.clone(),i=e.pixels;let s=e.mask;const n=e.width*e.height;if(i.length!==1)return t;const{indexedColormap:a,indexed2DColormap:m,offset:r,alphaSpecified:o}=l,h=i[0],f=new Uint8Array(h.length),u=new Uint8Array(h.length),p=new Uint8Array(h.length);let c,x=0;if(a){const g=a.length-1;if(s!=null)for(let d=0;d<n;d++)s[d]&&(x=4*(h[d]-r),x<r||x>g?s[d]=0:(f[d]=a[x],u[d]=a[x+1],p[d]=a[x+2],s[d]=a[x+3]));else{s=new Uint8Array(n);for(let d=0;d<n;d++)x=4*(h[d]-r),x<r||x>g?s[d]=0:(f[d]=a[x],u[d]=a[x+1],p[d]=a[x+2],s[d]=a[x+3]);e.mask=s}}else if(m)if(s!=null)for(let g=0;g<n;g++)s[g]&&(c=m[h[g]],f[g]=c[0],u[g]=c[1],p[g]=c[2],s[g]=c[3]);else{s=new Uint8Array(n);for(let g=0;g<n;g++)c=m[h[g]],f[g]=c[0],u[g]=c[1],p[g]=c[2],s[g]=c[3];e.mask=s}return e.pixels=[f,u,p],e.statistics=null,e.pixelType="u8",e.maskIsAlpha=o,e}function _t(t,l){if(!B(t))return null;const{pixels:e,mask:i}=t,s=e.length;let n=l.lut;const{offset:a}=l;n&&n[0].length===1&&(n=e.map(()=>n));const m=[],r=l.outputPixelType||"u8";for(let h=0;h<s;h++){const f=lt(e[h],i,n[h],a||0,r);m.push(f)}const o=new C({width:t.width,height:t.height,pixels:m,mask:i,pixelType:r});return o.updateStatistics(),o}function lt(t,l,e,i,s){const n=t.length,a=C.createEmptyBand(s,n);if(l)for(let m=0;m<n;m++)l[m]&&(a[m]=e[t[m]-i]);else for(let m=0;m<n;m++)a[m]=e[t[m]-i];return a}function Bt(t,l,e){if(!B(t))return;const{width:i,height:s,pixels:n,mask:a}=t,m=i*s,r=new Uint8Array(m);for(let f=1;f<=e.length;f++){const{bandId:u,ranges:p}=e[f-1],c=n[u];if(!c)continue;const x=p.length===1,[g,d]=p[0];for(let y=0;y<m;y++)if(!a||a[y]){const k=c[y];if(x)k>=g&&k<=d&&(r[y]=f);else for(let M=0;M<p.length;M++){const[w,P]=p[M];if(k>=w&&k<=P){r[y]=f;break}}}}const{pixels:o}=l;o.length===1&&(o[1]=o[0].slice(),o[2]=o[0].slice());const h=e.map(f=>f.color);if(l.mask){const f=l.mask;for(let u=0;u<m;u++)if(f[u]){f[u]=255;const p=r[u];if(p){const c=h[p-1];o[0][u]=c[0],o[1][u]=c[1],o[2][u]=c[2],f[u]=c[3]}}}else{const f=new Uint8Array(m).fill(255);for(let u=0;u<m;u++){const p=r[u];if(p){const c=h[p-1];o[0][u]=c[0],o[1][u]=c[1],o[2][u]=c[2],f[u]=c[3]}}l.mask=f}l.maskIsAlpha=!0}function Ct(t,l){if(!B(t))return null;const e=t.clone(),{pixels:i}=e,s=e.width*e.height,n=l.length,a=Math.floor(n/2),m=l[Math.floor(a)],r=i[0],o=new Uint8Array(s),h=new Uint8Array(s),f=new Uint8Array(s);let u=e.mask;const p=l[0].mappedColor.length===4;u||(u=new Uint8Array(s),u.fill(p?255:1),e.mask=u);for(let c=0;c<s;c++)if(u[c]){const x=r[c];let g=!1,d=a,y=m,k=0,M=n-1;for(;M-k>1;){if(x===y.value){g=!0;break}x>y.value?k=d:M=d,d=Math.floor((k+M)/2),y=l[Math.floor(d)]}g||(x===l[k].value?(y=l[k],g=!0):x===l[M].value?(y=l[M],g=!0):x<l[k].value?g=!1:x>l[k].value&&(x<l[M].value?(y=l[k],g=!0):M===n-1?g=!1:(y=l[M],g=!0))),g?(o[c]=y.mappedColor[0],h[c]=y.mappedColor[1],f[c]=y.mappedColor[2],u[c]=y.mappedColor[3]):o[c]=h[c]=f[c]=u[c]=0}return e.pixels=[o,h,f],e.mask=u,e.pixelType="u8",e.maskIsAlpha=p,e}function Dt(t,l,e=!1){const i=new Float32Array(3*nt),s=l.length;for(let n=0;n<nt;n++)i[3*n]=t[2*n]??ct-1,i[3*n+1]=t[2*n+1]??ct,i[3*n+2]=l[n]??0,n<s&&(n>0&&(i[3*n]-=1e-5),t[2*n+1]!==t[2*n]&&(n<s-1||!e)&&(i[3*n+1]-=1e-5));return i}function Rt(t,l){if(!B(t))return null;const{width:e,height:i}=t,{inputRanges:s,outputValues:n,outputPixelType:a,noDataRanges:m,allowUnmatched:r,replacementValue:o,isLastInputRangeInclusive:h}=l,f=t.pixels[0],u=C.createEmptyBand(a,f.length),p=t.mask,c=new Uint8Array(e*i);p?c.set(p):c.fill(255);const x=t.pixelType.startsWith("f")?1e-6:0,g=s.map(w=>w-x);g[0]=s[0],g[g.length-1]=s[s.length-1]+(h?1e-6:0);const d=s.length/2,[y,k]=ut(a);for(let w=0;w<i;w++)for(let P=0;P<e;P++){const v=w*e+P;if(c[v]){const b=f[v];let I=!1;for(let U=d-1;U>=0;U--)if(b===s[2*U]||b>g[2*U]&&b<g[2*U+1]){u[v]=n[U],I=!0;break}I||(r?u[v]=b>k?k:b<y?y:o??b:c[v]=0)}}const M=m?.length;if(M)for(let w=0;w<i;w++)for(let P=0;P<e;P++){const v=w*e+P;if(!p||p[v]){const b=f[v];for(let I=0;I<M;I+=2)if(b>=m[I]&&b<=m[I+1]){u[v]=0,c[v]=0;break}}}return new C({width:e,height:i,pixelType:a,pixels:[u],mask:c})}function pt(t,l,e,i){const s=e!=null&&e.length>=2?new Set(e):null,n=e?.length===1?e[0]:null,a=!!l?.length;for(let m=0;m<t.length;m++)if(i[m]){const r=t[m];if(a){let o=!1;for(let h=0;h<l.length;h+=2)if(r>=l[h]&&r<=l[h+1]){o=!0;break}o||(i[m]=0)}i[m]&&(r===n||s?.has(r))&&(i[m]=0)}}function mt(t,l){const e=t[0].length;for(let i=0;i<e;i++)if(l[i]){let s=!1;for(let n=0;n<t.length;n++)if(t[n][i]){s=!0;break}s||(l[i]=0)}}function xt(t,l){const e=t[0].length;for(let i=0;i<e;i++)if(l[i]){let s=!1;for(let n=0;n<t.length;n++)if(t[n][i]===0){s=!0;break}s&&(l[i]=0)}}function Ft(t,l){if(!B(t))return null;const{width:e,height:i,pixels:s}=t,n=e*i,a=new Uint8Array(n);t.mask?a.set(t.mask):a.fill(255);const m=s.length,{includedRanges:r,noDataValues:o,outputPixelType:h,matchAll:f,lookups:u}=l;if(u){const p=[];for(let c=0;c<m;c++){const x=u[c],g=lt(s[c],a,x.lut,x.offset||0,"u8");p.push(g)}p.length===1?a.set(p[0]):f?mt(p,a):xt(p,a)}else if(f){const p=[];for(let c=0;c<m;c++){const x=new Uint8Array(n);x.set(a),pt(s[c],r?.slice(2*c,2*c+2),o?.[c],x),p.push(x)}p.length===1?a.set(p[0]):mt(p,a)}else for(let p=0;p<m;p++)pt(s[p],r?.slice(2*p,2*p+2),o?.[p],a);return new C({width:e,height:i,pixelType:h,pixels:s,mask:a})}function Nt(t){const{srcPixelType:l,inputRanges:e,outputValues:i,allowUnmatched:s,noDataRanges:n,isLastInputRangeInclusive:a,outputPixelType:m}=t;if(l!=="u8"&&l!=="s8"&&l!=="u16"&&l!=="s16")return null;const r=l.includes("16")?65536:256,o=l.includes("s")?-r/2:0,h=C.createEmptyBand(m,r),f=new Uint8Array(r);s&&f.fill(255);const[u,p]=ut(m);if(e?.length&&i?.length){const c=e.map(x=>x-1e-6);c[0]=e[0],a&&(c[c.length-1]=e[e.length-1]);for(let x=0;x<c.length;x++){const g=i[x]>p?p:i[x]<u?u:i[x],d=Math.ceil(c[2*x]-o),y=e[2*x+1]===e[2*x]?d:Math.floor(c[2*x+1]-o);for(let k=d;k<=y;k++)h[k]=g,f[k]=255}}if(n?.length)for(let c=0;c<n.length;c++){const x=Math.ceil(n[2*c]-o),g=Math.floor(n[2*c+1]-o);for(let d=x;d<=g;d++)f[d]=0}return{lut:h,offset:o,mask:f}}function $t(t,l,e){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;const i=t.includes("16")?65536:256,s=t.includes("s")?-i/2:0,n=new Uint8Array(i);if(l)for(let a=0;a<l.length;a++){const m=Math.ceil(l[2*a]-s),r=Math.floor(l[2*a+1]-s);for(let o=m;o<=r;o++)n[o]=255}else n.fill(255);if(e)for(let a=0;a<e.length;a++)n[e[a]-s]=0;return{lut:n,offset:s}}function Et(t,l,e,i,s,n,a,m){return{xmin:s<=e*t?0:s<e*t+t?s-e*t:t,ymin:n<=i*l?0:n<i*l+l?n-i*l:l,xmax:s+a<=e*t?0:s+a<e*t+t?s+a-e*t:t,ymax:n+m<=i*l?0:n+m<i*l+l?n+m-i*l:l}}function Wt(t,l){if(!t||t.length===0)return null;const e=t.find(c=>c.pixelBlock);if(e?.pixelBlock==null)return null;const i=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width,s=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,n=.01*Math.min(i,s),a=t.sort((c,x)=>Math.abs(c.extent.ymax-x.extent.ymax)>n?x.extent.ymax-c.extent.ymax:Math.abs(c.extent.xmin-x.extent.xmin)>n?c.extent.xmin-x.extent.xmin:0),m=Math.min.apply(null,a.map(c=>c.extent.xmin)),r=Math.min.apply(null,a.map(c=>c.extent.ymin)),o=Math.max.apply(null,a.map(c=>c.extent.xmax)),h=Math.max.apply(null,a.map(c=>c.extent.ymax)),f={x:Math.round((l.xmin-m)/i),y:Math.round((h-l.ymax)/s)},u={width:Math.round((o-m)/i),height:Math.round((h-r)/s)},p={width:Math.round((l.xmax-l.xmin)/i),height:Math.round((l.ymax-l.ymin)/s)};return Math.round(u.width/e.pixelBlock.width)*Math.round(u.height/e.pixelBlock.height)!==a.length||f.x<0||f.y<0||u.width<p.width||u.height<p.height?null:{extent:l,pixelBlock:gt(a.map(c=>c.pixelBlock),u,{clipOffset:f,clipSize:p})}}function it(t,l,e,i,s,n){const{width:a,height:m}=e.block,{x:r,y:o}=e.offset,{width:h,height:f}=e.mosaic,u=Et(a,m,i,s,r,o,h,f);let p=0,c=0;if(n){const x=n.hasGCSSShiftTransform?360:n.halfWorldWidth??0,g=a*n.resolutionX,d=n.startX+i*g;d<x&&d+g>x?c=n.rightPadding:d>=x&&(p=n.leftMargin-n.rightPadding,c=0)}if(u.xmax-=c,typeof l!="number")for(let x=u.ymin;x<u.ymax;x++){const g=(s*m+x-o)*h+(i*a-r)+p,d=x*a;for(let y=u.xmin;y<u.xmax;y++)t[g+y]=l[d+y]}else for(let x=u.ymin;x<u.ymax;x++){const g=(s*m+x-o)*h+(i*a-r)+p;for(let d=u.xmin;d<u.xmax;d++)t[g+d]=l}}function gt(t,l,e={}){const{clipOffset:i,clipSize:s,alignmentInfo:n,blockWidths:a}=e;if(a)return Ot(t,l,{blockWidths:a});const m=t.find(U=>B(U));if(m==null)return null;const r=s?s.width:l.width,o=s?s.height:l.height,h=m.width,f=m.height,u=l.width/h,p=l.height/f,c={offset:i||{x:0,y:0},mosaic:s||l,block:{width:h,height:f}},x=m.pixelType,g=C.getPixelArrayConstructor(x),d=m.pixels.length,y=[];let k,M;for(let U=0;U<d;U++){M=new g(r*o);for(let S=0;S<p;S++)for(let A=0;A<u;A++){const T=t[S*u+A];B(T)&&(k=T.pixels[U],it(M,k,c,A,S,n))}y.push(M)}const w=t.some(U=>U==null||U.mask!=null&&U.mask.length>0),P=t.some(U=>U?.bandMasks&&U.bandMasks.length>1),v=w?new Uint8Array(r*o):void 0,b=P?[]:void 0;if(v){for(let U=0;U<p;U++)for(let S=0;S<u;S++){const A=t[U*u+S],T=A!=null?A.mask:null;it(v,T??(A?255:0),c,S,U,n)}if(b)for(let U=0;U<d;U++){const S=new Uint8Array(r*o);for(let A=0;A<p;A++)for(let T=0;T<u;T++){const D=t[A*u+T],R=D?.bandMasks?.[U]??D?.mask;it(S,R??(D?255:0),c,T,A,n)}b.push(S)}}const I=new C({width:r,height:o,pixels:y,pixelType:x,bandMasks:b,mask:v});return I.updateStatistics(),I}function Ot(t,l,e){const i=t.find(g=>g!=null);if(i==null)return null;const s=t.some(g=>g==null||!!g.mask),{width:n,height:a}=l,m=s?new Uint8Array(n*a):null,{blockWidths:r}=e,o=[],h=i.getPlaneCount(),f=C.getPixelArrayConstructor(i.pixelType);if(s)for(let g=0,d=0;g<t.length;d+=r[g],g++){const y=t[g];if(!B(y))continue;const k=y.mask;for(let M=0;M<a;M++)for(let w=0;w<r[g];w++)m[M*n+w+d]=k==null?255:k[M*y.width+w]}const u=t.some(g=>g?.bandMasks&&g.bandMasks.length>1),p=u?[]:void 0,c=n*a;for(let g=0;g<h;g++){const d=new f(c),y=u?new Uint8Array(c):void 0;for(let k=0,M=0;k<t.length;M+=r[k],k++){const w=t[k];if(!B(w))continue;const P=w.pixels[g];if(P!=null){for(let v=0;v<a;v++)for(let b=0;b<r[k];b++)d[v*n+b+M]=P[v*w.width+b];if(y){const v=w.bandMasks?.[g]??w.mask;for(let b=0;b<a;b++)for(let I=0;I<r[k];I++)y[b*n+I+M]=v?v[b*w.width+I]:255}}}o.push(d),p&&y&&p.push(y)}const x=new C({width:n,height:a,mask:m,bandMasks:p,pixels:o,pixelType:i.pixelType});return x.updateStatistics(),x}function Vt(t,l,e){if(!B(t))return null;const{width:i,height:s}=t,n=l.x,a=l.y,m=e.width+n,r=e.height+a;if(n<0||a<0||m>i||r>s||n===0&&a===0&&m===i&&r===s)return t;t.mask||(t.mask=new Uint8Array(i*s));const o=t.mask;for(let h=0;h<s;h++){const f=h*i;for(let u=0;u<i;u++)o[f+u]=h<a||h>=r||u<n||u>=m?0:1}return t.updateStatistics(),t}function zt(t){if(!B(t))return null;const l=t.clone(),{width:e,height:i,pixels:s}=t,n=s[0],a=l.pixels[0],m=t.mask;for(let r=2;r<i-1;r++){const o=new Map;for(let f=r-2;f<r+2;f++)for(let u=0;u<4;u++){const p=f*e+u;H(o,n[p],m?m[p]:1)}a[r*e]=dt(o),a[r*e+1]=a[r*e+2]=a[r*e];let h=3;for(;h<e-1;h++){let f=(r-2)*e+h+1;H(o,n[f],m?m[f]:1),f=(r-1)*e+h+1,H(o,n[f],m?m[f]:1),f=r*e+h+1,H(o,n[f],m?m[f]:1),f=(r+1)*e+h+1,H(o,n[f],m?m[f]:1),f=(r-2)*e+h-3,G(o,n[f],m?m[f]:1),f=(r-1)*e+h-3,G(o,n[f],m?m[f]:1),f=r*e+h-3,G(o,n[f],m?m[f]:1),f=(r+1)*e+h-3,G(o,n[f],m?m[f]:1),a[r*e+h]=dt(o)}a[r*e+h+1]=a[r*e+h]}for(let r=0;r<e;r++)a[r]=a[e+r]=a[2*e+r],a[(i-1)*e+r]=a[(i-2)*e+r];return l.updateStatistics(),l}function dt(t){if(t.size===0)return 0;let l=0,e=-1,i=0;const s=t.keys();let n=s.next();for(;!n.done;)i=t.get(n.value),i>l&&(e=n.value,l=i),n=s.next();return e}function G(t,l,e){if(e===0)return;const i=t.get(l);i===1?t.delete(l):t.set(l,i-1)}function H(t,l,e){e!==0&&t.set(l,t.has(l)?t.get(l)+1:1)}function ot(t,l,e){let{x:i,y:s}=l;const{width:n,height:a}=e;if(i===0&&s===0&&a===t.height&&n===t.width)return t;const{width:m,height:r}=t,o=Math.max(0,s),h=Math.max(0,i),f=Math.min(i+n,m),u=Math.min(s+a,r);if(f<0||u<0||!B(t))return null;i=Math.max(0,-i),s=Math.max(0,-s);const{pixels:p}=t,c=n*a,x=p.length,g=[];for(let M=0;M<x;M++){const w=p[M],P=C.createEmptyBand(t.pixelType,c);for(let v=o;v<u;v++){const b=v*m;let I=(v+s-o)*n+i;for(let U=h;U<f;U++)P[I++]=w[b+U]}g.push(P)}const d=new Uint8Array(c),y=t.mask;for(let M=o;M<u;M++){const w=M*m;let P=(M+s-o)*n+i;for(let v=h;v<f;v++)d[P++]=y?y[w+v]:1}const k=new C({width:e.width,height:e.height,pixelType:t.pixelType,pixels:g,mask:d});return k.updateStatistics(),k}function wt(t,l=!0){if(!B(t))return null;const{pixels:e,width:i,height:s,mask:n,pixelType:a}=t,m=[],r=Math.round(i/2),o=Math.round(s/2),h=s-1,f=i-1;for(let p=0;p<e.length;p++){const c=e[p],x=C.createEmptyBand(a,r*o);let g=0;for(let d=0;d<s;d+=2)for(let y=0;y<i;y+=2){const k=c[d*i+y];if(l){const M=y===f?k:c[d*i+y+1],w=d===h?k:c[d*i+y+i],P=y===f?w:d===h?M:c[d*i+y+i+1];x[g++]=(k+M+w+P)/4}else x[g++]=k}m.push(x)}let u=null;if(n!=null){u=new Uint8Array(r*o);let p=0;for(let c=0;c<s;c+=2)for(let x=0;x<i;x+=2){const g=n[c*i+x];if(l){const d=x===f?g:n[c*i+x+1],y=c===h?g:n[c*i+x+i],k=x===f?y:c===h?d:n[c*i+x+i+1];u[p++]=g*d*y*k?1:0}else u[p++]=g}}return new C({width:r,height:o,pixelType:a,pixels:m,mask:u})}function jt(t,l,e=0,i=!0){if(!B(t))return null;const{width:s,height:n}=l;let{width:a,height:m}=t;const r=new Map,o={x:0,y:0},h=1+e;let f=t;for(let u=0;u<h;u++){const p=Math.ceil(a/s),c=Math.ceil(m/n);for(let x=0;x<c;x++){o.y=x*n;for(let g=0;g<p;g++){o.x=g*s;const d=ot(f,o,l);r.set(`${u}/${x}/${g}`,d)}}u<h-1&&(f=wt(f,i)),a=Math.round(a/2),m=Math.round(m/2)}return r}function Jt(t){const{pixelBlock:l,tileSize:e,level:i,row:s,col:n,useBilinear:a}=t;if(!B(l))return null;const{width:m,height:r}=e,o=2**i,h=o*m,f=o*r;let u=ot(l,{y:s*f,x:n*h},{width:h,height:f});if(!u)return null;for(let p=i;p>0;p--)u=wt(u,a);return u}function yt(t,l,e,i,s=0){const{width:n,height:a}=t,{width:m,height:r}=l,o=i.cols,h=i.rows,f=Math.ceil(m/o-.1/o),u=Math.ceil(r/h-.1/h);let p,c,x,g,d,y,k;const M=f*o,w=M*u*h,P=new Float32Array(w),v=new Float32Array(w),b=new Uint32Array(w),I=new Uint32Array(w);let U,S,A=0;for(let T=0;T<u;T++)for(let D=0;D<f;D++){p=12*(T*f+D),c=e[p],x=e[p+1],g=e[p+2],d=e[p+3],y=e[p+4],k=e[p+5];for(let R=0;R<h;R++){A=(T*h+R)*M+D*o,S=(R+.5)/h;for(let _=0;_<R;_++)U=(_+.5)/o,P[A+_]=(c*U+x*S+g)*n+s,v[A+_]=(d*U+y*S+k)*a+s,b[A+_]=Math.floor(P[A+_]),I[A+_]=Math.floor(v[A+_])}p+=6,c=e[p],x=e[p+1],g=e[p+2],d=e[p+3],y=e[p+4],k=e[p+5];for(let R=0;R<h;R++){A=(T*h+R)*M+D*o,S=(R+.5)/h;for(let _=R;_<o;_++)U=(_+.5)/o,P[A+_]=(c*U+x*S+g)*n+s,v[A+_]=(d*U+y*S+k)*a+s,b[A+_]=Math.floor(P[A+_]),I[A+_]=Math.floor(v[A+_])}}return{offsets_x:P,offsets_y:v,offsets_xi:b,offsets_yi:I,gridWidth:M}}function Lt(t,l){const{coefficients:e,spacing:i}=l,{offsets_x:s,offsets_y:n,gridWidth:a}=yt(t,t,e,{rows:i[0],cols:i[1]}),{width:m,height:r}=t,o=new Float32Array(m*r),h=180/Math.PI;for(let f=0;f<r;f++)for(let u=0;u<m;u++){const p=f*a+u,c=f===0?p:p-a,x=f===r-1?p:p+a,g=s[c]-s[x],d=n[x]-n[c];if(isNaN(g)||isNaN(d))o[f*m+u]=90;else{let y=Math.atan2(d,g)*h;y=(360+y)%360,o[f*m+u]=y}}return o}function qt(t,l,e,i,s="nearest"){if(!B(t))return null;s==="majority"&&(t=zt(t));const{pixels:n,mask:a,bandMasks:m,pixelType:r}=t,o=t.width,h=t.height,f=C.getPixelArrayConstructor(r),u=n.length,{width:p,height:c}=l;let x=!1;for(let A=0;A<e.length;A+=3)e[A]===-1&&e[A+1]===-1&&e[A+2]===-1&&(x=!0);const{offsets_x:g,offsets_y:d,offsets_xi:y,offsets_yi:k,gridWidth:M}=yt({width:o,height:h},l,e,i,s==="majority"?.5:0);let w;const P=(A,T,D,R)=>{const _=A instanceof Float32Array||A instanceof Float64Array?0:.5;for(let N=0;N<c;N++){w=N*M;for(let $=0;$<p;$++){if(g[w]<0||d[w]<0)A[N*p+$]=0;else if(R)A[N*p+$]=T[y[w]+k[w]*o];else{const W=Math.floor(g[w]),O=Math.floor(d[w]),j=Math.ceil(g[w]),J=Math.ceil(d[w]),E=g[w]-W,L=d[w]-O;if(!D||D[W+O*o]&&D[j+O*o]&&D[W+J*o]&&D[j+J*o]){const K=(1-E)*T[W+O*o]+E*T[j+O*o],q=(1-E)*T[W+J*o]+E*T[j+J*o];A[N*p+$]=(1-L)*K+L*q+_}else A[N*p+$]=T[y[w]+k[w]*o]}w++}}},v=[];let b;const I=m?.length===u,U=[];for(let A=0;A<u;A++){if(I){const T=new Uint8Array(p*c);P(T,m[A],m[A],!0),U.push(T)}b=new f(p*c),P(b,n[A],I?m[A]:a,s==="nearest"||s==="majority"),v.push(b)}const S=new C({width:p,height:c,pixelType:r,pixels:v,bandMasks:I?U:void 0});if(a!=null)S.mask=new Uint8Array(p*c),P(S.mask,a,a,!0);else if(x){S.mask=new Uint8Array(p*c);for(let A=0;A<p*c;A++)S.mask[A]=g[A]<0||d[A]<0?0:1}return S.updateStatistics(),S}function Ht(t){const{pixelBlock:l,extent:e,fieldNames:i,skipFactor:s,skipSpatialReference:n=!1,pixelIdOffset:a=0}=t,m=[],{width:r,height:o,pixels:h,mask:f}=l,u=t.imageRowSize??r,p=e.width/r,c=e.height/o,x=h.length,g=Math.floor(s/2),{xmin:d,ymax:y}=e,k=n?void 0:e.spatialReference.toJSON();for(let M=g;M<o;M+=s)for(let w=g;w<r;w+=s){const P=M*r+w;if(!f||f[P]){const v={x:d+(w+.5)*p,y:y-(M+.5)*c,spatialReference:k},b={[Pt]:a+M*u+w};for(let I=0;I<x;I++)b[i[I+1]]=h[I][P];m.push({geometry:v,attributes:b})}}return m}const V=new Map;V.set("meter-per-second",1),V.set("kilometer-per-hour",.277778),V.set("knots",.514444),V.set("feet-per-second",.3048),V.set("mile-per-hour",.44704);const st=180/Math.PI,rt=5,X=new vt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function Q(t,l){return V.get(t)/V.get(l)||1}function kt(t){return(450-t)%360}function at(t,l="geographic"){const[e,i]=t,s=Math.sqrt(e*e+i*i);let n=Math.atan2(i,e)*st;return n=(360+n)%360,l==="geographic"&&(n=kt(n)),[s,n]}function Xt(t,l="geographic"){let e=t[1];l==="geographic"&&(e=kt(e)),e%=360;const i=t[0];return[i*Math.cos(e/st),i*Math.sin(e/st)]}function Kt(t,l,e,i="geographic"){if(!B(t)||e==null)return t;const s=l==="vector-magdir"?t.clone():ht(t,l),n=s.pixels[1];for(let a=0;a<n.length;a++)n[a]=i==="geographic"?(n[a]+e[a]+270)%360:(n[a]+360-e[a])%360;return l==="vector-magdir"?s:ht(s,"vector-magdir")}function ht(t,l,e="geographic",i=1){if(!B(t))return t;const{pixels:s,width:n,height:a}=t,m=n*a,r=s[0],o=s[1],h=t.pixelType.startsWith("f")?t.pixelType:"f32",f=C.createEmptyBand(h,m),u=C.createEmptyBand(h,m);let p=0;for(let x=0;x<a;x++)for(let g=0;g<n;g++)l==="vector-uv"?([f[p],u[p]]=at([r[p],o[p]],e),f[p]*=i):([f[p],u[p]]=Xt([r[p],o[p]],e),f[p]*=i,u[p]*=i),p++;const c=new C({pixelType:h,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[f,u]});return c.updateStatistics(),c}function Gt(t,l,e=1){if(e===1||!B(t))return t;const i=t.clone(),{pixels:s,width:n,height:a}=i,m=s[0];s[1];let r=0;for(let o=0;o<a;o++)for(let h=0;h<n;h++)m[r]*=e,r++;return i.updateStatistics(),i}function Qt(t,l,e,i,s){if(s==null||!s.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(l/i),height:Math.round(e/i),resolution:t.width/l};const n=s.xmin,a=s.ymax,m=(t.xmax-t.xmin)/l*i,r=(t.ymax-t.ymin)/e*i,o=(m+r)/2;return t.xmin=n+Math.floor((t.xmin-n)/m)*m,t.xmax=n+Math.ceil((t.xmax-n)/m)*m,t.ymin=a+Math.floor((t.ymin-a)/r)*r,t.ymax=a+Math.ceil((t.ymax-a)/r)*r,{extent:t,width:Math.round(t.width/m),height:Math.round(t.height/r),resolution:o}}const Yt=Mt(0,0,0);function Mt(t=0,l=0,e=Math.PI,i=!0){i&&(e=(2*Math.PI-e)%(2*Math.PI));const s=i?-1:1,n=13*s,a=-7*s,m=-2*s,r=-16*s,o=21.75,[h,f]=F(0,l+n,e,o),[u,p]=F(t-5.5,l+a,e,o),[c,x]=F(t+5.5,l+a,e,o),[g,d]=F(t-1.5,l+m,e,o),[y,k]=F(t+1.5,l+m,e,o),[M,w]=F(t-1.5,l+r,e,o),[P,v]=F(t+1.5,l+r,e,o);return[h,f,u,p,g,d,y,k,c,x,M,w,P,v]}function Zt(t=0,l=Math.PI,e=!0){e&&(l=(2*Math.PI-l)%(2*Math.PI));const i=10,s=e?-1:1,n=5*s,a=20*s,m=25*s,r=45,o=0,h=0,f=2,u=0,p=f*s,c=e?1:-1,x=i/2*c;let[g,d]=[o+x,h-a],[y,k]=[g+f*c,d],[M,w]=[y-u*c,k+p],[P,v]=[o-x,h-m],[b,I]=[P+u*c,v-p],U=Math.ceil(t/rt),S=Math.floor(U/10);U-=8*S;const A=[],T=[];for(let E=0;E<U/2;E++,S--){S<=0&&U%2==1&&E===(U-1)/2&&(P=o,b=P+u*c,v=(v+d)/2,I=v-p);const[L,K]=F(P,v,l,r);if(S>0){const[q,Z]=F(y,v,l,r),[tt,et]=F(g,d,l,r);A.push(q),A.push(Z),A.push(L),A.push(K),A.push(tt),A.push(et)}else{const[q,Z]=F(y,k,l,r),[tt,et]=F(M,w,l,r),[Ut,bt]=F(b,I,l,r);T.push(L),T.push(K),T.push(Ut),T.push(bt),T.push(tt),T.push(et),T.push(q),T.push(Z)}v+=n,d+=n,k+=n,w+=n,I+=n}const[D,R]=F(o+x,h+a,l,r),_=(i/2+f)*c,[N,$]=F(o+_,h+a,l,r),[W,O]=F(o+x,h-m,l,r),[j,J]=F(o+_,h-m,l,r);return{pennants:A,barbs:T,shaft:[D,R,N,$,W,O,j,J]}}function F(t,l,e,i=1){const s=Math.sqrt(t*t+l*l)/i,n=(2*Math.PI+Math.atan2(l,t))%(2*Math.PI);return[s,(2*Math.PI+n-e)%(2*Math.PI)]}const Y=[0,1,3,6,10,16,21,27,33,40,47,55,63],te=[0,.5,1,1.5,2],ee=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function z(t,l,e,i){const s=Q(i||"knots",e);let n;for(n=1;n<l.length;n++)if(n===l.length-1){if(t<l[n]*s)break}else if(t<=l[n]*s)break;return Math.min(n-1,l.length-2)}function ne(t,l,e,i,s){let n=0;switch(l){case"beaufort_kn":n=z(t,Y,"knots",e);break;case"beaufort_km":n=z(t,Y,"kilometer-per-hour",e);break;case"beaufort_ft":n=z(t,Y,"feet-per-second",e);break;case"beaufort_m":n=z(t,Y,"meter-per-second",e);break;case"classified_arrow":n=z(t,s??[],i,e);break;case"ocean_current_m":n=z(t,te,"meter-per-second",e);break;case"ocean_current_kn":n=z(t,ee,"knots",e)}return n}function le(t,l){const{style:e,inputUnit:i,outputUnit:s,breakValues:n}=l,a=X.fromJSON(i),m=X.fromJSON(s),r=42,o=15;let h=0,f=0;const{width:u,height:p,mask:c}=t,x=t.pixels[0],g=t.pixels[1],d=c!=null?c.filter(w=>w>0).length:u*p,y=new Float32Array(d*r),k=new Uint32Array(o*d),M=l.invertDirection?Mt(0,0,0,!1):Yt;for(let w=0;w<p;w++)for(let P=0;P<u;P++){const v=w*u+P;if(!c||c[w*u+P]){const b=(g[v]+360)%360/180*Math.PI,I=ne(x[v],e,a,m,n);for(let S=0;S<M.length;S+=2)y[h++]=(P+.5)/u,y[h++]=(w+.5)/p,y[h++]=M[S],y[h++]=M[S+1]+b,y[h++]=I,y[h++]=x[v];const U=7*(h/r-1);k[f++]=U,k[f++]=U+1,k[f++]=U+2,k[f++]=U+0,k[f++]=U+4,k[f++]=U+3,k[f++]=U+0,k[f++]=U+2,k[f++]=U+3,k[f++]=U+2,k[f++]=U+5,k[f++]=U+3,k[f++]=U+5,k[f++]=U+6,k[f++]=U+3}}return{vertexData:y,indexData:k}}const ft=[];function ie(t,l){if(ft.length===0)for(let p=0;p<30;p++)ft.push(Zt(5*p,0,!l.invertDirection));const e=Q(X.fromJSON(l.inputUnit),"knots"),{width:i,height:s,mask:n}=t,a=t.pixels[0],m=t.pixels[1],r=6,o=[],h=[];let f=0,u=0;for(let p=0;p<s;p++)for(let c=0;c<i;c++){const x=p*i+c,g=a[x]*e;if((!n||n[p*i+c])&&g>=rt){const d=(m[x]+360)%360/180*Math.PI,{pennants:y,barbs:k,shaft:M}=ft[Math.min(Math.floor(g/5),29)];if(y.length+k.length===0)continue;let w=o.length/r;const P=(c+.5)/i,v=(p+.5)/s;for(let b=0;b<y.length;b+=2)o[f++]=P,o[f++]=v,o[f++]=y[b],o[f++]=y[b+1]+d,o[f++]=0,o[f++]=g;for(let b=0;b<k.length;b+=2)o[f++]=P,o[f++]=v,o[f++]=k[b],o[f++]=k[b+1]+d,o[f++]=0,o[f++]=g;for(let b=0;b<M.length;b+=2)o[f++]=P,o[f++]=v,o[f++]=M[b],o[f++]=M[b+1]+d,o[f++]=0,o[f++]=g;for(let b=0;b<y.length/6;b++)h[u++]=w,h[u++]=w+1,h[u++]=w+2,w+=3;for(let b=0;b<k.length/8;b++)h[u++]=w,h[u++]=w+1,h[u++]=w+2,h[u++]=w+1,h[u++]=w+2,h[u++]=w+3,w+=4;h[u++]=w+0,h[u++]=w+1,h[u++]=w+2,h[u++]=w+1,h[u++]=w+3,h[u++]=w+2,w+=4}}return{vertexData:new Float32Array(o),indexData:new Uint32Array(h)}}function At(t,l){let e=0,i=0;const{width:s,height:n,mask:a}=t,m=t.pixels[0],r=[],o=[],h=Q(X.fromJSON(l.inputUnit),"knots"),f=l.style==="wind_speed"?rt:Number.MAX_VALUE;for(let u=0;u<n;u++)for(let p=0;p<s;p++){const c=m[u*s+p]*h;if((!a||a[u*s+p])&&c<f){for(let g=0;g<4;g++)r[e++]=(p+.5)/s,r[e++]=(u+.5)/n,r[e++]=g<2?-.5:.5,r[e++]=g%2==0?-.5:.5,r[e++]=0,r[e++]=c;const x=4*(e/24-1);o[i++]=x,o[i++]=x+1,o[i++]=x+2,o[i++]=x+1,o[i++]=x+2,o[i++]=x+3}}return{vertexData:new Float32Array(r),indexData:new Uint32Array(o)}}function oe(t,l){return l.style==="simple_scalar"?At(t,l):l.style==="wind_speed"?ie(t,l):le(t,l)}function se(t,l,e,i=[0,0],s=.5){const{width:n,height:a,mask:m}=t,[r,o]=t.pixels,[h,f]=i,u=Math.round((n-h)/e),p=Math.round((a-f)/e),c=u*p,x=new Float32Array(c),g=new Float32Array(c),d=new Uint8Array(c);for(let k=0;k<p;k++)for(let M=0;M<u;M++){let w=0;const P=k*u+M,v=Math.max(0,k*e+f),b=Math.max(0,M*e+h),I=Math.min(a,v+e),U=Math.min(n,b+e);for(let S=v;S<I;S++)for(let A=b;A<U;A++){const T=S*n+A;if(!m||m[T]){w++;const D=[r[T],o[T]],[R,_]=D;x[P]+=R,g[P]+=_}}if(w>=(I-v)*(U-b)*(1-s)){d[P]=1;const[S,A]=at([x[P]/w,g[P]/w]);x[P]=S,g[P]=A}else d[P]=0,x[P]=0,g[P]=0}const y=new C({width:u,height:p,pixels:[x,g],mask:d});return y.updateStatistics(),y}export{Lt as D,Jt as E,ot as I,$t as M,qt as N,se as S,gt as T,Wt as U,jt as W,At as _,Kt as a,oe as b,Q as c,Ct as d,_t as e,ht as f,It as g,Tt as h,nt as i,Ht as j,Nt as k,at as l,Qt as m,lt as n,B as o,Gt as p,Rt as q,St as r,X as s,Bt as u,Vt as v,Ft as w,Dt as x};
