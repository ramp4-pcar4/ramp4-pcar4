import{g9 as R}from"./main-6gYsRPh_.js";const z=512;let p=class T{constructor(s,t){this.x=s,this.y=t}static fromArray(s){return new T(s[0],s[1])}clone(){return new T(this.x,this.y)}equals(s,t){return s===this.x&&t===this.y}isEqual(s){return s.x===this.x&&s.y===this.y}setCoords(s,t){return this.x=s,this.y=t,this}normalize(){const s=this.x,t=this.y,h=Math.sqrt(s*s+t*t);return this.x/=h,this.y/=h,this}rightPerpendicular(){const s=this.x;return this.x=this.y,this.y=-s,this}leftPerpendicular(){const s=this.x;return this.x=-this.y,this.y=s,this}move(s,t){return this.x+=s,this.y+=t,this}assign(s){return this.x=s.x,this.y=s.y,this}assignAdd(s,t){return this.x=s.x+t.x,this.y=s.y+t.y,this}assignSub(s,t){return this.x=s.x-t.x,this.y=s.y-t.y,this}rotate(s,t){const h=this.x,e=this.y;return this.x=h*s-e*t,this.y=h*t+e*s,this}rotateReverse(s,t){const h=this.x,e=this.y;return this.x=h*s+e*t,this.y=-h*t+e*s,this}scale(s){return this.x*=s,this.y*=s,this}length(){const s=this.x,t=this.y;return Math.sqrt(s*s+t*t)}sub(s){return this.x-=s.x,this.y-=s.y,this}add(s){return this.x+=s.x,this.y+=s.y,this}static distance(s,t){const h=t.x-s.x,e=t.y-s.y;return Math.sqrt(h*h+e*e)}static add(s,t){return new T(s.x+t.x,s.y+t.y)}static sub(s,t){return new T(s.x-t.x,s.y-t.y)}},P=class{constructor(i,s,t){this.ratio=i,this.x=s,this.y=t}},D=class{constructor(i,s,t,h=8,e=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=h,this._pixelMargin=e,this._tileSize=z*h,this._dz=i,this._yPos=s,this._xPos=t}setPixelMargin(i){i!==this._pixelMargin&&(this._pixelMargin=i,this.setExtent(this._extent))}setExtent(i){this._extent=i,this._finalRatio=this._tileSize/i*(1<<this._dz);let s=this._pixelRatio*this._pixelMargin;s/=this._finalRatio;const t=i>>this._dz;s>t&&(s=t),this._margin=s,this._xmin=t*this._xPos-s,this._ymin=t*this._yPos-s,this._xmax=this._xmin+t+2*s,this._ymax=this._ymin+t+2*s}reset(i){this._type=i,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(i,s){this._pushLine(),this._prevIsIn=this._isIn(i,s),this._moveTo(i,s,this._prevIsIn),this._prevPt=new p(i,s),this._firstPt=new p(i,s),this._dist=0}lineTo(i,s){const t=this._isIn(i,s),h=new p(i,s),e=p.distance(this._prevPt,h);let l,n,x,_,a,f,m,u;if(t)this._prevIsIn?this._lineTo(i,s,!0):(l=this._prevPt,n=h,x=this._intersect(n,l),this._start=this._dist+e*(1-this._r),this._lineTo(x.x,x.y,!0),this._lineTo(n.x,n.y,!0));else if(this._prevIsIn)n=this._prevPt,l=h,x=this._intersect(n,l),this._lineTo(x.x,x.y,!0),this._lineTo(l.x,l.y,!1);else{const r=this._prevPt,y=h;if(r.x<=this._xmin&&y.x<=this._xmin||r.x>=this._xmax&&y.x>=this._xmax||r.y<=this._ymin&&y.y<=this._ymin||r.y>=this._ymax&&y.y>=this._ymax)this._lineTo(y.x,y.y,!1);else{const o=[];if((r.x<this._xmin&&y.x>this._xmin||r.x>this._xmin&&y.x<this._xmin)&&(_=(this._xmin-r.x)/(y.x-r.x),u=r.y+_*(y.y-r.y),u<=this._ymin?f=!1:u>=this._ymax?f=!0:o.push(new P(_,this._xmin,u))),(r.x<this._xmax&&y.x>this._xmax||r.x>this._xmax&&y.x<this._xmax)&&(_=(this._xmax-r.x)/(y.x-r.x),u=r.y+_*(y.y-r.y),u<=this._ymin?f=!1:u>=this._ymax?f=!0:o.push(new P(_,this._xmax,u))),(r.y<this._ymin&&y.y>this._ymin||r.y>this._ymin&&y.y<this._ymin)&&(_=(this._ymin-r.y)/(y.y-r.y),m=r.x+_*(y.x-r.x),m<=this._xmin?a=!1:m>=this._xmax?a=!0:o.push(new P(_,m,this._ymin))),(r.y<this._ymax&&y.y>this._ymax||r.y>this._ymax&&y.y<this._ymax)&&(_=(this._ymax-r.y)/(y.y-r.y),m=r.x+_*(y.x-r.x),m<=this._xmin?a=!1:m>=this._xmax?a=!0:o.push(new P(_,m,this._ymax))),o.length===0)a?f?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):f?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(o.length>1&&o[0].ratio>o[1].ratio)this._start=this._dist+e*o[1].ratio,this._lineTo(o[1].x,o[1].y,!0),this._lineTo(o[0].x,o[0].y,!0);else{this._start=this._dist+e*o[0].ratio;for(let g=0;g<o.length;g++)this._lineTo(o[g].x,o[g].y,!0)}this._lineTo(y.x,y.y,!1)}}this._dist+=e,this._prevIsIn=t,this._prevPt=h}close(){if(this._line.length>2){const i=this._firstPt,s=this._prevPt;i.x===s.x&&i.y===s.y||this.lineTo(i.x,i.y);const t=this._line;let h=t.length;for(;h>=4&&(t[0].x===t[1].x&&t[0].x===t[h-2].x||t[0].y===t[1].y&&t[0].y===t[h-2].y);)t.pop(),t[0].x=t[h-2].x,t[0].y=t[h-2].y,--h}}result(i=!0){return this._pushLine(),this._lines.length===0?null:(this._type===3&&i&&S.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==2)throw new Error("Only valid for lines");this._pushLine();const i=this._lines,s=i.length;if(s===0)return null;const t=[];for(let h=0;h<s;h++)t.push({line:i[h],start:this._starts[h]||0});return t}_isIn(i,s){return i>=this._xmin&&i<=this._xmax&&s>=this._ymin&&s<=this._ymax}_intersect(i,s){let t,h,e;if(s.x>=this._xmin&&s.x<=this._xmax)h=s.y<=this._ymin?this._ymin:this._ymax,e=(h-i.y)/(s.y-i.y),t=i.x+e*(s.x-i.x);else if(s.y>=this._ymin&&s.y<=this._ymax)t=s.x<=this._xmin?this._xmin:this._xmax,e=(t-i.x)/(s.x-i.x),h=i.y+e*(s.y-i.y);else{h=s.y<=this._ymin?this._ymin:this._ymax,t=s.x<=this._xmin?this._xmin:this._xmax;const l=(t-i.x)/(s.x-i.x),n=(h-i.y)/(s.y-i.y);l<n?(e=l,h=i.y+l*(s.y-i.y)):(e=n,t=i.x+n*(s.x-i.x))}return this._r=e,new p(t,h)}_pushLine(){this._line&&(this._type===1?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===2?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===3&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(i,s,t){this._type!==3?t&&(i=Math.round((i-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new p(i,s))):(t||(i<this._xmin&&(i=this._xmin),i>this._xmax&&(i=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),i=Math.round((i-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new p(i,s)),this._isH=!1,this._isV=!1)}_lineTo(i,s,t){let h,e;if(this._type!==3)if(t){if(i=Math.round((i-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(h=this._line[this._line.length-1],h.equals(i,s)))return;this._line.push(new p(i,s))}else this._line&&this._line.length>0&&this._pushLine();else if(t||(i<this._xmin&&(i=this._xmin),i>this._xmax&&(i=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),i=Math.round((i-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){h=this._line[this._line.length-1];const l=h.x===i,n=h.y===s;if(l&&n)return;this._isH&&l||this._isV&&n?(h.x=i,h.y=s,e=this._line[this._line.length-2],e.x===i&&e.y===s?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(e=this._line[this._line.length-2],this._isH=e.x===i,this._isV=e.y===s)):(this._isH=e.x===i,this._isV=e.y===s)):(this._line.push(new p(i,s)),this._isH=l,this._isV=n)}else this._line.push(new p(i,s))}};class N{setExtent(s){this._ratio=s===4096?1:4096/s}get validateTessellation(){return this._ratio<1}reset(s){this._lines=[],this._line=null}moveTo(s,t){this._line&&this._lines.push(this._line),this._line=[];const h=this._ratio;this._line.push(new p(s*h,t*h))}lineTo(s,t){const h=this._ratio;this._line.push(new p(s*h,t*h))}close(){const s=this._line;s&&!s[0].isEqual(s[s.length-1])&&s.push(s[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}}let S=class d{static simplify(s,t,h){if(!h)return;const e=-t,l=s+t,n=-t,x=s+t,_=[],a=[],f=h.length;for(let u=0;u<f;++u){const r=h[u];if(!r||r.length<2)continue;let y,o=r[0];const g=r.length;for(let c=1;c<g;++c)y=r[c],o.x===y.x&&(o.x<=e&&(o.y>y.y?(_.push(u),_.push(c),_.push(0),_.push(-1)):(a.push(u),a.push(c),a.push(0),a.push(-1))),o.x>=l&&(o.y<y.y?(_.push(u),_.push(c),_.push(1),_.push(-1)):(a.push(u),a.push(c),a.push(1),a.push(-1)))),o.y===y.y&&(o.y<=n&&(o.x<y.x?(_.push(u),_.push(c),_.push(2),_.push(-1)):(a.push(u),a.push(c),a.push(2),a.push(-1))),o.y>=x&&(o.x>y.x?(_.push(u),_.push(c),_.push(3),_.push(-1)):(a.push(u),a.push(c),a.push(3),a.push(-1)))),o=y}if(_.length===0||a.length===0)return;d.fillParent(h,a,_),d.fillParent(h,_,a);const m=[];d.calcDeltas(m,a,_),d.calcDeltas(m,_,a),d.addDeltas(m,h)}static fillParent(s,t,h){const e=h.length,l=t.length;for(let n=0;n<l;n+=4){const x=t[n],_=t[n+1],a=t[n+2],f=s[x][_-1],m=s[x][_];let u=8092,r=-1;for(let y=0;y<e;y+=4){if(h[y+2]!==a)continue;const o=h[y],g=h[y+1],c=s[o][g-1],w=s[o][g];switch(a){case 0:case 1:if(v(f.y,c.y,w.y)&&v(m.y,c.y,w.y)){const M=Math.abs(w.y-c.y);M<u&&(u=M,r=y)}break;case 2:case 3:if(v(f.x,c.x,w.x)&&v(m.x,c.x,w.x)){const M=Math.abs(w.x-c.x);M<u&&(u=M,r=y)}}}t[n+3]=r}}static calcDeltas(s,t,h){const e=t.length;for(let l=0;l<e;l+=4){const n=[],x=d.calcDelta(l,t,h,n);s.push(t[l]),s.push(t[l+1]),s.push(t[l+2]),s.push(x)}}static calcDelta(s,t,h,e){const l=t[s+3];if(l===-1)return 0;const n=e.length;return n>1&&e[n-2]===l?0:(e.push(l),d.calcDelta(l,h,t,e)+1)}static addDeltas(s,t){const h=s.length;let e=0;for(let l=0;l<h;l+=4){const n=s[l+3];n>e&&(e=n)}for(let l=0;l<h;l+=4){const n=t[s[l]],x=s[l+1],_=e-s[l+3];switch(s[l+2]){case 0:n[x-1].x-=_,n[x].x-=_,x===1&&(n[n.length-1].x-=_),x===n.length-1&&(n[0].x-=_);break;case 1:n[x-1].x+=_,n[x].x+=_,x===1&&(n[n.length-1].x+=_),x===n.length-1&&(n[0].x+=_);break;case 2:n[x-1].y-=_,n[x].y-=_,x===1&&(n[n.length-1].y-=_),x===n.length-1&&(n[0].y-=_);break;case 3:n[x-1].y+=_,n[x].y+=_,x===1&&(n[n.length-1].y+=_),x===n.length-1&&(n[0].y+=_)}}}};const v=(i,s,t)=>i>=s&&i<=t||i>=t&&i<=s,q=Number.POSITIVE_INFINITY,I=Math.PI,E=2*I,V=128/I,H=256/360,L=I/180,k=1/Math.LN2;function b(i,s){return(i%=s)>=0?i:i+s}function C(i){return b(i*V,256)}function A(i){return b(i*H,256)}function O(i){return Math.log(i)*k}function F(i,s,t){return i*(1-t)+s*t}const W=8,Y=14,j=16;function B(i){return W+Math.max((i-Y)*j,0)}function G(i,s,t){let h,e,l,n=0;for(const x of t){h=x.length;for(let _=1;_<h;++_)e=x[_-1],l=x[_],e.y>s!=l.y>s&&((l.x-e.x)*(s-e.y)-(l.y-e.y)*(i-e.x)>0?n++:n--)}return n!==0}function J(i,s,t,h){let e,l,n,x;const _=h*h;for(const a of t){const f=a.length;if(!(f<2)){e=a[0].x,l=a[0].y;for(let m=1;m<f;++m){if(n=a[m].x,x=a[m].y,R(i,s,e,l,n,x)<_)return!0;e=n,l=x}}}return!1}function K(i,s,t,h,e,l,n){const x=Math.max(h,Math.min(s,l))-s,_=Math.max(e,Math.min(t,n))-t;return x*x+_*_<=i*i}function Q(i,s){if(s===0||Number.isNaN(s))return i;const t=[],h=new p(0,0),e=new p(0,0),l=new p(0,0);for(let n=0;n<i.length;n++){const x=i[n],_=[];for(let a=0;a<x.length;a++){const f=x[a-1],m=x[a],u=x[a+1];a===0?h.setCoords(0,0):h.assignSub(m,f).normalize().rightPerpendicular(),a===x.length-1?e.setCoords(0,0):e.assignSub(u,m).normalize().rightPerpendicular(),l.assignAdd(h,e).normalize();const r=l.x*e.x+l.y*e.y;r!==0&&l.scale(1/r),_.push(p.add(m,l.scale(s)))}t.push(_)}return t}function U(i,s,t,h){const e=new p(i[0],i[1]);if(e.scale(h),s==="viewport"){const l=-t*(Math.PI/180),n=Math.cos(l),x=Math.sin(l);e.rotate(n,x)}return e}export{G as I,J as N,Q as P,b as a,D as b,U as c,B as d,E as e,C as f,O as h,p as i,A as l,N as n,I as o,F as p,q as r,L as s,K as w};
