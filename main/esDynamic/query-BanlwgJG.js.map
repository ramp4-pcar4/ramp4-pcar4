{"version":3,"file":"query-BanlwgJG.js","sources":["../../node_modules/@arcgis/core/rest/operations/urlUtils.js","../../node_modules/@arcgis/core/rest/query/operations/query.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nfunction t(n){const o={};for(const e in n){if(\"declaredClass\"===e)continue;const r=n[e];if(null!=r&&\"function\"!=typeof r)if(Array.isArray(r)){o[e]=[];for(let n=0;n<r.length;n++)o[e][n]=t(r[n])}else\"object\"==typeof r?r.toJSON&&(o[e]=JSON.stringify(r)):o[e]=r}return o}export{t as mapParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../../request.js\";import{urlToObject as t,join as r}from\"../../../core/urlUtils.js\";import{getJsonType as n}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{srToRESTValue as o}from\"../../../geometry/support/spatialReferenceUtils.js\";import{mapParameters as a}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as s}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as u}from\"./queryZScale.js\";const l=\"Layer does not support extent calculation.\";function d(e,t){if(t&&\"extent\"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&\"point\"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function y(e,t,r){const i=e.geometry,a=e.toJSON();delete a.compactGeometryEnabled,delete a.defaultSpatialReferenceEnabled;const s=a;let u,l,y;if(i&&(l=i.spatialReference,y=o(l),s.geometryType=n(i),s.geometry=d(i,e.compactGeometryEnabled),s.inSR=y),a.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=a.groupByFieldsForStatistics.join(\",\")),a.objectIds)switch(r?.uniqueIdFields?.length){case void 0:s.objectIds=a.objectIds.join(\",\");break;case 1:s.uniqueIds=JSON.stringify(a.objectIds),delete s.objectIds;break;default:s.uniqueIds=JSON.stringify(a.objectIds.map((e=>JSON.parse(e)))),delete s.objectIds}if(a.orderByFields&&(s.orderByFields=a.orderByFields.join(\",\")),!a.outFields||!a.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete s.outFields:a.outFields.includes(\"*\")?s.outFields=\"*\":s.outFields=a.outFields.join(\",\"),a.outSR?(s.outSR=o(a.outSR),u=e.outSpatialReference):i&&(a.returnGeometry||a.returnCentroid)&&(s.outSR=s.inSR,u=l),a.returnGeometry&&delete a.returnGeometry,a.outStatistics&&(s.outStatistics=JSON.stringify(a.outStatistics)),a.fullText&&(s.fullText=JSON.stringify(a.fullText)),a.pixelSize&&(s.pixelSize=JSON.stringify(a.pixelSize)),a.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete a.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(a.quantizationParameters)),a.parameterValues&&(s.parameterValues=JSON.stringify(a.parameterValues)),a.rangeValues&&(s.rangeValues=JSON.stringify(a.rangeValues)),a.dynamicDataSource&&(s.layer=JSON.stringify({source:a.dynamicDataSource}),delete a.dynamicDataSource),a.timeExtent){const e=a.timeExtent,{start:t,end:r}=e;null==t&&null==r||(s.time=t===r?t:`${t??\"null\"},${r??\"null\"}`),delete a.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=u&&l.equals(u)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function c(e,t,r,n,i){const o=t.timeExtent?.isEmpty?{data:{features:[]}}:await g(e,t,\"json\",n,void 0,i);return u(t,r,o.data),o}async function f(e,t,r,n,i){if(t.timeExtent?.isEmpty)return{data:r.createFeatureResult()};const o=await m(e,t,n,i),a=o;return a.data=s(o.data,r),a}function m(e,t,r,n){return g(e,t,\"pbf\",r,void 0,n)}function p(e,t,r,n){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):g(e,t,\"json\",r,{returnIdsOnly:!0},n)}function S(e,t,r,n){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):g(e,t,\"json\",r,{returnIdsOnly:!0,returnCountOnly:!0},n)}async function O(e,t,r){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const n=await g(e,t,\"json\",r,{returnExtentOnly:!0,returnCountOnly:!0}),i=n.data;if(i.hasOwnProperty(\"extent\"))return n;if(i.features)throw new Error(l);if(i.hasOwnProperty(\"count\"))throw new Error(l);return n}function x(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;const r={...e,returnUniqueIdsOnly:!0};return delete r.returnIdsOnly,r}async function g(n,o,s,u={},l={},d={}){const c=\"string\"==typeof n?t(n):n,f=o.geometry?[o.geometry]:[],m=await i(f,null,{signal:u.signal}),p=m?.[0];null!=p&&((o=o.clone()).geometry=p);const S=a({...c.query,f:s,...x(l,d),...y(o,l,d)});return e(r(c.path,j(o,l)?\"query3d\":\"query\"),{...u,responseType:\"pbf\"===s?\"array-buffer\":\"json\",query:{...S,...u.query}})}function j(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}export{d as encodeGeometry,c as executeQuery,S as executeQueryForCount,O as executeQueryForExtent,p as executeQueryForIds,f as executeQueryPBF,m as executeQueryPBFBuffer,y as queryToQueryStringParameters,g as runQuery};\n"],"names":["t","n","o","e","r","l","d","y","a","s","c","i","g","u","f","m","p","S","O","x","j"],"mappings":"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","x_google_ignoreList":[0,1]}