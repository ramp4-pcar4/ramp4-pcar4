import{cz as u,C as f,cA as y,cB as $,cC as T,aK as d,cD as Z,cE as w,bs as C,aP as g}from"./main-CnDVnExo.js";import"./mat4f32-BdRMyjXW.js";import"./mat4-i0cPq9AY.js";import"./intl-BxRKe_z1.js";import{h as U}from"./timeZoneUtils-D6KRGgVc.js";const D=",",S={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},M=new Set(["integer","small-integer"]);let c=null;function N(t){return d(t)||Z(t)||w(t)}async function v(t){const{field:n,field2:e,field3:r,normalizationField:a,valueExpression:i}=t;let s=[];if(i){if(!c){const{arcadeUtils:o}=await C();c=o}s=c.extractFieldNames(i)}return n&&s.push(n),e&&s.push(e),r&&s.push(r),a&&s.push(a),s}function m(t){return String(t).padStart(2,"0")}function p(t,n,e){let r;return n==="date"||n==="number"?(n==="number"&&(t=new Date(t)),r=`TIMESTAMP'${e?t.getFullYear():t.getUTCFullYear()}-${m((e?t.getMonth():t.getUTCMonth())+1)}-${m(e?t.getDate():t.getUTCDate())} ${m(e?t.getHours():t.getUTCHours())}:${m(e?t.getMinutes():t.getUTCMinutes())}:${m(e?t.getSeconds():t.getUTCSeconds())}'`):r=t,r}function E(t,n,e,r){const{hasQueryEngine:a}=t,i=`(${p(e,h(t,e),a)} - ${p(n,h(t,n),a)})`;let s=S[r],o="/";return s<1&&(s=1/s,o="*"),{sqlExpression:s===1?i:`(${i} ${o} ${s})`,sqlWhere:null}}function h(t,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const e=t.getField(n);if(n.toLowerCase()==="<now>")return;if(d(e))return"field"}}function F(t,n){const e=n&&t.getField(n);return!!e&&M.has(e.type)}function b(t){return`cast(${t} as float)`}function x(t,n){const{format:e,timeZoneOptions:r,fieldType:a}=n??{};let i,s;if(r&&({timeZone:i,timeZoneName:s}=U(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,u(e||"short-date-short-time"),a)),typeof t=="string"&&isNaN(Date.parse(a==="time-only"?`1970-01-01T${t}Z`:t)))return t;switch(a){case"date-only":{const o=u(e||"short-date");return typeof t=="string"?T(t,{...o}):f(t,{...o,timeZone:g})}case"time-only":{const o=u(e||"short-time");return typeof t=="string"?$(t,o):f(t,{...o,timeZone:g})}case"timestamp-offset":{if(!i&&typeof t=="string"&&new Date(t).toISOString()!==t)return t;const o=e||r?u(e||"short-date-short-time"):void 0,l=o?{...o,timeZone:i,timeZoneName:s}:void 0;return typeof t=="string"?y(t,l):f(t,l)}default:{const o=e||r?u(e||"short-date-short-time"):void 0;return f(typeof t=="string"?new Date(t):t,o?{...o,timeZone:i,timeZoneName:s}:void 0)}}}export{N as $,E as C,b as M,x as N,v as U,D as f,F as j};
