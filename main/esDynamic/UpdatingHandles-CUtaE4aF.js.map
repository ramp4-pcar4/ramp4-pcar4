{"version":3,"file":"UpdatingHandles-CUtaE4aF.js","sources":["../../node_modules/@arcgis/core/core/support/UpdatingHandles.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import s from\"../Accessor.js\";import{makeHandle as t}from\"../handleUtils.js\";import{watch as i,when as n,on as d,sync as a}from\"../reactiveUtils.js\";import{schedule as r}from\"../scheduling.js\";import{property as o}from\"../accessorSupport/decorators/property.js\";import{subclass as l}from\"../accessorSupport/decorators/subclass.js\";let h=class extends s{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,s,t={}){return this._installWatch(e,s,t,i)}addWhen(e,s,t={}){return this._installWatch(e,s,t,n)}addOnCollectionChange(e,s,{initial:i=!1,final:n=!1}={}){const r=++this._handleId;return this.addHandles([d(e,\"after-changes\",this._createSyncUpdatingCallback(),a),d(e,\"change\",s,{onListenerAdd:i?e=>s({added:e.toArray(),removed:[]}):void 0,onListenerRemove:n?e=>s({added:[],removed:e.toArray()}):void 0})],r),t(()=>this.removeHandles(r))}addPromise(e){if(null==e)return e;const s=++this._handleId;this.addHandles(t(()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(c)||this._set(\"updating\",!1))}),s),this._pendingPromises.add(e),this._set(\"updating\",!0);const i=()=>this.removeHandles(s);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set(\"updating\",!1)}_installWatch(e,s,i={},n){const d=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,d);const a=n(e,s,i);return this.addHandles(a,d),t(()=>this.removeHandles(d))}_installSyncUpdatingWatch(e,s){const t=this._createSyncUpdatingCallback(),n=i(e,t,{sync:!0,equals:()=>!1});return this.addHandles(n,s),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(c),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this.addHandles(r(()=>{e===this._scheduleHandleId&&(this._set(\"updating\",this._pendingPromises.size>0),this.removeHandles(c))}),c)}}};e([o({readOnly:!0})],h.prototype,\"updating\",void 0),h=e([l(\"esri.core.support.UpdatingHandles\")],h);const c=-42;export{h as UpdatingHandles};\n"],"names":["h","s","i","n","r","d","a","e","t","c","o","l"],"mappings":"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","x_google_ignoreList":[0]}