import{eD as nt,eE as at,ai as W,_ as r,X as u,Y as S,h3 as ot,av as P,fd as x,N as q,an as ne,bP as Se,aw as rt,ed as Pe,bA as ke,O as Ee,s as xe,a9 as R,c3 as H,z as Re,aG as ue,gu as lt,ku as ut,l0 as Ce,ky as ct,bJ as ce,B,je as pt,gl as ht,cg as dt,mG as mt,mH as yt,dU as vt,aa as ft,a8 as ae,ax as gt,mI as De,j as _t,V as wt,g as Z,mJ as bt,mK as St,hA as pe,dy as Pt,cl as kt,ay as he,$ as Et,a as Ve,mL as Me,d as xt,eM as de,eL as Rt,d5 as Ct}from"./main-6gYsRPh_.js";import{I as Dt}from"./colorUtils-30m3vZNz.js";import{l as Oe}from"./throttle-DjIeewNa.js";import Ge from"./GraphicsLayer-BPINIw3R.js";import{j as Vt}from"./createUtils-B6B2GlYc.js";import{X as Mt,N as Ie,W as me}from"./projectionUtils-CVhOpzeN.js";import{d as Te}from"./asyncUtils-K8P6uJAi.js";import{e as Ot}from"./LRUCache-KBZZ93ce.js";import{c as Gt}from"./mapCollectionUtils-CucNASOO.js";import{h as It,U as Tt,t as ze,c as zt}from"./elevationInfoUtils-D6sSxLXV.js";import{e as Lt}from"./getDefaultUnitForView-B7ZCgQ8O.js";import{c as ye}from"./ElevationInfo-7br1mgLB.js";import{I as At}from"./vec32-y2_p7lFt.js";import{R as Ut,y as qt,q as Zt,j as Le}from"./geodesicUtils-8mhrMpeD.js";import{_ as Ft}from"./Tile-D_coN6tA.js";import{f as Ht}from"./Scheduler-DIvkTrPN.js";import{o as Nt}from"./Map-CYjqVKDm.js";import{r as jt}from"./GeometryDescriptor-8gqUsMj1.js";import{h as $t}from"./UpdatingHandles-CUtaE4aF.js";import{r as Qt}from"./signal-CSPaA74e.js";import{f as Ae}from"./utils-BaVnR4_x.js";import{n as Wt}from"./MapView-CcgL30VV.js";import{m as Bt}from"./SketchViewModel-oZSiDZG2.js";let O=class extends nt(at){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return(this.parent?.visible&&!this.parent.suspended)??!0}set visible(e){this._overrideIfSome("visible",e)}forceInteractive(){return this._interactiveViewModelCount++,W(()=>this._interactiveViewModelCount--)}};r([u({constructOnly:!0})],O.prototype,"parent",void 0),r([u({constructOnly:!0})],O.prototype,"view",void 0),r([u({type:Boolean})],O.prototype,"interactive",null),r([u()],O.prototype,"_userInteractive",void 0),r([u({readOnly:!0})],O.prototype,"updating",null),r([u()],O.prototype,"visible",null),r([u()],O.prototype,"_interactiveViewModelCount",void 0),O=r([S("esri.views.analysis.AnalysisView")],O);let ve=class extends O{};ve=r([S("esri.views.2d.analysis.AnalysisView2D")],ve);function Jt(e){return ot([P(()=>{const{analysis:t,sketchGraphic:i,toolState:s,visible:a}=e.analysisViewData,{geometryVisualizationVisible:o}=t.viewOptions;return{geometryVisualizationVisible:o,geometry:t.geometry,sketchGraphic:i,toolState:s,visible:a}},({geometryVisualizationVisible:t,sketchGraphic:i,toolState:s,visible:a})=>{if(e.remove(),a)return t&&i!=null&&s!=="reshaping"&&s!=="sketching"?e.show(i):void 0},x)])}let J=class extends q{constructor(e){super(e)}initialize(){this.addHandles(Jt({analysisViewData:this.analysisViewData,remove:()=>{},show:()=>{}}))}get updating(){return!1}};r([u({constructOnly:!0})],J.prototype,"view",void 0),r([u({constructOnly:!0})],J.prototype,"analysisViewData",void 0),r([u()],J.prototype,"updating",null),J=r([S("esri.views.2d.analysis.ElevationProfile.ElevationProfileInputVisualization2D")],J);let Ue={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:Ue.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:ne(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function F(){return Ue}const Xt={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};function Yt(e,t){e??=[];const i=e.length-1,s=[];let a=[];for(let o=0;o<=i;o++){const{x:n,y:l,z:c}=e[o];c!=null&&a.push([n,l,c]),o!==i&&c!=null||!a.length||(s.push(a),a=[])}return Vt(s,t,!0)}let A=class extends q{constructor(e){super(e),this._graphic=new Se,this._layer=new Ge({listMode:"hide",internal:!0}),this._updateGeometryThrottled=Oe(t=>{if(!t)return void(this._graphic.visible=!1);const i=this._layer,s=this.view.map?.layers;s&&(s.includes(i)||s.add(i),s.reorder(i,0)),this._graphic.visible=!0,this._graphic.geometry=Yt(t.samples,t.spatialReference)},F().profileLinesUpdateThrottleMillis)}initialize(){this._layer.add(this._graphic),this.addHandles([rt(()=>!this.analysisViewData.visible,()=>{this._graphic.visible=!1}),P(()=>this._colorUpdateParameters,e=>this._updateColor(e),x),P(()=>this.analysisViewData.analysis.geometry,()=>{this._graphic.visible=!1},x),P(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),x),this._updateGeometryThrottled])}destroy(){this.view.map?.remove(this._layer),this._layer.destroy(),this._graphic.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){const{analysisViewData:e}=this;return e.visible?e.results.find(({available:t,computation:i,rawResult:s})=>t&&i.profile.viewOptions.lineVisible&&s?.hasZ===!0):null}get _geometryUpdateParameters(){const e=this._result;return e?.progress!==1?null:{samples:e.samples,spatialReference:this.view.spatialReference}}get _colorUpdateParameters(){const e=this._result?.computation.profile.color;return e?{color:e.toArray(),contrastColor:Dt(e).toArray()}:null}_updateColor(e){e&&(this._graphic.symbol=new Pe({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",capStyle:"Butt",color:e.color,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],joinStyle:"Round",width:1.5},{type:"CIMSolidStroke",capStyle:"Butt",color:e.contrastColor,joinStyle:"Round",width:1.5}]}}}))}};r([u({constructOnly:!0})],A.prototype,"view",void 0),r([u({constructOnly:!0})],A.prototype,"analysisViewData",void 0),r([u()],A.prototype,"updating",null),r([u()],A.prototype,"_result",null),r([u()],A.prototype,"_geometryUpdateParameters",null),r([u()],A.prototype,"_colorUpdateParameters",null),A=r([S("esri.views.2d.analysis.ElevationProfile.ElevationProfileLineVisualization2D")],A);let N=class extends q{constructor(e){super(e),this.position=null,this.color=new ke("#ffffff"),this.element=Kt()}initialize(){this.addHandles([P(()=>this._screenLocation,e=>{e&&(this.element.style.transform=`translate(${e.x}px, ${e.y}px)`)},x),P(()=>this.color.toCss(),e=>{this.element.style.background=e},x)]),this.view.surface?.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){const{position:e,view:t}=this;t.type==="3d"?(t.commitProperty("size"),t.commitProperty("camera")):t.commitProperty("center");const i=t?.spatialReference,s=i?Mt(e,i).geometry:null;return s&&t?.ready?t.toScreen(s):null}};function Kt(){const e=document.createElement("div"),{size:t,borderStyle:i,borderColor:s,borderWidth:a,boxShadow:o}=F().hoveredPointsStyle,{style:n}=e;return n.display="block",n.position="absolute",n.top="0",n.left="0",n.contain="strict",n.boxSizing="border-box",n.width=`${t}px`,n.height=`${t}px`,n.marginTop=`-${t/2}px`,n.marginLeft=`-${t/2}px`,n.border=`${i} ${a}px ${s}`,n.borderRadius=`${t}px`,n.boxShadow=o,e}r([u()],N.prototype,"position",void 0),r([u({type:ke})],N.prototype,"color",void 0),r([u()],N.prototype,"view",void 0),r([u()],N.prototype,"_screenLocation",null),N=r([S("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization")],N);let j=class extends q{constructor(e){super(e),this._hoveredPoints=new Ee}initialize(){const{analysisViewData:e}=this,{analysis:t}=e;this.addHandles([P(()=>{const{hoveredPoints:i,visible:s,updating:a}=e;return s?a?null:i.map((o,n)=>{const l=t.profiles.at(n);return l?.viewOptions.hoveredPointVisible===!0&&o!=null?{hoveredPoint:o,color:l.color}:null}).filter(o=>!!o):[]},i=>this._update(i),x),P(()=>t.geometry,()=>this._update([]),x)])}destroy(){this._hoveredPoints.drain(e=>e.destroy())}get updating(){return!1}_update(e){if(!e)return;const{view:t,_hoveredPoints:i}=this,s=e.length;for(;i.length>s;)i.pop()?.destroy();for(;i.length<s;){const a=new N({view:t});i.push(a)}for(let a=0;a<s;++a){const o=e[a],n=i.at(s-1-a);n.position=o.hoveredPoint,n.color=o.color}}};r([u()],j.prototype,"view",void 0),r([u()],j.prototype,"analysisViewData",void 0),r([u()],j.prototype,"_hoveredPoints",void 0),r([u()],j.prototype,"updating",null),j=r([S("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization")],j);let X=class extends q{constructor(e){super(e)}initialize(){const{view:e,analysisViewData:t}=this;this._hoveredPointsVisualization=new j({view:e,analysisViewData:t}),this._inputVisualization=new J({view:e,analysisViewData:t}),this._lineVisualization=new A({view:e,analysisViewData:t})}destroy(){this._inputVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualization.destroy()}get updating(){return this._hoveredPointsVisualization.updating||this._inputVisualization.updating||this._lineVisualization.updating}};r([u()],X.prototype,"view",void 0),r([u()],X.prototype,"analysisViewData",void 0),r([u()],X.prototype,"updating",null),X=r([S("esri.views.2d.analysis.ElevationProfile.ElevationProfileVisualization2D")],X);function C(e,t){let i,s=!1;function a(...o){const n=e.apply(this,o);return s&&i!==void 0&&t?.(i,n)?i:(s=!0,i=n,n)}return a}let ei=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t)}},te=class extends xe{constructor(e,t,i){super(e,t,i),this.name="unknown",this.name=e}},oe=class extends te{constructor(){super("too-complex","The input geometry has too many points.")}},qe=class extends te{constructor(){super("invalid-geometry","The input geometry is invalid.")}};class ti extends te{constructor(){super("elevation-query-error","Error querying elevation from provider.")}}let ii=class extends te{constructor(){super("unknown","Unknown error.")}};async function si(e,t,i,s,a,o,n){let l,c,p;const h=e.spatialReference,d=h.isGeographic||h.isWebMercator;let m=0;if(!d){const{execute:f}=await import("./lengthOperator-BadSCCZ7.js").then(_=>_.l);R(n),m=f(e,{unit:"meters"}),R(n)}const y=1/H(s);if(d){await Ie([{source:h,dest:s},{source:h,dest:Re.WGS84}],n);const f=fi(e);l=Ut([f],"meters")[0];const _=Ze(l,a);if(Be(e,l,_)>o)throw new oe;const v=Fe(f,t,i);({densifiedPath:c,distances:p}=ci(v,_,y)),c=me(c,s)}else{await Ie([{source:h,dest:s}],n),l=m;const f=Ze(l,a);if(Be(e,l,f)>o)throw new oe;const _=Fe(e,t,i);({densifiedPath:c,distances:p}=ui(_,f,y)),R(n),c=me(c,s)}return{densifiedPath:c,pathLength:l*y,distances:p}}function Ze(e,t){const i=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,i)}function Fe(e,t,i){if(t==null)return He(e);const s=e.spatialReference,a=t.mode,o=It(t,s);let n=null;switch(i.type){case"2d":n=ni(e,a,o);break;case"3d":n=ai(e,a,o,i)}return n==null?He(e):new ue({hasZ:!0,hasM:!1,spatialReference:s,paths:Ne(e.paths,n)})}function ni({hasZ:e},t,i){return t==="absolute-height"?e?([s,a,o])=>[s,a,o+i]:([s,a])=>[s,a,i]:null}function ai({spatialReference:e,hasZ:t},i,s,{elevationProvider:a}){const o=(n,l,c,p)=>a?.getElevation(n,l,c,e,p)??0;switch(i){case"on-the-ground":return([n,l])=>[n,l,o(n,l,0,"ground")];case"absolute-height":return t?([n,l,c])=>[n,l,c+s]:([n,l])=>[n,l,s];case"relative-to-ground":return t?([n,l,c])=>[n,l,c+o(n,l,c,"ground")+s]:([n,l])=>[n,l,o(n,l,0,"ground")+s];case"relative-to-scene":return t?([n,l,c])=>[n,l,c+o(n,l,c,"scene")+s]:([n,l])=>[n,l,o(n,l,0,"scene")+s];default:return null}}function He(e){return e.hasZ?new ue({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:Ne(e.paths,([t,i])=>[t,i])}):e}function Ne(e,t){const i=e.length,s=new Array(i);for(let a=0;a<i;++a){const o=e[a],n=o.length,l=new Array(o.length);s[a]=l;for(let c=0;c<n;++c)l[c]=t(o[c])}return s}function je(e){return fe(e)&&e.paths.some(t=>t.length>1)}function oi(e){return ri(e)&&je(e.geometry)}function ri(e){return $e(e)&&fe(e?.geometry)}function fe(e){return!$e(e)&&e!=null&&e.type==="polyline"}function $e(e){return e!=null&&"geometry"in e}function li(e){const t=e?.layer;return t!=null&&t.type==="graphics"&&t.internal}function Qe(e,t,i,s,a){const{spatialReference:o,hasZ:n}=e,l={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:o,metersPerSR:H(o)},c=[],p=[];let h=0;for(let d=0;d<e.paths.length;++d){const m=e.paths[d],y=new Array,f=new Array;let _=0;for(let v=1;v<m.length;++v){const w=m[v-1],G=m[v],I=s(l,w,G);let T;for(T=_;T<I.distance&&!lt(T,I.distance);T+=t)y.push(a(I,T)),f.push((h+T)*i);_=T-I.distance,h+=I.distance,y.push(G),f.push(h*i)}c[d]=y,p[d]=f}return{densifiedPath:new ue({spatialReference:o,hasZ:n,paths:c}),distances:p}}function ui(e,t,i){const{hasZ:s}=e;return Qe(e,t,i,hi,s?vi:yi)}function ci(e,t,i){const{hasZ:s}=e;return Qe(e,t,i,pi,s?mi:di)}function pi(e,t,i){return e.distance=0,Zt(e,t,i,e.spatialReference),e.from=t,e.to=i,e}function hi(e,t,i){return e.from=t,e.to=i,e.distance=ut(i,t)*e.metersPerSR,e}function di({from:e,azimuth:t,spatialReference:i},s){return Le([0,0],e,t,s,i)}function mi({from:e,to:t,azimuth:i,distance:s,spatialReference:a},o){const n=o/s,l=[0,0,Ce(e[2],t[2],n)];return Le(l,e,i,o,a),l}function yi({from:e,to:t,distance:i},s){return ct([0,0],e,t,s/i)}function vi({from:e,to:t,distance:i},s){return At([0,0,0],e,t,s/i)}function fi(e){return qt(e.spatialReference)?e:me(e,Re.WGS84)}function We(e){return e.paths.reduce((t,i)=>t+i.length,0)}function Be(e,t,i){return We(e)+Math.floor(t/i)+Math.max(0,e.paths.reduce(s=>1+s,0)-1)}function gi(e,t){const i=e.length;if(i===0)return null;const s=e[0],a=s.sampledZ;let o=a,n=a,l=0,c=0,p=null,h=null,d=a??0,m=0,y=0,f=a!=null?1:0,_=0,v=0;const w=H(t),G=B(t),I=F().minSlopeSampleDistance/w,T=2*I,Q=new Je,M=new Je,le=()=>{st(),Q.copy(M),M.reset()},be=(E,K)=>{le(),E>0&&E-Q.start<=T&&(E=Q.start+I),M.restart(E,K)},st=()=>{if(Q.isHole||M.isHole)return;const E=M.avgElevation-Q.avgElevation,K=M.start-Q.start,ee=E*G,z=K*w,L=ne(Math.atan2(ee,z),"radians","degrees");L>0?(m+=L,p=U(p,L),_++):L<0&&(y-=L,h=U(h,-L),v++)};s.sampledZ!=null&&be(s.distance,s.sampledZ);for(let E=1;E<i;++E){const K=e[E-1],ee=e[E],z=ee.sampledZ;if(z==null){M.isHole||le();continue}f++,d+=z,o=ge(o,z),n=U(n,z),M.isHole||ee.distance-M.start>=I?be(ee.distance,z):M.insert(z);const L=K.sampledZ;if(L!=null){const se=z-L;se>0?l+=se:se<0&&(c-=se)}}return le(),f===0?null:{maxDistance:e[i-1].distance,minElevation:o,maxElevation:n,avgElevation:f===0?null:d/f,elevationGain:l,elevationLoss:c,maxPositiveSlope:p,maxNegativeSlope:h,avgPositiveSlope:_===0?null:m/_,avgNegativeSlope:v===0?null:y/v}}function _i(e){const t=e.filter(ce),i=t.length;if(i===0)return null;const s=t[0];if(i===1)return s;let a=s.maxDistance,o=s.minElevation,n=s.maxElevation,l=s.maxPositiveSlope,c=s.maxNegativeSlope;for(let p=1;p<t.length;++p){const h=t[p];a=U(a,h.maxDistance),o=ge(o,h.minElevation),n=U(n,h.maxElevation),l=U(l,h.maxPositiveSlope),c=U(c,h.maxNegativeSlope)}return{maxDistance:a,minElevation:o,maxElevation:n,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:l,maxNegativeSlope:c,avgPositiveSlope:null,avgNegativeSlope:null}}function wi(e){let t=null,i=null,s=null;for(const a of e){if(a==null)continue;const{statistics:o,spatialReference:n}=a;if(o==null)continue;const l=H(n);t=U(t,_e(o.maxDistance,l));const c=B(n);s=ge(s,_e(o.minElevation,c)),i=U(i,_e(o.maxElevation,c))}return{minDistance:0,maxDistance:t??0,minElevation:s??0,maxElevation:i??0}}function ge(e,t){return t==null?e:e!=null?Math.min(e,t):t}function U(e,t){return t==null?e:e!=null?Math.max(e,t):t}function _e(e,t){return e!=null&&t!=null?e*t:null}class Je{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,i){this._start=t,this._sampleCount=1,this._totalElevation=i}insert(t){++this._sampleCount,this._totalElevation+=t}}function bi(e,t,i=[]){if(e>=t||(i.push(e),t-e<2))return i;const s=t-1;i.push(s);const a=we(e+1,s);for(;;){const o=a.next();if(o.done)break;i.push(o.value)}return i}function*we(e,t){if(e>=t)return;const i=e+Math.floor((t-e)/2);yield i;const s=we(e,i),a=we(i+1,t);for(;;){const o=s.next(),n=a.next();if(o.done&&n.done)break;o.done||(yield o.value),n.done||(yield n.value)}}async function*Si(e,t){const{view:i,geometry:s,elevationInfo:a,providers:o,options:n}=e,l=i.spatialReference;if(!l||s==null||!je(s))throw new qe;const c=o.length;if(c===0)return null;const p=Math.round(n.maxTotalSamples/c);if(We(s)>p)throw new oe;const h=await si(s,a,i,l,n,p,t);R(t);let d=0;const m=new Array(c),y=new Array(c);for(let v=0;v<c;v++){const w=Ci(h);m[v]=w,d+=w.samples.length;const G={...e,provider:o[v],result:w,densificationResult:h};y[v]=Pi(G,t)[Symbol.iterator]()}if(d>n.maxTotalSamples)throw new oe;const f=await Promise.all(y.map(v=>{const w=v.next();return w.done===!0?Promise.resolve(null):w.value}));R(t);for(let v=0;v<c;v++)m[v]=f[v];yield m,await ht(e.delayAfterPreview??F().delayAfterPreviewMillis,null,t.signal),R(t);const _=[];try{let v;do{v=!1;for(let w=0;w<c;w++){const G=y[w].next();G.done===!1&&(_.push({resultPromise:G.value,index:w}),v=!0)}}while(v)}finally{y.forEach(v=>v.return?.())}for(const{resultPromise:v,index:w}of _)m[w]=await v,R(t),yield m;for(const v of m)v!=null&&(v.progress=1);yield m}function*Pi(e,t){const{densificationResult:i}=e,s={...e,abortOptions:t,densificationResult:i},a=bi(0,s.result.samples.length),o=a.slice(0,s.provider.numSamplesForPreview);yield Xe(s,o,!0);const n=yt(a,s.provider.numSamplesPerChunk);for(const l of n)yield Xe(s,l,!1)}async function Xe({densificationResult:e,result:t,provider:i,queue:s,abortOptions:a,cache:o},n,l){const{densifiedPath:c,pathLength:p}=e,h=t.spatialReference,{samples:d}=t,m=[];for(let y=0;y<n.length;y++){const f=d[n[y]];m[y]=[...f.coordinate]}try{return await s.push({geometry:new vt({spatialReference:h,points:m,hasZ:c.hasZ}),provider:i,indices:n,preview:l,result:t,parameters:{...F().defaultQueryOptions(),minDemResolution:Math.round(l?p/i.numSamplesForPreview:p/d.length),cache:o}},a),{...t}}catch(y){return ft(y)?null:Xt}}function ki(e){return new Ft({priority:Ht.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async t=>{R(t.parameters);try{await Ei(t)}catch(i){pt(i)}}})}async function Ei({geometry:e,provider:t,indices:i,preview:s,result:a,parameters:o}){if(i.length===0)return;const n=(await Mi(t,e,o)).geometry,{hasZ:l,points:c}=n,p=o.noDataValue,{samples:h}=a;for(let d=0;d<i.length;d++){const m=h[i[d]];if(m.isHole)continue;const y=l?c[d][2]:null;y===null||y===p?m.sampledZ=null:(a.hasZ=!0,m.sampledZ=y),m.sampled=!0}xi(h),a.progress=s?0:a.progress+i.length/h.length,a.statistics=gi(a.samples,a.spatialReference)}function xi(e){const t=e.length-1;let i=0;for(let s=1;s<=t;s++)(e[s].sampled||s===t)&&(Ri(e,i,s),i=s)}function Ri(e,t,i){if(i-t===1)return;const s=e[t],a=s.sampledZ,o=e[i],n=o.sampledZ;if(a==null||n==null){for(let p=t+1;p<i;p++)e[p].sampledZ=null;return}const l=s.distance,c=o.distance-l;for(let p=t+1;p<i;p++){const h=e[p],d=(h.distance-l)/c;h.sampledZ=Ce(a,n,d)}}function Ci({densifiedPath:e,distances:t}){const i=e.spatialReference,s=dt(i),a=e.paths,o=a.length,n=[];let l=null,c=0;for(let p=0;p<o;p++){const h=a[p],d=h.length,m=t[p];for(let y=0;y<d;y++){const f=h[y],_=m[y];s&&(f[0]=mt(f[0],s.valid[0],s.valid[1])),l&&y===0&&Di(n,l,f,c,_),n.push(Vi(f,_)),l=f,c=_}}return{progress:0,samples:n,hasZ:!1,statistics:null,spatialReference:i}}function Di(e,t,i,s,a){e.push(Ye(t,s)),e.push(Ye(i,a))}function Vi(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function Ye(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function Mi(e,t,i){try{return await e.queryElevation(t,i)}catch{throw new ti}}function Oi(e,t,i){if(!e||e.length===0)return;const s=e.length-1,a=e[0];if(t<=i(a))return a;const o=e[s];if(t>=i(o))return o;let n=0,l=0,c=s;for(;n<c;){l=n+Math.floor((c-n)/2);const p=e[l],h=i(p);if(h===t)return p;if(t<h){if(l>0){const d=e[l-1],m=i(d);if(t>m)return t-m>=h-t?p:d}c=l}else{if(l<s){const d=e[l+1],m=i(d);if(t<m)return t-h>=m-t?d:p}n=l+1}}return e[l]}function Ke(e){return e>.999999?1:e}let g=class extends q{constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=C(()=>{const t=wi(this._activeComputations.map(a=>a.result.rawResult)),i=this.analysis.displayUnits,s=Lt(this.view);return{distance:St(t.maxDistance,"meters",i.distance??s),elevation:bt(t.maxElevation,"meters",i.elevation??s)}},Z),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=C(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),Z),this._getStableGenerationParameters=C(()=>{const{view:t,analysis:i}=this;return t?.ready&&this._queue?{view:t,geometry:i.geometry,geometryIsValid:i.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:t.type==="3d"?t.slice.plane:null}:null},Z),this._getStableElevationInfo=C(()=>this.analysis.elevationInfo??Gi,pe),this._getStableOptions=C(()=>{const{densificationMaxSamples:t,defaultDemResolution:i,maxTotalSamples:s}=F();let a=this._minDemResolution??i;return a=parseFloat(a.toFixed(2)),{samplingDistance:a,densificationMaxSamples:Math.round(t/this._activeComputations.length),maxTotalSamples:s}},Z),this._updateThrottled=Oe(t=>this._update(t),F().updateThrottleMillis)}initialize(){this._computationsCollection=Gt(()=>this.analysis.profiles,t=>this.computationFactory.create({controller:this,profile:t,onInvalidate:i=>this._invalidateComputation(i)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on("change",()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),P(()=>this._updateParameters,t=>this._updateThrottled(t),x),this._updateThrottled]);const e=this.view.type==="3d"?this.view.resourceController:void 0;this._queue=ki(e?.scheduler),e?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=ae(this._queue),this._currentTileCache=ae(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(const i of this._activeComputations)e++,t+=i.progress;return Ke(e>0?t/e:0)}get updating(){const{progress:e}=this,t=!!this._queue?.updating,i=this._updateThrottled.hasPendingUpdates(),s=this._updateTask!=null&&!this._updateTask.finished;return t||i||s||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return _i(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){const{view:t}=this;return t?.type==="3d"?gt(()=>t.elevationProvider,"elevation-change",e,{onListenerAdd:e,onListenerRemove:e}):W()}get _tileCache(){this._currentTileCache=ae(this._currentTileCache);const e=this.view;if(e?.type==="3d"){const t=e.basemapTerrain?.elevationQueryCache;if(t!=null)return t}return this._currentTileCache==null&&(this._currentTileCache=new ei(new Ot(20971520))),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){const e=this._minDemResolutions;return e.length>0?De(e):null}get _minDemResolutions(){const e=[];for(const{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:i}){this._abortUpdate(),e&&(i!=null?this._updateTask=Te(async s=>{this.error=null;const a=t.filter(o=>!this._isComputationValid(o,i));try{if(!i.geometryIsValid)throw new qe;const o=Si({...i,providers:a},{signal:s});let n=!1;for await(const l of o){R(s),n||(this._clearInvalidResults(i),n=!0);for(let c=0;c<a.length;c++)a[c].setResult(l[c])}for(const l of a)this._parametersPerComputation.set(l,i)}catch(o){_t(o),this._abortUpdate(),this.error=o instanceof te?o:new ii,a.forEach(n=>{n.clearResult()})}}):this._clearResults())}_abortUpdate(){this._updateTask=wt(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(const e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};r([u({constructOnly:!0})],g.prototype,"analysis",void 0),r([u({constructOnly:!0})],g.prototype,"analysisViewData",void 0),r([u({constructOnly:!0})],g.prototype,"computationFactory",void 0),r([u({constructOnly:!0})],g.prototype,"view",void 0),r([u()],g.prototype,"error",void 0),r([u({readOnly:!0})],g.prototype,"effectiveDisplayUnits",null),r([u()],g.prototype,"progress",null),r([u()],g.prototype,"updating",null),r([u()],g.prototype,"results",null),r([u()],g.prototype,"statistics",null),r([u()],g.prototype,"hoveredPoints",null),r([u()],g.prototype,"_updateTask",void 0),r([u()],g.prototype,"_queue",void 0),r([u()],g.prototype,"_tileCache",null),r([u()],g.prototype,"_computationsCollection",void 0),r([u()],g.prototype,"_computations",null),r([u()],g.prototype,"_activeComputations",null),r([u({readOnly:!0})],g.prototype,"_minDemResolution",null),r([u()],g.prototype,"_minDemResolutions",null),r([u()],g.prototype,"_updateParameters",null),r([u()],g.prototype,"_generationParameters",null),r([u()],g.prototype,"elevationInfo",null),r([u()],g.prototype,"_options",null),g=r([S("esri.views.analysis.ElevationProfile.ElevationProfileController")],g);const Gi=new ye({...Tt});function Ii(e,t){if(e==null||t==null)return null;const{samples:i,spatialReference:s}=e,{distance:a,elevation:o}=t,n=H(s),l=B(s),c=i.length,p=new Array(c);for(let h=0;h<c;++h){const d=i[h],m=d.sampledZ,y=d.coordinate;p[h]={x:y[0],y:y[1],z:m,distance:et(d.distance,n,a),elevation:Y(m,l,o)}}return p}function Ti(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;const{distance:i,elevation:s}=t,{statistics:a,spatialReference:o}=e,n=H(o),l=B(o);return{maxDistance:et(a.maxDistance,n,i),minElevation:Y(a.minElevation,l,s),maxElevation:Y(a.maxElevation,l,s),avgElevation:Y(a.avgElevation,l,s),elevationGain:Y(a.elevationGain,l,s),elevationLoss:Y(a.elevationLoss,l,s),maxPositiveSlope:a.maxPositiveSlope,maxNegativeSlope:a.maxNegativeSlope,avgPositiveSlope:a.avgPositiveSlope,avgNegativeSlope:a.avgNegativeSlope}}function et(e,t,i){return e==null?null:ne(e*t,"meters",i)}function Y(e,t,i){return e==null?null:ne(e*t,"meters",i)}let D=class extends Pt{constructor(e){super(e),this._getSamplesMemoized=ze((t,i)=>Ii(t,i)),this._getStatisticsMemoized=ze((t,i)=>Ti(t,i)),this.rawResult=null}get available(){const{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return Ke(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;const e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;const{rawResult:t,samples:i}=this;if(i==null||t==null)return null;const s=i.length;if(s===0)return null;const a=i[s-1].distance,o=Oi(i,e*a,p=>p.distance);if(o==null)return null;const{x:n,y:l,z:c}=o;return c==null?null:new kt({x:n,y:l,z:c,spatialReference:t.spatialReference})}};r([u()],D.prototype,"available",null),r([u({readOnly:!0})],D.prototype,"profile",null),r([u({readOnly:!0})],D.prototype,"progress",null),r([u()],D.prototype,"samples",null),r([u()],D.prototype,"statistics",null),r([u({constructOnly:!0})],D.prototype,"computation",void 0),r([u()],D.prototype,"rawResult",void 0),r([u()],D.prototype,"hoveredPoint",null),D=r([S("esri.views.analysis.ElevationProfile.ElevationProfileResult")],D);let k=class extends q{constructor(e){super(e),this.result=new D({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([P(()=>{const{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),he)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return F().defaultDemResolution}};r([u({constructOnly:!0})],k.prototype,"controller",void 0),r([u({constructOnly:!0})],k.prototype,"profile",void 0),r([u({constructOnly:!0})],k.prototype,"onInvalidate",void 0),r([u()],k.prototype,"result",void 0),r([u({readOnly:!0})],k.prototype,"progress",null),r([u()],k.prototype,"hoveredPoint",null),r([u()],k.prototype,"available",null),r([u()],k.prototype,"numSamplesForPreview",void 0),r([u()],k.prototype,"numSamplesPerChunk",void 0),r([u({readOnly:!0})],k.prototype,"minDemResolution",null),k=r([S("esri.views.analysis.ElevationProfile.ElevationProfileLineComputation")],k);function tt(e){if(e==null)return null;if(Nt(e))return it(e);const t=e.tileInfo;if(t==null)return null;const i=t.lods?.at(-1);return i==null?null:i.resolution*H(t.spatialReference)}function it(e){if(e==null)return null;const t=e.layers.items.map(zi).filter(ce);return De(t)??null}function zi(e){return e&&"tileInfo"in e?tt(e):null}let $=class extends k{constructor(){super(...arguments),this.type="ground",this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=C(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),Z),this._getStableGroundLayers=C(()=>this._ground?.layers?.toArray(),Z)}get minDemResolution(){return it(this._ground)}get available(){return this._ground?.layers.some(e=>e.visible)===!0}initialize(){this.addHandles([P(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(e,t){const i=this._queryElevationDependencies;if(i==null)throw new Error(`${this.declaredClass}: no dependencies`);const{ground:s}=i;if(s==null)throw new Error("No ground configured in the view");const a=await s.queryElevation(e,t),o=B(e.spatialReference),n=B(s.layers.at(0).spatialReference);if(o!==n){const l=a.geometry;l.points=l.points.map(([c,p,h])=>[c,p,h===t.noDataValue?h:h*n/o])}return a}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};r([u()],$.prototype,"minDemResolution",null),r([u()],$.prototype,"available",null),r([u()],$.prototype,"_queryElevationDependencies",null),r([u()],$.prototype,"_ground",null),$=r([S("esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation")],$);function Li(e){return e?.map?.allLayers?.toArray().filter(t=>(t.type!=="graphics"||!t.internal)&&t.visible).map(t=>t.uid)??[]}let re=class extends k{constructor(){super(...arguments),this.type="input",this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=C(()=>{const{view:e}=this.controller;if(!e)return null;const t=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:t,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},Z),this._getStableElevationInfo=C(()=>this.controller.elevationInfo,pe),this._getStableSpatialReference=C(()=>this.controller.view?.spatialReference,pe),this._getStableLayerIds=C(()=>{const{view:e}=this.controller;return e.type!=="3d"?[]:Li(e)},Z)}initialize(){const e=()=>this.onInvalidate(this);this.addHandles([P(()=>this._queryElevationDependencies,e,he),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:i}){const s=this._queryElevationDependencies;if(s==null)throw new Error(`${this.declaredClass}: no dependencies`);const{view:a,spatialReference:o}=s;if(this._requiresElevationAlignment&&a.type==="3d"&&o){const n=await jt.fromGeometry(e).project(o,i);if(!n)return{geometry:e,noDataValue:t};const l=a.elevationProvider;return n.coordinates.forEach(c=>{c.z=l.getElevation(c.x,c.y,0,o,"ground")??0}),{geometry:n.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode==="on-the-ground"&&this.controller.view.type==="3d"}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};r([u()],re.prototype,"_queryElevationDependencies",null),re=r([S("esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation")],re);let ie=class extends k{constructor(){super(...arguments),this.type="query",this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return tt(this.profile.source)}get available(){const{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(t=>t.visible))}initialize(){this.addHandles(P(()=>this.profile.source,()=>this.onInvalidate(this),he))}queryElevation(e,t){if(!this.profile.source)throw new Error("No source configured for the elevation profile line");return this.profile.source.queryElevation(e,t)}};r([u({readOnly:!0})],ie.prototype,"minDemResolution",null),r([u()],ie.prototype,"available",null),ie=r([S("esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation")],ie);class Ai{constructor(){this._currentOperationSignal=Qt(null)}get currentOperationType(){return this._currentOperationSignal.value?.type??null}destroy(){this.stop()}async start(t,i,s){const a=this._currentOperationSignal.value;a?.stop();const o=new AbortController,n=s?.signal,l=AbortSignal.any([o.signal,n].filter(ce)),c=Et();let p=!1;const h=()=>{p||(p=!0,c.reject(xt()))},d={type:t,resolve:m=>{p||(p=!0,c.resolve(m))},reject:h,promise:c.promise,stop:()=>o.abort(),handles:[]};this._currentOperationSignal.value=d,d.handles.push(Ve(n,()=>{o.abort()}),Ve(l,()=>{Me(d.handles),p||h()}));try{return a&&(await a.promise.catch(()=>{}),R(l)),await i(d,l),await c.promise}finally{Me(d.handles),this._currentOperationSignal.value===d&&(this._currentOperationSignal.value=null)}}stop(){this._currentOperationSignal.value?.stop()}}let V=class extends q{constructor(e){super(e),this._sketchViewModels=new Ee,this._updatingHandles=new $t,this._operationManager=new Ai}initialize(){const{view:e}=this;this._graphicsLayer=new Ge({listMode:"hide",internal:!0}),this.addHandles([P(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:t,internalGraphicsLayer:i,state:s,geometryVisualizationVisible:a,visible:o})=>{qi(t,i);const n=this.sketchGraphic;switch(n&&(n.visible=o),s){case"idle":case"reshaping-disabled":n&&!a&&(n.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case"reshaping":de(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},x),P(()=>this._analysis.elevationInfo,t=>{this._graphicsLayer.elevationInfo=t},x)])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(t=>ae(t));const e=this._graphicsLayer;this.view.map?.remove(e),e.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(e){e!==this._get("sketchGraphic")&&(this._set("sketchGraphic",e),this._updateAnalysisFromSketchGraphic())}get state(){const{visible:e,interactive:t}=this.analysisViewData;if(!e)return"idle";switch(this._operationManager.currentOperationType){case"place":return this._sketching?"sketching":"awaiting-sketch";case"pick-feature":return"picking";default:return this._analysis.geometry?t?"reshaping":"reshaping-disabled":"idle"}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return Ui(this.view.type)}place(e){return this._operationManager.start("place",async t=>{const i=this._createSketchViewModel(),s=this._analysis.clone();this._ensureUpdatedSketchGraphic();const a=this.sketchGraphic,o=this._analysis.elevationInfo,n=W(()=>{this.sketchGraphic===a&&(this._graphicsLayer.elevationInfo=o)}),l=i.on("create",c=>{switch(c.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=c.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case"active":this._updateAnalysisFromSketchGraphic();break;case"complete":this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case"cancel":t.stop()}});t.handles.push(l,W(()=>(l.remove(),i.destroy(),this._sketchViewModels.remove(i),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?Rt(e)||s.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),n),this._graphicsLayer.elevationInfo=Zi,await this._updatingHandles.addPromise(de(i.create("polyline")))},e)}async pickFeature(e){return this._operationManager.start("pick-feature",async t=>{const{view:i}=this;i.closePopup();let s=null;const a=n=>{n.defer(async()=>{s?.abort(),s=Te(async l=>{const{results:c}=await i.hitTest(n);R(l);let p=null;for(const h of c)if(h.type==="graphic"&&oi(h.graphic)&&!li(h.graphic)){p=h.graphic;break}p?(n.preventDefault(),n.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=p.geometry,this._analysis.elevationInfo=new ye({...zt(p)}),t.resolve({feature:p}),t.stop()):t.reject()}),await s.promise})},o=n=>{Wt(n)&&(t.reject(),t.stop())};t.handles.push(i.on("immediate-click",a,Ae.TOOL),i.on("key-down",o,Ae.TOOL),i.acquireCursor("crosshair","high"),W(()=>{s?.abort(),t.reject()})),i.focus()},e)}_startReshape(){const e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start("reshape",async t=>{const i=()=>{const a=this._ensureUpdatedSketchGraphic();return a?this._updatingHandles.addPromise(e.update(a,{tool:"reshape"})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const s=e.on("update",a=>{this._updateAnalysisFromSketchGraphic(),a.state==="complete"&&(this.state==="reshaping"?de(i()):t.resolve())});t.handles.push(s,W(()=>{s.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await i()})}_createSketchViewModel(){return new Bt({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){const{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;const t=this.sketchGraphic??=new Se({symbol:this._lineSymbol,geometry:e});return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){const{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(i=>i!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let e=this.sketchGraphic?.geometry;fe(e)||(e=null);const t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function Ui(e){if(e==="2d"){const t={type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5};return new Pe({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{...t,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],color:[0,0,0,255]},{...t,color:[255,255,255,255]}]}}})}return new Ct({color:[0,0,0,0]})}function qi(e,t){t&&(t.removeFromParent(),e?.add(t))}r([u({constructOnly:!0})],V.prototype,"analysisViewData",void 0),r([u({constructOnly:!0})],V.prototype,"view",void 0),r([u()],V.prototype,"sketchGraphic",null),r([u({nonNullable:!0})],V.prototype,"state",null),r([u()],V.prototype,"updating",null),r([u()],V.prototype,"_sketching",null),r([u()],V.prototype,"_analysis",null),r([u()],V.prototype,"_lineSymbol",null),V=r([S("esri.views.analysis.ElevationProfile.ElevationProfileTool")],V);const Zi=new ye({mode:"on-the-ground",offset:0});let b=class extends ve{constructor(e){super(e),this.type="elevation-profile-view-2d",this.analysis=null,this.hoveredPosition=null}initialize(){const{analysis:e,view:t}=this;this._controller=new g({analysis:e,analysisViewData:this,view:t,computationFactory:{create:i=>{switch(i.profile.type){case"ground":return new $(i);case"input":return new re(i);case"query":return new ie(i);case"scene":throw new xe("elevation-profile-analysis-view-2d:unsupported","The scene profile line type is not supported in 2D views.")}}}}),this._visualization=new X({view:t,analysisViewData:this}),this._sketchTool=new V({view:t,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:"meters",elevation:"meters"}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return this._controller?.updating===!0||this._visualization?.updating===!0||this._sketchTool?.updating===!0}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??"idle"}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};r([u({readOnly:!0})],b.prototype,"type",void 0),r([u({constructOnly:!0,nonNullable:!0})],b.prototype,"analysis",void 0),r([u({readOnly:!0})],b.prototype,"effectiveDisplayUnits",null),r([u({readOnly:!0})],b.prototype,"error",null),r([u()],b.prototype,"hoveredPosition",void 0),r([u()],b.prototype,"hoveredPoints",null),r([u({readOnly:!0})],b.prototype,"progress",null),r([u({readOnly:!0})],b.prototype,"results",null),r([u({readOnly:!0})],b.prototype,"statistics",null),r([u({readOnly:!0})],b.prototype,"updating",null),r([u()],b.prototype,"sketchGraphic",null),r([u()],b.prototype,"toolState",null),r([u()],b.prototype,"_controller",void 0),r([u()],b.prototype,"_visualization",void 0),r([u()],b.prototype,"_sketchTool",void 0),b=r([S("esri.views.2d.analysis.ElevationProfileAnalysisView2D")],b);const Fi=b;export{Fi as default};
