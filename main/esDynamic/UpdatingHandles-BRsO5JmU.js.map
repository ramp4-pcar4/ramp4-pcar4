{"version":3,"file":"UpdatingHandles-BRsO5JmU.js","sources":["../../node_modules/@arcgis/core/core/support/UpdatingHandles.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as s}from\"../../chunks/tslib.es6.js\";import e from\"../Accessor.js\";import{makeHandle as t}from\"../handleUtils.js\";import{watch as i,when as n,on as d,sync as a}from\"../reactiveUtils.js\";import{schedule as r}from\"../scheduling.js\";import{property as o}from\"../accessorSupport/decorators/property.js\";import{subclass as l}from\"../accessorSupport/decorators/subclass.js\";let h=class extends e{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(s,e,t={}){return this._installWatch(s,e,t,i)}addWhen(s,e,t={}){return this._installWatch(s,e,t,n)}addOnCollectionChange(s,e,{initial:i=!1,final:n=!1}={}){const r=++this._handleId;return this.addHandles([d(s,\"after-changes\",this._createSyncUpdatingCallback(),a),d(s,\"change\",e,{onListenerAdd:i?s=>e({added:s.toArray(),removed:[]}):void 0,onListenerRemove:n?s=>e({added:[],removed:s.toArray()}):void 0})],r),t((()=>this.removeHandles(r)))}addPromise(s){if(null==s)return s;const e=++this._handleId;this.addHandles(t((()=>{this._pendingPromises.delete(s)&&(0!==this._pendingPromises.size||this.hasHandles(c)||this._set(\"updating\",!1))})),e),this._pendingPromises.add(s),this._set(\"updating\",!0);const i=()=>this.removeHandles(e);return s.then(i,i),s}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set(\"updating\",!1)}_installWatch(s,e,i={},n){const d=++this._handleId;i.sync||this._installSyncUpdatingWatch(s,d);const a=n(s,e,i);return this.addHandles(a,d),t((()=>this.removeHandles(d)))}_installSyncUpdatingWatch(s,e){const t=this._createSyncUpdatingCallback(),n=i(s,t,{sync:!0,equals:()=>!1});return this.addHandles(n,e),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(c),++this._scheduleHandleId;const s=this._scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this.addHandles(r((()=>{s===this._scheduleHandleId&&(this._set(\"updating\",this._pendingPromises.size>0),this.removeHandles(c))})),c)}}};s([o({readOnly:!0})],h.prototype,\"updating\",void 0),h=s([l(\"esri.core.support.UpdatingHandles\")],h);const c=-42;export{h as UpdatingHandles};\n"],"names":["h","e","s","i","n","r","d","a","t","c","o","l"],"mappings":"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","x_google_ignoreList":[0]}