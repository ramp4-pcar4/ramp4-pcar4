import{a as h,n as D,p as Ye,q as Ke,d as ee,P as m,z as ce,Y as be,m as q,D as qe,A as Qe,r as ye,C as Je,O as Ze}from"./Point2D-CaHJVGk1.js";import{a8 as He,a9 as xe,aa as te,ab as $e,e as et,r as tt,ac as Se,Y as Ae,ad as we,ae as De,O as Fe,W as nt,af as Ce,ag as it,ah as je,u as Ne,b as Te,ai as Oe,aj as ze,ak as Ie,E as ge,al as Ee,am as rt,an as st,ao as de,ap as at,aq as Be,ar as ot,as as ut}from"./ProjectionTransformation-D2-nuBsr.js";import"./Envelope2D-DlBzXkgv.js";import{ai as Pe,fK as mt,fL as lt,fM as ct}from"./main-CnDVnExo.js";He(n=>{let e,t;typeof n=="number"?e=n:t=n;const i={wkid:e,wkt:t};let s,a;if(t){s=ct(t);const r=Pe(i);if(!s&&!r)throw new Error(`Unsupported WKT type: ${t}`)}else s=!Pe(i);return a=e&&lt.has(e)?Math.PI/200:s?mt(i):Math.PI/180,{isPCS:s,metersOrRadiansPerUnit:a,semiMajor:0,wkidOrWkt:n}});function dt(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){const n=this.m_bReturnKey,e=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,n?{value:{m_token:5,m_value:this.m_keys[e]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[e]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function _t(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){const n={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||n.value.m_value===void 0&&(n.value.m_value=Number.NaN),n}return{value:{m_token:4,m_value:null},done:!0}}class ht{createJSONObjectIterator(e){return{m_iteratorType:"object",m_o:e,m_keys:this.m_options.strict?Object.keys(e):Object.keys(e).filter(t=>e[t]!==void 0),m_i:-1,m_bReturnKey:!0,next:dt}}createJSONArrayIterator(e){return{m_iteratorType:"array",m_strict:this.m_options.strict,m_i:-1,m_a:e,next:_t}}constructor(e,t){this.m_currentToken=0,this.m_options=t?{...t}:{strict:!0};const i=e;this.m_iteratorStack=[i instanceof Array?this.createJSONArrayIterator(i):this.createJSONObjectIterator(i)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(this.m_iteratorStack.length===0)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(typeof this.m_nextFlatToken.m_value=="number")return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=Ye()&&this.m_currentValue<=Ke()?this.m_currentToken=8:this.m_currentToken=7;if(typeof this.m_nextFlatToken.m_value=="string")return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if(typeof this.m_nextFlatToken.m_value=="boolean")return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if(typeof this.m_nextFlatToken.m_value=="object")return this.m_currentValue=null,this.m_currentToken=10;ee("unrecognized json element type")}return ee("unrecognized json element type"),0}currentToken(){return this.m_currentToken}skipChildren(){if(this.m_iteratorStack.length!==0)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,void(this.m_currentToken=3);case 2:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,void(this.m_currentToken=4)}}currentString(){return this.m_currentToken!==6&&this.m_currentToken!==5&&m("invalid token"),this.m_currentValue}currentDoubleValue(){return this.m_currentToken!==7&&this.m_currentToken!==8&&m("invalid token"),this.m_currentValue}currentInt32Value(){return this.m_currentToken!==8&&m("invalid token"),this.m_currentValue}currentInt64Value(){return D(0),0n}currentBoolValue(){return this.m_currentToken!==12&&this.m_currentToken!==11&&m("invalid token"),this.m_currentValue}isError(){return 0}}class ft{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){const e={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}startArray(){const e=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(e){this.m_pendingKey=e}addValue_(e){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):this.m_currentObject.at(-1).push(e)}addString(e){this.addValue_(e)}addDouble(e,t){this.addValue_(e)}addInt64(e){D(0)}addInt32(e){this.addValue_(e)}addBool(e){this.addValue_(e)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}}class ae{constructor(e){return this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),e.sz!==void 0?(this.m_sz=e.sz,e.buffer?(this.m_sz<0&&ye("size out of range"),this.m_buffer=e.buffer,this.m_offset=e.offset!==void 0?e.offset:0,this.m_view=e.offset!==void 0?new DataView(e.buffer,e.offset,e.sz):new DataView(this.m_buffer),this.m_bOwnsBuffer=!1,void(this.m_bLittleEndian=!0)):(this.m_sz<0&&ye("size out of range"),void(this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))):e.move?(this.m_sz=e.move.m_sz,this.m_buffer=e.move.m_buffer,this.m_view=e.move.m_view,this.m_bOwnsBuffer=e.move.m_bOwnsBuffer,this.m_bLittleEndian=e.move.m_bLittleEndian,e.move.m_buffer=null,e.move.m_view=null,e.move.m_sz=0,void(e.move.m_bOwnsBuffer=!0)):void ee("unrecognized constructor options")}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(e){return this===e||(this.clear(),this.m_sz=e.m_sz,this.m_buffer=e.m_buffer,this.m_view=e.m_view,this.m_bOwnsBuffer=e.m_bOwnsBuffer,this.m_bLittleEndian=e.m_bLittleEndian,e.m_buffer=null,e.m_sz=0,e.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(ae.getNativeByteOrder()===1)}setNativeByteOrder(){this.m_bLittleEndian=ae.getNativeByteOrder()===1}setOrder(e){this.m_bLittleEndian=e===1}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||Je("buffer not defined"),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(e){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(e,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(e,this.m_bLittleEndian)}writeDouble(e,t){this.m_elementDouble[0]=t,this.swapBytesDouble(),this.m_view.setFloat64(e,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(e){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(e,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(e,this.m_bLittleEndian)}writeInt32(e,t){this.m_elementInt32[0]=t,this.swapBytesInt32(),this.m_view.setInt32(e,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(e){D(e>=0&&e<=this.m_sz),this.m_sz=e}}function pt(n,e,t,i,s,a){let r=!1,o=!1,c=!1,u=!1,l=!1,f=!1,_=!1,b=!1,v=!1,F=!1,g=!1,N=!1,C=!1,p=!1,x=!1,S=!1,E=!1,I=!1,U=!1,B=!1,w=!1,W=!1,P=!1,A=!1,z=Number.NaN,O=Number.NaN,V=Number.NaN,M=Number.NaN,J=0,j=Number.NaN,X=Number.NaN,y=Number.NaN,ne=Number.NaN,me=Number.NaN,ie=Number.NaN,Z=Number.NaN,H=Number.NaN,re=0,Y=0,$=!1,le=!1,L=null,G=null,Q=null,K=null,R=null;for(;t.nextToken()!==3;){const k=t.currentString();if(t.nextToken(),k==="spatialReference"){if(s&&!r){r=!0,t.currentToken()===1?K=Ve(t):t.currentToken()!==10&&m("failed to parse spatial reference: object or null is expected");continue}}else if(i)if(k==="hasZ"){if(!o){o=!0,$=t.currentToken()===11;continue}}else if(k==="hasM"){if(!c){c=!0,le=t.currentToken()===11;continue}}else if(k==="rings"){if(!(l||f||n!==h.enumUnknown&&n!==h.enumPolygon)){l=!0,{geometry:R,as:L,bs:G}=pe(!0,!1,e,t);continue}}else if(k==="curveRings"){if(!f&&(n===h.enumUnknown||n===h.enumPolygon)){f=!0,{geometry:R,as:L,bs:G}=pe(!0,!0,e,t);continue}}else if(k==="paths"){if(!(_||b||n!==h.enumUnknown&&n!==h.enumPolyline)){_=!0,{geometry:R,as:L,bs:G}=pe(!1,!1,e,t);continue}}else if(k==="curvePaths"){if(!b&&(n===h.enumUnknown||n===h.enumPolyline)){b=!0,{geometry:R,as:L,bs:G}=pe(!1,!0,e,t);continue}}else if(k==="points"){if(!v&&(n===h.enumUnknown||n===h.enumMultiPoint)){v=!0,{geometry:R,as:L,bs:G}=bt(e,t);continue}}else if(k==="ids"){if(!u){u=!0,Q=yt(e,t);continue}}else if(k==="x"){if(!F&&(n===h.enumUnknown||n===h.enumPoint)){F=!0,z=T(t);continue}}else if(k==="y"){if(!g&&(n===h.enumUnknown||n===h.enumPoint)){g=!0,O=T(t);continue}}else if(k==="z"){if(!N&&(n===h.enumUnknown||n===h.enumPoint)){N=!0,V=T(t);continue}}else if(k==="m"){if(!C&&(n===h.enumUnknown||n===h.enumPoint)){C=!0,M=T(t);continue}}else if(k==="id"){if(!p&&(n===h.enumUnknown||n===h.enumPoint)){p=!0,J=_e(t);continue}}else if(k==="xmin"){if(!x&&(n===h.enumUnknown||n===h.enumEnvelope)){x=!0,j=T(t);continue}}else if(k==="ymin"){if(!S&&(n===h.enumUnknown||n===h.enumEnvelope)){S=!0,X=T(t);continue}}else if(k==="mmin"){if(!w&&(n===h.enumUnknown||n===h.enumEnvelope)){w=!0,Z=T(t);continue}}else if(k==="zmin"){if(!U&&(n===h.enumUnknown||n===h.enumEnvelope)){U=!0,me=T(t);continue}}else if(k==="idmin"){if(!P&&(n===h.enumUnknown||n===h.enumEnvelope)){P=!0,re=_e(t);continue}}else if(k==="xmax"){if(!E&&(n===h.enumUnknown||n===h.enumEnvelope)){E=!0,y=T(t);continue}}else if(k==="ymax"){if(!I&&(n===h.enumUnknown||n===h.enumEnvelope)){I=!0,ne=T(t);continue}}else if(k==="mmax"){if(!W&&(n===h.enumUnknown||n===h.enumEnvelope)){W=!0,H=T(t);continue}}else if(k==="zmax"){if(!B&&(n===h.enumUnknown||n===h.enumEnvelope)){B=!0,ie=T(t);continue}}else if(k==="idmax"){if(!A&&(n===h.enumUnknown||n===h.enumEnvelope)){A=!0,Y=_e(t);continue}}else k==="materials"&&D(0);t.skipChildren()}if(l||f||_||b||v){let k=null,ke=null;const fe=R;$&&(R.addAttribute(1),k=L,k||(k=te(fe.getPointCount(),Number.NaN))),le&&(R.addAttribute(2),ke=$?G:L),Q!=null&&R.addAttribute(3),$&&k!=null&&fe.setAttributeStreamRef(1,k),le&&ke!=null&&fe.setAttributeStreamRef(2,ke),Q!=null&&Nt(fe,Q)}else if(F||g||C||N||p){$e(z,O)||m("failed to parse point: x and y must be finite or nan"),(Number.isNaN(O)||Number.isNaN(z))&&(z=Number.NaN,O=Number.NaN);const k=new et({x:z,y:O});N&&k.setZ(V),C&&k.setM(M),p&&k.setID(J),R=k}else if(x||S||E||I||U||B||w||W||P||A){(Number.isNaN(X)||Number.isNaN(y)||Number.isNaN(ne))&&(j=Number.NaN);const k=new tt({xmin:j,ymin:X,xmax:y,ymax:ne});U&&B&&k.setInterval(1,0,me,ie),w&&W&&k.setInterval(2,0,Z,H),P&&A&&k.setInterval(3,0,re,Y),R=k}return{...R?{geom:R}:{},...K?{sr:K}:{}}}function kt(n){let e=!1;for(;n.nextToken()!==3;){const t=n.currentString();n.nextToken(),t==="uwkid"?e||(e=!0,n.currentToken()===8&&n.currentInt32Value()):n.skipChildren()}return null}function Ve(n){let e=!1,t=!1,i=!1,s=!1,a=!1,r=!1,o=!1,c=!1,u=!1,l=!1,f=!1,_=!1,b=!1,v=!1,F=!1,g=!1,N=!1,C=-1,p=-1,x=-1,S=-1,E=0,I=0,U=0,B=0,w=0,W=0,P=0,A=0,z=0,O=0,V="",M="",J=null;for(;n.nextToken()!==3;){const y=n.currentString();n.nextToken(),y==="wkid"?e||(e=!0,n.currentToken()===8&&(C=n.currentInt32Value())):y==="latestWkid"?t||(t=!0,n.currentToken()===8&&(p=n.currentInt32Value())):y==="wkt"?a||(a=!0,n.currentToken()===6&&(V=n.currentString())):y==="wkt2"?a||n.currentToken()===6&&(M=n.currentString()):y==="vcsWkid"?i||(i=!0,n.currentToken()===8&&(x=n.currentInt32Value())):y==="latestVcsWkid"?s||(s=!0,n.currentToken()===8&&(S=n.currentInt32Value())):y==="xyTolerance"?o||(o=!0,r=!0,E=n.currentDoubleValue()):y==="zTolerance"?c||(c=!0,r=!0,I=n.currentDoubleValue()):y==="mTolerance"?u||(u=!0,r=!0,U=n.currentDoubleValue()):y==="falseX"?l||(l=!0,r=!0,P=n.currentDoubleValue()):y==="falseY"?f||(f=!0,r=!0,A=n.currentDoubleValue()):y==="falseZ"?_||(_=!0,r=!0,z=n.currentDoubleValue()):y==="falseM"?b||(b=!0,r=!0,O=n.currentDoubleValue()):y==="xyUnits"?v||(v=!0,r=!0,B=n.currentDoubleValue()):y==="zUnits"?F||(F=!0,r=!0,w=n.currentDoubleValue()):y==="mUnits"?g||(g=!0,r=!0,W=n.currentDoubleValue()):y==="unit"?N||(N=!0,J=kt(n)):n.skipChildren()}S<=0&&x>0&&(S=x),x<=0&&S>0&&(x=S);let j=null,X=!0;if(V.length!==0&&(X=!1,Se(V)&&(j=Ae(V))),j||M.length===0||(X=!1,Se(M)&&(j=Ae(M))),!j&&p>0&&(X=!1,we(p)&&(S<=0||De())&&(j=Fe(p,S))),!j&&C>0&&(X=!1,we(C)&&(x<=0||De())&&(j=Fe(C,x))),X&&(j=nt(J)),r&&j){const y=new je;j.queryPrecisionDescriptorWithoutFalseXY(y),o&&y.setTolerance(0,E),c&&y.setTolerance(1,I),u&&y.setTolerance(2,U),v&&l&&f&&y.setGridParams(P,A,B),F&&_&&y.setZParams(z,w),g&&b&&y.setMParams(O,W),j=ot(j,y)}return j}function pe(n,e,t,i){i.currentToken()!==2&&m("failed to parse multipath: array of array of vertices is expected");const s=n?new Ne:new Te,a=s,r=Oe(0),o=te(2,0),c=ze(0);let u=null,l=null,f=null,_=null,b=null,v=0,F=0,g=0;const N=new Ce,C=q.getNAN();let p=0,x=0;const S=n?1:0;for(;i.nextToken()!==4;){i.currentToken()!==2&&m("failed to parse multipath: ring/path array is expected");let E=2,I=0,U=!0;const B=4;let w=0,W=0;const P=q.getNAN(),A=be(B,Number.NaN),z=be(B,Number.NaN);let O=!1;for(i.nextToken();i.currentToken()!==4;){if(e&&i.currentToken()===1)U&&m("failed to parse multipath: starting vertex array is expected"),f||(f=ze(p-1,1),_=Oe(p-1,-1),b=te(0)),O=!0,E=1,{segFlag:g,toPointSz:w}=St(N,A,C,i);else{for(O=!1,i.currentToken()!==2&&m("failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates"),w=0;i.nextToken()!==4;)w===B&&m("failed to parse multipath: each vertex array has to have at most 4 elements"),A[w++]=T(i);w<2&&m("failed to parse multipath: each vertex array has to have at least 2 elements"),Ie(A[0],A[1])||m("failed to parse multipath: x and y must be finite")}i.nextToken();do{if(o.size()===2*p&&o.resize(Me(p)),o.writePoint2D(2*p,P.setCoords(A[0],A[1])),u&&u.size()===p&&u.resize(se(p)),w>2?(u||(u=te(p+1,Number.NaN)),u.write(p,A[2])):u&&u.write(p,Number.NaN),l&&l.size()===p&&l.resize(se(p)),w>3?(l||(l=te(p+1,Number.NaN)),l.write(p,A[3])):l&&l.write(p,Number.NaN),U)x++,r.add(p),c.add(S),U=!1,W=w,qe(z,A,0,0,W);else if(f!==null)if(O){const V=ut(g),M=b.size();b.resize(M+V),f.add(g),_.add(v),N.get().writeInBufferStream(b,v),v+=V,a.incCurveType(g,1),F++}else f.add(1),_.add(-1);p++,I++,C.setCoords(A[0],A[1])}while(I<E&&i.currentToken()===4)}I!==0&&(n&&I>E&&w===W&&Qe(A,z,w)===0?(p--,I--):f!==null&&(f.add(1),_.add(-1)))}return p&&(r.resize(x),c.resize(x),p>0&&(r.add(p),c.add(0)),a.setAttributeStreamRef(0,o),a.setPathFlagsStreamRef(c),a.setPathStreamRef(r),f!==null&&(a.updateCurveCounter(F),a.setSegmentData(_,b,f,v)),a.notifyModifiedFlags(65535)),{geometry:s,as:u,bs:l}}function bt(n,e){e.currentToken()!==2&&m("failed to parse multipoint: array of vertices is expected");let t=0;const i=new ge,s=te(2,0);let a=0;const r=4,o=be(r,Number.NaN),c=new q;let u=null,l=null;for(;e.nextToken()!==4;){for(e.currentToken()!==2&&m("failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates"),a=0;e.nextToken()!==4;)a===r&&m("failed to parse multipoint: each vertex array has to have at most 4 elements"),o[a++]=T(e);a<2&&m("failed to parse multipoint: each vertex array has to have at least 2 elements"),Ie(o[0],o[1])||m("failed to parse multipoint: x and y must be finite"),s.size()===2*t&&s.resize(Me(t)),s.writePoint2D(2*t,c.setCoords(o[0],o[1])),u&&u.size()===t&&u.resize(se(t)),a>2?(u||(u=te(t+1,Number.NaN)),u.write(t,o[2])):u&&u.write(t,Number.NaN),l&&l.size()===t&&l.resize(se(t)),a>3?(l||(l=te(t+1,Number.NaN)),l.write(t,o[3])):l&&l.write(t,Number.NaN),t++}if(t){const f=i.getImpl();f.setAttributeStreamRef(0,s),f.resizeNoInit(t),f.notifyModifiedFlags(65535)}return{geometry:i,as:u,bs:l}}function yt(n,e){e.currentToken()!==2&&m("failed to parse array of IDs: array of array of integers is expected");const t=Ee(2,0);let i=0,s=-1;for(;e.nextToken()!==4;){const a=i;t.size()===i&&t.resize(se(i)),i++;let r=0;for(s===-1?s=e.currentToken()===2?1:0:s===1&&e.currentToken()!==2&&m("failed to parse array of IDs: array of array of integers is expected"),s===0&&(t.size()===i&&t.resize(se(i)),t.write(i,_e(e)),r++,i++);e.nextToken()!==4;)t.size()===i&&t.resize(se(i)),t.write(i,_e(e)),r++,i++;if(t.write(a,r),s===0)break}return t.resize(i),t}function T(n){const e=n.currentToken();if(e===10||e===6&&n.currentString()==="NaN")return Number.NaN;{const t=n.currentDoubleValue();return Number.isNaN(t)?Number.NaN:t}}function _e(n){return n.currentInt32Value()}function Nt(n,e){if(n.isEmpty())return;const t=Ee(2,0),i=n.getGeometryType();let s=0;i===ge.type?s=1:i===Te.type||i===Ne.type?s=n.getPathCount():ee("not implemented"),t.resize(n.getPointCount(),0);let a=0;for(let r=0;r<s;++r){const o=e.read(a);a++;const c=a+o;let u=0,l=0;i===ge.type?u=n.getPointCount():i===Te.type||i===Ne.type?(u=n.getPathSize(r),l=n.getPathStart(r)):ee("not implemented");for(let f=0,_=Math.min(o,u);f<_;++f)t.write(l,e.read(a)),a++,l++;a=c}n.getImpl().setAttributeStreamRef(3,t)}function Me(n){let e=2*Math.trunc(3*(n+1)/2);return e<8?e=8:e<32&&(e=32),e}function se(n){let e=Math.trunc(3*(n+1)/2);return e<4?e=4:e<16&&(e=16),e}function Tt(n,e,t,i,s){s>=i.size()&&ye("Byte_buffer out of range access"),n.m_bits=0,n.m_rotation=0,n.m_cosr=1,n.m_sinr=0,n.setStartXY(e),n.setEndXY(t);const a=q.getNAN();a.x=i.readDouble(s),a.y=i.readDouble(s+8);const r=i.readInt32(s+16);if(1&r)return n.m_semiMajorAxis=0,n.m_minorMajorRatio=1,n.m_interior.assign(a),n.m_center.setNAN(),n.m_sweepAngle=0,n.m_startAngle=0,de(n),!1;let o=!!(64&r);const c=!!(128&r);let u=!!(32&r);const l=!!(8&r),f=!!(16&r),_=e.equals(t);return o&&!_&&(o=!1,u=!0),u&&_&&(o=!0,u=!1,a.setCoords(0,0)),o||(c?u?(n.m_semiMajorAxis=1,n.m_minorMajorRatio=0,n.m_interior.assign(a),n.m_center.setNAN(),n.m_sweepAngle=0,n.m_startAngle=0):(n.constructCircularArcThreePoint(e,t,a),_&&l===n.isClockwise()&&n.reverse()):u?(n.m_semiMajorAxis=1,n.m_minorMajorRatio=0,n.m_center.setNAN(),n.m_sweepAngle=0,n.m_startAngle=0,de(n),n.queryCoord2D(.5,n.m_interior)):at(n,e,t,a,l,f)),o&&(n.m_center.assign(e),n.m_startAngle=a.x,n.m_sweepAngle=a.y,Be(n,Number.NaN,l,f),n.m_semiMajorAxis=0,n.m_minorMajorRatio=1,n.m_interior.setCoordsPoint2D(e)),n.setProjectionBehavior(0),de(n),!0}function gt(n,e,t,i,s){n.m_bits=0,n.m_center.x=i.readDouble(s),n.m_center.y=i.readDouble(s+8),n.m_rotation=i.readDouble(s+16),n.m_semiMajorAxis=i.readDouble(s+24),n.m_minorMajorRatio=i.readDouble(s+32),n.m_XStart=e.x,n.m_YStart=e.y,n.m_XEnd=t.x,n.m_YEnd=t.y;const a=i.readInt32(s+40);if(1&a)return!1;let r=!!(64&a),o=!!(128&a);const c=!!(2048&a),u=!!(4096&a);return!(512&a)&&!(1024&a)||o||(r=!0),o&&!e.equals(t)?(o=!1,r=!0):r&&e.equals(t)&&(o=!0,r=!1),o?(n.m_center.assign(e),n.m_startAngle=n.m_center.x,n.m_sweepAngle=n.m_center.y,Be(n,Number.NaN,c,u),n.m_semiMajorAxis=0,n.m_interior.setCoordsPoint2D(e)):r?(n.m_center.setNAN(),n.m_semiMajorAxis=1,n.m_minorMajorRatio=0,n.m_center.setNAN(),n.m_sweepAngle=0,n.m_startAngle=0,de(n),n.queryCoord2D(.5,n.m_interior)):n.constructEllipticArcEndPointsCenter(e,t,n.m_semiMajorAxis,n.m_minorMajorRatio,n.m_rotation,!u,c,n.m_center),n.setProjectionBehavior(1),de(n),!0}function vt(n,e,t,i,s){return D(s+32<=i.size()),n.m_cp=Ze(q,2),n.m_cp[0].x=i.readDouble(s),n.m_cp[0].y=i.readDouble(s+8),n.m_cp[1].x=i.readDouble(s+16),n.m_cp[1].y=i.readDouble(s+24),n.m_XStart=e.x,n.m_YStart=e.y,n.m_XEnd=t.x,n.m_YEnd=t.y,!0}function xt(n,e,t,i,s){return n.m_cp.x=i.readDouble(s),n.m_cp.y=i.readDouble(s+8),n.m_weights[0]=i.readDouble(s+16),n.m_weights[1]=i.readDouble(s+24),n.m_weights[2]=i.readDouble(s+32),n.m_XStart=e.x,n.m_YStart=e.y,n.m_XEnd=t.x,n.m_YEnd=t.y,!0}function St(n,e,t,i,s){const a={segFlag:0,toPointSz:0};let r=i.currentToken();r=i.nextToken();const o=i.currentString(),c=o[0];for((o.length!==1||c!=="a"&&c!=="b"&&c!=="c"&&c!=="n"&&c!=="q")&&m('failed to parse curve: expecting "a", "b", "n", "q", or "c"'),r=i.nextToken(),r!==2&&m("failed to parse curve: start array is expected for curve parameters"),r=i.nextToken(),r!==2&&m("failed to parse curve: start array is expected for to point"),a.toPointSz=0;i.nextToken()!==4;)a.toPointSz===4&&m("failed to parse curve: vertex array cannot have more than 4 elements"),e[a.toPointSz++]=T(i);a.toPointSz<2&&m("failed to parse curve: vertex array must have at least 2 elements");const u=q.construct(e[0],e[1]),l=q.getNAN();let f=-1,_=-1,b=!1,v=Number.NaN,F=Number.NaN,g=Number.NaN;const N=[q.getNAN(),q.getNAN(),q.getNAN()],C=q.getNAN();if(c==="a"){r=i.nextToken(),r!==2&&m("failed to parse curve: start array is expected for center point"),r=i.nextToken();const p=T(i);r=i.nextToken();const x=T(i);r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for center point"),l.setCoords(p,x),r=i.nextToken(),f=i.currentInt32Value(),r=i.nextToken(),_=i.currentInt32Value(),r=i.nextToken(),r!==4?(b=!1,v=T(i),r=i.nextToken(),F=T(i),r=i.nextToken(),g=T(i),r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for curve parameters")):b=!0,a.segFlag=4}else if(c==="b"){for(let p=0;p<2;p++){r=i.nextToken(),r!==2&&m("failed to parse curve: start array is expected for control point"),r=i.nextToken();const x=T(i);r=i.nextToken();const S=T(i);r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for control point"),N[p].setCoords(x,S)}r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for curve parameters"),a.segFlag=2}else if(c==="n"){{r=i.nextToken(),r!==2&&m("failed to parse curve: start array is expected for control point"),r=i.nextToken();const E=T(i);r=i.nextToken();const I=T(i);r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for control point"),N[0].setCoords(E,I)}r=i.nextToken();const p=T(i);r=i.nextToken();const x=T(i);r=i.nextToken();const S=T(i);N[1].setCoords(p,x),N[2].setCoords(S,S),r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for curve parameters"),a.segFlag=8}else if(c==="q"){for(let p=0;p<1;p++){r=i.nextToken(),r!==2&&m("failed to parse curve: start array is expected for control point"),r=i.nextToken();const x=T(i);r=i.nextToken();const S=T(i);r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for control point"),N[p].setCoords(x,S)}r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for curve parameters"),a.segFlag=16}else{r=i.nextToken(),r!==2&&m("failed to parse curve: start array is expected for interior point"),r=i.nextToken();const p=T(i);r=i.nextToken();const x=T(i);r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for interior point"),C.setCoords(p,x),r=i.nextToken(),r!==4&&m("failed to parse curve: end array is expected for curve parameters"),a.segFlag=4}return r=i.nextToken(),r!==3&&m("failed to parse curve: end object is expected for curve"),c==="a"?(n.createEllipticArc(),b?Re(n.get(),t,u,l,!0,f,_):At(n.get(),t,u,l,f,_,v,F,g)):c==="b"?(n.createCubicBezier(),wt(n.get(),t,u,N)):c==="n"?(n.createQuadraticRationalBezier(),Dt(n.get(),t,u,N[0],N[1].x,N[1].y,N[2].x)):c==="q"?(n.createQuadraticBezier(),n.get().construct(t,N[0],u)):(n.createEllipticArc(),Re(n.get(),t,u,C,!1,-1,-1)),a}function Re(n,e,t,i,s,a,r){n.dropAllAttributes();const o=20,c=new ArrayBuffer(o),u=new ae({sz:o,buffer:c});let l=0;u.writeDouble(l,i.x),l+=8,u.writeDouble(l,i.y),l+=8;let f=0;s?(r||(f|=8),a&&(f|=16)):f|=128,u.writeInt32(l,f),l+=4,Tt(n,e,t,u,0)}function At(n,e,t,i,s,a,r,o,c){n.dropAllAttributes();const u=44,l=new ArrayBuffer(u),f=new ae({sz:u,buffer:l});let _=0;f.writeDouble(_,i.x),_+=8,f.writeDouble(_,i.y),_+=8,f.writeDouble(_,r),_+=8,f.writeDouble(_,o),_+=8,f.writeDouble(_,c),_+=8;let b=0;a||(b|=2048),s&&(b|=4096),f.writeInt32(_,b),_+=4,gt(n,e,t,f,0)}function wt(n,e,t,i){n.dropAllAttributes();const s=32,a=new ArrayBuffer(s),r=new ae({sz:s,buffer:a});let o=0;r.writeDouble(o,i[0].x),o+=8,r.writeDouble(o,i[0].y),o+=8,r.writeDouble(o,i[1].x),o+=8,r.writeDouble(o,i[1].y),o+=8,vt(n,e,t,r,0)}function Dt(n,e,t,i,s,a,r){n.dropAllAttributes();const o=40,c=new ArrayBuffer(o),u=new ae({sz:o,buffer:c});let l=0;u.writeDouble(l,i.x),l+=8,u.writeDouble(l,i.y),l+=8,u.writeDouble(l,s),l+=8,u.writeDouble(l,a),l+=8,u.writeDouble(l,r),l+=8,xt(n,e,t,u,0)}function Ft(n,e,t,i,s){const a=n.getGeometryType();if(a===h.enumEllipticArc)return Ct(n,e,t,i,s);if(a===h.enumBezier)return Ue(n,e,t,i,s);if(a===h.enumRationalBezier2)return jt(n,e,t,i,s);if(a===h.enumBezier2){const r=new rt;return r.constructFromQuadraticSegment(n),Ue(r,e,t,i,s)}ce("")}function Ct(n,e,t,i,s){D(!st(n));const a=n.getEndXY(),r=n.hasAttribute(1)&&!e,o=n.hasAttribute(2)&&!t;let c=Number.NaN,u=Number.NaN;if(r&&(c=n.getEndAttributeAsDbl(1,0)),o&&(u=n.getEndAttributeAsDbl(2,0)),n.isDegenerateToLine()||n.isDegenerate(0))return oe(r,o,a.x,a.y,c,u,i,s),!0;const l=n.projectionBehavior()===0,f=!!l&&n.isClosed();if(l&&!f)s.startObject(),s.addFieldName("c"),s.startArray(),oe(r,o,a.x,a.y,c,u,i,s),ue(n.m_interior.x,n.m_interior.y,17,s),s.endArray(),s.endObject();else if(l){s.startObject(),s.addFieldName("a"),s.startArray(),oe(r,o,a.x,a.y,c,u,i,s),ue(n.m_center.x+0,n.m_center.y+0,17,s);const _=!n.isMajor();s.addInt32(_?1:0);const b=n.isClockwise();s.addInt32(b?1:0),s.endArray(),s.endObject()}else{s.startObject(),s.addFieldName("a"),s.startArray(),oe(r,o,a.x,a.y,c,u,i,s);const _=n;ue(_.m_center.x,_.m_center.y,17,s);const b=!_.isMajor();s.addInt32(b?1:0);const v=_.isClockwise();s.addInt32(v?1:0),s.addDouble(_.m_rotation,17),s.addDouble(_.m_semiMajorAxis,17),s.addDouble(_.m_minorMajorRatio,17),s.endArray(),s.endObject()}return!1}function Ue(n,e,t,i,s){const a=n.getEndXY(),r=n.hasAttribute(1)&&!e,o=n.hasAttribute(2)&&!t;let c=Number.NaN,u=Number.NaN;return r&&(c=n.getEndAttributeAsDbl(1,0)),o&&(u=n.getEndAttributeAsDbl(2,0)),s.startObject(),s.addFieldName("b"),s.startArray(),oe(r,o,a.x,a.y,c,u,i,s),ue(n.m_cp[0].x,n.m_cp[0].y,i,s),ue(n.m_cp[1].x,n.m_cp[1].y,i,s),s.endArray(),s.endObject(),!1}function jt(n,e,t,i,s){const a=n.getEndXY(),r=n.hasAttribute(1)&&!e,o=n.hasAttribute(2)&&!t;let c=Number.NaN,u=Number.NaN;r&&(c=n.getEndAttributeAsDbl(1,0)),o&&(u=n.getEndAttributeAsDbl(2,0)),s.startObject(),s.addFieldName("n"),s.startArray(),oe(r,o,a.x,a.y,c,u,i,s),ue(n.m_cp.x,n.m_cp.y,i,s);const l=i;return s.addDouble(n.m_weights[0],l),s.addDouble(n.m_weights[1],l),s.addDouble(n.m_weights[2],l),s.endArray(),s.endObject(),!1}function oe(n,e,t,i,s,a,r,o){o.startArray(),o.addDouble(t,r),o.addDouble(i,r),n&&o.addDouble(s,r),e&&o.addDouble(a,r),o.endArray()}function ue(n,e,t,i){i.startArray(),i.addDouble(n,t),i.addDouble(e,t),i.endArray()}class Ot{getOperatorType(){return 10405}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,i,s,a,r){zt(e,t,i,s)}exportSpatialReference(e,t,i,s){D(0)}exportProjectionTransformation(e,t,i,s){D(0)}exportDatumTransformation(e,t,i,s){D(0)}static geometryTypeToString(e){return D(0),""}}function zt(n,e,t,i,s){if(e||t){if(i.startObject(),e!==null)switch(e.getGeometryType()){case h.enumPolygon:We(!0,n,e,i);break;case h.enumPolyline:We(!1,n,e,i);break;case h.enumMultiPoint:It(n,e,i);break;case h.enumPoint:Et(n,e,i);break;case h.enumEnvelope:Bt(n,e,i);break;case h.enumMultipatch:D(0);break;default:ee("exportToJSON")}t!==null&&(i.addFieldName("spatialReference"),Vt(n,t,i)),i.endObject()}}function We(n,e,t,i){const s=t.getImpl(),a=!!(2&e),r=!!(4&e),o=!!(8&e),c=s.hasAttribute(1)&&!a,u=s.hasAttribute(2)&&!r,l=s.hasAttribute(3)&&!o,f=s.hasNonLinearSegments();c&&(i.addFieldName("hasZ"),i.addBool(!0)),u&&(i.addFieldName("hasM"),i.addBool(!0)),n?f?i.addFieldName("curveRings"):i.addFieldName("rings"):f?i.addFieldName("curvePaths"):i.addFieldName("paths");let _=null;const b=[];if(t.isEmpty())i.startArray(),i.endArray();else{const v=17-(31&e>>13);i.startArray();const F=t.getPathCount();let g=0;const N=s.getAttributeStreamRef(0);let C=null,p=null,x=null;const S=new Ce;let E=null,I=null,U=null;f&&(E=s.getSegmentFlagsStreamRef(),I=s.getSegmentIndexStreamRef(),U=s.getSegmentDataStreamRef()),c&&(C=s.getAttributeStreamRef(1)),u&&(p=s.getAttributeStreamRef(2)),l&&(x=s.getAttributeStreamRef(3),_=it(3,0));for(let B=0;B<F;B++){i.startArray(),l&&b.push(0);const w=t.getPathEnd(B);if(g===w){i.endArray();continue}const W=t.isClosedPath(B);let P=N.read(2*g),A=N.read(2*g+1),z=c?C.read(g):Number.NaN,O=u?p.read(g):Number.NaN,V=l?x.read(g):0;he(c,u,P,A,z,O,v,i);let M=1;l&&(_.add(V),b[b.length-1]++);const J=P,j=A,X=z,y=O,ne=V;let me=!1,ie=0,Z=Number.NaN,H=Number.NaN,re=0;for(let Y=g+1,$=g,le=W?w+1:w;Y<le;Y++,$++){const L=E!==null?31&E.read($):1;let G,Q;if(Y<w?(G=N.read(2*Y),Q=N.read(2*Y+1),c&&(Z=C.read(Y)),u&&(H=p.read(Y)),l&&(re=x.read(Y))):(G=J,Q=j,Z=X,H=y,re=ne),L!==1){me=!0,L===4?S.createEllipticArc():L===2?S.createCubicBezier():L===16?S.createQuadraticBezier():L===8?S.createQuadraticRationalBezier():ce("JSON export.unsupported curve");const K=S.get(),R=I.read($);K.setStartXYCoords(P,A),K.setEndXYCoords(G,Q),c&&(K.setStartAttribute(1,0,z),K.setEndAttribute(1,0,Z)),u&&(K.setStartAttribute(2,0,O),K.setEndAttribute(2,0,H)),K.readFromBufferStream(U,R),Ft(S.get(),a,r,v,i)&&ie++}else he(c,u,G,Q,Z,H,v,i);l&&(_.add(re),b[b.length-1]++),M++,P=G,A=Q,z=Z,O=H,V=re}me&&ie===0||(M<2&&ie<1&&(he(c,u,P,A,z,O,v,i),M++,l&&(_.add(V),b[b.length-1]++)),W&&M<3&&ie<2&&(he(c,u,J,j,X,y,v,i),M++,P=J,A=j,z=X,O=y,V=ne,l&&(_.add(ne),b[b.length-1]++))),i.endArray(),g=w}i.endArray()}if(l){i.addFieldName("ids"),i.startArray();let v=0;for(let F=0,g=b.length;F<g;++F){const N=b[F];D(N===0||_!==null&&v+N<=_.size()),i.startArray();for(let C=0;C<N;++C)i.addInt32(_.read(v)),v++;i.endArray()}i.endArray()}}function It(n,e,t){const i=e.getImpl(),s=i.hasAttribute(1)&&!(2&n),a=i.hasAttribute(2)&&!(4&n),r=i.hasAttribute(3)&&!(8&n);s&&(t.addFieldName("hasZ"),t.addBool(!0)),a&&(t.addFieldName("hasM"),t.addBool(!0)),t.addFieldName("points");const o=e.getPointCount();if(e.isEmpty())t.startArray(),t.endArray();else{const c=17-(31&n>>13);t.startArray();const u=i.getAttributeStreamRef(0);let l=null,f=null;s&&(l=i.getAttributeStreamRef(1)),a&&(f=i.getAttributeStreamRef(2));for(let _=0;_<o;_++){const b=u.read(2*_),v=u.read(2*_+1);let F=Number.NaN,g=Number.NaN;s&&(F=l.read(_)),a&&(g=f.read(_)),he(s,a,b,v,F,g,c,t)}t.endArray()}if(r){let c=null;i.isEmpty()||(c=i.getAttributeStreamRef(3)),D(o===0||c!==null&&c.size()>=o),t.addFieldName("ids"),t.startArray();for(let u=0;u<o;u++)t.addInt32(c.read(u));t.endArray()}}function Et(n,e,t){const i=e.hasAttribute(1)&&!(2&n),s=e.hasAttribute(2)&&!(4&n),a=e.hasAttribute(3)&&!(8&n);if(e.isEmpty())return t.addFieldName("x"),t.addNull(),t.addFieldName("y"),t.addNull(),i&&(t.addFieldName("z"),t.addNull()),s&&(t.addFieldName("m"),t.addNull()),void(a&&(t.addFieldName("id"),t.addInt32(0)));const r=17-(31&n>>13);t.addFieldName("x"),t.addDouble(e.getX(),r),t.addFieldName("y"),t.addDouble(e.getY(),r),i&&(t.addFieldName("z"),t.addDouble(e.getZ(),r)),s&&(t.addFieldName("m"),t.addDouble(e.getM(),r)),a&&(t.addFieldName("id"),t.addInt32(e.getID()))}function Bt(n,e,t){const i=e.hasAttribute(1)&&!(2&n),s=e.hasAttribute(2)&&!(4&n),a=e.hasAttribute(3)&&!(8&n);if(e.isEmpty())return t.addFieldName("xmin"),t.addNull(),t.addFieldName("ymin"),t.addNull(),t.addFieldName("xmax"),t.addNull(),t.addFieldName("ymax"),t.addNull(),i&&(t.addFieldName("zmin"),t.addNull(),t.addFieldName("zmax"),t.addNull()),s&&(t.addFieldName("mmin"),t.addNull(),t.addFieldName("mmax"),t.addNull()),void(a&&(t.addFieldName("idmin"),t.addInt32(0),t.addFieldName("idmax"),t.addInt32(0)));const r=17-(31&n>>13);if(t.addFieldName("xmin"),t.addDouble(e.getXMin(),r),t.addFieldName("ymin"),t.addDouble(e.getYMin(),r),t.addFieldName("xmax"),t.addDouble(e.getXMax(),r),t.addFieldName("ymax"),t.addDouble(e.getYMax(),r),i){const o=e.queryInterval(1,0);t.addFieldName("zmin"),t.addDouble(o.vmin,r),t.addFieldName("zmax"),t.addDouble(o.vmax,r)}if(s){const o=e.queryInterval(2,0);t.addFieldName("mmin"),t.addDouble(o.vmin,r),t.addFieldName("mmax"),t.addDouble(o.vmax,r)}if(a){const o=e.queryInterval(3,0);t.addFieldName("idmin"),t.addInt32(o.vmin),t.addFieldName("idmax"),t.addInt32(o.vmax)}}function Pt(n,e,t){t.startObject();const i=e.getID();i<=0&&m("cannot export unit that has no valid WKID"),t.addFieldName("uwkid"),t.addInt32(i),t.endObject()}function Vt(n,e,t){t.startObject();let i=0;e.isCustomWkid()||(i=e.getOldID());let s=0;const a=e.getVCS();if(a!==null&&(a.isCustomWkid()||(s=a.getOldID()),s<=0&&(i=0)),i>0){t.addFieldName("wkid"),t.addInt32(i);const r=e.getLatestID();if(r>0&&r!==i&&(t.addFieldName("latestWkid"),t.addInt32(r)),s>0){t.addFieldName("vcsWkid"),t.addInt32(s);const o=e.getLatestVerticalID();o!==s&&(t.addFieldName("latestVcsWkid"),t.addInt32(o))}}if(e.getCoordinateSystemType()===0)t.addFieldName("wkid"),t.addNull(),e.getUnit()!==null&&(t.addFieldName("unit"),Pt(n,e.getUnit(),t));else if(i<=0||1&n){let r="";64&n&&(r=e.getText2(),t.addFieldName("wkt2"),t.addString(r));const o=e.getText();o!==r&&(t.addFieldName("wkt"),t.addString(o))}if(16&n){const r=new je;e.queryPrecisionDescriptor(r),t.addFieldName("xyTolerance"),t.addDouble(r.getTolerance(0)),t.addFieldName("zTolerance"),t.addDouble(r.getTolerance(1)),t.addFieldName("mTolerance"),t.addDouble(r.getTolerance(2)),t.addFieldName("falseX"),t.addDouble(r.getFalseX()),t.addFieldName("falseY"),t.addDouble(r.getFalseY()),t.addFieldName("xyUnits"),t.addDouble(r.getGridUnitsXY()),t.addFieldName("falseZ"),t.addDouble(r.getFalseZ()),t.addFieldName("zUnits"),t.addDouble(r.getGridUnitsZ()),t.addFieldName("falseM"),t.addDouble(r.getFalseM()),t.addFieldName("mUnits"),t.addDouble(r.getGridUnitsM())}t.endObject()}function he(n,e,t,i,s,a,r,o){o.startArray(),o.addDouble(t,r),o.addDouble(i,r),n&&o.addDouble(s,r),e&&o.addDouble(a,r),o.endArray()}const d={s_a:97,s_A:65,s_asterisk:42,s_b:98,s_backslash:92,s_beginArray:91,s_beginObject:123,s_colon:58,s_period:46,s_comma:44,s_doubleQuote:34,s_endArray:93,s_endObject:125,s_e:101,s_E:69,s_f:102,s_F:70,s_forwardslash:47,s_minus:45,s_plus:43,s_n:110,s_N:78,s_r:114,s_t:116,s_u:117,s_zero:48,s_nine:57};class Mt{constructor(e){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder("utf-8",{fatal:!0}),e===void 0?(this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push(()=>this.accept_()),this.m_jsonString=null,this.m_bHasEscapes=!1):e.jsonString?this.resetParserFromString(e.jsonString):e.jsonStream?ce("streaming json parsing not yet impl"):ee("invalid constructor parameter")}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(e){const t=this.m_jsonString?.slice(this.m_startToken,this.m_startToken+e-1);return this.m_endToken+=e-1,{s:t,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){ce("streaming json parsing not yet impl")}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push(()=>this.start_()),this.m_pushPositions.length=0}resetParserFromString(e){this.reset_(),this.setStringFunctions_(),this.m_jsonString=e}resetParserFromStream(e){ce("streaming json parsing not yet impl")}resetToPosition(e){return!!this.m_jsonString&&(this.m_endToken=e,this.m_startToken=Number.MAX_VALUE,this.m_currentTokenType=0,this.m_functionStack.length=0,e>=this.m_jsonString.length?(this.m_functionStack.push(()=>this.accept_()),!1):(this.m_functionStack.push(()=>this.start_()),!0))}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return D(0),""}childrenAsString(){return D(0),""}skipChildren(){this.skipChildren_()}skipChildren_(){if(this.m_currentTokenType!==1){if(this.m_currentTokenType===2){let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===2?e++:this.m_currentTokenType===4&&e--;while(this.m_currentTokenType!==4||e!==0)}}else{let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===1?e++:this.m_currentTokenType===3&&e--;while(this.m_currentTokenType!==3||e!==0)}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return"null";case 11:return"true";case 12:return"false"}m("invalid token")}toUTF8_(e,t){let i=0,s=e;for(;t.charCodeAt(s)===d.s_backslash&&t.charCodeAt(s+1)===d.s_u;)i++,s+=6;s=e;const a=new Uint8Array(i);let r=0;for(;t.charCodeAt(s)===d.s_backslash&&t.charCodeAt(s+1)===d.s_u;)a[r++]=Number.parseInt(t.slice(s+2,s+6),16),s+=6;return{u8s:this.m_utf8Decoder.decode(a),end:s}}unquoteCurrentString_(){let e="",t=1;const i=this.m_endToken-this.m_startToken-1;let s=0;const a=this.m_getCurrentSubstr();for(let r=t;r<i;r++)if(a.charCodeAt(r)!==d.s_backslash)s++;else{switch(s>0&&(e+=a.slice(t,t+s)),a.charCodeAt(++r)){case d.s_doubleQuote:e+='"';break;case d.s_u:{const{u8s:o,end:c}=this.toUTF8_(r-1,a);r=c-1,e+=o;break}case d.s_backslash:e+="\\";break;case d.s_forwardslash:e+="/";break;case d.s_b:e+="\b";break;case d.s_f:e+="\f";break;case d.s_n:e+=`
`;break;case d.s_r:e+="\r";break;case d.s_t:e+="	"}t=r+1,s=0}return s>0&&(e+=a.slice(t,t+s)),e}currentString(){return this.m_currentTokenType!==5&&this.m_currentTokenType!==6?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(this.m_currentTokenType!==7&&this.m_currentTokenType!==8&&this.m_currentTokenType!==9&&this.m_currentTokenType!==6&&this.m_currentTokenType!==10&&m("invalid token"),this.m_currentTokenType===10)return Number.NaN;let e=this.m_getCurrentSubstr(),t=this.m_endToken-this.m_startToken;if(this.m_currentTokenType===6){if(this.currentString()==="NaN")return Number.NaN;e=e.slice(1),t-=2,t===0&&m("invalid token")}const i=Number.parseFloat(e);if(this.m_currentTokenType===6)Number.isNaN(i)&&m("invalid token");else if(Number.isNaN(i))return Number.NaN;return i}currentInt32Value(){this.m_currentTokenType!==8&&this.m_currentTokenType!==6&&m("invalid token");let e=this.m_getCurrentSubstr(),t=this.m_endToken-this.m_startToken;this.m_currentTokenType===6&&(e=e.slice(1),t-=2,t===0&&m("invalid token"));const i=parseInt(e);return Number.isNaN(i)&&m("invalid token"),i}currentInt64Value(){return D(0),0n}currentBoolValue(){return D(0),!1}isError(){return 0}JSONString(){return D(0),""}pushPosition(){return D(0),!1}popPosition(){return D(0),!1}skipCStyleComments_(){D(0)}skipCppStyleComments_(){D(0)}skipComments_(){this.m_prepSubstr();let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),e===d.s_asterisk?this.skipCStyleComments_():e===d.s_forwardslash?this.skipCppStyleComments_():m("invalid token")}skipWhiteSpace_(){let e;do{this.m_eof()&&m("invalid token");let t=this.m_peekChar();for(;t>=9&&t<=13||t===32;)this.m_increment(),this.m_eof()&&m("invalid token"),t=this.m_peekChar();t===d.s_forwardslash?(this.m_startToken=this.m_endToken,e=!0,this.skipComments_()):e=!1}while(e)}rightBracket_(){return this.m_peekChar()===d.s_endArray&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===d.s_endObject&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&m("invalid token");let e=this.m_peekChar();for(;e!==d.s_doubleQuote;){const t=e===d.s_backslash;if(this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),t)if(this.m_bHasEscapes=!0,e===d.s_doubleQuote||e===d.s_backslash||e===d.s_forwardslash||e===d.s_b||e===d.s_f||e===d.s_n||e===d.s_r||e===d.s_t)this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar();else if(e===d.s_u)for(let i=0;i<4;i++)this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),e>=d.s_zero&&e<=d.s_nine||e>=d.s_a&&e<=d.s_f||e>=d.s_A&&e<=d.s_F||m("invalid token");else m("invalid token")}this.m_stepOverChar()}comma_(){return this.m_peekChar()===d.s_comma&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===d.s_colon&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):m("invalid token")}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==d.s_doubleQuote&&m("invalid token"),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push(()=>this.fieldNameEnd_())}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():m("invalid token")}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push(()=>this.elementEnd_()),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():m("invalid token")}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push(()=>this.pairEnd_()),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push(()=>this.objectStart_())}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push(()=>this.arrayStart_())}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()!==d.s_zero?this.digits_():this.m_stepOverChar()}digits_(){let e=this.m_peekChar();do this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar();while(e>=d.s_zero&&e<=d.s_nine)}frac_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),e>=d.s_zero&&e<=d.s_nine||m("invalid token"),this.digits_()}exp_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),e!==d.s_plus&&e!==d.s_minus||(this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar()),e>=d.s_zero&&e<=d.s_nine||m("invalid token"),this.digits_()}valueNumber_(){this.m_prepSubstr();let e=!1,t=this.m_peekChar();if(t===d.s_minus?(this.m_stepOverChar(),this.m_eof()&&m("invalid token"),t=this.m_peekChar(),e=!0,t>=d.s_zero&&t<=d.s_nine||m("invalid token"),this.int_()):this.int_(),t=this.m_peekChar(),t===d.s_period)this.m_currentTokenType=7,this.frac_(),t=this.m_peekChar(),t!==d.s_e&&t!==d.s_E||this.exp_();else if(t===d.s_e||t===d.s_E)this.m_currentTokenType=7,this.exp_();else{let i=0;e&&i++;const s=this.m_endToken-this.m_startToken-i;if(s<10)this.m_currentTokenType=8;else if(s===10){const a=this.m_getCurrentSubstr();e?a.slice(i)<="2147483648"?this.m_currentTokenType=8:this.m_currentTokenType=9:a.slice(i)<="2147483647"?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(s<19)this.m_currentTokenType=9;else if(s===19){const a=this.m_getCurrentSubstr();e?a.slice(i)<="9223372036854775808"?this.m_currentTokenType=9:this.m_currentTokenType=7:a.slice(i)<="9223372036854775807"?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){const{s:e,bDone:t}=this.m_get(5);t&&m("invalid token"),e!=="null"&&m("invalid token"),this.m_currentTokenType=10}valueTrue_(){const{s:e,bDone:t}=this.m_get(5);t&&m("invalid token"),e!=="true"&&m("invalid token"),this.m_currentTokenType=11}valueFalse_(){const{s:e,bDone:t}=this.m_get(6);t&&m("invalid token"),e!=="false"&&m("invalid token"),this.m_currentTokenType=12}valueNan_(){const{s:e,bDone:t}=this.m_get(4);t&&m("invalid token"),e!=="NaN"&&m("invalid token"),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;const e=this.m_peekChar();e===d.s_beginObject?this.valueStartObject_():e===d.s_beginArray?this.valueStartArray_():e===d.s_doubleQuote?this.valueString_():e===d.s_minus||e>=d.s_zero&&e<=d.s_zero+9?this.valueNumber_():e===d.s_n?this.valueNull_():e===d.s_t?this.valueTrue_():e===d.s_f?this.valueFalse_():e===d.s_N?this.valueNan_():m("invalid token")}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push(()=>this.accept_());const e=this.m_peekChar();e!==d.s_beginObject&&e!==d.s_beginArray&&m("invalid token"),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}}class Rt{getOperatorType(){return 10404}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,i,s,a,r,o){let c;typeof i=="string"?(c=new Mt({jsonString:i}),c.nextToken()):c=i,c.currentToken()!==1&&m("failed to import map geometry: start of object is expected");const u=pt(t,e,c,s,a);return new xe(u)}importSpatialReference(e){const t=Ve(e);return t===null&&ee("failed to import spatial reference"),t}importProjectionTransformation(e,t){return D(0),{}}importDatumTransformation(e,t){return D(0),{}}static stringToGeometryType(e){return(e=e.toLowerCase()).startsWith("esrigeometry")||m("string_to_geometry_type"),e.endsWith("point")?h.enumPoint:e.endsWith("envelope")?h.enumEnvelope:e.endsWith("multipoint")?h.enumMultiPoint:e.endsWith("polyline")?h.enumPolyline:e.endsWith("polygon")?h.enumPolygon:void m("string_to_geometry_type")}}const ve=new ft,Ut=new Ot,Wt=new Rt;function Xt(n){return Array.isArray(n)?n[0].spatialReference:n.spatialReference}function Xe(n,e){const t=new ht(n,{strict:!1});return t.nextToken(),Wt.execute(0,h.enumUnknown,t,!0,e)}function Lt(n){let e=null;return[n.map(t=>{if(e==null){const i=Le(t);return e=i.getSpatialReference(),i.getGeometry()}return Ge(t)}),e]}function Le(n){return Xe(n,!0)}function Ge(n){return Xe(n,!1).getGeometry()}function Gt(n,e){return n instanceof xe&&(e=n.getSpatialReference(),n=n.getGeometry()),n?.isEmpty()?null:(ve.reset(),Ut.execute(0,n,e,ve),ve.getObject())}export{Lt as fromGeometries,Le as fromGeometry,Ge as fromGeometryToGXGeometry,Xt as getSpatialReference,Gt as toGeometry};
