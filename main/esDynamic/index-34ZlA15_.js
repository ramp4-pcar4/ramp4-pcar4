import{eM as B,eN as N,f4 as P,eQ as q,eT as Z,eS as x,f6 as L,dq as l,eU as O,eV as U,dr as C,eZ as _,dn as R,dp as b,k6 as te,r as k,f2 as ae,f3 as G,f5 as J,eR as H,eY as T,hz as ne,gU as K,jL as D,k7 as oe,k8 as ie,e_ as se,eO as le,gj as j,f1 as re,k9 as F,ka as pe,f8 as V,eX as I,eW as M,jD as Y,kb as ue,F as de,eC as ce}from"./main-CnDVnExo.js";class X{id;options;componentId;constructor(a){const r={options:{},...a};({id:this.id,options:this.options,componentId:this.componentId}=r)}}const me=["innerHTML"],W=B({__name:"default-button",props:{panelId:{type:String,required:!0},minimize:{type:Boolean,default:!1},overflow:{type:Boolean}},setup(f){const{t:a}=N(),r=P("iApi"),n=f,c=q(()=>r.panel.get(n.panelId)?.button),s=()=>{n.minimize?r.panel.toggleMinimize(n.panelId):r.panel.toggle(n.panelId)};return(e,$)=>{const p=Z("appbar-button");return c.value?(l(),x(p,{key:0,onClickFunction:s,tooltip:O(a)(c.value.tooltip),id:f.panelId},{default:U(()=>[C("div",{class:_(["default fill-current w-24 h-24 ml-8 sm:ml-20",{"ml-20":f.overflow}]),innerHTML:c.value.icon},null,10,me)]),_:1},8,["tooltip","id"])):L("",!0)}}}),ve={},fe={class:"border-b p-0 self-center w-2/3"};function he(f,a){return l(),b("span",fe)}const ee=R(ve,[["render",he],["__scopeId","data-v-5d32b715"]]);var be={name:"maxSize",enabled:!0,phase:"main",requiresIfExists:["offset","preventOverflow","flip"],fn:function(f){var a=f.state,r=f.name,n=f.options,c=te(a,n),s=a.modifiersData.preventOverflow||{x:0,y:0},e=s.x,$=s.y,p=a.rects.popper,u=p.width,h=p.height,z=a.placement.split("-"),w=z[0],E=w==="left"?"left":"right",v=w==="top"?"top":"bottom";a.modifiersData[r]={width:u-c[E]-e,height:h-c[v]-$}}};const ge=["content","aria-label"],ye=B({__name:"more-button",props:{position:{type:String,default:"right-end"},popperOptions:{type:Object,default(){return{}}},numItems:{type:Number,default:1},renderWatch:{type:Number,default:0}},emits:["updateParent"],setup(f,{expose:a,emit:r}){const{t:n}=N(),c=P("iApi"),s=f,e=r;function $(){e("updateParent")}const p=k(!1),u=k(0),h=k(),z=k(),w=k();function E(){$(),D(()=>{v(),p.value=!p.value})}ae(()=>s.renderWatch,()=>{E()});const v=()=>{p.value=!p.value;const d=c.$vApp.$el.querySelector(".inner-shell"),g={name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:m}){const{width:o}=m.modifiersData.maxSize;m.styles.popper={...m.styles.popper,maxWidth:`${o}px`,maxHeight:`${d.offsetHeight-45}px`};const y=Math.min(s.numItems<=0?0:55+44*(s.numItems-1),d.offsetHeight-45);m.styles.popper.height=`${y}px`,w?.value?.offsetHeight&&(w.value.style.height=`${y}px`),m.styles.popper.overflowY="auto",m.styles.popper.overflowX="hidden"}};z.value&&w.value&&(u.value++,oe(z.value,w.value,{placement:s.position||"right-end",modifiers:[{...be,options:{boundary:d}},g,{name:"offset",options:{offset:[0,5]}},{name:"preventOverflow",enabled:!0,options:{boundary:d}}],...s.popperOptions})),u.value===1&&E()};return G(()=>{window.addEventListener("click",d=>{d.target instanceof HTMLElement&&!h.value?.contains(d.target)&&(p.value=!1)},{capture:!0})}),J(()=>{window.removeEventListener("click",d=>{d.target instanceof HTMLElement&&!h.value?.contains(d.target)&&(p.value=!1)},{capture:!0})}),a({rerender:E}),(d,g)=>{const m=T("focus-item"),o=T("tippy");return l(),b("div",{class:"appbar-item relative inset-x-0 w-full text-center",ref_key:"el",ref:h},[H((l(),b("button",{type:"button",class:"text-gray-400 w-full h-48 focus:outline-none hover:text-white",onClick:g[0]||(g[0]=y=>v()),content:O(n)("appbar.more"),"aria-label":O(n)("appbar.more"),ref_key:"dropdownTrigger",ref:z},g[1]||(g[1]=[C("svg",{class:"fill-current w-24 h-24 m-auto",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[C("path",{d:"M0 0h24v24H0z",fill:"none"}),C("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})],-1)]),8,ge)),[[m],[o,{placement:"right-end"}]]),H(C("div",{id:"dropdown",class:"dropdown shadow-md border border-gray:200 absolute w-64 flex flex-col bg-white rounded",ref_key:"dropdown",ref:w},[ne(d.$slots,"default",{},void 0,!0)],512),[[K,p.value]])],512)}}}),$e=R(ye,[["__scopeId","data-v-87bcc276"]]),we={key:0,class:"number absolute top-1 right-2 text-white w-18 rounded-full"},xe=B({__name:"appbar-button",setup(f){const a=ie(),{t:r}=N(),n=P("iApi"),c=q(()=>a.notificationNumber),s=()=>{n.panel.toggle("notifications")};return(e,$)=>{const p=Z("appbar-button",!0);return l(),x(p,{onClickFunction:s,tooltip:O(r)("notifications.title"),class:"notification-button",id:""},{default:U(()=>[$[0]||($[0]=C("svg",{class:"fill-current w-24 h-24 mx-8 sm:mx-20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[C("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})],-1)),c.value&&c.value>0?(l(),b("span",we,se(c.value),1)):L("",!0)]),_:1},8,["tooltip"])}}}),ke=R(xe,[["__scopeId","data-v-787da765"]]),Ie=["content"],_e=B({__name:"appbar",setup(f){const a=le(),r=j(),n=k(0),c=k(0),s=q(()=>r.visible),e=q(()=>r.temporary),{t:$}=N(),p=k(!1),u=k({}),h=k(),z=()=>{D(()=>{F()?.proxy?.$forceUpdate()})},w=()=>{h.value._tippy.hide()},E=v=>{v.key==="Tab"&&h.value?.matches(":focus")&&h.value._tippy.show()};return G(()=>{h.value?.addEventListener("blur",w),h.value?.addEventListener("keyup",E)}),re(()=>{const v=F();window.addEventListener("resize",()=>v?.proxy?.$forceUpdate())}),J(()=>{const v=F();window.removeEventListener("resize",()=>v?.proxy?.$forceUpdate()),h.value?.removeEventListener("blur",w),h.value?.removeEventListener("keyup",E)}),pe(()=>{D(()=>{const v=h.value;let d;const g=[...v.children];let m=g[g.length-2].getBoundingClientRect().top;a.mobileView||(m=v.getBoundingClientRect().bottom-38);const o=v.querySelector("#dropdown");for(let i=g.length-4;i>=0;i--){const A=g[i].getBoundingClientRect().bottom;if(m&&o&&(A>m||p.value&&A+56>m))g[i].classList.forEach(S=>{S.includes("identifier")&&(d=S.slice(11))}),d&&(u.value[d]=!0,d.includes("divider")||n.value++,c.value++),p.value||(p.value=!0);else if(A!==0)break}const y=v.querySelector("#more");let t=y.getBoundingClientRect().bottom;if(d=void 0,p.value&&m&&y&&o&&t!==0&&(t<=m-56||o.childElementCount==1&&t<=m)){let i=o.childElementCount,A=0;for(;t<=m-56||i==1;){const S=o.children[A];if(S&&(S.classList.forEach(Q=>{Q.includes("identifier")&&(d=Q.slice(11))}),d&&(u.value[d]=!1,d.includes("divider")||n.value--),t+=48,i-=1,A+=1),i===0){p.value=!1;break}}}Object.keys(u.value).forEach(i=>{v.querySelector(`.identifier-${i}`)||(delete u.value[i],i.includes("divider")||(n.value=Math.max(0,n.value-1)),c.value++)})})}),(v,d)=>{const g=T("focus-list"),m=T("tippy");return H((l(),b("div",{class:"absolute top-0 left-0 bottom-28 flex flex-col w-40 pointer-events-auto appbar z-50 sm:z-20 bg-black-75 sm:w-64 sm:bottom-38",content:O($)("panels.controls.items"),ref_key:"el",ref:h},[(l(!0),b(I,null,M(s.value,(o,y)=>(l(),b(I,null,[(l(!0),b(I,null,M(o,(t,i)=>(l(),b(I,null,[typeof t=="string"&&u.value[`${t}-${i}`]!==!0?(l(),x(W,{key:`${t}-${i}-default`,panelId:t,class:_(["appbar-item h-48",`identifier-${t}-${i}`])},null,8,["panelId","class"])):u.value[`${t.id}-${i}`]!==!0?(l(),x(Y(t.componentId),{key:`${t.id}-${i}-custom`,options:t.options,class:_(["appbar-item h-48",`identifier-${t.id}-${i}`]),buttonId:t.id},null,8,["options","buttonId","class"])):L("",!0)],64))),256)),u.value[`divider-${y}`]!==!0?(l(),x(ee,{class:_(["appbar-item",`identifier-divider-${y}`]),key:`${o}-${y}-default`},null,8,["class"])):L("",!0)],64))),256)),(l(!0),b(I,null,M(e.value?.filter(o=>u.value[`${o}-temp`]!==!0),o=>(l(),x(W,{panelId:o,minimize:!0,key:`${o}-temp`,class:_([`identifier-${o}-temp`,"appbar-item h-48"])},null,8,["panelId","class"]))),128)),H(V($e,{id:"more",numItems:n.value,renderWatch:c.value,onUpdateParent:z},{default:U(()=>[(l(!0),b(I,null,M(s.value,(o,y)=>(l(),b(I,{key:y},[(l(!0),b(I,null,M(o,(t,i)=>(l(),b(I,null,[typeof t=="string"&&u.value[`${t}-${i}`]?(l(),x(W,{key:`${t}-${i}-default`,panelId:t,class:_(["text-black hover:bg-gray my-4 h-36",`identifier-${t}-${i}`]),overflow:""},null,8,["panelId","class"])):u.value[`${t.id}-${i}`]?(l(),x(Y(t.componentId),{key:`${t.id}-${i}-custom`,options:t.options,buttonId:t.id,class:_(["appbar-item h-48",`identifier-${t.id}-${i}`])},null,8,["options","buttonId","class"])):L("",!0)],64))),256)),u.value[`divider-${y}`]?(l(),x(ee,{key:0,class:_(["border-black my-4",`identifier-divider-${y}`])},null,8,["class"])):L("",!0)],64))),128)),(l(!0),b(I,null,M(e.value?.filter(o=>u.value[`${o}-temp`]),o=>(l(),x(W,{panelId:o,minimize:!0,key:`${o}-temp`,class:_([`identifier-${o}-temp`,"text-black hover:bg-gray my-4 h-36"]),overflow:""},null,8,["panelId","class"]))),128))]),_:1},8,["numItems","renderWatch"]),[[K,p.value]]),V(ke,{class:"appbar-item bottom-48 h-48 sm:display-none"}),V(ue,{class:"absolute bottom-0 h-40 sm:display-none w-full text-center",position:"right-start"})],8,Ie)),[[g],[m,{trigger:"manual",touch:!1,placement:"top-end",popperOptions:{placement:"top",modifiers:[{name:"preventOverflow",options:{altAxis:!0}},{name:"flip",options:{fallbackPlacements:["top"]}}]}}]])}}});class Ee extends de{get config(){return super.config}_parseConfig(a){if(!a)return;const r=j(this.$vApp.$pinia);let n;Array.isArray(a.items[0])?n=a.items:n=[a.items];const c=[];n.forEach(s=>{c.push(s.map(e=>typeof e=="string"?e:new X(e)))}),r.items=c.flat().reduce((s,e)=>(s[e instanceof X?e.id:e]=e,s),{}),r.order=c.map(s=>s.map(e=>e instanceof X?e.id:e)),this._validateItems()}_validateItems(){const a=j(this.$vApp.$pinia);a.order.flat().forEach(r=>{typeof a.items[r]!="string"&&[r].some(n=>{this.$iApi.fixture.exists(n)&&!a.items[r]&&(a.items[r].componentId=`${n}-appbar-button`)})})}}const ze={en:{"appbar.navigation":"Navigation","appbar.more":"More","navigation.export":"Export","navigation.map.export":"Export Map"},fr:{"appbar.navigation":"Navigation","appbar.more":"Plus","navigation.export":"Exporter","navigation.map.export":"Exporter la Carte"}};class Ce extends Ee{initialized(){}async added(){Object.entries(ze).forEach(e=>this.$iApi.$i18n.mergeLocaleMessage(...e));const{destroy:a,el:r}=this.mount(_e,{app:this.$element}),n=this.$vApp.$el.getElementsByClassName("inner-shell")[0];n.insertBefore(r.childNodes[0],n.querySelector(".panel-stack")),this._parseConfig(this.config);const c=this.$vApp.$watch(()=>this.config,e=>this._parseConfig(e)),s=[];s.push(this.$iApi.event.on(ce.COMPONENT,()=>{this._parseConfig(this.config)})),this.removed=()=>{const e=j(this.$vApp.$pinia);c(),s.forEach(u=>this.$iApi.event.off(u));const $={...e.items},p=[...e.temporary];Object.keys($).forEach(u=>e.removeButton(u)),p.forEach(u=>e.removeButton(u)),a(),e.$reset()}}}export{Ce as default};
