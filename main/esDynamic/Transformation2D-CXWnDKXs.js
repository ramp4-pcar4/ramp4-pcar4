import{O as H,n as m,m as P,P as j,H as k,s as W,M as O,D as B,b as G}from"./Point2D-CaHJVGk1.js";class A{constructor(t,s,o){if(t instanceof A)return this.data=t.data,this.N=t.N,this.M=t.M,t.data=null,t.N=0,void(t.M=0);this.data=t,this.N=s,this.M=o}assignCopy(t){return this===t||(m(this.N*this.M===t.N*t.M),this.data.set(t.data),this.N=t.N,this.M=t.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let t=0;t<this.N;t++)for(let s=0;s<this.M;s++)this.setRowCol(t,s,t===s?1:0);return this}rows(){return this.N}cols(){return this.M}row(t){return m(0),{}}set(t,s){return this.data[t]=s,this}setRowCol(t,s,o){return this.data[t*this.M+s]=o,this}at(t){return this.data[t]}atRowCol(t,s){return this.data[t*this.M+s]}mulScalar(t,s){m(0)}mul(t,s){if(m(this.M===t.rows()),m(this.N===s.rows()),m(t.cols()===s.cols()),s===this){const i=new Float64Array(this.N*this.M),e=new A(i,this.N,this.M);return this.mul(t,e),void s.assignCopy(e)}if(s===t){const i=new Float64Array(t.N*t.M),e=new A(i,t.N,t.M);return this.mul(t,e),void s.assignCopy(e)}const o=t.cols();for(let i=0;i<this.N;i++)for(let e=0;e<o;e++){let a=0;for(let l=0;l<this.M;l++)a+=this.atRowCol(i,l)*t.atRowCol(l,e);s.setRowCol(i,e,a)}}mulTranspose(t,s){if(m(this.M===t.cols()),m(this.N===s.rows()),m(t.rows()===s.cols()),s===this){const i=new Float64Array(this.N*this.M),e=new A(i,this.N,this.M);return this.mulTranspose(t,e),void s.assignCopy(e)}if(s===t){const i=new Float64Array(t.N*t.M),e=new A(i,t.N,t.M);return this.mulTranspose(t,e),void s.assignCopy(e)}const o=t.rows();for(let i=0;i<this.N;i++)for(let e=0;e<o;e++){let a=0;for(let l=0;l<this.M;l++)a+=this.atRowCol(i,l)*t.atRowCol(e,l);s.setRowCol(i,e,a)}}mulLeft(t,s){m(0)}mulLeftTranspose(t,s){m(0)}mulDiag(t,s){if(m(this.M===t.N*t.M),m(this.N===s.rows()),m(this.M===s.cols()),s===this){const i=new Float64Array(this.N*this.M),e=new A(i,this.N,this.M);return this.mulDiag(t,e),void s.assignCopy(e)}const o=this.M;for(let i=0;i<this.N;i++)for(let e=0;e<o;e++)s.setRowCol(i,e,this.atRowCol(i,e)*t.at(e))}transposeInPlace(){if(this.N===this.M){for(let o=0;o<this.N;o++)for(let i=o+1;i<this.M;i++){const e=this.atRowCol(o,i);this.setRowCol(o,i,this.atRowCol(i,o)),this.setRowCol(i,o,e)}return this}const t=new Float64Array(this.N*this.M),s=new A(t,this.N,this.M);return s.assignCopy(this),this.M=G(this.N,this.N=this.M),s.transpose(this),this}transpose(t){if(this!==t){A.checkDims(t,this.M,this.N);for(let s=0;s<this.N;s++)for(let o=0;o<this.M;o++)t.setRowCol(o,s,this.atRowCol(s,o))}else t.transposeInPlace()}add(t,s){}svd(t,s,o,i=!1){if(A.checkDims(t,this.N,this.M),A.checkDims(s,this.M,1),A.checkDims(o,this.M,this.M),i){if(m(this.N===this.M),!this.symmetricEigen(s,o))return!1;for(let h=0;h<this.M;++h)s.at(h)<0&&s.set(h,0);return t.assignCopy(o),!0}let e,a,l,n,f,M,w,x=0,b=0,c=0,u=0,d=0;const C=this.M,N=this.N;t.assignCopy(this);const g=new Float64Array(C),D=new A(g,C,1),S=(h,R)=>R>=0?Math.abs(h):-Math.abs(h),q=(h,R)=>{if((h=Math.abs(h))>(R=Math.abs(R))){const r=R/h;return h*Math.sqrt(r*r+1)}if(R>0){const r=h/R;return R*Math.sqrt(r*r+1)}return 0};for(let h=0;h<C;h++){if(x=h+1,D.set(h,u*c),c=n=u=0,h<N){for(let r=h;r<N;r++)u+=Math.abs(t.atRowCol(r,h));if(u){for(let r=h;r<N;r++)t.setRowCol(r,h,t.atRowCol(r,h)/u),n+=t.atRowCol(r,h)*t.atRowCol(r,h);a=t.atRowCol(h,h),c=-S(Math.sqrt(n),a),l=a*c-n,t.setRowCol(h,h,a-c);for(let r=x;r<C;r++){n=0;for(let y=h;y<N;y++)n+=t.atRowCol(y,h)*t.atRowCol(y,r);a=n/l;for(let y=h;y<N;y++)t.setRowCol(y,r,t.atRowCol(y,r)+a*t.atRowCol(y,h))}for(let r=h;r<N;r++)t.setRowCol(r,h,t.atRowCol(r,h)*u)}}if(s.set(h,u*c),c=n=u=0,h<N&&h!==C-1){for(let r=x;r<C;r++)u+=Math.abs(t.atRowCol(h,r));if(u){for(let r=x;r<C;r++)t.setRowCol(h,r,t.atRowCol(h,r)/u),n+=t.atRowCol(h,r)*t.atRowCol(h,r);a=t.atRowCol(h,x),c=-S(Math.sqrt(n),a),l=a*c-n,t.setRowCol(h,x,a-c);for(let r=x;r<C;r++)D.set(r,t.atRowCol(h,r)/l);for(let r=x;r<N;r++){n=0;for(let y=x;y<C;y++)n+=t.atRowCol(r,y)*t.atRowCol(h,y);for(let y=x;y<C;y++)t.setRowCol(r,y,t.atRowCol(r,y)+n*D.at(y))}for(let r=x;r<C;r++)t.setRowCol(h,r,t.atRowCol(h,r)*u)}}const R=Math.abs(s.at(h))+Math.abs(D.at(h));d=R>d?R:d}for(let h=C-1;h>=0;h--){if(h<C-1){if(c){for(let R=x;R<C;R++)o.setRowCol(R,h,t.atRowCol(h,R)/t.atRowCol(h,x)/c);for(let R=x;R<C;R++){n=0;for(let r=x;r<C;r++)n+=t.atRowCol(h,r)*o.atRowCol(r,R);for(let r=x;r<C;r++)o.setRowCol(r,R,o.atRowCol(r,R)+n*o.atRowCol(r,h))}}for(let R=x;R<C;R++)o.setRowCol(h,R,0),o.setRowCol(R,h,0)}o.setRowCol(h,h,1),c=D.at(h),x=h}for(let h=(N<C?N:C)-1;h>=0;h--){x=h+1,c=s.at(h);for(let R=x;R<C;R++)t.setRowCol(h,R,0);if(c){c=1/c;for(let R=x;R<C;R++){n=0;for(let r=x;r<N;r++)n+=t.atRowCol(r,h)*t.atRowCol(r,R);a=n/t.atRowCol(h,h)*c;for(let r=h;r<N;r++)t.setRowCol(r,R,t.atRowCol(r,R)+a*t.atRowCol(r,h))}for(let R=h;R<N;R++)t.setRowCol(R,h,t.atRowCol(R,h)*c)}else for(let R=h;R<N;R++)t.setRowCol(R,h,0);t.setRowCol(h,h,t.atRowCol(h,h)+1)}for(let h=C-1;h>=0;h--)for(let R=1;;R++){let r=1;for(x=h;x>=0;x--){if(b=x-1,Math.abs(D.at(x))+d===d){r=0;break}if(Math.abs(s.at(b))+d===d)break}if(r){e=0,n=1;for(let y=x;y<=h&&(a=n*D.at(y),D.set(y,D.at(y)*e),Math.abs(a)+d!==d);y++){c=s.at(y),l=q(a,c),s.set(y,l),l=1/l,e=c*l,n=-a*l;for(let v=0;v<N;v++)M=t.atRowCol(v,b),w=t.atRowCol(v,y),t.setRowCol(v,b,M*e+w*n),t.setRowCol(v,y,w*e-M*n)}}if(w=s.at(h),x===h){if(w<0){s.set(h,-w);for(let y=0;y<C;y++)o.setRowCol(y,h,-o.atRowCol(y,h))}break}if(R===100)return!1;f=s.at(x),b=h-1,M=s.at(b),c=D.at(b),l=D.at(h),a=((M-w)*(M+w)+(c-l)*(c+l))/(2*l*M),c=q(a,1),a=((f-w)*(f+w)+l*(M/(a+S(c,a))-l))/f,e=n=1;for(let y=x;y<=b;y++){const v=y+1;c=D.at(v),M=s.at(v),l=n*c,c*=e,w=q(a,l),D.set(y,w),e=a/w,n=l/w,a=f*e+c*n,c=c*e-f*n,l=M*n,M*=e;for(let T=0;T<C;T++)f=o.atRowCol(T,y),w=o.atRowCol(T,v),o.setRowCol(T,y,f*e+w*n),o.setRowCol(T,v,w*e-f*n);w=q(a,l),s.set(y,w),w&&(w=1/w,e=a*w,n=l*w),a=e*c+n*M,f=e*M-n*c;for(let T=0;T<N;T++)M=t.atRowCol(T,y),w=t.atRowCol(T,v),t.setRowCol(T,y,M*e+w*n),t.setRowCol(T,v,w*e-M*n)}D.set(x,0),D.set(h,a),s.set(h,f)}const p=new Float64Array(this.N),L=new Float64Array(this.M),X=new A(p,this.N,1),Y=new A(L,this.M,1);let F=1;do F*=3,F++;while(F<=this.M);do{F/=3,F=Math.trunc(F);for(let h=F;h<this.M;h++){const R=s.at(h);for(let y=0;y<this.N;y++)X.set(y,t.atRowCol(y,h));for(let y=0;y<this.M;y++)Y.set(y,o.atRowCol(y,h));let r=h;for(;s.at(r-F)<R;){s.set(r,s.at(r-F));for(let y=0;y<this.N;y++)t.setRowCol(y,r,t.atRowCol(y,r-F));for(let y=0;y<this.M;y++)o.setRowCol(y,r,o.atRowCol(y,r-F));if(r-=F,r<F)break}s.set(r,R);for(let y=0;y<this.N;y++)t.setRowCol(y,r,X.at(y));for(let y=0;y<this.M;y++)o.setRowCol(y,r,Y.at(y))}}while(F>1);for(let h=0;h<this.M;h++){let R=0;for(let r=0;r<this.N;r++)t.atRowCol(r,h)<0&&R++;for(let r=0;r<this.M;r++)o.atRowCol(r,h)<0&&R++;if(R>Math.trunc((this.N+this.M)/2)){for(let r=0;r<this.N;r++)t.setRowCol(r,h,-t.atRowCol(r,h));for(let r=0;r<this.M;r++)o.setRowCol(r,h,-o.atRowCol(r,h))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let t=0;t<this.N;t++)for(let s=t+1;s<this.M;s++)if(this.atRowCol(t,s)!==this.atRowCol(s,t))return!1;return!0}isZero(){return m(0),!1}isIdentity(){return m(0),!1}equals(t,s){if(s!==void 0&&m(0),this.N!==t.N||this.M!==t.M)return!1;for(let o=0;o<this.N*this.M;o++)if(this.data[o]!==t.data[o])return!1;return!0}maxElement(){return m(0),0}minElement(){return m(0),0}determinant(){if(m(this.N===this.M),this.N===1)return this.data[0];if(this.N===2)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(this.N===3){const e=this;return e.atRowCol(0,0)*(e.atRowCol(1,1)*e.atRowCol(2,2)-e.atRowCol(1,2)*e.atRowCol(2,1))-e.atRowCol(0,1)*(e.atRowCol(1,0)*e.atRowCol(2,2)-e.atRowCol(2,0)*e.atRowCol(1,2))+e.atRowCol(0,2)*(e.atRowCol(1,0)*e.atRowCol(2,1)-e.atRowCol(1,1)*e.atRowCol(2,0))}const t=new Float64Array(this.N*this.N),s=new A(t,this.N,this.N),o=new Float64Array(this.N);if(!this.luDecomposition(s,o))return 0;let i=1;for(let e=0;e<this.N;e++)i*=s.atRowCol(e,e),o[e]!==e&&(i=-i);return i}submatrix(t,s,o){m(0)}inverse(t){m(0)}pseudoInverse(t,s=!1,o=2220446049250313e-31){if(t.setZero(),this.N===1&&this.M===1)return this.atRowCol(0,0)!==0?t.setRowCol(0,0,1/this.atRowCol(0,0)):t.setRowCol(0,0,0),!0;if(this.N===2&&this.M===2){const x=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),b=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(x)>b)return t.setRowCol(0,0,this.atRowCol(1,1)/x),t.setRowCol(0,1,-this.atRowCol(0,1)/x),t.setRowCol(1,0,-this.atRowCol(1,0)/x),t.setRowCol(1,1,this.atRowCol(0,0)/x),!0}const i=new Float64Array(this.N*this.M),e=new A(i,this.N,this.M),a=new Float64Array(this.M),l=new A(a,this.M,1),n=new Float64Array(this.M*this.M),f=new A(n,this.M,this.M);if(!this.svd(e,l,f,s))return!1;const M=Math.max(this.N,this.M),w=o*Math.abs(l.at(0))*M;for(let x=0;x<this.M;x++)l.at(x)>w?l.set(x,1/l.at(x)):l.set(x,0);return f.mulDiag(l,t),t.mulTranspose(e,t),!0}luDecomposition(t,s){return m(0),!1}symmetricEigen(t,s){m(this.rows()===this.cols()),m(this.rows()===t.rows()),m(s.rows()===s.cols()&&s.rows()===this.rows()),m(this.isSymmetric());const o=new Float64Array(this.N*this.M),i=new A(o,this.N,this.M);i.assignCopy(this);const e=100/Number.EPSILON,a=this.rows(),l=new Float64Array(a),n=new Float64Array(a),f=new A(l,a,1),M=new A(n,a,1);for(let x=0;x<a;x++)f.set(x,i.atRowCol(x,x)),t.set(x,i.atRowCol(x,x)),M.set(x,0);s.setIdentity();const w=()=>{const x=f;s.transposeInPlace();let b=1;do b*=3,b++;while(b<=a);do{b/=3,b=Math.trunc(b);for(let c=b;c<a;c++){const u=t.at(c),d=Math.abs(u);for(let N=0;N<this.M;N++)x.set(N,s.atRowCol(N,c));let C=c;for(;Math.abs(t.at(C-b))<d;){t.set(C,t.at(C-b));for(let N=0;N<this.M;N++)s.setRowCol(N,C,s.atRowCol(N,C-b));if(C-=b,C<b)break}if(C!==c){t.set(C,u);for(let N=0;N<this.M;N++)s.setRowCol(N,C,x.at(N))}}}while(b>1)};for(let x=1;;x++){let b=0;for(let u=1;u<a;u++)for(let d=0;d<u;d++)b+=Math.abs(i.atRowCol(u,d));if(b===0)return w(),!0;const c=x<4?.2*b/(a*a):0;for(let u=0;u<a;u++)for(let d=u+1;d<a;d++){let C=e*Math.abs(i.atRowCol(d,u));if(x>4&&C<=Math.abs(t.at(u))&&C<=Math.abs(t.at(d)))i.setRowCol(d,u,0);else if(Math.abs(i.atRowCol(d,u))>c){let N,g=t.at(d)-t.at(u);if(C<Math.abs(g))N=i.atRowCol(d,u)/g;else{const L=.5*g/i.atRowCol(d,u);N=1/(Math.abs(L)+Math.sqrt(1+L*L)),L<0&&(N=-N)}const D=1/Math.sqrt(1+N*N),S=N*D,q=S/(1+D);g=N*i.atRowCol(d,u),M.set(u,M.at(u)-g),M.set(d,M.at(d)+g),t.set(u,t.at(u)-g),t.set(d,t.at(d)+g),i.setRowCol(d,u,0);let p=0;for(;p<u;p++)C=i.atRowCol(u,p),g=i.atRowCol(d,p),i.setRowCol(u,p,C-S*(g+C*q)),i.setRowCol(d,p,g+S*(C-g*q));for(p++;p<d;p++)C=i.atRowCol(p,u),g=i.atRowCol(d,p),i.setRowCol(p,u,C-S*(g+C*q)),i.setRowCol(d,p,g+S*(C-g*q));for(p++;p<a;p++)C=i.atRowCol(p,u),g=i.atRowCol(p,d),i.setRowCol(p,u,C-S*(g+C*q)),i.setRowCol(p,d,g+S*(C-g*q));for(p=0;p<a;p++)C=s.atRowCol(u,p),g=s.atRowCol(d,p),s.setRowCol(u,p,C-S*(g+C*q)),s.setRowCol(d,p,g+S*(C-g*q))}}for(let u=0;u<a;u++)f.set(u,f.at(u)+M.at(u)),t.set(u,f.at(u)),M.set(u,0)}}static checkDims(t,s,o){m(t.rows()===s&&t.cols()===o)}}class z extends A{constructor(t){if(t.copy){const o=new Float64Array(t.copy.N*t.copy.M);return super(o,t.copy.N,t.copy.M),this.buffer=o,void this.assignCopy(t.copy)}const s=new Float64Array(t.NN*t.MM);super(s,t.NN,t.MM),this.buffer=s,t.initializerList&&B(this.buffer,t.initializerList,0,0,t.initializerList.length)}assignCopy(t){return this===t||super.assignCopy(t),this}}class E{constructor(t){this.m_TransformationType=1,t===void 0?this.setIdentity():t instanceof E?this.set(t):this.setScale(t)}set(t){return this.xx=t.xx,this.xy=t.xy,this.xd=t.xd,this.yx=t.yx,this.yy=t.yy,this.yd=t.yd,this}clone(){return new E().set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(t){return this===t||this.xx===t.xx&&this.xy===t.xy&&this.xd===t.xd&&this.yx===t.yx&&this.yy===t.yy&&this.yd===t.yd}transformInPlace(t){const s=this.xx*t.x+this.xy*t.y+this.xd,o=this.yx*t.x+this.yy*t.y+this.yd;t.x=s,t.y=o}transform(t){const s=t.clone();return this.transformInPlace(s),s}queryTransform(t,s){const o=this.xx*t.x+this.xy*t.y+this.xd,i=this.yx*t.x+this.yy*t.y+this.yd;s.setCoords(o,i)}transformEnvInPlace(t){if(t.isEmpty())return;const s=H(P,4);t.queryCorners(s),this.transformPoints2D(s,4,s),t.setFromPoints(s,4)}queryTransformEnv(t,s){m(0)}transformPoints2D(t,s,o){for(let i=0;i<s;++i)this.queryTransform(t[i],o[i])}transformInterleavedPoints(t,s,o){s*=2;const i=P.getNAN();for(let e=0;e<s;e+=2)i.x=t[e],i.y=t[e+1],this.transformInPlace(i),o[e]=i.x,o[e+1]=i.y}multiply(t){return E.st_multiply(this,t,this),this}mulLeft(t){return m(0),this}static st_multiply(t,s,o){const i=t.xx*s.xx+t.yx*s.xy,e=t.xy*s.xx+t.yy*s.xy,a=t.xd*s.xx+t.yd*s.xy+s.xd,l=t.xx*s.yx+t.yx*s.yy,n=t.xy*s.yx+t.yy*s.yy,f=t.xd*s.yx+t.yd*s.yy+s.yd;o.xx=i,o.xy=e,o.xd=a,o.yx=l,o.yy=n,o.yd=f}getCoefficients(t){m(t.length>=6),t[0]=this.xx,t[1]=this.xy,t[2]=this.xd,t[3]=this.yx,t[4]=this.yy,t[5]=this.yd}setCoefficients(t){m(t.length>=6),this.xx=t[0],this.xy=t[1],this.xd=t[2],this.yx=t[3],this.yy=t[4],this.yd=t[5]}copyTo(t){m(0)}initializeFromRect(t,s){t.isEmpty()||s.isEmpty()||!t.width()||!t.height()?this.setZero():(this.xy=this.yx=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xd=s.xmin-t.xmin*this.xx,this.yd=s.ymin-t.ymin*this.yy)}initializeFromRectIsotropic(t,s){if(t.isEmpty()||!t.width()||!t.height()||s.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;const o=s.getCenter(),i=t.getCenter();this.xd=o.x-i.x*this.xx,this.yd=o.y-i.y*this.yy}}initializeFromTwoPointsArray(t,s){if(t[0].equals(s[0])&&t[1].equals(s[1]))return void this.setIdentity();if(t[0].equals(t[1])){if(s[0].equals(s[1]))return void this.setShift(s[0].sub(t[0]));j("")}if(!t[0].equals(t[1])&&s[0].equals(s[1]))return this.setZero(),void this.shift(s[0]);this.setShiftCoords(-t[0].x,-t[0].y);const o=P.distance(t[0],t[1]),i=P.distance(s[0],s[1]),e=i/o;this.scale(e,e);const a=t[1].sub(t[0]);a.divThis(o);const l=s[1].sub(s[0]);l.divThis(i);const n=a.crossProduct(l),f=a.dotProduct(l);this.rotate(f,n),this.shiftCoords(s[0].x,s[0].y)}initializeFromTwoPoints(t,s,o,i){const e=[t,s],a=[o,i];this.initializeFromTwoPointsArray(e,a)}transformSizeInPlace(t){m(0)}transformSize(t,s){m(0)}transformTol(t){return m(0),0}transformWithoutTranslateArray(t,s,o){for(let i=0;i<s;++i)this.transformWithoutTranslate(t[i],o[i])}transformWithoutTranslateInPlace(t){const s=this.xx*t.x+this.xy*t.y,o=this.yx*t.x+this.yy*t.y;t.setCoords(s,o)}transformWithoutTranslate(t,s){const o=this.xx*t.x+this.xy*t.y,i=this.yx*t.x+this.yy*t.y;s.setCoords(o,i)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(this.xx!==1||this.yy!==1||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(t){const s=t*t;return!(k(this.xd)+k(this.yd)>s)&&!(k(this.xy+this.xd)+k(this.yy+this.yd-1)>s)&&!(k(this.xx+this.xd-1)+k(this.yx+this.yd)>s)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(t){const s=this.xx*this.xx+this.yx*this.yx,o=this.xy*this.xy+this.yy*this.yy,i=(s+o)*t;return Math.abs(s-o)<=i&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=i}isUniformNoRotation(){return this.xx!==0&&Math.abs(this.xx)===Math.abs(this.yy)&&this.xy===0&&this.yx===0}isTranslate(){return this.xx===1&&this.yy===1&&!this.xy&&!this.yx}isTranslateTol(t){const s=new P;return s.setCoords(0,1),this.transformWithoutTranslateInPlace(s),s.y-=1,!(s.sqrLength()>t*t)&&(s.setCoords(1,0),this.transformWithoutTranslateInPlace(s),s.x-=1,s.sqrLength()<=t*t)}isOrthonormal(t){const s=new E;return s.xx=this.xx*this.xx+this.xy*this.xy,s.xy=this.xx*this.yx+this.xy*this.yy,s.yx=this.yx*this.xx+this.yy*this.xy,s.yy=this.yx*this.yx+this.yy*this.yy,s.xd=0,s.yd=0,s.isIdentityTol(t)}isDegenerate(t){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*t*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return this.xx===0&&this.yy===0&&this.xy===0&&this.yx===0&&this.xd===0&&this.yd===0}isScaleAndTranslateTol(t){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*t}setTranslate(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShiftCoords(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShift(t){return this.xx=1,this.xy=0,this.xd=t.x,this.yx=0,this.yy=1,this.yd=t.y,this}setScaleCoords(t,s){return this.xx=t,this.xy=0,this.xd=0,this.yx=0,this.yy=s,this.yd=0,this}setScale(t){return this.setScaleCoords(t,t),this}setFlipX(t,s){return this.xx=-1,this.xy=0,this.xd=t+s,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(t,s){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=t+s,this}setShear(t,s){return this.xx=1,this.xy=t,this.xd=0,this.yx=s,this.yy=1,this.yd=0,this}scale(t,s){return this.xx*=t,this.xy*=t,this.xd*=t,this.yx*=s,this.yy*=s,this.yd*=s,this}setRotateAngle(t){return this.setRotate(Math.cos(t),Math.sin(t))}setRotate(t,s){return this.xx=t,this.xy=-s,this.xd=0,this.yx=s,this.yy=t,this.yd=0,this}setRotateAngleAbout(t,s){return this.setRotateAbout(Math.cos(t),Math.sin(t),s)}setRotateAbout(t,s,o){return this.setTranslate(-o.x,-o.y),this.rotate(t,s),this.translate(o.x,o.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(t,s){return this.xd+=t,this.yd+=s,this}shift(t){return this.xd+=t.x,this.yd+=t.y,this}translate(t,s){return this.xd+=t,this.yd+=s,this}flipX(t,s){return this.xx=-this.xx,this.xy=-this.xy,this.xd=t+s-this.xd,this}flipY(t,s){return this.yx=-this.yx,this.yy=-this.yy,this.yd=t+s-this.yd,this}shear(t,s){const o=new E;return o.setShear(t,s),this.multiply(o)}rotateAngle(t){const s=new E;return s.setRotateAngle(t),this.multiply(s)}rotate(t,s){const o=new E;return o.setRotate(t,s),this.multiply(o)}rotateAbout(t,s,o){return this.translate(-o.x,-o.y),this.rotate(t,s),this.translate(o.x,o.y)}rotateAngleAbout(t,s){return this.rotateAbout(Math.cos(t),Math.sin(t),s)}setInvert(t){return this.set(t),this.invertThis()}invertThis(){let t=this.xx*this.yy-this.xy*this.yx;if(t===0)return this.setZero(),this;t=1/t;const s=(this.xy*this.yd-this.xd*this.yy)*t,o=(this.xd*this.yx-this.xx*this.yd)*t,i=this.yy*t,e=-this.xy*t,a=-this.yx*t,l=this.xx*t;return this.xd=s,this.yd=o,this.xx=i,this.yy=l,this.xy=e,this.yx=a,this}invertPrecise(t){return this.set(t),this.invertPreciseThis()}invertPreciseThis(){const t=W.constructDouble(this.xy),s=W.constructDouble(this.xx),o=s.mulDouble(this.yy).sub(t.mulDouble(this.yx));if(o.isZero())return this.setZero(),this;const i=o.clone();i.invertThis();const e=W.constructDouble(this.xd),a=t.mulDouble(this.yd).sub(e.mulDouble(this.yy)).mul(i).toDouble(),l=e.mulDouble(this.yx).sub(s.mulDouble(this.yd)).mul(i).toDouble(),n=i.mulDouble(this.yy).toDouble(),f=i.mulDouble(-this.xy).toDouble(),M=i.mulDouble(-this.yx).toDouble(),w=i.mulDouble(this.xx).toDouble();return this.xd=a,this.yd=l,this.xx=n,this.yy=w,this.xy=f,this.yx=M,this}extractScaleTransform(t,s){const o=Math.sqrt(this.xx*this.xx+this.xy*this.xy),i=Math.sqrt(this.yx*this.yx+this.yy*this.yy);s.setScaleCoords(1/o,1/i),s.multiply(this),t.setScaleCoords(o,i)}setFromTwoTriangles(t,s){let o=!0;for(let M=0;M<3;++M)o=o&&t[M].equals(s[M]);if(o)return this.setIdentity(),!0;const i=new P;i.setSub(t[0],t[1]);const e=new P;e.setSub(t[0],t[2]);const a=new P;a.setSub(s[0],s[1]);const l=new P;l.setSub(s[0],s[2]);const n=4*Number.EPSILON*(Math.abs(i.x*e.y)+Math.abs(e.x*i.y));let f=i.x*e.y-i.y*e.x;return Math.abs(f)>n?(f=1/f,this.xx=(a.x*e.y-i.y*l.x)*f,this.xy=(i.x*l.x-a.x*e.x)*f,this.yx=(a.y*e.y-i.y*l.y)*f,this.yy=(i.x*l.y-a.y*e.x)*f,this.xd=s[0].x-(this.xx*t[0].x+this.xy*t[0].y),this.yd=s[0].y-(this.yx*t[0].x+this.yy*t[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(t,s,o,i,e=null){return s===0?(this.setIdentity(),void(e&&e.setIdentity())):s===1?(this.setShift(i[0].sub(o[0])),void(e&&e.setShift(o[0].sub(i[0])))):(s<3&&(t=1),void(t===4&&s>2?J(this,s,o,i,e):$(t,this,s,o,i,e)))}calculateErrors(t,s,o,i){m(t>0&&s!==null&&o!==null);let e=0;for(let a=0;a<t;++a){const l=this.transform(s[a]),n=P.sqrDistance(o[a],l);e+=n,i&&(i[a]=Math.sqrt(n))}return Math.sqrt(e/t)}}const Z=[43,11,41,9,61];function U(I,t){m(!(t.rows()!==2&&t.rows()!==3||t.cols()!==2&&t.rows()!==3)),I.xx=t.atRowCol(0,0),I.xy=t.atRowCol(0,1),I.yx=t.atRowCol(1,0),I.yy=t.atRowCol(1,1),t.cols()===3?(I.xd=t.atRowCol(0,2),I.yd=t.atRowCol(1,2)):(I.xd=0,I.yd=0)}function J(I,t,s,o,i){const e=P.average(s,t),a=P.average(o,t),l=new z({NN:2,MM:2});l.setZero();const n=new z({NN:2,MM:2});n.setZero();for(let w=0;w<t;++w)l.setRowCol(0,0,l.atRowCol(0,0)+(s[w].x-e.x)*(s[w].x-e.x)),l.setRowCol(0,1,l.atRowCol(0,1)+(s[w].x-e.x)*(s[w].y-e.y)),l.setRowCol(1,1,l.atRowCol(1,1)+(s[w].y-e.y)*(s[w].y-e.y)),n.setRowCol(0,0,n.atRowCol(0,0)+(o[w].x-a.x)*(s[w].x-e.x)),n.setRowCol(0,1,n.atRowCol(0,1)+(o[w].x-a.x)*(s[w].y-e.y)),n.setRowCol(1,0,n.atRowCol(1,0)+(o[w].y-a.y)*(s[w].x-e.x)),n.setRowCol(1,1,n.atRowCol(1,1)+(o[w].y-a.y)*(s[w].y-e.y));l.setRowCol(1,0,l.atRowCol(0,1));const f=new z({NN:2,MM:2});l.pseudoInverse(f,!0)||O("Failed to compute pseudo inverse"),n.mul(f,n),U(I,n);const M=e.clone();I.transformInPlace(M),I.xd=a.x-M.x,I.yd=a.y-M.y,i&&(n.pseudoInverse(f,!1)||O("Failed to compute pseudo inverse"),U(i,f),i.transformInPlace(a),i.xd=e.x-a.x,i.yd=e.y-a.y)}function $(I,t,s,o,i,e){m(I===1||I===0||I===2||I===3),t.setIdentity();const a=P.average(o,s),l=P.average(i,s);if(m(I<Z.length&&I>0),8&Z[I]){const f=new z({NN:2,MM:2});f.setZero();for(let d=0;d<s;++d)f.setRowCol(0,0,f.atRowCol(0,0)+(i[d].x-l.x)*(o[d].x-a.x)),f.setRowCol(1,0,f.atRowCol(1,0)+(i[d].x-l.x)*(o[d].y-a.y)),f.setRowCol(0,1,f.atRowCol(0,1)+(i[d].y-l.y)*(o[d].x-a.x)),f.setRowCol(1,1,f.atRowCol(1,1)+(i[d].y-l.y)*(o[d].y-a.y));const M=new z({NN:2,MM:2}),w=new z({NN:2,MM:1}),x=new z({NN:2,MM:2});f.svd(M,w,x)||O("Failed to compute svd");const b=new z({NN:2,MM:2});M.transpose(b);const c=new z({NN:2,MM:2});x.mul(b,c),!(32&Z[I])&&c.determinant()<0&&(b.setRowCol(1,0,-b.atRowCol(1,0)),b.setRowCol(1,1,-b.atRowCol(1,1)),x.mul(b,c));const u=new E;U(u,c),t.set(u)}if(2&Z[I]){let f=0,M=0;for(let w=0;w<s;++w){const x=o[w].sub(a);f+=x.sqrLength(),t.transformInPlace(x),M+=x.dotProduct(i[w].sub(l))}if(f===0)M===0?t.setIdentity():t.setZero();else{const w=M/f;t.scale(w,w)}}else m(!(4&Z[I]));const n=a.clone();t.transformInPlace(n),t.xd=l.x-n.x,t.yd=l.y-n.y,e&&(e.set(t),e.invertThis(),e.isZero()&&(e.xd=a.x,e.yd=a.y))}export{E as x};
