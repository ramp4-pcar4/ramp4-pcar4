import{M as P,m as E,U as x,Q as $,n as C,q as D,r as M,u as V,v as y,w as L,A as k,B as G}from"./arcade-BNbfPFHY.js";import{F as Z}from"./arcade-BNbfPFHY.js";import{m as u,i as J,r as O}from"./TimeOnly-DMbsPjUX.js";import{r as c}from"./arcadeEnvironment-3XxdG5as.js";import{V as z,A as w,p as f,t as N,l as R,H as U,B as j,X as q}from"./Dictionary-BlU901XL.js";import{D as W,w as B,I as m}from"./Feature-BzmHD5XA.js";import{n as o}from"./enum-BVcvu-V3.js";import{t as _}from"./ImmutableArray-CiJxhY8_.js";import{b_ as b,ba as H,eX as F,i as X,G as Q,eW as K,eU as Y,eT as ee,d$ as te,cl as re,aH as ne,aG as ae,dU as se,ch as ie}from"./main-6gYsRPh_.js";import{n as oe}from"./isImageryGraphicOrigin-n8VFIUI8.js";import{n as le}from"./isImageryTileGraphicOrigin-BighNA3j.js";import{a as ue}from"./rasterFieldUtils-DV3f0n85.js";const ce=()=>X.getLogger("esri.arcade.Pixel");function T(e){return e.rasterFields.filter(r=>r.name.startsWith(ue))}class g{constructor(r,t,n){this._graphic=t,this._timeZone=n,this.arcadeDeclaredClass="esri.arcade.Pixel",this._values=new Map,this._fields=new Map(r.map(i=>[c(i.name),i]))}static fromImageryGraphic(r,t){if(!oe(r.origin)&&!le(r.origin))throw new o(null,"InvalidParameter",null);return new g(T(r.origin.layer),r,t)}static getDeclaredMembers(r){return T(r).map(t=>b(t.name)&&t.type==="string"?{name:t.name,type:"array",elementType:{type:"text"}}:W(t)).filter(t=>t!=null)}keys(){return Array.from(this._fields.values()).map(r=>r.name).sort()}hasField(r){return this._fields.has(c(r))}field(r){const t=this._fields.get(c(r));if(t==null)throw new o(null,"FieldNotFound",null,{key:r});return H(this._values,t.name,()=>{const n=this._graphic.getAttribute(t.name);return n==null?null:b(t.name)&&typeof n=="string"?new _(n.split(/,\s*|\s+/)):F(n)||z(n)?B(n,t.type,this._timeZone??"system"):(ce().warn(`Unsupported type for attribute: ${t.name}. Ignoring value.`),null)})}isEmpty(){return this._fields.size<=0}castToText(r=!1){const t={};for(const n of this._fields.values())t[n.name]=this.field(n.name);return w(t,{useNumbersForDates:r})}}const d="Voxel.Position",p="Voxel.LocalTime";function fe(e){const r=e.getAttribute(d);if(typeof r!="string")throw new o(null,"InvalidParameter",null);const t=JSON.parse(r);if(!Array.isArray(t)||typeof t[0]!="number"||typeof t[1]!="number"||typeof t[2]!="number")throw new o(null,"InvalidParameter",null);return new _(t)}function pe(e,r){const t=e.getAttribute(p);if(t==null)return null;if(!F(t))throw new o(null,"InvalidParameter",null);return u.dateJSAndZoneToArcadeDate(t,r)}class me{constructor(r,t){this._graphic=r,this._timeZone=t,this.arcadeDeclaredClass="esri.arcade.Voxel",this._layer=r.sourceLayer}static getDeclaredMembers(r){return r.fields.map(t=>{switch(t.name){case d:return{name:t.name,type:"array",elementType:{type:"number"}};case p:return{name:t.name,type:"date"};default:switch(t.type){case"string":return{name:t.name,type:"text"};case"double":return{name:t.name,type:"number"}}return null}}).filter(t=>t!=null)}getPosition(){return this._position!==void 0?this._position:this._position=fe(this._graphic)}getLocalTime(){return this._localTime!==void 0?this._localTime:this._localTime=pe(this._graphic,this._timeZone??"system")}keys(){return this._layer.fields.map(r=>r.name).sort()}hasField(r){return this._layer.fieldsIndex.has(r)}field(r){const t=this._layer.fieldsIndex?.get(r)?.name;if(t==null)throw new o(null,"FieldNotFound",null,{key:r});switch(t){case d:return this.getPosition();case p:return this.getLocalTime()}return this._graphic.attributes[t]??null}isEmpty(){return this._layer.fields.length<=0}castToText(r=!1){const t={...this._graphic.attributes};t[d]=this.getPosition(),p in t&&(t[p]=this.getLocalTime());for(const n of Object.keys(t))this._layer.fieldsIndex?.has(n)||delete t[n];return w(t,{useNumbersForDates:r})}}const de={vars:{$feature:"any",$view:"any"}};function ye(e){return e.replaceAll(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function he(e){return e==null?null:K(e)||N(e)?"array":R(e)?"date":Y(e)?"text":ee(e)?"boolean":te(e)?"number":e instanceof f?"dictionary":U(e)?"feature":e instanceof re?"point":e instanceof ne?"polygon":e instanceof ae?"polyline":e instanceof se?"multipoint":e instanceof ie?"extent":e instanceof J?"dateOnly":e instanceof O?"time":j(e)?"featureSet":q(e)?"featureSetCollection":null}function l(e){if(!e)return null;try{return E(e)}catch{}return null}function ge(e,r){const t=typeof e=="string"?l(e):e;if(!t)return null;try{return r=r||Q(de),P(t,r)}catch{}return null}function ve(e,r,t){return{vars:{$feature:e==null?new m:m.createFromGraphic(e,t),$view:r?.view},spatialReference:r?.sr,timeZone:t??null}}function xe(e,r,t){return m.createFromGraphicLikeObject(r,e,t,null)}function we(e,r){e.vars!=null&&(e.vars.$feature=r)}function _e(e,r){let t;try{t=D(e,r)}catch{t=null}return t}function be(e,r){let t;try{t=e?e(r):null}catch{t=null}return t}function Fe(e,r){try{return e?e(r):Promise.resolve(null)}catch{return Promise.resolve(null)}}const Te=["$feature","$aggregatedFeatures","$voxel"].map(e=>c(e));function Se(e,r){if(!e)return[];const t=typeof e=="string"?l(e):e;if(!t)return[];const n=new Map;if(Array.isArray(r)||r==null)for(const a of Te)n.set(a,r);else for(const[a,s]of r)n.set(c(a),s);const i=M(t).flatMap(({varId:a,memberNamePattern:s})=>{if(!n.has(a))return[];if(s.includes("*")){const v=n.get(a);if(v==null)return[];const A=new RegExp(`^${s.split(/\*+/).map(ye).join(".*")}$`,"i");return v.filter(I=>A.test(I))}return s.toLowerCase()});return[...new Set(i.sort())]}function Ae(e){return x(e,"$view")}function Ie(e,r){return!!e&&x(e,r)}function Pe(e){if(!e||e.spatialReference==null&&(e.scale==null||e.viewingMode==null))return;let r,t;const{timeProperties:n,timeZone:i}=e;if(n!=null){const{currentStart:a,currentEnd:s}=n;i!=null?(r=a!=null?u.dateJSAndZoneToArcadeDate(a,i):null,t=s!=null?u.dateJSAndZoneToArcadeDate(s,i):null):(r=a!=null?u.dateJSToArcadeDate(a):null,t=s!=null?u.dateJSToArcadeDate(s):null)}return{view:e.viewingMode&&e.scale!=null?new f({__proto__:null,viewingMode:e.viewingMode,scale:e.scale,timeProperties:r!=null||t!=null?new f({__proto__:null,currentStart:r,currentEnd:t,startIncluded:!0,endIncluded:!0}):null}):null,sr:e.spatialReference}}function Ee({url:e,spatialReference:r,lrucache:t,interceptor:n}){const i=y();return i?i.createFeatureSetCollectionFromService(e,r,t,n):null}function $e({layer:e,spatialReference:r,outFields:t,returnGeometry:n,lrucache:i,interceptor:a}){if(e===null)return null;const s=y();return s?s.constructFeatureSet(e,r,t,n??!0,i,a):null}function Ce(e){if(e?.map===null)return null;const r=y();return r?r.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function De(e,r){return f.convertJsonToArcade(e,r)}function Me(e,r,t=[]){return V(e,r,t)}function Ve(){return C()}function Le(){return $()}function ke(e){return"type"in e&&(e.type==="class-breaks"||e.type==="dictionary"||e.type==="dot-density"||e.type==="pie-chart"||e.type==="simple"||e.type==="unique-value")}function Ge(e){return e.declaredClass==="esri.layers.support.LabelClass"}function Ze(e){return e.declaredClass==="esri.PopupTemplate"}function h(e,r){if(!e)return!1;if(typeof e=="string")return r(e);const t=e;if(ke(t)){if(t.type==="dot-density"){const a=t.attributes?.some(s=>r(s.valueExpression));if(a)return a}const n=t.visualVariables,i=!!n&&n.some(a=>{let s=r(a.valueExpression);return a.type==="size"&&(S(a.minSize)&&(s=s||r(a.minSize.valueExpression)),S(a.maxSize)&&(s=s||r(a.maxSize.valueExpression))),s});return!(!("valueExpression"in t)||!r(t.valueExpression))||i}if(Ge(t)){const n=t.labelExpressionInfo?.expression;return!(!n||!r(n))||!1}return!!Ze(t)&&(!!t.expressionInfos&&t.expressionInfos.some(n=>r(n.expression))||Array.isArray(t.content)&&t.content.some(n=>n.type==="expression"&&r(n.expressionInfo?.expression)))}function Je(e){const r=l(e);return!!r&&k(r)}function Oe(e){return h(e,Je)}function ze(e){const r=l(e);return!!r&&G(r)}function Ne(e){return h(e,ze)}function Re(e){return h(e,r=>{const t=l(r);return!!t&&L(t)})}function S(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}export{f as Dictionary,g as Pixel,me as Voxel,Z as arcade,m as arcadeFeature,$e as convertFeatureLayerToFeatureSet,De as convertJsonToArcade,Ce as convertMapToFeatureSetCollection,Ee as convertServiceUrlToWorkspace,ve as createExecContext,xe as createFeature,ge as createFunction,l as createSyntaxTree,Ae as dependsOnView,Le as enableFeatureSetOperations,Ve as enableGeometryOperations,_e as evalSyntaxTree,Fe as executeAsyncFunction,be as executeFunction,Se as extractFieldNames,he as getArcadeType,Pe as getViewInfo,Oe as hasGeometryFunctions,Ne as hasGeometryOperations,Ie as hasVariable,Me as loadScriptDependencies,Re as requiresTrack,we as updateExecContext};
