{"version":3,"file":"FeatureIdInfo-CK90tRJF.js","sources":["../../node_modules/@arcgis/core/views/2d/layers/features/sources/FeatureSourceQueryInfo.js","../../node_modules/@arcgis/core/layers/graphics/data/FeatureIdInfo.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport has from\"../../../../../core/has.js\";import{sqlAnd as e}from\"../../../../../core/sql.js\";import t from\"../../../../../geometry/SpatialReference.js\";import{getClauseForScaleRange as r}from\"../../../../../layers/support/displayFilterUtils.js\";import a from\"../../../../../rest/support/Query.js\";import i from\"../../../../../time/TimeExtent.js\";const s=4;function o(e){switch(e.type){case\"object-id\":case\"unique-id-simple\":return`${e.fieldName} ASC`;case\"unique-id-composite\":return`${e.fieldNames.join(\",\")} ASC`}}function n(e,r,a){const s=o(a.featureIdInfo);return{returnCentroid:\"esriGeometryPolygon\"===a.serviceGeometryType&&!e.queryMetadata.supportsCentroidOnDegeneratedQuantizedGeometry&&!e.queryMetadata.supportsDegeneratedQuantizedGeometry,returnGeometry:!0,timeReferenceUnknownClient:a.timeReferenceUnknownClient??void 0,outSpatialReference:t.fromJSON(e.outSpatialReference),orderByFields:\"memory\"===e.type?[]:[s],where:r.definitionExpression??\"1=1\",outFields:r.availableFields,multipatchOption:\"esriGeometryMultiPatch\"===a.serviceGeometryType?\"xyFootprint\":null,gdbVersion:r.gdbVersion,historicMoment:r.historicMoment?new Date(r.historicMoment):null,timeExtent:r.timeExtent?i.fromJSON(r.timeExtent):null}}class u{static create(e,t,r){const a=t.queryScaleRanges,i=t.displayFilterInfo;return new u(n(e,t,r),i,a,r.subtypeField,t.customParameters,r.geometryType,e.queryMetadata)}constructor(e,t,r,a,i,s,o){this._queryParams=e,this._displayFilter=t,this._queryScaleRanges=r,this._subtypeField=a,this._customParameters=i,this._geometryType=s,this._queryMetadata=o}get pageSize(){if(null==this._queryMetadata)throw new Error(\"InternalError: Service does not support paged queries\");const e=this._queryMetadata.supportsMaxRecordCountFactor?s:null,t=(this._queryMetadata.maxRecordCount??8e3)*(e??1);return Math.min(8e3,t)}get objectIdsQueryPageSize(){return this._queryMetadata?.maxRecordCount??2e3}updateHistoricMoment(e){this._queryParams.historicMoment=e}updateFields(e){this._queryParams.outFields=e}createPatchFieldsQuery(e,t,r){if(!t.getSize())return null;const a=e.clone();if(\"*\"===this._queryParams.outFields[0]){if(\"*\"===(a.outFields??[])[0])return null;a.outFields=this._queryParams.outFields}else{const e=new Set(this._queryParams.outFields),r=[];for(const a of e)t.hasField(a)||r.push(a);if(0===r.length)return null;a.outFields=r}a.returnGeometry=!1,a.returnCentroid=!1,a.quantizationParameters=null,a.cacheHint=!0;const i={inner:a,customParameters:this._customParameters};if(has(\"esri-tiles-debug\")&&null!=r){const e=r.chunkId.toString().replaceAll(\"/\",\".\");i.customParameters=i.customParameters?{...i.customParameters,chunkId:e}:{chunkId:e}}return i}createQuery(e={}){if(!this._queryParams)throw new Error(\"InternalError: queryInfo should be defined\");return{inner:new a({...this._queryParams,...e}),customParameters:this._customParameters}}createTileQuery(t,a){if(null==this._queryMetadata)throw new Error(\"InternalError: Service does not support tile queries\");const i=this.createQuery(a),o=i.inner;if(this._queryScaleRanges?.length){const r=this._queryScaleRanges.filter(e=>(!e.minScale||e.minScale>=t.maxScale)&&(!e.maxScale||e.maxScale<=t.minScale)).map(e=>e.subtypeCode);if(r.length){const t=`${this._subtypeField} IN (${r})`;o.where=e(o.where,t)}}if(this._displayFilter&&(o.where=e(o.where,r(this._displayFilter,t.minScale,t.maxScale))),o.quantizationParameters=a.quantizationParameters??t.getQuantizationParameters(),o.resultType=\"tile\",o.geometry=t.extent,this._queryMetadata.supportsQuantization?\"esriGeometryPolyline\"===this._geometryType&&(o.maxAllowableOffset=t.resolution*has(\"feature-polyline-generalization-factor\")):\"esriGeometryPolyline\"!==this._geometryType&&\"esriGeometryPolygon\"!==this._geometryType||(o.maxAllowableOffset=t.resolution,\"esriGeometryPolyline\"===this._geometryType&&(o.maxAllowableOffset*=has(\"feature-polyline-generalization-factor\"))),o.defaultSpatialReferenceEnabled=this._queryMetadata.supportsDefaultSpatialReference,o.compactGeometryEnabled=this._queryMetadata.supportsCompactGeometry,this._queryMetadata.supportsMaxRecordCountFactor&&(o.maxRecordCountFactor=s),has(\"esri-tiles-debug\")){const e=t.id.replaceAll(\"/\",\".\");i.customParameters=i.customParameters?{...i.customParameters,tileId:e}:{tileId:e}}return i}createPagedTileQuery(e,t){const r=this.pageSize;return this.createTileQuery(e,{start:r*t,num:r,returnExceededLimitFeatures:!0})}createPagedQuery(e,t){const r=this.pageSize;return this.createQuery({start:r*e,num:r,returnExceededLimitFeatures:!0,maxRecordCountFactor:s,quantizationParameters:t,cacheHint:!0})}createObjectIdsQuery(e){return this.createQuery({objectIds:e,outFields:[\"*\"]})}}export{u as FeatureSourceQueryInfo};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nfunction*e(e){switch(e.type){case\"object-id\":case\"unique-id-simple\":return void(yield e.fieldName);case\"unique-id-composite\":return void(yield*e.fieldNames)}}export{e as getFeatureIdInfoFieldNames};\n"],"names":["s","o","e","n","r","a","t","i","u","has"],"mappings":"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","x_google_ignoreList":[0,1]}