import{af as V,du as N,aT as M,bp as E,bh as c}from"./main-CnDVnExo.js";import{e as R}from"./utils-DkpfPh9p.js";import{n as B,v as Q}from"./jsxFactory-EHFHGYYs.js";import{r as F}from"./TimeExtent-CrpfETyH.js";import{o as T}from"./intl-BxRKe_z1.js";import{N as O,$ as q}from"./utils-V1W04L0w.js";import{c as k}from"./typeUtils-kZYFTRE_.js";function S({level:n,class:e,...o},l){const t=w(n);return B(`h${t}`,{...o,"aria-level":String(t),class:Q(R.heading,e),role:"heading"},l)}function w(n){return V(Math.ceil(n),1,6)}function j(n,e=1){return w(n+e)}const K=/^-?(\d+)(\.(\d+))?$/i;function L(n,e){return n-e}function W(n,e){let o,l;return o=Number(n.toFixed(e)),o<n?l=o+1/10**e:(l=o,o-=1/10**e),o=Number(o.toFixed(e)),l=Number(l.toFixed(e)),[o,l]}function G(n,e,o,l,t){const r=b(n,e,o,l),i=r.previous==null||r.previous<=t,a=r.next==null||r.next<=t;return i&&a||r.previous+r.next<=2*t}function h(n){const e=String(n),o=e.match(K);if(o?.[1])return{integer:o[1].split("").length,fractional:o[3]?o[3].split("").length:0};if(e.toLowerCase().includes("e")){const l=e.split("e"),t=l[0],r=l[1];if(t&&r){const i=Number(t);let a=Number(r);const u=a>0;u||(a=Math.abs(a));const s=h(i);return u?(s.integer+=a,a>s.fractional?s.fractional=0:s.fractional-=a):(s.fractional+=a,a>s.integer?s.integer=1:s.integer-=a),s}}return{integer:0,fractional:0}}function b(n,e,o,l){const t={previous:null,next:null};if(o!=null){const r=n-o,i=e-o-r;t.previous=Math.floor(Math.abs(100*i/r))}if(l!=null){const r=l-n,i=l-e-r;t.next=Math.floor(Math.abs(100*i/r))}return t}function D(n,e={}){const o=n.slice(),{tolerance:l=2,strictBounds:t=!1,indexes:r=o.map((i,a)=>a)}=e;r.sort(L);for(let i=0;i<r.length;i++){const a=r[i],u=o[a],s=a===0?null:o[a-1],A=a===o.length-1?null:o[a+1],f=h(u).fractional;if(f){let p,m=0,g=!1;for(;m<=f&&!g;){const d=W(u,m);p=t&&i===0?d[1]:d[0],g=G(u,p,s,A,l),m++}g&&(o[a]=p)}}return o}const H={maximumFractionDigits:20};function Z(n){return T(n,H)}const v="<",I=">";function C(n,e,o,l){let t="";return e===0?t=`${v} `:e===o&&(t=`${I} `),t+(l?O(n,l):Z(n))}const z=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function x(n){if(!("visualVariables"in n)||!n.visualVariables)return null;const e=n.visualVariables.find(i=>i.type==="color");if(!e)return null;let o=null,l=null;if(e.stops){if(e.stops.length===1)return e.stops[0].color;o=e.stops[0].value,l=e.stops[e.stops.length-1].value}const t=o!=null&&l!=null?o+(l-o)/2:0,{getColor:r}=await import("./visualVariableUtils-CXNdoT5o.js").then(i=>i.b);return r(e,t)??null}async function X(n,e){const o=n.trailCap,l=n.trailWidth||1,t=e||await x(n)||n.color;return new N({cap:o,color:t,width:l})}function Y(n,e){if(!e.field)return null;if("featureReduction"in n)switch(n.featureReduction?.type){case"cluster":case"binning":{const o=n.featureReduction.fields.find(({name:l})=>l.toLowerCase()===e.field.toLowerCase());return o&&"getField"in n?n.getField(o.onStatisticField):null}}return"getField"in n?n.getField?.(e.field):null}function $(n,e){const o="popupTemplate"in n?n.popupTemplate?.fieldInfos:null;if(o?.length&&e)return o.find(l=>l.fieldName?.toLowerCase()===e.toLowerCase())?.format?.dateFormat}function P(n,e,o){const l=Y(n,e);if(!l||!q(l)&&!M(l))return null;let t=$(n,l.name);if(!t&&l.type==="date"){let r=0,i=0;e.stops?(r=e.stops?.at(0)?.value??r,i=e.stops?.at(-1)?.value??i):"minDataValue"in e&&"maxDataValue"in e&&(r=e.minDataValue??r,i=e.maxDataValue??i),t=i-r>2*F.days?"short-date":"short-date-short-time"}return{fieldType:l.type,format:t,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in n?n.preferredTimeZone:null,viewTimeZone:o,datesInUnknownTimezone:"datesInUnknownTimezone"in n&&n.datesInUnknownTimezone}}}function J(n,e){if("authoringInfo"in n)return n.authoringInfo?.visualVariables?.find(({theme:o})=>o===e)}const _=new c([64,64,64]);function y(n,e){const o=[],l=n.length-1;return n.length===5?o.push(0,2,4):o.push(0,l),n.map((t,r)=>o.includes(r)?C(t,r,l,e):null)}async function nn(n,e,o){let l=!1,t=[],r=[];if(n.stops){const s=n.stops;t=s.map(A=>A.value),l=s.some(A=>!!A.label),l&&(r=s.map(A=>A.label))}const i=t[0],a=t[t.length-1];if(i==null&&a==null)return null;const u=l?null:y(t,o);return(await Promise.all(t.map(async(s,A)=>{const f=n.type==="opacity"?await en(s,n,e):(await import("./visualVariableUtils-CXNdoT5o.js").then(m=>m.b)).getColor(n,s),p=l?r[A]:u?.[A]??"";return f==null?null:{value:s,color:f,label:p}}))).filter(E).reverse()}async function en(n,e,o){const l=new c(o??_),t=(await import("./visualVariableUtils-CXNdoT5o.js").then(r=>r.b)).getOpacity(e,n);return t!=null&&(l.a=t),l}function on(n){let e=!1,o=[],l=[];o=n.map(a=>a.value),e=n.some(a=>!!a.label),e&&(l=n.map(a=>a.label??""));const t=o[0],r=o[o.length-1];if(t==null&&r==null)return null;const i=e?null:y(o);return o.map((a,u)=>({value:a,color:U(a,n),label:e?l[u]:i?.[u]??""})).reverse()}function U(n,e){const{startIndex:o,endIndex:l,weight:t}=ln(n,e);if(o===l)return e[o].color;const r=c.blendColors(e[o].color,e[l].color,t);return new c(r)}function ln(n,e){let o=0,l=e.length-1;return e.some((t,r)=>n<t.value?(l=r,!0):(o=r,!1)),{startIndex:o,endIndex:l,weight:(n-e[o].value)/(e[l].value-e[o].value)}}function tn(n,e){let o=[];if(n&&n.type==="multipart")n.colorRamps.reverse().forEach((l,t)=>{t===0?o.push({value:e.max,color:new c(l.toColor),label:"high"}):o.push({value:null,color:new c(l.toColor),label:""}),t===n.colorRamps.length-1?o.push({value:e.min,color:new c(l.fromColor),label:"low"}):o.push({value:null,color:new c(l.fromColor),label:""})});else{let l,t;n&&n.type==="algorithmic"?(l=n.fromColor,t=n.toColor):(l=[0,0,0,1],t=[255,255,255,1]),o=[{value:e.max,color:new c(t),label:"high"},{value:e.min,color:new c(l),label:"low"}]}return o}function rn(n){if(!n.colorStops)return[];const e=[...n.colorStops].filter(l=>l.color?.a>0);let o=e.length-1;if(e&&e[0]){const l=e[o];l&&l.ratio!==1&&(e.push(new k({ratio:1,color:l.color})),o++)}return e.map((l,t)=>{let r="";return t===0?r=n.legendOptions?.minLabel||"low":t===o&&(r=n.legendOptions?.maxLabel||"high"),{color:l.color,label:r,ratio:l.ratio}}).reverse()}export{I as a,on as b,J as c,rn as d,tn as e,x as f,z as g,P as h,h as i,S as j,b as l,j as n,v as o,X as p,C as r,U as s,nn as t,D as u};
