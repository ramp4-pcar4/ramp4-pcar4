import{n as ne,v as c,x as h,z as D,a7 as qt,bI as Fe,ah as m,hN as wo,kR as To,hO as So,da as ct,B as zn,bh as ht,V as Me,i as jn,eb as Oo,ab as Re,e8 as Ve,c7 as Mo,ir as Ro,bK as Go,ap as me,bp as Po,ea as Ao,dC as Lo,hm as Co,g0 as xo,fJ as No,aj as qn,al as Do,cG as Zt,ae as ko,O as Yt,gy as Io,fz as Ho,cX as Uo,fu as Fo,j3 as Vo,lN as zo,j$ as Zn,an as jo,ff as qo,dt as Yn,el as Zo,du as Yo,lO as Bo,lP as Wo,ad as Bn,N as dt,ac as Ko,o as Bt,u as Wn,lQ as $o,gP as Jo,lR as ie,dv as Kn,s as Xo,gb as $n,c8 as Qo,fa as Jn,g1 as ze}from"./main-CnDVnExo.js";import{h as es}from"./UpdatingHandles-BRsO5JmU.js";import{i as ts,O as Wt,Q as ns,L as is,k as os,K as ss}from"./projectionUtils-B4YRVrjd.js";import as from"./GraphicsLayer-BFz-x5ra.js";import{v as Xn,l as rs,f as ls,m as ps,x as Qn,E as cs,j as Ce}from"./elevationInfoUtils-IwFHKcCU.js";import{e as hs}from"./editableLayers-SADAq1Zx.js";import{f as ei,_ as A,r as ds,c as us,n as ti,a as G}from"./utils-DkpfPh9p.js";import{a as ys,n as gs}from"./Cyclical-7n_nnGf4.js";import{m as Kt,o as je,a as ce,l as $t}from"./quantityUtils-CeuINKqm.js";import{L as fs,e as I,d as oe,u as vs,q as ni,j as xe,p as Ge,l as ms,B as _s,_ as Es,o as ii,b as oi,E as si,m as bs}from"./vec2-BnynUbeJ.js";import{n as Y,_ as ws,r as ut,l as Ts}from"./vec2f64-CkowXrDb.js";import{H as R,s as yt,o as z,v as Jt,R as j,P as F,q as C,_ as gt,Z as Xt,c as ft,p as qe,J as Ss,j as ai,A as Os,u as Ms,I as Rs}from"./vec32-wzgHRfsM.js";import{n as _e,a as ri,e as Ze}from"./projectVectorToVector-aVV-ibtr.js";import{N as Qt,q as vt,b as mt,j as _t,y as li,R as Gs,v as Ps}from"./geodesicUtils-Cphuwhwm.js";import{d as As}from"./asyncUtils-Bt7pGkXn.js";import{g as Ls}from"./TimeExtent-CrpfETyH.js";import{R as Cs}from"./Query-B3kr4GG5.js";import{s as xs,j as Ns}from"./vec42-D8CJyqHG.js";import{n as Ds}from"./vec4f64-DD-nkcCV.js";import{l as Et,M as B,Q as en,a as pi,k as ci,z as ks,p as hi,V as Is,H as di,O as tn,D as Hs,J as Us}from"./plane-C0adzhgY.js";import{I as Fs,O as Vs,_ as zs,$ as js,U as qs}from"./sphere-CJmmCgGH.js";import{e as Ye}from"./common-CYWrYyJl.js";import{m as Zs,l as ui}from"./geodeticLengthOperator-BPMPkOqT.js";import{e as Ys}from"./earcut-C6NeZYSh.js";import{v as Bs}from"./triangle-BBOmk_rR.js";import{w as Ws,a as Ks}from"./spatialReferenceEllipsoidUtils-0Cts9_Os.js";let Ne=class extends ne{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],Ne.prototype,"length",void 0),c([h()],Ne.prototype,"verticalLength",void 0),c([h()],Ne.prototype,"area",void 0),Ne=c([D("esri.views.interactive.sketch.Units")],Ne);const bt=Ne;var H;function yi(e,t){if(e==null||t==null)return;const n=nn(e,t);return n!=null?je(n,"radians","geographic"):void 0}(function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"})(H||(H={}));const nn=(()=>{const e=m(),t=m();return(n,i)=>(z(e,n.x,n.y,n.z??0),z(t,i.x,i.y,i.z??0),gi(e,t,n.spatialReference,i.spatialReference))})(),gi=(()=>{const e=Y(),t=m(),n=m();return(i,o,s,r)=>{if(R(i,o))return;const a=Qt(s),p=Qt(r);if(a&&p&&Fe(a,p)&&_e(i,s,t,a)&&_e(o,r,n,p)){const{azimuth:d}=vt(Qs,t,n,a);return d!=null?qt(d,"degrees","radians"):void 0}e[0]=o[0]-i[0],e[1]=o[1]-i[1];let l=fs(ws,e);return e[0]<0&&(l=ea-l),l}})();function $s(e,t,n,i=H.Absolute){if(t&&n)switch(i){case H.Absolute:return yi(t,n);case H.Relative:return on(fi(e,t,n),H.Relative);case H.RelativeBilateral:return on(fi(e,t,n),H.RelativeBilateral)}}function fi(e,t,n){if(!e||!t||!n)return;const i=nn(e,t),o=nn(t,n);return i!=null&&o!=null?je(o-i,"radians","geographic"):void 0}function on(e,t){if(e!=null)switch(t){case H.Absolute:return vi(e);case H.Relative:{const n=Be(e);let i=_i.normalize(n,0,!0);return i===-180&&(i=180),je(i,"degrees","geographic")}case H.RelativeBilateral:{const n=Be(e),i=Math.abs(_i.normalize(n,0,!0));return je(i,"degrees","geographic")}}}function vi(e){const t=Be(e),n=ta.normalize(t,0,!0);return je(n,"degrees","geographic")}const Js=(()=>{const e=m();return(t,n,i,o,s,r="geodesic")=>{yt(e,n);const a=Be(s);if(r==="geodesic"){const y=Qt(i);if(y&&_e(e,i,e,y))return _t(t,e,a,o,y),t[2]=n[2],!!_e(t,y,t,i)}const p=Kt(a,"geographic","arithmetic"),l=qt(p,"degrees","radians"),d=n[0]+o*Math.cos(l),u=n[1]+o*Math.sin(l),v=n[2];return z(t,d,u,v),!0}})();function Be(e){if(e!=null)return Kt(mi(e),e.rotationType,"geographic")}function Xs(e){if(e!=null)return Kt(mi(e),e.rotationType,"arithmetic")}function mi(e){return qt(e.value,e.unit,"degrees")}const Qs=new mt,ea=2*Math.PI,ta=ys,_i=new gs(-180,180);let Ee=class extends ne{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?H.RelativeBilateral:H.Relative;case"absolute":return H.Absolute}}get displayUnits(){return this._get("displayUnits")??new bt}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new bt}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],Ee.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],Ee.prototype,"relativeDirectionIsBilateral",void 0),c([h()],Ee.prototype,"effectiveDirectionMode",null),c([h({type:bt,nonNullable:!0})],Ee.prototype,"displayUnits",null),c([h({type:bt,nonNullable:!0})],Ee.prototype,"inputUnits",null),Ee=c([D("esri.views.interactive.sketch.SketchValueOptions")],Ee);const wt=Ee;function Ei(e){switch(e){case b.SUPPORTED:break;case b.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case b.GEOMETRY_MISSING:return"no geometry";case b.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case b.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case b.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var b;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(b||(b={}));function bi(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return b.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const n=e.elevationInfo;return Xn(n)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function na(e){return ia(e).result}function ia(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:b.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:b.GEOMETRY_MISSING};if(Xn(e.elevationInfo))return{result:b.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,n=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:b.SUPPORTED,geometry:n}:{result:b.GEOMETRY_TYPE_UNSUPPORTED}}function oa(e){if(e.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return b.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.SUPPORTED;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(n=>n.type==="object")?b.SYMBOL_TYPE_UNSUPPORTED:rs(e)!=="on-the-ground"&&ls(e)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function sn(e,t,n){if(!t||!e?.map)return;const{map:i}=e;i.layers.find(o=>o===t)||i.add(t,n)}function sa(e,t){const n=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(i=>{const o=i.layer;return o===n||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(n)})}function aa(e){return hs(e)||wo(e)||To(e)||So(e)}let Tt=class extends ne{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],Tt.prototype,"enabled",void 0),Tt=c([D("esri.views.interactive.sketch.SketchLabelOptions")],Tt);const St=Tt;let We=class extends ne{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],We.prototype,"mode",void 0),We=c([D("esri.views.interactive.sketch.SketchTooltipElevationOptions")],We);let k=class extends ne{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],k.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"totalLength",void 0),k=c([D("esri.views.interactive.sketch.SketchTooltipVisibleElements")],k);const wi=k;let U=class extends ne{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new We,this.placement="auto",this.offset=null,this.visibleElements=new wi,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],U.prototype,"enabled",void 0),c([h()],U.prototype,"forceEnabled",void 0),c([h()],U.prototype,"effectiveEnabled",null),c([h()],U.prototype,"helpMessage",void 0),c([h()],U.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],U.prototype,"inputEnabled",void 0),c([h({type:We,nonNullable:!0})],U.prototype,"elevation",void 0),c([h()],U.prototype,"placement",void 0),c([h()],U.prototype,"offset",void 0),c([h({type:wi,nonNullable:!0})],U.prototype,"visibleElements",void 0),c([h()],U.prototype,"visualVariables",void 0),c([h()],U.prototype,"xyMode",void 0),U=c([D("esri.views.interactive.sketch.SketchTooltipOptions")],U);const an=U;let De=class extends ne{constructor(e){super(e),this.labels=new St,this.tooltips=new an,this.values=new wt}};c([h({nonNullable:!0,type:St})],De.prototype,"labels",void 0),c([h({nonNullable:!0,type:an})],De.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:wt})],De.prototype,"values",void 0),De=c([D("esri.views.interactive.sketch.SketchOptions")],De);const rn=De;var Pe;function ln(e,t,n){return V(e,t,n)}function V(e=0,t=0,n=0){return ct(e,t,n)}function ra(e){return e}function la(e){return e}function he(e,t,n){return ct(e,t,n)}function ke(e){const[t,n,i]=e;return e.length>3?[t,n,i,e[3]]:[t,n,i]}function Ot(e){return e[3]=((e.length>3?e[3]:void 0)??Pe.NONE)|Pe.TARGET,e}function pa(e){return!!(((e.length>3?e[3]:void 0)??Pe.NONE)&Pe.TARGET)}function pn(e,t,{coordinateHelper:n,elevationInfo:i},o){return e?Ie(n.vectorToDehydratedPoint(e,da),t,i,o):null}function Ie(e,t,n,i=V()){return i[0]=e.x,i[1]=e.y,i[2]=e.z??0,t==null||(t.type==="2d"?i[2]=0:i[2]=ps(t,e,n,Ce)??0),i}function ca(e,t,n){return n?(ri(n,e[0],e[1],e[2],t),n):Ze(e[0],e[1],e[2],t)}function cn(e,t,{z:n,m:i},o,s){const{spatialReference:r,elevationInfo:a}=o;let p;n==null&&i==null?p=void 0:t==null||t.type==="2d"?p=n??void 0:p=Qn(t,e,r,Ce,a)??0;const[l,d]=e;return s?ri(s,l,d,p,r):s=Ze(l,d,p,r),i!=null&&(s.m=i,s.hasM=!0),s}function ha(e,t,n,i,o=V()){const[s,r]=e;return o[0]=s,o[1]=r,e.length>3&&(o[3]=e[3]??Pe.NONE),n?.type!=="3d"?(o[2]=t.value,o):(o[2]=cs(n,s,r,t.value,i,t.elevationInfo,Ce)??0,o)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(Pe||(Pe={}));const da=Ze(0,0,0,null);let X=class extends zn{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],X.prototype,"enabled",void 0),X=c([D("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],X);let T=class extends zn{constructor(e){super(e),this.lineSnapper=new X,this.parallelLineSnapper=new X,this.rightAngleSnapper=new X,this.rightAngleTriangleSnapper=new X,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new ht([255,127,0]),this.orangeTransparent=new ht([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:X,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"lineSnapper",void 0),c([h({type:X,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"parallelLineSnapper",void 0),c([h({type:X,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"rightAngleSnapper",void 0),c([h({type:X,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],T.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],T.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"pointOnLineThreshold",void 0),c([h({type:ht,nonNullable:!0})],T.prototype,"orange",void 0),c([h({type:ht,nonNullable:!0})],T.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],T.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],T.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],T.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],T.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],T.prototype,"satisfiesConstraintScreenThreshold",void 0),T=c([D("esri.views.interactive.snapping.Settings.Defaults")],T);const Ke=new T;var x;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(x||(x={}));let se=class extends ne{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Me}};c([h({constructOnly:!0})],se.prototype,"layer",void 0),c([h()],se.prototype,"enabled",void 0),c([h()],se.prototype,"updating",void 0),c([h()],se.prototype,"availability",void 0),c([h()],se.prototype,"sublayerSources",void 0),se=c([D("esri.views.interactive.snapping.FeatureSnappingLayerSource")],se);let P=class extends ne{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new Me,this.distance=Ke.distance,this.touchSensitivityMultiplier=Ke.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(Ti)&&jn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(ya),n=this._get("_effectiveFeatureSources")?.filter(Ti)??new Me;for(const a of t){const p=n.find(l=>l.layer===a.layer.parent);if(p)p.sublayerSources.includes(a)||p.sublayerSources.add(a);else if(a.layer.parent){const l=new se({layer:a.layer.parent});l.sublayerSources.add(a),n.add(l)}}for(const a of n){const p=a.sublayerSources.filter(l=>!t.includes(l));a.sublayerSources.removeMany(p)}n.removeMany(n.filter(a=>a.sublayerSources.length===0));const i=e.filter(ua),o=this._get("_effectiveFeatureSources")??new Me,{added:s,removed:r}=Oo(o.toArray(),[...i,...n]);return o.removeMany(r),o.addMany(s),o}};function Ti(e){return e.layer.type==="subtype-group"}function ua(e){return e.layer.type!=="subtype-group"}function ya(e){return e.layer.type==="subtype-sublayer"}c([h()],P.prototype,"enabled",void 0),c([h()],P.prototype,"enabledToggled",void 0),c([h()],P.prototype,"forceDisabled",void 0),c([h()],P.prototype,"selfEnabled",void 0),c([h()],P.prototype,"featureEnabled",void 0),c([h()],P.prototype,"gridEnabled",void 0),c([h()],P.prototype,"attributeRulesEnabled",void 0),c([h({type:Me.ofType(se)})],P.prototype,"featureSources",void 0),c([h()],P.prototype,"distance",void 0),c([h()],P.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],P.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],P.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],P.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],P.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],P.prototype,"_effectiveFeatureSources",null),P=c([D("esri.views.interactive.snapping.SnappingOptions")],P);const ga=Symbol("grid-placement-graphic");function hn(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function fa(e,t){return Math.sqrt(hn(e,t))}function Si(e,t){t.sort((n,i)=>Jt(n.targetPoint,e)-Jt(i.targetPoint,e))}var q;function va({parameters:{point:e,distance:t,returnEdge:n,vertexMode:i,coordinateHelper:{spatialReference:o},filter:s},mode:r,returnZ:a,filter:p}){const l=p?.clone()??new Cs({where:"1=1"});return l.returnZ=a??r==="3d",s&&(l.geometry=s.geometry,l.distance=s.distance,l.spatialRelationship=s.spatialRelationship,l.where=Mo(l.where,s.where),l.timeExtent=Ls(l.timeExtent,s.timeExtent),l.objectIds=ma(l.objectIds,s.objectIds)),{point:Ze(e[0],e[1],e[2],o.toJSON()),mode:r,distance:t,returnEdge:n,vertexMode:i,query:l.toJSON()}}function ma(e,t){return e||t?t?e?Array.from(Ro(new Set(e),new Set(t))):t:e:null}function _a(e,t,n){return{left:pn(e.leftVertex.pos,t,n),right:pn(e.rightVertex.pos,t,n)}}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(q||(q={}));const Oi=Symbol("snapping-toggle");function Mi(e,t=()=>{}){const n=Re(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:i,snappingOptions:o})=>{if(e.removeHandles(Oi),!i||!o)return;const s=A.TOOL,r=[i.on("key-down",a=>{a.key!==ei.toggle||a.repeat||(o.enabledToggled=!0,t())},s),i.on("key-up",a=>{a.key===ei.toggle&&(o.enabledToggled=!1,t())},s),i.on("pointer-move",a=>{const p=a.native.ctrlKey;o.enabledToggled!==p&&(o.enabledToggled=p,t())},s)];e.addHandles(r,Oi)},Ve);e.addHandles(n)}function Ea(e){return ds(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}function dn(e,t){return e[0]*t[1]-e[1]*t[0]}function ba(e,t,n){const i=xe(n,t)/Ge(n);return ms(e,n,i)}function wa(e,t,n,i,o=n){return I(Ae,i,n),I(Mt,t,o),ba(He,Mt,Ae),vs(e,o,He)}function Ta(e,t,n,i){I(Ae,t,n);const o=i/ni(Ae);return oe(e,n,Ae,o)}function Sa(e,t){const n=e.start,i=e.end,o=t.start,s=t.end,r=I(Ae,i,n),a=I(Ri,s,o),p=dn(r,a);if(Math.abs(p)<=Ma)return[];const l=I(Mt,n,o),d=dn(a,l)/p,u=dn(r,l)/p;if(d>=0){if(u>=0||t.type===O.LINE)return[oe(He,n,r,d)]}else if(e.type===O.LINE&&(u>=0||t.type===O.LINE))return[oe(He,n,r,d)];return[]}function Oa(e,t,n){const i=[],o=I(Ae,e.end,e.start),s=I(Ri,e.start,t),r=Ge(o),a=2*xe(o,s),p=a*a-4*r*(Ge(s)-n*n);if(p===0){const l=-a/(2*r);(e.type===O.LINE||l>=0)&&i.push(oe(He,e.start,o,l))}else if(p>0){const l=Math.sqrt(p),d=(-a+l)/(2*r);(e.type===O.LINE||d>=0)&&i.push(oe(He,e.start,o,d));const u=(-a-l)/(2*r);(e.type===O.LINE||u>=0)&&i.push(oe(Mt,e.start,o,u))}return i}var O;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})(O||(O={}));const Ma=1e-6,Ae=Y(),Ri=Y(),Mt=Y(),He=Y();function un({start:e,end:t,type:n},i,o){const s=[],r=I($e,t,e),a=I(Gt,e,i),p=Ge(r),l=2*xe(r,a),d=l*l-4*p*(Ge(a)-o*o);if(d===0){const u=-l/(2*p);(n===Z.PLANE||u>=0)&&s.push(oe(Y(),e,r,u))}else if(d>0){const u=Math.sqrt(d),v=(-l+u)/(2*p);(n===Z.PLANE||v>=0)&&s.push(oe(Y(),e,r,v));const y=(-l-u)/(2*p);(n===Z.PLANE||y>=0)&&s.push(oe(Y(),e,r,y))}return s}function Gi(e,t){const n=e.start,i=e.end,o=I($e,i,n),s=z(At,-o[1],o[0],0),r=t.start,a=t.end,p=j(fn,a,r),l=F(p,s),d=z(Di,n[0],n[1],0),u=j(ki,d,r),v=F(u,s),y=Ye();if(Math.abs(l)<y)return[];const f=C(Ii,r,p,v/l);if(t.type===O.RAY){const g=j(vn,f,r);if(F(g,p)<-y)return[]}if(e.type===Z.HALF_PLANE){const g=_s(Gt,f,n);if(xe(g,o)<-y)return[]}return[me(f)]}function Ra(e,t){return Pa(Rt(mn,t[2],e),t)}function Pi(e,t){return xi(Rt(mn,0,e),Rt(xa,0,t)).map(([n,i])=>ut(n,i))}function Ai(e,t,n){return yn(e,Rt(mn,e[2],t),n)}function Li(e,t,n,i=m()){const o=I($e,e,t),s=ni(o);return oe(i,t,o,s===0?1:n/s),i[2]=e[2],i}function yn(e,{start:t,end:n,type:i},o=m()){const s=j(Pt,e,t),r=j(At,n,t),a=F(s,r)/F(r,r);return C(o,t,r,i===O.RAY?Math.max(a,0):a)}const Ga=(()=>{const e=m(),t=m(),n=m();return({start:i,end:o},{center:s,radius:r,normal:a,slicePlane:p})=>{const l=Et(s,a,Ca);if(w(en(l,i),0)&&w(en(l,o),0)){pi(a,e,t);const u=(f,g)=>(ft(n,g,s),ii(f,F(n,e),F(n,t)),f),v=Oa({start:u($e,i),end:u(Gt,o),type:O.LINE},Ts,r),y=[];for(const[f,g]of v){const _=yt(m(),s);C(_,_,e,f),C(_,_,t,g),p&&!be(p,_)||y.push(_)}return y}const d=m();return ci(l,i,o,d)?!w(qe(d,s),r)||p&&!be(p,d)?[]:[d]:[]}})();function Ci({start:e,end:t,type:n},i,o){const s=[],r=ft(Pt,t,e),a=I(Gt,e,i),p=Ge(r),l=2*xe(r,a),d=l*l-4*p*(Ge(a)-o*o);if(d===0){const u=-l/(2*p);(n===O.LINE||u>=0)&&s.push(C(m(),e,r,u))}else if(d>0){const u=Math.sqrt(d),v=(-l+u)/(2*p);(n===O.LINE||v>=0)&&s.push(C(m(),e,r,v));const y=(-l-u)/(2*p);(n===O.LINE||y>=0)&&s.push(C(m(),e,r,y))}return s}function xi(e,t){const n=e.start,i=e.end,o=t.start,s=t.end,r=j(Pt,i,n),a=j(At,s,o),p=j(fn,o,n),l=gt(Di,r,a);if(!w(F(p,l),0))return[];const d=Xt(l);if(w(d,0))return[];const u=gt(ki,p,a),v=F(u,l)/d,y=C(Ii,n,r,v);if(e.type===O.RAY){const f=j(vn,y,n);if(F(r,f)<-Ye())return[]}if(t.type===O.RAY){const f=j(vn,y,o);if(F(a,f)<-Ye())return[]}return[me(y)]}function Pa({start:e,end:t,type:n},i){const o=j(Pt,i,e),s=j(At,t,e),r=gt(fn,s,o),a=Xt(r)/Xt(s),p=Ye();if(a<p)switch(n){case O.LINE:return[me(i)];case O.RAY:return F(s,o)<-p?[]:[me(i)]}return[]}function gn(e,t,n,i){const[o,s]=e,[r,a]=n,p=r-o,l=a-s,d=p*p+l*l,u=Math.sqrt(d);if(u>t+i)return[];if(u<Math.abs(t-i))return[];if(w(u,0)&&w(t,i))return[];const v=(t*t-i*i+d)/(2*u),y=Math.sqrt(t*t-v*v),f=y*l/u,g=y*p/u,[_,M]=Es($e,e,n,v/u);return w(f,g)?[ut(_,M)]:[ut(_+f,M-g),ut(_-f,M+g)]}function Rt(e,t,{start:n,end:i,type:o}){return z(e.start,n[0],n[1],t),z(e.end,i[0],i[1],t),e.type=La[o],e}function Ni(e,t){return w(e[2],t[2])}function w(e,t){return Go(Math.abs(e-t),0,Ye())}function Aa(e,t){return t.filter(n=>be(e,n))}function be(e,t){return ks(e,t)}var Z;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})(Z||(Z={}));const La={[Z.PLANE]:O.LINE,[Z.HALF_PLANE]:O.RAY},$e=Y(),Gt=Y(),Pt=m(),At=m(),fn=m(),Di=m(),ki=m(),Ii=m(),vn=m(),Ca=B(),mn={start:m(),end:m(),type:O.LINE},xa={start:m(),end:m(),type:O.LINE};class W{intersect(t){return de(this,t)}closestPoints(t){return[this.closestTo(t)]}}class Le extends W{constructor(t){super(),this.point=t}equals(t){return this===t||K(t)&&R(this.point,t.point)}closestTo(){return ke(this.point)}}class _n extends W{constructor(t,n,i){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:i}}equals(t){return this===t||ae(t)&&this.lineLike.type===t.lineLike.type&&R(this.start,t.start)&&R(this.end,t.end)}closestTo(t){const n=V();return yn(t,this.lineLike,n),n}}class En extends _n{constructor(t,n){super(t,n,O.LINE)}}class Na extends _n{constructor(t,n){super(t,n,O.RAY)}}class Hi extends W{constructor(t){super(),this.constraints=t}equals(t){return this===t||Gn(t)&&Ao(this.constraints,t.constraints,(n,i)=>n.equals(i))}closestTo(t){let n,i=1/0;for(const o of this.constraints){const s=o.closestTo(t),r=Jt(t,s);r<i&&(i=r,n=s)}return ke(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class bn extends W{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||le(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=V();return Li(t,this.center,this.radius,n),n}}class wn extends W{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||ye(t)&&R(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=V();return Li(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new Tn(ke(this.center),this.radius,he(0,0,1))}}class Tn extends W{constructor(t,n,i,o=void 0){super(),this.center=t,this.radius=n,this.normal=i,this.slicePlane=o}equals(t){return this===t||we(t)&&R(this.center,t.center)&&R(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:i}=this;di(this.getPlane(Da),t,Sn);const o=j(Sn,Sn,n),s=ai(o);if(w(s,0))return ke(t);const r=i/Math.sqrt(s),a=V();C(a,n,o,r);const{slicePlane:p}=this;return p&&!be(p,a)?Mn(p,this)?.closestTo(t)??ke(t):a}getPlane(t=B()){return Et(this.center,this.normal,t)}}const Sn=m(),Da=B();class Ui extends W{constructor(t){super(),this.z=t}equals(t){return this===t||ue(t)&&this.z===t.z}closestTo(t){return he(t[0],t[1],this.z)}getPlane(t=B()){return z(Fi,0,0,this.z),Et(Fi,Lo,t)}}const Fi=m();class On extends W{constructor(t,n,i){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:i}}equals(t){return this===t||re(t)&&this.planeLike.type===t.planeLike.type&&R(this.start,t.start)&&R(this.end,t.end)}closestTo(t){const n=V();return Ai(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:i}=this.planeLike;return Math.sign(xe(I(ka,i,n),I(Ia,t,n)))>0?this.end:this.start}getPlane(t=B()){const n=yt(Vi,this.end);return n[2]+=1,hi(this.start,this.end,n,t)}getSlicePlane(t=B()){const{start:n,end:i,type:o}=this.planeLike;if(o===Z.PLANE)return;const s=z(Vi,n[0],n[1],0),r=z(zi,i[0],i[1],0),a=ft(zi,r,s);return Et(s,a,t),t}}const ka=Y(),Ia=Y(),Vi=m(),zi=m();class Ha extends On{constructor(t,n){super(t,n,Z.HALF_PLANE)}}class ji extends On{constructor(t,n){super(t,n,Z.PLANE)}}class Ua extends W{constructor(t,n){super(),this.sphere=Vs(t,n)}equals(t){return this===t||ge(t)&&zs(this.sphere,t.sphere)}closestTo(t){const n=V();return js(this.sphere,t,n),n}get center(){return qs(this.sphere)}get radius(){return this.sphere[3]}}class qi extends W{constructor(t,n,i){super(),this.start=t,this.end=n,this.getZ=i,this.planeLike={start:t,end:n,type:Z.PLANE}}equals(t){return this===t||Ct(t)&&R(this.start,t.start)&&R(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return ja(this,t)}addIfOnTheGround(t,n){for(const i of n){const o=this.getZ(i[0],i[1])??0;w(i[2],o)&&(i[2]=o,t.push(i))}}}class Zi extends W{constructor(t,n,i){super(),this._x=t,this._y=n,this._z=i}equals(t){return this===t||sr(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,i]){return ln(this._x??t,this._y??n,this._z??i)}}class Yi extends W{constructor(t,n,i,o,s){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=i,this._z=o,this._directionDegrees=s}equals(t){return this===t||or(t)&&si(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,i]){return ii(Je,t,n),si(Je,this._origin)||this._applyDirectionAndDistance(Je),ln(Je[0],Je[1],this._z??i)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)_t(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Va(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=vt(Fa,this._origin,t,this._spatialReference);_t(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const Je=[0,0],Fa=new mt;function Va(e,t,n,i,o){let{azimuth:s,distance:r}=vt(za,t,i,o);s??=0;let a=r*Math.cos((s-n)*ts);a=Math.max(0,a),_t(e,t,n,a,o)}const za=new mt;function ja(e,t){const n=V();return Ai(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??Ki,n}function de(e,t){if(Gn(e)){const n=[];for(const i of e.constraints){const o=i.intersect(t);o&&n.push(o)}return Lt(n)}if(Gn(t))return de(t,e);if(Ct(e))return Bi(e,t);if(Ct(t))return Bi(t,e);if(K(e)){const{point:n}=e;if(K(t))return R(n,t.point)?e:void 0;const i=t.closestTo(n);return Ss(i,n)?e:void 0}if(ae(e)){if(K(t))return de(t,e);if(ae(t))return Q(xi(e.lineLike,t.lineLike));if(ue(t))return qa(e,t);if(re(t))return Q(Gi(t.planeLike,e.lineLike));if(le(t))return Q(Ci(e.lineLike,t.center,t.radius));if(we(t))return Q(Ga(e.lineLike,t));if(ye(t))return Za(e,t);if(ge(t))return Ya(e,t)}else if(ue(e)){if(K(t)||ae(t))return de(t,e);if(ue(t))return Ba(e,t);if(re(t))return Wa(e,t);if(le(t))return Ka(e,t);if(we(t))return Ja(e,t);if(ye(t))return $a(e,t);if(ge(t))return Xa(e,t)}else if(re(e)){if(K(t)||ae(t)||ue(t))return de(t,e);if(re(t))return Rn(Pi(e.planeLike,t.planeLike));if(le(t))return Rn(un(e.planeLike,t.center,t.radius));if(we(t))return er(e,t);if(ye(t))return Qa(e,t);if(ge(t))return tr(e,t)}else if(le(e)){if(K(t)||ae(t)||ue(t)||re(t))return de(t,e);if(le(t))return Rn(gn(e.center,e.radius,t.center,t.radius));if(we(t))return;if(ye(t))return nr(e,t);if(ge(t))return}else if(we(e)){if(K(t)||ae(t)||ue(t)||re(t)||le(t))return de(t,e);if(we(t))return;if(ye(t))return t.asCircle(),void 0;if(ge(t))return}else if(ye(e)){if(K(t)||ae(t)||ue(t)||re(t)||le(t)||we(t))return de(t,e);if(ye(t))return ir(t,e);if(ge(t))return}else if(ge(e)){if(K(t)||ae(t)||ue(t)||re(t)||le(t)||ye(t))return de(t,e);if(ge(t))return}}const qa=(()=>{const e=B();return(t,n)=>{const{start:i,end:o}=t;if(Ni(i,o)&&w(i[2],n.z))return t;const s=V();return ci(n.getPlane(e),i,o,s)?new Le(s):void 0}})();function Za({lineLike:e},{center:t,radius:n}){const i=t[2];return Q(Ci(e,t,n).filter(o=>w(o[2],i)))}function Ya({lineLike:e},{sphere:t}){return Q(Fs(t,e.start,e.end))}const Mn=(()=>{const e=Ds(),t=m(),n=m();return(i,o,s)=>{const{normal:r,center:a,radius:p}=o;pi(r,t,n);const l=tn(i),d=p*F(l,t),u=p*F(l,n);xs(e,a[0],a[1],a[2],1);const v=Ns(i,e),y=Math.hypot(d,u),f=w(y,0);if(w(en(i,a),0)){if(f)return o;if(w(p,0))return!s||be(s,a)?new Le(ke(a)):void 0;gt(t,l,r),Os(t,t);const jt=new Array,lt=me(a);C(lt,lt,t,p),s&&!be(s,lt)||jt.push(lt);const pt=me(a);return C(pt,pt,t,-p),s&&!be(s,pt)||jt.push(pt),Q(jt)}if(f)return;const g=-v/y;if(Math.abs(g)>1||w(g,1))return;const _=Math.atan(d/u),M=Co(g)-_,S=Math.PI-M,Oe=new Array,at=m();C(at,a,t,p*Math.cos(M)),C(at,at,n,p*Math.sin(M)),Oe.push(at);const rt=m();return C(rt,a,t,p*Math.cos(S)),C(rt,rt,n,p*Math.sin(S)),Oe.push(rt),Q(s?Aa(s,Oe):Oe)}})();function Ba(e,t){return w(e.z,t.z)?e:void 0}function Wa({z:e},{planeLike:t}){const[n,i]=t.start,[o,s]=t.end,r=he(n,i,e),a=he(o,s,e);return t.type===Z.PLANE?new En(r,a):new Na(r,a)}function Ka(e,t){const[n,i]=t.center;return new wn(he(n,i,e.z),t.radius)}function $a(e,t){return w(t.center[2],e.z)?t:void 0}const Ja=(()=>{const e=B();return(t,n)=>Mn(t.getPlane(e),n,n.slicePlane)})();function Xa(e,{center:t,radius:n}){const i=Math.abs(t[2]-e.z);if(i>n&&!w(i,n))return;const o=he(t[0],t[1],e.z),s=Math.sqrt(n**2-i**2);return w(s,0)?void 0:new wn(o,s)}const Qa=(()=>{const e=B();return(t,{center:n,radius:i})=>{const o=un(t.planeLike,n,i),s=n[2];t.getSlicePlane(e);const r=new Array;for(const[a,p]of o){const l=[a,p,s];be(e,l)&&r.push(l)}return Q(r)}})(),er=(()=>{const e=B(),t=B();return(n,i)=>Mn(n.getPlane(e),i,n.getSlicePlane(t))})(),tr=(()=>{const e=B();return(t,{center:n,radius:i})=>{const o=t.getPlane(e),s=Is(o,n),r=Math.abs(s);if(r>i&&!w(r,i))return;const a=Math.sqrt(i**2-s**2);if(w(a,0)){const d=V();return di(o,n,d),new Le(d)}const p=V(),l=me(tn(o));return C(p,n,l,s),new Tn(p,a,l,t.getSlicePlane())}})();function nr(e,t){const n=oi(e.center,t.center);return w(n,0)&&w(e.radius,t.radius)?t:Wi(gn(e.center,e.radius,t.center,t.radius),t.center[2])}function ir(e,t){if(!Ni(e.center,t.center))return;const n=oi(e.center,t.center);return w(n,0)&&w(e.radius,t.radius)?e:Wi(gn(e.center,e.radius,t.center,t.radius),e.center[2])}function Bi(e,t){const{planeLike:n,getZ:i}=e,o=new Array;if(K(t))e.addIfOnTheGround(o,Ra(n,t.point));else if(ae(t))e.addIfOnTheGround(o,Gi(n,t.lineLike));else if(le(t))for(const[s,r]of un(n,t.center,t.radius)){const a=i(s,r);a!=null&&o.push(ct(s,r,a))}else if(re(t)||Ct(t))for(const[s,r]of Pi(n,t.planeLike)){const a=i(s,r)??Ki;o.push(ct(s,r,a))}return Q(o)}function Rn(e){return Lt(e.map(([t,n])=>{const i=he(t,n,0),o=he(t,n,1);return new En(i,o)}))}function Q(e){return Lt(e.map(t=>t?new Le(t):void 0))}function Wi(e,t){return Q(e.map(([n,i])=>[n,i,t]))}function Lt(e){if(e.length!==0)return e.length===1?e[0]??void 0:new Hi(e.filter(Po))}function Gn(e){return e instanceof Hi}function K(e){return e instanceof Le}function ae(e){return e instanceof _n}function ue(e){return e instanceof Ui}function re(e){return e instanceof On}function le(e){return e instanceof bn}function ye(e){return e instanceof wn}function we(e){return e instanceof Tn}function ge(e){return e instanceof Ua}function Ct(e){return e instanceof qi}function or(e){return e instanceof Yi}function sr(e){return e instanceof Zi}const Ki=0;let Ue=class{constructor(e,t,n,i){this.targetPoint=e,this.constraint=t,this.isDraped=n,this.domain=i}},Pn=class extends Ue{constructor({targetPoint:e,objectId:t,constraint:n,isDraped:i}){super(e,n,i,x.FEATURE),this.objectId=t}},Xe=class{constructor(e,t){this.isDraped=e,this.domain=t}},ee=class mo extends Xe{constructor(t,n,i,o,s=x.ALL,r=!0,a=!0){super(o,s),this.type=t,this.lineStart=n,this.lineEnd=i,this.fadeLeft=r,this.fadeRight=a}equals(t){return t instanceof mo&&this.type===t.type&&R(this.lineStart,t.lineStart)&&R(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return qe(this.lineStart,this.lineEnd)}},$i=class extends Pn{constructor(e){super({...e,isDraped:!0,constraint:new qi(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new ee(q.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Ji=class extends Pn{constructor(e){super({...e,constraint:new En(e.edgeStart,e.edgeEnd)})}get hints(){return[new ee(q.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Xi=class _o extends Xe{constructor(t,n,i=x.ALL){super(n,i),this.intersectionPoint=t}equals(t){return t instanceof _o&&R(this.intersectionPoint,t.intersectionPoint)}},Qe=class extends Ue{constructor(e,t,n,i){super(e,new Le(e),i,x.ALL),this.first=t,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Xi(this.targetPoint,this.isDraped,this.domain)]}},Qi=class extends Ue{constructor({lineStart:e,lineEnd:t,targetPoint:n,isDraped:i}){super(n,new ji(e,t),i,x.SELF),this._referenceLineHint=new ee(q.REFERENCE_EXTENSION,e,t,i,this.domain)}get hints(){return[this._referenceLineHint,new ee(q.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},eo=class Eo extends Xe{constructor(t,n,i,o=x.ALL){super(i,o),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof Eo&&R(this.lineStart,t.lineStart)&&R(this.lineEnd,t.lineEnd)}},to=class extends Ue{constructor({referenceLine:e,lineStart:t,targetPoint:n,isDraped:i}){const o=me(t),{left:s,right:r}=e;ft(o,Ms(o,o,r),s),super(n,new ji(t,o),i,x.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new ee(q.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new eo(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new ee(q.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(n=>{R(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),R(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),R(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),R(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},An=class bo extends Xe{constructor(t,n,i,o,s=x.ALL){super(o,s),this.previousVertex=t,this.centerVertex=n,this.nextVertex=i}equals(t){return t instanceof bo&&R(this.previousVertex,t.previousVertex)&&R(this.centerVertex,t.centerVertex)&&R(this.nextVertex,t.nextVertex)}},no=class extends Ue{constructor({targetPoint:e,constraint:t,previousVertex:n,otherVertex:i,otherVertexType:o,isDraped:s,selfSnappingType:r,objectId:a,domain:p}){super(e,t,s,p??x.SELF),this.previousVertex=n,this.otherVertex=i,this.otherVertexType=o,this.selfSnappingType=r??tt.None,this.objectId=a??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===et.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===et.CENTER?this.targetPoint:this.otherVertex;return[new ee(q.TARGET,t,n,this.isDraped,this.domain),new ee(q.REFERENCE,e,t,this.isDraped,this.domain),new An(this.previousVertex,t,n,this.isDraped,this.domain)]}};var et,tt;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(et||(et={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(tt||(tt={}));let io=class extends Ue{constructor({targetPoint:e,point1:t,point2:n,isDraped:i}){super(e,new bn(Rs(m(),t,n,.5),.5*bs(t,n)),i,x.SELF),this._p1=t,this._p2=n}get hints(){return[new ee(q.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new ee(q.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new An(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function oo(e,t,n,i,o=m()){const s=yt(ar,e);return s[2]=Qn(i,s,t,n)||0,i.renderCoordsHelper.toRenderCoords(s,t,o),o}const ar=m();function so(e,t,n,i){return i.type==="2d"?(xt.x=e[0],xt.y=e[1],xt.spatialReference=t,i.toScreen(xt)):(oo(e,t,n,i,ao),i.state.camera.projectToScreen(ao,Ln),xo(Ln[0],Ln[1]))}const xt=Ze(0,0,0,null),ao=m(),Ln=No();function rr(e){return li(e)||qn(e)}function Cn(e,t,n,...i){return li(e)?t.apply(void 0,i):e.isWebMercator?n.apply(void 0,i):null}function lr(e){const{spatialReference:t}=e;return Cn(t,ur,yr,e)}function pr(e,t){if(!Fe(e.spatialReference,t.spatialReference))return null;const{spatialReference:n}=e;return Nt[0]=e.x,Nt[1]=e.y,Nt[2]=e.hasZ?e.z:0,Dt[0]=t.x,Dt[1]=t.y,Dt[2]=t.hasZ?t.z:0,ro(Nt,Dt,n)}function ro(e,t,n){return Cn(n,hr,dr,e,t,n)}const cr={geodesicLength:lr,geodesicDistanceBetweenPoints:pr,geodesicDistance:ro};async function lo(){return await Zs(),cr}function hr(e,t,n){return ce(vt(fr,e,t,n).distance,"meters")}function dr(e,t,n){return ce(ui(gr(e,t,n),{unit:"meters"}),"meters")}function ur(e){return ce(Gs([e],"meters")[0],"meters")}function yr(e){return ce(ui(e,{unit:"meters"}),"meters")}function gr(e,t,n){return new Do({spatialReference:n,paths:[[[...e],[...t]]]})}const fr=new mt,Nt=m(),Dt=m();let te=class extends Zt.EventedMixin(ne){constructor(e){super(e),this.options=new P,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=fe.MAIN}initialize(){this.addHandles([Re(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:i,effectiveGridEnabled:o}=this.options;return{selfEnabled:n,featureEnabled:i,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=As(n=>this._updateEngines(e,t,n))},Ve),Re(()=>this.options,e=>{for(const t of this._engines)t.options=e},ko)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const i=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!i.has("feature")?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!i.has("self")?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!i.has("grid")?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(const s of o)s.status==="fulfilled"&&s.value?.engine.destroy();else{for(const s of o)s.status==="fulfilled"&&s.value&&i.set(s.value.type,s.value.engine);this._engines=Array.from(i.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},n]=await Promise.all([import("./SelfSnappingEngine-CNta1L4c.js"),lo()]);return Yt(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:n})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:n}=await import("./GridSnappingEngine-UClpgUvp.js");return Yt(e),{type:"grid",engine:new n({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await import("./FeatureSnappingEngine-Ui3B-6nl.js");Yt(e);const{view:n,options:i}=this,{spatialReference:o}=n;return{type:"feature",engine:new t({view:n,options:i,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return _r(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:s}=n,r=Wt(o,s);if(r==null)return t;const{view:a}=this,{elevationInfo:p,visualizer:l}=n,d=[],u=Ie(r,a,p),v=i.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,v,n)||!Nn(i,n.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=Ot(v),d.push(...i.hints);for(const y of this._currentOtherActiveCandidates)Nn(y,n.drawConstraints)&&(y.targetPoint=Ot(v),d.push(...y.hints));return l!=null&&this.addHandles(l.draw(d,{spatialReference:s,elevationInfo:Er(n),view:a,selfSnappingZ:n.selfSnappingZ}),xn),cn(v,a,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case fe.MAIN:return e;case fe.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=fe.MAIN}_removeVisualization(){this.removeHandles(xn)}async _snapSinglePoint({point:e,context:t,signal:n}){const{view:i}=this,{elevationInfo:o}=t,s=Ie(e,i,o),r=await this._fetchCandidates(s,x.ALL,t,n);return this._createSnapResult(s,fe.MAIN,r,i,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:i}){const{view:o}=this,{coordinateHelper:s,elevationInfo:r,spatialReference:a}=n;await ns(t.spatialReference,a);const p=Wt(t,a),l=Ie(p,o,r),d=await this._fetchCandidates(l,x.FEATURE,n,i);if(d.length>0){const y=await this._fetchCandidates(l,x.SELF,n,i);return this._createSnapResult(l,fe.SCENE,[...d,...y],o,p,n,i)}const u=Ie(e,o,r),v=await this._fetchCandidates(u,x.SELF,n,i);return this._createSnapResult(u,fe.MAIN,v,o,{z:s.hasZ()&&e.hasZ?e.z??0:void 0,m:s.hasM()&&e.hasM?e.m??0:void 0},n,i)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,n,i)))).flat()}_createSnapResult(e,t,n,i,o,s,r){return{get valid(){return!Io(r)},apply:()=>{const{spatialReference:a}=s,{snappedPoint:p,hints:l}=this._processCandidates(e,t,n,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(l,{spatialReference:a,elevationInfo:Ce,view:i,selfSnappingZ:s.selfSnappingZ}),xn),cn(p,i,o,s)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Si(e,n);const o=this._currentMainCandidate;if(o!=null){const s=mr(o,n);if(s>=0){if(!(n[s]instanceof Qe))return this._intersectWithOtherCandidates(s,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,i))return this._updateSnappingCandidate(o,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_intersectWithOtherCandidates(e,t,n,i,o){const{coordinateHelper:s}=o,r=t[e],a=[];for(let p=0;p<t.length;++p){if(p===e)continue;const l=t[p],d=r.constraint.intersect(l.constraint);if(d)for(const u of d.closestPoints(r.targetPoint))a.push([new Qe(Ot(u),r,l,l.isDraped),this._squaredScreenDistance(n,u,s)])}return a.length>0&&(a.sort((p,l)=>p[1]-l[1]),a[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(a[0][0],i,t,o):Nn(r,o.drawConstraints)?this._updateSnappingCandidate(r,i,t,o):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const r of n){if(e instanceof Qe){if(r.constraint.equals(e.first.constraint)||r.constraint.equals(e.second.constraint))continue}else if(r.constraint.equals(e.constraint))continue;const a=r.constraint.closestTo(o);this._squaredScreenDistance(a,o,i.coordinateHelper)<vr()&&(r.targetPoint=o,this._currentOtherActiveCandidates.push(r),s.push(...r.hints))}return{snappedPoint:o,hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return hn(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return so(e,t.spatialReference,Ce,this.view)}get test(){}};var fe;c([h({constructOnly:!0})],te.prototype,"view",void 0),c([h()],te.prototype,"options",void 0),c([h({readOnly:!0})],te.prototype,"updating",null),c([h()],te.prototype,"_loadTask",void 0),c([h()],te.prototype,"_engines",void 0),c([h()],te.prototype,"_squaredMouseProximityThreshold",null),c([h()],te.prototype,"_squaredTouchProximityThreshold",null),te=c([D("esri.views.interactive.snapping.SnappingManager")],te),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(fe||(fe={}));const xn="visualization-handle";function vr(){return Ke.satisfiesConstraintScreenThreshold*Ke.satisfiesConstraintScreenThreshold}function Nn(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof $i||e instanceof Ji||e instanceof Qi||e instanceof to||e instanceof io)&&(!(e instanceof no)||t.direction==null&&e.selfSnappingType===tt.LastVertex)}function mr(e,t){return e instanceof Qe?Dn(t,e.first)>=0&&Dn(t,e.second)>=0?0:-1:Dn(t,e)}function Dn(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}function _r(e){return e.scenePoint!=null}function Er({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Ce:t}function kn(e){return Ho(e)?Uo(e)||qn(e)||Fo(e)||Vo(e)?Ws:e:Ks(e)}function br(e,t=kt()){return po(e,t)}function wr(e,t=kt()){return po(e,t,!1)}function po(e,t,n=e.hasZ){const i=kn(e.spatialReference),o=zo(i);if(o==null)return null;const s=(a,p)=>!(p.length<2)&&(z(a,p[0],p[1],n&&p[2]||0),!0);let r=0;for(const a of e.rings){const p=a.length;if(p<3)continue;const{positionsWorldCoords:l}=t;for(;l.length<p;)l.push(m());const d=Tr,u=z(Sr,0,0,0),v=1/p;for(let g=0;g<p;g++){if(!s(d,a[g])||!_e(d,e.spatialReference,l[g],i))return null;C(u,u,l[g],v)}const y=hi(l[0],l[1],u,Hs());if(ai(tn(y))===0)continue;for(let g=0;g<p;g++)Us(y,u,l[g],l[g]);const f=Or(l);for(let g=0;g<f.length;g+=3)r+=Bs(l[f[g]],l[f[g+1]],l[f[g+2]])}return $t(r,o)}const Tr=m(),Sr=m();function kt(){return{positionsWorldCoords:[]}}function Or(e){return Ys(Mr(e),[],2)}function Mr(e){const t=new Float64Array(2*e.length);for(let n=0;n<e.length;++n){const i=e[n],o=2*n;t[o]=i[0],t[o+1]=i[1]}return t}const Rr=e=>({geodesicArea(t){const{spatialReference:n}=t;return Cn(n,Pr,i=>Ar(e,i),t)}});async function Gr(){const e=await import("./geometryEngine-Bps6SwYf.js");return Rr(e)}function Pr(e){return $t(Math.abs(Ps([e],"square-meters")[0]),"square-meters")}function Ar(e,t){try{return $t(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch{return null}}const Lr=e=>({autoAreaByElevationMode(t,n,i=kt()){return n==="on-the-ground"?e.geodesicArea(t)??wr(t,i):br(t,i)},autoArea2D(t,n=kt()){return this.autoAreaByElevationMode(t,"on-the-ground",n)}});let In=null;async function nt(){return In||(In=Lr(await Gr())),In}var pe;function Cr(e){return xr(e,pe.Horizontal)}function xr(e,t){const{hasZ:n,spatialReference:i}=e,o=kn(i);let s=0;const r=Zn(o);if(r==null)return null;const a=t===pe.Direct?Ir:Hn;for(const p of e.paths){if(p.length<2)continue;const l=p.length-1;for(let d=0;d<l;++d){const u=p[d];$[0]=u[0],$[1]=u[1],$[2]=n?u[2]:0;const v=p[d+1];J[0]=v[0],J[1]=v[1],J[2]=n?v[2]:0;const y=a($,J,i);if(y==null)return null;s+=y.value}}return ce(s,r)}function Nr(e,t){const{spatialReference:n}=e;return Fe(n,t.spatialReference)?($[0]=e.x,$[1]=e.y,$[2]=e.hasZ?e.z:0,J[0]=t.x,J[1]=t.y,J[2]=t.hasZ?t.z:0,Hn($,J,n)):null}function Dr(e,t){const{spatialReference:n}=e;return Fe(n,t.spatialReference)?($[0]=e.x,$[1]=e.y,$[2]=e.hasZ?e.z:0,J[0]=t.x,J[1]=t.y,J[2]=t.hasZ?t.z:0,ho($,J,n)):null}function kr(e){return e!=null?co(e.hasZ?e.z:0,e.spatialReference):null}function co(e,t){const n=jo(t);return n!=null?ce(e??0,n):null}function Ir(e,t,n){const i=Un(e,t,n,pe.Direct);return i!=null?ce(i.direct,i.unit):null}function Hn(e,t,n){const i=Un(e,t,n,pe.Horizontal);return i!=null?ce(i.horizontal,i.unit):null}function ho(e,t,n){const i=Un(e,t,n,pe.Vertical);return i!=null?ce(i.verticalSigned,i.unit):null}function Un(e,t,n,i){const o=kn(n),s=Zn(o);if(s==null)return null;const r=t[2]-e[2];if(i===pe.Vertical)return{verticalSigned:r,unit:s};if(!_e(e,n,Fn,o)||!_e(t,n,It,o))return null;if(i===pe.Direct)return{direct:qe(It,Fn),unit:s};if(z(Ht,e[0],e[1],t[2]),!_e(Ht,n,Ht,o))return null;const a=qe(Ht,It);return i===pe.Horizontal?{horizontal:a,unit:s}:{direct:qe(It,Fn),horizontal:a,vertical:Math.abs(r),unit:s}}(function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"})(pe||(pe={}));const $=m(),J=m(),Fn=m(),It=m(),Ht=m();function Hr(e){return{autoLength2D:t=>e.geodesicLength(t)??Cr(t),autoDistanceBetweenPoints2D:(t,n)=>e.geodesicDistanceBetweenPoints(t,n)??Nr(t,n),autoDistance2D:(t,n,i)=>(it[0]=t[0],it[1]=t[1],it[2]=t.length===3?t[2]:0,ot[0]=n[0],ot[1]=n[1],ot[2]=n.length===3?n[2]:0,e.geodesicDistance(it,ot,i)??Hn(it,ot,i))}}async function Te(){return Hr(await lo())}const it=m(),ot=m();function Ur(e){return e?.type==="graphic"}function uo(e){return e.find(Ur)??null}let N=class extends Zt.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:qo(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([h()],N.prototype,"activeComponent",void 0),c([h()],N.prototype,"cancelled",void 0),c([h()],N.prototype,"history",void 0),c([h()],N.prototype,"tool",null),c([h()],N.prototype,"type",void 0),c([h()],N.prototype,"canUndo",null),c([h()],N.prototype,"canRedo",null),c([h()],N.prototype,"onEnd",void 0),c([h()],N.prototype,"undo",null),c([h()],N.prototype,"redo",null),c([h()],N.prototype,"toggleTool",void 0),c([h()],N.prototype,"addToSelection",void 0),c([h()],N.prototype,"removeFromSelection",void 0),N=c([D("esri.widgets.Sketch.support.OperationHandle")],N);let Ut=class extends N{};c([h()],Ut.prototype,"activeComponent",void 0),Ut=c([D("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],Ut);let ve=class extends N{};c([h()],ve.prototype,"activeComponent",void 0),ve=c([D("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],ve);function Fr(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function Vr(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var Vn;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(Vn||(Vn={}));const yo={defaultZ:0},st={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:us},tool:"transform"};let E=class extends Zt.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new es,this._internalGraphicsLayer=new as({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Yn({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Zo({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Yo({color:[130,130,130,1],width:2}),this.meshSymbol=new Bo({symbolLayers:new Me([new Wo])}),this.updateGraphics=new Me,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new Yn({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new rn,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=yo,this.defaultUpdateOptions=st,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new P}initialize(){this.addHandles([Bn(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),Bn(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),Re(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},Ve),Re(()=>this.view,e=>{this._defaultSnappingManager=dt(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new te({view:e,options:this.snappingOptions})),e.type==="2d"?import("./editingTools-CdbicTj8.js"):e.type==="3d"&&(import("./ImageMaterial.glsl-BcRdUSpy.js").then(t=>t.e),import("./LineCallout.glsl-BTjZTDEb.js").then(t=>t.G)))},Ve),Re(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),Mi(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=dt(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,n=!t&&e&&"tooltip"in e?e.tooltip:null;return n?.visible?n:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...yo,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...st,...e,reshapeOptions:{...st.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...st.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=dt(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new te({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:i,map:o}=t;i&&(t.cursor=null),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const n="view-ready";this.removeHandles(n),e&&this.addHandles(Ko(()=>e.ready,i=>{this.removeHandles(this._viewHandlesKey),i&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},Ve),n),this._set("view",e)}cancel(){this._moduleLoaderAbortController=Bt(this._moduleLoaderAbortController),this._viewReadyAbortController=Bt(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:n,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:n})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:n,layer:i}=this;if(!n||this.state==="disabled")throw i||this._logMissingLayer(),Wn();if(n.activeTool!=null&&(n.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");sn(n,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void n.map.remove(this._internalGraphicsLayer);const s=()=>{if(o===this._operationHandle){const r=this.createGraphic,a=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||r==null||i.add(r),this._sketchContinuationFlag=!1,this.emit("create",{graphic:r,state:a?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),a||this._sketchContinuationFlag)return;const{creationMode:p}=this;if(p==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(Jn(this.create(e,t)))}else p==="update"&&r&&this._updatingHandles.addPromise(Jn(this.update([r])))}};o.on("complete",s),this._operationHandle=o,n.ready&&n.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:n,view:i,state:o}=this;if(!i||o==="disabled")throw n||this._logMissingLayer(),Wn();i.activeTool!=null&&(i.activeTool=null);const s=Array.isArray(e)?e:[e];if(e==null||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(a=>a.layer!==n?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):a.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const r=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||r==null||L(r)||(sn(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(r,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:r.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const n of e)n.geometry==null||n.geometry.type==="mesh"||Fe(n.geometry.spatialReference,t.spatialReference)||(is(n.geometry.spatialReference,t.spatialReference)||os()||await ss(),n.geometry=Wt(n.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(r=>{r.type!=="vector-tile"&&r.type!=="imagery"||o.push(r)});const s=await t.hitTest(e,{exclude:o});return uo(s.results)}const n=[t.map.ground];t.map.allLayers.forEach(o=>{$o(o.type)&&n.push(o)});const i=await t.hitTest(e,{exclude:n});if(i.results.length>0){const o=i.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(o.distance??0)>-Math.min(3*i.ground.distance,t.viewingMode==="global"?Jo(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const n=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!n&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},A.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit(ti(e)));let n=null;if(t!=null){const i=t.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(e.stopPropagation(),n=i):this.view?.type!=="2d"||this._isComponentGraphic(i)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();n==null||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const n=this.view;if(!n)return this._logMissingView(),null;const i={hasZ:n.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,n,i);return o==null?null:(n.tools.add(o),n.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,n){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:o,hasZ:s,geometryToPlace:r,graphicProperties:a,mode:p,preserveAspectRatio:l}=n,d=Fr(p,e),u=Vr(e),v=n?.optionsPerTool?.has(e)?n.optionsPerTool.get(e):{},y=v?.preserveAspectRatio??l??e!=="rectangle",f={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:i,defaultZ:o,forceUniformSize:y,graphicProperties:{...a,attributes:{...a?.attributes}},geometryToPlace:r,geometryType:u,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...v};return t.type==="2d"?this._makeDrawGraphicTool2D(f):this._makeDrawGraphicTool3D(f)}async _makeDrawGraphicTool2D(e){const[t,n,i]=await Promise.all([this._requireModule(import("./editingTools-CdbicTj8.js")),nt(),Te()]);return L(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:jr(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:i})}async _makeDrawGraphicTool3D(e){const[t,n,i]=await Promise.all([this._requireModule(import("./ImageMaterial.glsl-BcRdUSpy.js").then(s=>s.e)),nt(),Te()]);if(L(t)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:i})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let n=null;const i=e.forceUniformSize,o=e.centered,s=[t.on("key-down",a=>{if(a.key===G.pan)a.stopPropagation(),a.repeat||(e.enabled=!1);else if(a.key===G.complete)a.stopPropagation(),e.completeCreateOperation();else if(a.key!==G.vertexAdd||a.repeat)a.key===G.undo?(a.stopPropagation(),r.undo()):a.key===G.redo?(a.stopPropagation(),r.redo()):a.key!==G.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||a.repeat?a.key===G.center&&(a.repeat||(e.centered=!o,a.stopPropagation())):(e.forceUniformSize=!i,a.stopPropagation());else{const p=e.drawOperation.geometryType;p!=="polyline"&&p!=="polygon"&&p!=="multipoint"||(a.stopPropagation(),e.drawOperation.commitStagedVertex())}},A.WIDGET),t.on("key-up",a=>{a.key===G.pan?e.enabled=!0:a.key!==G.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?a.key===G.center&&(e.centered=o,a.stopPropagation()):(e.forceUniformSize=i,a.stopPropagation())},A.WIDGET),e.on("vertex-add",a=>{switch(n=n==null?"start":"active",a.operation){case"apply":this.emit("create",{graphic:e.graphic,state:n,tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",a=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:a.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",a=>{switch(a.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",a=>{this._set("createGraphic",a.graphic),n="complete",a.aborted?r&&r.cancel():r&&r.complete()}),Re(()=>this._getGraphicSymbolFromTool(e.geometryType),a=>{e.graphicSymbol=a})],r=new Ut({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{ie(s),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return r}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:n,view:i}=this;if(!i)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let s=o.tool??st.tool;for(const r of e)n.remove(r),n.add(r);if(i.type==="3d"){if(e.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(e,o,i,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,i);case"transform":return this._setupGraphicTransform3DOperation(e,o,i)}}switch(s){case"move":return this._setupMove2DOperation(e,o,i);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,s,o,i);case"transform":if(e.length===1){const r=e[0].geometry?.type;r!=="point"&&r!=="multipoint"||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,o,i)}}async _setupMove3DOperation(e,t,n,i,o=!1){const[s,r]=await Promise.all([this._requireModule(import("./ImageMaterial.glsl-BcRdUSpy.js").then(f=>f.e)),Te()]);if(L(s))return s;const{ManipulatedObject3DGraphic:a,MoveTool3D:p}=s.module,l=new Map,d=()=>{l.forEach(f=>f.destroy()),l.clear()};for(const f of e){const g=new a({view:n,graphic:f}),_=bi(g);if(_!==b.SUPPORTED)return d(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Ei(_)}).`),null;l.set(f,g)}const u=new p({view:n,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:r});n.tools.add(u),u.objects.addMany(Array.from(l.values())),o||this.updateGraphics.addMany(e);const v=[],y=new ve({activeComponent:u,tool:i,type:"update",onEnd:()=>{ie(v),zt(n,u),d()},undo:()=>{vo(this.view,u),Ft(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{Vt(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:f=>{this.updateGraphics.push(f);const g=new a({view:n,graphic:f});l.set(f,g),u.objects.push(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:f=>{const g=this.updateGraphics.indexOf(f);if(y.history.undo.forEach(M=>M.updates.splice(g,1)),y.history.redo.forEach(M=>M.updates.splice(g,1)),this.updateGraphics.remove(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void y.complete();const _=l.get(f);_&&(u.objects.remove(_),_.destroy(),l.delete(f))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||i!=="transform")return;const f=this.updateGraphics.at(0),g=await this._setupReshape3DOperation(f,t,n,!0);g&&!L(g)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(g,t))}});return v.push(...this._getHandlesForComponent(y,t),n.on("immediate-click",f=>this._getCommonUpdateOperationClickHandlers(y,f,t),A.WIDGET),n.on("key-down",f=>{this._getCommonUpdateOperationKeyDownHandlers(y,f)},A.WIDGET)),y}_setupGraphicTransform3DOperation(e,t,n,i=!1){if(e.length===1&&oa(e[0])===b.SUPPORTED){const o=e[0],s=o.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(o,t,n);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,n,i)}return this._setupMove3DOperation(e,t,n,"transform",i)}async _setupPointTransform3DOperation(e,t,n){const i="transform",{enableRotation:o,enableScaling:s,enableZ:r}=t,a=await this._requireModule(import("./ImageMaterial.glsl-BcRdUSpy.js").then(f=>f.e));if(L(a))return a;const{TransformTool3D:p,ManipulatedObject3DGraphic:l}=a.module,d=new l({graphic:e,view:n}),u=new p({object:d,view:n,enableRotation:o,enableScaling:s,enableZ:r,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(u),this.updateGraphics.add(e);const v=[],y=new ve({activeComponent:u,tool:i,type:"update",onEnd:()=>{ie(v),zt(n,u),d.destroy()},undo:()=>{vo(this.view,u),Ft(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{Vt(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async f=>{this.updateGraphics.add(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const g=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);L(g)||this._setUpdateOperationHandle(g,t)},removeFromSelection:f=>{this.updateGraphics.remove(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return v.push(...this._getHandlesForComponent(y,t),n.on("immediate-click",f=>this._getCommonUpdateOperationClickHandlers(y,f,t),A.WIDGET),n.on("key-down",f=>{this._getCommonUpdateOperationKeyDownHandlers(y,f)},A.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,n,i=!1){const o="transform",{enableRotation:s,enableScaling:r,enableZ:a,preserveAspectRatio:p}=t,[l,d]=await Promise.all([this._requireModule(import("./ImageMaterial.glsl-BcRdUSpy.js").then(S=>S.e)),Te()]);if(L(l))return l;const{ManipulatedObject3DGraphic:u,ExtentTransformTool:v}=l.module,y=this.view?.inputManager?.isModifierKeyDown(G.constraint),f=new u({view:n,graphic:e}),g=new v({object:f,view:n,enableRotation:s,enableScaling:r,enableZ:a,preserveAspectRatio:!!p!=!!y,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});n.tools.add(g),i||this.updateGraphics.add(e);const _=[],M=new ve({activeComponent:g,tool:o,type:"update",onEnd:()=>{ie(_),zt(n,g),f.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async S=>{this.updateGraphics.add(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[S],removed:[],type:"selection-change"},type:"update"}),M.onEnd(),M.destroy();const Oe=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);L(Oe)||this._setUpdateOperationHandle(Oe,t)},removeFromSelection:S=>{this.updateGraphics.remove(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[S],type:"selection-change"},type:"update"}),M.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const S=await this._setupReshape3DOperation(e,t,n,!0);S&&!L(S)&&(M.onEnd(),M.destroy(),this._setUpdateOperationHandle(S,t))}});return _.push(...this._getHandlesForComponent(M,t),n.on("immediate-click",S=>this._getCommonUpdateOperationClickHandlers(M,S,t),A.WIDGET),n.on("key-down",S=>this._getCommonUpdateOperationKeyDownHandlers(M,S),A.WIDGET),n.on("key-down",S=>{S.key!==G.constraint||S.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,S.stopPropagation())},A.WIDGET),n.on("key-up",S=>{S.key===G.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,S.stopPropagation())},A.WIDGET)),M}async _setupMove2DOperation(e,t,n){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,n);if(L(o))return o;const s=new ve({activeComponent:o,tool:i,type:"update",onEnd:()=>{this._displayDefaultCursor(),ie(p),ie(a),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const l=this.updateGraphics.toArray();Ft(s,l),s.refreshComponent(),this._emitUndoEvent({graphics:l,tool:i})},redo:()=>{const l=this.updateGraphics.toArray();Vt(s,l),s.refreshComponent(),this._emitRedoEvent({graphics:l,tool:i})},addToSelection:async l=>{await this._updatingHandles.addPromise(this._updateSpatialReference(l)),this.updateGraphics.push(l),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:l=>{const d=this.updateGraphics.indexOf(l);s.history.undo.forEach(v=>v.updates.splice(d,1)),s.history.redo.forEach(v=>v.updates.splice(d,1)),this.updateGraphics.remove(l);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=u:s.complete()}});let r=!1;const a=[n.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(s,l,t),A.WIDGET),n.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(s,l),l.key!==G.constraint||l.repeat||(r=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},A.WIDGET),n.on("key-up",l=>{l.key===G.constraint&&r&&(r=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},A.WIDGET)],p=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,n,i=!1){const o="reshape",[s,r,a]=await Promise.all([this._requireModule(import("./ImageMaterial.glsl-BcRdUSpy.js").then(_=>_.e)),nt(),Te()]);if(L(s))return s;const{ManipulatedObject3DGraphic:p,ReshapeTool3D:l}=s.module,d=new p({view:n,graphic:e}),u=na(d);if(u!==b.SUPPORTED)return d.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Ei(u)}).`),null;const v=t.reshapeOptions,y=new l({view:n,object:d,enableZVertex:t.enableZ&&v?.vertexOperation==="move",enableZShape:t.enableZ&&v?.shapeOperation==="move",enableMoveObject:v?.shapeOperation==="move"||v?.shapeOperation==="move-xy",enableMidpoints:v?.edgeOperation==="split",enableEdgeOffset:v?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:a});n.tools.add(y),i||this.updateGraphics.add(d.graphic);const f=[],g=new ve({activeComponent:y,tool:o,type:"update",onEnd:()=>{ie(f),zt(n,y),d.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const M=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);L(M)||this._setUpdateOperationHandle(M,t)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),g.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;g.onEnd(),g.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,n,!0);L(_)||this._setUpdateOperationHandle(_,t)}});return f.push(...this._getHandlesForComponent(g,t),n.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(g,_,t),A.WIDGET),n.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(g,_)},A.WIDGET)),g}async _setupTransformOrReshape2DOperation(e,t,n,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,n,i):await this._getReshape(e,n,i);if(L(o))return o;const s=new ve({activeComponent:o,type:"update",onEnd:()=>{ie(a),ie(r),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Ft(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{Vt(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async p=>{let l=s.activeComponent;if(l?.type==="reshape"){const d=[...this.updateGraphics,p];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const u=await this._setupTransformOrReshape2DOperation(d,"transform",n,i);if(L(u))return;this._setUpdateOperationHandle(u,n)}else this.updateGraphics.add(p),l.graphics=this.updateGraphics.toArray(),l.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async p=>{const l=this.updateGraphics.indexOf(p);s.history.undo.forEach(u=>u.updates.splice(l,1)),s.history.redo.forEach(u=>u.updates.splice(l,1)),this.updateGraphics.remove(p);const d=this.updateGraphics.toArray();if(d.length===0)s.complete();else{const u=d[0].geometry;d.length!==1||u==null||u.type!=="point"&&u.type!=="multipoint"?s.activeComponent.graphics=d:s.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const p=this.updateGraphics.at(0),l=p.geometry;if(l!=null&&(s.tool==="reshape"&&(l.type==="point"||l.type==="multipoint")||s.tool==="transform"&&l.type==="extent"))return;let d=null;s.tool==="transform"?d=await this._getReshape([p],n,i):s.tool==="reshape"&&(d=await this._getBox([p],n,i)),L(d)||(s.activeComponent?.destroy(),s.activeComponent=d,s.activeComponent&&(ie(a),a=this._getHandlesForComponent(s,n)))}}),r=[i.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(s,p,n),A.WIDGET),i.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,p),p.key===G.constraint&&!p.repeat&&s){const l=s.activeComponent;l&&l.type==="box"&&(l.preserveAspectRatio=!l.preserveAspectRatio)}},A.WIDGET),i.on("key-up",p=>{if(p.key===G.constraint&&s){const l=s.activeComponent;l&&l.type==="box"&&(l.preserveAspectRatio=!l.preserveAspectRatio)}},A.WIDGET)];let a=this._getHandlesForComponent(s,n);return s}async _getGraphicMover(e,t,n){const{enableMoveAllGraphics:i,highlightOptions:o}=t,s=await this._requireModule(import("./GraphicMover-DS6svxy2.js").then(r=>r.G));return L(s)?s:new s.module.default({enableMoveAllGraphics:i,highlightName:o?.name,highlightsEnabled:!!o?.enabled,indicatorsEnabled:!1,graphics:e,view:n,callbacks:{onGraphicMoveStart:({dx:r,dy:a,graphic:p})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:a,mover:p,type:"move-start"},type:"update"})},onGraphicMove:({dx:r,dy:a,graphic:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:a,mover:p,type:"move"},type:"update"}),onGraphicMoveStop:({dx:r,dy:a,graphic:p})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:a,mover:p,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayMoveCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,n){const{enableRotation:i,enableScaling:o,highlightOptions:s,preserveAspectRatio:r}=t,[a,p]=await Promise.all([this._requireModule(import("./Box-BeDVzr9M.js")),Te()]);if(L(a))return a;const l=this.view?.inputManager?.isModifierKeyDown(G.constraint);return new a.module.default({graphics:e,enableRotation:i,enableScaling:o,highlightName:s?.name,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!r!=!!l,layer:this._internalGraphicsLayer,view:n,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:p,callbacks:{onMoveStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onMove:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onMoveStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScaleStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScale:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScaleStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotateStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotate:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotateStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"})}})}async _getReshape(e,t,n){const{highlightOptions:i,reshapeOptions:o}=t,s=o?.edgeOperation==="split",r=o?.shapeOperation==="move",[a,p,l]=await Promise.all([this._requireModule(import("./Reshape-cC7Dm0pN.js")),nt(),Te()]);return L(a)?a:new a.module.default({enableMidpoints:s,enableMovement:r,graphic:e[0],highlightName:i?.name,highlightsEnabled:!!i?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:l,view:n,callbacks:{onReshapeStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshape:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshapeStop:({mover:d,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d,type:u},type:"update"}),onMoveStart:({dx:d,dy:u,mover:v,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:v,type:y},type:"update"}),onMove:({dx:d,dy:u,mover:v,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:v,type:y},type:"update"}),onMoveStop:({dx:d,dy:u,mover:v,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:v,type:y},type:"update"}),onVertexAdd:({added:d,type:u,vertices:v})=>{const y=d.map(f=>Kn(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:y,vertices:v,type:u},type:"update"})},onVertexRemove:({removed:d,type:u,vertices:v})=>{const y=d.map(f=>Kn(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:y,vertices:v,type:u},type:"update"})}}})}_getHandlesForComponent(e,t){const n=e.activeComponent;if(!n)return[];switch(n.type){case"graphic-mover":return[n.on("graphic-click",({graphic:i,viewEvent:o})=>{o.native?.shiftKey&&t.multipleSelectionEnabled&&(o.stopPropagation(),e.removeFromSelection(i))}),n.on("graphic-move-start",i=>e.addToHistory(Se(i.allGraphics)))];case"box":return[n.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),n.on("move-start",i=>e.addToHistory(Se(i.graphics))),n.on("rotate-start",i=>e.addToHistory(Se(i.graphics))),n.on("scale-start",i=>e.addToHistory(Se(i.graphics)))];case"reshape":return[n.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),n.on("move-start",i=>e.addToHistory(Se([i.mover]))),n.on("reshape-start",i=>e.addToHistory(Se([i.graphic]))),n.on("vertex-add",i=>e.addToHistory(Se([i.oldGraphic]))),n.on("vertex-remove",i=>e.addToHistory(Se([i.oldGraphic])))];case"move-3d":return[n.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),n.events.on("move-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-start"},type:"update"})}),n.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:i.dx,dy:i.dy,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move"},type:"update"})}),n.events.on("move-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-stop"},type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[n.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),n.events.on("translate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-start"},type:"update"})}),n.events.on("translate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-stop"},type:"update"})}),n.events.on("rotate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-start"},type:"update"})}),n.events.on("rotate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-stop"},type:"update"})}),n.events.on("scale-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-start"},type:"update"})}),n.events.on("scale-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-stop"},type:"update"})}),n.events.on("translate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move"},type:"update"})}),n.events.on("rotate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate"},type:"update"})}),n.events.on("scale",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale"},type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[n.events.on("reshape",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),n.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),n.events.on("vertex-add",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),n.events.on("vertex-remove",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,n){const{graphic:i,viewEvent:o}=n;return o.native?.shiftKey&&i.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const n=this.view?.map;this._disablePopup(t);const i=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),n&&n.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:s,toolEventInfo:null,type:"update"})}};e.on("complete",i)}async _getCommonUpdateOperationClickHandlers(e,t,n){const i=ti(t),o=await t.defer(()=>this._getFirstHit(i));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,n))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,n){const i=!!n.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!i||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const n=t.key;n===G.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):n===G.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):n===G.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&G.delete.includes(n)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,n=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||n.length===1&&n[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=dt(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayMoveCursor(){this.view?.container&&this.view.cursor!=="move"&&(this.view.cursor="move")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,n){jn.getLogger(this).error(new Xo(e,t,n))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const n=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:n}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return $n(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(Bt(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Qo($n(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",go("view"))}_logMissingLayer(){this._logError(zr,go("layer"))}};c([h()],E.prototype,"_defaultSnappingManager",void 0),c([h()],E.prototype,"updating",null),c([h({readOnly:!0})],E.prototype,"_updatingHandles",void 0),c([h()],E.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],E.prototype,"activeTool",null),c([h({readOnly:!0})],E.prototype,"activeCreateToolDrawMode",null),c([h()],E.prototype,"activeTooltip",null),c([h({types:ze})],E.prototype,"activeFillSymbol",void 0),c([h()],E.prototype,"activeLineSymbol",void 0),c([h()],E.prototype,"activeVertexSymbol",void 0),c([h()],E.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],E.prototype,"createGraphic",null),c([h()],E.prototype,"defaultCreateOptions",null),c([h()],E.prototype,"defaultUpdateOptions",null),c([h({type:St,nonNullable:!0})],E.prototype,"labelOptions",null),c([h()],E.prototype,"layer",void 0),c([h({types:ze})],E.prototype,"pointSymbol",void 0),c([h({types:ze})],E.prototype,"polygonSymbol",void 0),c([h({types:ze})],E.prototype,"polylineSymbol",void 0),c([h()],E.prototype,"meshSymbol",void 0),c([h({type:P,nonNullable:!0})],E.prototype,"snappingOptions",null),c([h()],E.prototype,"snappingManager",null),c([h({readOnly:!0})],E.prototype,"state",null),c([h({type:an,nonNullable:!0})],E.prototype,"tooltipOptions",null),c([h({readOnly:!0})],E.prototype,"updateGraphics",void 0),c([h()],E.prototype,"updateOnGraphicClick",void 0),c([h()],E.prototype,"creationMode",void 0),c([h({type:wt,nonNullable:!0})],E.prototype,"valueOptions",null),c([h({types:ze})],E.prototype,"vertexSymbol",void 0),c([h({value:null})],E.prototype,"view",null),c([h({constructOnly:!0,type:rn})],E.prototype,"sketchOptions",void 0),E=c([D("esri.widgets.Sketch.SketchViewModel")],E);const zr="sketch:missing-property",go=e=>`Property '${e}' is missing on SketchViewModel.`;function jr(e){return e==="polygon"||e==="rectangle"||e==="circle"}function Ft(e,t){fo("undo",e.history.undo,e.history.redo,t)}function Vt(e,t){fo("redo",e.history.redo,e.history.undo,t)}function fo(e,t,n,i){const o=t.pop();if(!o)return;const s=o.updates,r=[];i.forEach((a,p)=>{const l=s[p];l!=null&&("geometry"in l&&l.geometry!=null&&(r.push({geometry:a.geometry}),a.geometry=l.geometry),"symbol"in l&&l.symbol!=null&&(r.push({symbol:a.symbol}),a.symbol=l.symbol),"undo"in l&&(r.push(l),l[e](a)))}),n.push({updates:r})}function vo(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function Se(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function zt(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function L(e){return"requireError"in e&&e.requireError==="aborted"}export{Ie as $,aa as A,ra as B,hn as C,_a as D,Si as E,gi as F,O as G,to as H,wa as I,yn as J,tt as K,Ta as L,Js as M,pn as N,io as O,Xi as P,ee as Q,kr as R,eo as S,An as T,vi as U,H as V,on as W,rr as X,Te as Y,nt as Z,P as _,Xe as a,cn as a0,Be as a1,Zi as a2,bn as a3,Lt as a4,Ui as a5,yi as a6,Yi as a7,St as a8,K as a9,Mi as aa,co as ab,$s as ac,Sa as ad,Xs as ae,se as af,wt as ag,Vn as ah,uo as ai,oo as aj,ca as ak,ha as al,pa as am,q as an,bi as ao,b as ap,Dr as aq,ho as ar,Qe as b,V as c,ga as d,Ot as e,ln as f,$i as g,Ji as h,he as i,Le as j,E as k,rn as l,sa as m,Pn as n,Ea as o,Ke as p,x as q,Qi as r,la as s,sn as t,no as u,Ha as v,et as w,so as x,va as y,fa as z};
