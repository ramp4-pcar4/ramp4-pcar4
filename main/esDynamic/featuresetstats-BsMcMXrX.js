import{m}from"./TimeOnly-DMbsPjUX.js";import{x as p,l as u}from"./arcade-BNbfPFHY.js";import{n as l}from"./enum-BVcvu-V3.js";import{o as y,B as c,t as f,K as w,u as h,z as a,c as S}from"./Dictionary-BlU901XL.js";import{L as g,i as v}from"./WhereClause-BlCUGovw.js";import{eW as d,eU as x,eT as I}from"./main-6gYsRPh_.js";async function s(i,e,n,o){if(n.length===1){if(d(n[0]))return u(i,n[0],a(n[1],-1));if(f(n[0]))return u(i,n[0].toArray(),a(n[1],-1))}else if(n.length===2){if(d(n[0]))return u(i,n[0],a(n[1],-1));if(f(n[0]))return u(i,n[0].toArray(),a(n[1],-1));if(c(n[0])){const r=await n[0].load(),t=await A(g.create(n[1],{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}),o,e);return F(e,await n[0].calculateStatistic(i,t,a(n[2],1e3),e.abortSignal))}}else if(n.length===3&&c(n[0])){const r=await n[0].load(),t=await A(g.create(n[1],{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}),o,e);return F(e,await n[0].calculateStatistic(i,t,a(n[2],1e3),e.abortSignal))}return u(i,n,-1)}function F(i,e){return e instanceof v?m.fromReaderAsTimeStampOffset(e.toStorageFormat()):e instanceof Date?m.dateJSAndZoneToArcadeDate(e,S(i)):e}async function A(i,e,n){const o=i.getVariables();if(o.length>0){const r={};for(const t of o)r[t]=e.evaluateIdentifier(n,{name:t});i.parameters=r}return i}function T(i){i.mode==="async"&&(i.functions.stdev=function(e,n){return i.standardFunctionAsync(e,n,(o,r,t)=>s("stdev",e,t,i))},i.functions.variance=function(e,n){return i.standardFunctionAsync(e,n,(o,r,t)=>s("variance",e,t,i))},i.functions.average=function(e,n){return i.standardFunctionAsync(e,n,(o,r,t)=>s("mean",e,t,i))},i.functions.mean=function(e,n){return i.standardFunctionAsync(e,n,(o,r,t)=>s("mean",e,t,i))},i.functions.sum=function(e,n){return i.standardFunctionAsync(e,n,(o,r,t)=>s("sum",e,t,i))},i.functions.min=function(e,n){return i.standardFunctionAsync(e,n,(o,r,t)=>s("min",e,t,i))},i.functions.max=function(e,n){return i.standardFunctionAsync(e,n,(o,r,t)=>s("max",e,t,i))},i.functions.count=function(e,n){return i.standardFunctionAsync(e,n,async(o,r,t)=>{if(y(t,1,1,e,n),t[0]==null)return 0;if(c(t[0]))return t[0].count(o.abortSignal);if(d(t[0])||x(t[0]))return t[0].length;if(f(t[0]))return t[0].length();if(w(t[0]))return t[0].entryCount();throw new l(e,"InvalidParameter",n)})},i.functions.isempty=function(e,n){return i.standardFunctionAsync(e,n,async(o,r,t)=>{if(y(t,1,2,o,r),t.length>=2&&!I(t[1]))throw new l(o,"InvalidParameter",r);return a(t[1],!1)?c(t[0])?await t[0].isEmpty(o.abortSignal):p(t[0]):h(t[0])})})}export{T as registerFunctions};
