import{g1 as Z,i as _,bP as P,bA as k}from"./main-6gYsRPh_.js";import{m as j}from"./lengthUtils-BmHcUR6A.js";function D(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function x(e){return e!=null&&!isNaN(e)&&isFinite(e)}function M(e){return e.valueExpression?"expression":e.field&&typeof e.field=="string"?"field":"unknown"}function $(e,r){const n=r||M(e),i=e.valueUnit||"unknown";return n==="unknown"?"constant":e.stops?"stops":e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?"clamped-linear":i==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}const R=()=>_.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),g=e=>R().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),y=()=>R().error("Use of arcade expressions requires an arcade context"),C=new P,z=Math.PI,N=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function T(e,r,n){const i="visualVariables"in e?e.visualVariables?.find(c=>c.type==="color"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void g("ColorVariable");const l=typeof r=="number",t=l?null:r,s=t?.attributes;let o=l?r:null;const a=i.field,{ipData:u,hasExpression:v}=i.cache;let f=i.cache.compiledFunc;if(!a&&!v){const c=i.stops;return c&&c[0]&&c[0].color}if(typeof o!="number")if(v){if(n?.arcade==null)return void y();const c={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},d=n.arcade.arcadeUtils,h=d.getViewInfo(c),V=d.createExecContext(t,h,n.timeZone);if(!f){const w=d.createSyntaxTree(i.valueExpression);f=d.createFunction(w),i.cache.compiledFunc=f}o=d.executeFunction(f,V)}else s&&(o=s[a]);const p=i.normalizationField,m=s!=null&&p!=null?parseFloat(s[p]):void 0;if(o!=null&&(!p||l||!isNaN(m)&&m!==0)){x(m)&&!l&&(o/=m);const c=E(o,u);if(c){const d=c[0],h=c[1],V=d===h?i.stops[d].color:k.blendColors(i.stops[d].color,i.stops[h].color,c[2],n?.color);return new k(V)}}}function U(e,r,n){const i="visualVariables"in e?e.visualVariables?.find(c=>c.type==="opacity"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void g("OpacityVariable");const l=typeof r=="number",t=l?null:r,s=t?.attributes;let o=l?r:null;const a=i.field,{ipData:u,hasExpression:v}=i.cache;let f=i.cache.compiledFunc;if(!a&&!v){const c=i.stops;return c&&c[0]&&c[0].opacity}if(typeof o!="number")if(v){if(n?.arcade==null)return void y();const c={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},d=n.arcade.arcadeUtils,h=d.getViewInfo(c),V=d.createExecContext(t,h,n.timeZone);if(!f){const w=d.createSyntaxTree(i.valueExpression);f=d.createFunction(w),i.cache.compiledFunc=f}o=d.executeFunction(f,V)}else s&&(o=s[a]);const p=i.normalizationField,m=s!=null&&p!=null?parseFloat(s[p]):void 0;if(o!=null&&(!p||l||!isNaN(m)&&m!==0)){x(m)&&!l&&(o/=m);const c=E(o,u);if(c){const d=c[0],h=c[1];if(d===h)return i.stops[d].opacity;{const V=i.stops[d].opacity;return V+(i.stops[h].opacity-V)*c[2]}}}}function F(e,r,n){const i="visualVariables"in e?e.visualVariables?.find(m=>m.type==="rotation"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void g("RotationVariable");const l=i.axis||"heading",t=l==="heading"&&i.rotationType==="arithmetic"?90:0,s=l==="heading"&&i.rotationType==="arithmetic"?-1:1,o=typeof r=="number"?null:r,a=o?.attributes,u=i.field,{hasExpression:v}=i.cache;let f=i.cache.compiledFunc,p=null;if(!u&&!v)return p;if(v){if(n?.arcade==null)return void y();const m={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},c=n.arcade.arcadeUtils,d=c.getViewInfo(m),h=c.createExecContext(o,d,n.timeZone);if(!f){const V=c.createSyntaxTree(i.valueExpression);f=c.createFunction(V),i.cache.compiledFunc=f}p=c.executeFunction(f,h)}else a&&(p=a[u]);return p=typeof p!="number"||isNaN(p)?null:t+s*p,p}function B(e,r,n){const i=typeof r=="number",l=i?null:r,t=l?.attributes;let s=i?r:null;const{isScaleDriven:o}=e.cache;let a=e.cache.compiledFunc;if(o){const v=n?.scale,f=n?.view;s=v==null||f==="3d"?L(e):v}else if(!i)switch(e.inputValueType){case"expression":{if(n?.arcade==null)return void y();const v={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},f=n.arcade.arcadeUtils,p=f.getViewInfo(v),m=f.createExecContext(l,p,n.timeZone);if(!a){const c=f.createSyntaxTree(e.valueExpression);a=f.createFunction(c),e.cache.compiledFunc=a}s=f.executeFunction(a,m);break}case"field":t&&(s=t[e.field]);break;case"unknown":s=null}if(!x(s))return null;if(i||!e.normalizationField)return s;const u=t?parseFloat(t[e.normalizationField]):null;return x(u)&&u!==0?s/u:null}function L(e){let r=null,n=null;const i=e.stops;return i?(r=i[0].value,n=i[i.length-1].value):(r=e.minDataValue||0,n=e.maxDataValue||0),(r+n)/2}function S(e,r,n){const i="visualVariables"in e?e.visualVariables?.find(t=>t.type==="size"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void g("SizeVariable");const l=O(B(i,r,n),i,r,n,i.cache.ipData);return l==null||isNaN(l)?void 0:l}function b(e,r,n){return e==null?null:D(e)?S(e,r,n):x(e)?e:null}function q(e,r,n){return x(n)&&e>n?n:x(r)&&e<r?r:e}function G(e,r,n,i){const l=b(r.minSize,n,i)||r.minDataValue;return e==null&&l==null?null:(e??0)+(l??0)}function H(e,r,n){const i=e.stops;let l=i?.length&&i[0].size;return l==null&&(l=e.minSize),b(l,r,n)}function J(e,r,n,i){const l=b(r.minSize,n,i);if(e==null)return l;const{minDataValue:t,maxDataValue:s}=r;if(t==null||s==null)return null;const o=(e-t)/(s-t),a=b(r.maxSize,n,i),u=i?.shape;if(e<=t)return l;if(e>=s)return a;if(l==null||a==null)return null;if(r.scaleBy==="area"&&u){const v=u==="circle",f=v?z*(l/2)**2:l*l,p=f+o*((v?z*(a/2)**2:a*a)-f);return v?2*Math.sqrt(p/z):Math.sqrt(p)}return l+o*(a-l)}function K(e,r,n,i){const l=b(r.minSize,n,i);if(e==null||l==null)return l;const t=i?.shape,{minDataValue:s}=r;if(s==null)return null;const o=e/s,a=b(r.maxSize,n,i);let u=null;return u=t==="circle"?2*Math.sqrt(o*(l/2)**2):t==="square"||t==="diamond"||t==="image"?Math.sqrt(o*l**2):o*l,q(u,l,a)}function Q(e,r,n,i,l){if(e==null)return null;const[t,s,o]=E(e,l);if(t===s)return b(r.stops?.[t].size,n,i);{const a=b(r.stops?.[t].size,n,i),u=b(r.stops?.[s].size,n,i);return a==null||u==null?null:a+(u-a)*o}}function W(e,r,n,i){const l=(i?.resolution??1)*j[r.valueUnit],t=b(r.minSize,n,i),s=b(r.maxSize,n,i),{valueRepresentation:o}=r;if(e==null)return t;let a=null;return a=o==="area"?2*Math.sqrt(e/z)/l:o==="radius"||o==="distance"?2*e/l:e/l,q(a,t,s)}function O(e,r,n,i,l){switch(r.transformationType){case"additive":return G(e,r,n,i);case"constant":return H(r,n,i);case"clamped-linear":return J(e,r,n,i);case"proportional":return K(e,r,n,i);case"stops":return Q(e,r,n,i,l);case"real-world-size":return W(e,r,n,i);case"identity":return e;case"unknown":return null}}function X(e,r,n){const{isScaleDriven:i}=e.cache;if(!(i&&n==="3d"||r))return null;const l={scale:r,view:n};let t=b(e.minSize,C,l),s=b(e.maxSize,C,l);if(t!=null||s!=null){if(t>s){const o=s;s=t,t=o}return{minSize:t,maxSize:s}}}function I(e,r,n){if(!e.visualVariables)return;const i=[],l=[],t=[],s=[],o=[];for(const a of e.visualVariables)switch(a.type){case"color":l.push(a);break;case"opacity":t.push(a);break;case"rotation":o.push(a);break;case"size":s.push(a)}return l.forEach(a=>{const u=T(a,r,n);i.push({variable:a,value:u})}),t.forEach(a=>{const u=U(a,r,n);i.push({variable:a,value:u})}),o.forEach(a=>{const u=F(a,r,n);i.push({variable:a,value:u})}),s.forEach(a=>{const u=S(a,r,n);i.push({variable:a,value:u})}),i}function E(e,r){if(!r)return;let n=0,i=r.length-1;return r.some((l,t)=>e<l?(i=t,!0):(n=t,!1)),[n,i,(e-r[n])/(r[i]-r[n])]}function A(e,r,n){const i=["proportional","proportional","proportional"];for(const l of e){const t=l.useSymbolValue?"symbol-value":S(l,r,n)??"proportional";switch(l.axis){case"width":i[0]=t;break;case"depth":i[1]=t;break;case"height":i[2]=t;break;case"width-and-depth":i[0]=t,i[1]=t;break;case"all":case void 0:case null:i[0]=t,i[1]=t,i[2]=t;break;default:Z(l.axis)}}return i}const Y=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:A,getColor:T,getOpacity:U,getRotationAngle:F,getSize:S,getSizeForValue:O,getSizeFromNumberOrVariable:b,getSizeRangeAtScale:X,getVisualVariableValues:I,viewScaleRE:N},Symbol.toStringTag,{value:"Module"}));export{I as D,A as U,M as i,$ as l,F as m,D as n,N as p,Y as v};
