{"version":3,"file":"query-BToHWxlm.js","sources":["../../node_modules/@arcgis/core/rest/operations/urlUtils.js","../../node_modules/@arcgis/core/rest/query/operations/queryUtils.js","../../node_modules/@arcgis/core/rest/query/operations/query.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nfunction t(n){const o={};for(const e in n){if(\"declaredClass\"===e)continue;const r=n[e];if(null!=r&&\"function\"!=typeof r)if(Array.isArray(r)){o[e]=[];for(let n=0;n<r.length;n++)o[e][n]=t(r[n])}else\"object\"==typeof r?r.toJSON&&(o[e]=JSON.stringify(r)):o[e]=r}return o}export{t as mapParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{getJsonType as e}from\"../../../geometry/support/jsonUtils.js\";import{srToRESTValue as t}from\"../../../geometry/support/spatialReferenceUtils.js\";function i(e,t){if(t&&\"extent\"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&\"point\"===e.type)return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function r(r,n,a){const{geometry:l}=r,s=r.compactGeometryEnabled??!1,o=r.toJSON();delete o.compactGeometryEnabled,delete o.defaultSpatialReferenceEnabled;const u=o;let d,c,y;if(l&&(c=l.spatialReference,y=t(c),u.geometryType=e(l),u.geometry=i(l,s),u.inSR=y),o.groupByFieldsForStatistics&&(u.groupByFieldsForStatistics=o.groupByFieldsForStatistics.join(\",\")),o.objectIds)switch(a?.uniqueIdFields?.length){case void 0:u.objectIds=o.objectIds.join(\",\");break;case 1:u.uniqueIds=JSON.stringify(o.objectIds),delete u.objectIds;break;default:u.uniqueIds=JSON.stringify(o.objectIds.map(e=>JSON.parse(e))),delete u.objectIds}if(o.orderByFields&&(u.orderByFields=o.orderByFields.join(\",\")),!o.outFields||!o.returnDistinctValues&&(n?.returnCountOnly||n?.returnExtentOnly||n?.returnIdsOnly)?delete u.outFields:o.outFields.includes(\"*\")?u.outFields=\"*\":u.outFields=o.outFields.join(\",\"),o.outSR?(u.outSR=t(o.outSR),d=r.outSpatialReference):l&&(o.returnGeometry||o.returnCentroid)&&(u.outSR=u.inSR,d=c),o.returnGeometry&&delete o.returnGeometry,o.outStatistics&&(u.outStatistics=JSON.stringify(o.outStatistics)),o.fullText&&(u.fullText=JSON.stringify(o.fullText)),o.pixelSize&&(u.pixelSize=JSON.stringify(o.pixelSize)),o.quantizationParameters&&(r.defaultSpatialReferenceEnabled&&null!=c&&null!=r.quantizationParameters?.extent&&c.equals(r.quantizationParameters.extent.spatialReference)&&delete o.quantizationParameters.extent.spatialReference,u.quantizationParameters=JSON.stringify(o.quantizationParameters)),o.parameterValues&&(u.parameterValues=JSON.stringify(o.parameterValues)),o.rangeValues&&(u.rangeValues=JSON.stringify(o.rangeValues)),o.dynamicDataSource&&(u.layer=JSON.stringify({source:o.dynamicDataSource}),delete o.dynamicDataSource),o.timeExtent){const e=o.timeExtent,{start:t,end:i}=e;null==t&&null==i||(u.time=t===i?t:`${t??\"null\"},${i??\"null\"}`),delete o.timeExtent}return r.defaultSpatialReferenceEnabled&&null!=c&&null!=d&&c.equals(d)&&(u.defaultSR=u.inSR,delete u.inSR,delete u.outSR),u}export{i as encodeGeometry,r as queryLikeToQueryStringParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport t from\"../../../request.js\";import{urlToObject as r,join as n}from\"../../../core/urlUtils.js\";import{normalizeCentralMeridian as e}from\"../../../geometry/support/normalizeUtils.js\";import{mapParameters as o}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as u}from\"./pbfQueryUtils.js\";import{queryLikeToQueryStringParameters as s}from\"./queryUtils.js\";import{applyFeatureSetZUnitScaling as i}from\"./queryZScale.js\";const a=\"Layer does not support extent calculation.\";function l(t,r,n){return s(t,r,n)}async function y(t,r,n,e,o){const u=r.timeExtent?.isEmpty?{data:{features:[]}}:await j(t,r,\"json\",e,void 0,o);return i(r,n,u.data),u}async function f(t,r,n,e,o){if(r.timeExtent?.isEmpty)return{data:n.createFeatureResult()};const s=await c(t,r,e,o),i=s;return i.data=u(s.data,n),i}function c(t,r,n,e){return j(t,r,\"pbf\",n,void 0,e)}function m(t,r,n,e){return r.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):j(t,r,\"json\",n,{returnIdsOnly:!0},e)}function p(t,r,n,e){return r.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):j(t,r,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0},e)}async function d(t,r,n){if(r.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const e=await j(t,r,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}),o=e.data;if(o.hasOwnProperty(\"extent\"))return e;if(o.features)throw new Error(a);if(o.hasOwnProperty(\"count\"))throw new Error(a);return e}function O(t,r){if(!t.returnIdsOnly||!r.uniqueIdFields)return t;const n={...t,returnUniqueIdsOnly:!0};return delete n.returnIdsOnly,n}async function j(u,s,i,a={},y={},f={}){const c=\"string\"==typeof u?r(u):u,m=s.geometry?[s.geometry]:[],p=await e(m,null,{signal:a.signal}),d=p?.[0];null!=d&&((s=s.clone()).geometry=d);const j=o({...c.query,f:i,...O(y,f),...l(s,y,f)});return t(n(c.path,E(s,y)?\"query3d\":\"query\"),{...a,responseType:\"pbf\"===i?\"array-buffer\":\"json\",query:{...j,...a.query}})}function E(t,r){return null!=t.formatOf3DObjects&&!(r.returnCountOnly||r.returnExtentOnly||r.returnIdsOnly)}export{y as executeQuery,p as executeQueryForCount,d as executeQueryForExtent,m as executeQueryForIds,f as executeQueryPBF,c as executeQueryPBFBuffer,l as queryToQueryStringParameters,j as runQuery};\n"],"names":["t","n","o","e","r","i","l","s","u","d","c","y","a","j","f","m","p","O","E"],"mappings":"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","x_google_ignoreList":[0,1,2]}