{"version":3,"file":"previewCIMSymbol-AtPP6LHb.js","sources":["../../node_modules/@arcgis/core/symbols/support/previewCIMSymbol.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{pt2px as e,px2pt as t}from\"../../core/screenUtils.js\";import{CIMSymbolHelper as i}from\"../cim/CIMSymbolHelper.js\";import{CIMSymbolRasterizer as o}from\"../cim/CIMSymbolRasterizer.js\";import{OverrideHelper as l}from\"../cim/OverrideHelper.js\";import{mapCIMSymbolToGeometryType as r}from\"../cim/utils.js\";import{SymbolSizeDefaults as n}from\"./previewUtils.js\";import{renderSymbol as a}from\"./renderUtils.js\";const s=new o(null),m=t(n.size),h=t(n.maxSize),c=t(n.lineWidth),y=1;async function u(e,t,i){const o=t?.size;let l=null!=o&&\"object\"==typeof o&&\"width\"in o?o.width:o,r=null!=o&&\"object\"==typeof o&&\"height\"in o?o.height:o;if(!l||!r)if(\"esriGeometryPolygon\"===i)l=r=t.maxSize?Math.min(t.maxSize,m):m;else{const o=await g(e,t,i);o&&(l=o.width,r=o.height),\"esriGeometryPolyline\"===i&&(l=t.maxSize?Math.min(t.maxSize,c):c),l=null!=l&&isFinite(l)?Math.min(l,h):m,r=null!=r&&isFinite(r)?Math.max(Math.min(r,h),y):m}return\"legend\"===t.style&&\"esriGeometryPolyline\"===i&&(l=c),{width:l,height:r}}async function g(e,t={},o){const n=t.cimOptions||t;o??=n.geometryType||r(e?.data?.symbol);const{feature:a,fieldMap:m,viewParams:h}=n,c=await l.resolveSymbolOverrides(e.data,a,null,m,o,null,h);if(!c)return null;(e=e.clone()).data={type:\"CIMSymbolReference\",symbol:c},e.data.primitiveOverrides=void 0;const y=[];return i.fetchResources(c,s.resourceManager,y),i.fetchFonts(c,s.resourceManager,y),y.length>0&&await Promise.all(y),i.getEnvelope(c,null,s.resourceManager)}async function d(i,o={}){const{node:l,opacity:n,symbolConfig:m}=o,h=null!=m&&\"object\"==typeof m&&\"isSquareFill\"in m&&m.isSquareFill,c=o.cimOptions||o,y=c.geometryType||r(i?.data?.symbol),g=await u(i,o,y),{feature:d,fieldMap:f}=c,p=o?.geometry||h||\"esriGeometryPolygon\"!==y?\"preview\":\"legend\";let w=g;const b=g;if(o?.geometry&&(\"esriGeometryPolygon\"===y||\"esriGeometryPolyline\"===y)){const i=200;if(e(g.width)<i||e(g.height)<i){const e=g.width>g.height?t(i)*g.height/g.width:t(i);w={width:g.width>g.height?t(i):t(i)*g.width/g.height,height:e}}}const M=await s.rasterizeCIMSymbolAsync(i,d,w,p,f,y,null,c.viewParams,c.allowScalingUp,o?.geometry?.toJSON());if(!M)return null;const{width:S,height:v}=M,j=document.createElement(\"canvas\");j.width=S,j.height=v;j.getContext(\"2d\").putImageData(M,0,0);const x=e(b.width),z=e(b.height),P=new Image(x,z);P.src=j.toDataURL(),P.ariaLabel=o.ariaLabel??null,P.alt=o.ariaLabel??\"\",null!=n&&(P.style.opacity=`${n}`);let C=P;if(null!=o.effectView){const e={shape:{type:\"image\",x:0,y:0,width:x,height:z,src:P.src},fill:null,stroke:null,offset:[0,0]};C=a([[e]],[x,z],o)}return l&&C&&l.appendChild(C),C}export{g as getCIMSymbolPreviewSize,d as previewCIMSymbol};\n"],"names":["s","o","m","t","n","h","c","y","u","e","i","l","r","g","a","d","f","p","w","b","M","S","v","j","x","z","P","C"],"mappings":"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","x_google_ignoreList":[0]}