const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./geometryServiceUtils-CGy901Zq.js","./main-CtmwM019.js","./preload-helper-DMGCcr4D.js","./main-DZFs8ecF.css","./project-1w0mmGx6.js","./utils-PyBYdGi0.js","./utils-CjyZX5Fj.js"])))=>i.map(i=>d[i]);
import{s,p as w,aa as v}from"./main-CtmwM019.js";import{m as u}from"./HeightModelInfo-4xHEEYmq.js";import{_ as b}from"./preload-helper-DMGCcr4D.js";import{H as M,W as I,G as k,J as $,L as R}from"./projectionUtils-DKBF6_Ma.js";function z(e,t,o){const a=H(e),r=t,f=U(a,r,o);if(a){const n=u.deriveUnitFromSR(a,e.spatialReference).heightUnit;if(!o&&n!==a.heightUnit){const i=new s("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${n})`,{horizontalUnit:n});return new s("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:a,error:i})}}if(!T(e)||f===4)return new s("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:a});switch(f){case 1:{const n=a?.heightUnit||"unknown",i=r?.heightUnit||"unknown",c=new s("layerview:incompatible-height-unit",`The vertical units of the layer (${n}) must match the vertical units of the scene (${i})`,{layerUnit:n,sceneUnit:i});return new s("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:r,error:c})}case 2:{const n=a?.heightModel||"unknown",i=r?.heightModel||"unknown",c=new s("layerview:incompatible-height-model",`The height model of the layer (${n}) must match the height model of the scene (${i})`,{layerHeightModel:n,sceneHeightModel:i});return new s("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:r,error:c})}case 3:{const n=a?.vertCRS||"unknown",i=r?.vertCRS||"unknown",c=new s("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${n}) must match the vertical datum of the scene (${i})`,{layerDatum:n,sceneDatum:i});return new s("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:r,error:c})}}return null}function U(e,t,o){if(!g(e)||!g(t))return 4;if(e==null||t==null)return 0;if(!o&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}function g(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function T(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!p(e)}function H(e){if(e.type==="integrated-mesh-3dtiles"||e.type==="gaussian-splat")return null;const t=e.url?w(e.url):void 0;return!(e.spatialReference?.vcsWkid==null&&t!=null&&t.serverType==="ImageServer")&&d(e)&&e.heightModelInfo?e.heightModelInfo:p(e)?u.deriveUnitFromSR(_,e.spatialReference):null}function d(e){return"heightModelInfo"in e}function m(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function p(e){return m(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):y(e)}function E(e){return e.layers!=null||y(e)||m(e)||d(e)}function y(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"gaussian-splat":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const _=new u({heightModel:"gravity-related-height"});let h,l=null;async function S(e){l||(l=b(()=>import("./geometryServiceUtils-CGy901Zq.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(t=>h=t)),await l,v(e)}async function C(e,t,o,a){if(!e)return null;const r=e.spatialReference;return k()||$(r,t)?I(e,t):h?h.projectGeometry(e,t,o,a):(await Promise.race([S(a),R(a)]),C(e,t,o,a))}async function F(e,t){try{return e?.spatialReference?await M(e,t):null}catch{return null}}export{z as a,H as c,E as g,F as p,C as s};
