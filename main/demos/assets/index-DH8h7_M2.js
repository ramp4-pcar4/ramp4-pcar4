import{fy as A,F as x,fA as B,fN as R,as as u,fC as g,fS as T,fP as P,fR as M,fX as m,fT as k,eb as z,ec as H,ed as h,fD as N,iJ as O,iK as D,fK as V,fG as F,ea as G}from"./main-CtmwM019.js";import"./preload-helper-DMGCcr4D.js";const W={class:"swipe-container"},q=["id","aria-valuenow","aria-label","content"],K=["swipe-position","view"],U=A({__name:"swipe",props:{fixture:{type:x,required:!0},message:String},setup(y){const n=T("iApi"),d=B(),i=R("slider"),p=u(45),v=u(0),c=u(0),L=u(50),w=u(),a=u(),C=g(()=>{const r=30+c.value-c.value,s=i.value?.getBoundingClientRect()?i.value?.getBoundingClientRect().right-i.value?.getBoundingClientRect().left:0,t=+p.value/90,e=(s-r)*t,f=(i.value?.getBoundingClientRect().x??0)+e+(r-5.25)/2;return L.value=f/n.$rootEl.clientWidth*100+.2,`${f}px`}),S=g(()=>`${v.value}px`),$=g(()=>`${-v.value/2-18}px`),E=y;P(()=>{v.value=n.$rootEl?.clientHeight??1200});const _=()=>{v.value=n.$rootEl?.clientHeight??v.value,c.value++,setTimeout(()=>{c.value++},50)},o=()=>{d.setOpacity(.1),i.value.style.background=""},l=()=>{d.setOpacity(1),i.value.style.background="inherit"};M(async()=>{"ontouchstart"in document.documentElement||!window.matchMedia("(pointer:fine)").matches||(i.value.style.background="inherit"),window.addEventListener("resize",_),i.value?.addEventListener("focus",o),i.value?.addEventListener("blur",l),i.value?.addEventListener("mouseover",o),i.value?.addEventListener("mouseleave",l),i.value?.addEventListener("touchstart",o),i.value?.addEventListener("touchend",l),setTimeout(()=>{c.value++},50),await b();const s=()=>{const t=a.value?.querySelector(".arcgis-swipe__container");return t?(t.removeAttribute("tabindex"),!0):!1};if(!s()){const t=new MutationObserver((e,f)=>{s()&&f.disconnect()});t.observe(a.value,{childList:!0,subtree:!0,attributes:!1}),setTimeout(()=>t.disconnect(),5e3)}n.event.on(m.MAP_BASEMAPCHANGE,async t=>{t.schemaChanged&&(a.value?.trailingLayers.forEach(e=>{a.value?.trailingLayers.remove(e)}),a.value?.leadingLayers.forEach(e=>{a.value?.leadingLayers.remove(e)}),await b())}),n.event.on(m.LAYER_RELOAD_END,t=>{a.value?.trailingLayers.forEach(e=>{e.id===t.id&&(a.value?.trailingLayers.remove(e),a.value?.trailingLayers.add(t.esriLayer))}),a.value?.leadingLayers.forEach(e=>{e.id===t.id&&(a.value?.leadingLayers.remove(e),a.value?.leadingLayers.add(t.esriLayer))})}),n.event.on(m.LAYER_REMOVE,t=>{a.value?.trailingLayers.forEach(e=>{e.id===t.id&&a.value?.trailingLayers.remove(e)}),a.value?.leadingLayers.forEach(e=>{e.id===t.id&&a.value?.leadingLayers.remove(e)})})});const b=async()=>{await n.geo.map.viewPromise,w.value=n.geo.map.esriView;const r=E.fixture.trailing,s=E.fixture.leading;r.forEach(t=>{n.geo.layer.awaitLayer(t,!0).then(e=>{e.esriLayer?a.value?.trailingLayers.add(e.esriLayer):console.warn(`Invalid layer instance: ${t}`)})}),s.forEach(t=>{n.geo.layer.awaitLayer(t,!0).then(e=>{e.esriLayer?a.value?.leadingLayers.add(e.esriLayer):console.warn(`Invalid layer instance: ${t}`)})})};return k(()=>{window.removeEventListener("resize",_),i.value?.removeEventListener("focus",()=>o),i.value?.removeEventListener("blur",()=>l),i.value?.removeEventListener("mouseover",o),i.value?.removeEventListener("mouseleave",l),i.value?.removeEventListener("touchstart",o),i.value?.removeEventListener("touchend",l)}),(r,s)=>{const t=V("tippy");return H(),z("div",W,[h("div",{class:"verticalLine",style:O({left:C.value,height:S.value,bottom:$.value})},null,4),N(h("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>p.value=e),id:"layerSlider"+F(n).$element._uid,class:"layerSliderElement",type:"range",ref_key:"slider",ref:i,min:"0","aria-valuemin":"0","aria-valuemax":"90","aria-valuenow":p.value,"aria-label":r.$t("map.layerSwipe.label"),max:"90",step:"0.5",content:r.$t("map.layerSwipe.drag"),style:{"z-index":10}},null,8,q),[[D,p.value],[t,{followCursor:!0,trigger:"mouseenter"}]]),h("arcgis-swipe",{direction:"horizontal","swipe-position":L.value,view:w.value,"auto-destroy-disable":"",ref_key:"swipeComponent",ref:a},null,8,K)])}}}),Y=G(U,[["__scopeId","data-v-f9152f16"]]);class X extends x{_parseConfig(n){this.leading=n?.leading??[],this.trailing=n?.trailing??[]}leading=[];trailing=[];async added(){this._parseConfig(this.config);const{el:n,destroy:d}=this.mount(Y,{app:this.$element,props:{fixture:this}});n.childNodes[0]&&this.$vApp.$el.appendChild(n.childNodes[0]),this.removed=()=>{d()}}}export{X as default};
