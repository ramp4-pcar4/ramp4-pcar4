import{fy as G,as as b,fR as re,eb as a,ec as s,ed as g,fU as N,fJ as Q,fI as Y,iJ as ge,fL as Z,fM as j,ea as ue,im as ee,fC as w,fK as q,fD as A,ir as he,fZ as ne,fz as K,lx as ce,fP as te,fQ as V,fT as se,fG as L,fE as J,fS as le,kS as _e,jp as ie,m7 as Me,lC as me,iD as Ee,m8 as Ce,fX as X,fV as oe,fH as pe,fF as De}from"./main-CtmwM019.js";import{T as Se}from"./toggle-switch-control-Dg618cgT.js";import"./preload-helper-DMGCcr4D.js";const ze={key:0,class:"relative"},He={key:0,class:"relative"},je=["innerHTML"],Ne=["src"],Be={key:1,class:"w-32 h-32"},Oe={class:"symbologyIcon"},Ae=["innerHTML"],qe=["src"],Fe={class:"badge z-50 rounded-full text-white absolute h-10 w-10 p-8 inline-flex items-center justify-center"},Pe={key:0,class:"px-5"},Ge={key:1,class:"inline-flex justify-center items-center relative"},Ue=G({__name:"symbology-stack",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0}},setup(f){const I=f,l=b([]);return re(()=>{l.value=I.layer.legend}),(v,y)=>f.result.loaded?(s(),a("div",ze,[g("div",{class:Z(f.result.items.length===0?"opacity-50":"")},[l.value.length>1?(s(),a("div",He,[(s(!0),a(Q,null,Y(l.value.slice(0,3).reverse(),(h,m)=>(s(),a("div",{class:Z(["absolute",[m==0?"symbol-0":m==1?"left-3":"left-6"]]),style:ge({"z-index":3-m}),key:m},[l.value[m].svgcode?(s(),a("span",{key:0,class:"symbologyIcon w-28 h-28",innerHTML:l.value[m].svgcode},null,8,je)):l.value[m].imgUrl?(s(),a("img",{key:1,class:"symbologyIcon w-28 h-28",src:l.value[m].imgUrl},null,8,Ne)):N("",!0)],6))),128))])):l.value.length>0?(s(),a("div",Be,[g("div",Oe,[l.value[0].svgcode?(s(),a("span",{key:0,innerHTML:l.value[0].svgcode},null,8,Ae)):l.value[0].imgUrl?(s(),a("img",{key:1,class:"symbologyIcon w-full h-full",src:l.value[0].imgUrl},null,8,qe)):N("",!0)])])):N("",!0)],2),g("div",Fe,[f.result.loaded?(s(),a("div",Pe,j(f.result.items.length),1)):N("",!0)])])):(s(),a("div",Ge,y[0]||(y[0]=[g("div",{class:"symbologyIcon h-32 w-32"},[g("div",{class:"relative animate-spin spinner h-24 w-24"})],-1)])))}}),Re=ue(Ue,[["__scopeId","data-v-e0b0309a"]]),Ve=["content"],Ze={class:"symbologyLayerName truncate"},Je=G({__name:"symbology-item",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0},selected:{type:Boolean,required:!0}},setup(f){const I=ee(),l=w(()=>I.properties),v=f,y=()=>{const h=v.layer;return h&&l.value[h.id]&&l.value[h.id].name?l.value[h.id].name:h?.name??""};return(h,m)=>{const S=q("tippy");return A((s(),a("button",{class:Z(["flex flex-grow justify-start items-center px-7 py-10 default-focus-style symbologyStackButton truncate",f.selected?"detailsButtonSelected":"px-11"]),onClick:m[0]||(m[0]=he(()=>{},["stop"])),content:y()},[ne(Re,{class:"symbStack w-32 h-32 mr-10",layer:f.layer,result:f.result},null,8,["layer","result"]),g("div",Ze,j(y()),1)],10,Ve)),[[S,{placement:"right",sticky:!0}]])}}}),Ke=["content"],Qe=G({__name:"symbology-list",props:{results:{type:Object,required:!0},selected:{type:String,required:!0}},emits:["selection-changed"],setup(f,{emit:I}){const{t:l}=K(),v=ce(),y=b(),h=()=>{y.value._tippy.hide()},m=r=>{r.key==="Tab"&&y.value?.matches(":focus")&&y.value._tippy.show()},S=I,D=f,e=b(""),u=b([]),o=b(!1),i=b(!1),p=r=>v.getLayerByUid(r),c=r=>{e.value=r,S("selection-changed",r),o.value=!1},_=()=>{i.value||setTimeout(()=>{o.value=i.value},500),i.value=!0},B=()=>{o.value=i.value=!1},z=()=>{i.value||(o.value=!0),i.value=!0},H=()=>{o.value=i.value=!1};return te(()=>{u.value.push(V(D,()=>{e.value=D.selected}))}),re(()=>{y.value?.addEventListener("blur",h),y.value?.addEventListener("keyup",m)}),se(()=>{u.value.forEach(r=>r()),y.value?.removeEventListener("blur",h),y.value?.removeEventListener("keyup",m)}),(r,T)=>{const $=q("focus-item"),F=q("focus-list"),M=q("tippy");return A((s(),a("div",{class:Z(["symbology-list absolute overflow-hidden z-50 p-0 w-48 bg-white text-sm inline-flex flex-col",{"symbology-list-expanded":o.value}]),onMouseover:_,onMouseleave:B,onFocus:z,onBlur:he(H,["self"]),content:L(l)("details.layers.results.list.tooltip"),ref_key:"el",ref:y},[(s(!0),a(Q,null,Y(D.results,(O,t)=>(s(),a("div",{class:"flex justify-start relative",key:t},[A((s(),J(Je,{key:O.uid,layer:p(O.uid),result:O,selected:O.uid===e.value,onClick:d=>c(O.uid)},null,8,["layer","result","selected","onClick"])),[[$]])]))),128))],42,Ke)),[[F],[M,{trigger:"manual",placement:"top-start",touch:!1}]])}}}),We={class:"inline font-bold"},Xe=["innerHTML"],Ye=G({__name:"esri-default",props:{fixtureFields:{type:Object,required:!1},fields:{type:Object,required:!0},identifyData:{type:Object,required:!0}},setup(f){const{t:I}=K(),l=le("iApi"),v=f,y=(e,u,o,i)=>{const p=e.find(c=>c[u].toLowerCase()===o.toLowerCase());p&&delete i[p.name]},h=()=>{const e=Object.assign({},v.identifyData.data);y(v.fields,"type","geometry",e),l.ui.exposeOids||y(v.fields,"type","oid",e),l.ui.exposeMeasurements||(y(v.fields,"name","shape_length",e),y(v.fields,"name","shape_area",e));const u={};v.fields.forEach(i=>{const p=v.fixtureFields?.find(c=>i.name===c.field);u[i.name]={name:p?.alias||i.alias||i.name,type:i.type,visible:p?.visible??!0}});const o={};Object.keys(e).forEach(i=>{const p=u[i];if(p&&p.visible){const c=e[i];o[i]={value:typeof c=="number"?l.ui.formatNumber(c):c,alias:p.name,type:p.type}}});for(const[i]of Object.entries(o))l.ui.isPlainText(o[i].value)&&(o[i].value=l.ui.escapeHtml(o[i].value));return o},m=(e,u,o)=>{switch(o){case"date":return D(e);default:return S(e,u)}},S=(e,u)=>{if(!e)return e;if(e.trim().match(/\.(jpeg|jpg|gif|png)$/)||e.trim().match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i))return`<img src="${e}" alt="${I("details.item.alert.defaultAltText",{alias:u})}" />`;const o="underline text-blue-700 break-all",i=document.createElement("div");return i.innerHTML=e.trim(),i.firstElementChild?.tagName=="A"?(i.firstElementChild.className=o,i.innerHTML):_e(e,{className:o,target:"_blank",validate:{url:c=>/^https?:\/\//.test(c)}})},D=e=>{const u=parseInt(e);return isNaN(u)?e:new Date(u).toISOString().split("T")[0]};return(e,u)=>(s(),a("div",null,[(s(!0),a(Q,null,Y(h(),(o,i,p)=>(s(),a("div",{class:"p-5 pl-3 flex justify-end flex-wrap even:bg-gray-300",key:p},[g("span",We,j(o.alias),1),u[0]||(u[0]=g("span",{class:"flex-auto"},null,-1)),g("span",{class:"inline ml-8",innerHTML:m(o.value,o.alias,o.type)},null,8,Xe)]))),128))]))}}),et=["innerHTML"],tt={key:1},st=G({__name:"html-default",props:{identifyData:{type:Object,required:!0}},setup(f){const{t:I}=K();return(l,v)=>f.identifyData?(s(),a("div",{key:0,class:"whitespace-pre-wrap break-words h-full overflow-auto",innerHTML:f.identifyData.data.data??f.identifyData.data},null,8,et)):(s(),a("div",tt,j(L(I)("details.layers.results.empty")),1))}}),lt={class:"relative flex flex-grow truncate"},at={key:0,class:"flex flex-grow items-center truncate"},nt={class:"flex p-8 items-center"},it=["innerHTML"],ot={key:1,class:"symbologyIcon p-6"},rt=["content","innerHTML","tabindex"],ut={key:1,class:"flex p-6 flex-grow"},ct={key:2,class:"zoomButton text-center p-3"},dt=["content","aria-label"],vt={key:0,class:"m-auto animate-spin spinner h-20 w-20"},ft={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"green",class:"m-auto w-20 h-20"},mt={key:2,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"red",class:"m-auto w-20 h-20"},pt=["innerHTML"],ye=G({__name:"result-item",props:{uid:{type:String,required:!0},data:{type:Object,required:!0},open:{type:Boolean,required:!1},inList:{type:Boolean,required:!1}},setup(f){const I=ce(),l=f,v=le("iApi"),y=b([]),h=ee(),{t:m}=K(),S=b(!1),D=b(""),e=b("none"),u=b(),o=()=>I.getLayerByUid(l.uid),i=w(()=>h.properties),p=w(()=>h.defaultTemplates),c=w(()=>o()?.supportsFeatures??!1),_=w(()=>o()?.mapLayer??!1),B=w(()=>{const t=o();let d=t&&l.data.loaded?t.nameValue(l.data.data):v.$i18n.t("details.items.title");return v.ui.isPlainText(d)&&(d=v.ui.escapeHtml(d)),d}),z=t=>{if(typeof t=="string"){const d="underline text-blue-700 break-all",C=document.createElement("div");return C.innerHTML=t.trim(),C.firstElementChild?.tagName=="A"?(C.firstElementChild.className=d,C.innerHTML):_e(t,{className:d,target:"_blank",validate:{url:x=>/^https?:\/\//.test(x)}})}return t},H=()=>{M("none"),l.data.loaded?r():l.data.load().then(()=>{r()})},r=()=>{if(D.value="",!(l.data&&l.data.loaded))return;const t=o();if(t===void 0){console.warn(`could not find layer for uid ${l.uid} during icon lookup`);return}if(t.supportsFeatures){const d=t.oidField;t.getIcon(l.data.data[d]).then(C=>{D.value=C})}},T=w(()=>{const t=o(),d=t&&i.value[t.id]&&i.value[t.id].template;if(d){if(typeof me(d)!="string")return d;ie(()=>v.notify.show(Me.WARNING,v.$i18n.t("details.template.notFound",{layer:d})))}return p.value&&p.value[l.data.format]?p.value[l.data.format]:c.value?Ye:st}),$=w(()=>c.value?o()?.fields||[]:[]),F=w(()=>{const t=o();if(t&&i.value[t.id]&&i.value[t.id].fields)return i.value[t.id].fields}),M=t=>{t==="zoomed"||t==="error"?setTimeout(()=>{e.value=t,u.value?._tippy.show(),setTimeout(()=>{u.value?._tippy.hide(),e.value="none"},3e3)},300):e.value=t},O=()=>{if(e.value!=="none")return;M("zooming");const t=o();if(t===void 0||!t.isLoaded){console.warn(`Could not find layer for uid ${l.uid} during zoom geometry lookup`),M("error");return}if(!l.data.loaded){console.warn("Details zoomToFeature call on item that is still loading. Should be impossible, alert the devs."),M("error");return}const d=l.data.data[t.oidField],C=()=>{const E={getGeom:!0};t.getGraphic(d,E).then(x=>{x.geometry.invalid()?(console.error(`Could not find graphic for objectid ${d}`),M("error")):(v.geo.map.zoomMapTo(x.geometry),M("zoomed"),v.updateAlert(v.$i18n.t("details.item.alert.zoom")))}).catch(()=>{M("error")})};t.layerType===Ee.FEATURE&&t.geomType!==Ce.POINT?t.getGraphicExtent(d).then(E=>{v.geo.map.zoomMapTo(E),M("zoomed"),v.updateAlert(v.$i18n.t("details.item.alert.zoom"))}).catch(()=>{C()}):C()};return te(()=>{y.value.push(V(l,()=>{H()},{deep:!1,immediate:!0}))}),se(()=>{y.value.forEach(t=>t())}),(t,d)=>{const C=q("truncate"),E=q("tippy");return s(),a(Q,null,[g("div",lt,[c.value?(s(),a("div",at,[g("div",nt,[f.data.loaded&&D.value?(s(),a("span",{key:0,class:"flex-none symbologyIcon",innerHTML:D.value},null,8,it)):(s(),a("div",ot,d[3]||(d[3]=[g("div",{class:"animate-spin spinner h-20 w-20"},null,-1)])))]),f.data.loaded?A((s(),a("span",{key:0,class:"pl-3 text-left flex-grow itemName",content:B.value,innerHTML:z(B.value),onTouchstart:d[0]||(d[0]=x=>S.value=!0),onTouchend:d[1]||(d[1]=x=>S.value=!1),tabindex:f.inList?-1:0},null,40,rt)),[[C,{options:{placement:"top-start",offset:()=>S.value?[0,25]:[0,0]}}]]):(s(),a("div",ut,j(L(m)("details.loading")),1)),f.data.loaded?(s(),a("span",ct,[_.value?A((s(),a("button",{key:0,type:"button",content:L(m)(`details.item.zoom${e.value==="none"?"":`.${e.value}`}`),"aria-label":L(m)(`grid.cells.zoom${e.value==="none"?"":`.${e.value}`}`),ref_key:"zoomButton",ref:u,onClick:d[2]||(d[2]=x=>{x.stopPropagation(),O()}),class:"text-gray-600 w-24 h-24 p-2 flex justify-center items-center"},[e.value==="zooming"?(s(),a("div",vt)):e.value==="zoomed"?(s(),a("svg",ft,d[4]||(d[4]=[g("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1)]))):e.value==="error"?(s(),a("svg",mt,d[5]||(d[5]=[g("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(s(),a("span",{key:3,innerHTML:L(v).ui.getZoomIcon()},null,8,pt))],8,dt)),[[E,{placement:"bottom"}]]):N("",!0)])):N("",!0)])):N("",!0)]),f.open?(s(),J(me(T.value),{key:0,identifyData:f.data,fields:$.value,fixtureFields:F.value,class:"p-8"},null,8,["identifyData","fields","fixtureFields"])):N("",!0)],64)}}}),yt={key:0,class:"layerName w-full flex-grow p-5 pb-8 font-bold truncate",tabIndex:"0"},gt={key:1,class:"p-8 mb-8 bg-gray-100 flex justify-between"},ht={for:"toggle"},_t={key:2,class:"flex flex-col justify-between p-8 mb-8 bg-gray-100"},bt={class:"flex"},kt=["aria-label"],xt=["content","aria-label","disabled"],Lt={class:"px-3 text-center flex-grow"},wt=["content","aria-label","disabled"],Tt={key:3},$t={key:0},It=["content"],Mt=["onClick"],Et={key:1,class:"text-center"},Ct={key:4,class:"p-5"},Dt=G({__name:"result-list",props:{uid:{type:String,required:!0},results:{type:Object,required:!0}},emits:["item-selected"],setup(f,{emit:I}){const l=b(),v=()=>{l.value._tippy.hide()},y=n=>{n.key==="Tab"&&l.value?.matches(":focus")&&l.value._tippy.show()},h=le("iApi"),m=ee(),S=ce(),D=I,e=f,{t:u}=K(),o=b(!1),i=b(h.fixture.get("details")),p=b(!0),c=b(!1),_=b(0),B=b(20),z=b([]),H=b([]),r=w(()=>m.activeGreedy),T=w(()=>m.properties),$=w(()=>_.value+B.value),F=()=>S.getLayerByUid(e.uid),M=()=>e.results.find(n=>n.uid===e.uid),O=w(()=>M()?.loaded??!1),t=w(()=>M()?.requestTime),d=w(()=>o.value&&(!c.value&&x().length>1||c.value&&x().length>B.value)),C=w(()=>{const n=F();return n&&T.value[n.id]&&T.value[n.id].name?T.value[n.id].name:n?.name??""}),E=w(()=>e.uid),x=()=>{const n=M();return n?n.items:[]},U=w(()=>x()[_.value]),de=w(()=>{if(i.value.hasHilighter()){const n=F();if(n)return n.mapLayer&&n.supportsFeatures}return!1}),be=n=>{p.value=n,m.hilightToggle=n,P()},ke=()=>{const n=F();_.value=_.value??0,p.value=m.hilightToggle??p.value,c.value=!1,o.value=!!n,P()},ve=n=>{c.value?(_.value+=n*B.value,P()):_.value+=n},P=async(n=!1)=>{if(p.value&&de.value){if(n){const R=M();R&&await R.loading}const k=x();if(O.value&&k.length>0){if(c.value)i.value.hilightDetailsItems(k.slice(_.value,$.value),e.uid);else{const R=k[_.value];R&&i.value.hilightDetailsItems([R],e.uid)}return}}i.value.removeDetailsHilight()},xe=()=>{c.value=!0,_.value=Math.floor(_.value/B.value)*B.value,P()},Le=()=>{i.value.removeDetailsHilight(),H.value.forEach(n=>n()),z.value.forEach(n=>h.event.off(n))},we=()=>{i.value.removeDetailsHilight()},Te=n=>{const k=_.value;_.value=n,c.value=!1,k===n&&P(),D("item-selected")};return re(()=>{z.value.push(h.event.on(X.LAYER_REMOVE,n=>{const k=h.panel.get("details");e.uid===n.uid&&k&&k.close()})),z.value.push(h.event.on(X.PANEL_CLOSED,n=>{n.id==="details"&&Le()})),z.value.push(h.event.on(X.PANEL_MINIMIZED,n=>{n.id==="details"&&we()})),z.value.push(h.event.on(X.MAP_BASEMAPCHANGE,n=>{p.value&&n.schemaChanged&&P()})),l.value?.addEventListener("blur",v),l.value?.addEventListener("keyup",y)}),te(()=>{H.value.push(V(U,()=>{c.value||(ke(),U.value===void 0&&i.value.removeDetailsHilight())},{deep:!1,immediate:!0})),H.value.push(V(E,()=>{const n=e.uid;if(c.value&&n){const k=M();k&&k.loading.then(()=>{e.uid===n&&c.value&&P()})}},{deep:!1,immediate:!0})),H.value.push(V(t,()=>{_.value=0,c.value&&P(!0)})),H.value.push(V(()=>e.uid,()=>{_.value=0}))}),se(()=>{l.value?.removeEventListener("blur",v),l.value?.removeEventListener("keyup",y)}),(n,k)=>{const R=q("truncate"),ae=q("tippy"),$e=q("focus-item"),Ie=q("focus-list");return O.value&&r.value===0?(s(),a("div",{key:0,class:"detailsContent relative flex flex-col flex-grow pl-5",style:ge(f.results.length>1?{"margin-left":"42px"}:"")},[o.value?A((s(),a("h1",yt,[oe(j(C.value),1)])),[[R,{options:{placement:"top-start"}}]]):N("",!0),de.value?(s(),a("div",gt,[g("label",ht,j(L(u)("details.togglehilight.title")),1),ne(Se,{config:{value:p.value,disabled:!1},onToggled:be},null,8,["config"])])):N("",!0),d.value?(s(),a("div",_t,[g("div",bt,[c.value?N("",!0):(s(),a("button",{key:0,type:"button",class:"px-8 font-bold hover:bg-gray-200 focus:bg-gray-200","aria-label":L(u)("details.item.see.list"),onClick:k[0]||(k[0]=W=>xe())},j(L(u)("details.item.see.list")),9,kt)),g("div",{class:Z(["flex ml-auto bg-gray-200 py-8 items-center",{"w-full":c.value}])},[A((s(),a("button",{type:"button",content:L(u)(c.value?"details.items.previous":"details.item.previous.item"),onClick:k[1]||(k[1]=W=>ve(-1)),class:"mx-2 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":L(u)(c.value?"details.items.previous":"details.item.previous.item"),disabled:_.value===0},k[3]||(k[3]=[g("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[g("g",null,[g("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,xt)),[[ae,{placement:"top"}]]),g("span",Lt,j(c.value?L(u)("details.items.range",[_.value+1,Math.min($.value,x().length),x().length]):L(u)("details.item.count",[_.value+1,x().length])),1),A((s(),a("button",{type:"button",content:L(u)(c.value?"details.items.next":"details.item.next.item"),onClick:k[2]||(k[2]=W=>ve(1)),class:"mx-2 rotate-180 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":L(u)(c.value?"details.items.next":"details.item.next.item"),disabled:!c.value&&_.value===x().length-1||c.value&&$.value>=x().length},k[4]||(k[4]=[g("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[g("g",null,[g("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,wt)),[[ae,{placement:"top"}]])],2)])])):N("",!0),o.value?(s(),a("div",Tt,[x().length>0?(s(),a("div",$t,[c.value?A((s(),a("div",{key:0,class:"flex flex-col",content:L(u)("details.layers.results.list.tooltip"),ref_key:"el",ref:l},[(s(!0),a(Q,null,Y(x().slice(_.value,$.value),(W,fe)=>A((s(),a("button",{class:"flex flex-grow truncate default-focus-style hover:bg-gray-200",key:fe,onClick:jt=>Te(_.value+fe)},[ne(ye,{data:W,uid:f.uid,open:!1,"in-list":!0},null,8,["data","uid"])],8,Mt)),[[$e,"show-truncate"]])),128))],8,It)),[[Ie],[ae,{trigger:"manual",placement:"top-start",touch:!1}]]):(s(),J(ye,{key:1,data:U.value,uid:f.uid,open:!0,"in-list":!1},null,8,["data","uid"]))])):(s(),a("div",Et,j(L(u)("details.layers.results.empty.currentLayer")),1))])):(s(),a("div",Ct,j(L(u)("details.item.no.data")),1))],4)):(s(),a("div",{key:1,class:Z(["flex justify-center py-10 items-center",f.results.length>1?"ml-42":""])},[k[5]||(k[5]=g("span",{class:"animate-spin spinner h-20 w-20 px-5 mr-8"},null,-1)),oe(" "+j(L(u)("details.item.loading")),1)],2))}}}),St=ue(Dt,[["__scopeId","data-v-4538155c"]]),zt={class:"relative h-full"},Ht=G({__name:"details-screen",props:{panel:{type:Object}},setup(f){const{t:I}=K(),l=le("iApi"),v=ee(),y=b([]),h=b([]),m=b([]),S=b(!1),D=b(null),e=b(""),u=w(()=>v.activeGreedy),o=w(()=>v.payload),i=w(()=>v.properties),p=r=>{e.value=r},c=r=>m.value.find(T=>T.uid===r),_=r=>{r!==void 0&&(v.activeGreedy=r.length===0?0:r[0].requestTime,m.value=r,B(r))},B=r=>{if(e.value){const T=c(e.value);T?T.loading.then(()=>{T.requestTime===u.value&&(T.items.length>0?H(!1):z(r))}):z(r)}else z(r)},z=(r,T)=>{let $;if(T)$=T;else{const t=v.properties,d=r.map(E=>[t[E.layerId]?.priority??50,E.layerId]),C=new Set(d.map(E=>E[0]));$=[],C.forEach(E=>{const x=d.filter(U=>U[0]===E).map(U=>U[1]);$.push([E,x])}),$.sort((E,x)=>x[0]-E[0])}if($.length===0){o.value.length?H(!0):ie().then(()=>{H(!0)});return}const F=$[$.length-1][1],M=r.filter(t=>F.includes(t.layerId)).map(t=>t.loading.then(()=>t.items.length>0?Promise.resolve(t):Promise.reject())),O=r.length===0?0:r[0].requestTime;Promise.any(M).then(t=>{t.requestTime===u.value&&(e.value=t.uid,H(!1))}).catch(()=>{O===u.value&&($.pop(),z(r,$))})},H=r=>{v.activeGreedy=0,S.value=r};return te(()=>{h.value.push(V(o,r=>{_(r)},{deep:!1,immediate:!0}))}),se(()=>{y.value.forEach(r=>l.event.off(r)),h.value.forEach(r=>r())}),(r,T)=>{const $=De("panel-screen");return s(),J($,{panel:f.panel},{header:pe(()=>[oe(j(L(v).origin==="toggleEvent"?L(I)("details.layers.title.gridOrigin"):L(I)("details.layers.title.identifyOrigin")),1)]),content:pe(()=>[g("div",zt,[m.value.length>1?(s(),J(Qe,{key:0,results:m.value,detailsProperties:i.value,selected:e.value,onSelectionChanged:p},null,8,["results","detailsProperties","selected"])):N("",!0),g("div",{class:"detailsContentSection overflow-y-auto h-full",ref_key:"detailsPanel",ref:D},[S.value?(s(),a("div",{key:1,class:Z(["text-center",{"ml-42":m.value.length>1}])},j(m.value.length>=1?L(I)("details.layers.results.empty"):L(I)("details.layers.results.empty.noLayers")),3)):(s(),J(St,{key:0,uid:e.value,results:m.value,onItemSelected:T[0]||(T[0]=()=>ie(()=>D.value?.scrollTo({top:0})))},null,8,["uid","results"]))],512)])]),_:1},8,["panel"])}}}),At=ue(Ht,[["__scopeId","data-v-1d94dd9a"]]);export{At as default};
