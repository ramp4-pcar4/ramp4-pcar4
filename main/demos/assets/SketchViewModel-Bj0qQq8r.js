const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-BuBV7wfH.js","./main-CtmwM019.js","./preload-helper-DMGCcr4D.js","./main-DZFs8ecF.css","./Cyclical-BjYazOTz.js","./quantityUtils-CU1WV3ce.js","./elevationInfoUtils-Rm5QE2pq.js","./ElevationInfo-C2AYR3DA.js","./lengthUtils-CPuXsfCi.js","./angularMeasurementUtils-Cr9hvkn9.js","./vec2f64-Cgb6qxNH.js","./vec32-gK3TWme0.js","./projectVectorToVector-PMDI3BQJ.js","./projectionUtils-DKBF6_Ma.js","./projectBuffer-C2_ZDxbj.js","./zscale-kI9JnN2z.js","./projectPointToVector-BeWU3FqC.js","./geodesicUtils-BG1Wf2YN.js","./UpdatingHandles-lgENzTF6.js","./GraphicsLayer-C7dUYDum.js","./GraphicsCollection-DsuNzIxl.js","./BlendLayer-CndHJ5Dn.js","./layerContainerType-CSXZNpHb.js","./jsonUtils-CG4V1ypX.js","./parser-B5KtsVQI.js","./mat4f32-Djp3mnm5.js","./mat4-Ba1tXzxc.js","./ScaleRangeLayer-8ZzqKGhu.js","./editableLayers-CH8seXrU.js","./utils-CEb26cK7.js","./Queue-CI0vPdwz.js","./signal-Btlkyg0w.js","./Version-D0TrQevW.js","./asyncUtils-BZq6cT_d.js","./Query-COoGphoa.js","./Field-Qk7kqJE_.js","./fieldType-CgDsR44Y.js","./vec42-DZ0sp4MX.js","./vec4f64-DPb6J-GU.js","./plane-Dey3oqKO.js","./vectorStacks-Du2BB1wg.js","./quatf64-aQ5IuZRd.js","./sphere-DCy-S0e6.js","./geodeticLengthOperator-DWsUC-lK.js","./geodeticCurveType-CirnHLSB.js","./earcut-D9gy186-.js","./triangle-InVEiR1q.js","./lineSegment-CeFx4PPK.js","./spatialReferenceEllipsoidUtils-DFw-wu05.js","./GridSnappingEngine-5S_woSbs.js","./normalizeUtils-dN75LHyP.js","./normalizeUtilsCommon-oR7kIHq_.js","./utils-PyBYdGi0.js","./utils-CjyZX5Fj.js","./scaleUtils-a7XRoboI.js","./gridUtils-DvqsxUdh.js","./FeatureSnappingEngine-BXDRxHW_.js","./mapCollectionUtils-Bptumgan.js","./FeatureFilter-pwJGuGC0.js","./floorFilterUtils-DKzVzLpH.js","./layerViewUtils-C3bdKs5A.js","./geometryEngine-Cm1lhs9h.js","./geometryEngineBase-D6Q0ncCQ.js","./_commonjsHelpers-DCkdB7M8.js","./editingTools-D8Uf3R9a.js","./SnappingVisualizer2D-B9gXOpaY.js","./TooltipInfoWithCoordinates-Dsk2T3qF.js","./PointSnappingHint-DlKnucSr.js","./SketchTooltipInfo-CCynpALS.js","./messages-CIIwatVx.js","./MeshTransform-lAZ48NP7.js","./quat-CZ1LQodR.js","./axisAngleDegrees-BqtU_FN5.js","./meshVertexSpaceUtils-CeN7ZS2W.js","./MeshLocalVertexSpace-CeosWTXF.js","./modeUtils-rVjNo13H.js","./jsxFactory-CRwrqbBC.js","./intl-BF_HwN3J.js","./uuid-Oe6SV2kF.js","./sanitizerUtils-BSv1Bmu5.js","./jsxFactory-CQED0rIl.css","./a11yUtils-D87W8orT.js","./unitFormatUtils-IEj6d2uR.js","./getDefaultUnitForView-CbpmJpJC.js","./index-CxMchHMR.js","./dynamic-import-helper-BheWnx7M.js","./draw-store-COKAX8Ak.js","./drapedUtils-DnB5yqNF.js","./utils-BQBvadb7.js","./widget-CX3460dL.js","./substitute-CLT4rWmz.js","./editPlaneUtils-B5kFzanD.js","./drawSurfaces-p-r46VbT.js","./ReactiveSet-BnT-JVp6.js","./diffUtils-MaI4D9Mw.js","./SnappingContext-BvZ1mDD1.js","./rotate-CNXTMaqq.js","./curveOperationUtils-D7Hqr9mS.js","./hydratedFeatures-BBluDIY8.js","./Scheduler-DIu-iJOg.js","./debugFlags-BSOCZQmO.js","./createUtils-BamL_hyg.js","./distanceOperator-CPlPFmZE.js","./Point2D-Cl-0kgBQ.js","./Distance2DCalculator-CXhBP-8I-Cmzw5AAV.js","./ProjectionTransformation-BpSsk8S9.js","./Envelope2D-D_vzSDeK.js","./Transformation2D-BcDHHNrs.js","./SimpleGeometryCursor-B92kdZ15.js","./OperatorDefinitions-DP7_WWTp.js","./apiConverter-JD6JBbuC.js","./jsonConverter-JYkjz4xX.js","./simplifyOperator-DR_a9Xak.js","./operatorSimplify-CjX8-hMe.js","./mat2d-Bgm8yl9G.js","./mat2df64-DJ_RMjZ3.js","./boundedPlane-CSMu0tVj.js","./cimSymbolUtils-CBOyuQ8I.js","./utils-DQaLv0i_.js","./defaultCIMValues-XI-Li77m.js","./GraphicManipulator-qgF00ktU.js","./colorUtils-D3e_O9k3.js","./drawUtils-D-hUiYBP.js","./ImageMaterial.glsl-Bu223aj-.js","./TextOverlayItem-C65Cyhle.js","./frustum-DgTrRaDo.js","./RibbonLine.glsl-C1_B52At.js","./orientedBoundingBox-inghVrgq.js","./computeTranslationToOriginAndRotation-DyRw8uQA.js","./OutputColorHighlightOID.glsl-DcUKTccw.js","./enums-DQOO6RKE.js","./Texture-QG2FbAaW.js","./Indices-X2rQqBWt.js","./BufferView-CESi4vtr.js","./renderState-CKc66y4x.js","./glsl-B5bJgrnA.js","./VertexAttributeLocations-BfZbt_DV.js","./VertexElementDescriptor-BLyltQyJ.js","./Octree-ZmJ1PBYC.js","./InterleavedLayout-JnvvHTvL.js","./types-BKo2foNY.js","./HUDMaterial.glsl-FQFXrUP4.js","./vec3f32-WCVSSNPR.js","./ShaderBuilder-DMCNkLu1.js","./DefaultLayouts-COHtNhrV.js","./triangulationUtils-Bzdf-_SI.js","./deduplicate-B7MSU_Pc.js","./VertexArrayObject-BIicG6PV.js","./memoryEstimations-R8dTJqWI.js","./BufferObject-DG9EMnfd.js","./VertexBuffer-D3Ex4_V0.js","./NestedMap-B93H1Ttm.js","./Texture-BgZIdcYl.js","./videoUtils-3bxs8lyX.js","./requestImageUtils-D3sOFDPi.js","./sdfPrimitives-Di1ypL1b.js","./SelectedVertexTooltipInfo-DKhpAdw-.js","./TranslateTooltipInfo-Bh5qFvd4.js","./utils-D6aoGCcc.js","./LRUCache-B52YywOm.js","./MemCache-Dy3u4age.js","./ExtentScaleTooltipInfo-BZH09zBa.js","./LineCallout.glsl-DIW2AAzv.js","./projectionUtils-BYER4i0I.js","./HeightModelInfo-4xHEEYmq.js","./visualVariableUtils-D_kT-o6u.js","./dehydratedFeatures-GG2rjIto.js","./UniqueValueRenderer-Dv7jWKCh.js","./commonProperties-CITTv46S.js","./colorRamps-CDthAQF1.js","./ColorStop-ClhbS4RX.js","./RendererLegendOptions-BL5W2r_Q.js","./styleUtils-CodmB4wT.js","./rendererConversion-CgsAtRl5.js","./RealisticTree.glsl-CrZmYkw-.js","./DefaultMaterial-BpQ-gAr0.js","./edgeUtils-BG8LdQa8.js","./OptimizedFeature-69ue8f4g.js","./OptimizedGeometry-CYLi7ZPm.js","./optimizedFeatureQueryEngineAdapter-iMFBsQoE.js","./vec2f32-CaVKkSa6.js","./featureConversionUtils-CQ7EbBKb.js","./OptimizedFeatureSet-BR8EEvDc.js","./PooledRBush-BQw4UTTJ.js","./quickselect-QQC62dOK.js","./popupUtils-JGUbKc_R.js","./LayerView-FwIFYjAF.js","./highlightOptionsUtils-DslVGRH3.js","./GraphicMover-Dpm29VC9.js","./Box-DPLO0DGK.js","./settings-kYsC1fCF.js","./Reshape-CG8uo64r.js","./symbolUtils-Ciex-nUn.js","./mat2df32-Dpt2CT5P.js"])))=>i.map(i=>d[i]);
import{_ as P}from"./preload-helper-DMGCcr4D.js";import{V as pe,_ as c,Y as h,Z as R,jZ as Hn,ng as In,j_ as Un,cU as at,a0 as Ii,bC as lt,O as _e,i as Ui,fh as Nn,aw as de,fg as $e,cv as jn,o2 as Vn,jV as qn,ee as L,kA as Q,l_ as zn,o3 as Ni,ky as Me,kz as we,l$ as Fn,aB as v,c4 as Zn,aA as Ue,aJ as le,mA as Wn,kB as Bn,hX as ji,bL as Vi,gQ as qi,cZ as Kn,d6 as Jn,hu as Xn,o4 as yi,kx as Yn,h9 as Qn,gR as er,aF as zi,T as ft,aH as tr,eH as zt,az as ir,aa as $t,eO as nr,gz as rr,d3 as sr,gu as or,hs as ar,o5 as lr,lN as Fi,fx as pr,ay as Ft,h6 as cr,da as gi,dc as hr,d8 as ur,o6 as dr,o7 as yr,hU as gr,a9 as Ze,ax as fr,X as Et,e as fi,o8 as mr,hT as vr,o9 as K,eh as mi,s as _r,j4 as vi,cw as br,eP as _i,ha as ke}from"./main-CtmwM019.js";import{h as wr}from"./UpdatingHandles-lgENzTF6.js";import{W as Ht,N as Sr,J as Tr,G as $r,L as Er}from"./projectionUtils-DKBF6_Ma.js";import Or from"./GraphicsLayer-C7dUYDum.js";import{e as Gr}from"./editableLayers-CH8seXrU.js";import{g as bi,f as M,r as Mr,c as xr,n as wi,a as O}from"./utils-CEb26cK7.js";import{d as Ar}from"./asyncUtils-BZq6cT_d.js";import{E as kr,b as Zi,I as Cr,U as Ee}from"./elevationInfoUtils-Rm5QE2pq.js";import{i as Wi,t as Ne,n as it}from"./projectVectorToVector-PMDI3BQJ.js";import{v as It,R as I,P as H,q as k,o as ee,_ as pt,Z as Ut,c as mt,s as Zt,p as He,H as E,J as Pr,j as Bi,A as Rr,u as Dr,I as Lr}from"./vec32-gK3TWme0.js";import{b as Hr}from"./Query-COoGphoa.js";import{n as B,r as nt,l as Ir}from"./vec2f64-Cgb6qxNH.js";import{s as Ur,j as Nr}from"./vec42-DZ0sp4MX.js";import{n as jr}from"./vec4f64-DPb6J-GU.js";import{i as Vr}from"./projectBuffer-C2_ZDxbj.js";import{j as Nt,q as Wt,b as Bt,y as Ki,R as qr,v as zr}from"./geodesicUtils-BG1Wf2YN.js";import{U as vt,j as V,W as jt,a as Ji,J as Xi,O as Fr,w as Yi,X as Zr,R as Qi,k as Kt,d as Wr,T as Br}from"./plane-Dey3oqKO.js";import{X as Kr,q as Jr,T as Xr,c as Yr}from"./sphere-DCy-S0e6.js";import{a as fe,l as Jt}from"./quantityUtils-CU1WV3ce.js";import{m as Qr,l as en}from"./geodeticLengthOperator-DWsUC-lK.js";import{e as es}from"./earcut-D9gy186-.js";import{v as ts}from"./triangle-InVEiR1q.js";import{c as is,a as ns}from"./spatialReferenceEllipsoidUtils-DFw-wu05.js";let Se=class extends pe{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],Se.prototype,"length",void 0),c([h()],Se.prototype,"verticalLength",void 0),c([h()],Se.prototype,"area",void 0),Se=c([R("esri.views.interactive.sketch.Units")],Se);const ct=Se;let he=class extends pe{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?"relative-bilateral":"relative";case"absolute":return"absolute"}}get displayUnits(){return this._get("displayUnits")??new ct}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new ct}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],he.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],he.prototype,"relativeDirectionIsBilateral",void 0),c([h()],he.prototype,"effectiveDirectionMode",null),c([h({type:ct,nonNullable:!0})],he.prototype,"displayUnits",null),c([h({type:ct,nonNullable:!0})],he.prototype,"inputUnits",null),he=c([R("esri.views.interactive.sketch.SketchValueOptions")],he);const Xt=he;function Si(t){switch(t){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the symbol type is not supported"}return""}function rs(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return 1;const e=t.operations?.data.type;if(!e)return 3;switch(e){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}return 0}function ss(t){return os(t).result}function os(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return{result:1};if(!t.operations)return{result:2};const e=t.operations.data.type,i=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:0,geometry:i}:{result:3}}function as(t){if(t.layer?.type!=="graphics")return 1;if(t.geometry==null)return 2;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return e&&e.some(i=>i.type==="object")?0:4}function Ti(t,e,i){if(!e||!t?.map)return;const{map:n}=t;n.layers.find(s=>s===e)||n.add(e,i)}function va(t,e){const i=e?.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(n=>{const r=n.layer;return r===i||"sublayers"in r&&r.sublayers!=null&&r.sublayers.includes(i)})}function _a(t){return Gr(t)||Hn(t)||In(t)||Un(t)}let rt=class extends pe{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],rt.prototype,"enabled",void 0),rt=c([R("esri.views.interactive.sketch.SketchLabelOptions")],rt);const Yt=rt;let Ie=class extends pe{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],Ie.prototype,"mode",void 0),Ie=c([R("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Ie);let C=class extends pe{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],C.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"totalLength",void 0),C=c([R("esri.views.interactive.sketch.SketchTooltipVisibleElements")],C);const tn=C;let D=class extends pe{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Ie,this.placement="auto",this.offset=null,this.visibleElements=new tn,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],D.prototype,"enabled",void 0),c([h()],D.prototype,"forceEnabled",void 0),c([h()],D.prototype,"effectiveEnabled",null),c([h()],D.prototype,"helpMessage",void 0),c([h()],D.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],D.prototype,"inputEnabled",void 0),c([h({type:Ie,nonNullable:!0})],D.prototype,"elevation",void 0),c([h()],D.prototype,"placement",void 0),c([h()],D.prototype,"offset",void 0),c([h({type:tn,nonNullable:!0})],D.prototype,"visibleElements",void 0),c([h()],D.prototype,"visualVariables",void 0),c([h()],D.prototype,"xyMode",void 0),D=c([R("esri.views.interactive.sketch.SketchTooltipOptions")],D);const Qt=D;let Te=class extends pe{constructor(e){super(e),this.labels=new Yt,this.tooltips=new Qt,this.values=new Xt}};c([h({nonNullable:!0,type:Yt})],Te.prototype,"labels",void 0),c([h({nonNullable:!0,type:Qt})],Te.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:Xt})],Te.prototype,"values",void 0),Te=c([R("esri.views.interactive.sketch.SketchOptions")],Te);const nn=Te;function rn(t,e,i){return U(t,e,i)}function U(t=0,e=0,i=0){return at(t,e,i)}function Ea(t){return t}function Oa(t){return t}function ge(t,e,i){return at(t,e,i)}function Oe(t){const[e,i,n]=t;return t.length>3?[e,i,n,t[3]]:[e,i,n]}function Ot(t){return t[3]=1|((t.length>3?t[3]:void 0)??0),t}function Ga(t){return!!(1&((t.length>3?t[3]:void 0)??0))}function $i(t,e,{coordinateHelper:i,elevationInfo:n},r){return t?Le(i.vectorToDehydratedPoint(t,ls),e,n,r):null}function Le(t,e,i,n=U()){return n[0]=t.x,n[1]=t.y,n[2]=t.z??0,e==null||(e.type==="2d"?n[2]=0:n[2]=kr(e,t,i,Ee)??0),n}function Ma(t,e,i){return i?(Wi(i,t[0],t[1],t[2],e),i):Ne(t[0],t[1],t[2],e)}function Ei(t,e,{z:i,m:n},r,s){const{spatialReference:l,elevationInfo:p}=r;let o;i==null&&n==null?o=void 0:e==null||e.type==="2d"?o=i??void 0:o=Zi(e,t,l,Ee,p)??0;const[a,u]=t;return s?Wi(s,a,u,o,l):s=Ne(a,u,o,l),n!=null&&(s.m=n,s.hasM=!0),s}function xa(t,e,i,n,r=U()){const[s,l]=t;return r[0]=s,r[1]=l,t.length>3&&(r[3]=t[3]??0),i?.type!=="3d"?(r[2]=e.value,r):(r[2]=Cr(i,s,l,e.value,n,e.elevationInfo,Ee)??0,r)}const ls=Ne(0,0,0,null);let Z=class extends Ii{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],Z.prototype,"enabled",void 0),Z=c([R("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Z);let S=class extends Ii{constructor(e){super(e),this.lineSnapper=new Z,this.parallelLineSnapper=new Z,this.rightAngleSnapper=new Z,this.rightAngleTriangleSnapper=new Z,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new lt([255,127,0]),this.orangeTransparent=new lt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),c([h({type:lt,nonNullable:!0})],S.prototype,"orange",void 0),c([h({type:lt,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=c([R("esri.views.interactive.snapping.Settings.Defaults")],S);const ht=new S;let oe=class extends pe{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new _e}};c([h({constructOnly:!0})],oe.prototype,"layer",void 0),c([h()],oe.prototype,"enabled",void 0),c([h()],oe.prototype,"updating",void 0),c([h()],oe.prototype,"availability",void 0),c([h()],oe.prototype,"sublayerSources",void 0),oe=c([R("esri.views.interactive.snapping.FeatureSnappingLayerSource")],oe);let x=class extends pe{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new _e,this.distance=ht.distance,this.touchSensitivityMultiplier=ht.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(Oi)&&Ui.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const i=e.filter(cs),n=this._get("_effectiveFeatureSources")?.filter(Oi)??new _e;for(const o of i){const a=n.find(u=>u.layer===o.layer.parent);if(a)a.sublayerSources.includes(o)||a.sublayerSources.add(o);else if(o.layer.parent){const u=new oe({layer:o.layer.parent});u.sublayerSources.add(o),n.add(u)}}for(const o of n){const a=o.sublayerSources.filter(u=>!i.includes(u));o.sublayerSources.removeMany(a)}n.removeMany(n.filter(o=>o.sublayerSources.length===0));const r=e.filter(ps),s=this._get("_effectiveFeatureSources")??new _e,{added:l,removed:p}=Nn(s.toArray(),[...r,...n]);return s.removeMany(p),s.addMany(l),s}};function Oi(t){return t.layer.type==="subtype-group"}function ps(t){return t.layer.type!=="subtype-group"}function cs(t){return t.layer.type==="subtype-sublayer"}c([h()],x.prototype,"enabled",void 0),c([h()],x.prototype,"enabledToggled",void 0),c([h()],x.prototype,"forceDisabled",void 0),c([h()],x.prototype,"selfEnabled",void 0),c([h()],x.prototype,"featureEnabled",void 0),c([h()],x.prototype,"gridEnabled",void 0),c([h()],x.prototype,"attributeRulesEnabled",void 0),c([h({type:_e.ofType(oe)})],x.prototype,"featureSources",void 0),c([h()],x.prototype,"distance",void 0),c([h()],x.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],x.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],x.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],x.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],x.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],x.prototype,"_effectiveFeatureSources",null),x=c([R("esri.views.interactive.snapping.SnappingOptions")],x);const Ra=Symbol("grid-placement-graphic");function sn(t,e){const i=t.x-e.x,n=t.y-e.y;return i*i+n*n}function Da(t,e){return Math.sqrt(sn(t,e))}function hs(t,e){e.sort((i,n)=>It(i.targetPoint,t)-It(n.targetPoint,t))}function La({parameters:{point:t,distance:e,returnEdge:i,vertexMode:n,coordinateHelper:{spatialReference:r},filter:s},mode:l,returnZ:p,filter:o}){const a=o?.clone()??new Hr({where:"1=1"});return a.returnZ=p??l==="3d",s&&(a.geometry=s.geometry,a.distance=s.distance,a.spatialRelationship=s.spatialRelationship,a.where=jn(a.where,s.where),a.timeExtent=Vn(a.timeExtent,s.timeExtent),a.objectIds=us(a.objectIds,s.objectIds)),{point:Ne(t[0],t[1],t[2],r.toJSON()),mode:l,distance:e,returnEdge:i,vertexMode:n,query:a.toJSON()}}function us(t,e){return t||e?e?t?Array.from(qn(new Set(t),new Set(e))):e:t:null}function Ha(t,e,i){return{left:$i(t.leftVertex.pos,e,i),right:$i(t.rightVertex.pos,e,i)}}const Gi=Symbol("snapping-toggle");function ds(t,e=()=>{}){const i=de(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:n,snappingOptions:r})=>{if(t.removeHandles(Gi),!n||!r)return;const s=M.TOOL,l=[n.on("key-down",p=>{p.key!==bi.toggle||p.repeat||(r.enabledToggled=!0,e())},s),n.on("key-up",p=>{p.key===bi.toggle&&(r.enabledToggled=!1,e())},s),n.on("pointer-move",p=>{const o=p.native.ctrlKey;r.enabledToggled!==o&&(r.enabledToggled=o,e())},s)];t.addHandles(l,Gi)},$e);t.addHandles(i)}function Ia(t){return Mr(t)&&"utilityNetworks"in t&&!!t.utilityNetworks?.length}function Ua(t){return t?.type==="line"}function Gt(t,e){return t[0]*e[1]-t[1]*e[0]}function ys(t,e,i){const n=Me(i,e)/we(i);return Fn(t,i,n)}function Na(t,e,i,n,r=i){return L(be,n,i),L(ut,e,r),ys(Ge,ut,be),zn(t,r,Ge)}function ja(t,e,i,n){L(be,e,i);const r=n/Ni(be);return Q(t,i,be,r)}function Va(t,e){const i=t.start,n=t.end,r=e.start,s=e.end,l=L(be,n,i),p=L(on,s,r),o=Gt(l,p);if(Math.abs(o)<=fs)return[];const a=L(ut,i,r),u=Gt(p,a)/o;return Gt(l,a)/o,u>=0?[Q(Ge,i,l,u)]:[Q(Ge,i,l,u)]}function gs(t,e,i){const n=[],r=L(be,t.end,t.start),s=L(on,t.start,e),l=we(r),p=2*Me(r,s),o=p*p-4*l*(we(s)-i*i);if(o===0){const a=-p/(2*l);n.push(Q(Ge,t.start,r,a))}else if(o>0){const a=Math.sqrt(o),u=(-p+a)/(2*l);n.push(Q(Ge,t.start,r,u));const d=(-p-a)/(2*l);n.push(Q(ut,t.start,r,d))}return n}const fs=1e-6,be=B(),on=B(),ut=B(),Ge=B();function ei({start:t,end:e,type:i},n,r){const s=[],l=L(je,e,t),p=L(_t,t,n),o=we(l),a=2*Me(l,p),u=a*a-4*o*(we(p)-r*r);if(u===0){const d=-a/(2*o);(i===0||d>=0)&&s.push(Q(B(),t,l,d))}else if(u>0){const d=Math.sqrt(u),m=(-a+d)/(2*o);(i===0||m>=0)&&s.push(Q(B(),t,l,m));const y=(-a-d)/(2*o);(i===0||y>=0)&&s.push(Q(B(),t,l,y))}return s}function an(t,e){const i=t.start,n=t.end,r=L(je,n,i),s=ee(wt,-r[1],r[0],0),l=e.start,p=e.end,o=I(ii,p,l),a=H(o,s),u=ee(gn,i[0],i[1],0),d=I(fn,u,l),m=H(d,s),y=Ue();if(Math.abs(a)<y)return[];const g=k(mn,l,o,m/a);if(e.type===0){const f=I(Vt,g,l);if(H(f,o)<-y)return[]}if(t.type===1){const f=Wn(_t,g,i);if(Me(f,r)<-y)return[]}return[le(g)]}function ms(t,e){return _s(dt(ni,e[2],t),e)}function ln(t,e){return dn(dt(ni,0,t),dt(Ts,0,e)).map(([n,r])=>nt(n,r))}function pn(t,e,i){return hn(t,dt(ni,t[2],e),i)}function cn(t,e,i,n=v()){const r=L(je,t,e),s=Ni(r);return Q(n,e,r,s===0?1:i/s),n[2]=t[2],n}function hn(t,{start:e,end:i,type:n},r=v()){const s=I(bt,t,e),l=I(wt,i,e),p=H(s,l)/H(l,l);return k(r,e,l,n===0?Math.max(p,0):p)}const vs=(()=>{const t=v(),e=v(),i=v();return({start:n,end:r},{center:s,radius:l,normal:p,slicePlane:o})=>{const a=vt(s,p,Ss);if(w(jt(a,n),0)&&w(jt(a,r),0)){Ji(p,t,e);const d=(g,f)=>(mt(i,f,s),ji(g,H(i,t),H(i,e)),g),m=gs({start:d(je,n),end:d(_t,r)},Ir,l),y=[];for(const[g,f]of m){const _=Zt(v(),s);k(_,_,t,g),k(_,_,e,f),o&&!ye(o,_)||y.push(_)}return y}const u=v();return Xi(a,n,r,u)?!w(He(u,s),l)||o&&!ye(o,u)?[]:[u]:[]}})();function un({start:t,end:e,type:i},n,r){const s=[],l=mt(bt,e,t),p=L(_t,t,n),o=we(l),a=2*Me(l,p),u=a*a-4*o*(we(p)-r*r);if(u===0){const d=-a/(2*o);(i===1||d>=0)&&s.push(k(v(),t,l,d))}else if(u>0){const d=Math.sqrt(u),m=(-a+d)/(2*o);(i===1||m>=0)&&s.push(k(v(),t,l,m));const y=(-a-d)/(2*o);(i===1||y>=0)&&s.push(k(v(),t,l,y))}return s}function dn(t,e){const i=t.start,n=t.end,r=e.start,s=e.end,l=I(bt,n,i),p=I(wt,s,r),o=I(ii,r,i),a=pt(gn,l,p);if(!w(H(o,a),0))return[];const u=Ut(a);if(w(u,0))return[];const d=pt(fn,o,p),m=H(d,a)/u,y=k(mn,i,l,m);if(t.type===0){const g=I(Vt,y,i);if(H(l,g)<-Ue())return[]}if(e.type===0){const g=I(Vt,y,r);if(H(p,g)<-Ue())return[]}return[le(y)]}function _s({start:t,end:e,type:i},n){const r=I(bt,n,t),s=I(wt,e,t),l=pt(ii,s,r),p=Ut(l)/Ut(s),o=Ue();if(p<o)switch(i){case 1:return[le(n)];case 0:return H(s,r)<-o?[]:[le(n)]}return[]}function ti(t,e,i,n){const[r,s]=t,[l,p]=i,o=l-r,a=p-s,u=o*o+a*a,d=Math.sqrt(u);if(d>e+n)return[];if(d<Math.abs(e-n))return[];if(w(d,0)&&w(e,n))return[];const m=(e*e-n*n+u)/(2*d),y=Math.sqrt(e*e-m*m),g=y*a/d,f=y*o/d,[_,$]=Bn(je,t,i,m/d);return w(g,f)?[nt(_,$)]:[nt(_+g,$-f),nt(_-g,$+f)]}function dt(t,e,{start:i,end:n,type:r}){return ee(t.start,i[0],i[1],e),ee(t.end,n[0],n[1],e),t.type=ws[r],t}function yn(t,e){return w(t[2],e[2])}function w(t,e){return Zn(Math.abs(t-e),0,Ue())}function bs(t,e){return e.filter(i=>ye(t,i))}function ye(t,e){return Fr(t,e)}const ws={0:1,1:0},je=B(),_t=B(),bt=v(),wt=v(),ii=v(),gn=v(),fn=v(),mn=v(),Vt=v(),Ss=V(),ni={start:v(),end:v(),type:1},Ts={start:v(),end:v(),type:1};class q{intersect(e){return ie(this,e)}closestPoints(e){return[this.closestTo(e)]}}class xe extends q{constructor(e){super(),this.point=e}equals(e){return this===e||z(e)&&E(this.point,e.point)}closestTo(){return Oe(this.point)}}class ri extends q{constructor(e,i,n){super(),this.start=e,this.end=i,this.lineLike={start:e,end:i,type:n}}equals(e){return this===e||J(e)&&this.lineLike.type===e.lineLike.type&&E(this.start,e.start)&&E(this.end,e.end)}closestTo(e){const i=U();return hn(e,this.lineLike,i),i}}class si extends ri{constructor(e,i){super(e,i,1)}}class $s extends ri{constructor(e,i){super(e,i,0)}}class vn extends q{constructor(e){super(),this.constraints=e}equals(e){return this===e||qt(e)&&Kn(this.constraints,e.constraints,(i,n)=>i.equals(n))}closestTo(e){let i,n=1/0;for(const r of this.constraints){const s=r.closestTo(e),l=It(e,s);l<n&&(n=l,i=s)}return Oe(i??e)}closestPoints(e){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(e))}}class _n extends q{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||Y(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=U();return cn(e,this.center,this.radius,i),i}}class oi extends q{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||re(e)&&E(this.center,e.center)&&this.radius===e.radius}closestTo(e){const i=U();return cn(e,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new ai(Oe(this.center),this.radius,ge(0,0,1))}}class ai extends q{constructor(e,i,n,r=void 0){super(),this.center=e,this.radius=i,this.normal=n,this.slicePlane=r}equals(e){return this===e||ue(e)&&E(this.center,e.center)&&E(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:i,radius:n}=this;Qi(this.getPlane(Es),e,Mt);const r=I(Mt,Mt,i),s=Bi(r);if(w(s,0))return Oe(e);const l=n/Math.sqrt(s),p=U();k(p,i,r,l);const{slicePlane:o}=this;return o&&!ye(o,p)?pi(o,this)?.closestTo(e)??Oe(e):p}getPlane(e=V()){return vt(this.center,this.normal,e)}}const Mt=v(),Es=V();class Os extends q{constructor(e){super(),this.z=e}equals(e){return this===e||ne(e)&&this.z===e.z}closestTo(e){return ge(e[0],e[1],this.z)}getPlane(e=V()){return ee(Mi,0,0,this.z),vt(Mi,Jn,e)}}const Mi=v();class li extends q{constructor(e,i,n){super(),this.start=e,this.end=i,this.planeLike={start:e,end:i,type:n}}equals(e){return this===e||X(e)&&this.planeLike.type===e.planeLike.type&&E(this.start,e.start)&&E(this.end,e.end)}closestTo(e){const i=U();return pn(e,this.planeLike,i),i}closestEndTo(e){const{start:i,end:n}=this.planeLike;return Math.sign(Me(L(Gs,n,i),L(Ms,e,i)))>0?this.end:this.start}getPlane(e=V()){const i=Zt(xi,this.end);return i[2]+=1,Yi(this.start,this.end,i,e)}getSlicePlane(e=V()){const{start:i,end:n,type:r}=this.planeLike;if(r===0)return;const s=ee(xi,i[0],i[1],0),l=ee(Ai,n[0],n[1],0),p=mt(Ai,l,s);return vt(s,p,e),e}}const Gs=B(),Ms=B(),xi=v(),Ai=v();class qa extends li{constructor(e,i){super(e,i,1)}}class bn extends li{constructor(e,i){super(e,i,0)}}class xs extends q{constructor(e,i){super(),this.sphere=Jr(e,i),this._center=le(e)}equals(e){return this===e||se(e)&&Xr(this.sphere,e.sphere)}closestTo(e){const i=U();return Yr(this.sphere,e,i),i}get center(){return this._center}get radius(){return this.sphere[3]}}class wn extends q{constructor(e,i,n){super(),this.start=e,this.end=i,this.getZ=n,this.planeLike={start:e,end:i,type:0}}equals(e){return this===e||yt(e)&&E(this.start,e.start)&&E(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return Ds(this,e)}addIfOnTheGround(e,i){for(const n of i){const r=this.getZ(n[0],n[1])??0;w(n[2],r)&&(n[2]=r,e.push(n))}}}class As extends q{constructor(e,i,n){super(),this._x=e,this._y=i,this._z=n}equals(e){return this===e||Xs(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,i,n]){return rn(this._x??e,this._y??i,this._z??n)}}class ks extends q{constructor(e,i,n,r,s){super(),this._origin=e,this._spatialReference=i,this._distanceMeters=n,this._z=r,this._directionDegrees=s}equals(e){return this===e||Js(e)&&yi(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,i,n]){return ji(Ce,e,i),yi(Ce,this._origin)||this._applyDirectionAndDistance(Ce),rn(Ce[0],Ce[1],this._z??n)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Nt(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Ps(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=Wt(Cs,this._origin,e,this._spatialReference);Nt(e,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const Ce=[0,0],Cs=new Bt;function Ps(t,e,i,n,r){let{azimuth:s,distance:l}=Wt(Rs,e,n,r);s??=0;let p=l*Math.cos((s-i)*Vr);p=Math.max(0,p),Nt(t,e,i,p,r)}const Rs=new Bt;function Ds(t,e){const i=U();return pn(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??Tn,i}function ie(t,e){if(qt(t)){const i=[];for(const n of t.constraints){const r=n.intersect(e);r&&i.push(r)}return ci(i)}if(qt(e))return ie(e,t);if(yt(t))return ki(t,e);if(yt(e))return ki(e,t);if(z(t)){const{point:i}=t;if(z(e))return E(i,e.point)?t:void 0;const n=e.closestTo(i);return Pr(n,i)?t:void 0}if(J(t)){if(z(e))return ie(e,t);if(J(e))return W(dn(t.lineLike,e.lineLike));if(ne(e))return Ls(t,e);if(X(e))return W(an(e.planeLike,t.lineLike));if(Y(e))return W(un(t.lineLike,e.center,e.radius));if(ue(e))return W(vs(t.lineLike,e));if(re(e))return Hs(t,e);if(se(e))return Is(t,e)}else if(ne(t)){if(z(e)||J(e))return ie(e,t);if(ne(e))return Us(t,e);if(X(e))return Ns(t,e);if(Y(e))return js(t,e);if(ue(e))return qs(t,e);if(re(e))return Vs(t,e);if(se(e))return zs(t,e)}else if(X(t)){if(z(e)||J(e)||ne(e))return ie(e,t);if(X(e))return xt(ln(t.planeLike,e.planeLike));if(Y(e))return xt(ei(t.planeLike,e.center,e.radius));if(ue(e))return Zs(t,e);if(re(e))return Fs(t,e);if(se(e))return Ws(t,e)}else if(Y(t)){if(z(e)||J(e)||ne(e)||X(e))return ie(e,t);if(Y(e))return xt(ti(t.center,t.radius,e.center,e.radius));if(ue(e))return void 0;if(re(e))return Bs(t,e);if(se(e))return void 0}else if(ue(t)){if(z(e)||J(e)||ne(e)||X(e)||Y(e))return ie(e,t);if(ue(e))return void 0;if(re(e))return e.asCircle(),void 0;if(se(e))return void 0}else if(re(t)){if(z(e)||J(e)||ne(e)||X(e)||Y(e)||ue(e))return ie(e,t);if(re(e))return Ks(e,t);if(se(e))return void 0}else if(se(t)){if(z(e)||J(e)||ne(e)||X(e)||Y(e)||re(e))return ie(e,t);if(se(e))return void 0}}const Ls=(()=>{const t=V();return(e,i)=>{const{start:n,end:r}=e;if(yn(n,r)&&w(n[2],i.z))return e;const s=U();return Xi(i.getPlane(t),n,r,s)?new xe(s):void 0}})();function Hs({lineLike:t},{center:e,radius:i}){const n=e[2];return W(un(t,e,i).filter(r=>w(r[2],n)))}function Is({lineLike:t},{sphere:e}){return W(Kr(e,t.start,t.end))}const pi=(()=>{const t=jr(),e=v(),i=v();return(n,r,s)=>{const{normal:l,center:p,radius:o}=r;Ji(l,e,i);const a=Kt(n),u=o*H(a,e),d=o*H(a,i);Ur(t,p[0],p[1],p[2],1);const m=Nr(n,t),y=Math.hypot(u,d),g=w(y,0);if(w(jt(n,p),0)){if(g)return r;if(w(o,0))return!s||ye(s,p)?new xe(Oe(p)):void 0;pt(e,a,l),Rr(e,e);const Tt=new Array,ze=le(p);k(ze,ze,e,o),s&&!ye(s,ze)||Tt.push(ze);const Fe=le(p);return k(Fe,Fe,e,-o),s&&!ye(s,Fe)||Tt.push(Fe),W(Tt)}if(g)return;const f=-m/y;if(Math.abs(f)>1||w(f,1))return;const _=Math.atan(u/d),$=Xn(f)-_,T=Math.PI-$,me=new Array,Ve=v();k(Ve,p,e,o*Math.cos($)),k(Ve,Ve,i,o*Math.sin($)),me.push(Ve);const qe=v();return k(qe,p,e,o*Math.cos(T)),k(qe,qe,i,o*Math.sin(T)),me.push(qe),W(s?bs(s,me):me)}})();function Us(t,e){return w(t.z,e.z)?t:void 0}function Ns({z:t},{planeLike:e}){const[i,n]=e.start,[r,s]=e.end,l=ge(i,n,t),p=ge(r,s,t);return e.type===0?new si(l,p):new $s(l,p)}function js(t,e){const[i,n]=e.center;return new oi(ge(i,n,t.z),e.radius)}function Vs(t,e){return w(e.center[2],t.z)?e:void 0}const qs=(()=>{const t=V();return(e,i)=>pi(e.getPlane(t),i,i.slicePlane)})();function zs(t,{center:e,radius:i}){const n=Math.abs(e[2]-t.z);if(n>i&&!w(n,i))return;const r=ge(e[0],e[1],t.z),s=Math.sqrt(i**2-n**2);return w(s,0)?void 0:new oi(r,s)}const Fs=(()=>{const t=V();return(e,{center:i,radius:n})=>{const r=ei(e.planeLike,i,n),s=i[2];e.getSlicePlane(t);const l=new Array;for(const[p,o]of r){const a=[p,o,s];ye(t,a)&&l.push(a)}return W(l)}})(),Zs=(()=>{const t=V(),e=V();return(i,n)=>pi(i.getPlane(t),n,i.getSlicePlane(e))})(),Ws=(()=>{const t=V();return(e,{center:i,radius:n})=>{const r=e.getPlane(t),s=Zr(r,i),l=Math.abs(s);if(l>n&&!w(l,n))return;const p=Math.sqrt(n**2-s**2);if(w(p,0)){const u=U();return Qi(r,i,u),new xe(u)}const o=U(),a=le(Kt(r));return k(o,i,a,s),new ai(o,p,a,e.getSlicePlane())}})();function Bs(t,e){const i=qi(t.center,e.center);return w(i,0)&&w(t.radius,e.radius)?e:Sn(ti(t.center,t.radius,e.center,e.radius),e.center[2])}function Ks(t,e){if(!yn(t.center,e.center))return;const i=qi(t.center,e.center);return w(i,0)&&w(t.radius,e.radius)?t:Sn(ti(t.center,t.radius,e.center,e.radius),t.center[2])}function ki(t,e){const{planeLike:i,getZ:n}=t,r=new Array;if(z(e))t.addIfOnTheGround(r,ms(i,e.point));else if(J(e))t.addIfOnTheGround(r,an(i,e.lineLike));else if(Y(e))for(const[s,l]of ei(i,e.center,e.radius)){const p=n(s,l);p!=null&&r.push(at(s,l,p))}else if(X(e)||yt(e))for(const[s,l]of ln(i,e.planeLike)){const p=n(s,l)??Tn;r.push(at(s,l,p))}return W(r)}function xt(t){return ci(t.map(([e,i])=>{const n=ge(e,i,0),r=ge(e,i,1);return new si(n,r)}))}function W(t){return ci(t.map(e=>e?new xe(e):void 0))}function Sn(t,e){return W(t.map(([i,n])=>[i,n,e]))}function ci(t){if(t.length!==0)return t.length===1?t[0]??void 0:new vn(t.filter(Vi))}function qt(t){return t instanceof vn}function z(t){return t instanceof xe}function J(t){return t instanceof ri}function ne(t){return t instanceof Os}function X(t){return t instanceof li}function Y(t){return t instanceof _n}function re(t){return t instanceof oi}function ue(t){return t instanceof ai}function se(t){return t instanceof xs}function yt(t){return t instanceof wn}function Js(t){return t instanceof ks}function Xs(t){return t instanceof As}const Tn=0;let Ae=class{constructor(e,i,n,r){this.targetPoint=e,this.constraint=i,this.isDraped=n,this.domain=r}},$n=class extends Ae{constructor({targetPoint:e,objectId:i,constraint:n,isDraped:r}){super(e,n,r,1),this.objectId=i}},St=class{constructor(e,i){this.isDraped=e,this.domain=i}},te=class En extends St{constructor(e,i,n,r,s=3,l=!0,p=!0){super(r,s),this.type=e,this.lineStart=i,this.lineEnd=n,this.fadeLeft=l,this.fadeRight=p}equals(e){return e instanceof En&&this.type===e.type&&E(this.lineStart,e.lineStart)&&E(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return He(this.lineStart,this.lineEnd)}},Ys=class extends $n{constructor(e){super({...e,isDraped:!0,constraint:new wn(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new te(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Qs=class extends $n{constructor(e){super({...e,constraint:new si(e.edgeStart,e.edgeEnd)})}get hints(){return[new te(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},eo=class On extends St{constructor(e,i,n=3){super(i,n),this.intersectionPoint=e}equals(e){return e instanceof On&&E(this.intersectionPoint,e.intersectionPoint)}},st=class extends Ae{constructor(e,i,n,r){super(e,new xe(e),r,3),this.first=i,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new eo(this.targetPoint,this.isDraped,this.domain)]}},to=class extends Ae{constructor({lineStart:e,lineEnd:i,targetPoint:n,isDraped:r}){super(n,new bn(e,i),r,2),this._referenceLineHint=new te(2,e,i,r,this.domain)}get hints(){return[this._referenceLineHint,new te(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},io=class Gn extends St{constructor(e,i,n,r=3){super(n,r),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof Gn&&E(this.lineStart,e.lineStart)&&E(this.lineEnd,e.lineEnd)}},no=class extends Ae{constructor({referenceLine:e,lineStart:i,targetPoint:n,isDraped:r}){const s=le(i),{left:l,right:p}=e;mt(s,Dr(s,s,p),l),super(n,new bn(i,s),r,2),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new te(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new io(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new te(1,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const i={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(n=>{E(e.right,n.edge.left)&&(n.fadeLeft=!1,i.fadeRight=!1),E(e.right,n.edge.right)&&(n.fadeRight=!1,i.fadeRight=!1),E(e.left,n.edge.right)&&(n.fadeRight=!1,i.fadeLeft=!1),E(e.left,n.edge.left)&&(n.fadeLeft=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}},Mn=class xn extends St{constructor(e,i,n,r,s=3){super(r,s),this.previousVertex=e,this.centerVertex=i,this.nextVertex=n}equals(e){return e instanceof xn&&E(this.previousVertex,e.previousVertex)&&E(this.centerVertex,e.centerVertex)&&E(this.nextVertex,e.nextVertex)}},ro=class extends Ae{constructor({targetPoint:e,constraint:i,previousVertex:n,otherVertex:r,otherVertexType:s,isDraped:l,selfSnappingType:p,objectId:o,domain:a}){super(e,i,l,a??2),this.previousVertex=n,this.otherVertex=r,this.otherVertexType=s,this.selfSnappingType=p??0,this.objectId=o??null}get hints(){const e=this.previousVertex,i=this.otherVertexType===1?this.otherVertex:this.targetPoint,n=this.otherVertexType===1?this.targetPoint:this.otherVertex;return[new te(0,i,n,this.isDraped,this.domain),new te(1,e,i,this.isDraped,this.domain),new Mn(this.previousVertex,i,n,this.isDraped,this.domain)]}},so=class extends Ae{constructor({targetPoint:e,point1:i,point2:n,isDraped:r}){super(e,new _n(Lr(v(),i,n,.5),.5*Yn(i,n)),r,2),this._p1=i,this._p2=n}get hints(){return[new te(1,this.targetPoint,this._p1,this.isDraped,this.domain),new te(1,this.targetPoint,this._p2,this.isDraped,this.domain),new Mn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function oo(t,e,i,n,r=v()){const s=Zt(ao,t);return s[2]=Zi(n,s,e,i)||0,n.renderCoordsHelper.toRenderCoords(s,e,r),r}const ao=v();function lo(t,e,i,n){return n.type==="2d"?(We.x=t[0],We.y=t[1],We.spatialReference=e,n.toScreen(We)):(oo(t,e,i,n,Ci),n.state.camera.projectToScreen(Ci,At),Qn(At[0],At[1]))}const We=Ne(0,0,0,null),Ci=v(),At=er();function el(t){return Ki(t)||zi(t)}function hi(t,e,i,...n){return Ki(t)?e.apply(void 0,n):t.isWebMercator?i.apply(void 0,n):null}function po(t){const{spatialReference:e}=t;return hi(e,go,fo,t)}function co(t,e){if(!ft(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return Be[0]=t.x,Be[1]=t.y,Be[2]=t.hasZ?t.z:0,Ke[0]=e.x,Ke[1]=e.y,Ke[2]=e.hasZ?e.z:0,An(Be,Ke,i)}function An(t,e,i){return hi(i,uo,yo,t,e,i)}const ho={geodesicLength:po,geodesicDistanceBetweenPoints:co,geodesicDistance:An};async function kn(){return await Qr(),ho}function uo(t,e,i){return fe(Wt(vo,t,e,i).distance,"meters")}function yo(t,e,i){return fe(en(mo(t,e,i),{unit:"meters"}),"meters")}function go(t){return fe(qr([t],"meters")[0],"meters")}function fo(t){return fe(en(t,{unit:"meters"}),"meters")}function mo(t,e,i){return new tr({spatialReference:i,paths:[[[...t],[...e]]]})}const vo=new Bt,Be=v(),Ke=v();let F=class extends zt{constructor(t){super(t),this.options=new x,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([de(()=>{const{distance:t,touchSensitivityMultiplier:e,effectiveSelfEnabled:i,effectiveFeatureEnabled:n,effectiveGridEnabled:r}=this.options;return{selfEnabled:i,featureEnabled:n,gridEnabled:this.view.type==="2d"&&r,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:t,touchSensitivityMultiplier:e}},(t,e)=>{e&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=Ar(i=>this._updateEngines(t,e,i))},$e),de(()=>this.options,t=>{for(const e of this._engines)e.options=t},ir)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(t=>t.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(t=>t.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(t,e,i){if(!t.viewReady)return void this._destroyEngines();e?.viewSpatialReference!==t.viewSpatialReference&&this._destroyEngines();const n=this._engineCache,r=await Promise.allSettled([t.featureEnabled&&!n.has("feature")?this._createFeatureSnappingEngine(i):void 0,t.selfEnabled&&!n.has("self")?this._createSelfSnappingEngine(i):void 0,t.gridEnabled&&!n.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const s of r)s.status==="fulfilled"&&s.value?.engine.destroy();else{for(const s of r)s.status==="fulfilled"&&s.value&&n.set(s.value.type,s.value.engine);this._engines=Array.from(n.values())}}async _createSelfSnappingEngine(t){const[{SelfSnappingEngine:e},i]=await Promise.all([P(()=>import("./SelfSnappingEngine-BuBV7wfH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]),import.meta.url),kn()]);return $t(t),{type:"self",engine:new e({view:this.view,options:this.options,geodesicLengthMeasurementUtils:i})}}async _createGridSnappingEngine(t){const{view:e}=this;if(e.type!=="2d")return;const{GridSnappingEngine:i}=await P(()=>import("./GridSnappingEngine-5S_woSbs.js"),__vite__mapDeps([49,1,2,3,11,13,14,15,50,4,51,52,53,54,55,17,18,19,20,21,22,23,24,25,26,27,7,8,28,29,30,31,32,33,6,12,16,34,35,36,10,37,38,39,40,41,42,5,43,44,45,46,47,48]),import.meta.url);return $t(t),{type:"grid",engine:new i({view:e,options:this.options})}}async _createFeatureSnappingEngine(t){const{FeatureSnappingEngine:e}=await P(()=>import("./FeatureSnappingEngine-BXDRxHW_.js"),__vite__mapDeps([56,2,1,3,57,33,11,18,6,7,8,58,34,35,36,59,60,13,14,15,19,20,21,22,23,24,25,26,27,28,29,30,31,32,12,16,10,37,38,17,39,40,41,42,5,43,44,45,46,47,48]),import.meta.url);$t(t);const{view:i,options:n}=this,{spatialReference:r}=i;return{type:"feature",engine:new e({view:i,options:n,spatialReference:r})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:t,touchSensitivityMultiplier:e}=this.options,i=t*e;return i*i}snap(t){return wo(t)?this._snapMultiPoint(t):this._snapSinglePoint(t)}update(t){const{point:e,context:i}=t;this._removeVisualization();const n=this._currentMainCandidate;if(n==null)return e;const r=this._selectUpdateInput(t);if(r==null)return e;const{spatialReference:s}=i,l=Ht(r,s);if(l==null)return e;const{view:p}=this,{elevationInfo:o,visualizer:a}=i,u=[],d=Le(l,p,o),m=n.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,m,i)||!Ct(n,i.drawConstraints))return this._resetSnappingState(),e;n.targetPoint=Ot(m),u.push(...n.hints);for(const y of this._currentOtherActiveCandidates)Ct(y,i.drawConstraints)&&(y.targetPoint=Ot(m),u.push(...y.hints));return a!=null&&this.addHandles(a.draw(u,{spatialReference:s,elevationInfo:So(i),view:p,selfSnappingZ:i.selfSnappingZ}),kt),Ei(m,p,e,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:t,scenePoint:e}){switch(this._currentSnappedType){case 0:return t;case 1:return e}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(kt)}async _snapSinglePoint({point:t,context:e,signal:i}){const{view:n}=this,{elevationInfo:r}=e,s=Le(t,n,r),l=await this._fetchCandidates(s,3,e,i);return this._createSnapResult(s,0,l,n,t,e,i)}async _snapMultiPoint({point:t,scenePoint:e,context:i,signal:n}){const{view:r}=this,{coordinateHelper:s,elevationInfo:l,spatialReference:p}=i;await Sr(e.spatialReference,p);const o=Ht(e,p),a=Le(o,r,l),u=await this._fetchCandidates(a,1,i,n);if(u.length>0){const y=await this._fetchCandidates(a,2,i,n);return this._createSnapResult(a,1,[...u,...y],r,o,i,n)}const d=Le(t,r,l),m=await this._fetchCandidates(d,2,i,n);return this._createSnapResult(d,0,m,r,{z:s.hasZ()&&t.hasZ?t.z??0:void 0,m:s.hasM()&&t.hasM?t.m??0:void 0},i,n)}async _fetchCandidates(t,e,i,n){return(await Promise.all(this._engines.map(r=>r.fetchCandidates(t,e,i,n)))).flat()}_createSnapResult(t,e,i,n,r,s,l){return{get valid(){return!nr(l)},apply:()=>{const{spatialReference:p}=s,{snappedPoint:o,hints:a}=this._processCandidates(t,e,i,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(a,{spatialReference:p,elevationInfo:Ee,view:n,selfSnappingZ:s.selfSnappingZ}),kt),Ei(o,n,r,s)}}}_processCandidates(t,e,i,n){if(i.length<1)return this.doneSnapping(),{snappedPoint:t,hints:[]};this._currentSnappedType!==e&&this._resetSnappingState(),hs(t,i);const r=this._currentMainCandidate;if(r!=null){const s=bo(r,i);if(s>=0){if(!(i[s]instanceof st))return this._intersectWithOtherCandidates(s,i,t,e,n);if(this._arePointsWithinScreenThreshold(t,r.targetPoint,n))return this._updateSnappingCandidate(r,e,i,n)}}return this._intersectWithOtherCandidates(0,i,t,e,n)}_intersectWithOtherCandidates(t,e,i,n,r){const{coordinateHelper:s}=r,l=e[t],p=[];for(let o=0;o<e.length;++o){if(o===t)continue;const a=e[o],u=l.constraint.intersect(a.constraint);if(u)for(const d of u.closestPoints(l.targetPoint))p.push([new st(Ot(d),l,a,a.isDraped),this._squaredScreenDistance(i,d,s)])}return p.length>0&&(p.sort((o,a)=>o[1]-a[1]),p[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(p[0][0],n,e,r):Ct(l,r.drawConstraints)?this._updateSnappingCandidate(l,n,e,r):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(t,e,i,n){this.doneSnapping(),this._currentMainCandidate=t,this._currentSnappedType=e;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...t.hints);for(const l of i){if(t instanceof st){if(l.constraint.equals(t.first.constraint)||l.constraint.equals(t.second.constraint))continue}else if(l.constraint.equals(t.constraint))continue;const p=l.constraint.closestTo(r);this._squaredScreenDistance(p,r,n.coordinateHelper)<_o()&&(l.targetPoint=r,this._currentOtherActiveCandidates.push(l),s.push(...l.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(t){return t==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(t,e,i){return this._squaredScreenDistance(t,e,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(t,e,i){return sn(this._toScreen(t,i),this._toScreen(e,i))}_toScreen(t,e){return lo(t,e.spatialReference,Ee,this.view)}get test(){}};c([h({constructOnly:!0})],F.prototype,"view",void 0),c([h()],F.prototype,"options",void 0),c([h({readOnly:!0})],F.prototype,"updating",null),c([h()],F.prototype,"_loadTask",void 0),c([h()],F.prototype,"_engines",void 0),c([h()],F.prototype,"_squaredMouseProximityThreshold",null),c([h()],F.prototype,"_squaredTouchProximityThreshold",null),F=c([R("esri.views.interactive.snapping.SnappingManager")],F);const kt="visualization-handle";function _o(){return ht.satisfiesConstraintScreenThreshold*ht.satisfiesConstraintScreenThreshold}function Ct(t,e){return!e||e.direction==null&&e.distance==null||!(t instanceof Ys||t instanceof Qs||t instanceof to||t instanceof no||t instanceof so)&&(!(t instanceof ro)||e.direction==null&&t.selfSnappingType===1)}function bo(t,e){return t instanceof st?Pt(e,t.first)>=0&&Pt(e,t.second)>=0?0:-1:Pt(e,t)}function Pt(t,e){let i=-1;for(let n=0;n<t.length;++n)if(e.constraint.equals(t[n].constraint)){i=n;break}return i}function wo(t){return t.scenePoint!=null}function So({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?Ee:e}function ui(t){return rr(t)?sr(t)||zi(t)||or(t)||ar(t)?is:t:ns(t)}function To(t,e=gt()){return Cn(t,e)}function $o(t,e=gt()){return Cn(t,e,!1)}function Cn(t,e,i=t.hasZ){const n=ui(t.spatialReference),r=lr(n);if(r==null)return null;const s=(p,o)=>!(o.length<2)&&(ee(p,o[0],o[1],i&&o[2]||0),!0);let l=0;for(const p of t.rings){const o=p.length;if(o<3)continue;const{positionsWorldCoords:a}=e;for(;a.length<o;)a.push(v());const u=Eo,d=ee(Oo,0,0,0),m=1/o;for(let f=0;f<o;f++){if(!s(u,p[f])||!it(u,t.spatialReference,a[f],n))return null;k(d,d,a[f],m)}const y=Yi(a[0],a[1],d,Wr());if(Bi(Kt(y))===0)continue;for(let f=0;f<o;f++)Br(y,d,a[f],a[f]);const g=Go(a);for(let f=0;f<g.length;f+=3)l+=ts(a[g[f]],a[g[f+1]],a[g[f+2]])}return Jt(l,r)}const Eo=v(),Oo=v();function gt(){return{positionsWorldCoords:[]}}function Go(t){return es(Mo(t),[],2)}function Mo(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const n=t[i],r=2*i;e[r]=n[0],e[r+1]=n[1]}return e}const xo=t=>({geodesicArea(e){const{spatialReference:i}=e;return hi(i,ko,n=>Co(t,n),e)}});async function Ao(){const t=await P(()=>import("./geometryEngine-Cm1lhs9h.js"),__vite__mapDeps([61,1,2,3,62,63]),import.meta.url);return xo(t)}function ko(t){return Jt(Math.abs(zr([t],"square-meters")[0]),"square-meters")}function Co(t,e){try{return Jt(Math.abs(t.geodesicArea(e,"square-meters")),"square-meters")}catch{return null}}const Po=t=>({autoAreaByElevationMode(e,i,n=gt()){if(i==="on-the-ground"){const r=t.geodesicArea(e);return r??$o(e,n)}return To(e,n)},autoArea2D(e,i=gt()){return this.autoAreaByElevationMode(e,"on-the-ground",i)}});let Rt=null;async function Je(){return Rt||(Rt=Po(await Ao())),Rt}function Ro(t){return Do(t)}function Do(t,e){const{hasZ:i,spatialReference:n}=t,r=ui(n);let s=0;const l=Fi(r);if(l==null)return null;const p=di;for(const o of t.paths){if(o.length<2)continue;const a=o.length-1;for(let u=0;u<a;++u){const d=o[u];N[0]=d[0],N[1]=d[1],N[2]=i?d[2]:0;const m=o[u+1];j[0]=m[0],j[1]=m[1],j[2]=i?m[2]:0;const y=p(N,j,n);if(y==null)return null;s+=y.value}}return fe(s,l)}function Lo(t,e){const{spatialReference:i}=t;return ft(i,e.spatialReference)?(N[0]=t.x,N[1]=t.y,N[2]=t.hasZ?t.z:0,j[0]=e.x,j[1]=e.y,j[2]=e.hasZ?e.z:0,di(N,j,i)):null}function tl(t,e){const{spatialReference:i}=t;return ft(i,e.spatialReference)?(N[0]=t.x,N[1]=t.y,N[2]=t.hasZ?t.z:0,j[0]=e.x,j[1]=e.y,j[2]=e.hasZ?e.z:0,Io(N,j,i)):null}function il(t){return t!=null?Ho(t.hasZ?t.z:0,t.spatialReference):null}function Ho(t,e){const i=pr(e);return i!=null?fe(t??0,i):null}function di(t,e,i){const n=Pn(t,e,i,1);return n!=null?fe(n.horizontal,n.unit):null}function Io(t,e,i){const n=Pn(t,e,i,2);return n!=null?fe(n.verticalSigned,n.unit):null}function Pn(t,e,i,n){const r=ui(i),s=Fi(r);if(s==null)return null;const l=e[2]-t[2];if(n===2)return{verticalSigned:l,unit:s};if(!it(t,i,Dt,r)||!it(e,i,Xe,r))return null;if(n===0)return{direct:He(Xe,Dt),unit:s};if(ee(Ye,t[0],t[1],e[2]),!it(Ye,i,Ye,r))return null;const p=He(Ye,Xe);return n===1?{horizontal:p,unit:s}:{direct:He(Xe,Dt),horizontal:p,vertical:Math.abs(l),unit:s}}const N=v(),j=v(),Dt=v(),Xe=v(),Ye=v();function Uo(t){return{autoLength2D:e=>t.geodesicLength(e)??Ro(e),autoDistanceBetweenPoints2D:(e,i)=>t.geodesicDistanceBetweenPoints(e,i)??Lo(e,i),autoDistance2D:(e,i,n)=>(Pe[0]=e[0],Pe[1]=e[1],Pe[2]=e.length===3?e[2]:0,Re[0]=i[0],Re[1]=i[1],Re[2]=i.length===3?i[2]:0,t.geodesicDistance(Pe,Re,n)??di(Pe,Re,n))}}async function ve(){return Uo(await kn())}const Pe=v(),Re=v();function No(t){return t?.type==="graphic"}function jo(t){return t.find(No)??null}class Rn{constructor(e){this.layer=e}get elevationInfo(){return this.layer.elevationInfo}add(e){this.layer.add(e)}addMany(e){this.layer.addMany(e)}onGraphicsChange(e){const{layer:i}=this;return Ft(()=>i.graphics,"change",n=>e(n))}has(e){return e.layer===this.layer}remove(e){this.layer.remove(e)}removeMany(e){this.layer.removeMany(e)}removeAll(){this.layer.removeAll()}}c([h()],Rn.prototype,"elevationInfo",null);class Dn{constructor(e){this.layer=e}get elevationInfo(){}add(e,i){(this._getSublayerForCreateTool(i)??this._getSublayerForGraphic(e))?.add(e)}addMany(e,i){if(i){const n=this._getSublayerForCreateTool(i);if(n)return void n.addMany(e)}e.forEach(n=>this._getSublayerForGraphic(n)?.add(n))}onGraphicsChange(e){const{layer:i}=this;if(i.sublayers?.length)return cr(i.sublayers?.toArray().map(n=>Ft(()=>n.graphics,"change",r=>e(r))))}has(e){const{layer:i}=this;return e.layer===i||e.sourceLayer===i||!!i.sublayers?.some(n=>e.layer===n||e.sourceLayer===n)}remove(e){this._getSublayerForGraphic(e)?.remove(e)}removeMany(e){e.forEach(i=>this._getSublayerForGraphic(i)?.remove(i))}removeAll(){this.layer.sublayers?.forEach(e=>e.removeAll())}_getSublayerForCreateTool(e){const{layer:i}=this;switch(e){case"point":return i.pointLayer;case"polyline":return i.polylineLayer;case"polygon":return i.polygonLayer;case"multipoint":return i.multipointLayer;case"text":return i.textLayer}}_getSublayerForGraphic(e){const{layer:i}=this;if(e?.geometry)switch(e.geometry.type){case"point":return e.symbol?.type==="text"?i.textLayer:i.pointLayer;case"polyline":return i.polylineLayer;case"polygon":return i.polygonLayer;case"multipoint":return i.multipointLayer}}}c([h()],Dn.prototype,"elevationInfo",null);let A=class extends zt{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){const{activeComponent:t}=this;if(!t)return null;switch(t.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":return t.graphicSymbol?.type==="text"?"text":t.geometryType;case"draw-3d":return t.geometryType}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};c([h()],A.prototype,"activeComponent",void 0),c([h()],A.prototype,"cancelled",void 0),c([h()],A.prototype,"history",void 0),c([h()],A.prototype,"tool",null),c([h()],A.prototype,"type",void 0),c([h()],A.prototype,"canUndo",null),c([h()],A.prototype,"canRedo",null),c([h()],A.prototype,"onEnd",void 0),c([h()],A.prototype,"undo",null),c([h()],A.prototype,"redo",null),c([h()],A.prototype,"toggleTool",void 0),c([h()],A.prototype,"addToSelection",void 0),c([h()],A.prototype,"removeFromSelection",void 0),A=c([R("esri.widgets.Sketch.support.OperationHandle")],A);let ot=class extends A{};c([h()],ot.prototype,"activeComponent",void 0),ot=c([R("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],ot);let ae=class extends A{};c([h()],ae.prototype,"activeComponent",void 0),ae=c([R("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],ae);function Vo(t,e){return e==="freehandPolygon"||e==="freehandPolyline"?"freehand":t??(e==="rectangle"||e==="circle"?"hybrid":"click")}function qo(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";case"text":return"point";default:return t}}function Pi(t){if(t.length>1)return!1;const e=t.at(0)?.geometry;return e?.type==="point"||e?.type==="multipoint"&&e.points.length<2}const Ri={defaultZ:0},De={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:xr},tool:"transform"},Lt=Symbol(),Di=Symbol();let b=class extends zt{constructor(t){super(t),this._defaultSnappingManager=null,this._internalGraphicsLayer=new Or({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._updatingHandles=new wr,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new gi({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new hr({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new ur({color:[130,130,130,1],width:2}),this.meshSymbol=new dr({symbolLayers:new _e([new yr])}),this.textSymbol=new gr({text:"text"}),this.updateGraphics=new _e,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new gi({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new nn,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{const{_layerAdapter:e}=this;if(this.removeHandles(Di),!e)return;const i=[e.onGraphicsChange(n=>this._onLayerGraphicsChangeCallback(n)),de(()=>e.elevationInfo,n=>{n!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=n)},$e)].filter(Vi);this.addHandles(i,Di)},this._originalPopupEnabled=null,this.defaultCreateOptions=Ri,this.defaultUpdateOptions=De,this.snappingOptions=t?.snappingManager?.options??t?.snappingOptions??new x}initialize(){this.addHandles([Ft(()=>this.view?.map?.layers,"change",t=>{this.layer&&t.removed.includes(this.layer)&&this.cancel()}),de(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),$e),de(()=>this.view,t=>{this._defaultSnappingManager=Ze(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new F({view:t,options:this.snappingOptions})),t.type==="2d"?P(()=>import("./editingTools-D8Uf3R9a.js"),__vite__mapDeps([64,1,2,3,65,10,66,67,11,5,68,33,69,70,26,71,41,37,72,73,74,29,30,31,32,18,75,76,77,78,79,80,81,6,7,8,82,4,83,9,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,91,92,93,94,95,38,39,40,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,42,47,117,118,119,120,121,122,28,34,35,36,43,44,45,46,48]),import.meta.url):t.type==="3d"&&(P(()=>import("./ImageMaterial.glsl-Bu223aj-.js").then(e=>e.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url),P(()=>import("./LineCallout.glsl-DIW2AAzv.js").then(e=>e.G),__vite__mapDeps([162,1,2,3,163,164,13,14,15,16,12,6,7,8,126,11,38,127,71,41,37,48,128,26,39,40,10,129,130,131,4,132,133,46,42,47,134,135,125,50,51,52,53,136,137,138,139,140,141,73,74,98,142,143,94,18,165,160,30,166,148,35,36,167,168,169,170,171,172,173,25,69,174,175,150,149,176,99,31,100,177,178,179,33,180,181,182,183,184,185,29,32,60,186,187]),import.meta.url)))},$e),de(()=>this.view?.spatialReference,(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),ds(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=Ze(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get _layerAdapter(){const{layer:t}=this;switch(t?.type){case"graphics":return new Rn(t);case"map-notes":return new Dn(t);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:t,destroyed:e}=this,i=!e&&t&&"tooltip"in t?t.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...Ri,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...De,...t,reshapeOptions:{...De.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...De.highlightOptions,...t?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(t){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=Ze(this._defaultSnappingManager)),this._override("snappingManager",t);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new F({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const t=!(!this.view?.ready||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:n,map:r}=e;n&&this._clearCursor(),r?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),t&&this.addHandles(fr(()=>t.ready,n=>{this.removeHandles(this._viewHandlesKey),n&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},$e),i),this._set("view",t)}addGraphic(t){this._layerAdapter?.add(t)}addGraphics(t){this._layerAdapter?.addMany(t)}hasGraphic(t){return!!this._layerAdapter?.has(t)}removeGraphic(t){this._layerAdapter?.remove(t)}removeGraphics(t){this._layerAdapter?.removeMany(t)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=Et(this._moduleLoaderAbortController),this._viewReadyAbortController=Et(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:i}=this,n=e.toArray();this.removeGraphics(n),this.cancel(),this._emitDeleteEvent({graphics:n,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.addGraphics(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:i,layer:n}=this;if(!i||this.state==="disabled")throw n||this._logMissingLayer(),fi();if(i.activeTool!=null&&(i.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Ti(i,this._internalGraphicsLayer);const r=await this._updatingHandles.addPromise(this._setupCreateOperation(t,e));if(r==null||this.destroyed)return void i.map?.remove(this._internalGraphicsLayer);const s=()=>{if(r===this._operationHandle){const l=this.createGraphic,p=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map?.remove(this._internalGraphicsLayer),r.cancelled||l==null||this.addGraphic(l),this._sketchContinuationFlag=!1,this.emit("create",{graphic:l,state:p?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),p||this._sketchContinuationFlag)return;const{creationMode:o}=this;if(o==="continuous"){if(e?.geometryToPlace)return;this._updatingHandles.addPromise(_i(this.create(t,e)))}else o==="update"&&l&&this._updatingHandles.addPromise(_i(this.update([l])))}};r.on("complete",s),this._operationHandle=r,i.ready&&i.focus()}async place(t,e){return await t.load(),this.create("mesh",{mode:"click",hasZ:t.hasZ,geometryToPlace:t,...e})}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:i,view:n,state:r}=this;if(!n||r==="disabled")throw i||this._logMissingLayer(),fi();n.activeTool!=null&&(n.activeTool=null);const s=Array.isArray(t)?t:[t];if(t==null||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(p=>this.hasGraphic(p)?p.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0)))return;const l=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,e));this.destroyed||l==null||G(l)||(Ti(n,this._internalGraphicsLayer),this._setUpdateOperationHandle(l,e),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:l.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){t=Array.isArray(t)?t:[t];for(const i of t)i.geometry==null||i.geometry.type==="mesh"||ft(i.geometry.spatialReference,e.spatialReference)||(Tr(i.geometry.spatialReference,e.spatialReference)||$r()||await Er(),i.geometry=Ht(i.geometry,e.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const r=[];e.map.allLayers.forEach(l=>{l.type!=="vector-tile"&&l.type!=="imagery"||r.push(l)});const s=await e.hitTest(t,{exclude:r});return jo(s.results)}const i=[e.map.ground];e.map.allLayers.forEach(r=>{mr(r)&&i.push(r)});const n=await e.hitTest(t,{exclude:i});if(n.results.length>0){const r=n.results[0];if(r!=null&&r.type==="graphic"&&r.graphic&&(!n.ground.mapPoint||e.map.ground.opacity<1||n.ground.distance-(r.distance??0)>-Math.min(3*n.ground.distance,e.viewingMode==="global"?vr(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return r}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},M.WIDGET)]}async _handleImmediateClick(t){const e=await t.defer(()=>this._getFirstHit(wi(t)));let i=null;if(e!=null){const n=e.graphic;this.updateGraphics.includes(n)||this.hasGraphic(n)?(t.stopPropagation(),i=n):this.view?.type!=="2d"||this._isComponentGraphic(n)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(t,e){const i=this.view;if(!i)return this._logMissingView(),null;const n={hasZ:i.type==="3d",...this.defaultCreateOptions,...e},r=await this._setupDrawGraphicTool(t,i,n);return r==null?null:(i.tools.add(r),i.activeTool=r,this._setupCreateOperationHandle(r,t))}async _setupDrawGraphicTool(t,e,i){if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const{cursor:n,defaultZ:r,hasZ:s,geometryToPlace:l,graphicProperties:p,mode:o,preserveAspectRatio:a}=i,u=Vo(o,t),d=qo(t),m=i?.optionsPerTool?.has(t)?i.optionsPerTool.get(t):{},y=m?.preserveAspectRatio??a??t!=="rectangle",g={centered:t!=="rectangle"&&!(t==="circle"&&!y),cursor:n,defaultZ:r,forceUniformSize:y,graphicProperties:{...p,attributes:{...p?.attributes}},geometryToPlace:l,geometryType:d,mode:u,graphicSymbol:this._getGraphicSymbolFromTool(t),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:e,...m};return e.type==="2d"?this._makeDrawGraphicTool2D(g):this._makeDrawGraphicTool3D(g)}async _makeDrawGraphicTool2D(t){const[e,i,n]=await Promise.all([this._requireModule(P(()=>import("./editingTools-D8Uf3R9a.js"),__vite__mapDeps([64,1,2,3,65,10,66,67,11,5,68,33,69,70,26,71,41,37,72,73,74,29,30,31,32,18,75,76,77,78,79,80,81,6,7,8,82,4,83,9,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,91,92,93,94,95,38,39,40,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,42,47,117,118,119,120,121,122,28,34,35,36,43,44,45,46,48]),import.meta.url)),Je(),ve()]);return G(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Fo(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}async _makeDrawGraphicTool3D(t){const[e,i,n]=await Promise.all([this._requireModule(P(()=>import("./ImageMaterial.glsl-Bu223aj-.js").then(r=>r.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url)),Je(),ve()]);return G(e)||this.destroyed?null:new e.module.DrawGraphicTool3D({...t,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}_setupCreateOperationHandle(t,e){const i=this.view;if(!i)return this._logMissingView(),null;let n=null;const r=t.forceUniformSize,s=t.centered,l=[i.on("key-down",o=>{if(o.key===O.pan)o.stopPropagation(),o.repeat||(t.enabled=!1);else if(o.key===O.complete)o.stopPropagation(),t.completeCreateOperation();else if(o.key!==O.vertexAdd||o.repeat)o.key===O.undo?(o.stopPropagation(),p.undo()):o.key===O.redo?(o.stopPropagation(),p.redo()):o.key!==O.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||o.repeat?o.key===O.center&&(o.repeat||(t.centered=!s,o.stopPropagation())):(t.forceUniformSize=!r,o.stopPropagation());else{const a=t.drawOperation.geometryType;a!=="polyline"&&a!=="polygon"&&a!=="multipoint"||(o.stopPropagation(),t.drawOperation.commitStagedVertex())}},M.WIDGET),i.on("key-up",o=>{o.key===O.pan?t.enabled=!0:o.key!==O.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?o.key===O.center&&(t.centered=s,o.stopPropagation()):(t.forceUniformSize=r,o.stopPropagation())},M.WIDGET),t.on("vertex-add",o=>{switch(n=n==null?"start":"active",o.operation){case"apply":this.emit("create",{graphic:t.graphic,state:n,tool:this.activeTool,toolEventInfo:o,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",o=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:o.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",o=>{switch(o.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:o,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",o=>{this._set("createGraphic",o.graphic),n="complete",o.aborted?p&&p.cancel():p&&p.complete()}),de(()=>this._getGraphicSymbolFromTool(e),o=>{t.graphicSymbol=o})],p=new ot({activeComponent:t,type:"create",onEnd:()=>{K(l),i.tools?.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return p}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol;case"text":return this.textSymbol}}async _setupUpdateOperation(t,e){const{view:i}=this;if(!i)return this._logMissingView(),null;const n={...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...e?.highlightOptions}};let r=n.tool??De.tool;if(this.removeGraphics(t),this.addGraphics(t),i.type==="3d"){if(t.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(t,n,i,r);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(t[0],n,i);case"transform":return this._setupGraphicTransform3DOperation(t,n,i)}}switch(r){case"move":return this._setupMove2DOperation(t,n,i);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(t,r,n,i);case"transform":return Pi(t)&&(r="reshape"),this._setupTransformOrReshape2DOperation(t,r,n,i)}}async _setupMove3DOperation(t,e,i,n,r=!1){const[s,l]=await Promise.all([this._requireModule(P(()=>import("./ImageMaterial.glsl-Bu223aj-.js").then(g=>g.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url)),ve()]);if(G(s))return s;const{ManipulatedObject3DGraphic:p,MoveTool3D:o}=s.module,a=new Map,u=()=>{a.forEach(g=>g.destroy()),a.clear()};for(const g of t){const f=new p({view:i,graphic:g}),_=rs(f);if(_!==0)return u(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Si(_)}).`),null;a.set(g,f)}const d=new o({view:i,enableZ:e.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:l});i.tools.add(d),d.objects.addMany(Array.from(a.values())),r||this.updateGraphics.addMany(t);const m=[],y=new ae({activeComponent:d,tool:n,type:"update",onEnd:()=>{K(m),tt(i,d),u()},undo:()=>{Hi(this.view,d),Qe(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{et(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:g=>{this.updateGraphics.push(g);const f=new p({view:i,graphic:g});a.set(g,f),d.objects.push(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:g=>{const f=this.updateGraphics.indexOf(g);if(y.history.undo.forEach($=>$.updates.splice(f,1)),y.history.redo.forEach($=>$.updates.splice(f,1)),this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void y.complete();const _=a.get(g);_&&(d.objects.remove(_),_.destroy(),a.delete(g))},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||n!=="transform")return;const g=this.updateGraphics.at(0),f=await this._setupReshape3DOperation(g,e,i,!0);f&&!G(f)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(f,e))}});return m.push(...this._getHandlesForComponent(y,e),i.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,e),M.WIDGET),i.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},M.WIDGET)),y}_setupGraphicTransform3DOperation(t,e,i,n=!1){if(t.length===1&&as(t[0])===0){const r=t[0],s=r.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(r,e,i);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(r,e,i,n)}return this._setupMove3DOperation(t,e,i,"transform",n)}async _setupPointTransform3DOperation(t,e,i){const n="transform",{enableRotation:r,enableScaling:s,enableZ:l}=e,p=await this._requireModule(P(()=>import("./ImageMaterial.glsl-Bu223aj-.js").then(g=>g.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url));if(G(p))return p;const{TransformTool3D:o,ManipulatedObject3DGraphic:a}=p.module,u=new a({graphic:t,view:i}),d=new o({object:u,view:i,enableRotation:r,enableScaling:s,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(d),this.updateGraphics.add(t);const m=[],y=new ae({activeComponent:d,tool:n,type:"update",onEnd:()=>{K(m),tt(i,d),u.destroy()},undo:()=>{Hi(this.view,d),Qe(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{et(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const f=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);G(f)||this._setUpdateOperationHandle(f,e)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return m.push(...this._getHandlesForComponent(y,e),i.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,e),M.WIDGET),i.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},M.WIDGET)),y}async _setupPolyTransform3DOperation(t,e,i,n=!1){const r="transform",{enableRotation:s,enableScaling:l,enableZ:p,preserveAspectRatio:o}=e,[a,u]=await Promise.all([this._requireModule(P(()=>import("./ImageMaterial.glsl-Bu223aj-.js").then(T=>T.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url)),ve()]);if(G(a))return a;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:m}=a.module,y=this.view?.inputManager?.isModifierKeyDown(O.constraint),g=new d({view:i,graphic:t}),f=new m({object:g,view:i,enableRotation:s,enableScaling:l,enableZ:p,preserveAspectRatio:!!o!=!!y,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:u});i.tools.add(f),n||this.updateGraphics.add(t);const _=[],$=new ae({activeComponent:f,tool:r,type:"update",onEnd:()=>{K(_),tt(i,f),g.destroy()},canUndo:()=>!f.destroyed&&f.canUndo,undo:()=>{f.destroyed||(f.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!f.destroyed&&f.canRedo,redo:()=>{f.destroyed||(f.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async T=>{this.updateGraphics.add(T),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[T],removed:[],type:"selection-change"},type:"update"}),$.onEnd(),$.destroy();const me=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);G(me)||this._setUpdateOperationHandle(me,e)},removeFromSelection:T=>{this.updateGraphics.remove(T),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[T],type:"selection-change"},type:"update"}),$.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const T=await this._setupReshape3DOperation(t,e,i,!0);T&&!G(T)&&($.onEnd(),$.destroy(),this._setUpdateOperationHandle(T,e))}});return _.push(...this._getHandlesForComponent($,e),i.on("immediate-click",T=>this._getCommonUpdateOperationClickHandlers($,T,e),M.WIDGET),i.on("key-down",T=>this._getCommonUpdateOperationKeyDownHandlers($,T),M.WIDGET),i.on("key-down",T=>{T.key!==O.constraint||T.repeat||(f.preserveAspectRatio=!f.preserveAspectRatio,T.stopPropagation())},M.WIDGET),i.on("key-up",T=>{T.key===O.constraint&&(f.preserveAspectRatio=!f.preserveAspectRatio,T.stopPropagation())},M.WIDGET)),$}async _setupMove2DOperation(t,e,i){const n="move";this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const r=await this._getGraphicMover(t,e,i);if(G(r))return r;const s=new ae({activeComponent:r,tool:n,type:"update",onEnd:()=>{this._clearCursor(),K(o),K(p),r.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const a=this.updateGraphics.toArray();Qe(s,a),s.refreshComponent(),this._emitUndoEvent({graphics:a,tool:n})},redo:()=>{const a=this.updateGraphics.toArray();et(s,a),s.refreshComponent(),this._emitRedoEvent({graphics:a,tool:n})},addToSelection:async a=>{await this._updatingHandles.addPromise(this._updateSpatialReference(a)),this.updateGraphics.push(a),r.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[a],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:a=>{const u=this.updateGraphics.indexOf(a);s.history.undo.forEach(m=>m.updates.splice(u,1)),s.history.redo.forEach(m=>m.updates.splice(u,1)),this.updateGraphics.remove(a);const d=this.updateGraphics.toArray();this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[a],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?r.graphics=d:s.complete()}});let l=!1;const p=[i.on("immediate-click",a=>this._getCommonUpdateOperationClickHandlers(s,a,e),M.WIDGET),i.on("key-down",a=>{this._getCommonUpdateOperationKeyDownHandlers(s,a),a.key!==O.constraint||a.repeat||(l=!0,r.enableMoveAllGraphics=!r.enableMoveAllGraphics)},M.WIDGET),i.on("key-up",a=>{a.key===O.constraint&&l&&(l=!1,r.enableMoveAllGraphics=!r.enableMoveAllGraphics)},M.WIDGET)],o=this._getHandlesForComponent(s,e);return s}async _setupReshape3DOperation(t,e,i,n=!1){const r="reshape",[s,l,p]=await Promise.all([this._requireModule(P(()=>import("./ImageMaterial.glsl-Bu223aj-.js").then(_=>_.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url)),Je(),ve()]);if(G(s))return s;const{ManipulatedObject3DGraphic:o,ReshapeTool3D:a}=s.module,u=new o({view:i,graphic:t}),d=ss(u);if(d!==0)return u.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Si(d)}).`),null;const m=e.reshapeOptions,y=new a({view:i,object:u,enableZVertex:e.enableZ&&m?.vertexOperation==="move",enableZShape:e.enableZ&&m?.shapeOperation==="move",enableMoveObject:m?.shapeOperation==="move"||m?.shapeOperation==="move-xy",enableMidpoints:m?.edgeOperation==="split",enableEdgeOffset:m?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:p});i.tools.add(y),n||this.updateGraphics.add(u.graphic);const g=[],f=new ae({activeComponent:y,tool:r,type:"update",onEnd:()=>{K(g),tt(i,y),u.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),f.onEnd(),f.destroy();const $=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);G($)||this._setUpdateOperationHandle($,e)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),f.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;f.onEnd(),f.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,i,!0);G(_)||this._setUpdateOperationHandle(_,e)}});return g.push(...this._getHandlesForComponent(f,e),i.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(f,_,e),M.WIDGET),i.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(f,_)},M.WIDGET)),f}async _setupTransformOrReshape2DOperation(t,e,i,n){this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const r=e==="transform"?await this._getBox(t,i,n):await this._getReshape(t,i,n);if(G(r))return r;const s=new ae({activeComponent:r,type:"update",onEnd:()=>{K(p),K(l),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Qe(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{et(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async o=>{let a=s.activeComponent;if(a?.type==="reshape"){const u=[...this.updateGraphics,o];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const d=await this._setupTransformOrReshape2DOperation(u,"transform",i,n);if(G(d))return;this._setUpdateOperationHandle(d,i)}else this.updateGraphics.add(o),a.graphics=this.updateGraphics.toArray(),a.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[o],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:o=>{const a=this.updateGraphics.indexOf(o);s.history.undo.forEach(d=>d.updates.splice(a,1)),s.history.redo.forEach(d=>d.updates.splice(a,1)),this.updateGraphics.remove(o);const u=this.updateGraphics.toArray();u.length===0?s.complete():Pi(u)?s.toggleTool():s.activeComponent.graphics=u,this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[o],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const o=this.updateGraphics.at(0),a=o.geometry;if(a!=null&&(s.tool==="reshape"&&a.type==="point"||s.tool==="transform"&&a.type==="extent"))return;let u=null;s.tool==="transform"?u=await this._getReshape([o],i,n):s.tool==="reshape"&&(u=await this._getBox([o],i,n)),G(u)||(s.activeComponent?.destroy(),s.activeComponent=u,s.activeComponent&&(K(p),p=this._getHandlesForComponent(s,i)))}}),l=[n.on("immediate-click",o=>this._getCommonUpdateOperationClickHandlers(s,o,i),M.WIDGET),n.on("key-down",o=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,o),o.key===O.constraint&&!o.repeat&&s){const a=s.activeComponent;a&&a.type==="box"&&(a.preserveAspectRatio=!a.preserveAspectRatio)}},M.WIDGET),n.on("key-up",o=>{if(o.key===O.constraint&&s){const a=s.activeComponent;a&&a.type==="box"&&(a.preserveAspectRatio=!a.preserveAspectRatio)}},M.WIDGET)];let p=this._getHandlesForComponent(s,i);return s}async _getGraphicMover(t,e,i){const{enableMoveAllGraphics:n,highlightOptions:r}=e,s=await this._requireModule(P(()=>import("./GraphicMover-Dpm29VC9.js").then(l=>l.G),__vite__mapDeps([188,1,2,3,19,20,21,22,23,24,25,26,27,7,8,122,97,29,30,31,32,60,120,11,13,14,15,16,6,87]),import.meta.url));return G(s)?s:new s.module.default({enableMoveAllGraphics:n,highlightName:r?.name,highlightsEnabled:!!r?.enabled,indicatorsEnabled:!1,graphics:t,view:i,callbacks:{onGraphicMoveStart:({dx:l,dy:p,graphic:o})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:o,type:"move-start"},type:"update"})},onGraphicMove:({dx:l,dy:p,graphic:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:o,type:"move"},type:"update"}),onGraphicMoveStop:({dx:l,dy:p,graphic:o})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:o,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(t,e,i){const{enableRotation:n,enableScaling:r,highlightOptions:s,preserveAspectRatio:l}=e,[p,o]=await Promise.all([this._requireModule(P(()=>import("./Box-DPLO0DGK.js"),__vite__mapDeps([189,1,2,3,5,96,122,97,188,19,20,21,22,23,24,25,26,27,7,8,29,30,31,32,60,120,11,13,14,15,16,6,87,190,68,33,69,70,71,41,37,72,73,74,18,75,76,77,78,79,80,81,82,4,83,9,10,12,17,84,85,86,88,89,90,161,157,28,34,35,36,38,39,40,42,43,44,45,46,47,48]),import.meta.url)),ve()]);if(G(p))return p;const a=this.view?.inputManager?.isModifierKeyDown(O.constraint);return new p.module.default({graphics:t,enableRotation:n,enableScaling:r,highlightName:s?.name,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!l!=!!a,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:o,callbacks:{onMoveStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMove:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMoveStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScale:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotate:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"})}})}async _getReshape(t,e,i){const{highlightOptions:n,reshapeOptions:r}=e,s=r?.edgeOperation==="split",l=r?.shapeOperation==="move",p=!!r?.enableCreateCurveFromStraightEdge,[o,a,u]=await Promise.all([this._requireModule(P(()=>import("./Reshape-CG8uo64r.js"),__vite__mapDeps([191,1,2,3,33,110,103,106,105,107,108,109,111,19,20,21,22,23,24,25,26,27,7,8,65,10,66,67,11,5,68,69,70,71,41,37,72,73,74,29,30,31,32,18,75,76,77,78,79,80,81,6,82,4,83,9,12,13,14,15,16,17,84,85,86,60,87,88,89,90,192,158,117,118,119,159,160,121,38,193,114,156,122,97,188,120,157,190,95,39,40,96,28,34,35,36,42,43,44,45,46,47,48]),import.meta.url)),Je(),ve()]);return G(o)?o:new o.module.default({enableMidpoints:s,enableMovement:l,enableCurveOnMidpoint:p,graphic:t[0],highlightName:n?.name,highlightsEnabled:!!n?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:u,view:i,callbacks:{onReshapeStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshape:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshapeStop:({mover:d,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d,type:m},type:"update"}),onMoveStart:({dx:d,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:m,mover:y,type:g},type:"update"}),onMove:({dx:d,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:m,mover:y,type:g},type:"update"}),onMoveStop:({dx:d,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:m,mover:y,type:g},type:"update"}),onVertexAdd:({added:d,type:m,vertices:y})=>{const g=d.map(f=>mi(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:y,type:m},type:"update"})},onVertexRemove:({removed:d,type:m,vertices:y})=>{const g=d.map(f=>mi(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:y,type:m},type:"update"})}}})}_getHandlesForComponent(t,e){const i=t.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:n,viewEvent:r})=>{r.native?.shiftKey&&e.multipleSelectionEnabled&&(r.stopPropagation(),t.removeFromSelection(n))}),i.on("graphic-move-start",n=>t.addToHistory(ce(n.allGraphics)))];case"box":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,e,n)),i.on("move-start",n=>t.addToHistory(ce(n.graphics))),i.on("rotate-start",n=>t.addToHistory(ce(n.graphics))),i.on("scale-start",n=>t.addToHistory(ce(n.graphics)))];case"reshape":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,e,n)),i.on("move-start",n=>t.addToHistory(ce([n.mover]))),i.on("reshape-start",n=>t.addToHistory(ce([n.graphic]))),i.on("vertex-add",n=>t.addToHistory(ce([n.oldGraphic]))),i.on("vertex-remove",n=>t.addToHistory(ce([n.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),i.events.on("move-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n.dx,dy:n.dy,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),i.events.on("translate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate"},type:"update"})}),i.events.on("scale",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("vertex-add",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("vertex-remove",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,i){const{graphic:n,viewEvent:r}=i;return r.native?.shiftKey&&this.hasGraphic(n)?(r.stopPropagation(),t.removeFromSelection(n)):e.toggleToolOnClick?(r.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){this._operationHandle=t;const i=this.view?.map;this._disablePopup(e);const n=()=>{if(t===this._operationHandle){const r=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:r,state:"complete",aborted:t.cancelled,tool:s,toolEventInfo:null,type:"update"})}};t.on("complete",n)}async _getCommonUpdateOperationClickHandlers(t,e,i){const n=wi(e),r=await e.defer(()=>this._getFirstHit(n));if(r==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([r.graphic],t,i))return void e.stopPropagation();this.updateGraphics.includes(r.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,i){const n=!!i.multipleSelectionEnabled;return t.some(r=>r!=null&&!(!n||!this.hasGraphic(r))&&(this.updateGraphics.includes(r)?e.removeFromSelection(r):e.addToSelection(r),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const i=e.key;i===O.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):i===O.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):i===O.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&O.delete.includes(i)&&this._onDeleteKey(e)}_onDeleteKey(t){if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,i=this.updateGraphics.toArray();e!=null&&(e.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Ze(this._internalGraphicsLayer))}_isComponentGraphic(t){const{activeComponent:e}=this;return!(!t||e==null)&&(t.attributes?.esriSketchTool||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_clearCursor(){this.removeHandles(Lt)}_displayCursor(t){this.removeHandles(Lt),this.view?.container&&t!=null&&this.addHandles(this.view.acquireCursor(t,"high"),Lt)}_logError(t,e,i){Ui.getLogger(this).error(new _r(t,e,i))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const i=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}_onLayerGraphicsChangeCallback(t){if(this._operationHandle!=null){const{updateGraphics:e}=this;for(const i of t.removed)if(e.includes(i)){if(!(e.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(i)}}}get test(){}wait(){return vi(()=>!this.updating)}_disablePopupEnabled(t){return this.view?.type!=="3d"||this.updateOnGraphicClick||(t?.toggleToolOnClick??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const t=this.view;t?(Et(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await br(vi(()=>t?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Li("view"))}_logMissingLayer(){this._logError(zo,Li("layer"))}};c([h()],b.prototype,"_defaultSnappingManager",void 0),c([h()],b.prototype,"_layerAdapter",null),c([h()],b.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],b.prototype,"_updatingHandles",void 0),c([h({readOnly:!0})],b.prototype,"activeTool",null),c([h({readOnly:!0})],b.prototype,"activeCreateToolDrawMode",null),c([h()],b.prototype,"activeTooltip",null),c([h({types:ke})],b.prototype,"activeFillSymbol",void 0),c([h()],b.prototype,"activeLineSymbol",void 0),c([h()],b.prototype,"activeVertexSymbol",void 0),c([h()],b.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],b.prototype,"createGraphic",null),c([h()],b.prototype,"defaultCreateOptions",null),c([h()],b.prototype,"defaultUpdateOptions",null),c([h({type:Yt,nonNullable:!0})],b.prototype,"labelOptions",null),c([h()],b.prototype,"layer",void 0),c([h({types:ke})],b.prototype,"pointSymbol",void 0),c([h({types:ke})],b.prototype,"polygonSymbol",void 0),c([h({types:ke})],b.prototype,"polylineSymbol",void 0),c([h()],b.prototype,"meshSymbol",void 0),c([h()],b.prototype,"textSymbol",void 0),c([h({type:x,nonNullable:!0})],b.prototype,"snappingOptions",null),c([h()],b.prototype,"snappingManager",null),c([h({readOnly:!0})],b.prototype,"state",null),c([h({type:Qt,nonNullable:!0})],b.prototype,"tooltipOptions",null),c([h({readOnly:!0})],b.prototype,"updateGraphics",void 0),c([h()],b.prototype,"updateOnGraphicClick",void 0),c([h()],b.prototype,"updating",null),c([h()],b.prototype,"creationMode",void 0),c([h({type:Xt,nonNullable:!0})],b.prototype,"valueOptions",null),c([h({types:ke})],b.prototype,"vertexSymbol",void 0),c([h({value:null})],b.prototype,"view",null),c([h({constructOnly:!0,type:nn})],b.prototype,"sketchOptions",void 0),b=c([R("esri.widgets.Sketch.SketchViewModel")],b);const zo="sketch:missing-property",Li=t=>`Property '${t}' is missing on SketchViewModel.`;function Fo(t){return t==="polygon"||t==="rectangle"||t==="circle"}function Qe(t,e){Ln("undo",t.history.undo,t.history.redo,e)}function et(t,e){Ln("redo",t.history.redo,t.history.undo,e)}function Ln(t,e,i,n){const r=e.pop();if(!r)return;const s=r.updates,l=[];n.forEach((p,o)=>{const a=s[o];a!=null&&("geometry"in a&&a.geometry!=null&&(l.push({geometry:p.geometry}),p.geometry=a.geometry),"symbol"in a&&a.symbol!=null&&(l.push({symbol:p.symbol}),p.symbol=a.symbol),"undo"in a&&(l.push(a),a[t](p)))}),i.push({updates:l})}function Hi(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function ce(t){return{updates:t.map(({geometry:e})=>e?.type==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function tt(t,e){t.tools?.remove(e),e.destroyed||e.destroy()}function G(t){return"requireError"in t&&t.requireError==="aborted"}export{z as $,il as A,_a as B,sn as C,qa as D,Ua as E,Ha as F,Na as G,no as H,ja as I,so as J,eo as K,te as L,io as M,Mn as N,hn as O,el as P,ve as Q,Je as R,x as S,Le as T,Ei as U,_n as V,ci as W,Os as X,ks as Y,As as Z,Yt as _,St as a,ds as a0,Ho as a1,Va as a2,oe as a3,Xt as a4,jo as a5,oo as a6,Ma as a7,xa as a8,Ga as a9,rs as aa,tl as ab,Io as ac,Ot as b,Qs as c,Ra as d,Ys as e,U as f,ge as g,$n as h,to as i,xe as j,La as k,rn as l,b as m,st as n,nn as o,ht as p,$i as q,ro as r,Oa as s,Ti as t,lo as u,Da as v,va as w,Ia as x,hs as y,Ea as z};
