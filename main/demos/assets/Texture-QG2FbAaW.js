import{_ as T,Y as M,Z as k,dB as te,bJ as re,a0 as se,cn as v,f$ as w,a6 as ie,a7 as ae,cA as G,aK as X,am as K,i as L,s as u,kX as O,X as oe,aa as W,ab as ne}from"./main-CtmwM019.js";import{a as le}from"./Cyclical-BjYazOTz.js";import{Y as _,E as n,G as C,T as P,N as B,S as ce,O as H}from"./enums-DQOO6RKE.js";let D=class extends te{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};T([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"row",void 0),T([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"column",void 0),T([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"rows",void 0),T([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"columns",void 0),D=T([k("esri.CameraLayout")],D);const V=D;let R=class extends re(se){constructor(...r){super(...r),this.position=new v([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new V}normalizeCtorArgs(r,e,t,i){if(r&&typeof r=="object"&&("x"in r||Array.isArray(r))){const s={position:r};return e!=null&&(s.heading=e),t!=null&&(s.tilt=t),i!=null&&(s.fov=i),s}return r}writePosition(r,e,t,i){const s=r.clone();s.x=w(r.x||0),s.y=w(r.y||0),s.z=r.hasZ?w(r.z||0):r.z,e[t]=s.write({},i)}readPosition(r,e){const t=new v;return t.read(r,e),t.x=w(t.x||0),t.y=w(t.y||0),t.z=t.hasZ?w(t.z||0):t.z,t}equals(r){return r!=null&&this.tilt===r.tilt&&this.heading===r.heading&&this.fov===r.fov&&this.position.equals(r.position)&&this.layout.equals(r.layout)}};T([M({type:v,json:{write:{isRequired:!0}}})],R.prototype,"position",void 0),T([ie("position")],R.prototype,"writePosition",null),T([ae("position")],R.prototype,"readPosition",null),T([M({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),G(r=>le.normalize(w(r)))],R.prototype,"heading",void 0),T([M({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),G(r=>X(w(r),-180,180))],R.prototype,"tilt",void 0),T([M({type:Number,nonNullable:!0,json:{default:55,write:!0}}),G(r=>X(w(r,55),1,170))],R.prototype,"fov",void 0),T([M({type:V,nonNullable:!0,json:{read:!1,write:!1}})],R.prototype,"layout",void 0),R=T([k("esri.Camera")],R);const we=R,pe=()=>L.getLogger("esri.views.webgl.checkWebGLError");function Y(r){switch(r.getError()){case r.NO_ERROR:return null;case r.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case r.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case r.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case r.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case r.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case r.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const q=!!K("enable-feature:webgl-debug");function Z(){return q}function Me(){return q}function A(r,e=Z()){if(e){const t=Y(r);if(t){const i=new Error().stack;pe().error(new u("webgl-error","WebGL error occurred",{message:t,stack:i}))}}}function Ae(r,e,t,i=0){const s=r.gl;r.bindBuffer(t);for(const a of t.layout){const l=e.get(a.name);if(l==null){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=i*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&s.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let o=0;o<3;o++)s.vertexAttribPointer(l+o,3,a.type,a.normalized,a.stride,a.offset+12*o+c),s.enableVertexAttribArray(l+o),a.divisor>0&&s.vertexAttribDivisor(l+o,a.divisor);else if(a.count===16)for(let o=0;o<4;o++)s.vertexAttribPointer(l+o,4,a.type,a.normalized,a.stride,a.offset+16*o+c),s.enableVertexAttribArray(l+o),a.divisor>0&&s.vertexAttribDivisor(l+o,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count);if(Z()){const o=Y(r.gl);o&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}:`,o,a)}}}function De(r){switch(r){case 6406:case 6409:case 6403:case 36244:case 6402:case 34041:return 1;case 6410:case 33319:case 33320:return 2;case 6407:case 36248:return 3;case 6408:case 36249:return 4}return 0}function he(r){switch(r){case 6406:case 6409:case 6403:case 36244:case n.R8:case n.R8I:case n.R8UI:case n.R8_SNORM:case 36168:return 1;case 6410:case 33319:case 33320:case n.RGBA4:case n.R16F:case n.R16I:case n.R16UI:case n.RG8:case n.RG8I:case n.RG8UI:case n.RG8_SNORM:case n.RGB565:case n.RGB5_A1:case P.DEPTH_COMPONENT16:return 2;case 6407:case 36248:case n.RGB8:case n.RGB8I:case n.RGB8UI:case n.RGB8_SNORM:case n.SRGB8:case P.DEPTH_COMPONENT24:return 3;case 6408:case 36249:case n.RGBA8:case n.R32F:case n.R11F_G11F_B10F:case n.RG16F:case n.R32I:case n.R32UI:case n.RG16I:case n.RG16UI:case n.RGBA8I:case n.RGBA8UI:case n.RGBA8_SNORM:case n.SRGB8_ALPHA8:case n.RGB9_E5:case n.RGB10_A2UI:case n.RGB10_A2:case P.DEPTH_COMPONENT32F:case C.DEPTH24_STENCIL8:return 4;case C.DEPTH32F_STENCIL8:return 5;case n.RGB16F:case n.RGB16I:case n.RGB16UI:return 6;case n.RG32F:case n.RG32I:case n.RG32UI:case n.RGBA16F:case n.RGBA16I:case n.RGBA16UI:return 8;case n.RGB32F:case n.RGB32I:case n.RGB32UI:return 12;case n.RGBA32F:case n.RGBA32I:case n.RGBA32UI:return 16;case _.COMPRESSED_RGB_S3TC_DXT1_EXT:case _.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case _.COMPRESSED_RGBA_S3TC_DXT3_EXT:case _.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case _.COMPRESSED_R11_EAC:case _.COMPRESSED_SIGNED_R11_EAC:case _.COMPRESSED_RGB8_ETC2:case _.COMPRESSED_SRGB8_ETC2:case _.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case _.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case _.COMPRESSED_RG11_EAC:case _.COMPRESSED_SIGNED_RG11_EAC:case _.COMPRESSED_RGBA8_ETC2_EAC:case _.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let ue=class{constructor(e=0,t=e){this.width=e,this.height=t,this.type=0,this.target=3553,this.pixelFormat=6408,this.dataType=B.UNSIGNED_BYTE,this.samplingMode=9729,this.wrapMode=10497,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}};function de(r){return r.width<=0||r.height<=0||r.depth<=0?0:Math.round(r.width*r.height*r.depth*(r.hasMipmap?4/3:1)*(r.internalFormat==null?4:he(r.internalFormat))*(r.target===34067?6:1))}const S=()=>L.getLogger("esri/views/webgl/textureUtils");function F(r){const{width:e,height:t,depth:i}=r;(e!=null&&e<0||t!=null&&t<0||i!=null&&i<0)&&S().error("Negative dimension parameters are not allowed!");const{internalFormat:s}=r;if(s&&(J(s)||Q(s))){const{linearFilterDepth:a,compareEnabled:l,samplingMode:c,hasMipmap:o}=r;o&&S().error("Depth textures cannot have mipmaps"),a?c!==9729&&c!==9728&&S().error("Depth textures cannot sample mipmaps"):(c!==9728&&S().error("Depth textures without filtering must use NEAREST filtering"),l&&S().error("Depth textures without filtering cannot use compare function"))}}function me(r){return ce.includes(r)}function J(r){return O(P,r)}function Q(r){return O(C,r)}function _e(r){return r!=null&&O(_,r)}function y(r){return r!=null&&"type"in r&&r.type==="compressed"}function ge(r){return r!=null&&"byteLength"in r}function z(r){return r!=null&&!y(r)&&!ge(r)}function I(r){return r===32879||r===35866}function j(r,e,t,i=1){let s=Math.max(e,t);return r===32879&&(s=Math.max(s,i)),Math.floor(Math.log2(s))+1}function N(r){if(r.internalFormat!=null)return r.internalFormat;switch(r.dataType){case B.FLOAT:switch(r.pixelFormat){case 6408:return n.RGBA32F;case 6407:return n.RGB32F;default:throw new u("texture:unknown-format","Unable to derive format")}case B.UNSIGNED_BYTE:switch(r.pixelFormat){case 6408:return n.RGBA8;case 6407:return n.RGB8}}const{pixelFormat:e}=r;return r.internalFormat=e===34041?C.DEPTH24_STENCIL8:e===6402?P.DEPTH_COMPONENT24:e,r.internalFormat}function fe(r){let e="width"in r?r.width:r.codedWidth,t="height"in r?r.height:r.codedHeight;return r instanceof HTMLVideoElement&&(e=r.videoWidth,t=r.videoHeight),{width:e,height:t,depth:1}}class $ extends ue{constructor(e,t){switch(super(),this.context=e,Object.assign(this,t),this.internalFormat){case n.R16F:case n.R32F:case n.R8_SNORM:case n.R8:this.pixelFormat=6403;break;case n.R8I:case n.R8UI:case n.R16I:case n.R16UI:case n.R32I:case n.R32UI:this.pixelFormat=36244}}static validate(e,t){return new $(e,t)}}const xe=!!K("esri-tests-disable-gpu-memory-measurements"),b=()=>L.getLogger("esri/views/webgl/Texture");let ye=class x{static{this.TEXTURE_UNIT_FOR_UPDATES=0}static{this.compressionWorkerHandle=null}constructor(e,t=null,i=null){if(this.type=1,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=t;else{const s=$.validate(e,t);if(!s)throw new u("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=s}this._descriptor.target===34067?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return xe?0:de(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){this.abortCompression(),this.hasWebGLTextureObject&&this._descriptor.context?.gl&&(this._descriptor.context.instanceCounter.decrement(H.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor=null)}release(){this.dispose()}[Symbol.dispose](){this.dispose()}resize(e,t){const i=this._descriptor;if(i.width!==e||i.height!==t){if(this._wasImmutablyAllocated)throw new u("texture:immutable-resize","Immutable textures can't be resized!");i.width=e,i.height=t,this._descriptor.target===34067?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!y(e)&&this._descriptor.internalFormat&&O(_,this._descriptor.internalFormat)&&(this._descriptor.internalFormat=void 0),this._setData(e),!y(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(e,t,i,s,a,l,c=0){l||b().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||b().error("An attempt to update uninitialized texture!");const o=this._descriptor;o.internalFormat=N(o);const{context:p,pixelFormat:h,dataType:g,target:d,isImmutable:m}=o;if(m&&!this._wasImmutablyAllocated)throw new u("texture:uninitialized","Cannot update immutable texture before allocation!");const E=p.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES,!0);(t<0||i<0||t+s>o.width||i+a>o.height)&&b().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:f}=p;c&&(s&&a||b().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),f.pixelStorei(f.UNPACK_SKIP_ROWS,c)),z(l)?f.texSubImage2D(d,e,t,i,s,a,h,g,l):y(l)?f.compressedTexSubImage2D(d,e,t,i,s,a,o.internalFormat,l.levels[e]):f.texSubImage2D(d,e,t,i,s,a,h,g,l),c&&f.pixelStorei(f.UNPACK_SKIP_ROWS,0),p.bindTexture(E,x.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,t,i,s,a,l,c,o){o||b().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||b().error("An attempt to update an uninitialized texture!");const p=this._descriptor;p.internalFormat=N(p);const{context:h,pixelFormat:g,dataType:d,isImmutable:m,target:E}=p;if(m&&!this._wasImmutablyAllocated)throw new u("texture:uninitialized","Cannot update immutable texture before allocation!");I(E)||b().warn("Attempting to set 3D texture data on a non-3D texture");const f=h.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(x.TEXTURE_UNIT_FOR_UPDATES),(t<0||i<0||s<0||t+a>p.width||i+l>p.height||s+c>p.depth)&&b().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:U}=h;if(y(o))o=o.levels[e],U.compressedTexSubImage3D(E,e,t,i,s,a,l,c,p.internalFormat,o);else{const ee=o;U.texSubImage3D(E,e,t,i,s,a,l,c,g,d,ee)}h.bindTexture(f,x.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(e.width===0||e.height===0)return;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new u("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,F(e)}e.samplingMode===9729?(this._samplingModeDirty=!0,e.samplingMode=9985):e.samplingMode===9728&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._descriptor.context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(x.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(t,x.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new u("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,F(e)}e.samplingMode===9985?(this._samplingModeDirty=!0,e.samplingMode=9729):e.samplingMode===9984&&(this._samplingModeDirty=!0,e.samplingMode=9728)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,F(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?9729:9728),F(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=oe(this._compressionAbortController)}_setData(e,t){const i=this._descriptor,s=i.context?.gl;if(!s)return;A(s),this.hasWebGLTextureObject||(this._glName=s.createTexture(),i.context.instanceCounter.increment(H.Texture,this)),F(i);const a=i.context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES);i.context.setActiveTexture(x.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),A(s);const l=t??i.target,c=I(l);if(z(e))this._setDataFromTexImageSource(e,l);else{const{width:o,height:p,depth:h}=i;if(o==null||p==null)throw new u("texture:missing-size","Width and height must be specified!");if(c&&h==null)throw new u("texture:missing-depth","Depth must be specified!");if(i.internalFormat=N(i),i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,i.internalFormat,i.hasMipmap,o,p,h),y(e)){if(!_e(i.internalFormat))throw new u("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(e,i.internalFormat,l)}else this._texImage(l,0,i.internalFormat,o,p,h,e),A(s),i.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),A(s),i.context.bindTexture(a,x.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let t=34069;t<=34074;t++)this._setData(e,t)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_setDataFromTexImageSource(e,t){const{gl:i}=this._descriptor.context,s=this._descriptor;s.internalFormat=N(s);const a=I(t),{width:l,height:c,depth:o}=fe(e);s.width&&s.height,s.width||(s.width=l),s.height||(s.height=c),a&&s.depth,a&&(s.depth=o),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,s.internalFormat,s.hasMipmap,l,c,o),this._texImage(t,0,s.internalFormat,l,c,o,e),A(i),s.hasMipmap&&(this.generateMipmap(),A(i))}_setDataFromCompressedSource(e,t,i){const s=this._descriptor,{width:a,height:l,depth:c}=s,o=e.levels,p=j(i,a,l,c),h=Math.min(p,o.length)-1;this._descriptor.context.gl.texParameteri(s.target,33085,h),this._forEachMipmapLevel((g,d,m,E)=>{const f=o[Math.min(g,o.length-1)];this._compressedTexImage(i,g,t,d,m,E,f)},h)}_texStorage(e,t,i,s,a,l){const{gl:c}=this._descriptor.context;if(!me(t)&&!J(t)&&!Q(t))throw new u("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const o=i?j(e,s,a,l):1;if(I(e)){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");c.texStorage3D(e,o,t,s,a,l)}else c.texStorage2D(e,o,t,s,a);this._wasImmutablyAllocated=!0}_texImage(e,t,i,s,a,l,c){const o=this._descriptor.context.gl,p=I(e),{isImmutable:h,pixelFormat:g,dataType:d}=this._descriptor;if(h){if(c!=null){const m=c;if(p){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");o.texSubImage3D(e,t,0,0,0,s,a,l,g,d,m)}else o.texSubImage2D(e,t,0,0,s,a,g,d,m)}}else{const m=c;if(p){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");o.texImage3D(e,t,i,s,a,l,0,g,d,m)}else o.texImage2D(e,t,i,s,a,0,g,d,m)}}_compressedTexImage(e,t,i,s,a,l,c){const o=this._descriptor.context.gl,p=I(e);if(this._descriptor.isImmutable){if(c!=null)if(p){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");o.compressedTexSubImage3D(e,t,0,0,0,s,a,l,i,c)}else o.compressedTexSubImage2D(e,t,0,0,s,a,i,c)}else if(p){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");o.compressedTexImage3D(e,t,i,s,a,l,0,c)}else o.compressedTexImage2D(e,t,i,s,a,0,c)}async _compressOnWorker(e){const{width:t,height:i,context:s,flipped:a,preMultiplyAlpha:l,hasMipmap:c}=this._descriptor,o=this._descriptor.compress?.compressionTracker,p=this._descriptor.compress?.compressionCallback,{compressedTextureETC:h,compressedTextureS3TC:g}=s.capabilities;if(!x.compressionWorkerHandle?.isCompressible(e,this._descriptor)||!h&&!g)return;this.abortCompression();const d=new AbortController;let m;this._compressionAbortController=d,o?.increment();try{e instanceof Uint8Array?m=e.buffer:(m=await createImageBitmap(e,{imageOrientation:a?"flipY":"none"}),W(d));const E={data:m,width:t,height:i,needsFlip:e instanceof Uint8Array&&this.descriptor.flipped,components:this._descriptor.pixelFormat===6408?4:3,preMultiplyAlpha:l,hasMipmap:c,hasETC:!!h,hasS3TC:!!g},f=await x.compressionWorkerHandle.invoke(E,d.signal,"low");if(W(d),f.compressedTexture&&this.hasWebGLTextureObject){const U=this.usedMemory;this._descriptor.internalFormat=f.internalFormat,this._setData(f.compressedTexture),p?.(U-this.usedMemory)}}catch(E){ne(E)||b().error("Texture compression failed!")}finally{o?.decrement(),this._compressionAbortController?.signal.aborted&&(this._compressionAbortController=null),m instanceof ImageBitmap&&m.close()}}_forEachMipmapLevel(e,t=1/0){let{width:i,height:s,depth:a,hasMipmap:l,target:c}=this._descriptor;const o=c===32879;if(i==null||s==null||o&&a==null)throw new u("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let p=0;e(p,i,s,a),l&&(i!==1||s!==1||o&&a!==1)&&!(p>=t);++p)i=Math.max(1,i>>1),s=Math.max(1,s>>1),o&&(a=Math.max(1,a>>1))}_applySamplingMode(){const e=this._descriptor,t=e.context?.gl;let i=e.samplingMode,s=e.samplingMode;i===9985||i===9987?(i=9729,e.hasMipmap||(s=9729)):i!==9984&&i!==9986||(i=9728,e.hasMipmap||(s=9728)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,s)}_applyWrapMode(){const e=this._descriptor,t=e.context?.gl;typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){const e=this._descriptor,t=e.context?.gl,i=e.compareEnabled?t.COMPARE_REF_TO_TEXTURE:t.NONE;t.texParameteri(e.target,t.TEXTURE_COMPARE_MODE,i),e.compareEnabled&&t.texParameteri(e.target,t.TEXTURE_COMPARE_FUNC,t.GREATER),A(t)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,t=e.context.capabilities.textureFilterAnisotropic;t&&e.context.gl.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};export{ye as A,Ae as R,he as _,Z as a,$ as b,Me as c,we as d,ue as h,De as n,Y as t,A as u};
