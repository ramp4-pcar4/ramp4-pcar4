import{t as S}from"./quickselect-QQC62dOK.js";function B(i,n){if(!(this instanceof B))return new B(i,n);this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&(typeof n=="function"?this.toBBox=n:this._initFormat(n)),this.clear()}function b(i,n,t){if(!t)return n.indexOf(i);for(var e=0;e<n.length;e++)if(t(i,n[e]))return e;return-1}function c(i,n){x(i,0,i.children.length,n,i)}function x(i,n,t,e,h){h||(h=f(null)),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(var a,r=n;r<t;r++)a=i.children[r],d(h,i.leaf?e(a):a);return h}function d(i,n){return i.minX=Math.min(i.minX,n.minX),i.minY=Math.min(i.minY,n.minY),i.maxX=Math.max(i.maxX,n.maxX),i.maxY=Math.max(i.maxY,n.maxY),i}function _(i,n){return i.minX-n.minX}function v(i,n){return i.minY-n.minY}function Y(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function p(i){return i.maxX-i.minX+(i.maxY-i.minY)}function w(i,n){return(Math.max(n.maxX,i.maxX)-Math.min(n.minX,i.minX))*(Math.max(n.maxY,i.maxY)-Math.min(n.minY,i.minY))}function F(i,n){var t=Math.max(i.minX,n.minX),e=Math.max(i.minY,n.minY),h=Math.min(i.maxX,n.maxX),a=Math.min(i.maxY,n.maxY);return Math.max(0,h-t)*Math.max(0,a-e)}function g(i,n){return i.minX<=n.minX&&i.minY<=n.minY&&n.maxX<=i.maxX&&n.maxY<=i.maxY}function M(i,n){return n.minX<=i.maxX&&n.minY<=i.maxY&&n.maxX>=i.minX&&n.maxY>=i.minY}function f(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(i,n,t,e,h){for(var a,r=[n,t];r.length;)(t=r.pop())-(n=r.pop())<=e||(a=n+Math.ceil((t-n)/e/2)*e,S(i,a,n,t,h),r.push(n,a,a,t))}B.prototype={all:function(){return this._all(this.data,[])},search:function(i){var n=this.data,t=[],e=this.toBBox;if(!M(i,n))return t;for(var h,a,r,o,s=[];n;){for(h=0,a=n.children.length;h<a;h++)r=n.children[h],M(i,o=n.leaf?e(r):r)&&(n.leaf?t.push(r):g(i,o)?this._all(r,t):s.push(r));n=s.pop()}return t},collides:function(i){var n=this.data,t=this.toBBox;if(!M(i,n))return!1;for(var e,h,a,r,o=[];n;){for(e=0,h=n.children.length;e<h;e++)if(a=n.children[e],M(i,r=n.leaf?t(a):a)){if(n.leaf||g(i,r))return!0;o.push(a)}n=o.pop()}return!1},load:function(i){if(!i||!i.length)return this;if(i.length<this._minEntries){for(var n=0,t=i.length;n<t;n++)this.insert(i[n]);return this}var e=this._build(i.slice(),0,i.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){var h=this.data;this.data=e,e=h}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this},insert:function(i){return i!=null&&this._insert(i,this.data.height-1),this},clear:function(){return this.data=f([]),this},remove:function(i,n){if(i==null)return this;for(var t,e,h,a,r=this.data,o=this.toBBox(i),s=[],l=[];r||s.length;){if(r||(r=s.pop(),e=s[s.length-1],t=l.pop(),a=!0),r.leaf&&(h=b(i,r.children,n))!==-1)return r.children.splice(h,1),s.push(r),this._condense(s),this;a||r.leaf||!g(r,o)?e?(t++,r=e.children[t],a=!1):r=null:(s.push(r),l.push(t),t=0,e=r,r=r.children[0])}return this},toBBox:function(i){return i},compareMinX:_,compareMinY:v,toJSON:function(){return this.data},fromJSON:function(i){return this.data=i,this},_all:function(i,n){for(var t=[];i;)i.leaf?n.push.apply(n,i.children):t.push.apply(t,i.children),i=t.pop();return n},_build:function(i,n,t,e){var h,a=t-n+1,r=this._maxEntries;if(a<=r)return c(h=f(i.slice(n,t+1)),this.toBBox),h;e||(e=Math.ceil(Math.log(a)/Math.log(r)),r=Math.ceil(a/Math.pow(r,e-1))),(h=f([])).leaf=!1,h.height=e;var o,s,l,m,u=Math.ceil(a/r),X=u*Math.ceil(Math.sqrt(r));for(E(i,n,t,X,this.compareMinX),o=n;o<=t;o+=X)for(E(i,o,l=Math.min(o+X-1,t),u,this.compareMinY),s=o;s<=l;s+=u)m=Math.min(s+u-1,l),h.children.push(this._build(i,s,m,e-1));return c(h,this.toBBox),h},_chooseSubtree:function(i,n,t,e){for(var h,a,r,o,s,l,m,u;e.push(n),!n.leaf&&e.length-1!==t;){for(m=u=1/0,h=0,a=n.children.length;h<a;h++)s=Y(r=n.children[h]),(l=w(i,r)-s)<u?(u=l,m=s<m?s:m,o=r):l===u&&s<m&&(m=s,o=r);n=o||n.children[0]}return n},_insert:function(i,n,t){var e=this.toBBox,h=t?i:e(i),a=[],r=this._chooseSubtree(h,this.data,n,a);for(r.children.push(i),d(r,h);n>=0&&a[n].children.length>this._maxEntries;)this._split(a,n),n--;this._adjustParentBBoxes(h,a,n)},_split:function(i,n){var t=i[n],e=t.children.length,h=this._minEntries;this._chooseSplitAxis(t,h,e);var a=this._chooseSplitIndex(t,h,e),r=f(t.children.splice(a,t.children.length-a));r.height=t.height,r.leaf=t.leaf,c(t,this.toBBox),c(r,this.toBBox),n?i[n-1].children.push(r):this._splitRoot(t,r)},_splitRoot:function(i,n){this.data=f([i,n]),this.data.height=i.height+1,this.data.leaf=!1,c(this.data,this.toBBox)},_chooseSplitIndex:function(i,n,t){var e,h,a,r,o,s,l,m;for(s=l=1/0,e=n;e<=t-n;e++)r=F(h=x(i,0,e,this.toBBox),a=x(i,e,t,this.toBBox)),o=Y(h)+Y(a),r<s?(s=r,m=e,l=o<l?o:l):r===s&&o<l&&(l=o,m=e);return m},_chooseSplitAxis:function(i,n,t){var e=i.leaf?this.compareMinX:_,h=i.leaf?this.compareMinY:v;this._allDistMargin(i,n,t,e)<this._allDistMargin(i,n,t,h)&&i.children.sort(e)},_allDistMargin:function(i,n,t,e){i.children.sort(e);var h,a,r=this.toBBox,o=x(i,0,n,r),s=x(i,t-n,t,r),l=p(o)+p(s);for(h=n;h<t-n;h++)a=i.children[h],d(o,i.leaf?r(a):a),l+=p(o);for(h=t-n-1;h>=n;h--)a=i.children[h],d(s,i.leaf?r(a):a),l+=p(s);return l},_adjustParentBBoxes:function(i,n,t){for(var e=t;e>=0;e--)d(n[e],i)},_condense:function(i){for(var n,t=i.length-1;t>=0;t--)i[t].children.length===0?t>0?(n=i[t-1].children).splice(n.indexOf(i[t]),1):this.clear():c(i[t],this.toBBox)},_initFormat:function(i){var n=["return a"," - b",";"];this.compareMinX=new Function("a","b",n.join(i[0])),this.compareMinY=new Function("a","b",n.join(i[1])),this.toBBox=new Function("a","return {minX: a"+i[0]+", minY: a"+i[1]+", maxX: a"+i[2]+", maxY: a"+i[3]+"};")}};function y(i,{timeZone:n,timeExtent:t}){return{$view:{scale:i,timeZone:n,timeProperties:{currentStart:t?.start,currentEnd:t?.end}}}}export{y as e,B as i};
