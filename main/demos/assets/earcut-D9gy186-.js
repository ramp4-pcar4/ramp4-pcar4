function A(t,r,n){n=n||2;var x,e,i,u,f,v,s,c=r&&r.length,l=c?r[0]*n:t.length,p=C(t,0,l,n,!0),o=[];if(!p||p.next===p.prev)return o;if(c&&(p=J(t,r,p,n)),t.length>80*n){x=i=t[0],e=u=t[1];for(var y=n;y<l;y+=n)(f=t[y])<x&&(x=f),(v=t[y+1])<e&&(e=v),f>i&&(i=f),v>u&&(u=v);s=(s=Math.max(i-x,u-e))!==0?1/s:0}return g(p,o,n,x,e,s),o}function C(t,r,n,x,e){var i,u;if(e===q(t,r,n,x)>0)for(i=r;i<n;i+=x)u=B(i,t[i],t[i+1],u);else for(i=n-x;i>=r;i-=x)u=B(i,t[i],t[i+1],u);if(u&&b(u,u.next)){var f=u.next;w(u),u=f}return u}function h(t,r){if(!t)return t;r||(r=t);var n,x=t;do if(n=!1,x.steiner||!b(x,x.next)&&a(x.prev,x,x.next)!==0)x=x.next;else{var e=x.prev;if(w(x),(x=r=e)===x.next)break;n=!0}while(n||x!==r);return r}function g(t,r,n,x,e,i,u){if(t){!u&&i&&P(t,x,e,i);for(var f,v,s=t;t.prev!==t.next;)if(f=t.prev,v=t.next,i?G(t,x,e,i):F(t))r.push(f.i/n),r.push(t.i/n),r.push(v.i/n),w(t),t=v.next,s=v.next;else if((t=v)===s){u?u===1?g(t=H(h(t),r,n),r,n,x,e,i,2):u===2&&I(t,r,n,x,e,i):g(h(t),r,n,x,e,i,1);break}}}function F(t){var r=t.prev,n=t,x=t.next;if(a(r,n,x)>=0)return!1;for(var e=t.next.next;e!==t.prev;){if(Z(r.x,r.y,n.x,n.y,x.x,x.y,e.x,e.y)&&a(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function G(t,r,n,x){var e=t.prev,i=t,u=t.next;if(a(e,i,u)>=0)return!1;for(var f=e.x<i.x?e.x<u.x?e.x:u.x:i.x<u.x?i.x:u.x,v=e.y<i.y?e.y<u.y?e.y:u.y:i.y<u.y?i.y:u.y,s=e.x>i.x?e.x>u.x?e.x:u.x:i.x>u.x?i.x:u.x,c=e.y>i.y?e.y>u.y?e.y:u.y:i.y>u.y?i.y:u.y,l=k(f,v,r,n,x),p=k(s,c,r,n,x),o=t.prevZ,y=t.nextZ;o&&o.z>=l&&y&&y.z<=p;){if(o!==t.prev&&o!==t.next&&Z(e.x,e.y,i.x,i.y,u.x,u.y,o.x,o.y)&&a(o.prev,o,o.next)>=0||(o=o.prevZ,y!==t.prev&&y!==t.next&&Z(e.x,e.y,i.x,i.y,u.x,u.y,y.x,y.y)&&a(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;o&&o.z>=l;){if(o!==t.prev&&o!==t.next&&Z(e.x,e.y,i.x,i.y,u.x,u.y,o.x,o.y)&&a(o.prev,o,o.next)>=0)return!1;o=o.prevZ}for(;y&&y.z<=p;){if(y!==t.prev&&y!==t.next&&Z(e.x,e.y,i.x,i.y,u.x,u.y,y.x,y.y)&&a(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function H(t,r,n){var x=t;do{var e=x.prev,i=x.next.next;!b(e,i)&&D(e,x,x.next,i)&&d(e,i)&&d(i,e)&&(r.push(e.i/n),r.push(x.i/n),r.push(i.i/n),w(x),w(x.next),x=t=i),x=x.next}while(x!==t);return h(x)}function I(t,r,n,x,e,i){var u=t;do{for(var f=u.next.next;f!==u.prev;){if(u.i!==f.i&&S(u,f)){var v=E(u,f);return u=h(u,u.next),v=h(v,v.next),g(u,r,n,x,e,i),void g(v,r,n,x,e,i)}f=f.next}u=u.next}while(u!==t)}function J(t,r,n,x){var e,i,u,f=[];for(e=0,i=r.length;e<i;e++)(u=C(t,r[e]*x,e<i-1?r[e+1]*x:t.length,x,!1))===u.next&&(u.steiner=!0),f.push(R(u));for(f.sort(K),e=0;e<f.length;e++)n=h(n=L(f[e],n),n.next);return n}function K(t,r){return t.x-r.x}function m(t){if(t.next.prev===t)return t;let r=t;for(;;){const n=r.next;if(n.prev===r||n===r||n===t)break;r=n}return r}function L(t,r){var n=N(t,r);if(!n)return r;var x=E(n,t),e=h(n,n.next);let i=m(x);return h(i,i.next),e=m(e),m(r===n?e:r)}function N(t,r){var n,x=r,e=t.x,i=t.y,u=-1/0;do{if(i<=x.y&&i>=x.next.y&&x.next.y!==x.y){var f=x.x+(i-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(f<=e&&f>u){if(u=f,f===e){if(i===x.y)return x;if(i===x.next.y)return x.next}n=x.x<x.next.x?x:x.next}}x=x.next}while(x!==r);if(!n)return null;if(e===u)return n;var v,s=n,c=n.x,l=n.y,p=1/0;x=n;do e>=x.x&&x.x>=c&&e!==x.x&&Z(i<l?e:u,i,c,l,i<l?u:e,i,x.x,x.y)&&(v=Math.abs(i-x.y)/(e-x.x),d(x,t)&&(v<p||v===p&&(x.x>n.x||x.x===n.x&&O(n,x)))&&(n=x,p=v)),x=x.next;while(x!==s);return n}function O(t,r){return a(t.prev,t,r.prev)<0&&a(r.next,t,t.next)<0}function P(t,r,n,x){var e=t;do e.z===null&&(e.z=k(e.x,e.y,r,n,x)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==t);e.prevZ.nextZ=null,e.prevZ=null,Q(e)}function Q(t){var r,n,x,e,i,u,f,v,s=1;do{for(n=t,t=null,i=null,u=0;n;){for(u++,x=n,f=0,r=0;r<s&&(f++,x=x.nextZ);r++);for(v=s;f>0||v>0&&x;)f!==0&&(v===0||!x||n.z<=x.z)?(e=n,n=n.nextZ,f--):(e=x,x=x.nextZ,v--),i?i.nextZ=e:t=e,e.prevZ=i,i=e;n=x}i.nextZ=null,s*=2}while(u>1);return t}function k(t,r,n,x,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*e)|t<<8))|t<<4))|t<<2))|t<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-x)*e)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function R(t){var r=t,n=t;do(r.x<n.x||r.x===n.x&&r.y<n.y)&&(n=r),r=r.next;while(r!==t);return n}function Z(t,r,n,x,e,i,u,f){return(e-u)*(r-f)-(t-u)*(i-f)>=0&&(t-u)*(x-f)-(n-u)*(r-f)>=0&&(n-u)*(i-f)-(e-u)*(x-f)>=0}function S(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!T(t,r)&&(d(t,r)&&d(r,t)&&U(t,r)&&(a(t.prev,t,r.prev)||a(t,r.prev,r))||b(t,r)&&a(t.prev,t,t.next)>0&&a(r.prev,r,r.next)>0)}function a(t,r,n){return(r.y-t.y)*(n.x-r.x)-(r.x-t.x)*(n.y-r.y)}function b(t,r){return t.x===r.x&&t.y===r.y}function D(t,r,n,x){var e=z(a(t,r,n)),i=z(a(t,r,x)),u=z(a(n,x,t)),f=z(a(n,x,r));return e!==i&&u!==f||!(e!==0||!M(t,n,r))||!(i!==0||!M(t,x,r))||!(u!==0||!M(n,t,x))||!(f!==0||!M(n,r,x))}function M(t,r,n){return r.x<=Math.max(t.x,n.x)&&r.x>=Math.min(t.x,n.x)&&r.y<=Math.max(t.y,n.y)&&r.y>=Math.min(t.y,n.y)}function z(t){return t>0?1:t<0?-1:0}function T(t,r){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==r.i&&n.next.i!==r.i&&D(n,n.next,t,r))return!0;n=n.next}while(n!==t);return!1}function d(t,r){return a(t.prev,t,t.next)<0?a(t,r,t.next)>=0&&a(t,t.prev,r)>=0:a(t,r,t.prev)<0||a(t,t.next,r)<0}function U(t,r){var n=t,x=!1,e=(t.x+r.x)/2,i=(t.y+r.y)/2;do n.y>i!=n.next.y>i&&n.next.y!==n.y&&e<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(x=!x),n=n.next;while(n!==t);return x}function E(t,r){var n=new j(t.i,t.x,t.y),x=new j(r.i,r.x,r.y),e=t.next,i=r.prev;return t.next=r,r.prev=t,n.next=e,e.prev=n,x.next=n,n.prev=x,i.next=x,x.prev=i,x}function B(t,r,n,x){var e=new j(t,r,n);return x?(e.next=x.next,e.prev=x,x.next.prev=e,x.next=e):(e.prev=e,e.next=e),e}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function j(t,r,n){this.i=t,this.x=r,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q(t,r,n,x){for(var e=0,i=r,u=n-x;i<n;i+=x)e+=(t[u]-t[i])*(t[i+1]+t[u+1]),u=i;return e}A.deviation=function(t,r,n,x){var e=r&&r.length,i=e?r[0]*n:t.length,u=Math.abs(q(t,0,i,n));if(e)for(var f=0,v=r.length;f<v;f++){var s=r[f]*n,c=f<v-1?r[f+1]*n:t.length;u-=Math.abs(q(t,s,c,n))}var l=0;for(f=0;f<x.length;f+=3){var p=x[f]*n,o=x[f+1]*n,y=x[f+2]*n;l+=Math.abs((t[p]-t[y])*(t[o+1]-t[p+1])-(t[p]-t[o])*(t[y+1]-t[p+1]))}return u===0&&l===0?0:Math.abs((l-u)/u)},A.flatten=function(t){for(var r=t[0][0].length,n={vertices:[],holes:[],dimensions:r},x=0,e=0;e<t.length;e++){for(var i=0;i<t[e].length;i++)for(var u=0;u<r;u++)n.vertices.push(t[e][i][u]);e>0&&(x+=t[e-1].length,n.holes.push(x))}return n};export{A as e};
