import{e as M,f as d,g as B,m as A,L as N,h as x,r as X,M as Y,C as L,P as j}from"./Theme-8ZjZh4ou.js";class k extends M{_beforeChanged(){super._beforeChanged(),(this.isDirty("pointerBaseWidth")||this.isDirty("cornerRadius")||this.isDirty("pointerLength")||this.isDirty("pointerX")||this.isDirty("pointerY")||this.isDirty("width")||this.isDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){this.markDirtyBounds();let i=this.width(),t=this.height();if(i>0&&t>0){let e=this.get("cornerRadius",8);e=d(e,0,Math.min(i/2,t/2));let r=this.get("pointerX",0),l=this.get("pointerY",0),o=this.get("pointerBaseWidth",15)/2,m=0,c=0,y=i,T=0,f=i,p=t,a=0,_=t,h=(r-m)*(p-c)-(l-c)*(f-m),u=(r-a)*(T-_)-(l-_)*(y-a);const s=this._display;if(s.moveTo(e,0),h>0&&u>0){let n=Math.round(d(r,e+o,i-o-e));l=d(l,-1/0,0),s.lineTo(n-o,0),s.lineTo(r,l),s.lineTo(n+o,0)}if(s.lineTo(i-e,0),s.arcTo(i,0,i,e,e),h>0&&u<0){let n=Math.round(d(l,e+o,t-o-e));r=d(r,i,1/0),s.lineTo(i,e),s.lineTo(i,Math.max(n-o,e)),s.lineTo(r,l),s.lineTo(i,n+o)}if(s.lineTo(i,t-e),s.arcTo(i,t,i-e,t,e),h<0&&u<0){let n=Math.round(d(r,e+o,i-o-e));l=d(l,t,1/0),s.lineTo(i-e,t),s.lineTo(n+o,t),s.lineTo(r,l),s.lineTo(n-o,t)}if(s.lineTo(e,t),s.arcTo(0,t,0,t-e,e),h<0&&u>0){let n=Math.round(d(l,e+o,t-e-o));r=d(r,-1/0,0),s.lineTo(0,t-e),s.lineTo(0,n+o),s.lineTo(r,l),s.lineTo(0,Math.max(n-o,e))}s.lineTo(0,e),s.arcTo(0,0,e,0,e),s.closePath()}}}}Object.defineProperty(k,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PointedRectangle"});Object.defineProperty(k,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:M.classNames.concat([k.className])});class P extends B{constructor(i,t,e,r=[]){super(i,t,e,r),Object.defineProperty(this,"_fx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_fy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillGrDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_strokeDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_labelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_w",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_h",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_keepHoverDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_htmlContentHovered",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._settings.themeTags=A(this._settings.themeTags,["tooltip"]),super._afterNew(),this._setDefaultFn("background",()=>k.new(this._root,{})).set("themeTags",["tooltip","background"]),this._label=this.children.push(N.new(this._root,{})),this._disposers.push(this._label.events.on("boundschanged",()=>{this._updateBackground()})),this._disposers.push(this.on("bounds",()=>{this._updateBackground()})),this._updateTextColor(),this._root.tooltipContainer.children.push(this),this.hide(0),this._disposers.push(this.label.onPrivate("htmlElement",t=>{t&&(this._disposers.push(x(t,"pointerover",e=>{this._htmlContentHovered=!0})),this._disposers.push(x(t,"pointerout",e=>{this._htmlContentHovered=!1})))})),this.on("visible",t=>{this._handleReaderAnnouncement()}),this.label.events.on("dataitemchanged",t=>{this._handleReaderAnnouncement()}),this._root._tooltips.push(this)}_handleReaderAnnouncement(){this.get("readerAnnounce")&&this.isVisibleDeep()&&this._root.readerAlert(this.label.getAccessibleText())}get label(){return this._label}_dispose(){super._dispose(),X(this._root._tooltips,this)}_updateChildren(){super._updateChildren(),(this.isDirty("pointerOrientation")||this.isPrivateDirty("minWidth")||this.isPrivateDirty("minHeight"))&&this.get("background")._markDirtyKey("width"),this.get("labelText")!=null&&this.label.set("text",this.get("labelText")),this.get("labelHTML")!=null&&this.label.set("html",this.get("labelHTML")),this.get("labelAriaLabel")!=null&&this.label.set("ariaLabel",this.get("labelAriaLabel"))}_changed(){if(super._changed(),(this.isDirty("pointTo")||this.isDirty("pointerOrientation"))&&this._updateBackground(),this.isDirty("tooltipTarget")&&this.updateBackgroundColor(),this.isDirty("keepTargetHover"))if(this.get("keepTargetHover")){const t=this.get("background");this._keepHoverDp=new Y([t.events.on("pointerover",e=>{let r=this.get("tooltipTarget");r&&(r.parent&&r.parent.getPrivate("tooltipTarget")==r&&(r=r.parent),r.hover())}),t.events.on("pointerout",e=>{let r=this.get("tooltipTarget");r&&(r.parent&&r.parent.getPrivate("tooltipTarget")==r&&(r=r.parent),this._htmlContentHovered||r.unhover())})]),this.label.onPrivate("htmlElement",e=>{this._keepHoverDp&&e&&this._keepHoverDp.disposers.push(x(e,"pointerleave",r=>{const l=this.root._renderer.getEvent(r);t.events.dispatch("pointerout",{type:"pointerout",originalEvent:l.event,point:l.point,simulated:!1,target:t})}))})}else this._keepHoverDp&&(this._keepHoverDp.dispose(),this._keepHoverDp=void 0)}_onShow(){super._onShow(),this.updateBackgroundColor()}updateBackgroundColor(){let i=this.get("tooltipTarget");const t=this.get("background");let e,r;if(i&&t){if(e=i.get("fill"),r=i.get("stroke"),e==null&&(e=r),this.get("getFillFromSprite")&&(this._fillDp&&this._fillDp.dispose(),e!=null&&t.set("fill",e),this._fillDp=i.on("fill",l=>{l!=null&&(t.set("fill",l),this._updateTextColor(l))}),this._disposers.push(this._fillDp)),this.get("getFillGradientFromSprite")){this._fillGrDp&&this._fillGrDp.dispose();let l=i.get("fillGradient");l!=null&&t.set("fillGradient",l),this._fillGrDp=i.on("fillGradient",o=>{o!=null&&t.set("fillGradient",o)}),this._disposers.push(this._fillGrDp)}this.get("getStrokeFromSprite")&&(this._strokeDp&&this._strokeDp.dispose(),e!=null&&t.set("stroke",e),this._strokeDp=i.on("fill",l=>{l!=null&&t.set("stroke",l)}),this._disposers.push(this._strokeDp)),this.get("getLabelFillFromSprite")&&(this._labelDp&&this._labelDp.dispose(),e!=null&&this.label.set("fill",e),this._labelDp=i.on("fill",l=>{l!=null&&this.label.set("fill",l)}),this._disposers.push(this._labelDp))}this._updateTextColor(e)}_updateTextColor(i){this.get("autoTextColor")&&(i==null&&(i=this.get("background").get("fill")),i==null&&(i=this._root.interfaceColors.get("background")),i instanceof L&&this.label.set("fill",L.alternative(i,this._root.interfaceColors.get("alternativeText"),this._root.interfaceColors.get("text"))))}_setDataItem(i){super._setDataItem(i),this.label._setDataItem(i)}_updateBackground(){super.updateBackground();const i=this._root.container;if(i){let t=.5,e=.5,r=this.get("centerX");r instanceof j&&(t=r.value);let l=this.get("centerY");l instanceof j&&(e=l.value);let o=i.width(),m=i.height(),c=this.parent,y=0,T=0;if(c){y=c.x(),T=c.y();const b=c.get("layerMargin");b&&(y+=b.left||0,T+=b.top||0,o+=(b.left||0)+(b.right||0),m+=(b.top||0)+(b.bottom||0))}const f=this.get("bounds",{left:-y,top:-T,right:o-y,bottom:m-T});this._updateBounds();let p=this.width(),a=this.height();p===0&&(p=this._w),a===0&&(a=this._h);let _=this.get("pointTo",{x:o/2,y:m/2}),h=_.x,u=_.y,s=this.get("pointerOrientation"),n=this.get("background"),g=0,v=0,D=0;n instanceof k&&(g=n.get("pointerLength",0),v=n.get("strokeWidth",0)/2,D=v,n.set("width",p),n.set("height",a));let C=0,H=0,O=f.right-f.left,S=f.bottom-f.top;s=="horizontal"||s=="left"||s=="right"?(v=0,s=="horizontal"?h>f.left+O/2?(h-=p*(1-t)+g,D*=-1):h+=p*t+g:s=="left"?h+=p*(1-t)+g:(h-=p*t+g,D*=-1)):(D=0,s=="vertical"?u>f.top+a/2+g?u-=a*(1-e)+g:(u+=a*e+g,v*=-1):s=="down"?u-=a*(1-e)+g:(u+=a*e+g,v*=-1)),h=d(h,f.left+p*t,f.left+O-p*(1-t))+D,u=d(u,f.top+a*e,f.top+S-a*(1-e))-v,C=_.x-h+p*t+D,H=_.y-u+a*e-v,this._fx=h,this._fy=u;const w=this.get("animationDuration",0);if(w>0&&this.get("visible")&&this.get("opacity")>.1){const b=this.get("animationEasing");this.animate({key:"x",to:h,duration:w,easing:b}),this.animate({key:"y",to:u,duration:w,easing:b})}else this.set("x",h),this.set("y",u);n instanceof k&&(n.set("pointerX",C),n.set("pointerY",H)),p>0&&(this._w=p),a>0&&(this._h=a)}}}Object.defineProperty(P,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tooltip"});Object.defineProperty(P,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:B.classNames.concat([P.className])});export{P as T};
