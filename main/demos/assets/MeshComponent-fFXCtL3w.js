import{z as T,b6 as M,am as x,q as o,v as s,gc as $,G as N,H as L,x as g,bp as H,bj as W,i as U,f as y,ce as j}from"./main-Crkq4LWq.js";import{c as E}from"./imageUtils-rE9d6Mzq.js";import{n as S,r as I}from"./meshProperties-B4vupnXI.js";var p;const f=new WeakMap;let R=0,a=class extends T{static{p=this}constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,r,i,m){if(e instanceof HTMLImageElement){const h={type:"image-element",src:M(e.src,m),crossOrigin:e.crossOrigin};r[i]=h}else if(e instanceof HTMLCanvasElement){const h={type:"canvas-element",imageData:D(e.getContext("2d").getImageData(0,0,e.width,e.height))};r[i]=h}else if(e instanceof HTMLVideoElement){const h={type:"video-element",src:M(e.src,m),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};r[i]=h}else if(e instanceof ImageData){const h={type:"image-data",imageData:D(e)};r[i]=h}}readData(e){switch(e.type){case"image-element":{const r=new Image;return r.src=e.src,r.crossOrigin=e.crossOrigin,r}case"canvas-element":{const r=b(e.imageData),i=document.createElement("canvas");return i.width=r.width,i.height=r.height,i.getContext("2d").putImageData(r,0,0),i}case"image-data":return b(e.imageData);case"video-element":{const r=document.createElement("video");return r.src=e.src,r.crossOrigin=e.crossOrigin,r.autoplay=e.autoplay,r.loop=e.loop,r.muted=e.muted,r.preload=e.preload,r}default:return}}get transparent(){const{data:e,url:r}=this,i=m=>m?.toLowerCase().endsWith(".png")||m?.toLocaleLowerCase().startsWith("data:image/png;");return e instanceof HTMLCanvasElement?C(e.getContext("2d").getImageData(0,0,e.width,e.height)):e instanceof ImageData?C(e):!(!r||!i(r))||!!(e instanceof HTMLImageElement&&i(e.src))}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",r=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?r(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?r(this.data.src):(f.has(this.data)||f.set(this.data,++R),r(f.get(this.data))):r()}get memoryUsage(){let e=0;if(e+=this.url!=null?this.url.length:0,this.data!=null){const r=this.data;"data"in r?e+=r.data.byteLength:r instanceof HTMLImageElement?e+=r.naturalWidth*r.naturalHeight*3:r instanceof HTMLCanvasElement&&(e+=r.width*r.height*3)}return e}clone(){const e={url:this.url,data:this.data,transparent:this.transparent,wrap:this._cloneWrap()};return new p(e)}cloneWithDeduplication(e){const r=e.get(this);if(r)return r;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(e){return typeof e=="string"?new p({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new p({data:e}):x(p,e)}};function D(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}function b(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return E(r,t.width,t.height)}function C(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}o([s({type:String,json:{write:$}})],a.prototype,"url",null),o([s({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),s()],a.prototype,"data",null),o([N("data")],a.prototype,"writeData",null),o([L("data")],a.prototype,"readData",null),o([s({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],a.prototype,"transparent",null),o([s({json:{write:!0}})],a.prototype,"wrap",void 0),o([s({readOnly:!0})],a.prototype,"contentHash",null),a=p=o([g("esri.geometry.support.MeshTexture")],a);let u=class extends H.ClonableMixin(T){constructor(t){super(t),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};o([s({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"offset",void 0),o([s({type:Number,nonNullable:!0,json:{write:!0}})],u.prototype,"rotation",void 0),o([s({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"scale",void 0),u=o([g("esri.geometry.support.MeshTextureTransform")],u);var v;let n=v=class extends T{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new v(this.clonePropertiesWithDeduplication(e));return t?.set(this,i),i}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};o([s({type:W,json:{write:!0}})],n.prototype,"color",void 0),o([s({type:a,json:{write:!0}})],n.prototype,"colorTexture",void 0),o([s({type:u,json:{write:!0}})],n.prototype,"colorTextureTransform",void 0),o([s({type:a,json:{write:!0}})],n.prototype,"normalTexture",void 0),o([s({type:u,json:{write:!0}})],n.prototype,"normalTextureTransform",void 0),o([s({nonNullable:!0,json:{write:!0}})],n.prototype,"alphaMode",void 0),o([s({nonNullable:!0,json:{write:!0}})],n.prototype,"alphaCutoff",void 0),o([s({nonNullable:!0,json:{write:!0}})],n.prototype,"doubleSided",void 0),n=v=o([g("esri.geometry.support.MeshMaterial")],n);var w;let l=w=class extends n{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new w(this.clonePropertiesWithDeduplication(e));return t?.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};o([s({type:W,json:{write:!0}})],l.prototype,"emissiveColor",void 0),o([s({type:a,json:{write:!0}})],l.prototype,"emissiveTexture",void 0),o([s({type:u,json:{write:!0}})],l.prototype,"emissiveTextureTransform",void 0),o([s({type:a,json:{write:!0}})],l.prototype,"occlusionTexture",void 0),o([s({type:u,json:{write:!0}})],l.prototype,"occlusionTextureTransform",void 0),o([s({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],l.prototype,"metallic",void 0),o([s({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],l.prototype,"roughness",void 0),o([s({type:a,json:{write:!0}})],l.prototype,"metallicRoughnessTexture",void 0),o([s({type:u,json:{write:!0}})],l.prototype,"metallicRoughnessTextureTransform",void 0),l=w=o([g("esri.geometry.support.MeshMaterialMetallicRoughness")],l);var d;let c=d=class extends T{static from(t){return x(d,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return S(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},U.getLogger(this))}castMaterial(t){return x(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?l:n,t)}clone(){return new d({faces:y(this.faces),shading:this.shading,material:y(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const r={faces:y(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new d(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};o([s({json:{write:I}})],c.prototype,"faces",void 0),o([j("faces")],c.prototype,"castFaces",null),o([s({type:n,json:{write:!0}})],c.prototype,"material",void 0),o([j("material")],c.prototype,"castMaterial",null),o([s({json:{write:!0}})],c.prototype,"name",void 0),o([s({type:String,json:{write:!0}})],c.prototype,"shading",void 0),o([s({type:Boolean})],c.prototype,"trustSourceNormals",void 0),c=d=o([g("esri.geometry.support.MeshComponent")],c);export{l as a,c as h,u as p,a as u};
