import{eS as N,cc as M,s as Z,i as A,eT as G,eU as J}from"./main-CtmwM019.js";import{B as K,U as Q}from"./colorUtils-D3e_O9k3.js";import{f as V,b as X,h as Y,w as W,d as _}from"./utils-D6aoGCcc.js";import{u as S,t as j,s as $,l as tt,L as et,p as at,o as lt,n as nt,e as st,c as rt,m as ot}from"./previewUtils-VNo3yuWa.js";import{l as F,d as it}from"./symbolUtils-Ciex-nUn.js";import{resolveWebStyleSymbol as ct}from"./webStyleSymbolUtils-BR-BDddg.js";import"./preload-helper-DMGCcr4D.js";import"./vec42-DZ0sp4MX.js";import"./vec4f64-DPb6J-GU.js";import"./asyncUtils-BZq6cT_d.js";import"./jsonUtils-CG4V1ypX.js";import"./parser-B5KtsVQI.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-Ba1tXzxc.js";import"./cimSymbolUtils-CBOyuQ8I.js";import"./utils-DQaLv0i_.js";import"./defaultCIMValues-XI-Li77m.js";import"./LRUCache-B52YywOm.js";import"./MemCache-Dy3u4age.js";import"./jsxFactory-CRwrqbBC.js";import"./intl-BF_HwN3J.js";import"./messages-CIIwatVx.js";import"./uuid-Oe6SV2kF.js";import"./sanitizerUtils-BSv1Bmu5.js";import"./mat2df32-Dpt2CT5P.js";import"./mat2d-Bgm8yl9G.js";import"./devEnvironmentUtils-8WtPGj6h.js";import"./styleUtils-CodmB4wT.js";import"./webStyleAcceptedFormats-CG7ZQ6BV.js";const L=22,D=120,O=80,B=50,q=20;function z(t){const e=t.outline,l=t.material!=null?t.material.color:null,a=l!=null?l.toHex():null;if(e==null||"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none")return t.type==="fill"&&a==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const s=M(e.size)||0;return{color:"rgba("+(e.color!=null?e.color.toRgba():"255,255,255,1")+")",width:Math.min(s,O),style:"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"?W(e.pattern.style):null,join:"butt",cap:"patternCap"in e?e.patternCap:"butt"}}async function pt(t,e){if(t.thumbnail?.url)return t.thumbnail.url;if(e.type==="icon"&&e?.resource?.href)return _(e);const l=N("esri/images/Legend/legend3dsymboldefault.png");if(t.styleOrigin&&(t.styleOrigin.styleName||t.styleOrigin.styleUrl)){const a=await ct(t.styleOrigin,{portal:t.styleOrigin.portal}).catch(()=>null);if(a&&"thumbnail"in a&&a.thumbnail?.url)return a.thumbnail.url}return l}function U(t,e=1){const l=t.a,a=K(t),s=a.h,c=a.s/e,o=100-(100-a.v)/e,{r:m,g:y,b:i}=Q({h:s,s:c,v:o});return[m,y,i,l]}function C(t){return t.type==="water"?t.color==null?null:t.color:t.material?.color==null?null:t.material.color}function r(t,e=0){const l=C(t);if(!l){if(t.type==="fill")return null;const s=X.r,c=S(s,e);return[c,c,c,100]}const a=l.toRgba();for(let s=0;s<3;s++)a[s]=S(a[s],e);return a}async function ut(t,e){const l=t.style;return l==="none"?null:{type:"pattern",x:0,y:0,src:await V(N(`esri/symbols/patterns/${l}.png`),e.toCss(!0)),width:5,height:5}}function H(t){return t.outline?z(t):{color:"rgba(0, 0, 0, 1)",width:1.5}}function R(t,e){const l=C(t);if(!l)return null;let a="rgba(";return a+=S(l.r,e)+",",a+=S(l.g,e)+",",a+=S(l.b,e)+",",a+l.a+");"}function I(t,e){const l=t.edges;return!l||!l.color||!l.size?null:{color:l.color.toCss(!0),width:Math.min(M(l.size),e,O),join:"round"}}function E(t,e){const l=R(t,e);if(!l||"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"&&t.pattern.style==="none")return null;const a={color:l,width:Math.min(t.size?M(t.size):.75,O)};return"pattern"in t&&t.pattern?.type==="style"&&(a.style=W(t.pattern.style)),"cap"in t&&t.cap&&(a.cap=t.cap),"join"in t&&t.join&&(a.join=t.join==="miter"?M(2):t.join),a}function P(t,e,l){const a=l!=null?.75*l:0;return{type:"linear",x1:a?.25*a:0,y1:a?.5*a:0,x2:a||4,y2:a?.5*a:4,colors:[{color:t,offset:0},{color:e,offset:1}]}}function ht(t){const e=t.depth,l=t.height,a=t.width;return a!==0&&e!==0&&l!==0&&a===e&&a!=null&&l!=null&&a<l}function mt(t,e,l){const a=[];if(!t)return a;switch(t.type){case"icon":{const o=e,m=e;switch(t.resource?.primitive??J){case"circle":a.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:r(t,0),stroke:z(t)});break;case"square":a.push({shape:{type:"path",path:[{command:"M",values:[0,m]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,m]},{command:"Z",values:[]}]},fill:r(t,0),stroke:z(t)});break;case"triangle":a.push({shape:{type:"path",path:[{command:"M",values:[0,m]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,m]},{command:"Z",values:[]}]},fill:r(t,0),stroke:z(t)});break;case"cross":a.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,m]},{command:"M",values:[0,.5*m]},{command:"L",values:[o,.5*m]}]},stroke:H(t)});break;case"x":a.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,m]},{command:"M",values:[o,0]},{command:"L",values:[0,m]}]},stroke:H(t)});break;case"kite":a.push({shape:{type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*m]},{command:"L",values:[.5*o,m]},{command:"Z",values:[]}]},fill:r(t,0),stroke:z(t)})}break}case"object":switch(t.resource?.primitive??G){case"cone":{const s=P(r(t,0),r(t,-.6),l?q:e),c=nt(e,l);a.push({shape:c[0],fill:s},{shape:c[1],fill:s});break}case"inverted-cone":{const s=r(t,0),c=P(s,r(t,-.6),e),o=lt(e);a.push({shape:o[0],fill:c},{shape:o[1],fill:s});break}case"cube":{const s=at(e,l);a.push({shape:s[0],fill:r(t,0)},{shape:s[1],fill:r(t,-.3)},{shape:s[2],fill:r(t,-.5)});break}case"cylinder":{const s=P(r(t,0),r(t,-.6),l?q:e),c=et(e,l);a.push({shape:c[0],fill:s},{shape:c[1],fill:s},{shape:c[2],fill:r(t,0)});break}case"diamond":{const s=tt(e);a.push({shape:s[0],fill:r(t,-.3)},{shape:s[1],fill:r(t,0)},{shape:s[2],fill:r(t,-.3)},{shape:s[3],fill:r(t,-.7)});break}case"sphere":{const s=P(r(t,0),r(t,-.6));s.x1=0,s.y1=0,s.x2=.25*e,s.y2=.25*e,a.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:s});break}case"tetrahedron":{const s=$(e);a.push({shape:s[0],fill:r(t,-.3)},{shape:s[1],fill:r(t,0)},{shape:s[2],fill:r(t,-.6)});break}}break}return a}function T(t){const e=typeof t?.size=="number"?t?.size:null;return e?M(e):null}function ft(t){return t.type==="icon"?"multiply":"tint"}async function yt(t,e){const l=T(e),a=e?.maxSize?M(e.maxSize):null,s=e?.disableUpsampling??!1,c=t.symbolLayers,o=[],m=[];let y=!1,i=0,d=0,w=0;c.forEach(n=>{if(n.type!=="icon"&&n.type!=="object")return;n&&n.type==="icon"&&(w=Math.max(n.size&&M(n.size),w));const u=n.type==="icon"?n.size&&M(n.size):0,h=l||u?Math.ceil(Math.min(l||u,a||D)):L;let f=n.type==="icon"?n.angle:null;if(e?.rotation!=null&&(f=(f??0)+e.rotation),m.push(f),n?.resource?.href){const b=pt(t,n).then(k=>{const g=n?.material?.color,x=ft(n);return it(k,h,g,x,s)}).then(k=>{const g=k.width,x=k.height;return i=Math.max(i,g),d=Math.max(d,x),f&&(y=!0),[{shape:{type:"image",x:0,y:0,width:g,height:x,src:k.url},fill:null,stroke:null}]});o.push(b)}else{let b=h;n.type==="icon"&&l&&(b=h*(u/w));const k=e?.symbolConfig==="tall"||e?.symbolConfig?.isTall||n.type==="object"&&ht(n);i=Math.max(i,k?q:b),d=Math.max(d,b),f&&n.resource?.primitive&&["square","triangle","x"].includes(n.resource?.primitive)&&(y=!0),o.push(Promise.resolve(mt(n,b,k)))}});const p=await Promise.allSettled(o),v=[];return p.forEach(n=>{n.status==="fulfilled"?v.push(n.value):n.reason&&A.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",n.reason)}),F(v,[i,d],{node:e?.node,scale:!1,opacity:e?.opacity,ariaLabel:e?.ariaLabel,rotations:m,useRotationSize:y})}function dt(t,e){const l=t.symbolLayers,a=[],s=Y(t),c=T(e),o=(e?.maxSize?M(e.maxSize):null)||O;let m,y=0,i=0;return l.forEach((d,w)=>{if(!d||d.type!=="line"&&d.type!=="path")return;const p=[];switch(d.type){case"line":{const v=E(d,0);if(v==null)break;const n=v?.width||0;w===0&&(m=n);const u=Math.min(c||n,o),h=w===0?u:c?u*(n/m):u,f=h>B/2?2*h:B;i=Math.max(i,h),y=Math.max(y,f),v.width=h,p.push({shape:{type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[y,.5*i]}]},stroke:v});break}case"path":{const v=Math.min(c||L,o),n=r(d,0),u=r(d,-.2),h=R(d,-.4),f=h?{color:h,width:1}:{};if(d.profile==="quad"){const b=d.width,k=d.height,g=st(b&&k?b/k:1,k===0,b===0),x={...f,join:"bevel"};p.push({shape:g[0],fill:u,stroke:x},{shape:g[1],fill:u,stroke:x},{shape:g[2],fill:n,stroke:x})}else p.push({shape:j.pathSymbol3DLayer[0],fill:u,stroke:f},{shape:j.pathSymbol3DLayer[1],fill:n,stroke:f});i=Math.max(i,v),y=i}}a.push(p)}),Promise.resolve(F(a,[y,i],{node:e?.node,scale:s,opacity:e?.opacity,ariaLabel:e?.ariaLabel}))}async function bt(t,e){const l=t.type==="mesh-3d",a=t.symbolLayers,s=T(e),c=e?.maxSize?M(e.maxSize):null,o=s||L,m=[];let y=0,i=0,d=!1;for(let w=0;w<a.length;w++){const p=a.at(w),v=[];if(!l||p.type==="fill"){switch(p.type){case"fill":{const n=Math.min(o,c||D);if(y=Math.max(y,n),i=Math.max(i,n),d=!0,l){const u=j.meshSymbol3DFill,h=R(p,-.4),f=I(p,.05*n)??(h?{join:"round",color:h,width:1}:null);v.push({shape:u[0],fill:r(p,0),stroke:f},{shape:u[1],fill:r(p,-.2),stroke:f},{shape:u[2],fill:r(p,-.6),stroke:f})}else{let u=r(p,0);const h="pattern"in p?p.pattern:null,f=z(p),b=C(p);h!=null&&h.type==="style"&&h.style!=="solid"&&b&&(u=await ut(h,b)),v.push({shape:j.fill[0],fill:u,stroke:f})}break}case"line":{const n=E(p,0);if(n==null)break;const u={stroke:n,shape:j.fill[0]};y=Math.max(y,L),i=Math.max(i,L),v.push(u);break}case"extrude":{const n=r(p,0),u=r(p,-.2),h=Math.min(o,c||D),f=ot(h),b=L,k=.7*L+.5*h,g=I(p,.1*Math.min(b,k))??{join:"round",...E(p,-.4),width:1};v.push({shape:f[0],fill:u,stroke:g},{shape:f[1],fill:u,stroke:g},{shape:f[2],fill:n,stroke:g}),y=Math.max(y,b),i=Math.max(i,k);break}case"water":{const n=C(p),u=U(n),h=U(n,2),f=U(n,3),b=rt();d=!0,v.push({shape:b[0],fill:u},{shape:b[1],fill:h},{shape:b[2],fill:f});const k=Math.min(o,c||D);y=Math.max(y,k),i=Math.max(i,k);break}}m.push(v)}}return F(m,[y,i],{node:e?.node,scale:d,opacity:e?.opacity,ariaLabel:e?.ariaLabel})}function Kt(t,e){if(t.symbolLayers.length===0)return Promise.reject(new Z("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(t.type){case"point-3d":return yt(t,e);case"line-3d":return dt(t,e);case"polygon-3d":case"mesh-3d":return bt(t,e)}return Promise.reject(new Z("symbolPreview: swatchInfo3D","symbol not supported."))}export{ut as getPatternDescriptor,T as getSizeFromOptions,r as getSymbolLayerFill,Kt as previewSymbol3D};
