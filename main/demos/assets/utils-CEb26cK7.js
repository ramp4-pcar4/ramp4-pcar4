import{am as I,lS as T,lT as w,lU as v,lV as S,V as M,i as C,h9 as f,_ as l,Y as u,Z as H,bc as $,aj as D,ak as A,h6 as x,bC as y}from"./main-CtmwM019.js";import{s as P}from"./Queue-CI0vPdwz.js";import{r as R}from"./signal-Btlkyg0w.js";import{r as K}from"./Version-D0TrQevW.js";const E=I("mac")?"Meta":"Control",L=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),z=n=>L.has(n);let G=class{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const t=e.modifiers;for(const i of this.keyModifiers)if(!t.has(i))return!1;return!0}},k=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const i of t)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(t=>this._handleEvent(t)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let s;typeof t=="function"?(i=t,s=[]):s=t||[];const r=typeof e=="string"?new G(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=c=>{const d=this._incoming[c.match.eventType];if(d){const b=d.indexOf(c);d.splice(b,1),o(),this._manager&&this._manager.updateDependencies()}},p=new O(r,i,{onPause:a,onRemove:a,onResume:c=>{const d=this._incoming[c.match.eventType];d&&!d.includes(c)&&(d.push(c),o(),this._manager&&this._manager.updateDependencies())}});let _=this._incoming[r.eventType];return _||(_=[],this._incoming[r.eventType]=_),_.push(p),o(),this._manager&&this._manager.updateDependencies(),p}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new q(e,{onEmit:(i,s,r,o)=>{this._manager?.emit(i.eventType,s,r,o)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const t=this._incoming[e.type];if(t){for(const i of t)if(i.match.matches(e)&&(i.callback?.(e),e.shouldStopPropagation()))break}}},O=class{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},q=class{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},U=class extends k{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this._id=null,this.registerIncoming("pointer-move",t=>this._update(t.data))}_update(e){const t=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s,native:{pointerId:r}}=e;t===this._value&&this._x===i&&this._y===s&&this._id===r||(this._value=t,this._x=i,this._y=s,this._id=r,this._onChange(r,t,i,s))}},N=class extends k{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=R(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},j=class{constructor(e,t){this._owner=t,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],r=new T(s,void 0,void 0,2,2);this._properties[i]={pool:r,acquired:[]}}this._afterDispatchHandle=w(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const t=this._properties[e];for(const i of t.acquired)v(i)||t.pool.release(i);t.pool.destroy(),t.pool=null,t.acquired=null}this._properties=null,this._owner=null}get(e){const t=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===t;)s=i.pool.acquire(),i.acquired.push(s);return S(),s}_release(){for(const e in this._properties){const t=this._properties[e];let i=0;for(const s of t.acquired)v(s)?t.acquired[i++]=s:t.pool.release(s);t.acquired.length=i}}},W=class{constructor(){this.id=0,this.type="mouse",this.location=f()}},h=class extends M{constructor(n){super(n),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=E,this._propertiesPool=new j({latestPointerInfo:()=>new W},this),this._latestPointerInfo=void 0,this._paused=!1,this._testTimestamp=void 0}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const n=Object.keys(this._nameToGroup);for(const e of n)this.uninstallHandlers(e);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(n=>n.handler.hasPendingInputs)}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get latestPointerInfo(){return this._latestPointerInfo}get updating(){return this.hasPendingInputs||this._paused}installHandlers(n,e,t=g.INTERNAL){if(this._nameToGroup[n]||e.length===0)return;const i={name:n,handlers:e.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:t,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[n]=i;for(let s=i.handlers.length-1;s>=0;s--){const r=i.handlers[s];this._handlers.push(r),r.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,p,_,c)=>{this._emitInputEvent(r.priorityIndex+1,o,a,p,c,_)},setPointerCapture:(o,a)=>{this._setPointerCapture(i,r,o,a)},setEventCallback:o=>{r.eventCallback=o},setUninstallCallback:o=>{r.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(n){const e=this._nameToGroup[n];e?(e.handlers.forEach(t=>{t.removed=!0,t.uninstallCallback?.()}),delete this._nameToGroup[n],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):C.getLogger(this).error("There is no InputHandler group registered under the name `"+n+"`")}hasHandlers(n){return this._nameToGroup[n]!==void 0}isModifierKeyDown(n){return this._activeKeyModifiers.has(n)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const n=new Set,e=new Set;this._handlersPriority=[];for(let t=this._handlers.length-1;t>=0;t--){const i=this._handlers[t];i.priorityIndex=t,this._handlersPriority.push(i)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let t=this._handlersPriority.length-1;t>=0;t--){const i=this._handlersPriority[t];i.priorityIndex=t;let s=i.handler.hasSideEffects;if(!s){for(const r of i.handler.outgoingEventTypes)if(n.has(r)){s=!0;break}}if(s)for(const r of i.handler.incomingEventMatches){n.add(r.eventType);for(const o of r.keyModifiers)z(o)||e.add(o)}i.active=s}this._sourceEvents=n,this._keyModifiers=e,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(n,e,t,i){const s=this._latestPointerInfo;if(s==null||s.id!==n||s.type!==e||s.location.x!==t||s.location.y!==i){const r=this._propertiesPool.get("latestPointerInfo");r.id=n,r.type=e,r.location.x=t,r.location.y=i,this._latestPointerInfo=r}}_onEventReceived(n,e){if(n==="pointer-capture-lost"){const s=e;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(n,e);const t=this._testTimestamp??e.native?.timestamp,i=e.native?.cancelable;this._emitInputEventFromSource(n,e,t,i)}_updateKeyModifiers(n,e){if(!e)return;let t=!1;const i=()=>{t||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),t=!0)},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(i(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(i(),this._activeKeyModifiers.delete(o))};if(n==="key-down"||n==="key-up"){const o=e.key;this._keyModifiers.has(o)&&s(o,n==="key-down")}const r=e.native;s("Alt",!!r?.altKey),s("Control",!!r?.ctrlKey),s("Ctrl",!!r?.ctrlKey),s("Shift",!!r?.shiftKey),s("Meta",!!r?.metaKey),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new U((n,e,t,i)=>this._setLatestPointer(n,e,t,i)),this._multiTouchHandler=new N,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],g.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,g.INTERNAL)}_setPointerCapture(n,e,t,i){const s=n.name+"-"+e.priorityIndex,r=this._pointerCaptures.get(t.pointerId)||new Set;this._pointerCaptures.set(t.pointerId,r),i?(r.add(s),r.size===1&&this.eventSource&&this.eventSource.setPointerCapture(t,!0)):r.has(s)&&(r.delete(s),r.size===0&&(this._pointerCaptures.delete(t.pointerId),this.eventSource&&this.eventSource.setPointerCapture(t,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(n=>!n.removed),this.updateDependencies()}_emitInputEventFromSource(n,e,t,i){this._emitInputEvent(0,n,e,t,i)}_emitInputEvent(n,e,t,i,s,r){const o=i??this._currentPropagation?.timestamp??performance.now(),a=s??!1,p={event:new B(e,t,o,r||this._activeKeyModifiers,a),priorityIndex:n};this._currentPropagation?this._currentPropagation.events.push(p):this._doNewPropagation(p)}_doNewPropagation(n){this._currentPropagation={events:new P,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:n.event.timestamp},this._currentPropagation.events.push(n),this._continuePropagation()}_continuePropagation(){this._paused=!1;const n=this._currentPropagation;if(n){for(;n.events.length>0;){const{event:e,priorityIndex:t}=n.events.pop(),i=e.data?.eventId;if(!(i!=null&&this._stoppedPropagationEventIds.has(i)))for(n.currentHandler=this._handlersPriority[t];n.currentHandler;){if(n.currentHandler.removed)n.needsHandlerGarbageCollect=!0;else{if(n.currentHandler.active&&!e.shouldStopPropagation()&&n.currentHandler.eventCallback?.(e),e.shouldStopPropagation()){i!=null&&this._stoppedPropagationEventIds.add(i);break}if(e.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:e,priorityIndex:n.currentHandler.priorityIndex+1})}n.currentHandler=this._handlersPriority[n.currentHandler.priorityIndex+1]}}n.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(n){const e=new P;e.push(n);const t=this._currentPropagation;if(t){for(;t.events.length;)e.push(t.events.pop());t.events=e,t.currentHandler=null,this._paused=!0}}_compareHandlerPriority(n,e){if(n.handler.hasSideEffects!==e.handler.hasSideEffects)return n.handler.hasSideEffects?1:-1;if(n.groupPriority!==e.groupPriority)return n.groupPriority>e.groupPriority?-1:1;for(const t of n.handler.incomingEventMatches)for(const i of e.handler.incomingEventMatches){if(t.eventType!==i.eventType)continue;const s=t.keyModifiers.filter(r=>i.keyModifiers.includes(r));if(s.length===t.keyModifiers.length!=(s.length===i.keyModifiers.length))return t.keyModifiers.length>i.keyModifiers.length?-1:1}return n.priorityIndex>e.priorityIndex?-1:1}_sortHandlersPriority(n){const e=[];for(const t of n){let i=0;for(;i<e.length&&this._compareHandlerPriority(t,e[i])>=0;)i++;e.splice(i,0,t)}return e}get test(){}};l([u({readOnly:!0})],h.prototype,"hasPendingInputs",null),l([u({constructOnly:!0})],h.prototype,"eventSource",void 0),l([u({constructOnly:!0})],h.prototype,"recognizers",void 0),l([u()],h.prototype,"multiTouchActive",null),l([u()],h.prototype,"_latestPointerInfo",void 0),l([u()],h.prototype,"latestPointerInfo",null),l([u()],h.prototype,"_paused",void 0),l([u({readOnly:!0})],h.prototype,"updating",null),h=l([H("esri.views.input.InputManager")],h);class B{constructor(e,t,i,s,r){this.type=e,this.data=t,this.timestamp=i,this.modifiers=s,this.cancelable=r,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return!!(1&this._propagationState)}defer(e){this._propagationState|=2;const t=(i,s)=>{this._propagationState&=-3;const r=this._resumeCallback;if(this._resumeCallback=null,r&&r(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>t(i,!1),i=>t(i,!0))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}const g={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},Y="z",F="r",V={cancel:"Escape",complete:"Enter"},ue={...V,redo:F,undo:Y,center:"Alt",constraint:"Shift",delete:["Backspace","Delete"],vertexAdd:"f",pan:" "},pe={toggle:"Control"},de={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},_e={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:E,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0}},ge={invertType:["Control","Meta"]};class fe{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,i=>{i.type==="key-down"&&t(i)})}addToggle(e,t){const i=m.fromDefinition(e,t),s=$(this._bindings,i.key,()=>[]);return s.push(i),D(()=>A(s,i))}register(e,t=g.WIDGET){return x([e.on("key-down",i=>this.dispatch(e.inputManager,i),t),e.on("key-up",i=>this.dispatch(e.inputManager,i),t)])}dispatch(e,t){const i=t.key,s=this._bindings.get(i);if(s)for(const r of s)r.process(e,t)}}class m{constructor(e,t,i,s,r){this.key=e,this.modifiers=t,this.repeats=i,this.continuePropagation=s,this.callback=r}process(e,t){if(!(t.key!==this.key||"repeat"in t&&t.repeat&&!this.repeats)){for(const i of this.modifiers)if(!e.isModifierKeyDown(i))return;this.continuePropagation||t.stopPropagation(),this.callback(t)}}static fromDefinition(e,t){if(typeof e=="string")return new m(e,[],!1,!1,t);const{key:i,modifier:s,repeats:r,continuePropagation:o}=e;return new m(i,s?Array.isArray(s)?s:[s]:[],!!r,!!o,t)}}function X(n){return f(n.x,n.y)}function Z(n,e){const t=(n instanceof HTMLElement?n:n.surface)?.getBoundingClientRect();return t?f(e.clientX-t.left,e.clientY-t.top):f(0,0)}function me(n,e){return e instanceof Event?Z(n,e):X(e)}function ye(n){if(n instanceof Event)return!0;if(typeof n=="object"&&"type"in n)switch(n.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}const ve=new y("cyan"),Pe=1,Ee=.25,ke=new y("black"),be=.4,Ie=.2,Te=.25,we="default",Se="temporary",Me=new y("yellow"),Ce={button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",empty:"esri-widget__content--empty",heading:"esri-widget__heading",interactive:"esri-interactive",panel:"esri-widget--panel",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button"};class J extends K{constructor(e,t){super(e,t,"webmap")}}function He(n){return n!=null&&typeof n=="object"&&"declaredClass"in n&&n.declaredClass==="esri.WebMap"}new J(2,35);export{_e as A,j as B,ue as a,ve as b,we as c,de as d,Ce as e,g as f,pe as g,Pe as h,ke as i,be as j,Ie as k,Ee as l,ge as m,X as n,Me as o,V as p,Se as q,He as r,Z as s,k as t,h as u,ye as v,Te as w,me as x,fe as y,E as z};
