import{fy as H,jn as S,jo as D,fz as N,fC as T,fN as M,as as B,fQ as j,eb as f,fU as y,fG as p,ec as b,ed as n,fM as g,fJ as C,fI as E,fS as R,fL as F,jp as A,F as O,jq as z,jr as V}from"./main-CtmwM019.js";import"./preload-helper-DMGCcr4D.js";const I={en:{"keyboardnav.activeNamespace":"Namespace Active: {name}","keyboardnav.helpTitle":"Keyboard Shortcuts","keyboardnav.keysTitle":"Keys for {name}","keyboardnav.helpDescription":'Press <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">S</span> to start fixture shortcuts then type the fixture key (for example <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">D</span>) followed by an action key like <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Use <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Escape</span> to clear the chain or <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Backspace</span> to undo the last key.',"keyboardnav.noShortcuts":"No shortcuts available.","keyboardnav.mainShortcuts.title":"Global controls","keyboardnav.mainShortcuts.numbers":"Focus on an open panel (1 being leftmost)","keyboardnav.mainShortcuts.escape":"Clear the chain or close the focused panel","keyboardnav.mainShortcuts.start":"Start or reset fixture shortcuts","keyboardnav.mainShortcuts.backspace":"Remove the last key in the chain","keyboardnav.chain.help":"Toggle shortcut guide"},fr:{"keyboardnav.activeNamespace":"Espace de noms actif : {name}","keyboardnav.helpTitle":"Raccourcis clavier","keyboardnav.keysTitle":"Raccourcis pour {name}","keyboardnav.helpDescription":`Appuyez sur <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">S</span> pour démarrer les raccourcis de module puis saisissez la touche du module (par exemple <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">D</span>) suivie d'une touche d'action comme <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Utilisez <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Échap</span> pour effacer la chaîne ou <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Retour</span> pour enlever la dernière touche.`,"keyboardnav.noShortcuts":"Aucun raccourci disponible.","keyboardnav.mainShortcuts.title":"Contrôles globaux","keyboardnav.mainShortcuts.numbers":"Concentrer sur un panneau ouvert (1 étant le plus à gauche)","keyboardnav.mainShortcuts.escape":"Effacer la chaîne ou fermer le panneau actif","keyboardnav.mainShortcuts.start":"Démarrer ou réinitialiser les raccourcis de module","keyboardnav.mainShortcuts.backspace":"Retirer la dernière touche de la chaîne","keyboardnav.chain.help":"Afficher ou masquer le guide des raccourcis"}},U=["aria-label"],q={class:"border-b border-gray-200 bg-white px-4 py-20 sm:px-24"},P={class:"text-base font-semibold text-gray-900"},G=["innerHTML"],J={role:"list",class:"m-0 max-w-[calc(var(--container-lg)-(--spacing(8)))] list-none divide-y divide-zinc-900/5 p-0 dark:divide-white/5"},Q={class:"pl-24 mb-8 py-16"},Y={class:"flex items-center gap-x-12"},W={class:"font-mono text-md text-zinc-600"},X={class:"space-y-4 p-16 pl-24"},Z={class:"flex items-center gap-x-12"},ee={class:"font-mono text-md text-zinc-600"},te={class:"flex items-center gap-x-12"},ne={class:"font-mono text-md text-zinc-600"},ae={class:"flex items-center gap-x-12"},se={class:"font-mono text-md text-zinc-600"},ie={class:"flex items-center gap-x-12"},re={class:"font-mono text-md text-zinc-600"},oe={key:0,class:"pl-24 mb-8 py-16 border-b"},ce={class:"font-mono text-md text-zinc-600"},le={class:"flex items-center gap-x-4"},de={class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},pe={class:"font-mono text-md text-zinc-600"},ue={key:0,class:"space-y-4 p-16 pl-24"},ge={class:"flex items-center gap-x-4"},me={class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},fe={class:"font-mono text-md text-zinc-600"},$='button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])',be=H({__name:"keyboardnav",setup(w){const a=S(),{activeNamespace:t,namespaces:e,helpVisible:l}=D(a),{t:o}=N(),u=T(()=>Object.entries(e.value).map(([i,s])=>({id:i,keys:s?.keys??[]}))),c=M("dialogRef"),d=R("iApi"),r=B(null);function h(i){return i?(i.tabIndex<0&&i.setAttribute("tabindex","-1"),i):null}function k(){const i=c.value;if(!i)return;const s=i.querySelector($);h(s??i)?.focus({preventScroll:!0})}function x(){const i=d?.geo?.map?.esriView?.container??document.getElementById("esriMap");return i?i.querySelector(".esri-view-surface")??i.querySelector($)??i:null}function L(){const i=x(),s=r.value&&document.contains(r.value)?r.value:null;h(i??s)?.focus({preventScroll:!0}),r.value=null}function _(){a.setHelpVisible(!1),a.resetChain({suppressHandler:!0})}function K(i){i.target===i.currentTarget&&_()}return j(l,async i=>{i?(r.value=document.activeElement instanceof HTMLElement?document.activeElement:null,await A(),l.value&&k()):(await A(),l.value||L())}),(i,s)=>p(l)?(b(),f("div",{key:0,class:"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity pointer-events-auto",tabindex:"-1",onClick:K},[n("div",{ref_key:"dialogRef",ref:c,class:"relative w-[640px] max-h-[80vh] overflow-y-auto rounded-xl bg-white py-8 px-10 shadow-xl",role:"dialog","aria-modal":"true","aria-live":"polite"},[n("button",{type:"button",class:"absolute right-8 top-8 text-gray-500 hover:text-black focus:text-black p-4","aria-label":p(o)("panels.controls.close"),onClick:_},s[0]||(s[0]=[n("svg",{class:"fill-current w-16 h-16",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512"},[n("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})],-1)]),8,U),n("div",q,[n("h3",P,g(p(o)("keyboardnav.helpTitle")),1),n("div",{innerHTML:p(o)("keyboardnav.helpDescription"),class:"mt-6 text-sm text-gray-500"},null,8,G)]),n("ul",J,[n("li",Q,[n("div",Y,[n("span",W,g(p(o)("keyboardnav.mainShortcuts.title")),1)]),n("div",X,[n("div",Z,[s[1]||(s[1]=n("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," 1-5 ",-1)),s[2]||(s[2]=n("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),n("span",ee,g(p(o)("keyboardnav.mainShortcuts.numbers")),1)]),n("div",te,[s[3]||(s[3]=n("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," ESC ",-1)),s[4]||(s[4]=n("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),n("span",ne,g(p(o)("keyboardnav.mainShortcuts.escape")),1)]),n("div",ae,[s[5]||(s[5]=n("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," S ",-1)),s[6]||(s[6]=n("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),n("span",se,g(p(o)("keyboardnav.mainShortcuts.start")),1)]),n("div",ie,[s[7]||(s[7]=n("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," Backspace ",-1)),s[8]||(s[8]=n("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),n("span",re,g(p(o)("keyboardnav.mainShortcuts.backspace")),1)])])]),u.value.length===0?(b(),f("li",oe,[n("p",ce,g(p(o)("keyboardnav.noShortcuts")),1)])):y("",!0),(b(!0),f(C,null,E(u.value,m=>(b(),f("li",{key:m.id,class:"pl-24 mb-8 py-16 border-b"},[n("div",{class:F(["flex items-center gap-x-12",{"opacity-60":p(t)&&p(t)!==m.id}])},[n("div",le,[s[9]||(s[9]=n("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},"S",-1)),n("span",de,g(m.id),1)]),s[10]||(s[10]=n("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),n("span",pe,g(p(o)(`keyboardnav.ns.${m.id}`)),1)],2),m.keys.length?(b(),f("div",ue,[(b(!0),f(C,null,E(m.keys,v=>(b(),f("div",{key:v.key,class:"flex items-center gap-x-12"},[n("div",ge,[n("span",me,g(v.key),1)]),s[11]||(s[11]=n("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),n("span",fe,g(p(o)(`keyboardnav.key.${m.id}.${v.key}`)),1)]))),128))])):y("",!0)]))),128))])],512)])):y("",!0)}});class he extends O{keyboardnavStore=S(this.$vApp.$pinia);_isInput(a){return!a||!(a instanceof HTMLElement)?!1:!!a.closest('input, textarea, [contenteditable="true"]')}register(a,t){const e=a.toUpperCase(),l=this.keyboardnavStore.register(e,t),o=`keyboardnav.ns.${l}`;return Object.entries(t.name).forEach(([u,c])=>{this.$iApi.$i18n.mergeLocaleMessage(u,{[o]:c})}),t.keys.forEach(u=>{const c=`keyboardnav.key.${l}.${u.key}`;Object.entries(u.description).forEach(([d,r])=>{this.$iApi.$i18n.mergeLocaleMessage(d,{[c]:r})})}),l}unregister(a){this.keyboardnavStore.unregister(a.toUpperCase())}reset(){const a=this.keyboardnavStore,t=a.activeNamespace??a.keyChain[1];return t?(a.setChain([z,t]),a.setLastAction(void 0),a.setChainState("awaitAction"),a.activeNamespace=t,"reset"):(a.resetChain({suppressHandler:!0}),"reset")}clear(a){return this.keyboardnavStore.resetChain({event:a,suppressHandler:!0}),"clear"}added(){const a=this.$iApi.$rootEl;a?.addEventListener("keydown",this._handleKeyDown),a?.addEventListener("blur",this._handleBlur)}removed(){const a=this.$iApi.$rootEl;a?.removeEventListener("keydown",this._handleKeyDown),a?.removeEventListener("blur",this._handleBlur)}_handleKeyDown=a=>{if(!(a instanceof KeyboardEvent))return;const t=a;if(this._isInput(t.target))return;const e=this.keyboardnavStore,l=e.keyChain,o=t.altKey||t.ctrlKey||t.metaKey;if(!t.shiftKey&&!o&&!l.length&&/^[1-5]$/.test(t.key)){const d=parseInt(t.key,10)-1,r=this.$iApi.panel.visible[d];r&&(t.preventDefault(),this.$iApi.panel.focus(r));return}const u=t.key,c=u.length===1?u.toUpperCase():u;if(!o&&c==="Escape"&&e.helpVisible){t.preventDefault(),e.setHelpVisible(!1),e.resetChain({suppressHandler:!0});return}if(!t.shiftKey&&!o&&c===z){t.preventDefault();const d=e.chainState==="complete";e.resetChain({suppressHandler:d}),e.setChain([z]),e.setLastAction(void 0),e.setChainState("awaitNamespace");return}if(e.chainState==="idle"){if(c==="Escape"&&!t.shiftKey&&!o){const r=t.target.closest("[data-cy]");if(r&&this.$iApi.$rootEl?.querySelector(".panel-container")?.contains(r)){t.preventDefault();const h=r.getAttribute("data-cy");h&&this.$iApi.panel.close(h)}}return}if(c==="Escape"){t.preventDefault(),e.resetChain({event:t});return}if(c==="Backspace"){if(!l.length)return;t.preventDefault();const d=e.chainState;if(e.setLastAction(void 0),e.popChain(),!e.keyChain.length){e.resetChain({suppressHandler:!0});return}if(e.keyChain.length===1){e.setChainState("awaitNamespace"),e.deactivate(t);return}if(e.keyChain.length===2){e.setChainState("awaitAction");const r=e.keyChain[1];d==="complete"&&r&&e.activate(r,t,{suppressHandler:!1});return}return}if(!(t.shiftKey||o)){if(e.chainState==="awaitNamespace"){const d=Object.keys(e.namespaces);if(c==="H"){t.preventDefault(),e.appendKey("H"),e.setLastAction({namespace:V,key:"H"}),e.finalizeChain({event:t}),e.setHelpVisible(!e.helpVisible);return}if(d.includes(c)){t.preventDefault(),e.appendKey(c),e.setLastAction(void 0),e.activate(c,t),e.setChainState("awaitAction");return}return}if(e.chainState==="awaitAction"){const d=e.activeNamespace??(l[1]||""),r=e.namespaces[d];if(!r){e.resetChain({suppressHandler:!0});return}if(!r.keys.map(x=>x.key.toUpperCase()).includes(c))return;t.preventDefault(),e.appendKey(c);const k=e.trigger(c,t);if(k?.chainAction)return;k&&e.setLastAction(k),e.finalizeChain({event:t});return}}};_handleBlur=()=>{this.keyboardnavStore.resetChain(),this.keyboardnavStore.setHelpVisible(!1)}}class ve extends he{added(){Object.entries(I).forEach(l=>this.$iApi.$i18n.mergeLocaleMessage(...l));const{destroy:a,el:t}=this.mount(be,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(t.childNodes[0]),super.added(),this.removed=()=>{super.removed(),a(),S(this.$vApp.$pinia).$reset()}}}export{ve as default};
