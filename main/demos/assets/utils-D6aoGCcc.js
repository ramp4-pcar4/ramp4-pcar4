const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-D2sEUMFC.js","./preload-helper-DMGCcr4D.js","./main-CtmwM019.js","./main-DZFs8ecF.css","./LRUCache-B52YywOm.js","./MemCache-Dy3u4age.js"])))=>i.map(i=>d[i]);
import{_ as j}from"./preload-helper-DMGCcr4D.js";import{bC as d,cc as u,eS as z,H as _,S as m,g6 as y,g7 as E,g8 as R,cd as A}from"./main-CtmwM019.js";import{a as O}from"./asyncUtils-BZq6cT_d.js";import{i as C}from"./jsonUtils-CG4V1ypX.js";import{u as g,S as D}from"./cimSymbolUtils-CBOyuQ8I.js";import{e as H}from"./LRUCache-B52YywOm.js";const k="picture-fill",$="simple-fill",M="simple-line",x="simple-marker",N="text",P="cim",b=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),w=new H(1e3);function lt(t){const n=t.style;let r=null;if(t)switch(t.type){case x:n!=="cross"&&n!=="x"&&(r=t.color);break;case $:n&&n!=="solid"?n!=="none"&&(r={type:"pattern",x:0,y:0,src:z(`esri/symbols/patterns/${n}.png`),width:5,height:5}):r=t.color;break;case k:r={type:"pattern",src:t.url,width:u(t.width)*t.xscale,height:u(t.height)*t.yscale,x:u(t.xoffset),y:u(t.yoffset)};break;case N:r=t.color;break;case P:r=g(t)}return r}function it(t,n){const r=t+"-"+n,o=w.get(r);return o!=null?Promise.resolve(o):_(t,{responseType:"image"}).then(l=>{const e=l.data,i=e.naturalWidth,a=e.naturalHeight,s=document.createElement("canvas");s.width=i,s.height=a;const c=s.getContext("2d");c.fillStyle=n,c.fillRect(0,0,i,a),c.globalCompositeOperation="destination-in",c.drawImage(e,0,0);const p=s.toDataURL();return w.put(r,p),p})}function L(t){if(!t)return null;let n=null;switch(t.type){case $:case k:case x:n=L(t.outline);break;case M:{const r=u(t.width);t.style!=null&&t.style!=="none"&&r!==0&&(n={color:t.color,style:J(t.style),width:r,cap:t.cap,join:t.join==="miter"?u(t.miterLimit):t.join},n.dashArray=I(n).join(",")||"none");break}default:n=null}return n}function I(t){if(!t?.style)return[];const{dashArray:n,style:r,width:o}=t;if(typeof n=="string"&&n!=="none")return n.split(",").map(i=>Number(i));const l=o??0,e=b.has(r)?b.get(r).map(i=>i*l):[];if(t.cap!=="butt")for(const[i,a]of e.entries())e[i]=i%2==1?a+l:Math.max(a-l,1);return e}const J=(()=>{const t={};return n=>{if(t[n])return t[n];const r=n.replaceAll("-","");return t[n]=r,r}})(),at=new d([128,128,128]);function T(t){const n=t.symbolLayers?.at(-1);if(n&&"outline"in n)return n?.outline?.size}function st(t){if(!t)return 0;if(m(t)){const n=T(t);return n??0}return A(L(t)?.width)}function ct(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(n=>n.type==="object");case"line-3d":return t.symbolLayers.some(n=>n.type==="path");case"polygon-3d":return t.symbolLayers.some(n=>n.type==="object"||n.type==="extrude");default:return!1}}function ut(t){return t.resource?.href??""}function ft(t,n){if(!t)return null;let r=null;return m(t)?r=U(t):y(t)&&(r=t.type==="cim"?g(t):t.color?new d(t.color):null),r?f(r,n):null}function U(t){const n=t.symbolLayers;if(!n)return null;let r=null;return n.forEach(o=>{o.type==="object"&&o.resource?.href||(r=o.type==="water"?o.color:o.material?o.material.color:null)}),r?new d(r):null}function f(t,n){if(n==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*n,new d(r)}function q(t,n,r){const o=t.symbolLayers;if(!o)return;const l=(e,i=!1)=>{let a=n??e??null;return r?.override!=null&&(!a&&i&&(a=new d([255,255,255])),a&&(a.a=r.override)),f(a,r?.add)};o.forEach(e=>{if(e.type==="water")return void(e.color=f(e.color,r?.add));const i=e.material!=null?e.material.color:null,a=l(i,e.type==="icon"&&e.resource?.href!=null);e.material==null?e.material=new E({color:a}):e.material.color=a,"outline"in e&&e.outline?.color&&r?.add!=null&&(e.outline.color=f(e.outline.color,r.add)),"marker"in e&&e.marker!=null&&(e.marker.color=l(e.marker.color))})}function V(t,n,r){n=n??t.color,r?.override!=null&&n&&(n.a=r.override),n&&(t.color=f(n,r?.add)),"outline"in t&&t.outline?.color&&(t.outline.color=f(t.outline.color,r?.add))}function dt(t,n,r){t&&(n||r!=null)&&(n&&(n=new d(n)),m(t)?q(t,n,r):y(t)&&V(t,n,r))}async function W(t,n){const r=t.symbolLayers;r&&await O(r,async o=>B(o,n))}async function B(t,n){switch(t.type){case"extrude":G(t,n);break;case"icon":case"line":case"text":F(t,n);break;case"path":Q(t,n);break;case"object":await K(t,n)}}function F(t,n){const r=v(n);r!=null&&(t.size=r)}function v(t){for(const n of t)if(typeof n=="number")return n;return null}function G(t,n){const r=n[2];typeof r=="number"&&(t.size=r)}async function K(t,n){const{resourceSize:r,symbolSize:o}=await X(t),l=S(n,r,o);l!=null&&(t.width=h(n[0],o[0],r[0],l),t.depth=h(n[1],o[1],r[1],l),t.height=h(n[2],o[2],r[2],l))}function Q(t,n){const r=S(n,R,[t.width,void 0,t.height]);r!=null&&(t.width=h(n[0],t.width,1,r),t.height=h(n[2],t.height,1,r))}function S(t,n,r){for(let o=0;o<3;o++){const l=t[o];switch(l){case"symbol-value":{const e=r[o];return e!=null?e/n[o]:1}case"proportional":break;default:if(l&&n[o])return l/n[o]}}return null}async function X(t){const{computeObjectLayerResourceSize:n}=await j(()=>import("./symbolLayerUtils-D2sEUMFC.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),r=await n(t,10),{width:o,height:l,depth:e}=t,i=[o,e,l];let a=1;for(let s=0;s<3;s++){const c=i[s];if(c!=null){a=c/r[s];break}}for(let s=0;s<3;s++)i[s]==null&&(i[s]=r[s]*a);return{resourceSize:r,symbolSize:i}}function h(t,n,r,o){switch(t){case"proportional":return r*o;case"symbol-value":return n??r;default:return t}}function Y(t,n){const r=v(n);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const o=t.width/t.height;o>1?(t.width=r,t.height=r*o):(t.width=r*o,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function ht(t,n){if(t&&n)return m(t)?W(t,n):void(y(t)&&Y(t,n))}function mt(t,n,r){if(t&&n!=null){if(m(t)){const o=t.symbolLayers;o&&o.forEach(l=>{if(l.type==="object")switch(r){case"tilt":l.tilt=(l.tilt??0)+n;break;case"roll":l.roll=(l.roll??0)+n;break;default:l.heading=(l.heading??0)+n}l.type==="icon"&&(l.angle+=n)})}else if(y(t))switch(t.type){case"simple-marker":case"picture-marker":case"text":t.angle+=n;break;case"cim":D(t,n,!0)}}}function yt(t,n){if(!t)return null;const r=t.effects.map(o=>o.toJSON());return C(r)}function pt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(n=>n.type==="extrude")}export{pt as A,dt as L,ht as M,mt as N,ft as a,at as b,ut as d,it as f,I as g,ct as h,st as m,yt as q,lt as u,J as w,L as y};
