import{cc as y,cd as p}from"./main-CtmwM019.js";import{Y as b}from"./CIMSymbolHelper-DKDCpqRw.js";import{CIMSymbolRasterizer as j}from"./CIMSymbolRasterizer-Bm7oDCDO.js";import{OverrideHelper as L}from"./OverrideHelper-DKqE71Xu.js";import{O as z}from"./utils-DQaLv0i_.js";import{l as R}from"./symbolUtils-Ciex-nUn.js";import"./preload-helper-DMGCcr4D.js";import"./BidiEngine-BvER9tXK.js";import"./labelPoint-DnnG3eTE.js";import"./OptimizedGeometry-CYLi7ZPm.js";import"./memoryEstimations-R8dTJqWI.js";import"./GeometryUtils-BPbhdKVK.js";import"./fontUtils-CNXkNmeB.js";import"./defaultCIMValues-XI-Li77m.js";import"./rasterizingUtils-ZEBapkgM.js";import"./definitions-Bxxl7NsE.js";import"./mat2d-Bgm8yl9G.js";import"./mat2df32-Dpt2CT5P.js";import"./vec2f32-CaVKkSa6.js";import"./Rect-CUzevAry.js";import"./BoundingBox-BSOANoLO.js";import"./CIMResourceManager-BYZ9sp6x.js";import"./imageUtils-CRYyxDSE.js";import"./colorUtils-D3e_O9k3.js";import"./vec42-DZ0sp4MX.js";import"./vec4f64-DPb6J-GU.js";import"./FieldsIndex-BfaTaUfm.js";import"./UnknownTimeZone-B7fquLC-.js";import"./timeZoneUtils-kvnFYCV8.js";import"./ArcadeExpression-BHsVDuiI.js";import"./TimeOnly-BYrd6q6s.js";import"./enum-BshDcSFN.js";import"./callExpressionWithFeature-BbV6fgi9.js";import"./quantizationUtils-C7csQYv9.js";import"./utils-D6aoGCcc.js";import"./asyncUtils-BZq6cT_d.js";import"./jsonUtils-CG4V1ypX.js";import"./parser-B5KtsVQI.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-Ba1tXzxc.js";import"./cimSymbolUtils-CBOyuQ8I.js";import"./LRUCache-B52YywOm.js";import"./MemCache-Dy3u4age.js";import"./jsxFactory-CRwrqbBC.js";import"./intl-BF_HwN3J.js";import"./messages-CIIwatVx.js";import"./uuid-Oe6SV2kF.js";import"./sanitizerUtils-BSv1Bmu5.js";const u=new j(null),g=p(22),x=p(120),M=p(50),E=1;async function q(m,t,a){const r=t?.size;let i=r!=null&&typeof r=="object"&&"width"in r?r.width:r,o=r!=null&&typeof r=="object"&&"height"in r?r.height:r;if(!i||!o)if(a==="esriGeometryPolygon")i=o=t.maxSize?Math.min(t.maxSize,g):g;else{const n=await D(m,t,a);n&&(i=n.width,o=n.height),a==="esriGeometryPolyline"&&(i=t.maxSize?Math.min(t.maxSize,M):M),i=i!=null&&isFinite(i)?Math.min(i,x):g,o=o!=null&&isFinite(o)?Math.max(Math.min(o,x),E):g}return t.style==="legend"&&a==="esriGeometryPolyline"&&(i=M),{width:i,height:o}}async function D(m,t={},a){const r=t.cimOptions||t;a??=r.geometryType||z(m?.data?.symbol);const{feature:i,fieldMap:o,viewParams:n}=r,l=await L.resolveSymbolOverrides(m.data,i,null,o,a,null,n);if(!l)return null;(m=m.clone()).data={type:"CIMSymbolReference",symbol:l},m.data.primitiveOverrides=void 0;const e=[];return b.fetchResources(l,u.resourceManager,e),b.fetchFonts(l,u.resourceManager,e),e.length>0&&await Promise.all(e),b.getEnvelope(l,null,u.resourceManager)}async function jt(m,t={}){const{node:a,opacity:r,symbolConfig:i}=t,o=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,n=t.cimOptions||t,l=n.geometryType||z(m?.data?.symbol),e=await q(m,t,l),{feature:C,fieldMap:I}=n,O=t?.geometry||o||l!=="esriGeometryPolygon"?"preview":"legend";let S=e;const v=e;if(t?.geometry&&(l==="esriGeometryPolygon"||l==="esriGeometryPolyline")&&(y(e.width)<200||y(e.height)<200)){const $=e.width>e.height?p(200)*e.height/e.width:p(200);S={width:e.width>e.height?p(200):p(200)*e.width/e.height,height:$}}const d=await u.rasterizeCIMSymbolAsync(m,C,S,O,I,l,null,n.viewParams,n.allowScalingUp,t?.geometry?.toJSON());if(!d)return null;const{width:F,height:G}=d,h=document.createElement("canvas");h.width=F,h.height=G,h.getContext("2d").putImageData(d,0,0);const f=y(v.width),w=y(v.height),s=new Image(f,w);s.src=h.toDataURL(),s.ariaLabel=t.ariaLabel??null,s.alt=t.ariaLabel??"",r!=null&&(s.style.opacity=`${r}`);let c=s;if(t.cssEffectFilter){const P={shape:{type:"image",x:0,y:0,width:f,height:w,src:s.src},fill:null,stroke:null,offset:[0,0]};c=R([[P]],[f,w],t)}return a&&c&&a.appendChild(c),c}export{D as getCIMSymbolPreviewSize,jt as previewCIMSymbol};
