import{fy as R,fz as q,fS as W,fC as P,fF as K,fE as x,fU as M,ec as p,fG as O,fH as V,ed as A,fL as E,ea as G,eb as h,m1 as ne,as as I,fQ as oe,fR as Y,fT as Z,fD as H,fK as T,iQ as ae,i8 as ee,jp as te,m2 as se,m3 as re,fM as ie,fA as le,hk as D,fP as pe,m4 as F,m5 as ce,fZ as U,fJ as _,fI as B,lC as X,m6 as ue,F as de,fX as fe}from"./main-CtmwM019.js";import{k as me}from"./keyboard-Dy3W513g.js";import"./preload-helper-DMGCcr4D.js";class j{id;options;componentId;constructor(s){const n={options:{},...s};({id:this.id,options:this.options,componentId:this.componentId}=n)}}const ve=["innerHTML"],N=R({__name:"default-button",props:{panelId:{type:String,required:!0},minimize:{type:Boolean,default:!1},overflow:{type:Boolean}},setup(g){const{t:s}=q(),n=W("iApi"),a=g,d=P(()=>n.panel.get(a.panelId)?.button),l=()=>{a.minimize?n.panel.toggleMinimize(a.panelId):n.panel.toggle(a.panelId)};return(e,y)=>{const u=K("appbar-button");return d.value?(p(),x(u,{key:0,onClickFunction:l,tooltip:O(s)(d.value.tooltip),"button-id":g.panelId},{default:V(()=>[A("div",{class:E(["default fill-current w-24 h-24 ml-8 sm:ml-20",{"ml-20":g.overflow}]),innerHTML:d.value.icon},null,10,ve)]),_:1},8,["tooltip","button-id"])):M("",!0)}}}),he={},be={class:"border-b p-0 self-center w-2/3"};function ge(g,s){return p(),h("span",be)}const J=G(he,[["render",ge],["__scopeId","data-v-207b7a12"]]);var ye={name:"maxSize",enabled:!0,phase:"main",requiresIfExists:["offset","preventOverflow","flip"],fn:function(s){var n=s.state,a=s.name,d=s.options,l=ne(n,d),e=n.modifiersData.preventOverflow||{x:0,y:0},y=e.x,u=e.y,c=n.rects.popper,v=c.width,S=c.height,$=n.placement.split("-"),k=$[0],C=k==="left"?"left":"right",o=k==="top"?"top":"bottom";n.modifiersData[a]={width:v-l[C]-y,height:S-l[o]-u}}};const $e=["content","aria-label"],we=R({__name:"more-button",props:{position:{type:String,default:"right-end"},popperOptions:{type:Object,default(){return{}}},numItems:{type:Number,default:1},renderWatch:{type:Number,default:0}},emits:["updateParent"],setup(g,{expose:s,emit:n}){const{t:a}=q(),d=W("iApi"),l=g,e=n;function y(){e("updateParent")}const u=I(!1),c=I(0),v=I(),S=I(),$=I();function k(){y(),te(()=>{C(),u.value=!u.value})}oe(()=>l.renderWatch,()=>{k()});const C=()=>{u.value=!u.value;const o=d.$vApp.$el.querySelector(".inner-shell"),f={name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:m}){const{width:b}=m.modifiersData.maxSize;m.styles.popper={...m.styles.popper,maxWidth:`${b}px`,maxHeight:`${o.offsetHeight-45}px`};const r=Math.min(l.numItems<=0?0:55+44*(l.numItems-1),o.offsetHeight-45);m.styles.popper.height=`${r}px`,$?.value?.offsetHeight&&($.value.style.height=`${r}px`),m.styles.popper.overflowY="auto",m.styles.popper.overflowX="hidden"}};S.value&&$.value&&(c.value++,se(S.value,$.value,{placement:l.position||"right-end",modifiers:[{...ye,options:{boundary:o}},f,{name:"offset",options:{offset:[0,5]}},{name:"preventOverflow",enabled:!0,options:{boundary:o}}],...l.popperOptions})),c.value===1&&k()};return Y(()=>{window.addEventListener("click",o=>{o.target instanceof HTMLElement&&!v.value?.contains(o.target)&&(u.value=!1)},{capture:!0})}),Z(()=>{window.removeEventListener("click",o=>{o.target instanceof HTMLElement&&!v.value?.contains(o.target)&&(u.value=!1)},{capture:!0})}),s({rerender:k}),(o,f)=>{const m=T("focus-item"),b=T("tippy");return p(),h("div",{class:"appbar-item relative inset-x-0 w-full text-center",ref_key:"el",ref:v},[H((p(),h("button",{type:"button",class:"text-gray-400 w-full h-48 focus:outline-none hover:text-white",onClick:f[0]||(f[0]=r=>C()),content:O(a)("appbar.more"),"aria-label":O(a)("appbar.more"),ref_key:"dropdownTrigger",ref:S},f[1]||(f[1]=[A("svg",{class:"fill-current w-24 h-24 m-auto",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[A("path",{d:"M0 0h24v24H0z",fill:"none"}),A("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})],-1)]),8,$e)),[[m],[b,{placement:"right-end"}]]),H(A("div",{id:"dropdown",class:"dropdown shadow-md border border-gray:200 absolute w-64 flex flex-col bg-white rounded",ref_key:"dropdown",ref:$},[ae(o.$slots,"default",{},void 0,!0)],512),[[ee,u.value]])],512)}}}),_e=G(we,[["__scopeId","data-v-f6f556e5"]]),xe={key:0,class:"number absolute top-1 right-2 text-white w-18 rounded-full"},Ie=R({__name:"appbar-button",setup(g){const s=re(),{t:n}=q(),a=W("iApi"),d=P(()=>s.notificationNumber),l=()=>{a.panel.toggle("notifications")};return(e,y)=>{const u=K("appbar-button",!0);return p(),x(u,{onClickFunction:l,tooltip:O(n)("notifications.title"),class:"notification-button","button-id":"notificationsButton"},{default:V(()=>[y[0]||(y[0]=A("svg",{class:"fill-current w-24 h-24 mx-8 sm:mx-20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[A("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})],-1)),d.value&&d.value>0?(p(),h("span",xe,ie(d.value),1)):M("",!0)]),_:1},8,["tooltip"])}}}),ke=G(Ie,[["__scopeId","data-v-13998159"]]),Ee=["content"],Se=R({__name:"appbar",setup(g){const s=le(),n=D(),a=I(0),d=I(0),l=P(()=>n.visible),e=P(()=>n.temporary),{t:y}=q(),u=I(!1),c=I({}),v=I(),S=()=>{te(()=>{F()?.proxy?.$forceUpdate()})},$=()=>{v.value._tippy.hide()},k=o=>{me(o,v.value)&&v.value._tippy.show()},C=()=>{const o=v.value;let f;const m=[...o.children];let b=m[m.length-2].getBoundingClientRect().top;s.mobileView||(b=o.getBoundingClientRect().bottom-38);const r=o.querySelector("#dropdown");for(let i=m.length-4;i>=0;i--){const z=m[i].getBoundingClientRect().bottom;if(b&&r&&(z>b||u.value&&z+56>b))m[i].classList.forEach(L=>{L.includes("identifier")&&(f=L.slice(11))}),f&&(c.value[f]=!0,f.includes("divider")||a.value++,d.value++),u.value||(u.value=!0);else if(z!==0)break}const w=o.querySelector("#more");let t=w.getBoundingClientRect().bottom;if(f=void 0,u.value&&b&&w&&r&&t!==0&&(t<=b-56||r.childElementCount==1&&t<=b)){let i=r.childElementCount,z=0;for(;t<=b-56||i==1;){const L=r.children[z];if(L&&(L.classList.forEach(Q=>{Q.includes("identifier")&&(f=Q.slice(11))}),f&&(c.value[f]=!1,f.includes("divider")||a.value--),t+=48,i-=1,z+=1),i===0){u.value=!1;break}}}Object.keys(c.value).forEach(i=>{o.querySelector(`.identifier-${i}`)||(delete c.value[i],i.includes("divider")||(a.value=Math.max(0,a.value-1)),d.value++)})};return Y(()=>{v.value?.addEventListener("blur",$),v.value?.addEventListener("keyup",k)}),pe(()=>{const o=F();window.addEventListener("resize",()=>o?.proxy?.$forceUpdate())}),Z(()=>{const o=F();window.removeEventListener("resize",()=>o?.proxy?.$forceUpdate()),v.value?.removeEventListener("blur",$),v.value?.removeEventListener("keyup",k)}),ce(async()=>{setTimeout(()=>C(),0)}),(o,f)=>{const m=T("focus-list"),b=T("tippy");return H((p(),h("div",{class:"absolute top-0 left-0 bottom-28 flex flex-col w-40 pointer-events-auto appbar z-50 sm:z-20 bg-black-75 sm:w-64 sm:bottom-38",content:O(y)("panels.controls.items"),ref_key:"el",ref:v},[(p(!0),h(_,null,B(l.value,(r,w)=>(p(),h(_,null,[(p(!0),h(_,null,B(r,(t,i)=>(p(),h(_,null,[typeof t=="string"&&c.value[`${t}-${i}`]!==!0?(p(),x(N,{key:`${t}-${i}-default`,panelId:t,class:E(["appbar-item h-48",`identifier-${t}-${i}`])},null,8,["panelId","class"])):c.value[`${t.id}-${i}`]!==!0?(p(),x(X(t.componentId),{key:`${t.id}-${i}-custom`,options:t.options,class:E(["appbar-item h-48",`identifier-${t.id}-${i}`]),buttonId:t.id},null,8,["options","buttonId","class"])):M("",!0)],64))),256)),c.value[`divider-${w}`]!==!0?(p(),x(J,{class:E(["appbar-item",`identifier-divider-${w}`]),key:`${r}-${w}-default`},null,8,["class"])):M("",!0)],64))),256)),(p(!0),h(_,null,B(e.value?.filter(r=>c.value[`${r}-temp`]!==!0),r=>(p(),x(N,{panelId:r,minimize:!0,key:`${r}-temp`,class:E([`identifier-${r}-temp`,"appbar-item h-48"])},null,8,["panelId","class"]))),128)),H(U(_e,{id:"more",numItems:a.value,renderWatch:d.value,onUpdateParent:S},{default:V(()=>[(p(!0),h(_,null,B(l.value,(r,w)=>(p(),h(_,{key:w},[(p(!0),h(_,null,B(r,(t,i)=>(p(),h(_,null,[typeof t=="string"&&c.value[`${t}-${i}`]?(p(),x(N,{key:`${t}-${i}-default`,panelId:t,class:E(["text-black hover:bg-gray my-4 h-36",`identifier-${t}-${i}`]),overflow:""},null,8,["panelId","class"])):c.value[`${t.id}-${i}`]?(p(),x(X(t.componentId),{key:`${t.id}-${i}-custom`,options:t.options,buttonId:t.id,class:E(["appbar-item h-48",`identifier-${t.id}-${i}`])},null,8,["options","buttonId","class"])):M("",!0)],64))),256)),c.value[`divider-${w}`]?(p(),x(J,{key:0,class:E(["border-black my-4",`identifier-divider-${w}`])},null,8,["class"])):M("",!0)],64))),128)),(p(!0),h(_,null,B(e.value?.filter(r=>c.value[`${r}-temp`]),r=>(p(),x(N,{panelId:r,minimize:!0,key:`${r}-temp`,class:E([`identifier-${r}-temp`,"text-black hover:bg-gray my-4 h-36"]),overflow:""},null,8,["panelId","class"]))),128))]),_:1},8,["numItems","renderWatch"]),[[ee,u.value]]),U(ke,{class:"appbar-item bottom-48 h-48 sm:display-none"}),U(ue,{class:"absolute bottom-0 h-40 sm:display-none w-full text-center",position:"right-start"})],8,Ee)),[[m],[b,{trigger:"manual",touch:!1,placement:"top-end",popperOptions:{placement:"top",modifiers:[{name:"preventOverflow",options:{altAxis:!0}},{name:"flip",options:{fallbackPlacements:["top"]}}]}}]])}}});class Ae extends de{get config(){return super.config}_parseConfig(s){if(!s)return;const n=D(this.$vApp.$pinia);let a;Array.isArray(s.items[0])?a=s.items:a=[s.items];const d=[];a.forEach(l=>{d.push(l.map(e=>typeof e=="string"?e:new j(e)))}),n.items=d.flat().reduce((l,e)=>(l[e instanceof j?e.id:e]=e,l),{}),n.order=d.map(l=>l.map(e=>e instanceof j?e.id:e)),this._validateItems()}_validateItems(){const s=D(this.$vApp.$pinia);s.order.flat().forEach(n=>{typeof s.items[n]!="string"&&[n].some(a=>{this.$iApi.fixture.exists(a)&&!s.items[n]&&(s.items[n].componentId=`${a}-appbar-button`)})})}}const Ce={en:{"appbar.navigation":"Navigation","appbar.more":"More","navigation.export":"Export","navigation.map.export":"Export Map"},fr:{"appbar.navigation":"Navigation","appbar.more":"Plus","navigation.export":"Exporter","navigation.map.export":"Exporter la Carte"}};class Le extends Ae{initialized(){}async added(){Object.entries(Ce).forEach(e=>this.$iApi.$i18n.mergeLocaleMessage(...e));const{destroy:s,el:n}=this.mount(Se,{app:this.$element}),a=this.$vApp.$el.getElementsByClassName("inner-shell")[0];a.insertBefore(n.childNodes[0],a.querySelector(".panel-stack")),this._parseConfig(this.config);const d=this.$vApp.$watch(()=>this.config,e=>this._parseConfig(e)),l=[];l.push(this.$iApi.event.on(fe.COMPONENT,()=>{this._parseConfig(this.config)})),this.removed=()=>{const e=D(this.$vApp.$pinia);d(),l.forEach(c=>this.$iApi.event.off(c));const y={...e.items},u=[...e.temporary];Object.keys(y).forEach(c=>e.removeButton(c)),u.forEach(c=>e.removeButton(c)),s(),e.$reset()}}}export{Le as default};
