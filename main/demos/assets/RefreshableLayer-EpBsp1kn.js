import{O as d,bm as m,az as p,_ as o,Y as h,cA as v,Z as y,ct as g,eP as I,i as b}from"./main-CtmwM019.js";import{a as w}from"./layerContainerType-CSXZNpHb.js";const n=new d,i=new WeakMap;function $(e){D(e)&&n.push(new WeakRef(e))}function C(e){const s=n.find(r=>r.deref()===e);s&&n.remove(s)}function D(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function c(e,s){return Number.isFinite(e)&&Number.isFinite(s)?s<=0?e:c(s,e%s):0}let l=0,f=0;function _(){const e=Date.now();let s=!1;for(const r of n){const t=r.deref();t?t.refreshInterval&&e-(i.get(t)??0)+5>=6e4*t.refreshInterval&&(i.set(t,e),t.refresh(e)):s=!0}if(s)for(let r=n.length-1;r>=0;r--)n.at(r).deref()||n.removeAt(r)}m(()=>{const e=Date.now();let s=0;for(const r of n){const t=r.deref();t&&(s=c(Math.round(6e4*t.refreshInterval),s),t.refreshInterval?i.get(t)||i.set(t,e):i.delete(t))}if(s!==f){if(f=s,clearInterval(l),f===0)return void(l=0);l=setInterval(_,f)}},p);const u=.1,x=e=>{const s=e;let r=class extends s{constructor(...t){super(...t),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=g(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||$(this)},()=>{})}destroy(){C(this)}castRefreshInterval(t){return t>=u?t:t<=0?0:u}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(t=Date.now()){I(this._debounceHasDataChanged()).then(a=>{a&&this._set("refreshTimestamp",t),this.emit("refresh",{dataChanged:a})},a=>{b.getLogger(this).error(a),this.emit("refresh",{dataChanged:!1,error:a})})}async hasDataChanged(){return!0}get test(){}};return o([h({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:w}}}}})],r.prototype,"refreshInterval",void 0),o([v("refreshInterval")],r.prototype,"castRefreshInterval",null),o([h({readOnly:!0})],r.prototype,"refreshTimestamp",void 0),o([h({readOnly:!0})],r.prototype,"refreshParameters",null),r=o([y("esri.layers.mixins.RefreshableLayer")],r),r};export{x as f};
