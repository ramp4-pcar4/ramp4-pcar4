const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-rjtHyluI.js","./preload-helper-DMGCcr4D.js","./main-Crkq4LWq.js","./main-B_8sIZOq.css","./LRUCache-BB1cebTv.js","./MemCache-BSBM3Sy1.js"])))=>i.map(i=>d[i]);
import{_ as z}from"./preload-helper-DMGCcr4D.js";import{bj as u,bU as c,fj as v,$ as S,eG as y,fk as p,fl as _,fm as E,bV as R}from"./main-Crkq4LWq.js";import{a as A}from"./asyncUtils-DfTs-X0F.js";import{i as O}from"./jsonUtils-BKompkv5.js";import{u as w}from"./cimSymbolUtils-TrTP_j9U.js";import{e as C}from"./LRUCache-BB1cebTv.js";const g="picture-fill",k="simple-fill",D="simple-line",$="simple-marker",M="text",N="cim",b=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),d=new C(1e3);function et(t){const n=t.style;let o=null;if(t)switch(t.type){case $:n!=="cross"&&n!=="x"&&(o=t.color);break;case k:n&&n!=="solid"?n!=="none"&&(o={type:"pattern",x:0,y:0,src:v(`esri/symbols/patterns/${n}.png`),width:5,height:5}):o=t.color;break;case g:o={type:"pattern",src:t.url,width:c(t.width)*t.xscale,height:c(t.height)*t.yscale,x:c(t.xoffset),y:c(t.yoffset)};break;case M:o=t.color;break;case N:o=w(t)}return o}function lt(t,n){const o=t+"-"+n;return d.get(o)!==void 0?Promise.resolve(d.get(o)):S(t,{responseType:"image"}).then(r=>{const e=r.data,l=e.naturalWidth,s=e.naturalHeight,a=document.createElement("canvas");a.width=l,a.height=s;const i=a.getContext("2d");i.fillStyle=n,i.fillRect(0,0,l,s),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0);const f=a.toDataURL();return d.put(o,f),f})}function x(t){if(!t)return null;let n=null;switch(t.type){case k:case g:case $:n=x(t.outline);break;case D:{const o=c(t.width);t.style!=null&&t.style!=="none"&&o!==0&&(n={color:t.color,style:U(t.style),width:o,cap:t.cap,join:t.join==="miter"?c(t.miterLimit):t.join},n.dashArray=P(n).join(",")||"none");break}default:n=null}return n}function P(t){if(!t?.style)return[];const{dashArray:n,style:o,width:r}=t;if(typeof n=="string"&&n!=="none")return n.split(",").map(s=>Number(s));const e=r??0,l=b.has(o)?b.get(o).map(s=>s*e):[];if(t.cap!=="butt")for(const[s,a]of l.entries())l[s]=s%2==1?a+e:Math.max(a-e,1);return l}const U=(()=>{const t={};return n=>{if(t[n])return t[n];const o=n.replaceAll("-","");return t[n]=o,o}})(),it=new u([128,128,128]),H=new u("white");function I(t){const n=t.symbolLayers?.at(-1);if(n&&"outline"in n)return n?.outline?.size}function st(t){if(!t)return 0;if(y(t)){const n=I(t);return n??0}return R(x(t)?.width)}function at(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(n=>n.type==="object");case"line-3d":return t.symbolLayers.some(n=>n.type==="path");case"polygon-3d":return t.symbolLayers.some(n=>n.type==="object"||n.type==="extrude");default:return!1}}function ct(t){return t.resource?.href??""}function ut(t,n){if(!t)return null;let o=null;return y(t)?o=J(t):p(t)&&(o=t.type==="cim"?w(t):t.color?new u(t.color):null),o?m(o,n):null}function J(t){const n=t.symbolLayers;if(!n)return null;let o=null;return n.forEach(r=>{r.type==="object"&&r.resource?.href||(o=r.type==="water"?r.color:r.material?r.material.color:null)}),o?new u(o):null}function m(t,n){if(n==null||t==null)return t;const o=t.toRgba();return o[3]=o[3]*n,new u(o)}function T(t,n,o){const r=t.symbolLayers;if(!r)return;const e=l=>m(n??l??(o!=null?H:null),o);r.forEach(l=>{if(l.type!=="object"||!l.resource?.href||n)if(l.type==="water")l.color=e(l.color);else{const s=l.material!=null?l.material.color:null,a=e(s);if(l.material==null?l.material=new _({color:a}):l.material.color=a,o!=null&&"outline"in l&&l.outline?.color!=null&&(l.outline.color=m(l.outline.color,o)),"marker"in l&&l.marker!=null){const i=e(l.marker.color);l.marker.color=i}}})}function V(t,n,o){(n=n??t.color)&&(t.color=m(n,o)),o!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=m(t.outline.color,o))}function ft(t,n,o){t&&(n||o!=null)&&(n&&(n=new u(n)),y(t)?T(t,n,o):p(t)&&V(t,n,o))}async function q(t,n){const o=t.symbolLayers;o&&await A(o,async r=>G(r,n))}async function G(t,n){switch(t.type){case"extrude":B(t,n);break;case"icon":case"line":case"text":W(t,n);break;case"path":K(t,n);break;case"object":await F(t,n)}}function W(t,n){const o=L(n);o!=null&&(t.size=o)}function L(t){for(const n of t)if(typeof n=="number")return n;return null}function B(t,n){const o=n[2];typeof o=="number"&&(t.size=o)}async function F(t,n){const{resourceSize:o,symbolSize:r}=await Q(t),e=j(n,o,r);e!=null&&(t.width=h(n[0],r[0],o[0],e),t.depth=h(n[1],r[1],o[1],e),t.height=h(n[2],r[2],o[2],e))}function K(t,n){const o=j(n,E,[t.width,void 0,t.height]);o!=null&&(t.width=h(n[0],t.width,1,o),t.height=h(n[2],t.height,1,o))}function j(t,n,o){for(let r=0;r<3;r++){const e=t[r];switch(e){case"symbol-value":{const l=o[r];return l!=null?l/n[r]:1}case"proportional":break;default:if(e&&n[r])return e/n[r]}}return null}async function Q(t){const{computeObjectLayerResourceSize:n}=await z(()=>import("./symbolLayerUtils-rjtHyluI.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),o=await n(t,10),{width:r,height:e,depth:l}=t,s=[r,l,e];let a=1;for(let i=0;i<3;i++){const f=s[i];if(f!=null){a=f/o[i];break}}for(let i=0;i<3;i++)s[i]==null&&(s[i]=o[i]*a);return{resourceSize:o,symbolSize:s}}function h(t,n,o,r){switch(t){case"proportional":return o*r;case"symbol-value":return n??o;default:return t}}function X(t,n){const o=L(n);if(o!=null)switch(t.type){case"simple-marker":t.size=o;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=o,t.height=o*r):(t.width=o*r,t.height=o);break}case"simple-line":t.width=o;break;case"text":t.font.size=o}}async function ht(t,n){if(t&&n)return y(t)?q(t,n):void(p(t)&&X(t,n))}function mt(t,n,o){if(t&&n!=null)if(y(t)){const r=t.symbolLayers;r&&r.forEach(e=>{if(e.type==="object")switch(o){case"tilt":e.tilt=(e.tilt??0)+n;break;case"roll":e.roll=(e.roll??0)+n;break;default:e.heading=(e.heading??0)+n}e.type==="icon"&&(e.angle+=n)})}else p(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=n))}function yt(t){if(!t)return null;const n=t.effects.filter(o=>o.type!=="bloom").map(o=>o.toJSON());return O(n)}function pt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(n=>n.type==="extrude")}export{pt as A,ft as L,ht as M,mt as N,U as a,it as b,ct as c,lt as f,P as g,at as h,st as m,yt as q,et as u,ut as w,x as y};
