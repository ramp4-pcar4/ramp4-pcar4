import{V as It,O as et,j4 as it,_ as n,Y as r,Z as k,c5 as ot,E as J,aB as St,cC as Ct,cn as Gt,aw as Rt,bm as nt,fg as Et,az as zt,a9 as j,bR as Ht,aj as L,hX as S,ky as rt,lY as Ft,lZ as Lt,ee as At,l_ as Dt,l$ as st,cU as Zt,hP as at,m0 as lt}from"./main-CtmwM019.js";import{h as Nt}from"./UpdatingHandles-lgENzTF6.js";import{d as jt}from"./asyncUtils-BZq6cT_d.js";import{r as b,V as Yt,R as Bt,E as Jt,f as qt,H as Qt}from"./SketchTooltipInfo-CCynpALS.js";import Wt from"./GraphicsLayer-C7dUYDum.js";import{b as Xt,r as Kt,a as te}from"./drawSurfaces-p-r46VbT.js";import{W as ee,k as ct,v as ie,b as pt,U as oe,T as ne,j as dt,a as re}from"./createUtils-BamL_hyg.js";import{T as H,d as $,v as se,a as ae,q as le}from"./quantityUtils-CU1WV3ce.js";import{c as ce,y as pe,U as de,I as ue}from"./elevationInfoUtils-Rm5QE2pq.js";import{o as vt,u as B,w as ut,g as ht}from"./vec32-gK3TWme0.js";import{h as F,M as he,j as ye,I as wt,w as Ot,Q as ge,U as me}from"./TooltipInfoWithCoordinates-Dsk2T3qF.js";import{x as fe}from"./angularMeasurementUtils-Cr9hvkn9.js";import{a1 as ve,A as we,o as _t}from"./SketchViewModel-Bj0qQq8r.js";import{z as Oe,J as D}from"./boundedPlane-CSMu0tVj.js";import{t as C}from"./vectorStacks-Du2BB1wg.js";import{t as _e,b as ke,o as xe,l as $e}from"./SnappingContext-BvZ1mDD1.js";const q={UndoRedoUpdating:"Cannot perform operation whilst undo redo is updating",UndoInvalidError:"There are no items to Undo",RedoInvalidError:"There are no items to Redo"};class G extends Error{constructor(){super(q.UndoRedoUpdating),this.type="undo-redo-updating-error"}}let be=class extends Error{constructor(){super(q.UndoInvalidError),this.type="undo-redo-undo-error"}};class yt extends Error{constructor(){super(q.RedoInvalidError),this.type="undo-redo-redo-error"}}let w=class extends It{constructor(){super(...arguments),this._stack=new et,this._stackPosition=-1,this._updatingHandles=new Nt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new be;if(this.updating)throw new G;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(1),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new yt;if(this.updating)throw new G;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new yt;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new G;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(i=>i.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new G;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,i=!1){if(this.updating&&!i)return;await it(()=>!this.updating);const o=new et;for(let s=0;s<this._stack.length;s++){const l=this._stack.getItemAt(s);l&&(l.tag===e?(l.destroy(),s===this._stackPosition&&(this._stackPosition=o.length-1)):o.push(l))}this._stack=o,this._stackPosition>o.length-1&&(this._stackPosition=o.length-1)}async clear(e=!1){if(this.updating&&!e)throw new G;await it(()=>!this.updating),this._drainStack()}};n([r()],w.prototype,"_stack",void 0),n([r()],w.prototype,"_stackPosition",void 0),n([r()],w.prototype,"updating",null),n([r({readOnly:!0})],w.prototype,"canUndo",null),n([r({readOnly:!0})],w.prototype,"hasUndo",null),n([r({readOnly:!0})],w.prototype,"canRedo",null),n([r({readOnly:!0})],w.prototype,"hasRedo",null),w=n([k("esri.UndoRedo")],w);let Ve=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function P(t,e,i){if(t==null)return"noTool";switch(t){case"point":return Te();case"multipoint":return"multipoint";case"polyline":return Ue(e,i);case"polygon":return Me(e,i);case"rectangle":case"circle":return Pe(e,i);default:return}}function Te(t){return"point"}function Ue(t,e){const i=t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0;return e==="freehand"?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}function Me(t,e){const i=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;if(i<3)switch(e){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return e==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function Pe(t,e){if((t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0)<3)switch(e){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(e){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function Ie(t,e){const i=t?.geometry;if(!t||i?.type!=="mesh"||!e)return;const{renderCoordsHelper:o,elevationProvider:s}=e,{camera:l}=e.state,{extent:c}=i,{center:p,spatialReference:a}=c,h=ot(a),y=J(a),g=ot(o.spatialReference),f=c.width*h,d=c.height*y,x=(c.zmax??0)*y,v=x-(c.zmin??0)*y,V=Math.max(f,d,v)/g,{x:T,y:N}=p,K=p.z??0;vt(A,T,N,K),o.toRenderCoords(A,a,A);const tt=V/l.computeScreenPixelSizeAt(A);if(tt>Math.min(l.width,l.height)/l.pixelRatio*Ce)return"meshTooClose";if(tt<Se)return"meshTooFar";const Mt=ce(t),{absoluteZ:Pt}=pe(T,N,x,a,e,Mt);return Pt<(s.getElevation(T,N,K,a,"ground")??0)*y+v*Ge?"meshUnderground":"mesh"}const Se=20,Ce=1,Ge=.1,A=St();let O=class extends b{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=H}get allFields(){return[]}};n([r()],O.prototype,"type",void 0),n([r()],O.prototype,"radius",void 0),n([r()],O.prototype,"xSize",void 0),n([r()],O.prototype,"ySize",void 0),n([r()],O.prototype,"area",void 0),n([r()],O.prototype,"helpMessage",void 0),n([r()],O.prototype,"allFields",null),O=n([k("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],O);let R=class extends F(b){constructor(e){super(e),this.type="draw-mesh",this.orientation=he({lockable:!1}),this.scale=ye({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};n([r()],R.prototype,"helpMessage",void 0),n([r()],R.prototype,"allFields",null),R=n([k("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],R);let E=class extends F(b){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],E.prototype,"helpMessage",void 0),n([r()],E.prototype,"allFields",null),E=n([k("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],E);let z=class extends F(b){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],z.prototype,"helpMessage",void 0),n([r()],z.prototype,"allFields",null),z=n([k("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],z);let U=class extends F(b){constructor(t){super(t),this.type="draw-polygon",this.direction=wt(),this.distance=Ot(),this.area=ge(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};n([r()],U.prototype,"xyMode",void 0),n([r()],U.prototype,"helpMessage",void 0),n([r()],U.prototype,"allFields",null),U=n([k("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],U);let M=class extends F(b){constructor(t){super(t),this.type="draw-polyline",this.direction=wt(),this.distance=Ot(),this.totalLength=me(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};n([r()],M.prototype,"helpMessage",void 0),n([r()],M.prototype,"xyMode",void 0),n([r()],M.prototype,"allFields",null),M=n([k("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],M);let _=class extends b{constructor(t){super(t),this.type="draw-rectangle",this.xSize=$,this.ySize=$,this.area=H}get allFields(){return[]}};n([r()],_.prototype,"type",void 0),n([r()],_.prototype,"xSize",void 0),n([r()],_.prototype,"ySize",void 0),n([r()],_.prototype,"area",void 0),n([r()],_.prototype,"helpMessage",void 0),n([r()],_.prototype,"allFields",null),_=n([k("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],_);function Re(t,e){return{point:new z({sketchOptions:e,viewType:t}),multipoint:new E({sketchOptions:e,viewType:t}),polyline:new M({sketchOptions:e,viewType:t}),polygon:new U({sketchOptions:e,viewType:t}),mesh:new R({sketchOptions:e,viewType:t}),rectangle:new _({sketchOptions:e}),circle:new O({sketchOptions:e})}}function gt(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:s}=t,l=p=>{const a=Z(t).mode,h=s[p].elevation;a==="relative-to-ground"||a==="relative-to-scene"||a==="on-the-ground"?h.lock(X(t)):h.unlock()},c=p=>{if(e){const a=s[p].direction;a.committed=e.angle,a.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":l(i),c(i);break;case"point":case"mesh":l(i)}}function Ee(t,e){const{drawOperation:i,view:o}=e,s=Q(e),l=Z(e);if(o.type==="2d"||!t||l.mode!=="absolute-height"||i?.numCommittedVertices!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[c,p,a]=t,h=qe(c,p,a,l,e);h!=null&&s.elevation.lock(h)}function mt(t){Q(t)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function Q({geometryType:t,graphic:e,tooltipInfos:i}){return e?.geometry?.type!==ze[t]?t==="circle"||t==="rectangle"?i[t]:null:i[t]}const ze={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline",text:"point"};function He(t,e){switch(t?.type){case"draw-point":Fe(t,e);break;case"draw-multipoint":Le(t,e);break;case"draw-polyline":De(t,e);break;case"draw-polygon":Ze(t,e);break;case"draw-rectangle":je(t,e);break;case"draw-circle":Ye(t,e);break;case"draw-mesh":Ae(t,e)}}function Fe(t,e){const i=e.graphic?.geometry;i?.type==="point"&&(W(t,i,e),t.helpMessage=P("point",i,e.drawOperation.drawingMode))}function Le(t,e){const i=e.graphic?.geometry;i?.type==="multipoint"&&(W(t,i,e),t.helpMessage=P("multipoint",i,e.drawOperation.drawingMode))}function Ae(t,e){const{graphic:i,view:o}=e,s=i?.geometry;o.type!=="3d"||s&&s.type!=="mesh"||(W(t,s?.origin,e),s&&Yt(t,s),t.helpMessage=Ie(i,o))}function W(t,e,i){const{drawOperation:o,view:s,sketchOptions:l}=i,{cursorVertex:c}=o;t.sketchOptions=l,t.viewType=s.type;const p=e?.type==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(p,I(i)),xt(t.elevation,i),!c)return void(o.constraints=void 0);const a=c;o.constraints={context:Tt(a,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function De(t,e){const{createOperationGeometry:i,drawOperation:o,automaticLengthMeasurementUtils:s}=e,l=i!=null?i.full:null;l&&l.type!=="polyline"||(kt(t,e),t.totalLength.actual=o.lastVertex?(l?s.autoLength2D(l):null)??$:null,t.helpMessage=P("polyline",l,e.drawOperation.drawingMode))}function Ze(t,e){const{createOperationGeometry:i,drawOperation:o}=e,s=i!=null?i.full:null;s&&s.type!=="polygon"||(kt(t,e),t.area.actual=o.lastVertex?(s?e.automaticAreaMeasurementUtils.autoArea2D(s):null)??H:null,t.helpMessage=P("polygon",s,e.drawOperation.drawingMode))}const ft=Ct(Gt);function kt(t,e){const{drawOperation:i,sketchOptions:o,view:s,automaticLengthMeasurementUtils:l}=e,{cursorVertex:c,lastVertex:p,secondToLastVertex:a}=i,h=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=s.type;const y=p&&c?l.autoDistanceBetweenPoints2D(ft(p),ft(c))??$:null;if(t.distance.actual=y,t.distance.readOnly=p==null,t.direction.actual=null,t.direction.readOnly=!0,p&&c&&(h==="absolute"||a)){const d=fe(a,p,c,h);t.direction.actual=d??le,t.direction.readOnly=!1}t.setLocationFromPoint(c,I(e)),xt(t.elevation,e);const g=Ne(p,e);t.xyMode=g,t.direction.visible=g==="direction-distance",t.distance.visible=g==="direction-distance",t.effectiveX.visible=g==="coordinates",t.effectiveY.visible=g==="coordinates";const f=c??p;i.constraints=f?{context:Tt(f,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Ne(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function je(t,e){t.sketchOptions=e.sketchOptions,t.xSize=bt(e),t.ySize=Vt(e),t.area=$t(e),t.helpMessage=P("rectangle",e.graphic?.geometry,e.drawOperation.drawingMode)}function Ye(t,e){const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Be(e):null,t.xSize=i?null:bt(e),t.ySize=i?null:Vt(e),t.area=$t(e),t.helpMessage=P("circle",e.graphic?.geometry,e.drawOperation.drawingMode)}function xt(t,e){const{drawOperation:i}=e,o=i?.cursorVertex??i?.lastVertex;t.actual=we(o)??X(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function $t(t){const e=t.createOperationGeometry?.full;return e?.type!=="polygon"?H:t.automaticAreaMeasurementUtils.autoArea2D(e)??H}function bt({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){const i=t?.rectangle?.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.left,i.right):null)??$}function Vt({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){const i=t?.rectangle?.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.top,i.bottom):null)??$}function Be({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){return(t?.circle?.center!=null&&t.circle.edge!=null?e.autoDistanceBetweenPoints2D(t.circle.center,t.circle.edge):null)??$}function Je(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?se(o,"meters")/J(I(t)):void 0}default:return}}function qe(t,e,i,o,s){const{view:l,drawOperation:c}=s;if(l.type!=="3d"||!c)return;i??=0;const p=I(s),a=Z(s),h=ue(l,t,e,i,p,a,o);return ve(h,p)??X(s)}function Z(t){return t.drawOperation.elevationInfo??de}function I(t){return t.drawOperation.coordinateHelper.spatialReference}function X(t){const e=J(I(t));return ae(t.defaultZ*e,"meters")}function Tt(t,e){return Xt(t,e.view,I(e),Z(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let u=class extends Kt{constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new _t}initialize(){const{view:t}=this;this.internalGraphicsLayer=new Wt({listMode:"hide",internal:!0,title:"DrawGraphicTool layer"}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Re(t.type,this.sketchOptions);const i=Bt(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,gt(this._tooltipsContext),this._coordinateFormatterLoadTask=jt(()=>Jt()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>qt(o,this.activeTooltipInfo)),Rt(()=>this.cursor,o=>{e.cursor=o},Et),nt(()=>{const{activeTooltipInfo:o,sketchOptions:s}=this;He(o,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?o:null}),nt(()=>{e.constraintZ=Je(this._tooltipsContext)},zt)]),this.finishToolCreation(),e.initializePointer()}destroy(){this.drawOperation=j(this.drawOperation),this.tooltip=j(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=j(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:t,directionOptions:e,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:l,sketchOptions:c,tooltipInfos:p,view:a,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:y}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:t,directionOptions:e,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:l,sketchOptions:c,tooltipInfos:p,view:a,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:y}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof w?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Qt(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&gt(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(m.outline),this.removeHandles(m.regularVertices),this.removeHandles(m.activeVertex),this.removeHandles(m.activeEdge),this.removeHandles(Y)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new Ht({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(L(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),Y),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:s,committedVertices:l,geometryIncludingUncommittedVertices:c,numCommittedVertices:p}=this.drawOperation;if(!(p>0||o!=null))return;const a=t.operationComplete?l:c,h=a.length,y=o!=null?e.pointToArray(o):null,g=this._drawSpatialReference,f=i.type==="3d"&&i.viewingMode==="global",d=new Ve;d.committedVertices=l,d.cursorVertex=y;const{geometryType:x}=this;switch(x){case"point":case"mesh":d.full=e.arrayToPoint(a[0]);break;case"multipoint":d.full=h>0?re(a,g):null;break;case"polyline":case"polygon":h>0&&(d.full=x==="polygon"?ne([a],g,f,!0):dt([a],g,f),d.cursorEdge=y!=null&&s&&!te(o,s)?dt([[y,e.pointToArray(s)]],g,f):null,d.outline=h>1?d.full:null);break;case"circle":case"rectangle":{if(d.committedVertices=d.cursorVertex=null,!h)break;const v=ee(i,a[0]),V=a[0],T=v.makeMapPoint(V[0]+Qe*i.resolution,V[1]);x==="circle"?h===1&&t.operationComplete?d.circle=ct([V,T],v,!0):h===2&&(this.forceUniformSize?d.circle=ct(a,v,this.centered):d.rectangle=ie(a,v,this.centered)):h===1&&t.operationComplete?d.rectangle=pt([V,T],v,!0):h===2&&(d.rectangle=this.forceUniformSize?pt(a,v,this.centered):oe(a,v,this.centered)),d.full=d.circle!=null?d.circle.geometry:d.rectangle?.geometry,d.outline=d.full?.type==="polygon"?d.full:null;break}default:return null}return d}initializeGraphic(t){return L()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return L()}onCursorEdgeChanged(t){return L()}onVertexAdd(t){mt(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Ee(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){mt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),m.activeEdge):this.removeHandles(m.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),m.outline):this.removeHandles(m.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),m.regularVertices):this.removeHandles(m.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),m.activeVertex):this.removeHandles(m.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(Y)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?Q(this._tooltipsContext):null}};n([r()],u.prototype,"_coordinateFormatterLoadTask",void 0),n([r()],u.prototype,"_createOperationGeometry",void 0),n([r()],u.prototype,"_tooltipsContext",null),n([r({value:!0})],u.prototype,"centered",null),n([r()],u.prototype,"cursor",null),n([r({nonNullable:!0})],u.prototype,"defaultZ",void 0),n([r({constructOnly:!0})],u.prototype,"directionOptions",void 0),n([r()],u.prototype,"drawOperation",void 0),n([r()],u.prototype,"elevationLockOnVertexAddDisabled",void 0),n([r({value:!0})],u.prototype,"enabled",null),n([r({value:!0})],u.prototype,"forceUniformSize",null),n([r({constructOnly:!0})],u.prototype,"geometryType",void 0),n([r()],u.prototype,"graphic",null),n([r({constructOnly:!0})],u.prototype,"graphicProperties",void 0),n([r()],u.prototype,"graphicSymbol",null),n([r({constructOnly:!0})],u.prototype,"hasZ",void 0),n([r({constructOnly:!0})],u.prototype,"geometryToPlace",void 0),n([r()],u.prototype,"mode",null),n([r()],u.prototype,"snappingManager",void 0),n([r()],u.prototype,"snapToScene",void 0),n([r()],u.prototype,"tooltip",void 0),n([r()],u.prototype,"tooltipInfos",void 0),n([r({constructOnly:!0,type:_t})],u.prototype,"sketchOptions",void 0),n([r()],u.prototype,"updating",null),n([r({constructOnly:!0,nonNullable:!0})],u.prototype,"view",void 0),n([r({constructOnly:!0})],u.prototype,"automaticAreaMeasurementUtils",void 0),n([r({constructOnly:!0})],u.prototype,"automaticLengthMeasurementUtils",void 0),n([r({constructOnly:!0})],u.prototype,"undoRedo",null),n([r()],u.prototype,"activeTooltipInfo",null),u=n([k("esri.views.draw.DrawGraphicTool")],u);const Y=Symbol("create-operation-graphic"),m={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function _i(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Qe=48;function ki(t,e){return Ut(t,e,!1)}function xi(t,e){return Ut(t,e,!0)}function Ut(t,e,i){if(t instanceof _e){if(t.operation instanceof ke)return We(t.operation,e,i),!0;if(t.operation instanceof xe)return Xe(t.operation,e,i),!0;if(t.operation instanceof $e)return Ke(t.operation,e,i),!0}return!1}function We(t,e,i=!1){const o=i?-1:1,s=Zt(o*t.dx,o*t.dy,o*t.dz);B(e.origin,e.origin,s),D(e)}function Xe(t,e,i=!1){const o=i?-t.angle:t.angle;ut(e.basis1,e.basis1,at,o),ut(e.basis2,e.basis2,at,o),D(e)}function Ke(t,e,i=!1){const o=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;ht(e.basis1,e.basis1,o),ht(e.basis2,e.basis2,s),lt(e.origin,e.origin,t.origin,t.axis1,o),lt(e.origin,e.origin,t.origin,t.axis2,s),D(e)}function $i(t,e,i,o,s=!1){o||(o=Oe());const l=S(C.get(),t[1],-t[0]),c=S(C.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=S(C.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=C.get(),h=e.allVerticesUnordered;h.forEach(({pos:d})=>{S(a,rt(t,d),rt(l,d)),Ft(c,c,a),Lt(p,p,a)});const y=1e-6,g=S(C.get(),p[0]-c[0]<y?i/2:0,p[1]-c[1]<y?i/2:0);At(c,c,g),Dt(p,p,g);const f=s?h.reduce((d,x)=>d+(x.pos[2]??0),0)/h.length:0;return st(o.basis1,t,(p[0]-c[0])/2),st(o.basis2,l,(p[1]-c[1])/2),vt(o.origin,c[0]*t[0]+c[1]*l[0],c[0]*t[1]+c[1]*l[1],f),B(o.origin,o.origin,o.basis1),B(o.origin,o.origin,o.basis2),D(o),o}export{u as A,_i as M,$i as S,xi as T,ki as V};
