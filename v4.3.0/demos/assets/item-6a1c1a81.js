import{c3 as N,c4 as Q,fp as R,fr as oe,c8 as P,c9 as n,ch as a,cg as C,fo as o,ce as t,hI as u,hJ as ne,fn as M,hX as be,hW as m,lk as fe,c5 as se,c7 as ie,cf as Le,cb as ae,ll as r,cc as H,cd as w,gM as q,kI as z,hv as X,hw as Y,hx as ee,ci as K,cj as J,i2 as ke,hH as g,b$ as xe,fl as we,c6 as O,gN as pe,lm as f,ln as Z,ca as G,hV as Ce,lo as _,k7 as Me,lp as Se,lq as de}from"./main-46bfe858.js";import{m as Te}from"./marked.esm-cdc2cd67.js";import"./preload-helper-388ac9d5.js";const ze=["type","aria-label","checked","disabled","content"],W=N({__name:"checkbox",props:{value:{type:Object,required:!0},legendItem:{type:Object,required:!0},checked:{type:Boolean},label:{type:String},isRadio:{type:Boolean},disabled:{type:Boolean}},setup(e){const l=e,{t:d}=Q(),p=R(l.legendItem.visibility);oe(()=>{l.legendItem.checkVisibilityRules(),p.value=l.legendItem.visibility===l.checked});const y=h=>!h.symbologyStack.some(I=>I.visibility),v=()=>{if(l.value instanceof be)l.legendItem.toggleVisibility();else if(l.legendItem instanceof m){if(y(l.legendItem)?(l.legendItem.setSymbologyVisibility(void 0,!1),l.legendItem.setSymbologyVisibility(l.value.uid,!0),l.legendItem.toggleVisibility(!0)):l.legendItem.setSymbologyVisibility(l.value.uid,!l.value.lastVisbility),y(l.legendItem)&&l.legendItem.toggleVisibility(!1),l.legendItem.layer?.supportsFeatures){const h=l.legendItem.symbologyStack.filter(S=>S.lastVisbility===!0).map(S=>S.definitionClause||"");let I="";h.length===0?I="1=2":h.length<l.legendItem.symbologyStack.length&&(I=h.join(" OR ")),l.legendItem.layer?.setSqlFilter(fe.SYMBOL,I)}p.value=!0}};return(h,I)=>{const S=P("tippy");return n(),a("div",{class:"relative",onMouseover:I[3]||(I[3]=u(()=>{},["stop"]))},[C(o("input",{type:e.isRadio?"radio":"checkbox","aria-label":t(d)(e.checked?`legend.visibility.hide${e.label}`:`legend.visibility.show${e.label}`),onClick:I[0]||(I[0]=u(T=>v(),["stop"])),checked:e.checked&&p.value,onKeypress:I[1]||(I[1]=ne(u(()=>{},["prevent"]),["enter"])),onKeyup:I[2]||(I[2]=ne(u(T=>v(),["stop"]),["enter"])),class:M([[e.disabled?"text-gray-400 border-gray-300":"text-black cursor-pointer border-gray-500 hover:border-black"],"mx-5 h-15 w-15"]),tabindex:"-1",disabled:e.disabled,content:t(d)(e.checked?`legend.visibility.hide${e.label}`:`legend.visibility.show${e.label}`)},null,42,ze),[[S,{placement:"top-end",hideOnClick:!1}]])],32)}}}),$=e=>(X("data-v-6c6e4829"),e=e(),Y(),e),Ve=$(()=>o("div",{class:"flex p-4"},[o("svg",{class:"inline-block fill-current w-18 h-18 mx-4",viewBox:"0 0 23 21"},[o("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})])],-1)),Ee=$(()=>o("svg",{class:"inline-block fill-current w-18 h-18 mr-10",viewBox:"0 0 23 21"},[o("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})],-1)),He=$(()=>o("svg",{class:"inline-block fill-current w-18 h-18 mr-10",viewBox:"0 0 23 21"},[o("g",null,[o("path",{d:"M 3,17L 3,19L 9,19L 9,17L 3,17 Z M 3,5L 3,7L 13,7L 13,5L 3,5 Z M 13,21L 13,19L 21,19L 21,17L 13,17L 13,15L 11,15L 11,21L 13,21 Z M 7,9L 7,11L 3,11L 3,13L 7,13L 7,15L 9,15L 9,9L 7,9 Z M 21,13L 21,11L 11,11L 11,13L 21,13 Z M 15,9L 17,9L 17,7L 21,7L 21,5L 17,5L 17,3L 15,3L 15,9 Z "})])],-1)),$e=$(()=>o("svg",{class:"inline-block fill-current w-18 h-18 mr-10",viewBox:"0 0 23 21"},[o("path",{d:"M 4.00002,3L 20,3C 21.1046,3 22,3.89543 22,5L 22,20C 22,21.1046 21.1046,22 20,22L 4.00001,22C 2.89544,22 2.00001,21.1046 2.00001,20L 2.00002,5C 2.00002,3.89543 2.89545,3 4.00002,3 Z M 4.00002,7L 4.00001,10L 8,10L 8,7.00001L 4.00002,7 Z M 10,7.00001L 9.99999,10L 14,10L 14,7.00001L 10,7.00001 Z M 20,10L 20,7L 16,7.00001L 16,10L 20,10 Z M 4.00002,12L 4.00002,15L 8,15L 8,12L 4.00002,12 Z M 4.00001,20L 8,20L 8,17L 4.00002,17L 4.00001,20 Z M 9.99999,12L 9.99999,15L 14,15L 14,12L 9.99999,12 Z M 9.99999,20L 14,20L 14,17L 9.99999,17L 9.99999,20 Z M 20,20L 20,17L 16,17L 16,20L 20,20 Z M 20,12L 16,12L 16,15L 20,15L 20,12 Z "})],-1)),Ae=$(()=>o("svg",{class:"inline-block fill-current w-18 h-18 mr-10",viewBox:"0 0 23 21"},[o("path",{d:"M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"})],-1)),Be=$(()=>o("svg",{class:"inline-block fill-current w-18 h-18 mr-10",viewBox:"0 0 24 24"},[o("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),o("path",{d:"M0 0h24v24H0V0z",fill:"none"}),o("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"})],-1)),Ze=$(()=>o("svg",{class:"inline-block fill-current w-18 h-18 mr-10",viewBox:"0 0 23 21"},[o("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)),Ge=$(()=>o("svg",{class:"inline-block fill-current w-18 h-18 mr-10",viewBox:"0 0 24 24"},[o("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})],-1)),Re=N({__name:"legend-options",props:{legendItem:m},setup(e){const l=e,{t:d}=Q(),p=se("iApi"),y=R(),v=()=>{l.legendItem.layerControlAvailable(r.Symbology)&&l.legendItem.toggleSymbology()},h=()=>{l.legendItem.layerControlAvailable(r.Datatable)&&V("grid")&&p.event.emit(q.GRID_TOGGLE,l.legendItem.layer)},I=()=>{l.legendItem.layerControlAvailable(r.Settings)&&V("settings")&&p.event.emit(q.SETTINGS_TOGGLE,l.legendItem.layer)},S=()=>{if(l.legendItem.layerControlAvailable(r.Metadata)&&V("metadata")){const E=l.legendItem?.layer?.config.metadata||l.legendItem?.layer?.parentLayer?.config?.metadata||{},k=E?.name||l.legendItem?.layer?.name||"";E.url?p.event.emit(q.METADATA_TOGGLE,{type:"html",layerName:k,url:E.url,layer:l.legendItem.layer}):console.warn("Layer does not have a metadata url defined")}},T=()=>{l.legendItem.layerControlAvailable(r.BoundaryZoom)&&l.legendItem?.layer?.zoomToLayerBoundary()},j=()=>{l.legendItem.layerControlAvailable(r.Remove)&&p.geo.map.removeLayer(l.legendItem.layerUid)},F=()=>{l.legendItem.layerControlAvailable(r.Reload)&&(z(l.legendItem.layer).reload(),y.value.open=!1)},V=E=>{try{return!!p.fixture.get(E)}catch{return!1}};return(E,k)=>{const L=ie("dropdown-menu");return n(),a("div",{onClick:k[0]||(k[0]=u(()=>{},["stop"])),onMouseover:k[1]||(k[1]=u(()=>{},["stop"])),class:"options display-block cursor-auto"},[Le(L,{class:"flex-shrink-0",position:"bottom-end",tooltip:t(d)("legend.layer.options"),"tooltip-placement":"left",ref_key:"dropdown",ref:y},{header:ae(()=>[Ve]),default:ae(()=>[o("a",{href:"javascript:;",class:M(["flex leading-snug items-center text-left w-auto",{disabled:!e.legendItem.layerControlAvailable(t(r).Metadata)||!V("metadata")}]),onClick:S},[Ee,H(" "+w(t(d)("legend.layer.controls.metadata")),1)],2),o("a",{href:"javascript:;",class:M(["flex leading-snug items-center text-left w-auto",{disabled:!e.legendItem.layerControlAvailable(t(r).Settings)||!V("settings")}]),onClick:I},[He,H(" "+w(t(d)("legend.layer.controls.settings")),1)],2),o("a",{href:"javascript:;",class:M(["flex leading-snug items-center text-left w-auto",{disabled:!e.legendItem.layerControlAvailable(t(r).Datatable)||!V("grid")}]),onClick:h},[$e,H(" "+w(t(d)("legend.layer.controls.datatable")),1)],2),o("a",{href:"javascript:;",class:M(["flex leading-snug items-center text-left w-auto",{disabled:!e.legendItem.layerControlAvailable(t(r).Symbology)}]),onClick:v},[Ae,H(" "+w(t(d)("legend.layer.controls.symbology")),1)],2),o("a",{href:"javascript:;",class:M(["flex leading-snug items-center text-left w-auto",{disabled:!e.legendItem.layerControlAvailable(t(r).BoundaryZoom)}]),onClick:T},[Be,H(" "+w(t(d)("legend.layer.controls.boundaryzoom")),1)],2),o("a",{href:"javascript:;",class:M(["flex leading-snug items-center text-left w-auto",{disabled:!e.legendItem.layerControlAvailable(t(r).Remove)}]),onClick:j},[Ze,H(" "+w(t(d)("legend.layer.controls.remove")),1)],2),o("a",{href:"javascript:;",class:M(["flex leading-snug items-center text-left w-auto",{disabled:!e.legendItem.layerControlAvailable(t(r).Reload)}]),onClick:F},[Ge,H(" "+w(t(d)("legend.layer.controls.reload")),1)],2)]),_:1},8,["tooltip"])],32)}}});const Ue=ee(Re,[["__scopeId","data-v-6c6e4829"]]),je=e=>(X("data-v-7bc13719"),e=e(),Y(),e),Oe={key:0},_e={key:0,class:"relative left-3"},De=["innerHTML"],Pe=["src"],qe={key:1,class:"symbologyIcon w-32 h-32"},Ne=["innerHTML"],Fe=["src"],We={key:1,class:"h-32 w-32 inline-flex justify-center items-center"},Ke=je(()=>o("svg",{class:"fill-current w-16 h-16",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512"},[o("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})],-1)),Je=[Ke],Qe=N({__name:"symbology-stack",props:{visible:{type:Boolean,required:!0},legendItem:{type:Object,required:!0}},setup(e){const l=e,d=R([]);return oe(()=>{l.legendItem.loadPromise.then(()=>{l.legendItem.layerUid!==void 0&&Promise.all(z(l.legendItem.symbologyStack).map(p=>p.drawPromise)).then(()=>{d.value=z(l.legendItem).symbologyStack})})}),(p,y)=>e.visible?(n(),a("div",We,Je)):(n(),a("div",Oe,[d.value.length>1?(n(),a("div",_e,[(n(!0),a(K,null,J(d.value.slice(0,3).reverse(),(v,h)=>(n(),a("div",{class:M(["absolute",[h==0?"symbol-0":h==1?"left-3 symbol-1":"left-6 symbol-2"]]),style:ke({"z-index":3-h}),key:h},[d.value[h].svgcode?(n(),a("span",{key:0,class:"symbologyIcon w-28 h-28",innerHTML:d.value[h].svgcode},null,8,De)):d.value[h].imgUrl?(n(),a("img",{key:1,class:"symbologyIcon w-28 h-28",src:d.value[h].imgUrl},null,8,Pe)):g("",!0)],6))),128))])):d.value.length>0?(n(),a("div",qe,[d.value[0].svgcode?(n(),a("span",{key:0,innerHTML:d.value[0].svgcode},null,8,Ne)):d.value[0].imgUrl?(n(),a("img",{key:1,class:"symbologyIcon w-full h-full",src:d.value[0].imgUrl},null,8,Fe)):g("",!0)])):g("",!0)]))}});const Xe=ee(Qe,[["__scopeId","data-v-7bc13719"]]),A=e=>(X("data-v-ea26b667"),e=e(),Y(),e),Ye={class:"relative"},et=["content"],tt={key:0,class:"flex p-5"},lt={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"black",width:"24px",height:"24px"},nt=de('<path d="M0 0h24v24H0V0z" fill="none" data-v-ea26b667></path><path d="M0 0h24v24H0V0z" fill="none" data-v-ea26b667></path><circle cx="15.5" cy="9.5" r="1.5" data-v-ea26b667></circle><circle cx="8.5" cy="9.5" r="1.5" data-v-ea26b667></circle><circle cx="15.5" cy="9.5" r="1.5" data-v-ea26b667></circle><circle cx="8.5" cy="9.5" r="1.5" data-v-ea26b667></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-2.5c2.33 0 4.32-1.45 5.12-3.5h-1.67c-.69 1.19-1.97 2-3.45 2s-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5z" data-v-ea26b667></path>',7),at=[nt],ot={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"black",width:"24px",height:"24px"},st=de('<path d="M0 0h24v24H0V0z" fill="none" data-v-ea26b667></path><path d="M0 0h24v24H0V0z" fill="none" data-v-ea26b667></path><circle cx="15.5" cy="9.5" r="1.5" data-v-ea26b667></circle><circle cx="8.5" cy="9.5" r="1.5" data-v-ea26b667></circle><circle cx="15.5" cy="9.5" r="1.5" data-v-ea26b667></circle><circle cx="8.5" cy="9.5" r="1.5" data-v-ea26b667></circle><path d="M 20,12C 20,7.6 16.4,4 12,4C 7.6,4 4,7.6 4,12C 4,16.4 7.6,20 12,20C 16.4,20 20,16.4 20,12 Z M 22,12C 22,17.5 17.5,22 12,22C 6.5,22 2,17.5 2,12C 2,6.5 6.5,2.00001 12,2.00001C 17.5,2.00001 22,6.5 22,12 Z M 15.5,8C 16.3,8 17,8.7 17,9.5C 17,10.3 16.3,11 15.5,11C 14.7,11 14,10.3 14,9.5C 14,8.7 14.7,8 15.5,8 Z M 10,9.5C 10,10.3 9.3,11 8.5,11C 7.7,11 7,10.3 7,9.5C 7,8.7 7.7,8 8.5,8C 9.3,8 10,8.7 10,9.5 Z M 12,14C 13.7524,14 15.2943,14.7212 16.1871,15.8129L 14.7697,17.2302C 14.3175,16.5078 13.2477,16 12,16C 10.7523,16 9.68254,16.5078 9.23024,17.2302L 7.81291,15.8129C 8.7057,14.7212 10.2476,14 12,14 Z" data-v-ea26b667></path>',7),it=[st],dt=["onClick","disabled","content","aria-label"],ct=["src"],rt=A(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",height:"18",viewBox:"0 0 24 24",width:"18"},[o("path",{d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"})],-1)),gt=[rt],mt={key:3,class:"flex-1 pointer-events-none p-5"},yt={key:4,class:"flex-1"},vt={key:0,class:"text-lg font-bold"},ut={key:1},ht={key:2},It=["src"],bt=["innerHTML"],ft={key:5,class:"relative"},Lt=["content","onClick"],kt=A(()=>o("div",{class:"flex p-8"},[o("svg",{class:"inline-block fill-current w-18 h-18",viewBox:"0 0 24 24"},[o("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})])],-1)),xt=[kt],wt={key:6,class:"relative"},pt=["content","onClick"],Ct={class:"flex p-8"},Mt={key:0,class:"fill-current w-18 h-18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512"},St=A(()=>o("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},null,-1)),Tt=[St],zt={key:1,class:"inline-block fill-current w-18 h-18 mr-1",viewBox:"0 1 23 22"},Vt=A(()=>o("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},null,-1)),Et=[Vt],Ht=["content"],$t=A(()=>o("svg",{class:"inline-block fill-gray-400 w-18 h-18",viewBox:"0 0 24 24"},[o("path",{d:"M19.81 14.99l1.19-.92-1.43-1.43-1.19.92 1.43 1.43zm-.45-4.72L21 9l-9-7-2.91 2.27 7.87 7.88 2.4-1.88zM3.27 1L2 2.27l4.22 4.22L3 9l1.63 1.27L12 16l2.1-1.63 1.43 1.43L12 18.54l-7.37-5.73L3 14.07l9 7 4.95-3.85L20.73 21 22 19.73 3.27 1z"})],-1)),At=[$t],Bt=["content"],Zt=A(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",height:"18",viewBox:"0 -960 960 960",width:"18",class:"inline-block fill-gray-400"},[o("path",{d:"m776.109-63.565-73.435-69.196q-51.302 32.573-106.091 59.145-54.788 26.572-116.255 26.572-88.94 0-167.803-33.893-78.862-33.894-138.052-93.239-59.19-59.346-93.19-138.205-34-78.86-34-167.619 0-64.607 19.12-125.521Q85.521-666.435 120-719.674l-50.848-50.848 68.761-68.761L844.87-132.326l-68.761 68.76Zm-345.392-92.653v-72.5l-52.25-52.086v-50.009l-219.01-218.752q-3 17.015-5 34.031-2 17.015-2 35.136 0 124.449 78.826 214.674 78.826 90.224 199.434 109.506Zm410.392-85.412-76.739-77.74q21.288-37.275 32.35-77.847 11.062-40.572 11.062-84.059 0-95.003-56.304-169.853-56.304-74.849-145.391-108.893v.522l-174.413 76.087v31.348L241.87-842.109q52.483-34.989 113.387-52.918 60.903-17.93 125.159-17.93 89.709 0 168.127 33.869 78.418 33.868 137.435 93.28 59.016 59.413 92.997 137.683 33.982 78.269 33.982 167.993 0 64.203-18.43 125.111-18.429 60.907-53.418 113.391Z"})],-1)),Gt=[Zt],Rt={key:10,class:"relative top-1"},Ut=["content"],jt=A(()=>o("svg",{class:"m-auto",xmlns:"http://www.w3.org/2000/svg",height:"18",viewBox:"0 0 24 24",width:"18"},[o("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),o("path",{d:"M0 0h24v24H0V0z",fill:"none"}),o("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"})],-1)),Ot=[jt],_t={key:0,class:"flex-1 h-3"},Dt=A(()=>o("div",{class:"progress-line"},null,-1)),Pt=[Dt],qt={key:0,class:"symbology-stack default-focus-style"},Nt={key:0},Ft={key:0,class:"m-5"},Wt={key:0,class:"items-center grid-cols-1"},Kt={key:0,class:"symbologyIcon w-full p-5"},Jt=["src"],Qt=["innerHTML"],Xt={key:2,class:"flex-1 p-5 bg-black-75 text-white"},Yt={key:1,class:"flex items-center"},el={key:0,class:"symbologyIcon"},tl=["src"],ll={key:1,class:"symbologyIcon"},nl=["innerHTML"],al={class:"flex-1 ml-15"},ol={key:1},sl={class:"flex p-5 ml-48"},il={key:0,class:"relative animate-spin spinner h-20 w-20 mr-10 pt-2"},dl={class:"flex-1 text-gray-500"},cl={key:1,class:"legend-group border-l-2 ml-4 pl-4"},rl=N({__name:"item",props:{legendItem:{type:Object,required:!0}},setup(e){const l=e,d=xe(),p=we(),{t:y}=Q(),v=se("iApi"),h=R(),I=R(p.mobileView),S=O(()=>d.layerConfigs),T=R([]),j=R(!1),F=O(()=>l.legendItem instanceof m?z(l.legendItem.layer)?.layerType:""),V=O(()=>l.legendItem instanceof m&&z(l.legendItem.layer)?.canModifyLayer),E=O(()=>v.animate),k=O(()=>l.legendItem.children.length>0||l.legendItem instanceof m&&z(l.legendItem.layer)?.sublayers.length>0),L=i=>i===Z.Expand||i===Z.Visibility?l.legendItem.controlAvailable(i):l.legendItem.layerControlAvailable(i),ce=i=>Te(i),re=()=>{l.legendItem.children.length===0||!L(Z.Expand)||(l.legendItem.toggleExpanded(),v.updateAlert(y(`legend.alert.group${l.legendItem.expanded?"Expanded":"Collapsed"}`)))},ge=()=>{if(L(r.Symbology)){const i=l.legendItem.toggleSymbology();v.updateAlert(y(`legend.alert.symbology${i?"Expanded":"Collapsed"}`))}},me=()=>{L(r.Datatable)&&D()&&v.event.emit(q.GRID_TOGGLE,l.legendItem.layer)},ye=i=>{const s=document.createElement("span");s.innerHTML=i.svgcode;const x=s.firstElementChild;return x?.classList.add("max-w-full"),x?.classList.add("h-full"),x?.setAttribute("height",i.imgHeight),x?.setAttribute("width",i.imgWidth),s.outerHTML},D=()=>{try{return!!v.fixture.get("grid")}catch{return!1}},ve=()=>{if(l.legendItem.reload(),l.legendItem._loadCancelled){const i=setInterval(()=>{l.legendItem.layer&&Promise.allSettled([l.legendItem.layer.loadPromise]).then(()=>{clearInterval(i),te()})},250)}else te()},te=()=>{setTimeout(()=>{if(l.legendItem._loadCancelled=!1,l.legendItem.layer!==void 0)z(l.legendItem.layer).reload().then(()=>d.removeErrorLayer(l.legendItem.layer)).catch(()=>d.addErrorLayer(l.legendItem.layer));else{const i=l.legendItem.layerIdx===void 0||l.legendItem.layerIdx===-1?S.value.find(s=>s.id===l.legendItem.layerId):S.value.find(s=>s.id===l.legendItem.parentLayerId);i!==void 0&&ue(i)}l.legendItem.loadPromise.catch(()=>{console.error("Failed to reload layer -",l.legendItem.name)})},500)},ue=async i=>{try{const s=v.geo.layer.createLayer(i);d.removeErrorLayer(s);const x=v.geo.layer.getLayer(s.id);if(x){const[b]=await Se(z(x).reload());if(b)throw d.addErrorLayer(s),new Error}else v.geo.map.addLayer(s).catch(()=>{throw new Error});return s}catch{return}},he=()=>{const i=z(l.legendItem);if(i.type===f.Error){l.legendItem.toggleHidden(!0);let s=!1;const x=setInterval(()=>{s?clearInterval(x):i.layer&&i.layer.layerExists&&(v.geo.map.removeLayer(i.layer),d.removeErrorLayer(i.layerId),d.removeLayerConfig(i.layerId),v.fixture.get("legend")?.removeLayerItem(i.layerId),s=!0)},250)}else{l.legendItem.error(),l.legendItem._loadCancelled=!0;const s=setInterval(()=>{const x=v.geo.layer.allLayers().find(b=>b.id===i.parentLayerId||b.id===i.layerId)??v.geo.layer.allErrorLayers().find(b=>b.id===i.parentLayerId||b.id===i.layerId);if(x){clearInterval(s);const b=v.fixture.get("legend")?.getLayerItem(x);b&&(b.error(),b._loadCancelled=!0),x.sublayers?.forEach(B=>{const U=v.fixture.get("legend")?.getLayerItem(B);U&&(U.error(),U._loadCancelled=!0)})}},250)}},le=()=>{l.legendItem.loadPromise.then(()=>{if(T.value=[],!l.legendItem.layer){console.warn("Attempted to mount legend item component with undefined layer");return}Promise.all(z(l.legendItem.symbologyStack.map(i=>i.drawPromise))).then(()=>{T.value=l.legendItem.symbologyStack})}).catch(()=>{})},Ie=i=>{j.value=!0,setTimeout(()=>{j.value&&(I.value||i._tippy?.show())},300)};return l.legendItem instanceof m&&(le(),pe(()=>l.legendItem.symbologyStack,()=>{le()})),(i,s)=>{const x=ie("item",!0),b=P("tippy"),B=P("truncate"),U=P("focus-item");return e.legendItem.hidden?g("",!0):(n(),a("div",{key:`${e.legendItem.uid}-${e.legendItem.visibility}`,ref_key:"el",ref:h},[o("div",Ye,[C((n(),a("div",{class:M(["flex items-center hover:bg-gray-200 default-focus-style !p-5",[e.legendItem.type===t(f).Item?"loaded-item":e.legendItem.type===t(f).Error?"non-loaded-item bg-red-200":"non-loaded-item",k.value&&L(t(Z).Expand)||!k.value&&e.legendItem instanceof t(m)&&L(t(r).Datatable)&&D()&&e.legendItem.type===t(f).Item?"cursor-pointer":"cursor-default"]]),onMouseover:s[9]||(s[9]=u(c=>Ie(c.currentTarget),["stop"])),onMouseout:s[10]||(s[10]=u(c=>(I.value||c.currentTarget?._tippy?.hide(),j.value=!1),["self"])),onClick:s[11]||(s[11]=()=>{!k.value&&e.legendItem instanceof t(m)&&L(t(r).Datatable)&&D()&&e.legendItem.type===t(f).Item?me():k.value&&re()}),content:k.value&&L(t(Z).Expand)?t(y)(e.legendItem.expanded?"legend.group.collapse":"legend.group.expand"):e.legendItem instanceof t(m)&&e.legendItem.type===t(f).Item&&L(t(r).Datatable)&&D()?t(y)("legend.layer.data"):"","truncate-trigger":""},[e.legendItem.type!==t(f).Item?(n(),a("div",tt,[e.legendItem.type===t(f).Placeholder?(n(),a("svg",lt,at)):(n(),a("svg",ot,it))])):g("",!0),e.legendItem.type===t(f).Item&&e.legendItem instanceof t(m)&&e.legendItem.layer.legend.length>0?(n(),a("div",{key:1,class:"relative w-32 h-32 mr-15",onMouseover:s[0]||(s[0]=u(()=>{},["stop"]))},[C((n(),a("button",{type:"button",onClick:u(ge,["stop"]),class:M([L(t(r).Symbology)?"cursor-pointer":"cursor-default"]),disabled:!L(t(r).Symbology),content:e.legendItem instanceof t(m)&&e.legendItem.symbologyExpanded?t(y)("legend.symbology.hide"):t(y)("legend.symbology.expand"),"aria-label":e.legendItem instanceof t(m)&&e.legendItem.symbologyExpanded?t(y)("legend.symbology.hide"):t(y)("legend.symbology.expand")},[e.legendItem.coverIcon?(n(),a("img",{key:1,class:M([{"pointer-events-none":!L(t(r).Symbology)},"w-32 h-32 hover:scale-105"]),src:e.legendItem.coverIcon,alt:"Cover icon not found :("},null,10,ct)):(n(),G(Xe,{key:0,class:M([{"pointer-events-none":!L(t(r).Symbology)},"w-32 h-32"]),visible:e.legendItem instanceof t(m)&&e.legendItem.symbologyExpanded,legendItem:e.legendItem},null,8,["class","visible","legendItem"]))],10,dt)),[[b,{placement:"top-start"}]])],32)):g("",!0),k.value&&L(t(Z).Expand)?(n(),a("div",{key:2,class:M(["expand-toggle p-8 pointer-events-none",{"rotate-180":e.legendItem.expanded}])},gt,2)):g("",!0),e.legendItem instanceof t(m)?C((n(),a("div",mt,[o("span",null,w(e.legendItem.name??(!e.legendItem.layer||e.legendItem?.layer?.name===""?e.legendItem.layerId:e.legendItem.layer?.name)),1)])),[[B,{externalTrigger:!0}]]):e.legendItem instanceof t(Ce)?(n(),a("div",yt,[e.legendItem.infoType===t(_).Title&&e.legendItem.content?(n(),a("h3",vt,w(e.legendItem.content),1)):e.legendItem.infoType===t(_).Title?(n(),a("h3",ut,w(e.legendItem.name),1)):e.legendItem.infoType===t(_).Text?(n(),a("p",ht,w(e.legendItem.content),1)):e.legendItem.infoType===t(_).Image?(n(),a("img",{key:3,src:e.legendItem.content,alt:"InfoType image not found :("},null,8,It)):e.legendItem.infoType===t(_).Markdown?(n(),a("div",{key:4,class:"ramp-markdown",innerHTML:ce(e.legendItem.content)},null,8,bt)):(n(),G(Me(`${e.legendItem.uid}-info-section`),{key:5}))])):g("",!0),e.legendItem.type===t(f).Error?(n(),a("div",ft,[C((n(),a("button",{type:"button",class:"text-gray-500 hover:text-black",content:t(y)("legend.layer.controls.reload"),onMouseover:s[1]||(s[1]=u(()=>{},["stop"])),onClick:u(ve,["stop"])},xt,40,Lt)),[[b,{placement:"top-start"}]])])):g("",!0),e.legendItem.type!==t(f).Item&&e.legendItem instanceof t(m)?(n(),a("div",wt,[C((n(),a("button",{type:"button",class:"text-gray-500 hover:text-black",content:e.legendItem.type===t(f).Error?t(y)("legend.layer.controls.remove"):t(y)("legend.layer.controls.cancel"),onMouseover:s[2]||(s[2]=u(()=>{},["stop"])),onClick:u(he,["stop"])},[o("div",Ct,[e.legendItem.type===t(f).Placeholder?(n(),a("svg",Mt,Tt)):(n(),a("svg",zt,Et))])],40,pt)),[[b,{placement:"top-start"}]])])):g("",!0),e.legendItem.type===t(f).Item&&e.legendItem instanceof t(m)?(n(),G(Ue,{key:7,legendItem:e.legendItem},null,8,["legendItem"])):g("",!0),e.legendItem.type===t(f).Item&&e.legendItem instanceof t(m)&&e.legendItem.layerOffscale?C((n(),a("div",{key:8,class:"relative mx-5 cursor-default",content:t(y)("legend.layer.offscale"),onMouseover:s[3]||(s[3]=u(()=>{},["stop"])),onClick:s[4]||(s[4]=u(()=>{},["stop"])),"focus-icon":""},At,40,Ht)),[[b,{placement:"top-start"}]]):g("",!0),e.legendItem.type===t(f).Item&&e.legendItem instanceof t(m)&&!e.legendItem.layer?.mapLayer?C((n(),a("div",{key:9,class:"relative mx-5 cursor-default",content:t(y)("legend.layer.data.only"),onMouseover:s[5]||(s[5]=u(()=>{},["stop"])),onClick:s[6]||(s[6]=u(()=>{},["stop"])),"focus-icon":""},Gt,40,Bt)),[[b,{placement:"top-end"}]]):g("",!0),e.legendItem.type===t(f).Item&&e.legendItem instanceof t(m)&&e.legendItem.layerOffscale?(n(),a("div",Rt,[C((n(),a("button",{type:"button",class:"p-4",content:t(y)("legend.layer.zoomToVisible"),onMouseover:s[7]||(s[7]=u(()=>{},["stop"])),onClick:s[8]||(s[8]=u(c=>e.legendItem.layer.zoomToVisibleScale(),["stop"]))},Ot,40,Ut)),[[b,{placement:"top-start"}]])])):e.legendItem.type===t(f).Item&&L(t(Z).Visibility)?(n(),G(W,{key:11,checked:e.legendItem.visibility,value:e.legendItem,isRadio:e.legendItem.parent&&e.legendItem.parent.exclusive,legendItem:e.legendItem,disabled:e.legendItem instanceof t(m)&&!e.legendItem.layerControlAvailable(t(r).Visibility),label:k.value?"Group":"Layer"},null,8,["checked","value","isRadio","legendItem","disabled","label"])):g("",!0)],42,et)),[[U,"show-truncate"],[b,{placement:"top-start",trigger:"manual focus",aria:"describedby"}]]),e.legendItem.type===t(f).Placeholder||e.legendItem instanceof t(m)&&e.legendItem.layerRedrawing&&e.legendItem.visibility?(n(),a("div",_t,Pt)):g("",!0)]),e.legendItem instanceof t(m)&&e.legendItem.symbologyExpanded?C((n(),a("div",qt,[T.value.length>0?(n(),a("div",Nt,[e.legendItem instanceof t(m)&&e.legendItem.description?(n(),a("p",Ft,w(e.legendItem.description),1)):g("",!0),(n(!0),a(K,null,J(T.value,c=>(n(),a("div",{class:"m-5",key:c.uid},[c.imgUrl&&e.legendItem.symbologyRenderStyle==="images"||!c.imgUrl&&F.value==="ogc-wms"?(n(),a("div",Wt,[c.imgUrl?(n(),a("div",Kt,[o("img",{class:"max-w-full",src:c.imgUrl},null,8,Jt)])):c.imgHeight?(n(),a("div",{key:1,class:"symbologyIcon w-full p-5",innerHTML:ye(c)},null,8,Qt)):g("",!0),c.label?C((n(),a("div",Xt,[o("span",null,w(c.label),1),!c.imgUrl&&T.value.length>1||c.imgUrl&&c.definitionClause?(n(),G(W,{key:0,class:"float-right",value:c,legendItem:e.legendItem,checked:c.visibility,disabled:!L(t(r).Visibility),label:"Symbol"},null,8,["value","legendItem","checked","disabled"])):g("",!0)])),[[B]]):g("",!0)])):(n(),a("div",Yt,[c.imgUrl?(n(),a("div",el,[o("img",{class:"w-32 h-32",src:c.imgUrl},null,8,tl)])):c.svgcode?(n(),a("div",ll,[o("span",{innerHTML:c.svgcode},null,8,nl)])):g("",!0),C((n(),a("div",al,[H(w(c.label),1)])),[[B]]),V.value&&(!c.imgUrl&&T.value.length>1||c.imgUrl&&c.definitionClause)?(n(),G(W,{key:2,value:c,legendItem:e.legendItem,checked:c.visibility,disabled:!L(t(r).Visibility),label:"Symbol"},null,8,["value","legendItem","checked","disabled"])):g("",!0)]))]))),128))])):(n(),a("div",ol,[C((n(),a("div",sl,[E.value?(n(),a("div",il)):g("",!0),C((n(),a("div",dl,[o("span",null,w(t(y)("legend.symbology.loading")),1)])),[[B]])])),[[B]])]))])),[[U]]):g("",!0),e.legendItem.expanded?(n(),a("div",cl,[(n(!0),a(K,null,J(e.legendItem.children,c=>(n(),G(x,{legendItem:c,key:c.uid},null,8,["legendItem"]))),128))])):g("",!0)]))}}});const vl=ee(rl,[["__scopeId","data-v-ea26b667"]]);export{vl as default};
