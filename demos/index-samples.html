<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0" />
        <title>ramp-core</title>
    </head>
    <body style="margin: 0">
        <section id="header" style="width: 100%">
            <div class="row">
                <select id="selectConfig" class="tool">
                    <option value="main">01. Default</option>
                    <option value="panel-party">02. Lots of panels</option>
                    <option value="basemap-only">03. Basemap only</option>
                    <option value="lambert">04. Lambert projection</option>
                    <option value="map-image-layer">05. Map Image Layer</option>
                    <option value="wms-layer">06. WMS Layer</option>
                    <option value="custom-renderer">07. Custom renderer</option>
                    <option value="custom-overviewmap">
                        08. Custom Overview Map
                    </option>
                    <option value="custom-arrow">09. Custom North Arrow</option>
                    <option value="grid">10. Grid</option>
                    <option value="geosearch">11. Geosearch</option>
                    <option value="help">12. Help</option>
                    <option value="mapnav">13. Mapnav</option>
                </select>
            </div>
        </section>

        <noscript>
            <strong
                >We're sorry but ramp-core doesn't work properly without
                JavaScript enabled. Please enable it to continue.</strong
            >
        </noscript>

        <div id="IE"></div>
        <div id="app"></div>

        <style>
            #instance-language {
                margin-left: 20px;
            }
            #container {
                display: flex;
                flex-direction: column;
                height: 100vh;
                max-height: 100vh;
                overflow: hidden;
            }
            #header {
                width: 100%;
                background-color: grey;
                display: flex;
                justify-content: center;
                height: 4vh;
            }
            .row {
                margin: 10px;
                flex-grow: 1;
            }
            #selectConfig {
                width: 100%;
            }
            #app {
                height: 96vh;
            }
        </style>

        <script>
            var SAMPLE_KEY = 'sample';
            var currentUrl = new URL(window.location.href);

            document
                .getElementById('selectConfig')
                .addEventListener('change', onConfigSelect);
            initialLoad();

            function appendScript(scriptName) {
                // replace app div
                document.getElementById('app').remove();
                var newDiv = document.createElement('div');
                newDiv.id = 'app';
                document.body.append(newDiv);

                //append script with time string to defeat caching
                let script = document.createElement('script');
                script.src =
                    './starter-scripts/' +
                    scriptName +
                    '.js?nocache=' +
                    new Date().getTime();
                script.type = 'module';
                document.head.appendChild(script);

                // update url
                currentUrl.searchParams.set(
                    SAMPLE_KEY,
                    document.getElementById('selectConfig').selectedIndex + 1
                );
                history.pushState({}, '', currentUrl);
            }

            function onConfigSelect(event) {
                let scriptName = event.target.value;
                appendScript(scriptName);
            }

            function initialLoad() {
                var params = new URLSearchParams(currentUrl.search);
                var sampleIndex = params.get(SAMPLE_KEY) - 1;
                var selectElem = document.getElementById('selectConfig');
                if (
                    params.has(SAMPLE_KEY) &&
                    sampleIndex >= 1 &&
                    selectElem.item(sampleIndex)
                ) {
                    selectElem.options[sampleIndex].selected = 'selected';
                } else {
                    appendScript(selectElem.options[0].value);
                }
            }
        </script>
    </body>
</html>
