{"version":3,"file":"meshFeatureSet-BQGBDVd2.js","sources":["../../node_modules/@arcgis/core/rest/support/meshFeatureSet.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport e from\"../../Graphic.js\";import t from\"../../core/Logger.js\";import{getOrCreateMapValue as r}from\"../../core/MapUtils.js\";import o from\"../../geometry/Extent.js\";import n from\"../../geometry/Mesh.js\";import s from\"../../geometry/Point.js\";import a from\"../../geometry/SpatialReference.js\";import i from\"../../geometry/support/MeshTransform.js\";import{ServiceAssetPart as u,ServiceAsset as f}from\"../../geometry/support/meshUtils/External.js\";import{getFormatIdMimeType as c}from\"../../layers/support/infoFor3D.js\";import l from\"./FeatureSet.js\";const m=()=>t.getLogger(\"esri.rest.support.meshFeatureSet\");function p(t,r,o){const n=o.features;o.features=[],delete o.geometryType;const s=l.fromJSON(o);if(s.geometryType=\"mesh\",!o.assetMaps)return s;const i=S(r,o.assetMaps),u=t.sourceSpatialReference??a.WGS84,f=o.globalIdFieldName,{outFields:c}=t,m=null!=c&&c.length>0?g(c.includes(\"*\")?null:new Set(c)):()=>({});for(const a of n){const t=h(a,f,u,r,i);null!=t&&s.features.push(new e({geometry:t,attributes:m(a)}))}return s}function g(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(const r in t)e.has(r)||delete t[r];return t}}function h(e,t,r,s,a){const i=e.attributes[t],u=a.get(i);if(null==u)return m().error(\"mesh-feature-set:asset-not-found\",\"Service returned a feature which was not found in the asset map\",e),null;if(!e.geometry)return m().error(\"mesh-feature-set:no-geometry\",\"Service returned a feature without geometry\",e),null;const f=y(e,r,s),c=o.fromJSON(e.geometry);c.spatialReference=r;const l=E(e.attributes,s),p=r.isGeographic?\"local\":\"georeferenced\",g=w(u);return g?n.createWithExternalSource(f,g,{extent:c,transform:l,vertexSpace:p}):n.createIncomplete(f,{extent:c,transform:l,vertexSpace:p})}function y({attributes:e},t,{transformFieldRoles:r}){const o=e[r.originX],n=e[r.originY],a=e[r.originZ];return new s({x:o,y:n,z:a,spatialReference:t})}function E(e,{transformFieldRoles:t}){return new i({translation:[e[t.translationX],-e[t.translationZ],e[t.translationY]],rotationAxis:[e[t.rotationX],-e[t.rotationZ],e[t.rotationY]],rotationAngle:e[t.rotationDeg],scale:[e[t.scaleX],e[t.scaleZ],e[t.scaleY]]})}var d;function S(e,t){const o=new Map;for(const n of t){const t=n.parentGlobalId;if(null==t)continue;const s=n.assetName,a=n.assetType,i=n.assetHash,u=n.assetURL,f=n.conversionStatus,l=n.seqNo,p=c(a,e.supportedFormats);if(!p){m().error(\"mesh-feature-set:unknown-format\",`Service returned an asset of type ${a}, but it does not list it as a supported type`);continue}const g=r(o,t,(()=>({files:new Map})));r(g.files,s,(()=>({name:s,type:a,mimeType:p,status:D(f),parts:[]}))).parts[l]={hash:i,url:u}}return o}function w(e){const t=Array.from(e.files.values()),r=new Array;for(const o of t){if(o.status!==d.COMPLETED)return null;const e=new Array;for(const t of o.parts){if(!t)return null;e.push(new u(t.url,t.hash))}r.push(new f(o.name,o.mimeType,e))}return r}function D(e){switch(e){case\"COMPLETED\":case\"SUBMITTED\":return d.COMPLETED;case\"INPROGRESS\":return d.PENDING;default:return d.FAILED}}!function(e){e[e.FAILED=0]=\"FAILED\",e[e.PENDING=1]=\"PENDING\",e[e.COMPLETED=2]=\"COMPLETED\"}(d||(d={}));export{S as assetMapFromAssetMapsJSON,h as extractMesh,p as meshFeatureSetFromJSON};\n"],"names":["m","t","p","r","o","l","i","S","a","c","g","h","e","s","y","E","w","n","d","u","f","D"],"mappings":"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","x_google_ignoreList":[0]}