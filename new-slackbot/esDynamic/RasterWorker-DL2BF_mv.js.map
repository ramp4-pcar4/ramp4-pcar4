{"version":3,"file":"RasterWorker-DL2BF_mv.js","sources":["../../node_modules/@arcgis/core/layers/support/RasterWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import r from\"../../geometry/support/GeographicTransformation.js\";import e from\"./PixelBlock.js\";import{decode as t}from\"./rasterFormats/RasterCodec.js\";import{split as s,clipTile as o,mosaic as i,approximateTransform as n,getLocalArithmeticNorthRotations as a}from\"./rasterFunctions/pixelUtils.js\";import{create as l}from\"./rasterFunctions/rasterFunctionHelper.js\";import{requirePE as m,load as c,getProjectionOffsetGrid as f}from\"./rasterFunctions/rasterProjectionHelper.js\";import{computeStatisticsHistograms as p,estimateStatisticsHistograms as u}from\"./rasterFunctions/stretchUtils.js\";import{convertVectorFieldData as S,convertToLocalDirections as d}from\"./rasterFunctions/vectorFieldUtils.js\";import{readTransform as x}from\"./rasterTransforms/utils.js\";import y from\"../../renderers/support/RasterSymbolizer.js\";import{createFlowMesh as O}from\"../../views/2d/engine/flow/dataUtils.js\";import h from\"../../geometry/Extent.js\";import N from\"../../geometry/Point.js\";class J{convertVectorFieldData(r){const t=e.fromJSON(r.pixelBlock),s=S(t,r.type);return Promise.resolve(null!=s?s.toJSON():null)}computeStatisticsHistograms(r){const t=e.fromJSON(r.pixelBlock),s=p(t);return Promise.resolve(s)}async decode(r){const e=await t(r.data,r.options);return e&&e.toJSON()}symbolize(r){r.pixelBlock=e.fromJSON(r.pixelBlock),r.extent=r.extent?h.fromJSON(r.extent):null;const t=this.symbolizer.symbolize(r);return Promise.resolve(null!=t?t.toJSON():null)}async updateSymbolizer(r){this.symbolizer=y.fromJSON(r.symbolizerJSON),r.histograms&&\"rasterStretch\"===this.symbolizer?.rendererJSON.type&&(this.symbolizer.rendererJSON.histograms=r.histograms)}async updateRasterFunction(r){this.rasterFunction=l(r.rasterFunctionJSON)}async process(r){const t=this.rasterFunction.process({extent:h.fromJSON(r.extent),primaryPixelBlocks:r.primaryPixelBlocks.map((r=>null!=r?e.fromJSON(r):null)),primaryPixelSizes:r.primaryPixelSizes?.map((r=>null!=r?N.fromJSON(r):null)),primaryRasterIds:r.primaryRasterIds});return null!=t?t.toJSON():null}stretch(r){const t=this.symbolizer.simpleStretch(e.fromJSON(r.srcPixelBlock),r.stretchParams);return Promise.resolve(t?.toJSON())}estimateStatisticsHistograms(r){const t=u(e.fromJSON(r.srcPixelBlock));return Promise.resolve(t)}split(r){const t=s(e.fromJSON(r.srcPixelBlock),r.tileSize,r.maximumPyramidLevel??0,!1===r.useBilinear);return t&&t.forEach(((r,e)=>{t.set(e,r?.toJSON())})),Promise.resolve(t)}clipTile(r){const t=e.fromJSON(r.pixelBlock),s=o({...r,pixelBlock:t});return Promise.resolve(s?.toJSON())}async mosaicAndTransform(r){const t=r.srcPixelBlocks.map((r=>r?new e(r):null)),s=i(t,r.srcMosaicSize,{blockWidths:r.blockWidths,alignmentInfo:r.alignmentInfo,clipOffset:r.clipOffset,clipSize:r.clipSize});let o,l=s;return r.coefs&&(l=n(s,r.destDimension,r.coefs,r.sampleSpacing,r.interpolation)),r.projectDirections&&r.gcsGrid&&(o=a(r.destDimension,r.gcsGrid),l=d(l,r.isUV?\"vector-uv\":\"vector-magdir\",o)),{pixelBlock:l?.toJSON(),localNorthDirections:o}}async createFlowMesh(r,e){const t={data:new Float32Array(r.flowData.buffer),mask:new Uint8Array(r.flowData.maskBuffer),width:r.flowData.width,height:r.flowData.height},{vertexData:s,indexData:o}=await O(r.meshType,r.simulationSettings,t,e.signal);return{result:{vertexBuffer:s.buffer,indexBuffer:o.buffer},transferList:[s.buffer,o.buffer]}}async getProjectionOffsetGrid(e){const t=h.fromJSON(e.projectedExtent),s=h.fromJSON(e.srcBufferExtent);let o=null;e.datumTransformationSteps&&(o=new r({steps:e.datumTransformationSteps})),(e.includeGCSGrid||m(t.spatialReference,s.spatialReference,o))&&await c();const i=e.rasterTransform?x(e.rasterTransform):null;return f({...e,projectedExtent:t,srcBufferExtent:s,datumTransformation:o,rasterTransform:i})}}export{J as default};\n"],"names":["J","r","e","S","p","t","h","y","l","N","u","s","o","i","n","a","d","O","m","c","x","f"],"mappings":"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","x_google_ignoreList":[0]}