import { r as r$1, U as U$1, eo as r, ep as l$1, b as e$1, eq as o, er as g$1, es as d, et as r$5, aX as r$6, t as t$4 } from './main-5658cd6e.js';
import { e } from './mat3f64-f0e5b33e.js';
import { p, m as m$1, c, g } from './meshFeatureSet-c54c923c.js';
import { c as c$1, x, L, O, i, E, T, u } from './BufferView-280c2f14.js';
import { t as t$1, r as r$3, o as o$1, a as t$2, f as f$1, e as e$3, n as n$3 } from './vec33-10cb0362.js';
import { n, m, r as r$2, a as r$4, f, t as t$3, b as n$1, d as d$1, o as o$2, e as e$2, c as n$2, i as i$1, g as f$2, h as o$3, j as o$4 } from './DefaultMaterial_COLOR_GAMMA-eb95e6eb.js';
import { _ } from './georeference-3619fb58.js';
import { t } from './resourceUtils-267be27b.js';
import { u as u$1 } from './Indices-ea523834.js';
import { E as E$1, D } from './enums-1f7f0b0a.js';
import './preload-helper-a4975f27.js';
import './imageUtils-72e7e0e5.js';
import './earcut-336027d9.js';
import './deduplicate-c946c408.js';
import './mat4f64-151d6b53.js';
import './spatialReferenceEllipsoidUtils-44af14ac.js';
import './types-814802c7.js';
import './quat-1e678ab0.js';
import './quatf64-3a66031a.js';
import './basicInterfaces-9de11baf.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
async function X(e,t,r){const o=new n(Y(r)),s=(await m(o,t,r,!0)).model,i=s.lods.shift(),a=new Map,c=new Map;s.textures.forEach(((e,t)=>a.set(t,re(e)))),s.materials.forEach(((e,t)=>c.set(t,oe(e,a))));const u=te(i);for(const n of u.parts)ne(u,n,c);const{position:l,normal:f,tangent:m$1,color:p$1,texCoord0:d}=u.vertexAttributes,x={position:l.typedBuffer,normal:r$1(f)?f.typedBuffer:null,tangent:r$1(m$1)?m$1.typedBuffer:null,uv:r$1(d)?d.typedBuffer:null,color:r$1(p$1)?p$1.typedBuffer:null},T=_(x,e,r);return {transform:T.transform,components:u.components,spatialReference:e.spatialReference,vertexAttributes:new p({position:T.vertexAttributes.position,normal:T.vertexAttributes.normal,tangent:T.vertexAttributes.tangent,color:x.color,uv:x.uv})}}function Y(e){const r=e?.resolveFile;return r?{busy:!1,request:async(e,o,s)=>{const i=r(e),a="image"===o?"image":"binary"===o?"array-buffer":"json";return (await U$1(i,{responseType:a,signal:r$1(s)?s.signal:null})).data}}:null}function Z(e,t){if(t$4(e))return "-";const o=e.typedBuffer;return `${r(t,o.buffer,(()=>t.size))}/${o.byteOffset}/${o.byteLength}`}function ee(e){return r$1(e)?e.toString():"-"}function te(e){let t=0;const has={color:!1,tangent:!1,normal:!1,texCoord0:!1},o=new Map,n=new Map,s=[];for(const i of e.parts){const{attributes:{position:e,normal:a,color:c,tangent:u,texCoord0:l}}=i,f=`\n      ${Z(e,o)}/\n      ${Z(a,o)}/\n      ${Z(c,o)}/\n      ${Z(u,o)}/\n      ${Z(l,o)}/\n      ${ee(i.transform)}\n    `;let m=!1;const p=r(n,f,(()=>(m=!0,{start:t,length:e.count})));m&&(t+=e.count),a&&(has.normal=!0),c&&(has.color=!0),u&&(has.tangent=!0),l&&(has.texCoord0=!0),s.push({gltf:i,writeVertices:m,region:p});}return {vertexAttributes:{position:r$2(T,t),normal:has.normal?r$2(i,t):null,tangent:has.tangent?r$2(c$1,t):null,color:has.color?r$2(x,t):null,texCoord0:has.texCoord0?r$2(u,t):null},parts:s,components:[]}}function re(e){return new m$1({data:(t(e.data),e.data),wrap:ce(e.parameters.wrap)})}function oe(t,r){const o$1=new l$1(fe(t.color,t.opacity)),n=t.emissiveFactor?new l$1(me(t.emissiveFactor)):null;return new c({color:o$1,colorTexture:e$1(o(t.textureColor,(e=>r.get(e)))),normalTexture:e$1(o(t.textureNormal,(e=>r.get(e)))),emissiveColor:n,emissiveTexture:e$1(o(t.textureEmissive,(e=>r.get(e)))),occlusionTexture:e$1(o(t.textureOcclusion,(e=>r.get(e)))),alphaMode:ae(t.alphaMode),alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,metallic:t.metallicFactor,roughness:t.roughnessFactor,metallicRoughnessTexture:e$1(o(t.textureMetallicRoughness,(e=>r.get(e)))),colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform})}function ne(e,t,r){t.writeVertices&&se(e,t);const o=t.gltf,n=ie(o.indices||o.attributes.position.count,o.primitiveType),s=t.region.start;if(s)for(let i=0;i<n.length;i++)n[i]+=s;e.components.push(new g({faces:n,material:r.get(o.material),trustSourceNormals:!0}));}function se(e$1,t){const{position:r,normal:s,tangent:i$1,color:a,texCoord0:l}=e$1.vertexAttributes,f$2=t.region.start,{attributes:m,transform:p}=t.gltf,d$2=m.position.count;if(t$1(r.slice(f$2,d$2),m.position,p),r$1(m.normal)&&r$1(s)){const e$1=g$1(e(),p),t=s.slice(f$2,d$2);r$3(t,m.normal,e$1),d(e$1)&&o$1(t,t);}else r$1(s)&&t$2(s,0,0,1,{dstIndex:f$2,count:d$2});if(r$1(m.tangent)&&r$1(i$1)){const e$1=g$1(e(),p),t=i$1.slice(f$2,d$2);r$4(t,m.tangent,e$1),d(e$1)&&f(t,t);}else r$1(i$1)&&t$3(i$1,0,0,1,1,{dstIndex:f$2,count:d$2});if(r$1(m.texCoord0)&&r$1(l)?n$1(l.slice(f$2,d$2),m.texCoord0):r$1(l)&&d$1(l,0,0,{dstIndex:f$2,count:d$2}),r$1(m.color)&&r$1(a)){const e=m.color,t=a.slice(f$2,d$2);if(4===e.elementCount)e instanceof c$1?o$2(t,e,255):e instanceof x?e$2(t,e):e instanceof L&&n$2(t,e,8);else {t$3(t,255,255,255,255);const r=O.fromTypedArray(t.typedBuffer,t.typedBufferStride);e instanceof i?f$1(r,e,255):e instanceof O?e$3(r,e):e instanceof E&&n$3(r,e,8);}}else r$1(a)&&t$3(a.slice(f$2,d$2),255,255,255,255);}function ie(e,t){switch(t){case E$1.TRIANGLES:return o$3(e,u$1);case E$1.TRIANGLE_STRIP:return f$2(e);case E$1.TRIANGLE_FAN:return i$1(e)}}function ae(e){switch(e){case"OPAQUE":return "opaque";case"MASK":return "mask";case"BLEND":return "blend"}}function ce(e){return {horizontal:ue(e.s),vertical:ue(e.t)}}function ue(e){switch(e){case D.CLAMP_TO_EDGE:return "clamp";case D.MIRRORED_REPEAT:return "mirror";case D.REPEAT:return "repeat"}}function le(e){return e**(1/o$4)*255}function fe(e,t){return r$5(le(e[0]),le(e[1]),le(e[2]),t)}function me(e){return r$6(le(e[0]),le(e[1]),le(e[2]))}

export { X as loadGLTFMesh };
