import { e as e$1, y, k as a$1, dE as v$1, h as has, p as s$1, a9 as p$1, iu as d, iv as n$1, iw as e$2, fw as n$2, t as t$1, eZ as D, eM as e$3 } from './main-5658cd6e.js';
import { J } from './definitions-281daf3f.js';
import { M, P as P$1, G as G$1, D as D$1, L as L$1 } from './enums-1f7f0b0a.js';
import { E } from './Texture-aefe232f.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
const l=-1;let a=class extends v$1{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=has("mapview-transitions-duration"),this.effects=[];}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(h$1(t));}catch(e){this._transitionTo([]),s$1.getLogger(this.declaredClass).warn("Invalid Effect",{effect:t,error:e});}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t);}get transitioning(){return null!==this._to}canTransitionTo(t){try{return this.scale>0&&u$1(this._current,h$1(t),this.scale)}catch{return !1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e);}endTransitions(){this._applyTimeTransition(this.duration);}_transitionTo(t){this.scale>0&&u$1(this._current,t,this.scale)?(this._final=t,this._to=p$1(t),_(this._current,this._to,this.scale),this._from=p$1(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?p$1(this._current[0].effects):[]);}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let s=0;s<this._current.length;s++){const t=this._current[s],r=this._from[s],i=this._to[s];t.scale=p(r.scale,i.scale,e);for(let s=0;s<t.effects.length;s++){const n=t.effects[s],c=r.effects[s],o=i.effects[s];n.interpolate(c,o,e);}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?p$1(this._current[0].effects):[]),this._from=this._to=this._final=null);}_updateForScale(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,s=this._current.length-1;let r,i,n=1;if(1===e.length||t>=e[0].scale)i=r=e[0].effects;else if(t<=e[s].scale)i=r=e[s].effects;else for(let c=0;c<s;c++){const s=e[c],o=e[c+1];if(s.scale>=t&&o.scale<=t){n=(t-s.scale)/(o.scale-s.scale),r=s.effects,i=o.effects;break}}for(let c=0;c<this.effects.length;c++){this.effects[c].interpolate(r[c],i[c],n);}}};function h$1(t){const e=d(t)||[];return m(e)?[{scale:l,effects:e}]:e}function u$1(t,e,s){if(!t[0]?.effects||!e[0]?.effects)return !0;return !((t[0]?.scale===l||e[0]?.scale===l)&&(t.length>1||e.length>1)&&s<=0)&&n$1(t[0].effects,e[0].effects)}function _(t,e,s){const r=t.length>e.length?t:e,i=t.length>e.length?e:t,n=i[i.length-1],c=n?.scale??s,o=n?.effects??[];for(let f=i.length;f<r.length;f++)i.push({scale:c,effects:[...o]});for(let a=0;a<r.length;a++)i[a].scale=i[a].scale===l?s:i[a].scale,r[a].scale=r[a].scale===l?s:r[a].scale,e$2(i[a].effects,r[a].effects);}function p(t,e,s){return t+(e-t)*s}function m(t){const e=t[0];return !!e&&"type"in e}e$1([y()],a.prototype,"_to",void 0),e$1([y()],a.prototype,"duration",void 0),e$1([y({value:""})],a.prototype,"effect",null),e$1([y({readOnly:!0})],a.prototype,"effects",void 0),e$1([y({readOnly:!0})],a.prototype,"hasEffects",null),e$1([y({value:0})],a.prototype,"scale",null),e$1([y({readOnly:!0})],a.prototype,"transitioning",null),a=e$1([a$1("esri.layers.effects.EffectView")],a);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
const i$1=1/has("mapview-transitions-duration");let r$1 = class r extends n$2{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0;}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender();}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender());}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t?.trashDisplayObject(this);}get transforms(){return this._getTransforms()}_getTransforms(){return t$1(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender());}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=D(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=D(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender();}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale);}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null);}remove(){this.parent?.removeChild(this);}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e);}requestRender(){this.stage&&this.stage.requestRender();}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach");}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const t=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===t)this.computedVisible=this.visible;else {const r=e*i$1;this.computedOpacity=s>t?Math.max(t,s-r):Math.min(t,s+r),this.computedVisible=this.computedOpacity>0;const a=t===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender();}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible;}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender());}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
const o=1,t=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n=256,e={outlineWidth:1.3,outerHaloWidth:.4,innerHaloWidth:.4,outlinePosition:0};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
const u=s$1.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function C(o,i){i.fillColor[0]=o.color.r/255,i.fillColor[1]=o.color.g/255,i.fillColor[2]=o.color.b/255,i.fillColor[3]=o.color.a,o.haloColor?(i.outlineColor[0]=o.haloColor.r/255,i.outlineColor[1]=o.haloColor.g/255,i.outlineColor[2]=o.haloColor.b/255,i.outlineColor[3]=o.haloColor.a):(i.outlineColor[0]=i.fillColor[0],i.outlineColor[1]=i.fillColor[1],i.outlineColor[2]=i.fillColor[2],i.outlineColor[3]=i.fillColor[3]),i.fillColor[3]*=o.fillOpacity,i.outlineColor[3]*=o.haloOpacity,i.fillColor[0]*=i.fillColor[3],i.fillColor[1]*=i.fillColor[3],i.fillColor[2]*=i.fillColor[3],i.outlineColor[0]*=i.outlineColor[3],i.outlineColor[1]*=i.outlineColor[3],i.outlineColor[2]*=i.outlineColor[3],i.outlineWidth=e.outlineWidth,i.outerHaloWidth=e.outerHaloWidth,i.innerHaloWidth=e.innerHaloWidth,i.outlinePosition=e.outlinePosition;}const g=[0,0,0,0];class f{constructor(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:e.outlinePosition,outlineWidth:e.outlineWidth,innerHaloWidth:e.innerHaloWidth,outerHaloWidth:e.outerHaloWidth},this._shadeTexChanged=!0,this._texelData=new Uint8Array(4*n),this._minMaxDistance=[0,0];}setHighlightOptions(o$1){const i=this._convertedHighlightOptions;C(o$1,i);const t=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,r=i.outlinePosition-i.outlineWidth/2,n$1=i.outlinePosition+i.outlineWidth/2,h=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,a=Math.sqrt(Math.PI/2)*o,s=Math.abs(t)>a?Math.round(10*(Math.abs(t)-a))/10:0,d=Math.abs(h)>a?Math.round(10*(Math.abs(h)-a))/10:0;let f;s&&!d?u.error("The outer rim of the highlight is "+s+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!s&&d?u.error("The inner rim of the highlight is "+d+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):s&&d&&u.error("The highlight is "+Math.max(s,d)+"px away from the edge of the feature; consider reducing some width values.");const c=[void 0,void 0,void 0,void 0];function m(o,i,t){c[0]=(1-t)*o[0]+t*i[0],c[1]=(1-t)*o[1]+t*i[1],c[2]=(1-t)*o[2]+t*i[2],c[3]=(1-t)*o[3]+t*i[3];}const{_texelData:p}=this;for(let l=0;l<n;++l)f=t+l/(n-1)*(h-t),f<t?(c[4*l+0]=0,c[4*l+1]=0,c[4*l+2]=0,c[4*l+3]=0):f<r?m(g,i.outlineColor,(f-t)/(r-t)):f<n$1?[c[0],c[1],c[2],c[3]]=i.outlineColor:f<h?m(i.outlineColor,i.fillColor,(f-n$1)/(h-n$1)):[c[4*l+0],c[4*l+1],c[4*l+2],c[4*l+3]]=i.fillColor,p[4*l+0]=255*c[0],p[4*l+1]=255*c[1],p[4*l+2]=255*c[2],p[4*l+3]=255*c[3];this._minMaxDistance[0]=t,this._minMaxDistance[1]=h,this._shadeTexChanged=!0;}applyHighlightOptions(o,t){this._shadeTex||(this._shadeTex=new E(o,{target:M.TEXTURE_2D,pixelFormat:P$1.RGBA,dataType:G$1.UNSIGNED_BYTE,wrapMode:D$1.CLAMP_TO_EDGE,width:n,height:1,samplingMode:L$1.LINEAR})),this._shadeTexChanged&&(this._shadeTex.updateData(0,0,0,n,1,this._texelData),this._shadeTexChanged=!1),o.bindTexture(this._shadeTex,J),t.setUniform2fv("u_minMaxDistance",this._minMaxDistance);}destroy(){this._shadeTex?.dispose(),this._shadeTex=null;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
class h extends r$1{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this.children=[],this._effectView=null,this._highlightOptions=null,this._highlightGradient=null;}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender();}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach((t=>t.clips=e));}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??""}set effect(e){(this._effectView||e)&&(this._effectView||(this._effectView=new a),this._effectView.effect=e,this.requestRender());}get highlightOptions(){return this._highlightOptions}set highlightOptions(e){if(!e)return this._highlightOptions=null,void(this._highlightGradient&&(this._highlightGradient.destroy(),this._highlightGradient=null,this.requestRender()));this._highlightOptions&&this._highlightOptions.equals(e)||(this._highlightOptions=e,this._highlightGradient||(this._highlightGradient=new f),this._highlightGradient.setHighlightOptions(e),this.requestRender());}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender());}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t);}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}endTransitions(){super.endTransitions(),this._effectView&&(this._effectView.endTransitions(),this.requestRender());}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0;}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1);}beforeRender(e){super.beforeRender(e);for(const t of this.children)t.beforeRender(e);}afterRender(e){super.afterRender(e);for(const t of this.children)t.afterRender(e);}_createTransforms(){return {dvs:e$3()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e;}onDetach(){super.onDetach();for(const e of this.children)e.stage=null;}renderChildren(e){for(const t of this.children)t.processRender(e);}createRenderParams(e){return {...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||e.highlightGradient}}}

export { a, h, i, o, r$1 as r, t };
