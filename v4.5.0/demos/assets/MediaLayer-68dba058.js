import { e, k as a$2, j3 as l$1, t, eh as un, p as s$1, y, bh as w$1, dB as u, f as f$1, fh as r, c as s, r as r$1, b as e$1, gA as c$1, k$ as u$1, dN as o, e0 as r$2, l0 as L$1, l1 as A$1, bi as v$2, gx as n$2, dE as v$3, l2 as r$3, w as w$2, iA as b$2, l3 as r$4, l4 as i, m as m$1, U as U$2, M as c$2, e5 as m$2, au as tt, ea as Z, e9 as U$3, e6 as R, e8 as Y$1, l5 as st, ec as n$3, V as V$2, bv as j$2, je as m$3, gj as a$3, fw as n$4, bp as l$2, cq as f$2, bU as n$5, ap as _n, ar as E$2, bC as rn, fd as c$3, gD as x$1, dF as n$6, dJ as t$3, dH as c$4, dK as O$1, j4 as s$2, a4 as b$3 } from './main-5658cd6e.js';
import { h, j as j$1, u as u$2 } from './perspectiveUtils-7a682c08.js';
import { t as t$1, e as e$2 } from './mat3f64-f0e5b33e.js';
import { t as t$2 } from './resourceExtension-23790ddb.js';
import { o as o$1 } from './BoundsStore-1cad0f07.js';
import './preload-helper-a4975f27.js';
import './normalizeUtilsSync-c3a052ce.js';
import './PooledRBush-5e47a5ad.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
let a$1=class a extends l$1{projectOrWarn(e,r){if(t(e))return e;const{geometry:s,pending:a}=un(e,r);return a?null:a||s?s:(s$1.getLogger(this.declaredClass).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:e,sourceSpatialReference:e.spatialReference,targetSpatialReference:r}),null)}};a$1=e([a$2("esri.layers.support.GeoreferenceBase")],a$1);const p$1=a$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
const O=e$2(),b$1=n$2();let k=class extends v$3{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null;}};e([y()],k.prototype,"sourcePoint",void 0),e([y({type:w$1})],k.prototype,"mapPoint",void 0),k=e([a$2("esri.layers.support.ControlPoint")],k);let I$1=class I extends(u(p$1)){constructor(o){super(o),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0;}readControlPoints(o,t){const r$1=f$1.fromJSON(t.spatialReference),e=t$1(...t.coefficients,1);return o.map((o=>(r(b$1,o.x,o.y),h(b$1,b$1,e),{sourcePoint:o,mapPoint:new w$1({x:b$1[0],y:b$1[1],spatialReference:r$1})})))}writeControlPoints(o,t$1,e,l){if(t(this.transform)){const o=new s("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration.",{layer:l?.layer,georeference:this});l?.messages?l.messages.push(o):s$1.getLogger(this.declaredClass).error(o.name,o.message);}else r$1(o)&&M(o[0])&&(t$1.controlPoints=o.map((o=>{const t=e$1(o.sourcePoint);return {x:t.x,y:t.y}})),t$1.spatialReference=o[0].mapPoint.spatialReference.toJSON(),t$1.coefficients=this.transform.slice(0,8));}get coords(){if(t(this.controlPoints))return null;const o=this._updateTransform(O);if(t(o)||!M(this.controlPoints[0]))return null;const t$1=this.controlPoints[0].mapPoint.spatialReference;return X(o,this.width,this.height,t$1)}set coords(o){if(t(this.controlPoints)||!M(this.controlPoints[0]))return;const t$1=this.controlPoints[0].mapPoint.spatialReference;if(o=this.projectOrWarn(o,t$1),t(o))return;const{width:r$1,height:e}=this,{rings:[[n,s,a,u]]}=o,m={sourcePoint:c$1(0,e),mapPoint:new w$1({x:n[0],y:n[1],spatialReference:t$1})},f={sourcePoint:c$1(0,0),mapPoint:new w$1({x:s[0],y:s[1],spatialReference:t$1})},P={sourcePoint:c$1(r$1,0),mapPoint:new w$1({x:a[0],y:a[1],spatialReference:t$1})},h$1={sourcePoint:c$1(r$1,e),mapPoint:new w$1({x:u[0],y:u[1],spatialReference:t$1})};M(m)&&M(f)&&M(P)&&M(h$1)&&(F(O,m,f,P,h$1),this.controlPoints=e$1(this.controlPoints).map((({sourcePoint:o})=>(r(b$1,o.x,o.y),h(b$1,b$1,O),{sourcePoint:o,mapPoint:new w$1({x:b$1[0],y:b$1[1],spatialReference:t$1})}))));}get inverseTransform(){return t(this.transform)?null:u$1(e$2(),this.transform)}get transform(){return this._updateTransform()}toMap(o){if(t(o)||t(this.transform)||t(this.controlPoints)||!M(this.controlPoints[0]))return null;r(b$1,o.x,o.y);const t$1=this.controlPoints[0].mapPoint.spatialReference;return h(b$1,b$1,this.transform),new w$1({x:b$1[0],y:b$1[1],spatialReference:t$1})}toSource(o){if(t(o)||t(this.inverseTransform)||t(this.controlPoints)||!M(this.controlPoints[0]))return null;const t$1=this.controlPoints[0].mapPoint.spatialReference;return o=o.normalize(),o=un(o,t$1).geometry,t(o)?null:(r(b$1,o.x,o.y),h(b$1,b$1,this.inverseTransform),c$1(b$1[0],b$1[1]))}_updateTransform(o){const{controlPoints:t$1,width:r,height:e}=this;if(t(t$1)||!(r>0)||!(e>0))return null;const[n,s,c,l]=t$1;if(!M(n))return null;const a=n.mapPoint.spatialReference,p=this._projectControlPoint(s,a),u=this._projectControlPoint(c,a),m=this._projectControlPoint(l,a);if(!p.valid||!u.valid||!m.valid)return null;if(!M(p.controlPoint))return null;t(o)&&(o=e$2());let f=null;return f=M(u.controlPoint)&&M(m.controlPoint)?F(o,n,p.controlPoint,u.controlPoint,m.controlPoint):M(u.controlPoint)?D(o,n,p.controlPoint,u.controlPoint):W(o,n,p.controlPoint),f.every((o=>0===o))?null:f}_projectControlPoint(o,t){if(!M(o))return {valid:!0,controlPoint:o};const{sourcePoint:r,mapPoint:e}=o,{geometry:i,pending:s}=un(e,t);return s?{valid:!1,controlPoint:null}:s||i?{valid:!0,controlPoint:{sourcePoint:r,mapPoint:i}}:(s$1.getLogger(this.declaredClass).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:o,sourceSpatialReference:e.spatialReference,targetSpatialReference:t}),{valid:!1,controlPoint:null})}};function M(o){return r$1(o)&&r$1(o.sourcePoint)&&r$1(o.mapPoint)}e([y({type:[k],json:{write:{allowNull:!1,isRequired:!0}}})],I$1.prototype,"controlPoints",void 0),e([o("controlPoints")],I$1.prototype,"readControlPoints",null),e([r$2("controlPoints")],I$1.prototype,"writeControlPoints",null),e([y()],I$1.prototype,"coords",null),e([y({json:{write:!0}})],I$1.prototype,"height",void 0),e([y({readOnly:!0})],I$1.prototype,"inverseTransform",null),e([y({readOnly:!0})],I$1.prototype,"transform",null),e([y({json:{write:!0}})],I$1.prototype,"width",void 0),I$1=e([a$2("esri.layers.support.ControlPointsGeoreference")],I$1);const N=n$2(),A=n$2(),J=n$2(),L=n$2(),U$1=n$2(),G=n$2(),q=n$2(),z=n$2(),B=Math.PI/2;function E$1(o,t,r$1){r(o,r$1.sourcePoint.x,r$1.sourcePoint.y),r(t,r$1.mapPoint.x,r$1.mapPoint.y);}function W(o,t,r){return E$1(N,U$1,t),E$1(A,G,r),L$1(J,A,N,B),L$1(L,N,A,B),L$1(q,G,U$1,-B),L$1(z,U$1,G,-B),V$1(o,N,A,J,L,U$1,G,q,z)}function D(o,t,r,e){return E$1(N,U$1,t),E$1(A,G,r),E$1(J,q,e),A$1(L,N,A,.5),L$1(L,J,L,Math.PI),A$1(z,U$1,G,.5),L$1(z,q,z,Math.PI),V$1(o,N,A,J,L,U$1,G,q,z)}function F(o,t,r,e,n){return E$1(N,U$1,t),E$1(A,G,r),E$1(J,q,e),E$1(L,z,n),V$1(o,N,A,J,L,U$1,G,q,z)}const H=new Array(8).fill(0),K=new Array(8).fill(0);function Q(o,t,r,e,n){return o[0]=t[0],o[1]=t[1],o[2]=r[0],o[3]=r[1],o[4]=e[0],o[5]=e[1],o[6]=n[0],o[7]=n[1],o}function V$1(o,t,r,e,n,i,s,c,l){return j$1(o,Q(H,t,r,e,n),Q(K,i,s,c,l))}function X(o,t,r,e){const n=r$3(0,r),i=r$3(0,0),s=r$3(t,0),c=r$3(t,r);return h(n,n,o),h(i,i,o),h(s,s,o),h(c,c,o),new v$2({rings:[[n,i,s,c,n]],spatialReference:e})}const Y=I$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
let n$1=class n extends p$1{constructor(t){super(t),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners";}get coords(){let{topLeft:t$1,topRight:o,bottomLeft:r,bottomRight:s}=this;if(t(t$1)||t(o)||t(r)||t(s))return null;const i=t$1.spatialReference;return o=this.projectOrWarn(o,i),r=this.projectOrWarn(r,i),s=this.projectOrWarn(s,i),t(o)||t(r)||t(s)?null:new v$2({rings:[[[r.x,r.y],[t$1.x,t$1.y],[o.x,o.y],[s.x,s.y],[r.x,r.y]]],spatialReference:i})}set coords(t$1){const{topLeft:o}=this;if(t(o))return;const r=o.spatialReference;if(t$1=this.projectOrWarn(t$1,r),t(t$1))return;const{rings:[[p,i,n,c]]}=t$1;this.bottomLeft=new w$1({x:p[0],y:p[1],spatialReference:r}),this.topLeft=new w$1({x:i[0],y:i[1],spatialReference:r}),this.topRight=new w$1({x:n[0],y:n[1],spatialReference:r}),this.bottomRight=new w$1({x:c[0],y:c[1],spatialReference:r});}};e([y()],n$1.prototype,"coords",null),e([y({type:w$1})],n$1.prototype,"bottomLeft",void 0),e([y({type:w$1})],n$1.prototype,"bottomRight",void 0),e([y({type:w$1})],n$1.prototype,"topLeft",void 0),e([y({type:w$1})],n$1.prototype,"topRight",void 0),n$1=e([a$2("esri.layers.support.CornersGeoreference")],n$1);const c=n$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
let p=class extends p$1{constructor(t){super(t),this.extent=null,this.rotation=0,this.type="extent-and-rotation";}get coords(){if(t(this.extent))return null;const{xmin:t$1,ymin:e,xmax:o,ymax:s,spatialReference:n}=this.extent;let i;if(this.rotation){const{x:r,y:n}=this.extent.center,a=m(r,n,this.rotation);i=[a(t$1,e),a(t$1,s),a(o,s),a(o,e)],i.push(i[0]);}else i=[[t$1,e],[t$1,s],[o,s],[o,e],[t$1,e]];return new v$2({rings:[i],spatialReference:n})}set coords(t$1){if(t(t$1)||t(this.extent))return;const o=this.extent.spatialReference;if(t$1=this.projectOrWarn(t$1,o),t(t$1)||t(t$1.extent))return;const{rings:[[s,n,a]],extent:{center:{x:c,y:p}}}=t$1,x=b$2(Math.PI/2-Math.atan2(n[1]-s[1],n[0]-s[0])),u=m(c,p,-x),[f,h]=u(s[0],s[1]),[l,y]=u(a[0],a[1]);this.extent=new w$2({xmin:f,ymin:h,xmax:l,ymax:y,spatialReference:o}),this.rotation=x;}};function m(t,e,r){const o=r$4(r),s=Math.cos(o),i=Math.sin(o);return (r,o)=>[s*(r-t)+i*(o-e)+t,s*(o-e)-i*(r-t)+e]}e([y()],p.prototype,"coords",null),e([y({type:w$2})],p.prototype,"extent",void 0),e([y({type:Number})],p.prototype,"rotation",void 0),p=e([a$2("esri.layers.support.ExtentAndRotationGeoreference")],p);const x=p;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
const f={key:"type",base:p$1,typeMap:{"control-points":Y,corners:c,"extent-and-rotation":x}};let l=class extends(i(u(m$1))){constructor(){super(...arguments),this.georeference=null,this.opacity=1;}readGeoreference(e){return Y.fromJSON(e)}};e([y({types:f,json:{write:!0}})],l.prototype,"georeference",void 0),e([o("georeference")],l.prototype,"readGeoreference",null),e([y()],l.prototype,"opacity",void 0),l=e([a$2("esri.layers.support.MediaElementBase")],l);const d=l;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
let I=class extends d{constructor(e){super(e),this.content=null,this.image=null,this.type="image",this.image=null;}load(){const e=this.image;if("string"==typeof e){const r=U$2(e,{responseType:"image"}).then((({data:e})=>{this._set("content",e);}));this.addResolvingPromise(r);}else if(e instanceof HTMLImageElement){const t=e.decode().then((()=>{this._set("content",e);}));this.addResolvingPromise(t);}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new s("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}readImage(e,t,r){return c$2(t.url,r)}writeImage(e,t$1,r,a){if(t(e))return;const m=a?.portalItem,p=a?.resources;if(!m||!p)return void("string"==typeof e&&(t$1[r]=m$2(e,a)));const c="string"!=typeof e||tt(e)||Z(e)?null:e;if(c){if(null==U$3(c))return void(t$1[r]=c);const e=m$2(c,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},R.NO);if(m&&e&&!Y$1(e))return p.toKeep.push({resource:m.resourceFromPath(e),compress:!1}),void(t$1[r]=e)}t$1[r]="<pending>",p.pendingOperations.push(E(e).then((e=>{const o=U(e,m);t$1[r]=o.itemRelativeUrl,p.toAdd.push({resource:o,content:e,compress:!1,finish:e=>{this.image=e.url;}});})));}};e([y({readOnly:!0})],I.prototype,"content",void 0),e([y({json:{name:"url",type:String}})],I.prototype,"image",void 0),e([o("image",["url"])],I.prototype,"readImage",null),e([r$2("image")],I.prototype,"writeImage",null),e([y({readOnly:!0,json:{name:"mediaType"}})],I.prototype,"type",void 0),I=e([a$2("esri.layers.support.ImageElement")],I);const w=I;async function E(e){if("string"==typeof e){if(Z(e)){const{data:r}=await U$2(e,{responseType:"blob"});return r}if(tt(e))return st(e);return E((await U$2(e,{responseType:"image"})).data)}return new Promise((t=>T(e).toBlob(t)))}function T(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,r=e instanceof HTMLImageElement?e.naturalHeight:e.height,o=document.createElement("canvas"),s=o.getContext("2d");return o.width=t,o.height=r,e instanceof HTMLImageElement?s.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&s.putImageData(e,0,0),o}function U(e,t){const r=n$3(),o=`${V$2("media",r)}.${t$2(e)}`;return t.resourceFromPath(o)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
let n=class extends d{constructor(e){super(e),this.content=null,this.type="video";}load(){const e=this.video;if("string"==typeof e){const o=document.createElement("video");o.src=e,o.crossOrigin="anonymous",o.autoplay=!0,o.muted=!0,o.loop=!0,this.addResolvingPromise(this._loadVideo(o).then((()=>{this._set("content",o);})));}else e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then((()=>{this._set("content",e);}))):this.addResolvingPromise(Promise.reject(new s("video-element:invalid-video-type","Invalid video type",{video:e})));return Promise.resolve(this)}set video(e){"not-loaded"===this.loadStatus?this._set("video",e):s$1.getLogger(this.declaredClass).error("#video","video cannot be changed after the element is loaded.");}_loadVideo(e){return new Promise(((o,s)=>{e.oncanplay=()=>{e.oncanplay=null,e.play().then(o,s);},"anonymous"!==e.crossOrigin&&(e.crossOrigin="anonymous",e.src=e.src);}))}};e([y({readOnly:!0})],n.prototype,"content",void 0),e([y()],n.prototype,"video",null),n=e([a$2("esri.layers.support.VideoElement")],n);const a=n;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
const V={key:"type",defaultKeyValue:"image",base:d,typeMap:{image:w,video:a}},C=j$2.ofType(V);let b=class extends(m$1.LoadableMixin(m$3(a$3(n$4.EventedAccessor)))){constructor(e){super(e),this._index=new o$1,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=e=>{for(const s of e.removed){const e=this._elementViewsMap.get(s);this._elementViewsMap.delete(s),this._index.delete(e),this.handles.remove(e),e.destroy(),this.notifyChange("fullExtent");}const{spatialReference:t}=this;for(const s of e.added){if(this._elementViewsMap.get(s))continue;const e=new u$2({spatialReference:t,element:s});this._elementViewsMap.set(s,e);const r=l$2((()=>e.coords),(()=>this._updateIndexForElement(e,!1)));this._updateIndexForElement(e,!0),this.handles.add(r,e);}this._elementsIndexes.clear(),this.elements.forEach(((e,t)=>this._elementsIndexes.set(e,t))),this.emit("refresh");},this.elements=new C;}async load(e){if(f$2(e),!this.spatialReference){const e=this.elements.find((e=>r$1(e.georeference)&&r$1(e.georeference.coords)));this._set("spatialReference",e?e$1(e$1(e.georeference).coords).spatialReference:f$1.WGS84);}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.handles.add(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear();}set elements(e){this._set("elements",n$5(e,this._get("elements"),C));}get fullExtent(){if("not-loaded"===this.loadStatus)return null;const e=this._index.fullBounds;return t(e)?null:new w$2({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){"not-loaded"===this.loadStatus?this._set("spatialReference",e):s$1.getLogger(this.declaredClass).error("#spatialReference","spatialReference cannot be changed after the source is loaded.");}async queryElements(e,t){await this.load(),await _n(e.spatialReference,this.spatialReference,null,t);const s=E$2(e.spatialReference,this.spatialReference)?e:rn(e,this.spatialReference);if(!s)return [];const r=s.normalize(),o=[];for(const n of r)this._index.forEachInBounds(c$3(n),(({normalizedCoords:e,element:t})=>{r$1(e)&&x$1(n,e)&&o.push(t);}));return o.sort(((e,t)=>this._elementsIndexes.get(e)-this._elementsIndexes.get(t))),o}_updateIndexForElement(e,t){const s=e.normalizedBounds,r=this._index.has(e),o=r$1(s);this._index.delete(e),o&&this._index.set(e,s),this.notifyChange("fullExtent"),t||(r!==o?this.emit("refresh"):this.emit("change",{element:e.element}));}};e([y()],b.prototype,"elements",null),e([y({readOnly:!0})],b.prototype,"fullExtent",null),e([y()],b.prototype,"spatialReference",null),b=e([a$2("esri.layers.support.LocalMediaElementSource")],b);const v$1=b;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
function g(e){return "object"==typeof e&&null!=e&&"type"in e}let j=class extends(n$6(t$3(c$4(O$1(b$3))))){constructor(e){super(e),this.effectiveSource=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this.source=new v$1;}load(e){const t=this.source;if(!t)return this.addResolvingPromise(Promise.reject(new s("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer."))),Promise.resolve(this);const s$1=g(t)?new v$1({elements:new j$2([t])}):t;this._set("effectiveSource",s$1),this.spatialReference&&(s$1.spatialReference=this.spatialReference);const i=s$1.load(e).then((()=>{this.spatialReference=s$1.spatialReference;}));return this.addResolvingPromise(i),Promise.resolve(this)}destroy(){e$1(this.effectiveSource)?.destroy(),e$1(this.source)?.destroy();}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}set source(e){"not-loaded"===this.loadStatus?this._set("source",e):s$1.getLogger(this.declaredClass).error("#source","source cannot be changed after the layer is loaded.");}castSource(e){return e?Array.isArray(e)||e instanceof j$2?new v$1({elements:e}):e:null}readSource(e,r,o){const t="image"===r.mediaType?new w:"video"===r.mediaType?new a:null;return t?.read(r,o),t}writeSource(e,r,t,s$1){e&&g(e)&&"image"===e.type?e.write(r,s$1):s$1?.messages&&s$1?.messages?.push(new s("media-layer:unsupported-source","source must be an 'ImageElement'"));}};e([y({readOnly:!0})],j.prototype,"effectiveSource",void 0),e([y({type:String})],j.prototype,"copyright",void 0),e([y({readOnly:!0})],j.prototype,"fullExtent",null),e([y({type:["MediaLayer"]})],j.prototype,"operationalLayerType",void 0),e([y({type:["show","hide"]})],j.prototype,"listMode",void 0),e([y({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1}}})],j.prototype,"source",null),e([s$2("source")],j.prototype,"castSource",null),e([o("source",["url"])],j.prototype,"readSource",null),e([r$2("source")],j.prototype,"writeSource",null),e([y()],j.prototype,"spatialReference",void 0),e([y({readOnly:!0})],j.prototype,"type",void 0),j=e([a$2("esri.layers.MediaLayer")],j);const v=j;

export { v as default };
