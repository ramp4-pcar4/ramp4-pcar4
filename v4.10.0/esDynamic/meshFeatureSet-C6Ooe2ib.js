import{bx as d,aY as N,a1 as b,bn as g,by as D,bz as m,G as M}from"./main-DCIX61zy.js";import{$ as E}from"./Mesh-BvaroTE0.js";import{i as F,a as T}from"./External-BllXL05R.js";import{n as I,i as w}from"./meshFeatureAttributes-DC-71SuC.js";const L=()=>M.getLogger("esri.rest.support.meshFeatureSet");function O(e,s,t){const r=t.features;t.features=[],delete t.geometryType;const n=d.fromJSON(t);if(n.geometryType="mesh",!t.assetMaps)return n;const a=y(s,t.assetMaps),u=e.sourceSpatialReference??N.WGS84,f=t.globalIdFieldName,{outFields:o}=e,l=o!=null&&o.length>0?P(o.includes("*")?null:new Set(o)):()=>({});for(const i of r){const c=h(i,f,u,s,a);n.features.push(new b({geometry:c,attributes:l(i)}))}return n}function P(e){return({attributes:s})=>{if(!s)return{};if(!e)return s;for(const t in s)e.has(t)||delete s[t];return s}}function h(e,s,t,r,n){const a=e.attributes[s],u=n.get(a);if(u==null||!e.geometry)return null;const f=I(e.attributes,t,r.transformFieldRoles),o=g.fromJSON(e.geometry);o.spatialReference=t;const l=w(e.attributes,r.transformFieldRoles),i=t.isGeographic?"local":"georeferenced",c=x(u);return c?E.createWithExternalSource(f,c,{extent:o,transform:l,vertexSpace:i,unitConversionDisabled:!0}):E.createIncomplete(f,{extent:o,transform:l,vertexSpace:i})}var p;function y(e,s){const t=new Map;for(const r of s){const n=r.parentGlobalId;if(n==null)continue;const a=r.assetName,u=r.assetType,f=r.assetHash,o=r.assetURL,l=r.conversionStatus,i=r.seqNo,c=D(u,e.supportedFormats);if(!c){L().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${u}, but it does not list it as a supported type`);continue}const S=m(t,n,()=>({files:new Map}));m(S.files,a,()=>({name:a,type:u,mimeType:c,status:G(l),parts:[]})).parts[i]={hash:f,url:o}}return t}function x(e){const s=Array.from(e.files.values()),t=new Array;for(const r of s){if(r.status!==p.COMPLETED)return null;const n=new Array;for(const a of r.parts){if(!a)return null;n.push(new F(a.url,a.hash))}t.push(new T(r.name,r.mimeType,n))}return t}function G(e){switch(e){case"COMPLETED":case"SUBMITTED":return p.COMPLETED;case"INPROGRESS":return p.PENDING;default:return p.FAILED}}(function(e){e[e.FAILED=0]="FAILED",e[e.PENDING=1]="PENDING",e[e.COMPLETED=2]="COMPLETED"})(p||(p={}));export{y as assetMapFromAssetMapsJSON,h as extractMesh,O as meshFeatureSetFromJSON};
