import{lG as Z,d9 as G,lH as b,lI as D,lJ as W,lK as H,lr as v,lq as K,lL as L,lM as $,b8 as M,lN as O,aN as E,lO as k,lP as z,s as F,du as C,df as B,bS as Q}from"./main-DCIX61zy.js";const x=new G,X=new G,w=new G,A={esriGeometryPoint:b,esriGeometryPolyline:D,esriGeometryPolygon:W,esriGeometryMultipoint:H};function ee(e,r,n,i=e.hasZ,l=e.hasM){if(r==null)return null;const t=e.hasZ&&i,o=e.hasM&&l;if(n){const s=v(w,r,e.hasZ,e.hasM,"esriGeometryPoint",n,i,l);return b(s,t,o)}return b(r,t,o)}function T(e,r,n,i,l,t,o=r,s=n){const u=r&&o,a=n&&s,f=i!=null?"coords"in i?i:i.geometry:null;if(f==null)return null;if(l){let c=K(X,f,r,n,e,l,o,s);return t&&(c=v(w,c,u,a,e,t)),A[e]?.(c,u,a)??null}if(t){const c=v(w,f,r,n,e,t,o,s);return A[e]?.(c,u,a)??null}return Z(x,f,r,n,o,s),A[e]?.(x,u,a)??null}function re(e){return e&&j in e?JSON.parse(JSON.stringify(e,te)):e}const j="_geVersion",te=(e,r)=>e!==j?r:void 0;function V(e,r){return e?r?4:3:r?3:2}function ne(e,r,n,i){if(!r?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const l=e.coords,t=[],o=n?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:s,coords:u}=r,a=V(n,i);let f=0;for(const c of s){const I=le(o,u,f,c,n,i);I&&t.push(I),f+=c*a}if(t.sort((c,I)=>{let p=c[2]-I[2];return p===0&&n&&(p=c[4]-I[4]),p}),t.length){let c=6*t[0][2];l[0]=t[0][0]/c,l[1]=t[0][1]/c,n&&(c=6*t[0][4],l[2]=c!==0?t[0][3]/c:0),(l[0]<o[0]||l[0]>o[1]||l[1]<o[2]||l[1]>o[3]||n&&(l[2]<o[4]||l[2]>o[5]))&&(l.length=0)}if(!l.length){const c=r.lengths[0]?ie(u,0,s[0],n,i):null;if(!c)return null;l[0]=c[0],l[1]=c[1],n&&c.length>2&&(l[2]=c[2])}return e}function le(e,r,n,i,l,t){const o=V(l,t);let s=n,u=n+o,a=0,f=0,c=0,I=0,p=0;for(let R=0,P=i-1;R<P;R++,s+=o,u+=o){const y=r[s],N=r[s+1],S=r[s+2],h=r[u],d=r[u+1],q=r[u+2];let g=y*d-h*N;I+=g,a+=(y+h)*g,f+=(N+d)*g,l&&(g=y*q-h*S,c+=(S+q)*g,p+=g),y<e[0]&&(e[0]=y),y>e[1]&&(e[1]=y),N<e[2]&&(e[2]=N),N>e[3]&&(e[3]=N),l&&(S<e[4]&&(e[4]=S),S>e[5]&&(e[5]=S))}if(I>0&&(I*=-1),p>0&&(p*=-1),!I)return null;const m=[a,f,.5*I];return l&&(m[3]=c,m[4]=.5*p),m}function ie(e,r,n,i,l){const t=V(i,l);let o=r,s=r+t,u=0,a=0,f=0,c=0;for(let I=0,p=n-1;I<p;I++,o+=t,s+=t){const m=e[o],R=e[o+1],P=e[o+2],y=e[s],N=e[s+1],S=e[s+2],h=i?se(m,R,P,y,N,S):oe(m,R,y,N);if(h)if(u+=h,i){const d=ae(m,R,P,y,N,S);a+=h*d[0],f+=h*d[1],c+=h*d[2]}else{const d=ue(m,R,y,N);a+=h*d[0],f+=h*d[1]}}return u>0?i?[a/u,f/u,c/u]:[a/u,f/u]:n>0?i?[e[r],e[r+1],e[r+2]]:[e[r],e[r+1]]:null}function oe(e,r,n,i){const l=n-e,t=i-r;return Math.sqrt(l*l+t*t)}function se(e,r,n,i,l,t){const o=i-e,s=l-r,u=t-n;return Math.sqrt(o*o+s*s+u*u)}function ue(e,r,n,i){return[e+.5*(n-e),r+.5*(i-r)]}function ae(e,r,n,i,l,t){return[e+.5*(i-e),r+.5*(l-r),n+.5*(t-n)]}function ce(e){return e==="mesh"?L:$(e)}function J(e,r){return e?r?4:3:r?3:2}function fe(e,r,n,i){return U(e,r,n,i.coords[0],i.coords[1])}function Ie(e,r,n,i,l,t){const o=J(l,t),{coords:s,lengths:u}=i;if(!u)return!1;for(let a=0,f=0;a<u.length;a++,f+=o)if(!U(e,r,n,s[f],s[f+1]))return!1;return!0}function U(e,r,n,i,l){if(!e)return!1;const t=J(r,n),{coords:o,lengths:s}=e;let u=!1,a=0;for(const f of s)u=pe(u,o,t,a,f,i,l),a+=f*t;return u}function pe(e,r,n,i,l,t,o){let s=e,u=i;for(let a=i,f=i+l*n;a<f;a+=n){u=a+n,u===f&&(u=i);const c=r[a],I=r[a+1],p=r[u],m=r[u+1];(I<o&&m>=o||m<o&&I>=o)&&c+(o-I)/(m-I)*(p-c)<t&&(s=!s)}return s}const _="unsupported-query",me={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},Y={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function ye(e){return e!=null&&Y.spatialRelationship[e]===!0}function Ne(e){return e!=null&&Y.queryGeometry[Q(e)]===!0}function he(e){return e!=null&&Y.layerGeometry[e]===!0}function Se(){return import("./geometryEngineJSON-cnFh4oQ2.js").then(e=>e.g)}function de(e,r,n,i,l){if(M(r)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){const t=O(new G,r,!1,!1);return Promise.resolve(o=>fe(t,!1,!1,o))}if(M(r)&&n==="esriGeometryMultipoint"){const t=O(new G,r,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve(o=>Ie(t,!1,!1,o,i,l))}if(E(r)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve(t=>k(r,T(n,i,l,t)));if(E(r)&&n==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve(t=>z(r,T(n,i,l,t)));if(E(r)&&e==="esriSpatialRelIntersects"){const t=ce(n);return Promise.resolve(o=>t(r,T(n,i,l,o)))}return Se().then(t=>{const o=t[me[e]].bind(null,r.spatialReference,r);return s=>o(T(n,i,l,s))})}async function Re(e,r,n){const{spatialRel:i,geometry:l}=e;if(l){if(!ye(i))throw new F(_,"Unsupported query spatial relationship",{query:e});if(C(l.spatialReference)&&C(n)){if(!Ne(l))throw new F(_,"Unsupported query geometry type",{query:e});if(!he(r))throw new F(_,"Unsupported layer geometry type",{query:e});if(e.outSR)return B(e.geometry?.spatialReference,e.outSR)}}}function ge(e){if(E(e))return!0;if(M(e)){for(const r of e.rings)if(r.length!==5||r[0][0]!==r[1][0]||r[0][0]!==r[4][0]||r[2][0]!==r[3][0]||r[0][1]!==r[3][1]||r[0][1]!==r[4][1]||r[1][1]!==r[2][1])return!1;return!0}return!1}async function Ge(e,r){if(!e)return null;const n=r.featureAdapter,{startTimeField:i,endTimeField:l}=e;let t=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(i&&l)await r.forEach(s=>{const u=n.getAttribute(s,i),a=n.getAttribute(s,l);u==null||isNaN(u)||(t=Math.min(t,u)),a==null||isNaN(a)||(o=Math.max(o,a))});else{const s=i||l;await r.forEach(u=>{const a=n.getAttribute(u,s);a==null||isNaN(a)||(t=Math.min(t,a),o=Math.max(o,a))})}return{start:t,end:o}}function Te(e,r,n){if(!r||!e)return null;const{startTimeField:i,endTimeField:l}=e;if(!i&&!l)return null;const{start:t,end:o}=r;if(t===null&&o===null)return null;if(t===void 0&&o===void 0)return be();const s=n.getAttributeAsTimestamp?.bind(n)??n.getAttribute.bind(n);return i&&l?Pe(s,i,l,t,o):Ee(s,i||l,t,o)}function Pe(e,r,n,i,l){return i!=null&&l!=null?t=>{const o=e(t,r),s=e(t,n);return(o==null||o<=l)&&(s==null||s>=i)}:i!=null?t=>{const o=e(t,n);return o==null||o>=i}:l!=null?t=>{const o=e(t,r);return o==null||o<=l}:void 0}function Ee(e,r,n,i){return n!=null&&i!=null&&n===i?l=>e(l,r)===n:n!=null&&i!=null?l=>{const t=e(l,r);return t!=null&&t>=n&&t<=i}:n!=null?l=>{const t=e(l,r);return t!=null&&t>=n}:i!=null?l=>{const t=e(l,r);return t!=null&&t<=i}:void 0}function be(){return()=>!1}export{ge as I,de as P,T as a,Ge as b,re as h,ne as n,Te as t,Re as v,ee as y};
