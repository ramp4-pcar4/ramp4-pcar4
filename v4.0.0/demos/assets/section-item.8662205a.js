import{h4 as c,g as u,he as n,hf as o,hc as g,h6 as p,gv as h,hg as d}from"./main.efb50b2c.js";var y=(s=>(s.Visibility="visibilityButton",s.Expand="expandButton",s))(y||{}),_=(s=>(s.Item="item",s.Placeholder="placeholder",s.Error="error",s))(_||{});class b extends c{_uid;_name;_type;_children=[];_parent=void 0;_loadPromise;_hidden;_expanded;_visibility;_exclusive;_controls;_disabledControls;_lastVisible;_visibleChildren;constructor(i,e,t){super(i),this._uid=u.sharedUtils.generateUUID(),this._name=e.name,this._type=e.type??"placeholder",this._parent=t,this._children=[],this._loadPromise=new n,this._hidden=e.hidden??!1,this._expanded=e.expanded??!0,this._visibility=!0,this._exclusive=e.exclusive??!1,this._controls=e.controls?.slice()??["visibilityButton","expandButton"],this._disabledControls=e.disabledControls?.slice(),this._lastVisible,this._visibleChildren=[]}get uid(){return this._uid}get name(){return this._name}set name(i){this._name=i}get type(){return this._type}get children(){return this._children}set children(i){this._children=i}get parent(){return this._parent}set parent(i){this._parent=i}get loadPromise(){return this._loadPromise.getPromise()}get hidden(){return this._hidden}get expanded(){return this._expanded}get visibility(){return this._visibility}get exclusive(){return this._exclusive}controlAvailable(i){return this._disabledControls?.includes(i)?!1:this._controls?.includes(i)}setControl(i,e){e&&this._disabledControls?.includes(i)?(this._disabledControls=this._disabledControls.filter(t=>t!==i),this._controls?.push(i)):!e&&this._controls?.includes(i)&&(this._controls=this._controls.filter(t=>t!==i),this._disabledControls?.push(i))}toggleHidden(i){this._hidden=i??!this.hidden}toggleExpanded(i){this._expanded=i??!this.expanded}toggleVisibility(i,e=!0){if(this.visibility!==i){if(this._visibility=i??!this.visibility,!this.exclusive)this.visibility?this._visibleChildren.length>0?this._visibleChildren.forEach(t=>t.toggleVisibility(!0,!1)):this.children.forEach(t=>t.toggleVisibility(!0,!1)):this.children.forEach(t=>t.toggleVisibility(!1,!1));else if(this.visibility)if(this._lastVisible&&(!(this._lastVisible instanceof l)||this._lastVisible.layerControlAvailable(o.Visibility)))this._lastVisible.toggleVisibility(!0);else{const t=this.children.find(r=>!(r instanceof l)||r.layerControlAvailable(o.Visibility));t&&t.toggleVisibility(!0)}else this._lastVisible=this.children.find(t=>t.visibility),this._lastVisible?.toggleVisibility(!1);this.parent&&e&&this.parent.checkVisibility(this)}}checkVisibilityRules(){this.parent&&!this.parent.visibility?this.toggleVisibility(!1,!1):this.parent?.exclusive&&this.parent.children.some(e=>e.visibility&&e!==this&&e.type==="item")&&this.toggleVisibility(!1,!1)}checkVisibility(i){this instanceof l&&!this.layerControlAvailable(o.Visibility)||(this.exclusive?i.visibility?(this.children.forEach(e=>{e.uid!==i.uid&&e.toggleVisibility(!1,!1)}),this._lastVisible=i,this._visibility=!0,this instanceof l&&this.layer&&this.layer.layerExists&&(this.layer.visibility=!0)):(this._visibility=!1,this instanceof l&&this.layer&&this.layer.layerExists&&(this.layer.visibility=!1),this._lastVisible=i):this.children.some(e=>e.visibility)?(this._visibility=!0,this._visibleChildren=this.children.filter(e=>e.visibility),this instanceof l&&this.layer&&this.layer.layerExists&&(this.layer.visibility=!0)):(this._visibility=!1,this._visibleChildren=[],this instanceof l&&this.layer&&this.layer.layerExists&&(this.layer.visibility=!1)),this.parent&&this.parent.checkVisibility(this))}getConfig(){const i={name:this._name,hidden:this._hidden,expanded:this._expanded,exclusive:this._exclusive,controls:this._controls,disabledControls:this._disabledControls},e=[];return this.children.forEach(t=>{e.push(t.getConfig())}),this.exclusive?i.exclusiveVisibility=e:i.children=e,i}onAdded(){}onRemoved(){this.toggleVisibility(!1)}load(){this._type="item",this._loadPromise.resolveMe(),this.checkVisibilityRules()}reload(){this._type="placeholder",this._loadPromise=new n}error(){this._type="error",this._loadPromise.rejectMe(),this.checkVisibilityRules()}}class l extends b{_layerId;_layerIdx;_layerUid="";_layer;_layerRedrawing=!1;_layerInitVis;_loadCancelled=!1;_treeGrown=!1;_coverIcon;_description;_symbologyExpanded;_origLayerControls;_origLayerDisabledControls;_layerControls;_layerDisabledControls;handlers=[];constructor(i,e,t,r){super(i,e,t),this._type=_.Placeholder,this._layerId=e.layerId,this._layerIdx=e.sublayerIndex,this._layerControls=e.layerControls??[],this._origLayerControls=e.layerControls,this._layerDisabledControls=e.disabledLayerControls??[],this._origLayerDisabledControls=e.disabledLayerControls,this._layerRedrawing=!1,this._symbologyExpanded=e.symbologyExpanded||!1,e.coverIcon&&(this._coverIcon=e.coverIcon),e.description&&(this._description=e.description)}get parentLayerId(){return this._layerIdx?this._layerId.slice(0,this._layerId.length-`-${this._layerIdx}`.length):void 0}get layerId(){return this._layerId}get layerIdx(){return this._layerIdx}get layerUid(){return this._layerUid}get layer(){return this._layer}set layer(i){this._layer=i,this._layerId=i.id,this._layerIdx=i.layerIdx,this._layerUid=i.uid,this.updateLayerControls()}get layerRedrawing(){return this._layerRedrawing}set layerRedrawing(i){this._layerRedrawing=i}get coverIcon(){return this._coverIcon}set coverIcon(i){this._coverIcon=i}get description(){return this._description}set description(i){this._description=i}get symbologyExpanded(){return this._symbologyExpanded}get treeGrown(){return this._treeGrown}set treeGrown(i){this._treeGrown=i}get loadCancelled(){return this._loadCancelled}set loadCancelled(i){this._loadCancelled=i}get origLayerControls(){return this._origLayerControls}get origDisabledLayerControls(){return this._origLayerDisabledControls}getConfig(){const i={layerId:this._layerId,sublayerIndex:this._layerIdx,layerControls:this._layerControls,disabledLayerControls:this._layerDisabledControls,symbologyExpanded:this._symbologyExpanded,coverIcon:this._coverIcon,description:this._description};return{...super.getConfig(),...i}}toggleVisibility(i,e=!0,t=!1){if(!((!this.layerControlAvailable(o.Visibility)||this._loadCancelled)&&!t)&&(super.toggleVisibility(i,e),this.layer&&this.layer.layerExists)){this.layer.visibility=this.visibility;const r=this.layer.legend.some(a=>a.lastVisbility);this.layer.legend.forEach(a=>{r||(a.lastVisbility=!0),a.visibility=this.visibility?a.lastVisbility:!1})}}toggleSymbology(i){return this._symbologyExpanded=i??!this._symbologyExpanded,this._symbologyExpanded}setSymbologyVisibility(i,e){this._layer?.legend.some(t=>((i===void 0||t.uid===i)&&(t.visibility=e,t.lastVisbility=e),i!==void 0&&t.uid===i))}load(i){if(i){if(this._layer=i instanceof g?i:this.$iApi.geo.layer.getLayer(this._layerId??this._layerUid),this.layer=i,this._loadCancelled){this.toggleVisibility(!1,!0,!0);return}this._layer?.loadPromise().then(()=>{this._layer?.layerType===p.MAPIMAGE&&!this._layerIdx?(this.error(),console.error(`MapImageLayer has no sublayerIndex defined for layer: ${this._layerId}.`)):(this._layerInitVis=this._layerInitVis?this._visibility:i.visibility,super.load(),this.toggleVisibility(this._layerInitVis,!0,!0),i.visibility||this.setSymbologyVisibility(void 0,!1)),this.handlers.push(this.$iApi.event.on(h.LAYER_VISIBILITYCHANGE,e=>{e.layer.uid===this.layer.uid&&this.toggleVisibility(e.visibility,!0,!0)})),this.handlers.push(this.$iApi.event.on(h.LAYER_DRAWSTATECHANGE,e=>{this.layer.uid===e.layer.uid&&(e.layer.drawState===d.REFRESH?this.layerRedrawing=!0:setTimeout(()=>{this.layerRedrawing=e.layer.drawState===d.REFRESH},500))}))}).catch(()=>{this.error()})}}error(){this.updateLayerControls(),super.error(),this.toggleVisibility(!1,!0,!0)}layerControlAvailable(i){return this._layerDisabledControls?.includes(i)?!1:!!this._layerControls?.includes(i)}updateLayerControls(){const i=this.$iApi.geo.layer.getLayerControls(this.layerId)??this.$iApi.geo.layer.getLayerControls(this.parentLayerId??"");this._origLayerControls||(this._layerControls=i?.controls??[]),this._origLayerDisabledControls||(this._layerDisabledControls=i?.disabledControls??[])}}var f=(s=>(s.Title="title",s.Text="text",s.Image="image",s.Markdown="markdown",s.Template="template",s))(f||{});class C extends b{_infoType;_content;constructor(i,e,t){super(i,e,t),this._infoType=e.infoType??"title",this._content=e.content??"",e.infoType==="template"&&this.$element.component(`${this._uid}-info-section`,{template:this._content}),(e.infoType||e.content)&&(this._controls=e.controls?.slice()??[y.Expand]),super.load()}get infoType(){return this._infoType}get content(){return this._content}set content(i){this._content=i}getConfig(){const i={infoType:this._infoType,content:this._content};return{...super.getConfig(),...i}}}export{f as I,l as L,C as S,b as a,_ as b,y as c};
