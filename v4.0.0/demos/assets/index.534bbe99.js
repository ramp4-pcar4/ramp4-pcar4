import{gA as l,hl as f,h6 as y,gw as u,hm as $,hj as M,hn as A,gC as m,ho as b,gs as E,g6 as x,gv as h,gL as _,g7 as C,gg as L,g9 as d,gf as v,gc as p,ge as w,gd as B,gh as G,gQ as g,gk as I,gl as z}from"./main.efb50b2c.js";import"./preload-helper.387dac8f.js";class S{mapConfig=void 0;basemaps={};startMinimized=!0;expandFactor=1.5;borderColour="#FF0000";borderWidth=1;areaColour="#000000";areaOpacity=.25}const P={},V={updateIntialBasemap:(t,e)=>{t.commit("SET_INITIAL_BASEMAP",e)}},T={SET_INITIAL_BASEMAP:(t,e)=>{t.mapConfig.initialBasemapId=e}};var s=(t=>(t.mapConfig="overviewmap/mapConfig",t.basemaps="overviewmap/basemaps",t.startMinimized="overviewmap/startMinimized",t.expandFactor="overviewmap/expandFactor",t.borderColour="overviewmap/borderColour",t.borderWidth="overviewmap/borderWidth",t.areaColour="overviewmap/areaColour",t.areaOpacity="overviewmap/areaOpacity",t.updateIntialBasemap="overviewmap/updateIntialBasemap!",t))(s||{});function O(){const t=new S;return{namespaced:!0,state:t,getters:{...P},actions:{...V,...l.actions(t)},mutations:{...T,...l.mutations(t)}}}class F extends f{overviewGraphicLayer;constructor(e){super(e),this.overviewGraphicLayer=this.$iApi.geo.layer.createLayer({id:"RampOverviewGraphic",layerType:y.GRAPHIC,url:"",cosmetic:!0})}createMapView(e){if(!e)throw new Error("Attempted to create overview map view without a basemap");const a=typeof e=="string"?this.findBasemap(e):e;this.applyBasemap(a),this._rampExtentSet=this.$iApi.geo.map.getExtentSet().clone(),this._rampSR=this._rampExtentSet.sr.clone();const r=this.$iApi.$vApp.$store.get(s.expandFactor);this.esriView=u(new $({map:this.esriMap,container:this._targetDiv,constraints:{rotationEnabled:!1},spatialReference:this._rampSR.toESRI(),extent:this.$iApi.geo.map.getExtent().toESRI().expand(r)})),this.esriView.ui.components=[],this.handlers.push({type:"mouse-wheel",handler:this.esriView.on("mouse-wheel",i=>{i.stopPropagation()})}),this.handlers.push({type:"double-click",handler:this.esriView.on("double-click",i=>{i.stopPropagation()})}),this.handlers.push({type:"key-down",handler:this.esriView.on("key-down",i=>{i.stopPropagation()})}),this.handlers.push({type:"key-up",handler:this.esriView.on("key-up",i=>{i.stopPropagation()})}),this.handlers.push({type:"drag",handler:this.esriView.on("drag",i=>{i.stopPropagation(),this.mapDrag(i)})}),this.esriView.container.addEventListener("touchmove",i=>{i.preventDefault()}),this._viewPromise.resolveMe(),this.created=!0}async addMapGraphicLayer(){if(!this.esriMap){this.noMapErr();return}const e=new M(this.$iApi.geo.map.getExtent(),"overview-graphic"),a=this.$iApi.$vApp.$store.get(s.borderColour)??"#FF0000",r=this.$iApi.$vApp.$store.get(s.borderWidth)??1,i=this.$iApi.$vApp.$store.get(s.areaColour)??"#000000",n=this.$iApi.$vApp.$store.get(s.areaOpacity)??.25,o=`${i}${Math.round(n*255).toString(16)}`;e.style=new A({fill:{colour:o},outline:{colour:a,width:r}}),await this.overviewGraphicLayer.initiate(),await this.overviewGraphicLayer.addGraphic(e),this.esriMap?.add(this.overviewGraphicLayer.esriLayer)}removeMapGraphicLayer(){if(!this.esriMap){this.noMapErr();return}if(!this.overviewGraphicLayer.esriLayer)throw new Error("Attempted to remove layer from the map without an esri layer. Likely layer.initiate() was not called or had not finished.");this.overviewGraphicLayer.removeGraphic(),this.overviewGraphicLayer.terminate(),this.esriMap.remove(this.overviewGraphicLayer.esriLayer)}destroyMapView(){this.esriView?.container.removeEventListener("touchmove",e=>{e.preventDefault()}),this.removeMapGraphicLayer(),super.destroyMapView()}findBasemap(e){const a=this._basemapStore.find(r=>r.id===e);if(a)return a;{const r=this.$iApi.$vApp.$store.get(m.getMapConfig);if(r){const i=r.basemaps.find(n=>n.id===e);if(i)return new b(i)}}throw new Error(`Invalid basemap id requested: ${e}`)}setBasemap(e){if(!this.esriView||!this.esriMap)return this.noMapErr(),!1;const a=this.findBasemap(e),i=(this.getCurrentBasemapId()?this.findBasemap(this.getCurrentBasemapId()):void 0)?.tileSchemaId!==a.tileSchemaId;return i?(this.destroyMapView(),this.createMapView(a),this.addMapGraphicLayer()):this.applyBasemap(a),i}startExtent=null;async mapDrag(e){if(e.native.pointerType==="mouse"){if(e.action==="start")await this.cursorHitTest(e)&&(this.startExtent=u(this.overviewGraphicLayer.getEsriGraphic("overview-graphic").geometry));else if(this.startExtent){const a=this.esriView.toMap(e.origin),r=this.esriView.toMap({x:e.x,y:e.y}),i=this.startExtent.clone().offset(r.x-a.x,r.y-a.y,0);this.overviewGraphicLayer.getEsriGraphic("overview-graphic").geometry=i,e.action==="end"&&(this.$iApi.geo.map.zoomMapTo(this.$iApi.geo.geom.geomEsriToRamp(i),void 0,!1),this.startExtent=null)}}}updateOverview(e){const a=this.$iApi.$vApp.$store.get(s.expandFactor),r=this.zoomMapTo(e.expand(a),void 0,!1),i=this.overviewGraphicLayer.getLocalGraphic("overview-graphic");return this.overviewGraphicLayer.removeGraphic(i),i.geometry=e,this.overviewGraphicLayer.addGraphic(i),r}async cursorHitTest(e){return(await this.esriView.hitTest(e)).results.length>0}}class R extends E{_parseConfig(e){this.$vApp.$store.set(s.basemaps,e?.basemaps||{}),this.$vApp.$store.set(s.mapConfig,{basemaps:e?Object.values(e.basemaps):[]}),this.$vApp.$store.set(s.startMinimized,e?.startMinimized??!0),this.$vApp.$store.set(s.expandFactor,e?.expandFactor??1.5),this.$vApp.$store.set(s.borderColour,e?.borderColour),this.$vApp.$store.set(s.borderWidth,e?.borderWidth),this.$vApp.$store.set(s.areaColour,e?.areaColour),this.$vApp.$store.set(s.areaOpacity,e?.areaOpacity)}get config(){return super.config}}const k=x({name:"OverviewmapV",data(){return{mapConfig:this.get(s.mapConfig),basemaps:this.get(s.basemaps),startMinimized:this.get(s.startMinimized),overviewMap:new F(this.$iApi),minimized:!0,hoverOnExtent:!1,handlers:[]}},mounted(){this.$iApi.geo.map.viewPromise.then(async()=>{this._adaptBasemap(),this.overviewMap.createMap(this.mapConfig,this.$el.querySelector(".overviewmap")),await this.overviewMap.addMapGraphicLayer(),this.minimized=this.startMinimized;let t=this.overviewMap.updateOverview(this.$iApi.geo.map.getExtent());this.handlers.push(this.$iApi.event.on(h.MAP_EXTENTCHANGE,_(100,e=>{t.then(()=>this.overviewMap.updateOverview(e))}))),this.handlers.push(this.$iApi.event.on(h.MAP_CREATED,()=>{this._adaptBasemap()})),this.handlers.push(this.$iApi.event.on(h.MAP_REFRESH_END,()=>{this._adaptBasemap()})),this.handlers.push(this.$iApi.event.on(h.MAP_BASEMAPCHANGE,e=>{if(!e.schemaChanged&&this.overviewMap.created){const a=this.$iApi.$vApp.$store.get(m.getActiveBasemapConfig);a&&this.basemaps[a.tileSchemaId]===void 0&&this.overviewMap.setBasemap(e.basemapId)}}))})},beforeUnmount(){this.handlers.forEach(t=>this.$iApi.event.off(t)),this.overviewMap.destroyMap(),this.overviewMap=void 0,delete this.overviewMap},methods:{async cursorHitTest(t){this.hoverOnExtent=!this.minimized&&await this.overviewMap.cursorHitTest(t)},mapStyle(){return{height:`${this.minimized?48:200}px`,width:`${this.minimized?48:200}px`}},toggleStyle(){return{top:`${this.minimized?-6:-3}px`,right:`${this.minimized?-6:-3}px`,transform:`rotate(${this.minimized?225:45}deg)`}},_adaptBasemap(){const t=this.$iApi.$vApp.$store.get(m.getActiveBasemapConfig);if(!t){console.error("Overview Map could not obtain the basemap config used by the main map");return}try{const e=t?.tileSchemaId;if(!e)throw new Error("Overview Map could not obtain the tile schema of the main map");const a=this.basemaps[e];if(!a)throw new Error("Overview Map could not find a suitable basemap that matches the tile schema of the main map");this.overviewMap.created||this.$iApi.$vApp.$store.set(s.updateIntialBasemap,a.id),this.overviewMap.created&&this.overviewMap.viewPromise.then(()=>this.overviewMap.setBasemap(a.id))}catch{this.overviewMap.created||this.$iApi.$vApp.$store.set(s.updateIntialBasemap,t.id),this.overviewMap.viewPromise.then(()=>this.overviewMap.setBasemap(t.id))}}}}),N=t=>(I("data-v-b770d8e4"),t=t(),z(),t),H={class:"relative"},W={class:"relative h-full w-full overflow-hidden"},j={class:"absolute h-30 w-30 top-0 right-0"},D=["content"],q=N(()=>p("g",{id:"apple-keyboard-control"},[p("path",{d:"M 19.7782,11.7782L 18.364,13.1924L 12,6.82843L 5.63604,13.1924L 4.22183,11.7782L 12,4L 19.7782,11.7782 Z "})],-1)),Q=[q];function U(t,e,a,r,i,n){const o=L("tippy");return d(),v("div",H,[p("div",{style:g(t.mapStyle()),class:"pointer-events-auto absolute top-0 right-0 mt-12 mr-12 shadow-tm border-4 border-solid border-white bg-white transition-all duration-300 ease-out"},[w(" map "),p("div",W,[p("div",{class:B(["overviewmap absolute top-0 right-0 h-192 w-192",{"cursor-move":t.hoverOnExtent}]),onMousemove:e[0]||(e[0]=(...c)=>t.cursorHitTest&&t.cursorHitTest(...c))},null,34)]),w(" toggle "),p("div",j,[G((d(),v("button",{type:"button",tabindex:"0",class:"cursor-pointer absolute h-full w-full",onClick:e[1]||(e[1]=c=>t.minimized=!t.minimized),content:t.$t(t.minimized?"overviewmap.expand":"overviewmap.minimize")},[(d(),v("svg",{class:"absolute fill-current text-gray-500 transition-all duration-300 ease-out",style:g(t.toggleStyle()),xmlns:"http://www.w3.org/2000/svg",fit:"",height:"100%",width:"100%",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",focusable:"false"},Q,4))],8,D)),[[o,{placement:"left",hideOnClick:!1}]])])],4)])}var X=C(k,[["render",U],["__scopeId","data-v-b770d8e4"],["__file","/home/runner/work/ramp4-pcar4/ramp4-pcar4/src/fixtures/overviewmap/overviewmap.vue"]]),Y={en:{"overviewmap.expand":"Expand Overview","overviewmap.minimize":"Minimize Overview"},fr:{"overviewmap.expand":"D\xE9velopper l\u2019aper\xE7u","overviewmap.minimize":"R\xE9duire l\u2019aper\xE7u"}};class K extends R{added(){this.$vApp.$store.registerModule("overviewmap",O()),Object.entries(Y).forEach(o=>this.$vApp.$i18n.mergeLocaleMessage(...o)),this._parseConfig(this.config);const e=this.$vApp.$watch(()=>this.config,o=>this._parseConfig(o)),{vNode:a,destroy:r,el:i}=this.mount(X,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(i.childNodes[0]),this.removed=()=>{e(),this.$vApp.$store.unregisterModule("overviewmap"),r()}}}export{K as default};
