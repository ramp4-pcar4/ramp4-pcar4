import{gs as u,h6 as y,hc as p,g6 as m,g7 as f,g8 as v,g9 as L,ga as b,gb as I,gc as c,gw as A}from"./main.efb50b2c.js";import{L as g,l as _}from"./legend-store.85c8c4ec.js";import{S as $,L as a,a as x}from"./section-item.8662205a.js";import w from"./screen.bb84f7d4.js";import"./preload-helper.387dac8f.js";class S extends u{_parseConfig(e){const t=e?.headerControls?.slice()??["wizard","layerReorder","groupToggle","visibilityToggle"];if(this.$vApp.$store.set(g.headerControls,t),!e||!e.root.children)return;this.handlePanelWidths(["legend"]);const r=this.getLayerFixtureConfigs();e.root.children.forEach(n=>{n.layerLegendConfigs=r,this.addItem(n)}),this.$iApi.geo.layer.allLayers().forEach(n=>{this.updateLegend(n)}),this.$iApi.geo.layer.allErrorLayers().forEach(n=>{this.updateLegend(n)})}createItem(e,t){let r;e.layerId===void 0?r=new $(this.$iApi,e,t):(e.sublayerIndex!==void 0&&(e.layerId=`${e.layerId}-${e.sublayerIndex}`),r=new a(this.$iApi,e,t));const n=e.children;return n&&n.forEach(l=>{e.layerLegendConfigs!==void 0&&(l.layerLegendConfigs=e.layerLegendConfigs),r.children.push(this.createItem(l,r))}),r}addItem(e,t){const r=e instanceof x?e:this.createItem(e,t);return this._insertItem(r,t),r}async addLayerItem(e,t){const r=new a(this.$iApi,{layerId:e.id,sublayerIndex:e.layerIdx!==-1?e.layerIdx:void 0,name:e.name},t,e);return e.supportsSublayers&&(await e.loadPromise(),e.getLayerTree().children.map(n=>this._treeWalker(e,n)).map(n=>this.addItem(n,r))),r.treeGrown=!0,this._insertItem(r,t),r}get config(){return super.config}getLegend(){return this.$vApp.$store.get(g.children)||[]}getLegendConfig(){return{root:{children:this.getLegend().map(e=>e.getConfig())}}}getItem(e){const t=this.getLegend();let r;return t.some(n=>(r=this._searchTree(n,l=>l.uid===e),r!==void 0)),r}getLayerItem(e){let t=typeof e=="string"?e:e.id;const r=this.getLegend();let n;return r.some(l=>(n=this._searchTree(l,i=>i instanceof a&&i.layerId===t),n!==void 0)),n===void 0&&(t=typeof e=="string"?e:e.uid,r.some(l=>(n=this._searchTree(l,i=>i instanceof a&&i.layerUid===t),n!==void 0))),n}getAllExpanded(e){const t=this.getLegend(),r=[],n=e??!0;return t.forEach(l=>{r.push(...this._searchTreeAll(l,i=>i.children.length>0&&i.expanded===n))}),r}getAllVisible(e){const t=this.getLegend(),r=[],n=e??!0;return t.forEach(l=>{r.push(...this._searchTreeAll(l,i=>i.visibility===n))}),r}updateLegend(e){const t=(r,n)=>{const l=this.getLayerItem(r);n?(l&&r instanceof p&&(l.layer=r),l?.error()):l?.load(r instanceof p?r:void 0)};e.loadPromise().then(()=>{let r=this.getLayerItem(e);if(r?.loadCancelled){t(e,!1);return}if(e.layerType===y.MAPIMAGE){const n=l=>{if(l.isLayerRoot&&!l.isLogicalLayer)r=this.getLayerItem(e),t(e,!1),r&&!r.treeGrown&&(l.children.map(i=>this._treeWalker(e,i)).map(i=>this.addItem(i,r)),r.treeGrown=!0),l.children.forEach(i=>n(i));else if(!l.isLayerRoot&&!l.isLogicalLayer){if(r=this.getLayerItem(`${e.id}-${l.layerIdx}`),r){const i=r.getConfig();delete i.layerId,delete i.sublayerIndex,delete i.children;const s={...this._treeWalker(e,l),...i},o=this.createItem(s);this._replaceItem(r,o)}l.children.forEach(i=>n(i))}else l.isLogicalLayer&&t(this._treeWalker(e,l).layer,!1)};n(e.getLayerTree())}else t(e,!1)}).catch(()=>{t(e,!0),e.supportsSublayers&&e.config.sublayers.forEach(r=>{t(`${e.id}-${r.index}`,!0)})})}expandItems(e,t){const r=this.getLegend(),n=t===void 0?r:t.children;t!==void 0&&this._toggleState(t,{expanded:e}),n.forEach(l=>{this._toggleState(l,{expanded:e})})}showItems(e,t){const r=this.getLegend(),n=t===void 0?r:t.children;t!==void 0&&this._toggleState(t,{visibility:e}),n.forEach(l=>{this._toggleState(l,{visibility:e})})}reloadLayerItem(e){const t=this.getLayerItem(e);return t?t instanceof a?(t._loadCancelled=!1,t.reload(),!0):(console.warn("reloading is not supported for non layer items"),!1):!1}removeItem(e){const t=typeof e=="string"?this.getItem(e):e;return t!==void 0?this._deleteItem(t):!1}removeLayerItem(e){const t=this.getLayerItem(e);return t!==void 0?this._deleteItem(t):!1}_searchTree(e,t){if(t(e))return e;{let r;return e.children.some(n=>(r=this._searchTree(n,t),r!==void 0)),r}}_searchTreeAll(e,t){const r=[],n=[e];for(;n.length>0;){const l=n.shift();l&&t(l)&&r.push(l),l&&n.push(...l.children)}return r}_toggleState(e,t){const r=t.visibility,n=t.expanded;r!==void 0&&e.toggleVisibility(r),n!==void 0&&e.children.length>0&&e.toggleExpanded(n),e.children&&e.children.length>0&&e.children.forEach(l=>{this._toggleState(l,t)})}_insertItem(e,t){this.$iApi.$vApp.$store.dispatch(g.addItem,{item:e,parent:t})}_deleteItem(e){return e.children.length>0&&e.children.forEach(t=>{t.parent=e.parent,this._insertItem(t,e.parent)}),e instanceof a&&e.handlers.forEach(t=>this.$iApi.event.off(t)),this.$iApi.$vApp.$store.dispatch(g.removeItem,e),!0}_replaceItem(e,t){this.$iApi.$vApp.$store.dispatch(g.replaceItem,{oldItem:e,newItem:t})}_treeWalker(e,t,r){const l=(s=>{const o=[e];for(;o.length>0;){const d=o.shift();if(d&&d.uid===s)return d;d&&o.push(...d.sublayers)}})(t.uid),i={};return t.isLayerRoot&&!t.isLogicalLayer?(i.layer=l,i.name=l.name,i.children=t.children.map(s=>this._treeWalker(e,s,r))):!t.isLayerRoot&&!t.isLogicalLayer?(i.name=t.name,i.children=t.children.map(s=>this._treeWalker(e,s,r))):t.isLogicalLayer&&(i.layer=l,i.name=l.name,i.layerId=l.id,i.sublayerIndex=e.layerIdx===-1?void 0:e.layerIdx),{...i,...r}}}const E=m({name:"LegendNavButtonV",methods:{togglePanel(){this.$iApi.panel.toggle("legend")}}}),T=c("svg",{class:"fill-current w-32 h-20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[c("path",{d:"M0 0h24v24H0z",fill:"none"}),c("path",{d:"M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"})],-1);function C(h,e,t,r,n,l){const i=v("mapnav-button");return L(),b(i,{onClickFunction:h.togglePanel,tooltip:h.$t("legend.title")},{default:I(()=>[T]),_:1},8,["onClickFunction","tooltip"])}var M=f(E,[["render",C],["__file","/home/runner/work/ramp4-pcar4/ramp4-pcar4/src/fixtures/legend/nav-button.vue"]]),R={en:{"legend.title":"Legend","legend.header.addlayer":"Add Layer","legend.header.reorderlayers":"Reorder Layers","legend.header.groups":"Toggle Groups","legend.header.groups.expand":"Expand All","legend.header.groups.collapse":"Collapse All","legend.header.visible":"Toggle Visibility","legend.header.visible.show":"Show All","legend.header.visible.hide":"Hide All","legend.group.expand":"Expand Group","legend.group.collapse":"Collapse Group","legend.visibility.showLayer":"Show layer","legend.visibility.hideLayer":"Hide layer","legend.visibility.showSymbol":"Show symbol","legend.visibility.hideSymbol":"Hide symbol","legend.visibility.showGroup":"Show group","legend.visibility.hideGroup":"Hide group","legend.symbology.expand":"Expand legend","legend.symbology.hide":"Hide legend","legend.symbology.loading":"Loading...","legend.layer.data":"Show more data","legend.layer.options":"More options","legend.layer.controls.metadata":"Metadata","legend.layer.controls.settings":"Settings","legend.layer.controls.datatable":"Datatable","legend.layer.controls.symbology":"Legend","legend.layer.controls.boundaryzoom":"Zoom to Layer Boundary","legend.layer.controls.cancel":"Cancel","legend.layer.controls.remove":"Remove","legend.layer.controls.reload":"Reload","legend.alert.symbologyExpanded":"Layer legend expanded","legend.alert.symbologyCollapsed":"Layer legend collapsed","legend.alert.groupExpanded":"Legend group expanded","legend.alert.groupCollapsed":"Legend group collapsed","legend.alert.layerAdded":"{name} layer added to legend","legend.alert.layerRemoved":"{name} layer removed from legend"},fr:{"legend.title":"L\xE9gende","legend.header.addlayer":"Ajouter une couche","legend.header.reorderlayers":"R\xE9organiser les couches","legend.header.groups":"Basculer les Groupes","legend.header.groups.expand":"\xC9largir les groupes","legend.header.groups.collapse":"R\xE9duire les groupes","legend.header.visible":"Basculer la Visibilit\xE9","legend.header.visible.show":"Montrer tout","legend.header.visible.hide":"Cacher tout","legend.group.expand":"D\xE9velopper un groupe","legend.group.collapse":"R\xE9duire un groupe","legend.visibility.showLayer":"Afficher la couche","legend.visibility.hideLayer":"Masquer la couche","legend.visibility.showSymbol":"Afficher le symbole","legend.visibility.hideSymbol":"Masquer le symbole","legend.visibility.showGroup":"Afficher le groupe","legend.visibility.hideGroup":"Masquer le groupe","legend.symbology.expand":"D\xE9velopper la l\xE9gende","legend.symbology.hide":"Masquer la l\xE9gende","legend.symbology.loading":"Chargement en cours...","legend.layer.data":"Afficher plus de donn\xE9es","legend.layer.options":"Plus d'options","legend.layer.controls.metadata":"M\xE9tadonn\xE9es","legend.layer.controls.settings":"Param\xE8tres","legend.layer.controls.datatable":"Tableau de donn\xE9es","legend.layer.controls.symbology":"L\xE9gende","legend.layer.controls.boundaryzoom":"Zoomer \xE0 la limite","legend.layer.controls.cancel":"Annuler","legend.layer.controls.remove":"Retirer","legend.layer.controls.reload":"Recharger","legend.alert.symbologyExpanded":"L\xE9gende de la couche d\xE9velopp\xE9e","legend.alert.symbologyCollapsed":"L\xE9gende de la couche r\xE9duite","legend.alert.groupExpanded":"Groupe de l\xE9gende d\xE9velopp\xE9","legend.alert.groupCollapsed":"Groupe de l\xE9gende r\xE9duit","legend.alert.layerAdded":"{name} couche ajout\xE9e \xE0 la l\xE9gende","legend.alert.layerRemoved":"Couche {name} retir\xE9 de la l\xE9gende"}};class N extends S{added(){this.$iApi.component("legend-nav-button",M),this.$iApi.panel.register({legend:{screens:{"legend-screen":A(w)},style:{width:"350px"},alertName:"legend.title",button:{tooltip:"legend.title",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none" /><path d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z" /></svg>'}}},{i18n:{messages:R}}),this.$vApp.$store.registerModule("legend",_()),this._parseConfig(this.config!==void 0?JSON.parse(JSON.stringify(this.config)):void 0);const e=this.$vApp.$watch(()=>this.config,t=>this._parseConfig(t!==void 0?JSON.parse(JSON.stringify(t)):void 0));this.removed=()=>{e(),this.$iApi.fixture.get("appbar")&&this.$iApi.$vApp.$store.dispatch("appbar/removeButton","legend"),this.$iApi.fixture.get("mapnav")&&this.$iApi.$vApp.$store.dispatch("mapnav/removeItem","legend"),this.$iApi.panel.remove("legend"),this.$vApp.$store.unregisterModule("legend")}}}export{N as default};
