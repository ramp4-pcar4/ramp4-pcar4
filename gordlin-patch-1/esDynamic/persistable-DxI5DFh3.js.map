{"version":3,"file":"persistable-DxI5DFh3.js","sources":["../../node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport t from\"../../Error.js\";import{createMD5Hash as r}from\"../../MD5.js\";import{isMultiOriginJSONMixin as e}from\"../../multiOriginJSONSupportUtils.js\";import{isAbsolute as o,isBlobProtocol as s,join as n,blobUrlToBlob as i,getPathExtension as p}from\"../../urlUtils.js\";import{generateUUID as c}from\"../../uuid.js\";import{getPropertyMetadata as u}from\"../metadata.js\";import{nameToId as a}from\"../PropertyOrigin.js\";import{propertyJSONMeta as l}from\"./property.js\";import{getResourceContentExtension as m}from\"../../../portal/support/resourceExtension.js\";import{r as d,t as f,M as y,i as g,p as h,b as v}from\"../../../chunks/persistableUrlUtils.js\";function j(t){const r=t?.origins??[void 0];return(e,o)=>{const s=U(t,e,o);for(const t of r){const r=l(e,t,o);for(const t in s)r[t]=s[t]}}}function U(t,r,e){if(\"resource\"===t?.type)return w(t,r,e);switch(t?.type??\"other\"){case\"other\":return{read:!0,write:!0};case\"url\":{const{read:t,write:r}=v;return{read:t,write:r}}}}function w(t,r,n){const i=u(r,n);return{type:String,read:(t,r,e)=>{const o=d(t,r,e);return i.type===String?o:\"function\"==typeof i.type?new i.type({url:o}):void 0},write:{writer(r,p,c,u){if(!u?.resources)return\"string\"==typeof r?void(p[c]=f(r,u)):void(p[c]=r.write({},u));const l=x(r),m=f(l,{...u,verifyItemRelativeUrls:u?.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},y.NO),d=i.type!==String&&(!e(this)||u?.origin&&this.originIdOf(n)>a(u.origin)),h={object:this,propertyName:n,value:r,targetUrl:m,dest:p,targetPropertyName:c,context:u,params:t};u?.portalItem&&m&&!o(m)?d&&t?.contentAddressed?I(h):d?N(h):P(h):u?.portalItem&&(null==m||null!=g(m)||s(m)||d)?I(h):p[c]=m}}}}function I(e){const{targetUrl:o,params:p,value:u,context:a,dest:l,targetPropertyName:d}=e;if(!a.portalItem)return;const f=h(o),y=S(u,o,a);if(p?.contentAddressed&&\"json\"!==y.type)return void a.messages?.push(new t(\"persistable:contentAddressingUnsupported\",`Property \"${d}\" is trying to serializing a resource with content of type ${y.type} with content addressing. Content addressing is only supported for json resources.`,{content:y}));const g=p?.contentAddressed&&\"json\"===y.type?r(y.jsonString):f?.filename??c(),v=n(p?.prefix??f?.prefix,g),j=`${v}.${m(y)}`;if(p?.contentAddressed&&a.resources&&\"json\"===y.type){const t=a.resources.toKeep.find((({resource:t})=>t.path===j))??a.resources.toAdd.find((({resource:t})=>t.path===j));if(t)return void(l[d]=t.resource.itemRelativeUrl)}const U=a.portalItem.resourceFromPath(j);s(o)&&a.resources&&a.resources.pendingOperations.push(i(o).then((t=>{U.path=`${v}.${m({type:\"blob\",blob:t})}`,l[d]=U.itemRelativeUrl})).catch((()=>{})));const w=p?.compress??!1;a.resources&&b({...e,resource:U,content:y,compress:w,updates:a.resources.toAdd}),l[d]=U.itemRelativeUrl}function N(t){const{context:r,targetUrl:e,params:o,value:s,dest:n,targetPropertyName:i}=t;if(!r.portalItem)return;const c=r.portalItem.resourceFromPath(e),u=S(s,e,r),a=m(u),l=p(c.path),d=o?.compress??!1;a===l?(r.resources&&b({...t,resource:c,content:u,compress:d,updates:r.resources.toUpdate}),n[i]=e):I(t)}function P({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}function b({object:t,propertyName:r,updates:e,resource:o,content:s,compress:n}){const i=e=>{O(t,r,e)};e.push({resource:o,content:s,compress:n,finish:i})}function S(t,r,e){return\"string\"==typeof t?{type:\"url\",url:r}:{type:\"json\",jsonString:JSON.stringify(t.toJSON(e))}}function x(t){return null==t?null:\"string\"==typeof t?t:t.url}function O(t,r,e){\"string\"==typeof t[r]?t[r]=e.url:t[r].url=e.url}export{j as persistable};\n"],"names":["j","t","e","o","s","U","r","l","w","v","n","i","u","d","p","c","f","x","m","y","a","h","I","N","P","g","S","b","O"],"mappings":"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","x_google_ignoreList":[0]}