{"version":3,"file":"index-CNaC-rOP.js","sources":["../../node_modules/file-saver/dist/FileSaver.min.js","../../src/fixtures/export/api/export.ts","../../src/fixtures/export/lang/lang.csv?raw","../../src/fixtures/export/index.ts"],"sourcesContent":["(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","import { FixtureInstance } from '@/api/internal';\nimport { useExportStore } from '../store';\nimport type { ExportConfig } from '../store';\nimport type { fabric } from 'fabric';\nimport FileSaver from 'file-saver';\n\nconst DEFAULT_WIDTH = 1200;\n\nconst GLOBAL_MARGIN = {\n    TOP: 40,\n    RIGHT: 40,\n    BOTTOM: 40,\n    LEFT: 40\n};\n\ntype RenderCallback = (\n    canvas: fabric.StaticCanvas,\n    fabricObjects: Record<string, fabric.Object>,\n    options: {\n        panelWidth: number;\n        margin: typeof GLOBAL_MARGIN;\n        defaultWidth: number;\n        fabric: typeof fabric;\n    }\n) => Promise<void> | void;\n\nexport class ExportAPI extends FixtureInstance {\n    fcFabric: fabric.StaticCanvas | undefined;\n    // download canvas will remain unscaled and only be used for download\n    fcFabricDownload: fabric.StaticCanvas | undefined;\n\n    options = {\n        runningHeight: 0,\n        scale: 1\n    };\n\n    // stores the custom render function if provided\n    customRendererFunc = undefined as RenderCallback | undefined;\n\n    /**\n     * Allows for a custom render callback function to be passed in to render the export canvas.\n     * The function should accept the blank ramp canvas as its first parameter and use that canvas to draw on.\n     * The width of the canvas is already set to the panel width, so the function only needs to set the height.\n     *\n     * Individual export elements like the map or the legend can be accessed from the `fabricObjects` object as the second parameter.\n     * You can pick and chose which elements to add to the canvas, or modify them as needed. You can also add custom elements to the canvas.\n     *\n     * Finally, the `options` object is passed in as the third parameter. This object contains useful information such as the panel width, the default margins, the default canvas width, and the fabric object itself.\n     *\n     * Some canvas operations are asynchronous like fetching an image or cloning objects. In these cases you should return a promise so ramp waits for your operations to complete, otherwise returning nothing (void) is fine.\n     *\n     * ramp uses Fabric.js instead of the native canvas API. Read more about Fabric.js here: [Fabric.js](http://fabricjs.com/)\n     *\n     * @param {RenderCallback} renderCallback\n     * @example myWatermarkingRenderer((canvas, fabricObjects, options) => {\n     *   const watermark = new fabric.Text('Watermark', { ... });\n     *   fabricObjects.map.addWithUpdate(watermark);\n     *   canvas.add(fabricObjects.map);\n     *   canvas.setHeight(1000);\n     * });\n     *\n     * rInstance.fixture.isLoaded('export').then(() => {\n     *   rInstance.fixture.get('export').customRenderer(myWatermarkingRenderer);\n     * });\n     * @memberof ExportAPI\n     */\n    customRenderer(renderCallback: RenderCallback): void {\n        this.customRendererFunc = renderCallback;\n    }\n\n    /**\n     * Returns `ExportConfig` section of the global config file.\n     *\n     * @readonly\n     * @type {ExportConfig}\n     * @memberof ExportAPI\n     */\n    get config(): ExportConfig | undefined {\n        return super.config;\n    }\n\n    /**\n     * Parses the export config JSON snippet from the config file and save to the fixture store.\n     *\n     * @param {ExportConfig} [exportConfig]\n     * @memberof ExportAPI\n     */\n    _parseConfig(exportConfig?: ExportConfig) {\n        if (!exportConfig) return;\n\n        const exportStore = useExportStore(this.$vApp.$pinia);\n\n        exportStore.componentSelectedState = {\n            title: exportConfig.title?.selected ?? true,\n            map: exportConfig.map?.selected ?? true,\n            mapElements: exportConfig.mapElements?.selected ?? true,\n            legend: exportConfig.legend?.selected ?? true,\n            footnote: exportConfig.footnote?.selected ?? true,\n            timestamp: exportConfig.timestamp?.selected ?? true\n        };\n\n        exportStore.fileName = exportConfig.fileName || '';\n\n        this.handlePanelWidths(['export']);\n        this.handlePanelTeleports(['export']);\n    }\n\n    /**\n     * Fetches an Export sub fixture\n     *\n     * @private\n     * @param {string} name\n     * @returns {ExportSubFixture | undefined}\n     * @memberof ExportAPI\n     */\n    private getSubFixture(name: string): ExportSubFixture | undefined {\n        return this.$iApi.fixture.get(name) as ExportSubFixture | undefined;\n    }\n\n    /**\n     * Creates an export canvas.\n     *\n     * @param {HTMLCanvasElement} canvas\n     * @param {number} panelWidth\n     * @returns {Promise<void>}\n     * @memberof ExportAPI\n     */\n    async make(canvas: HTMLCanvasElement, panelWidth: number): Promise<void> {\n        const { fabric } = await import('fabric');\n        // prevents blurriness <https://stackoverflow.com/questions/47513180/fabricjs-lines-in-group-become-blurry>\n        fabric.Object.prototype.objectCaching = false;\n        const exportStore = useExportStore(this.$vApp.$pinia);\n\n        // stores the individual fabric objects for use with a custom render function\n        const selectedFabricObjects: Record<string, fabric.Object> = {};\n\n        this.fcFabric = new fabric.StaticCanvas(canvas, {\n            backgroundColor: '#fff'\n        });\n\n        this.fcFabricDownload = new fabric.StaticCanvas(null, {\n            backgroundColor: '#fff'\n        });\n\n        this.options.runningHeight = 0;\n\n        const selectedState = exportStore.componentSelectedState;\n\n        const exportTitleFixture = this.getSubFixture('export-title');\n        const exportMapFixture = this.getSubFixture('export-map');\n        const exportScaleBarFixture = this.getSubFixture('export-scalebar');\n        const exportNorthArrowFixture = this.getSubFixture('export-northarrow');\n        const exportLegendFixture = this.getSubFixture('export-legend');\n        const exportFootnoteFixture = this.getSubFixture('export-footnote');\n        const exportTimestampFixture = this.getSubFixture('export-timestamp');\n\n        let fbTitle: fabric.Object | undefined;\n        let fbMap: fabric.Object | undefined;\n        let fbScaleBar: fabric.Object | undefined;\n        let fbNorthArrow: fabric.Object | undefined;\n        let fbLegend: fabric.Object | undefined;\n        let fbFootnote: fabric.Object | undefined;\n        let fbTimestamp: fabric.Object | undefined;\n\n        if (selectedState.title && exportTitleFixture) {\n            fbTitle = await exportTitleFixture.make({\n                /* text: 'üò∏ü§ñüßô‚Äç‚ôÇÔ∏èü§¶‚Äç‚ôÄÔ∏èüé∂', */\n                top: this.options.runningHeight,\n                left: 0,\n                originX: 'left',\n                width: panelWidth,\n                textAlign: 'center'\n            });\n            this.options.runningHeight += fbTitle.height! + 40;\n            selectedFabricObjects.title = fbTitle;\n        }\n\n        if (selectedState.map && exportMapFixture) {\n            fbMap = await exportMapFixture.make({\n                top: this.options.runningHeight\n            });\n\n            if (fbTitle) {\n                // center title after we know the width of the group\n                fbTitle.left = fbMap.width! / 2;\n                fbTitle.originX = 'center';\n            }\n\n            this.options.runningHeight += fbMap.height! + 40;\n            selectedFabricObjects.map = fbMap;\n        }\n\n        // title should spread to length of canvas if map isn't rendered\n        if (!fbMap && fbTitle) {\n            fbTitle.width = DEFAULT_WIDTH;\n        }\n\n        this.options.scale = panelWidth / ((fbMap?.width ?? DEFAULT_WIDTH) + GLOBAL_MARGIN.LEFT + GLOBAL_MARGIN.RIGHT);\n\n        if (selectedState.mapElements && exportScaleBarFixture) {\n            fbScaleBar = await exportScaleBarFixture.make({\n                top: this.options.runningHeight,\n                left: 0\n            });\n            this.options.runningHeight += fbScaleBar.height! + 40;\n            selectedFabricObjects.scaleBar = fbScaleBar;\n\n            if (exportNorthArrowFixture) {\n                // keep it inline with the scale bar.\n                fbNorthArrow = await exportNorthArrowFixture.make({\n                    top: fbScaleBar.top,\n                    left: panelWidth / this.options.scale\n                });\n\n                // adjust position for height and width so it is properly centered\n                fbNorthArrow.top! += fbNorthArrow.height! / 2 - 20;\n                fbNorthArrow.left! += -fbNorthArrow.width! * 2;\n\n                selectedFabricObjects.northArrow = fbNorthArrow;\n            }\n        }\n\n        if (selectedState.legend && exportLegendFixture) {\n            fbLegend = await exportLegendFixture.make({\n                width: exportLegendFixture.config?.columnWidth ?? fbMap?.width ?? DEFAULT_WIDTH\n            });\n            fbLegend.top = this.options.runningHeight;\n            this.options.runningHeight += fbLegend.height!;\n            selectedFabricObjects.legend = fbLegend;\n        }\n\n        if (selectedState.timestamp && exportTimestampFixture) {\n            fbTimestamp = await exportTimestampFixture.make({\n                top: this.options.runningHeight + 40,\n                width: panelWidth\n            });\n\n            this.options.runningHeight +=\n                !selectedState.footnote || !exportFootnoteFixture ? fbTimestamp.height! + 40 : fbTimestamp.height! + 20;\n            selectedFabricObjects.timestamp = fbTimestamp;\n        }\n\n        if (selectedState.footnote && exportFootnoteFixture) {\n            fbFootnote = await exportFootnoteFixture.make({\n                top: this.options.runningHeight - 2.5, // Magic number 2.5 prevents weird vertical offset between timestamp/footer\n                left: panelWidth / this.options.scale + 40\n            });\n\n            // Extra width to prevent slight overlaps between timestamp and footnote\n            const BUFFER = 30;\n\n            // First determine if timestamp exists\n            if (selectedState.timestamp && exportTimestampFixture) {\n                // CASE: Timestamp exists. Detect if the footnote overlaps with the timestamp\n                // If they overlap, put footnote on next line; else keep side-by-side\n                if (\n                    panelWidth - (selectedFabricObjects.timestamp as fabric.Textbox).getMinWidth() <=\n                    (fbFootnote as fabric.Textbox).getMinWidth() + BUFFER\n                ) {\n                    // CASE: Overlap\n\n                    fbFootnote.top! += 30;\n                    fbFootnote.left! = 0;\n                    fbFootnote.originX! = 'left';\n                    this.options.runningHeight += 20;\n                } else {\n                    // CASE: No overlap\n\n                    fbFootnote.left! += -fbFootnote.width! * 2;\n                }\n            } else {\n                // CASE: Timestamp doesn't exist\n\n                fbFootnote.top! += 20;\n                fbFootnote.left! += -fbFootnote.width! * 2;\n                this.options.runningHeight += 20;\n            }\n\n            this.options.runningHeight += fbFootnote.height!;\n            selectedFabricObjects.footnote = fbFootnote;\n        }\n\n        if (this.customRendererFunc) {\n            this.fcFabric.setWidth(panelWidth);\n            const options = {\n                panelWidth,\n                margin: GLOBAL_MARGIN,\n                defaultWidth: DEFAULT_WIDTH,\n                fabric: fabric\n            };\n\n            await this.customRendererFunc(this.fcFabric, selectedFabricObjects, options);\n\n            this.fcFabric.renderAll();\n\n            this.fcFabric.clone((clonedCanvas: fabric.StaticCanvas) => {\n                this.fcFabricDownload = clonedCanvas;\n                this.fcFabricDownload.setDimensions({\n                    width: this.fcFabric!?.getWidth()!,\n                    height: this.fcFabric!.getHeight()!\n                });\n                this.fcFabricDownload.renderAll();\n            });\n        } else {\n            const fbGroup = new fabric.Group(Object.values(selectedFabricObjects), {\n                top: GLOBAL_MARGIN.TOP * this.options.scale,\n                left: GLOBAL_MARGIN.LEFT * this.options.scale\n            });\n\n            // clone items for download canvas\n            const fbGroupDownload: fabric.Group = await new Promise(resolve => {\n                fbGroup!.clone((g: fabric.Group) => {\n                    resolve(g);\n                });\n            });\n            fbGroupDownload.top = GLOBAL_MARGIN.TOP;\n            fbGroupDownload.left = GLOBAL_MARGIN.LEFT;\n            this.fcFabricDownload.add(fbGroupDownload);\n            // scale down items for panel canvas\n            fbGroup.scale(this.options.scale);\n            this.fcFabric.add(fbGroup);\n\n            this.fcFabric.setDimensions({\n                width: panelWidth,\n                height: (this.options.runningHeight + GLOBAL_MARGIN.TOP + GLOBAL_MARGIN.BOTTOM) * this.options.scale\n            });\n            this.fcFabric.renderAll();\n\n            this.fcFabricDownload!.setDimensions({\n                width: (fbMap?.width! ?? DEFAULT_WIDTH) + GLOBAL_MARGIN.LEFT + GLOBAL_MARGIN.RIGHT,\n                height: this.options.runningHeight + GLOBAL_MARGIN.TOP + GLOBAL_MARGIN.BOTTOM\n            });\n            this.fcFabricDownload.renderAll();\n        }\n    }\n\n    export(): void {\n        if (!this.fcFabric) {\n            return;\n        }\n\n        // use the filename from the config, or generate a default filename\n        const now = new Date();\n        const fileName: string =\n            this.config?.fileName ||\n            `map-carte - ${now.getFullYear()}-${now.getMonth()}-${now.getDay()}, ${now.getHours()}_${now.getMinutes()}`;\n\n        FileSaver.saveAs(\n            this.fcFabricDownload!.toDataURL({\n                format: 'png',\n                quality: 1\n            }),\n            `${fileName}.png`\n        );\n    }\n}\n\n/**\n * A common interface for Export sub fixtures.\n *\n * @export\n * @interface ExportSubFixture\n * @extends {FixtureInstance}\n */\nexport interface ExportSubFixture extends FixtureInstance {\n    /**\n     * Creates an export image and returns it.\n     *\n     * @param {*} [options] fixture config options or any other options that a sub fixture accepts\n     * @returns {Promise<fabric.Object>}\n     * @memberof ExportSubFixture\n     */\n    make(options?: any): Promise<fabric.Object>;\n}\n","export default \"key,enValue,enValid,frValue,frValid\\nexport.title,Export,1,Exporter,1\\nexport.alertName,Export,1,Exporter,1\\nexport.download,Download image,1,T√©l√©charger l'image,1\\nexport.refresh,Refresh,1,Rafra√Æchir,1\\nexport.scaleBar.approx,{0} approx.,1,Environ {0},1\\nexport.menu,Settings Menu,1,Menu des param√®tres,1\\nexport.menu.component.title,Title,1,Titre,1\\nexport.menu.component.map,Map,1,Carte,1\\nexport.menu.component.mapElements,North arrow and scalebar,1,Fl√®che du nord et √©chelle graphique,1\\nexport.menu.component.legend,Legend,1,L√©gende,1\\nexport.menu.component.footnote,Footnote,1,R√©f√©rence,1\\nexport.menu.component.timestamp,Timestamp,1,Horodatage,1\"","import { markRaw } from 'vue';\nimport { ExportAPI } from './api/export';\nimport ExportScreenV from './screen.vue';\nimport messages from './lang/lang.csv?raw';\n\n/* import sub fixtures */\nimport type ExportFootnoteFixture from '../export-footnote';\nimport type ExportLegendFixture from '../export-legend';\nimport type ExportMapFixture from '../export-map';\nimport type ExportTimestampFixture from '../export-timestamp';\nimport type ExportTitleFixture from '../export-title';\nimport type ExportNorthArrowFixture from '../export-northarrow';\nimport type ExportScalebarFixture from '../export-scalebar';\nimport type { PanelInstance } from '@/api';\nimport { useAppbarStore } from '../appbar/store';\nimport { useExportStore } from './store';\nimport { GlobalEvents } from '@/api';\n\nclass ExportFixture extends ExportAPI {\n    initialized(): void {\n        // load sub-fixtures required by the export\n    }\n\n    async needed() {\n        const exportTitle = (await import('../export-title')).default;\n        const exportMap = (await import('../export-map')).default;\n        const exportLegend = (await import('../export-legend')).default;\n        const exportNorthArrow = (await import('../export-northarrow')).default;\n        const exportScalebar = (await import('../export-scalebar')).default;\n        const exportTimestamp = (await import('../export-timestamp')).default;\n        const exportFootnote = (await import('../export-footnote')).default;\n\n        // any type is needed to suppress TS errors, not able to find a better solution/type for use\n        this.$iApi.fixture.add('export-title', exportTitle as any);\n        this.$iApi.fixture.add('export-map', exportMap as any);\n        this.$iApi.fixture.add('export-legend', exportLegend as any);\n        this.$iApi.fixture.add('export-northarrow', exportNorthArrow as any);\n        this.$iApi.fixture.add('export-scalebar', exportScalebar as any);\n        this.$iApi.fixture.add('export-timestamp', exportTimestamp as any);\n        this.$iApi.fixture.add('export-footnote', exportFootnote as any);\n    }\n\n    added(): void {\n        // console.log(`[fixture] ${this.id} added`);\n\n        this.$iApi.panel.register(\n            {\n                id: 'export',\n                config: {\n                    screens: {\n                        'export-screen': markRaw(ExportScreenV)\n                    },\n                    style: {\n                        'flex-grow': '1',\n                        'max-width': '800px'\n                    },\n                    button: {\n                        tooltip: 'export.title',\n                        // https://fonts.google.com/icons?selected=Material+Icons:layers&icon.query=export\n                        icon: '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z\" /></svg>'\n                    },\n                    alertName: 'export.alertName'\n                }\n            },\n            { i18n: { messages } }\n        );\n\n        const neededHandler = this.$iApi.event.on(GlobalEvents.PANEL_OPENED, async (panel: PanelInstance) => {\n            if (panel.id === 'export') {\n                this.$iApi.event.off(neededHandler);\n                await this.needed();\n                (panel as any).exportMake();\n            }\n        });\n\n        // parse export section of config and store in the config store\n        this._parseConfig(this.config);\n        const unwatch = this.$vApp.$watch(\n            () => this.config,\n            (value: any) => this._parseConfig(value)\n        );\n\n        this.removed = () => {\n            // console.log(`[fixture] ${this.id} removed`);\n            unwatch();\n            // remove sub fixtures\n            this.$iApi.fixture.get<ExportTitleFixture>('export-title')?.remove();\n            this.$iApi.fixture.get<ExportMapFixture>('export-map')?.remove();\n            this.$iApi.fixture.get<ExportLegendFixture>('export-legend')?.remove();\n            this.$iApi.fixture.get<ExportNorthArrowFixture>('export-northarrow')?.remove();\n            this.$iApi.fixture.get<ExportScalebarFixture>('export-scalebar')?.remove();\n            this.$iApi.fixture.get<ExportTimestampFixture>('export-timestamp')?.remove();\n            this.$iApi.fixture.get<ExportFootnoteFixture>('export-footnote')?.remove();\n\n            if (this.$iApi.fixture.exists('appbar')) {\n                const appbarStore = useAppbarStore(this.$vApp.$pinia);\n                appbarStore.removeButton('export');\n            }\n\n            const exportStore = useExportStore(this.$vApp.$pinia);\n            exportStore.$reset();\n\n            this.$iApi.panel.remove('export');\n        };\n    }\n}\n\nexport default ExportFixture;\n"],"names":["a","b","this","c","d","g","e","f","global","h","i","j","k","l","m","module","DEFAULT_WIDTH","GLOBAL_MARGIN","ExportAPI","FixtureInstance","renderCallback","exportConfig","exportStore","useExportStore","name","canvas","panelWidth","fabric","n","selectedFabricObjects","selectedState","exportTitleFixture","exportMapFixture","exportScaleBarFixture","exportNorthArrowFixture","exportLegendFixture","exportFootnoteFixture","exportTimestampFixture","fbTitle","fbMap","fbScaleBar","fbNorthArrow","fbLegend","fbFootnote","fbTimestamp","options","clonedCanvas","fbGroup","fbGroupDownload","resolve","now","fileName","FileSaver","messages","ExportFixture","exportTitle","exportMap","exportLegend","exportNorthArrow","exportScalebar","exportTimestamp","exportFootnote","markRaw","ExportScreenV","neededHandler","GlobalEvents","panel","unwatch","value","useAppbarStore"],"mappings":"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","x_google_ignoreList":[0]}