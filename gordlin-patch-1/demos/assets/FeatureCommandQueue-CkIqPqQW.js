import { g as l$4, _ as _$2, h as b$6, P as P$1, j, i as tt, G as G$1, m as se, B as Bn, p as j$1, q as ee, H, u as kn, v as te, w as g$3, C as C$1, S as S$3, F as F$4, x as d$4, y as F$5, z as U, A as x$4, D as S$4, E as P$2, I as nt, L as ln, M as q$1, N as q$2, O as x$6, a as a$5, Q as E$2, R as C$3, T as H$1, V as z$3, X as S$5, Y as R$2, $ as w$3, a0 as xt, a1 as h$9, a2 as Bt, a3 as i$4, a4 as t$8, a5 as Wn, a6 as tn, a7 as K$2, a8 as v$3, a9 as Xt, aa as Un, ab as vn, ac as j$2, ad as A$1, ae as t$9, af as n$7, ag as G$3, ah as P$4, ai as O$1, aj as Dt, ak as Nt, al as Y$1, am as I$1, an as J$1, ao as f$9, ap as h$a, aq as m$8, ar as p$8, as as f$a, at as l$5, au as p$9, av as B$1, aw as q$3, ax as bn, ay as Sn, az as k, aA as Zt, aB as Ct, aC as T$2, aD as D$2, aE as F$7, aF as H$2, aG as q$4, aH as q$5, aI as z$4, aJ as u$c, aK as r$4, aL as c$5, aM as St, aN as o$5, aO as sn, aP as h$b, aQ as yt, aR as g$4, aS as o$6, aT as a$6, K as K$3, d as d$6 } from './UpdateTracking2D-CbIdWQzy.js';
import { aW as e$2, ot as t$4, ks as t$7, s as s$4, h4 as r$3, H as s$5, kQ as c$6, lk as t$a, jd as o$7, cS as u$d, bd as W$1, o3 as m$9, ou as t$b, q as q$6, mF as _$4 } from './main-BpBTVFw9.js';
import { a as a$4, K as K$1, L as L$1, d as at, u as u$b, i as i$5 } from './definitions-slUvtMCM.js';
import { E, S as S$2, f as f$8, m as m$7, c as h$8, y as y$3, M as M$1, d as c$4, e as d$5, w as w$2, L as L$2 } from './Container-DGaMSjdU.js';
import { C as C$2, F as F$6, L, D as D$1, B, E as E$1, U as U$1, _ as _$3, G as G$2, P as P$3, O, I } from './enums-CgzwTbC2.js';
import { h as h$7, s as s$3, i as i$3, x as x$5 } from './Program-DZgjqPht.js';
import { o as o$3 } from './ProgramTemplate-jUIAzuk8.js';
import { t as t$5 } from './VertexElementDescriptor-BrMxIhbJ.js';
import { a as t$6 } from './LabelMetric-Dj2qPwfJ.js';
import { e as e$3, m as m$6 } from './Texture-Dhn4xmA2.js';
import { o as o$4 } from './constants-C0QDwCF4.js';
import { c as n$8 } from './WGLContainer-DsAUXd2R.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let e$1 = class e{constructor(e){this.registryName=e,this.postProcessingEnabled=!1,this.overrideStencilRef=null,this.drawPhase=E.MAP|E.HITTEST|E.HIGHLIGHT|E.DEBUG,this.symbologyPlane=S$2.FILL;}startup(){}shutdown(s){}postProcess(s,t){}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let z$2 = class z extends b$6{};e$2([l$4(0,C$1)],z$2.prototype,"pos",void 0);let F$3 = class F extends F$5{};let R$1 = class R extends P$1{};e$2([_$2(j$1)],R$1.prototype,"dotSize",void 0);let b$5 = class b extends P$1{};e$2([_$2(S$3)],b$5.prototype,"locations",void 0),e$2([_$2(j$1)],b$5.prototype,"pixelRatio",void 0),e$2([_$2(j$1)],b$5.prototype,"tileZoomFactor",void 0);const P=1e-6;class C extends j{vertex(t){const o=new tt(1,0,0,0,-1,0,0,1,1).multiply(new G$1(t.pos.xy.divide(a$4),1)),i=se(this.draw.locations,o.xy),s=Bn(this.instance.dotSize.divide(2),new j$1(1));let r=new j$1(0);r=r.add(ee(i.a,new j$1(P)).multiply(2));let d=s.add(this.instance.dotSize);const n=this.view.displayViewScreenMat3.multiply(new G$1(t.pos.add(.5),1)),a=new H(n.xy,r,1),l=this.instance.dotSize.divide(d),h=new j$1(-1).divide(s.divide(d));return d=d.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:a,glPointSize:d,color:i,ratio:l,invEdgeRatio:h}}fragment(t){const o=kn(t.glPointCoord.subtract(.5)).multiply(2),e=te(new j$1(0),new j$1(1),t.invEdgeRatio.multiply(o.subtract(t.ratio)).add(1)),i=new F$4;return i.glFragColor=t.color.multiply(e),i}}e$2([_$2(R$1)],C.prototype,"instance",void 0),e$2([_$2(b$5)],C.prototype,"draw",void 0),e$2([_$2(d$4)],C.prototype,"view",void 0),e$2([t$4(0,g$3(z$2))],C.prototype,"vertex",null),e$2([t$4(0,g$3(F$3))],C.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
class D extends S$4{}e$2([l$4(3,j$1)],D.prototype,"inverseArea",void 0);let V$2 = class V extends P$1{};e$2([_$2(U.ofType(H,2))],V$2.prototype,"isActive",void 0),e$2([_$2(U.ofType(H,8))],V$2.prototype,"colors",void 0),e$2([_$2(j$1)],V$2.prototype,"dotValue",void 0);let F$2 = class F extends P$1{};e$2([_$2(S$3)],F$2.prototype,"dotTexture0",void 0),e$2([_$2(S$3)],F$2.prototype,"dotTexture1",void 0),e$2([_$2(j$1)],F$2.prototype,"tileZoomFactor",void 0),e$2([_$2(j$1)],F$2.prototype,"pixelRatio",void 0),e$2([_$2(j$1)],F$2.prototype,"tileDotsOverArea",void 0);let _$1 = class _ extends P$2{_dotThreshold(t,e,o){return t.divide(e).divide(o)}vertex(t){const e=new tt(2/a$4,0,0,0,-2/a$4,0,-1,1,1).multiply(new G$1(t.pos,1)),s=this.clip(t.id),i=new H(e.xy,s,1),r=this.storage.getVVData(t.id).multiply(this.instance.isActive.get(0)).multiply(t.inverseArea),l=this.storage.getDataDrivenData0(t.id).multiply(this.instance.isActive.get(1)).multiply(t.inverseArea),d=this.draw.tileZoomFactor.multiply(a$4).divide(this.draw.pixelRatio),a=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),n=this._dotThreshold(l,this.instance.dotValue,this.draw.tileDotsOverArea),u=t.pos.add(.5).divide(d);return {glPosition:i,color:new H(0,0,0,0),textureCoords:u,thresholds0:a,thresholds1:n}}fragment(t){const e=new F$4,o=se(this.draw.dotTexture0,t.textureCoords),s=se(this.draw.dotTexture1,t.textureCoords),i=t.thresholds0.subtract(o),r=t.thresholds1.subtract(s);let l;const a=nt.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),n=nt.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const t=ee(new j$1(0),i),e=ee(new j$1(0),r),o=ln(t,i).add(ln(e,r)),s=ee(o,new j$1(0)),d=new j$1(1).subtract(s),p=o.add(s),h=i.multiply(t).divide(p),c=r.multiply(e).divide(p),u=a.multiply(h).add(n.multiply(c));l=d.multiply(u);}else {const t=Bn(q$1(i),q$1(r)),e=ee(t,new j$1(0)),o=new j$1(1).subtract(e),s=ee(t,i),d=ee(t,r),p=a.multiply(s).add(n.multiply(d));l=o.multiply(p);}return e.glFragColor=l,e}hittest(t){return q$2(this.hittestRequest)}};e$2([x$4],_$1.prototype,"blending",void 0),e$2([_$2(V$2)],_$1.prototype,"instance",void 0),e$2([_$2(F$2)],_$1.prototype,"draw",void 0),e$2([t$4(0,g$3(D))],_$1.prototype,"vertex",null),e$2([t$4(0,g$3(F$5))],_$1.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
const T$1={[C$2.BYTE]:1,[C$2.UNSIGNED_BYTE]:1,[C$2.SHORT]:2,[C$2.UNSIGNED_SHORT]:2,[C$2.INT]:4,[C$2.UNSIGNED_INT]:4,[C$2.FLOAT]:4};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let i$2 = class i{constructor(t,i){this._boundPart=null;const a=[];for(const e of i.vertex){const s=h$7.createVertex(t,F$6.STATIC_DRAW,e);a.push(s);}const u=[];for(const e of i.index||[]){const s=h$7.createIndex(t,F$6.STATIC_DRAW,e);u.push(s);}this.groups=[];for(const r of i.groups){let o;if(null!=r.index){if(!i.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:t}=i.index[r.index];2===t?o=C$2.UNSIGNED_SHORT:4===t&&(o=C$2.UNSIGNED_INT);}const d=null!=r.index?u[r.index]:null,c=new Map,l={},p={};for(const t of r.attributes){const{name:r,count:o,type:e,offset:s,normalized:i,divisor:u,stride:d,vertex:f,location:h}=t,b=`vertex-buffer-${f}`;let x=l[b];x||(x=l[b]=[]);const m=new t$5(r,o,e,s,d,i,u);x.push(m),c.set(r,h),p[b]=a[f];}const f=new o$3(t,c,l,p,d);this.groups.push({...r,vertexArray:f,locations:c,layout:l,indexing:o});}this.parts=i.parts;}bind(t,r){this._boundPart=r;const{group:o}=this.parts[this._boundPart],{vertexArray:e}=this.groups[o];t.bindVAO(e);}draw(r){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:o,count:e}=this.parts[this._boundPart],{group:s}=this.parts[this._boundPart],{indexing:n,primitive:i}=this.groups[s];n?r.drawElements(i,e,n,o*T$1[n]):r.drawArrays(i,o,e);}unbind(t){this._boundPart=null,t.bindVAO(null);}destroy(){for(const{vertexArray:t}of this.groups)t.dispose();}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let r$2 = class r extends i$2{static create(e,o){const n=[];let{stride:s,hash:l}=o.layout;if(null==s){s=0;for(const{count:e,type:i,offset:r}of o.layout.attributes){if(null!=r)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");s+=e*T$1[i];}}let u=0,a=0;for(const{count:i,name:r,offset:h,type:m,normalized:x}of o.layout.attributes){null!=h&&(a=h);const e={name:r,location:u,vertex:0,count:i,type:m,offset:a,stride:s,divisor:0,normalized:null!=x&&x};n.push(e),u++,a+=i*T$1[m];}const c={attributes:n,primitive:o.primitive};null!=o.index&&(c.index=0);let{count:d}=o;if(null==d&&(d=o.index?o.index.length:o.vertex.byteLength/s,Math.floor(d)!==d))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${s}.`);const p={start:0,count:d,group:0,primitive:o.primitive},f={vertex:[o.vertex],parts:[p],groups:[c]};null!=o.index&&(f.index=[o.index]),null==l&&(l=t$6(n));return new r(e,f,{hash:l,attributes:n,stride:s})}constructor(t,e,i){super(t,e),this.layout=i;}bind(t,e=0){super.bind(t,e);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let p$7 = class p{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null;}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy();}getFBO(t){if(null==this._dotFBO){const s=a$4,o=a$4,h=new e$3(s,o);h.samplingMode=L.NEAREST,h.wrapMode=D$1.CLAMP_TO_EDGE;const d=new s$3(t,new i$3(B.DEPTH_STENCIL,s,o));this._dotFBO=new x$5(t,h,d);}return this._dotFBO}getDotDensityMesh(t){if(null==this._dotMesh){const r=a$4,i=r*r,n=2,u=new Int16Array(i*n);for(let t=0;t<r;t++)for(let e=0;e<r;e++)u[n*(e+t*r)]=e,u[n*(e+t*r)+1]=t;const l=[{count:2,type:C$2.UNSIGNED_SHORT,name:"a_position",offset:0}],_={hash:t$6(l),attributes:l,stride:4};this._dotMesh=r$2.create(t,{primitive:E$1.POINTS,vertex:u,count:i,layout:_});}return this._dotMesh}getDotDensityTextures(e,s,o){if(this._dotTextureSize===s&&this._seed===o||(this._disposeTextures(),this._dotTextureSize=s,this._seed=o),null===this._dotTextures){const r=new t$7(o);this._dotTextures=[this._allocDotDensityTexture(e,s,r),this._allocDotDensityTexture(e,s,r)];}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null;}}_allocDotDensityTexture(t,e,s){const o=new Float32Array(e*e*4);for(let r=0;r<o.length;r++)o[r]=s.getFloat();const i=new e$3;return i.dataType=U$1.FLOAT,i.samplingMode=L.NEAREST,i.width=e,i.height=e,new m$6(t,i,o)}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let f$7 = class f extends e$1{constructor(){super(...arguments),this.shaders={polygon:new _$1,point:new C,fill:new x$6},this.meshWriter=a$5.DotDensityMeshWriter,this._resources=new Map;}render(e,t){f$8(e)||m$7(e)?this._renderPolygons(e,t):this._renderDotDensity(e,t);}_renderPolygons(e,t){const{context:i,painter:o}=e;o.setShader({shader:this.shaders.fill,uniforms:{...h$8(e,t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...y$3(e)},optionalAttributes:{zoomRange:!1},useComputeBuffer:m$7(e)}),o.setPipelineState(M$1(e)),o.submitDraw(i,t);}_renderDotDensity(o,r){const{context:d,painter:u,requiredLevel:c}=o,h=r.instance.getInput(),p=this._getOrCreateResourcesRecord(d),m=p.getDotDensityTextures(d,a$4,h.seed),f=1/2**(c-r.target.key.level),g=a$4,x=g*window.devicePixelRatio*g*window.devicePixelRatio,D=1/f*(1/f),b=h.dotScale?o.state.scale/h.dotScale:1,y=h.dotValue*b*D;u.setShader({shader:this.shaders.polygon,uniforms:{...h$8(o,r.target),instance:{isActive:h.isActive,colors:h.colors,dotValue:Math.max(1,y)},draw:{dotTexture0:{unit:K$1,texture:m[0]},dotTexture1:{unit:L$1,texture:m[1]},tileZoomFactor:f,pixelRatio:window.devicePixelRatio,tileDotsOverArea:x/(a$4*window.devicePixelRatio*a$4*window.devicePixelRatio)}},defines:{...y$3(o),blending:h.blending},optionalAttributes:{},useComputeBuffer:!1}),u.setPipelineState(M$1(o));const R=d.getViewport();d.setViewport(0,0,a$4,a$4);const P=d.getBoundFramebufferObject(),S=p.getFBO(d);d.bindFramebuffer(S),d.setClearColor(0,0,0,0),u.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),u.updatePipelineState(d),d.clear(_$3.COLOR_BUFFER_BIT),u.submitDraw(d,r),d.bindFramebuffer(P),d.setViewport(R.x,R.y,R.width,R.height);const v=p.getFBO(d).colorTexture;u.setShader({shader:this.shaders.point,uniforms:{view:c$4(o,r.target),instance:{dotSize:h.dotSize},draw:{locations:{unit:K$1,texture:v},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...y$3(o)},optionalAttributes:{},useComputeBuffer:!1}),u.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),u.submitDrawMesh(d,p.getDotDensityMesh(d));}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e);}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new p$7,this._resources.set(e,t)),t}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let h$6 = class h extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.ComplexFillMeshWriter,this.shaders={geometry:new E$2};}render(a,n){const{context:m,painter:h}=a;h.setShader({shader:this.shaders.geometry,uniforms:{...d$5(a,n.target,n.instance.getInput().geometry),...h$8(a,n.target),mosaicInfo:h.textureManager.getMosaicInfo(m,n.textureKey),localTileOffset:w$2(n.target)},defines:{...y$3(a)},optionalAttributes:n.instance.optionalAttributes,useComputeBuffer:m$7(a)}),h.setPipelineState(M$1(a)),h.submitDraw(m,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
function n$6(n){const t=1/n;return {antialiasing:t,blur:0+t}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let u$a = class u extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.ComplexOutlineFillMeshWriter,this.shaders={geometry:new C$3};}render(n,l){const{context:m,painter:u,pixelRatio:p}=n;u.setShader({shader:this.shaders.geometry,uniforms:{...d$5(n,l.target,l.instance.getInput().geometry),...h$8(n,l.target),antialiasingControls:n$6(p),mosaicInfo:u.textureManager.getMosaicInfo(m,l.textureKey),localTileOffset:w$2(l.target)},defines:{...y$3(n)},optionalAttributes:l.instance.optionalAttributes,useComputeBuffer:m$7(n)}),u.setPipelineState(M$1(n)),u.submitDraw(m,l);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let m$5 = class m extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.FillMeshWriter,this.shaders={geometry:new x$6};}render(o,n){const{context:a,painter:m}=o;m.setShader({shader:this.shaders.geometry,uniforms:{...d$5(o,n.target,n.instance.getInput().geometry),...h$8(o,n.target)},defines:y$3(o),optionalAttributes:n.instance.optionalAttributes,useComputeBuffer:m$7(o)}),m.setPipelineState(M$1(o)),m.submitDraw(a,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let l$3 = class l extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.OutlineFillMeshWriter,this.shaders={geometry:new H$1};}render(o,a){const{context:m,painter:l,pixelRatio:u}=o;l.setShader({shader:this.shaders.geometry,uniforms:{...d$5(o,a.target,a.instance.getInput().geometry),...h$8(o,a.target),antialiasingControls:n$6(u)},defines:{...y$3(o)},optionalAttributes:a.instance.optionalAttributes,useComputeBuffer:m$7(o)}),l.setPipelineState(M$1(o)),l.submitDraw(m,a);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let h$5 = class h extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.PatternFillMeshWriter,this.shaders={geometry:new z$3};}render(a,n){const{context:m,painter:h}=a;h.setShader({shader:this.shaders.geometry,uniforms:{...d$5(a,n.target,n.instance.getInput().geometry),...h$8(a,n.target),mosaicInfo:h.textureManager.getMosaicInfo(m,n.textureKey),localTileOffset:w$2(n.target)},defines:{...y$3(a)},optionalAttributes:n.instance.optionalAttributes,useComputeBuffer:m$7(a)}),h.setPipelineState(M$1(a)),h.submitDraw(m,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let u$9 = class u extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.PatternOutlineFillMeshWriter,this.shaders={geometry:new S$5};}render(n,l){const{context:m,painter:u,pixelRatio:h}=n;u.setShader({shader:this.shaders.geometry,uniforms:{...d$5(n,l.target,l.instance.getInput().geometry),...h$8(n,l.target),antialiasingControls:n$6(h),mosaicInfo:u.textureManager.getMosaicInfo(m,l.textureKey),localTileOffset:w$2(l.target)},defines:{...y$3(n)},optionalAttributes:l.instance.optionalAttributes,useComputeBuffer:m$7(n)}),u.setPipelineState(M$1(n)),u.submitDraw(m,l);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let l$2 = class l{constructor(e,t,r,o){this.dataType=e,this.samplingMode=t,this.pixelFormat=r,this.internalFormat=o;}};function n$5(n,i){const{textureFloat:f,colorBufferFloat:s}=n.capabilities,u=f?.textureFloatLinear,_=s?.textureFloat,m=s?.textureHalfFloat,p=s?.floatBlend,c=n.driverTest.floatBufferBlend.result;if(!_&&!m)throw new s$4("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(p&&c||m))throw new s$4("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(c?"":" This device claims support for EXT_float_blend, but does not actually support it."));const d=_&&p&&c,h=m,b=u,R=!!s?.R32F,E=!!s?.R16F;if(d&&b)return b||i.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new l$2(U$1.FLOAT,b?L.LINEAR:L.NEAREST,R?G$2.RED:G$2.RGBA,R?P$3.R32F:G$2.RGBA);if(h)return new l$2(U$1.HALF_FLOAT,L.LINEAR,E?G$2.RED:G$2.RGBA,E?P$3.R16F:G$2.RGBA);throw new s$4("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
const m$4=()=>s$5.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources");let f$6 = class f{destroy(){this._accumulateFramebuffer=r$3(this._accumulateFramebuffer),this._resolveGradientTexture=r$3(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null;}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(e){if(null==this._qualityProfile){const r=n$5(e,m$4());this._qualityProfile={...r,defines:{usesHalfFloatPrecision:r.dataType!==U$1.FLOAT}};}return this._qualityProfile}ensureAccumulateFBO(e,r,t){if(null==this._accumulateFramebuffer){const{dataType:u,samplingMode:o,pixelFormat:m,internalFormat:f}=this.loadQualityProfile(e),h=new e$3(r,t);h.pixelFormat=m,h.internalFormat=f,h.dataType=u,h.samplingMode=o,h.wrapMode=D$1.CLAMP_TO_EDGE;const c=new i$3(B.DEPTH_STENCIL,r,t);this._accumulateFramebuffer=new x$5(e,h,c);}else {const{width:e,height:a}=this._accumulateFramebuffer;e===r&&a===t||this._accumulateFramebuffer.resize(r,t);}return this._accumulateFramebuffer}ensureResolveGradientTexture(e,r,t){if(null==this._resolveGradientTexture){const r=new e$3;r.wrapMode=D$1.CLAMP_TO_EDGE,this._resolveGradientTexture=new m$6(e,r);}else this._prevGradientHash!==r&&(this._resolveGradientTexture.resize(t.length/4,1),this._resolveGradientTexture.setData(t),this._prevGradientHash=r);return this._resolveGradientTexture}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
function n$4(n){return n?.25:1}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let v$2 = class v extends S$4{};e$2([l$4(5,C$1)],v$2.prototype,"offset",void 0);let x$3 = class x extends F$5{};let g$2 = class g extends P$1{};e$2([_$2(j$1)],g$2.prototype,"radius",void 0),e$2([_$2(j$1)],g$2.prototype,"isFieldActive",void 0);let F$1 = class F extends P$2{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1;}vertex(t){const{radius:e,isFieldActive:s}=this.kernelControls,i=t.offset,o=s.multiply(this.storage.getVVData(t.id).x).add(new j$1(1).subtract(s)),l=this.view.displayViewScreenMat3.multiply(new G$1(t.pos,1)).add(this.view.displayViewMat3.multiply(new G$1(i,0)).multiply(e)),r=this.clip(t.id);return {glPosition:new H(l.xy,r,1),offset:i,fieldValue:o,color:new H(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:s}=t,i=kn(e),o=ee(i,new j$1(1)),l=new j$1(1).subtract(i.multiply(i)),r=l.multiply(l),a=o.multiply(r).multiply(s).multiply(new j$1(n$4(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new H(a),t)}hittest(t){const{viewMat3:e,tileMat3:s}=this.view,i=e.multiply(s).multiply(new G$1(t.pos,1));return R$2(i.xy,this.kernelControls.radius,this.hittestRequest.position)}};e$2([x$4],F$1.prototype,"usesHalfFloatPrecision",void 0),e$2([_$2(g$2)],F$1.prototype,"kernelControls",void 0),e$2([t$4(0,g$3(v$2))],F$1.prototype,"vertex",null),e$2([t$4(0,g$3(x$3))],F$1.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let x$2 = class x extends b$6{};e$2([l$4(0,C$1)],x$2.prototype,"pos",void 0);let f$5 = class f extends w$3{};let h$4 = class h extends P$1{};e$2([_$2(S$3)],h$4.prototype,"texture",void 0),e$2([_$2(C$1)],h$4.prototype,"minAndInvRange",void 0),e$2([_$2(j$1)],h$4.prototype,"normalization",void 0);let w$1 = class w extends P$1{};e$2([_$2(S$3)],w$1.prototype,"texture",void 0);let b$4 = class b extends j{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1;}vertex(t){return {glPosition:new H(t.pos.multiply(2).subtract(1),1,1),uv:t.pos}}fragment(t){const{accumulatedDensity:e,gradient:o}=this;let r=se(e.texture,t.uv).r.multiply(new j$1(n$4(this.usesHalfFloatPrecision)));r=r.multiply(e.normalization),r=r.subtract(e.minAndInvRange.x).multiply(e.minAndInvRange.y);const s=se(o.texture,new C$1(r,.5)),n=new F$4;return n.glFragColor=new H(s.rgb.multiply(s.a),s.a),n}};e$2([x$4],b$4.prototype,"usesHalfFloatPrecision",void 0),e$2([_$2(h$4)],b$4.prototype,"accumulatedDensity",void 0),e$2([_$2(w$1)],b$4.prototype,"gradient",void 0),e$2([t$4(0,g$3(x$2))],b$4.prototype,"vertex",null),e$2([t$4(0,g$3(f$5))],b$4.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let p$6 = class p extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.HeatmapMeshWriter,this.shaders={accumulate:new F$1,resolve:new b$4},this.postProcessingEnabled=!0,this._isBound=!1,this._resources=new Map,this.overrideStencilRef=f$4;}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e),this._prevFBO=null,this._unbind();}render(i,n){const{context:o,painter:u,state:a}=i,d=n.instance.getInput(),{isFieldActive:h}=d,l=this._getOrCreateResourcesRecord(o),c=l.loadQualityProfile(o);if(f$8(i))return;m$7(i)||this._bind(i,l,d),u.setShader({shader:this.shaders.accumulate,uniforms:{...h$8(i,n.target),kernelControls:{radius:g$1(d,a),isFieldActive:h?1:0}},defines:{...y$3(i),...c.defines},optionalAttributes:n.instance.optionalAttributes,useComputeBuffer:m$7(i)});const p=m$7(i)?b$3:_;u.setPipelineState(p),u.submitDraw(o,n);}postProcess(r,s){if(m$7(r)||f$8(r))return;const{context:i,painter:n}=r,o=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!o?.initialized)return;const{defines:u}=o.loadQualityProfile(i),{minDensity:a,maxDensity:d,radius:h}=s.getInput(),l=8,c=9,p=o.accumulateFramebuffer,m=o.resolveGradientTexture;n.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:l,texture:p.colorTexture},minAndInvRange:[a,1/(d-a)],normalization:3/(h*h*Math.PI)},gradient:{texture:{unit:c,texture:m}}},defines:u,optionalAttributes:{},useComputeBuffer:!1}),i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(p.colorTexture,l),i.bindTexture(m,c),n.setPipelineState(w),n.submitDrawQuad(i),this._unbind();}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new f$6,this._resources.set(e,t)),t}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1;}_bind(e,t,r){if(this._isBound)return;const{context:s,state:i,pixelRatio:n}=e,o=s.getBoundFramebufferObject(),u=s.getViewport();this._prevFBO=o,this._prevViewport=u;const{gradient:a,gradientHash:d}=r;t.ensureResolveGradientTexture(s,d,a);const{width:h,height:p}=u,f=m$3(g$1(r,i),n),_=h*f,b=p*f,w=t.ensureAccumulateFBO(s,_,b);s.blitFramebuffer(o,w,0,0,o.width,o.height,0,0,w.width,w.height,_$3.STENCIL_BUFFER_BIT,L.NEAREST),s.bindFramebuffer(w),s.setViewport(0,0,w.width,w.height),s.setColorMask(!0,!0,!0,!0),s.setClearColor(0,0,0,0),s.clear(_$3.COLOR_BUFFER_BIT),this._isBound=!0;}};function m$3(e,t){const r=t>1.5?.25:.5;return e<1/(2*r)?1:r}function f$4(e){return e.key.level+1}const _={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:f$4,compare:O.GEQUAL,mask:255,op:{fail:I.KEEP,zFail:I.KEEP,zPass:I.REPLACE}}}},b$3={..._,stencil:!1},w={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function g$1(e,t){const{referenceScale:r,radius:s}=e;return s*(0!==r?r/t.scale:1)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let d$3 = class d extends P$1{getVVRotationMat4(t){return xt(h$9(t),nt.identity(),(()=>{const e=this._getNormalizedAngle(t).multiply(t$8),r=Wn(e),o=tn(e);return new nt(o,r,0,0,r.multiply(new j$1(-1)),o,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(t){return xt(h$9(t),tt.identity(),(()=>{const e=this._getNormalizedAngle(t).multiply(t$8),r=Wn(e),o=tn(e);return new tt(o,r,0,r.multiply(new j$1(-1)),o,0,0,0,1)}))}_getNormalizedAngle(t){const e=Bt(this.rotationType,new j$1(i$4.Arithmatic));return xt(e,new j$1(90).subtract(t),t)}};e$2([_$2(j$1)],d$3.prototype,"rotationType",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
const q=360/254;class G extends S$4{}e$2([l$4(3,H)],G.prototype,"color",void 0),e$2([l$4(4,C$1)],G.prototype,"offset",void 0),e$2([l$4(5,C$1)],G.prototype,"textureUV",void 0),e$2([l$4(6,j$1)],G.prototype,"fontSize",void 0),e$2([l$4(7,j$1)],G.prototype,"referenceSize",void 0),e$2([l$4(8,j$1)],G.prototype,"haloFontSize",void 0),e$2([l$4(9,H)],G.prototype,"haloColor",void 0),e$2([l$4(10,C$1)],G.prototype,"zoomRange",void 0),e$2([l$4(11,j$1)],G.prototype,"clipAngle",void 0),e$2([l$4(12,H)],G.prototype,"referenceSymbol",void 0);let Z$1 = class Z extends v$3{};e$2([l$4(13,C$1)],Z$1.prototype,"offsetNextVertex1",void 0),e$2([l$4(14,C$1)],Z$1.prototype,"offsetNextVertex2",void 0);class J extends F$5{}class K extends P$2{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1;}clipLabel(t,e,o){const s=e.multiply(q),a=Xt(this.view.rotation.subtract(s)),r=Un(new j$1(360).subtract(a),a);let l=new j$1(0);const p=vn(this.view.currentZoom.multiply(at)).divide(at),n=t.x,h=t.y,v=new j$1(1).subtract(ee(n,p)).multiply(2),f=ee(new j$1(90),r).multiply(2),V=new j$1(2).multiply(new j$1(1).subtract(ee(p,h)));return l=l.add(o.multiply(v)),l=l.add(o.multiply(f)),l=l.add(V),l}vertex(t,e){const i=j$2(t.bitset,I$1),s=new j$1(1).subtract(i);let a=t.fontSize,r=a.divide(A$1);const l=this.isHaloPass?t.haloColor:this._getVertexColor(t),p=this.isLabel?l.multiply(this.storage.getAnimationValue(t.id)):l,n=this.view.displayViewScreenMat3.multiply(new G$1(t.pos,1));let d=t.offset,u=new j$1(1),y=tt.identity();if(this.isLabel){if(!t.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const e=t.referenceSymbol,i=e.xy,s=e.z,a=this._unpackDirection(e.w),r=t$9(this,t.id,s).divide(2),l=a.multiply(r.add(u$b));d=d.add(i).add(l);}else {u=t$9(this,t.id,t.referenceSize).divide(t.referenceSize),a=a.multiply(u),r=r.multiply(u),d=d.multiply(u),y=n$7(this,t.id),d=y.multiply(new G$1(d,0)).xy;}const c=j$2(t.bitset,J$1),V=this._getViewRotationMatrix(c).multiply(new G$1(d,0));let b=this.isLabel?this.clipLabel(t.zoomRange,t.clipAngle,c):this.clip(t.id,t.zoomRange);b=this.isBackgroundPass?b.add(s.multiply(2)):b.add(i.multiply(2));const w=new H(n.xy.add(V.xy),b,1),x=t.textureUV.divide(this.mosaicInfo.size);let g=new j$1(0);if(this.isHaloPass){g=t.haloFontSize.divide(r).divide(G$3);}return {glPosition:w,color:p,size:r,textureUV:x,antialiasingWidth:new j$1(.105*A$1).divide(a).divide(this.view.pixelRatio),haloDistanceOffset:g,...this.maybeRunHittest(t,e,{vvSizeAdjustment:u,vvRotation:y})}}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,o=new j$1(1).subtract(t);return e.multiply(t).add(i.multiply(o))}fragment(t){const e=new j$1(2/8),i=new j$1(1).subtract(e),o=se(this.mosaicInfo.texture,t.textureUV).a;let s=i.subtract(t.haloDistanceOffset);this.highlight&&(s=s.divide(2));const a=t.antialiasingWidth,r=te(s.subtract(a),s.add(a),o);return this.getFragmentOutput(t.color.multiply(r),t)}hittest(t,e,{vvSizeAdjustment:i,vvRotation:o}){const s=o.multiply(new G$1(t.offset.multiply(i),0)),a=o.multiply(new G$1(e.offsetNextVertex1.multiply(i),0)),r=o.multiply(new G$1(e.offsetNextVertex2.multiply(i),0)),{viewMat3:l,tileMat3:p}=this.view,n=l.multiply(p).multiply(new G$1(t.pos,1)),d=n.add(p.multiply(s)).xy,u=n.add(p.multiply(a)).xy,m=n.add(p.multiply(r)).xy;return P$4(this.hittestRequest.position,d.xy,u.xy,m.xy)}_unpackDirection(t){const e=new O$1(t),i=Dt(e,new O$1(2)),o=Nt(e,new O$1(3));return new C$1(new j$1(i).subtract(1),new j$1(o).subtract(1))}_getVertexColor(t){let e=t.color;if(this.visualVariableColor){const i=this.storage.getColorValue(t.id);e=this.visualVariableColor.getColor(i,t.color,new Y$1(!1));}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(t.id),o=this.visualVariableOpacity.getOpacity(i);e=e.multiply(o);}return e}}e$2([K$2(f$9)],K.prototype,"visualVariableColor",void 0),e$2([K$2(h$a)],K.prototype,"visualVariableOpacity",void 0),e$2([K$2(d$3)],K.prototype,"visualVariableRotation",void 0),e$2([K$2(m$8)],K.prototype,"visualVariableSizeMinMaxValue",void 0),e$2([K$2(p$8)],K.prototype,"visualVariableSizeScaleStops",void 0),e$2([K$2(f$a)],K.prototype,"visualVariableSizeStops",void 0),e$2([K$2(l$5)],K.prototype,"visualVariableSizeUnitValue",void 0),e$2([_$2(p$9)],K.prototype,"mosaicInfo",void 0),e$2([x$4],K.prototype,"isHaloPass",void 0),e$2([x$4],K.prototype,"isBackgroundPass",void 0),e$2([x$4],K.prototype,"isLabel",void 0),e$2([t$4(0,g$3(G)),t$4(1,g$3(Z$1))],K.prototype,"vertex",null),e$2([t$4(0,g$3(J))],K.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let u$8 = class u extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.LabelMeshWriter,this.shaders={geometry:new K},this.drawPhase=E.LABEL|E.LABEL_ALPHA,this.symbologyPlane=S$2.TEXT;}render(e,s){const{context:o,painter:n}=e,m=y$3(e),u={...M$1(e)},h={shader:this.shaders.geometry,uniforms:{...d$5(e,s.target,s.instance.getInput().geometry),...h$8(e,s.target),mosaicInfo:n.textureManager.getMosaicInfo(o,s.textureKey)},defines:{...m,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:s.instance.optionalAttributes,useComputeBuffer:!1};n.setShader(h),n.setPipelineState(u),n.submitDraw(o,s),n.setShader({...h,defines:{...m,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(u),n.submitDraw(o,s),n.setShader({...h,defines:{...m,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(u),n.submitDraw(o,s);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let p$5 = class p extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.LineMeshWriter,this.shaders={geometry:new B$1},this.symbologyPlane=S$2.LINE;}render(e,n){const{context:m,painter:h,pixelRatio:p}=e;h.setShader({shader:this.shaders.geometry,uniforms:{...d$5(e,n.target,n.instance.getInput().geometry),...h$8(e,n.target),antialiasingControls:n$6(p)},defines:{...y$3(e)},optionalAttributes:n.instance.optionalAttributes,useComputeBuffer:m$7(e)}),h.setPipelineState(M$1(e)),h.submitDraw(m,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
class A extends q$3{}e$2([l$4(9,j$1)],A.prototype,"accumulatedDistance",void 0),e$2([l$4(10,C$1)],A.prototype,"segmentDirection",void 0),e$2([l$4(11,H)],A.prototype,"tlbr",void 0);class R extends B$1{_getLineWidthRatio(t,e){const s=new j$1(o$4),a=j$2(t.bitset,F$7);return a.multiply(Bn(e,new j$1(.25))).add(new j$1(1).subtract(a)).divide(s)}_getSDFAlpha(t){const{halfWidth:e,normal:i,tlbr:s,patternSize:a,accumulatedDistance:n,lineWidthRatio:l}=t,h=a.x.multiply(new j$1(2)).multiply(l),y=bn(n.divide(h)),w=new j$1(.25).multiply(i.y).add(new j$1(.5)),f=Sn(s.xy,s.zw,new C$1(y,w)),b=k(se(this.mosaicInfo.texture,f)).subtract(new j$1(.5)).multiply(e),x=Zt(new j$1(.5).subtract(b),new j$1(0),new j$1(1));return new H(x)}_getPatternColor(t){const{halfWidth:e,normal:i,color:s,accumulatedDistance:a,patternSize:n,sampleAlphaOnly:l,tlbr:p}=t,w=n.y.multiply(new j$1(2).multiply(e).divide(n.x)),f=bn(a.divide(w)),b=new j$1(.5).multiply(i.y).add(new j$1(.5)),x=Sn(p.xy,p.zw,new C$1(b,f));let g=se(this.mosaicInfo.texture,x);return null!=this.visualVariableColor&&(g=xt(Ct(l,new j$1(.5)),new H(s.a),s)),g}vertex(t,e){const{segmentDirection:i,tlbr:s,bitset:a}=t,n=T$2(this,t),l=t.accumulatedDistance.divide(this.view.displayZoomFactor).add(ln(i,n.scaledOffset)),r=new C$1(s.z.subtract(s.x),s.w.subtract(s.y)),m=s.divide(this.mosaicInfo.size.xyxy),c=j$2(a,H$2),p=j$2(a,q$4),u=xt(Ct(c,new j$1(.5)),this._getLineWidthRatio(t,n.scaledHalfWidth),new j$1(1));return {...n,tlbr:m,patternSize:r,accumulatedDistance:l,isSDF:c,sampleAlphaOnly:p,lineWidthRatio:u,...this.maybeRunHittest(t,e,n.halfWidth)}}fragment(t){const{color:e,opacity:i,isSDF:s}=t,a=D$2(t,this.antialiasingControls.blur),n=xt(Ct(s,new j$1(.5)),this._getSDFAlpha(t),this._getPatternColor(t)),l=e.multiply(i).multiply(a).multiply(n);return this.getFragmentOutput(l,t)}}e$2([_$2(p$9)],R.prototype,"mosaicInfo",void 0),e$2([t$4(0,g$3(A)),t$4(1,g$3(q$5))],R.prototype,"vertex",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let h$3 = class h extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.TexturedLineMeshWriter,this.shaders={geometry:new R},this.symbologyPlane=S$2.LINE;}render(e,n){const{context:m,painter:u,pixelRatio:h}=e;u.setShader({shader:this.shaders.geometry,uniforms:{...d$5(e,n.target,n.instance.getInput().geometry),...h$8(e,n.target),antialiasingControls:n$6(h),mosaicInfo:u.textureManager.getMosaicInfo(m,n.textureKey)},defines:{...y$3(e)},optionalAttributes:n.instance.optionalAttributes,useComputeBuffer:m$7(e)}),u.setPipelineState(M$1(e)),u.submitDraw(m,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
class Q extends S$4{}e$2([l$4(3,H)],Q.prototype,"color",void 0),e$2([l$4(4,H)],Q.prototype,"outlineColor",void 0),e$2([l$4(5,C$1)],Q.prototype,"offset",void 0),e$2([l$4(6,C$1)],Q.prototype,"textureUV",void 0),e$2([l$4(7,H)],Q.prototype,"sizing",void 0),e$2([l$4(8,j$1)],Q.prototype,"placementAngle",void 0),e$2([l$4(9,j$1)],Q.prototype,"sizeRatio",void 0),e$2([l$4(10,C$1)],Q.prototype,"zoomRange",void 0);class W extends v$3{}e$2([l$4(12,C$1)],W.prototype,"offsetNextVertex1",void 0),e$2([l$4(13,C$1)],W.prototype,"offsetNextVertex2",void 0),e$2([l$4(14,C$1)],W.prototype,"textureUVNextVertex1",void 0),e$2([l$4(15,C$1)],W.prototype,"textureUVNextVertex2",void 0);class X extends F$5{}function Y(t,e,i,o){return e.multiply(t.x).add(i.multiply(t.y)).add(o.multiply(t.z))}function Z(t){return t.multiply(t).divide(128)}class $ extends P$2{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]};}vertex(t,e){const i=Z(t.sizing.x),o=Z(t.sizing.y),s=Z(t.sizing.z),l=t.placementAngle,r=j$2(t.bitset,o$6.bitset.isSDF),y=j$2(t.bitset,o$6.bitset.isMapAligned),h=j$2(t.bitset,o$6.bitset.scaleSymbolsProportionally),c=z$4(t.bitset,o$6.bitset.colorLocked),x=u$c(this,t.id),V=r$4(this,t.id,t.color,c).multiply(x),v=this.view.displayViewScreenMat3.multiply(new G$1(t.pos.xy,1)),w=t$9(this,t.id,s).divide(s),f=i.multiply(w),b=t.offset.xy.multiply(w);let S=o.multiply(h.multiply(w.subtract(1)).add(1));S=Un(S,Bn(f.subtract(.99),new j$1(0)));const g=Bn(S,new j$1(1)),C=Un(S,new j$1(1)),M=tt.fromRotation(l.multiply(c$5)),_=n$7(this,t.id),U=this._getViewRotationMatrix(y).multiply(_).multiply(M).multiply(new G$1(b.xy,0)),R=this.clip(t.id,t.zoomRange),N=new H(v.xy.add(U.xy),R,1),F=t.textureUV.divide(this.mosaicInfo.size),D=t.outlineColor.multiply(C),k=j$2(t.bitset,o$6.bitset.overrideOutlineColor),A=t.sizeRatio.multiply(f).multiply(.5);return {glPosition:N,color:V,textureUV:F,outlineColor:D,outlineSize:g,distanceToPx:A,isSDF:r,overrideOutlineColor:k,...this.maybeRunHittest(t,e,{pos:t.pos,size:f,sizeCorrection:w,isMapAligned:y,outlineSize:g,distanceToPx:A,isSDF:r})}}fragment(t){const e=this._getColor(t.textureUV,t);return this.getFragmentOutput(e,t)}hittest(t,e,i){return xt(St(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,o=new j$1(1).subtract(t);return e.multiply(t).add(i.multiply(o))}_getViewScreenMatrix(t){const e=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,o=new j$1(1).subtract(t);return e.multiply(t).add(i.multiply(o))}_getColor(t,e){return xt(Bt(e.isSDF,new j$1(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return se(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=se(this.mosaicInfo.texture,t),o=new j$1(.5).subtract(k(i)).multiply(e.distanceToPx).multiply(o$5),s=Zt(new j$1(.5).subtract(o),new j$1(0),new j$1(1)),l=e.color.multiply(s);let r=e.outlineSize;this.highlight&&(r=Bn(r,e.overrideOutlineColor.multiply(4)));const a=r.multiply(.5),p=Xt(o).subtract(a),d=Zt(new j$1(.5).subtract(p),new j$1(0),new j$1(1)),m=Sn(e.outlineColor,e.color,e.overrideOutlineColor).multiply(d);return new j$1(1).subtract(m.a).multiply(l).add(m)}_hittestSmallMarker(t,e,i){const{position:o,distance:s,smallSymbolDistance:l}=this.hittestRequest,r=s.subtract(l),{viewMat3:p,tileMat3:u}=this.view,n=p.multiply(u).multiply(new G$1(i.pos,1)).xy,d=i.size.multiply(.5);return sn(n,o).subtract(d).add(r)}_hittestMarker(t,e,i){const{pos:o,size:s,sizeCorrection:l,isMapAligned:r,outlineSize:p,isSDF:u,distanceToPx:d}=i,y=new G$1(t.offset.multiply(l),0),h=new G$1(e.offsetNextVertex1.multiply(l),0),c=new G$1(e.offsetNextVertex2.multiply(l),0),{viewMat3:x,tileMat3:V}=this.view,v=x.multiply(V).multiply(new G$1(o,1)),w=this._getViewScreenMatrix(r),f=v.add(w.multiply(y)).xy,z=v.add(w.multiply(h)).xy,C=v.add(w.multiply(c)).xy,M=this.hittestRequest.position,_=this.hittestRequest.distance,j=h$b(M.add(new C$1(yt(_),yt(_))),f,z,C),U=h$b(M.add(new C$1(0,yt(_))),f,z,C),D=h$b(M.add(new C$1(_,yt(_))),f,z,C),I=h$b(M.add(new C$1(yt(_),0)),f,z,C),O=h$b(M,f,z,C),k=h$b(M.add(new C$1(_,0)),f,z,C),A=h$b(M.add(new C$1(yt(_),_)),f,z,C),P=h$b(M.add(new C$1(0,_)),f,z,C),T=h$b(M.add(new C$1(_,_)),f,z,C),q=t.textureUV.divide(this.mosaicInfo.size),G=e.textureUVNextVertex1.divide(this.mosaicInfo.size),H$1=e.textureUVNextVertex2.divide(this.mosaicInfo.size),L={color:new H(1),outlineColor:new H(1),overrideOutlineColor:new j$1(1),outlineSize:p,distanceToPx:d,isSDF:u};let B=new j$1(0);return B=B.add(g$4(j).multiply(this._getColor(Y(j,q,G,H$1),L).a)),B=B.add(g$4(U).multiply(this._getColor(Y(U,q,G,H$1),L).a)),B=B.add(g$4(D).multiply(this._getColor(Y(D,q,G,H$1),L).a)),B=B.add(g$4(I).multiply(this._getColor(Y(I,q,G,H$1),L).a)),B=B.add(g$4(O).multiply(this._getColor(Y(O,q,G,H$1),L).a)),B=B.add(g$4(k).multiply(this._getColor(Y(k,q,G,H$1),L).a)),B=B.add(g$4(A).multiply(this._getColor(Y(A,q,G,H$1),L).a)),B=B.add(g$4(P).multiply(this._getColor(Y(P,q,G,H$1),L).a)),B=B.add(g$4(T).multiply(this._getColor(Y(T,q,G,H$1),L).a)),ee(B,new j$1(.05)).multiply(q$2(this.hittestRequest))}}e$2([K$2(f$9)],$.prototype,"visualVariableColor",void 0),e$2([K$2(h$a)],$.prototype,"visualVariableOpacity",void 0),e$2([K$2(d$3)],$.prototype,"visualVariableRotation",void 0),e$2([K$2(m$8)],$.prototype,"visualVariableSizeMinMaxValue",void 0),e$2([K$2(p$8)],$.prototype,"visualVariableSizeScaleStops",void 0),e$2([K$2(f$a)],$.prototype,"visualVariableSizeStops",void 0),e$2([K$2(l$5)],$.prototype,"visualVariableSizeUnitValue",void 0),e$2([_$2(p$9)],$.prototype,"mosaicInfo",void 0),e$2([t$4(0,g$3(Q)),t$4(1,g$3(W))],$.prototype,"vertex",null),e$2([t$4(0,g$3(X))],$.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let u$7 = class u extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.MarkerMeshWriter,this.shaders={geometry:new $},this.symbologyPlane=S$2.MARKER;}render(e,n){const{context:a,painter:m}=e;m.setShader({shader:this.shaders.geometry,uniforms:{...d$5(e,n.target,n.instance.getInput().geometry),...h$8(e,n.target),mosaicInfo:m.textureManager.getMosaicInfo(a,n.textureKey,!0)},defines:{...y$3(e)},optionalAttributes:n.instance.optionalAttributes,useComputeBuffer:m$7(e)}),m.setPipelineState(M$1(e)),m.submitDraw(a,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
class e{constructor(){this.computeAttributes={};}get locationsMap(){const t=new Map;for(const o in this.locations)t.set(o,this.locations[o].index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set(Object.keys(this.options));this._optionPropertyKeys=t;}return this._optionPropertyKeys}get _transformFeedbackBindings(){return []}get locationInfo(){if(!this._locationInfo){const o=this.locationsMap,e=Array.from(o.entries()).map((([t,o])=>`${t}.${o}`)).join("."),n=c$6(e);this._locationInfo={hash:n,locations:o};}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const[o,e]of this.locationsMap.entries())t.set("a_"+o,e);return t}getShaderKey(t,o,e){const n=Object.keys(e).filter((t=>e[t])).map((t=>`${t}_${e[t].toString()}`)).join("."),r=Object.keys(o).filter((t=>this.optionPropertyKeys.has(t))).join(".");return `${t.hash}.${n}.${r}`}getProgram(t,e,n,r){let i="",s="";for(const o in n)if(n[o]){const t="boolean"==typeof n[o]?`#define ${o}\n`:`#define ${o} ${n[o]}\n`;i+=t,s+=t;}return i+=this.vertexShader,s+=this.fragmentShader,new a$6(i,s,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(e),this._transformFeedbackBindings)}_getUniformBindings(t){const o=[];for(const e in this.required){const t=this.required[e];o.push({uniformHydrated:null,shaderModulePath:e,uniformName:e,uniformType:t.type,uniformArrayElementType:n$3(t),uniformArrayLength:r$1(t)});}for(const e in t){const i=this.options[e];if(t[e])for(const t in i){const s=i[t];o.push({uniformHydrated:null,shaderModulePath:`${e}.${t}`,uniformName:t,uniformType:s.type,uniformArrayElementType:n$3(s),uniformArrayLength:r$1(s)});}}return o}}const n$3=t=>"array"===t.type?t.elementType?.type:void 0,r$1=t=>"array"===t.type?t.size:void 0;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
const p$4={hittestDist:j$1,hittestPos:C$1},y$2={filterFlags:S$3,animation:S$3,visualVariableData:S$3,dataDriven0:S$3,dataDriven1:S$3,dataDriven2:S$3,gpgpu:S$3,size:j$1},d$2={displayViewScreenMat3:tt,displayViewMat3:tt,displayMat3:tt,viewMat3:tt,tileMat3:tt,displayZoomFactor:j$1,requiredZoomFactor:j$1,tileOffset:C$1,currentScale:j$1,currentZoom:j$1,metersPerSRUnit:j$1};let u$6 = class u extends e{constructor(){super(...arguments),this.vertexShader=n$8("materials/pie/pie.vert"),this.fragmentShader=n$8("materials/pie/pie.frag"),this.required={...y$2,...d$2,outlineWidth:j$1,colors:U,defaultColor:H,othersColor:H,outlineColor:H,donutRatio:j$1,sectorThreshold:j$1},this.options={hittestUniforms:p$4,visualVariableSizeMinMaxValue:{minMaxValueAndSize:H},visualVariableSizeScaleStops:{sizes:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8},values:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8}},visualVariableSizeStops:{sizes:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8},values:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:j$1},visualVariableOpacity:{opacities:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8},opacityValues:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8}}},this.locations={pos:{index:0,type:C$1},id:{index:1,type:G$1},bitset:{index:2,type:j$1},offset:{index:3,type:C$1},texCoords:{index:4,type:C$1},size:{index:5,type:C$1},referenceSize:{index:6,type:j$1},zoomRange:{index:7,type:C$1}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"};}setNumberOfFields(e){this.required.colors={...U.ofType(H,e),type:"array",elementType:H,size:e};}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let u$5 = class u extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.PieChartMeshWriter,this.shaders={geometry:new u$6},this.symbologyPlane=S$2.MARKER;}render(e,o){const{context:h,painter:m}=e,{instance:u,target:l}=o,n=this.shaders.geometry,S=u.getInput(),V=S.numberOfFields,g=m$7(e),p=h$8(e,l),f=y$3(e);n.setNumberOfFields(V),m.setShader({shader:n,uniforms:{...d$5(e,o.target,S.geometry),...p.storage,...p.view,hittestUniforms:p.hittestRequest?{hittestDist:p.hittestRequest?.distance,hittestPos:p.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!S.geometry.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!S.geometry.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!S.geometry.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!S.geometry.visualVariableSizeUnitValue,VV_OPACITY:!!S.geometry.visualVariableOpacity,HITTEST:g,highlight:p.highlight?1:0,...f,numberOfFields:V},optionalAttributes:{},useComputeBuffer:g}),m.setPipelineState(M$1(e)),m.submitDraw(h,o);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
let u$4 = class u extends e$1{constructor(){super(...arguments),this.meshWriter=a$5.TextMeshWriter,this.shaders={geometry:new K},this.symbologyPlane=S$2.TEXT;}render(e,o){const{context:n,painter:m}=e,u=y$3(e),h={shader:this.shaders.geometry,uniforms:{...d$5(e,o.target,o.instance.getInput().geometry),...h$8(e,o.target),mosaicInfo:m.textureManager.getMosaicInfo(n,o.textureKey)},defines:{...u,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:o.instance.optionalAttributes,useComputeBuffer:m$7(e)};m.setShader(h),m.setPipelineState(M$1(e)),m.submitDraw(n,o),m.setShader({...h,defines:{...u,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),m.submitDraw(n,o),m.setShader({...h,defines:{...u,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),m.submitDraw(n,o);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
const h$2={fill:new m$5("fill"),patternFill:new h$5("patternFill"),complexFill:new h$6("complexFill"),outlineFill:new l$3("outlineFill"),patternOutlineFill:new u$9("patternOutlineFill"),complexOutlineFill:new u$a("complexOutlineFill"),marker:new u$7("marker"),pieChart:new u$5("pieChart"),line:new p$5("line"),texturedLine:new h$3("texturedLine"),text:new u$4("text"),label:new u$8("label"),heatmap:new p$6("heatmap"),dotDensity:new f$7("dotDensity")};function F(){for(const e in h$2){h$2[e].startup();}}function T(e){for(const i in h$2){h$2[i].shutdown(e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
function n$2(n,t){const r=n.slice(0,t),e=t-r.length;for(let o=0;o<e;o++){const n=r[r.length-1];r.push(n);}return r}function t$3(n){if(!n)return [0,0,0,0];const{r:t,g:r,b:e,a:o}=n;return [t*(o/255),r*(o/255),e*(o/255),o]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
const l$1=8,s$2=l$1-2,n$1=()=>s$5.getLogger("esri.views.2d.layers.features.support.rendererUtils");function u$3(e){return e.map((e=>a$3(e)?i$1(e.clone()):e))}function a$3(e){return ("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function i$1(e){return e.stops=b$2(e.type,e.stops??[]),e}function p$3(e,o,r){return (1-r)*e+r*o}function c$3(e,o){const[t,...l]=o,n=l.pop(),u=l[0].value,a=l[l.length-1].value,i=(a-u)/s$2,c=[];for(let s=u;s<a;s+=i){let t=0;for(;s>=l[t].value;)t++;const n=l[t],u=o[t-1],a=s-u.value,i=n.value===u.value?1:a/(n.value-u.value);if("color"===e){const e=l[t],r=o[t-1],n=e.color.clone();n.r=p$3(r.color.r,n.r,i),n.g=p$3(r.color.g,n.g,i),n.b=p$3(r.color.b,n.b,i),n.a=p$3(r.color.a,n.a,i),c.push({value:s,color:n,label:e.label});}else if("size"===e){const e=l[t],n=o[t-1],u=o$7(e.size),a=p$3(o$7(n.size),u,i);c.push({value:s,size:a,label:e.label});}else {const e=l[t],r=p$3(o[t-1].opacity,e.opacity,i);c.push({value:s,opacity:r,label:e.label});}}return [t,...c,n]}function f$3(e){const[o,...r]=e,t=r.pop();for(;r.length>s$2;){let e=0,o=0;for(let t=1;t<r.length;t++){const l=r[t-1],s=r[t],n=Math.abs(s.value-l.value);n>o&&(o=n,e=t);}r.splice(e,1);}return [o,...r,t]}function b$2(e,o){return o.length<=l$1?o:(n$1().warn(`Found ${o.length} Visual Variable stops, but MapView only supports ${l$1}. Displayed stops will be simplified.`),o.length>2*l$1?c$3(e,o):f$3(o))}function g(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:o,supportsColorBufferHalfFloat:r}=t$a();return e&&o||r}function m$2(o){if(!o)return !0;switch(o.type){case"dot-density":break;case"heatmap":if(!g()){const o=t$a(),r=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((e=>!o[e])).join(", ");return n$1().errorOnce(new s$4("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${r}`)),!1}}return !0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
const u$2=1.25,o$2=128,p$2=128;function c$2(e){if(!e.stops?.length)return null;const a=e.stops.sort(((e,a)=>e.value-a.value)),i=n$2(a,8),s=i.map((({value:e})=>e)),l=i.map((({color:e})=>t$3(e)));return {values:s,colors:l}}function v$1(e){if(!e.stops?.length)return null;const a=e.stops.sort(((e,a)=>e.value-a.value)),i=n$2(a,8);return {opacityValues:i.map((({value:e})=>e)),opacities:i.map((({opacity:e})=>e))}}function V$1(e){return {rotationType:"geographic"===e.rotationType?i$4.Geographic:i$4.Arithmatic}}function f$2(a){if(!a.stops?.length)return null;if(a.stops.some((e=>e.useMaxValue||e.useMinValue)))return (i,l)=>{const r=i.statisticsByLevel.get(l.key.level),n=a.stops.map((i=>({value:i.useMaxValue?r?.get(a.field)?.maxValue??0:i.useMinValue?r?.get(a.field)?.minValue??0:i.value,size:i.size?u$d(i.size):i$5}))).sort(((e,a)=>e.value-a.value)),u=n$2(n,8);return {values:u.map((({value:e})=>e)),sizes:u.map((({size:e})=>e))}};const i=a.stops.sort(((e,a)=>e.value-a.value)),l=n$2(i,8);return {values:l.map((({value:e})=>e)),sizes:l.map((({size:a})=>u$d(a)))}}function S$1(e){return s=>{const{state:l}=s;return {unitValueToPixelsRatio:W$1(l.spatialReference)/m$9[e.valueUnit]/l.resolution}}}function b$1(e,a){const i=a.length;if(e<a[0].value||1===i)return a[0].size;for(let s=1;s<i;s++)if(e<a[s].value){const i=(e-a[s-1].value)/(a[s].value-a[s-1].value);return a[s-1].size+i*(a[s].size-a[s-1].size)}return a[i-1].size}function z$1(a){const{minDataValue:i,maxDataValue:s,minSize:l,maxSize:t}=a;if("object"==typeof l&&"object"==typeof t)return (a,r)=>{const n=a.state.scale,u=u$d(b$1(n,l.stops)),o=u$d(b$1(n,t.stops));return {minMaxValueAndSize:[i,s,u,o]}};if("object"==typeof l||"object"==typeof t)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return {minMaxValueAndSize:[i,s,u$d(l),u$d(t)]}}const x$1={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function h$1(e,a=p$2,i=u$2){if(e.visualVariableSizeMinMaxValue)return e.visualVariableSizeMinMaxValue instanceof Function?o$2:Math.max(e.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,a);if(e.visualVariableSizeScaleStops){if(e.visualVariableSizeScaleStops instanceof Function)return o$2;const s=e.visualVariableSizeScaleStops.sizes;return Math.max(s[s.length-1]*i,a)}if(e.visualVariableSizeStops){if(e.visualVariableSizeStops instanceof Function)return o$2;const s=e.visualVariableSizeStops.sizes;return Math.max(s[s.length-1]*i,a)}return e.visualVariableSizeUnitValue?2*o$2:0}function y$1(e){const a={...x$1};if(!e||!("visualVariables"in e)||!e.visualVariables)return a;for(const i of u$3(e.visualVariables))switch(i.type){case"color":a.visualVariableColor=c$2(i);break;case"opacity":a.visualVariableOpacity=v$1(i);break;case"rotation":a.visualVariableRotation=V$1(i);break;case"size":switch(M(i)){case"field-stops":a.visualVariableSizeStops=f$2(i);break;case"scale-stops":"outline"===i.target?a.visualVariableSizeOutlineScaleStops=f$2(i):a.visualVariableSizeScaleStops=f$2(i);break;case"min-max":a.visualVariableSizeMinMaxValue=z$1(i);break;case"unit-value":a.visualVariableSizeUnitValue=S$1(i);}break;default:console.error("Unable to handle VV type");}return a}function M(e){if("number"==typeof e.minDataValue&&"number"==typeof e.maxDataValue&&null!=e.minSize&&null!=e.maxSize)return "min-max";if((e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops))return "scale-stops";if((null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels))return "field-stops";if((null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit)return "unit-value";throw new Error("InternalError: Found unknown sizeVV type")}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
function a$2(a){return !!(a.visualVariableSizeMinMaxValue||a.visualVariableSizeScaleStops||a.visualVariableSizeStops||a.visualVariableSizeUnitValue||a.visualVariableSizeOutlineScaleStops)}function i(a){return !!a.visualVariableRotation}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
function s$1(e){return e.minScale||e.maxScale?{minScale:e.minScale??0,maxScale:e.maxScale??0}:null}function t$2(e){if(null==e)return null;if(Array.isArray(e)){const[a,i,l,o]=e;return [a,i,l,255*o]}return "string"==typeof e?e:{...e,defaultValue:t$2(e?.defaultValue)}}async function n(a,i){const{cimResourceManager:l,cimAnalyzer:o,scaleExpression:r}=i.schemaOptions;await Promise.all(K$3.fetchResources(a.symbol,l,[]));const t=o.analyzeSymbolReference(a,!1),n={scaleInfo:s$1(a),scaleExpression:r},u=[];for(const e of t)switch(e.type){case"marker":u.push(...c$1(e,i,n));break;case"fill":u.push(...m$1(e,i,n));break;case"line":u.push(...b(e,i,n));break;case"text":u.push(...v(e,i,n));}return u}function c$1(e,a,o){const{uniforms:r,schemaOptions:s}=a,{store:t}=s,n=e.isOutline?{...x$1,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops}:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,visualVariableRotation:r.visualVariableRotation};return u$1(t.ensureInstance(h$2.marker,{geometry:n},{zoomRange:!!o.scaleInfo}),e,r,o)}function u$1(e,i,l,{scaleInfo:s,scaleExpression:n}){const c=a$2(l);return [e.createMeshInfo({params:{size:i.size,scaleX:i.scaleX,anchorX:i.anchorPoint.x,anchorY:i.anchorPoint.y,angle:i.rotation,color:t$2(i.color)??[0,0,0,0],colorLocked:i.colorLocked,frameHeight:i.frameHeight,widthRatio:i.widthRatio,scaleInfo:s,offsetX:i.offsetX,offsetY:i.offsetY,outlineColor:t$2(i.outlineColor)??[0,0,0,0],outlineSize:i.outlineWidth,referenceSize:i.referenceSize||t$b.CIMVectorMarker.size,rotateClockwise:i.rotateClockwise,scaleFactor:n??1,sizeRatio:i.sizeRatio,alignment:i.alignment,isAbsoluteAnchorPoint:i.isAbsoluteAnchorPoint,scaleSymbolsProportionally:i.scaleSymbolsProportionally,sprite:i.spriteRasterizationParam,hasSizeVV:c,placement:i.markerPlacement,effects:i.effects?{type:"cim-effect-infos",effectInfos:i.effects}:null,transforms:i.transform,minPixelBuffer:h$1(l)}})]}function f$1(e,a,l){const{uniforms:o,schemaOptions:r}=a,{store:s}=r;return p$1(s.ensureInstance(h$2.fill,{geometry:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity}},{zoomRange:!!l.scaleInfo}),e,l)}function p$1(e,a,{scaleInfo:i}){return [e.createMeshInfo({params:{color:t$2(a.color)??[0,0,0,0],scaleInfo:i,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null}})]}function m$1(e,a,l){if(!e.spriteRasterizationParam)return f$1(e,a,l);const{uniforms:o,schemaOptions:r}=a,{store:s}=r;return S(s.ensureInstance(h$2.complexFill,{geometry:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity}},{zoomRange:!!l.scaleInfo}),e,null!=o.visualVariableColor,l)}function S(e,a,i,{scaleInfo:l}){if(!a.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const o=!!a.hasUnresolvedReplacementColor&&(!i||a.colorLocked),r=a.sampleAlphaOnly&&!o,s=a.spriteRasterizationParam;return [e.createMeshInfo({params:{color:t$2(a.color)??[0,0,0,0],height:a.height,aspectRatio:a.scaleX,offsetX:a.offsetX,offsetY:a.offsetY,scaleX:1,scaleY:1,angle:a.angle,applyRandomOffset:a.applyRandomOffset,sampleAlphaOnly:r,scaleProportionally:"CIMHatchFill"===s.resource.type,sprite:s,scaleInfo:l,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null}})]}function b(e,a,o){const{uniforms:r,schemaOptions:s}=a,{store:t}=s,n=e.isOutline?{...x$1,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops}:{visualVariableColor:e.colorLocked?null:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue},c={geometry:n},u=!!(n.visualVariableSizeMinMaxValue||n.visualVariableSizeScaleStops||n.visualVariableSizeStops||n.visualVariableSizeUnitValue);if(!e.spriteRasterizationParam){return h(t.ensureInstance(h$2.line,c,{zoomRange:!!o.scaleInfo}),e,u,o)}return z(t.ensureInstance(h$2.texturedLine,c,{zoomRange:!!o.scaleInfo}),e,u,o)}function V(e,a,{scaleInfo:i}){return {params:{color:t$2(e.color)??[0,0,0,0],width:e.width,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,scaleInfo:i,hasSizeVV:a,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null}}}function h(e,a,i,l){if(a.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");return [e.createMeshInfo({params:V(a,i,l).params})]}function z(e,a,i,l){const{spriteRasterizationParam:o,scaleDash:r,sampleAlphaOnly:s}=a;if(!o)throw new Error("InternalError: Sprite should be defined");return [e.createMeshInfo({params:{...V(a,i,l).params,shouldScaleDash:r??!1,shouldSampleAlphaOnly:s,isSDF:"CIMPictureStroke"!==o.resource.type,sprite:o}})]}function v(e,a,l){const{uniforms:o,schemaOptions:r}=a,{store:s}=r;return y(s.ensureInstance(h$2.text,{geometry:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity,visualVariableRotation:o.visualVariableRotation,visualVariableSizeMinMaxValue:o.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:o.visualVariableSizeScaleStops,visualVariableSizeStops:o.visualVariableSizeStops,visualVariableSizeUnitValue:o.visualVariableSizeUnitValue}},{zoomRange:!!l.scaleInfo,referenceSymbol:!1,clipAngle:!1}),e,o,l)}function y(e,a,i,{scaleInfo:l,scaleExpression:r}){return [e.createMeshInfo({params:{boxBackgroundColor:t$2(a.backgroundColor),boxBorderLineColor:t$2(a.borderLineColor),boxBorderLineSize:a.borderLineWidth??0,color:t$2(a.color)??[0,0,0,0],offsetX:a.offsetX,offsetY:a.offsetY,postAngle:a.angle,fontSize:a.size,referenceSize:a.referenceSize,decoration:a.decoration,haloColor:t$2(a.outlineColor)??[0,0,0,0],haloFontSize:a.outlineSize,lineWidth:a.lineWidth||512,lineHeightRatio:1,horizontalAlignment:a.horizontalAlignment??"center",verticalAlignment:a.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:a.textRasterizationParam,scaleInfo:l,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,placement:a.markerPlacement,transforms:a.transform,scaleFactor:r??1,minPixelBuffer:h$1(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
function t$1(e,i){return {type:"simple",filters:i,capabilities:{maxTextureSize:t$a().maxTextureSize},bindings:a$1(e)}}function s(e){switch(e){case"opacity":return L$2.OPACITY;case"color":return L$2.COLOR;case"rotation":return L$2.ROTATION;case"size":return L$2.SIZE;default:return null}}function a$1(e){if(!e)return [];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(e);case"dot-density":return o$1(e);case"pie-chart":return l(e);case"heatmap":return u(e)}}function o$1(e){const i=[];for(const n of e.attributes)i.push({binding:i.length,expression:n.valueExpression,field:n.field});return i}function l(e){const i=c(e);let n=4;for(const r of e.attributes)i.push({binding:n++,expression:r.valueExpression,field:r.field});return i}function u({valueExpression:e,field:i}){return e||i?[{binding:0,expression:e,field:i}]:[]}function c(i){if(!("visualVariables"in i)||!i.visualVariables?.length)return [];return u$3(i.visualVariables).map((e=>x(e))).filter(q$6)}function p(e){return "$view.scale"===e.valueExpression?null:{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}function f(e){return {binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function d$1(e){return {binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function m(e){return {binding:s(e.type),expression:e.valueExpression,field:e.field}}function x(e){switch(e.type){case"size":return p(e);case"color":return f(e);case"opacity":return d$1(e);case"rotation":return m(e)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
function t(e){return e.some((e=>e.globalId))}function r(e){return e.filter((e=>!e.error)).map((e=>e.objectId??e.globalId)).filter((e=>null!=e))}function o(e,s){const t=new Set(e);for(const r of s.values())t.add(r);return t}function d(e,s){const t=new Set(e);for(const r of s.values())t.delete(r);return t}class a{constructor(t){this.updateTracking=new d$6({debugName:"FeatureCommandQueue"}),this._hasGlobalIds=!1,this._queueProcessor=new _$4({concurrency:1,process:t.process});}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear();}clear(){this._queueProcessor.clear();}async push(e){return this.updateTracking.addPromise(this._doPush(e))}async _doPush(e){const s=this._queueProcessor,t=s.last(),r=[];switch(e.type){case"update":if(t?.type===e.type)return;r.push(s.push(e));break;case"edit":{const o="processed-edit"===t?.type?t:null;o&&s.popLast();const d=this._mergeEdits(o,e);for(const e of d)e&&r.push(s.push(e));break}}await Promise.all(r);}_mergeEdits(e,s){const{addedFeatures:a,deletedFeatures:i,updatedFeatures:u}=s.edits;if(this._hasGlobalIds=this._hasGlobalIds||t(a)||t(u)||t(i),this._hasGlobalIds){return [e,{type:"processed-edit",edits:{addOrModified:[...a,...u],removed:i}}]}const n=new Set(r(e?.edits.addOrModified??[])),c=new Set(r(e?.edits.removed??[])),p=new Set([...r(a),...r(u)]),l=new Set(r(i));return [{type:"processed-edit",edits:{addOrModified:Array.from(o(d(n,l),p)).map((e=>({objectId:e}))),removed:Array.from(o(d(c,p),l)).map((e=>({objectId:e})))}}]}}

export { F, S, T, h as a, a as b, y$1 as c, t$3 as d, h$1 as e, a$2 as f, c as g, h$2 as h, i, m$2 as m, n, p$1 as p, s$1 as s, t$1 as t, u$1 as u, x$1 as x, y, z };
