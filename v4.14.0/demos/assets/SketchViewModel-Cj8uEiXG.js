const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-C4xVb09U.js","./main-DJoDgHy1.js","./preload-helper-DMGCcr4D.js","./main-DLalkaVh.css","./Cyclical-CcbL6dUf.js","./quantityUtils-m4o856R2.js","./elevationInfoUtils-DDBvXGGl.js","./ElevationInfo-rZECiOfs.js","./lengthUtils-DTCBAnCf.js","./angularMeasurementUtils-CTzK9eL6.js","./vec2f64-Cgb6qxNH.js","./vec32-Cug0iGhu.js","./projectVectorToVector-CKUUwHjx.js","./projectionUtils-BnZegCzy.js","./projectBuffer-CvUxwxfU.js","./zscale-uj2q40qk.js","./projectPointToVector-DRrpaIHi.js","./geodesicUtils-B3wsgxFJ.js","./UpdatingHandles-B-5OkGd0.js","./GraphicsLayer-DyM81qeL.js","./GraphicsCollection-CL3D25Q2.js","./BlendLayer-CyNfx66v.js","./layerContainerType-CSXZNpHb.js","./jsonUtils-CstQvJeQ.js","./parser-BnRWC6yN.js","./mat4f32-Djp3mnm5.js","./mat4-2MTFrsuN.js","./ScaleRangeLayer-B5DeYT7P.js","./editableLayers-C0xHqn3u.js","./utils-CjSTERX-.js","./Queue-DaUDwAqr.js","./signal-BaW-Bcbs.js","./Version-C6XZCcoI.js","./asyncUtils-dxk0lkVi.js","./Query-BDCdTeKY.js","./Field-BjIZIuuv.js","./fieldType-B3Jc2rgt.js","./vec42-C8IJxs4z.js","./vec4f64-DPb6J-GU.js","./plane-ZGj-8_WI.js","./vectorStacks-BbylamMy.js","./quatf64-aQ5IuZRd.js","./sphere-Dgp7tg6C.js","./geodeticLengthOperator-D9IB3V30.js","./geodeticCurveType-CirnHLSB.js","./earcut-D9gy186-.js","./triangle-BpZbkAPp.js","./lineSegment-gD1fcp9j.js","./spatialReferenceEllipsoidUtils-CJ_KWh8h.js","./GridSnappingEngine-6DACG6f9.js","./normalizeUtils-CoGHxVg9.js","./normalizeUtilsCommon-CbZwzlMS.js","./utils-D__exs9p.js","./utils-CuKrfAwA.js","./scaleUtils-BIpak6C4.js","./gridUtils-Bb5ziAsN.js","./FeatureSnappingEngine-DseCbdqp.js","./mapCollectionUtils-fZAslg29.js","./FeatureFilter-CWgxAbmp.js","./floorFilterUtils-DKzVzLpH.js","./layerViewUtils-tCQ5DBJc.js","./geometryEngine-Bflaz5q1.js","./geometryEngineBase-D6Q0ncCQ.js","./_commonjsHelpers-DCkdB7M8.js","./editingTools-wFUM0QGU.js","./SnappingVisualizer2D-Cck5DmdD.js","./TooltipInfoWithCoordinates-Opjmy1R-.js","./PointSnappingHint-CCsHqFeQ.js","./SketchTooltipInfo-DGfQgLlk.js","./messages-DyY-tQe4.js","./MeshTransform-B-tQMQ6t.js","./quat-BxA_vG_d.js","./axisAngleDegrees-BzmdP-S6.js","./meshVertexSpaceUtils-CUoYVWsV.js","./MeshLocalVertexSpace-BbFfCj73.js","./modeUtils-BSBMAsDr.js","./jsxFactory-JatJKb6K.js","./intl-CnfmQOd0.js","./uuid-Oe6SV2kF.js","./sanitizerUtils-BSv1Bmu5.js","./jsxFactory-CQED0rIl.css","./a11yUtils-CquyW-1D.js","./unitFormatUtils-1eLecaQL.js","./getDefaultUnitForView-DJ7H0xfM.js","./index-KtbunTJY.js","./dynamic-import-helper-BheWnx7M.js","./draw-store-B_Xm3QQg.js","./drapedUtils-D9FV6pde.js","./utils-BQBvadb7.js","./widget-DO5zAVY-.js","./substitute-DiZpM09e.js","./editPlaneUtils-DEYb9p0V.js","./drawSurfaces-CqE9gWGv.js","./ReactiveSet-mM5qFKTN.js","./diffUtils-rhP3e9jP.js","./SnappingContext-BgZQMltr.js","./rotate-BGPDlZHz.js","./curveOperationUtils-BF870piJ.js","./hydratedFeatures-D4DG5p2d.js","./Scheduler-BvhG-7pC.js","./debugFlags-XlpYn9IJ.js","./createUtils-2nq9FQ8U.js","./distanceOperator-D0D9pPNm.js","./Point2D-Cl-0kgBQ.js","./Distance2DCalculator-CXhBP-8I-BxSce69-.js","./ProjectionTransformation-CQdCRDfR.js","./Envelope2D-D_vzSDeK.js","./Transformation2D-BcDHHNrs.js","./SimpleGeometryCursor-B92kdZ15.js","./OperatorDefinitions-DP7_WWTp.js","./apiConverter-x7K4DQXS.js","./jsonConverter-CV1U2Tkg.js","./simplifyOperator-DB305ZCK.js","./operatorSimplify-DwLnpJ6B.js","./mat2d-CaJtLH6t.js","./mat2df64-DJ_RMjZ3.js","./boundedPlane-UK1b1u7r.js","./cimSymbolUtils-C1-1ehAO.js","./utils-DQaLv0i_.js","./defaultCIMValues-XI-Li77m.js","./GraphicManipulator-Dpi_bwqe.js","./colorUtils-DQh96YDI.js","./drawUtils-7DoleIH8.js","./ImageMaterial.glsl-Da3F2gho.js","./TextOverlayItem-CloiNGkN.js","./frustum-B_Ll4lwa.js","./RibbonLine.glsl-BXFVmG2S.js","./orientedBoundingBox-xlj6ju9L.js","./computeTranslationToOriginAndRotation-Dx243EEh.js","./OutputColorHighlightOID.glsl-DSlKYjnU.js","./enums-DQOO6RKE.js","./Texture-C3mjBkZn.js","./Indices-CM2ekkry.js","./BufferView-DnH5Gqfb.js","./renderState-CKc66y4x.js","./glsl-B5bJgrnA.js","./VertexAttributeLocations-BfZbt_DV.js","./VertexElementDescriptor-BLyltQyJ.js","./Octree-CTNbXerf.js","./InterleavedLayout-CfXRndFj.js","./types-BKo2foNY.js","./HUDMaterial.glsl-CFgSPQMx.js","./vec3f32-WCVSSNPR.js","./ShaderBuilder-Dc4c6H1-.js","./DefaultLayouts-BAQaB4os.js","./triangulationUtils-Bmffrtnj.js","./deduplicate-F4yiD39V.js","./VertexArrayObject-BWHOWiV7.js","./memoryEstimations-DnGGRmy9.js","./BufferObject-DEGhSybX.js","./VertexBuffer-QqpGylFq.js","./NestedMap-B93H1Ttm.js","./Texture-BoG_V68C.js","./videoUtils-Bzw4UqaM.js","./requestImageUtils-BbPaa3gt.js","./sdfPrimitives-DGUslxRD.js","./SelectedVertexTooltipInfo-BEtG0Iv9.js","./TranslateTooltipInfo-teWOWBXL.js","./utils-Bw2S51du.js","./LRUCache-BDIlOjQb.js","./MemCache-BowPj2eG.js","./ExtentScaleTooltipInfo-BwirBhjF.js","./LineCallout.glsl-CYa4vQBU.js","./projectionUtils-SE88fSyt.js","./HeightModelInfo-BekXgrjo.js","./visualVariableUtils-CeC-FImk.js","./dehydratedFeatures-DY61lnCU.js","./UniqueValueRenderer-3sERMAnY.js","./commonProperties-Ck_wGj36.js","./colorRamps-DW3enE7O.js","./ColorStop-DbnRkCet.js","./RendererLegendOptions-UgMlxOFt.js","./styleUtils-Bz_FA9wX.js","./rendererConversion-DPyZn_Mz.js","./RealisticTree.glsl-V_-htuid.js","./DefaultMaterial-CTYFH2eh.js","./edgeUtils-Boo9nFn3.js","./OptimizedFeature-C_Me_p-Z.js","./OptimizedGeometry-BgrwHKJJ.js","./optimizedFeatureQueryEngineAdapter-D_Z_0wcF.js","./vec2f32-CaVKkSa6.js","./featureConversionUtils-B0UBwPuJ.js","./OptimizedFeatureSet-BR8EEvDc.js","./PooledRBush-Cplh98C5.js","./quickselect-QQC62dOK.js","./popupUtils-CYv0yvZp.js","./LayerView-DRMa8wFV.js","./highlightOptionsUtils-B1loVEcI.js","./GraphicMover-C_OtEDHr.js","./Box-BLSlNZpm.js","./settings-DpS951fp.js","./Reshape-VJsb3PDY.js","./symbolUtils-B68D4bLk.js","./mat2df32-Dpt2CT5P.js"])))=>i.map(i=>d[i]);
import{_ as P}from"./preload-helper-DMGCcr4D.js";import{V as pe,_ as c,Y as h,Z as R,jZ as Hn,n1 as In,j_ as Un,cU as ot,a0 as Ii,bC as lt,O as _e,i as Ui,fh as Nn,aw as de,fg as $e,cv as jn,nY as Vn,jV as qn,ee as L,kA as Q,lZ as zn,nZ as Ni,ky as Me,kz as we,l_ as Fn,aB as v,c4 as Zn,aA as Ue,aJ as le,my as Wn,kB as Bn,hZ as ji,bL as Vi,gQ as qi,cZ as Kn,d6 as Jn,hu as Xn,n_ as yi,kx as Yn,h9 as Qn,gR as er,aF as zi,T as ft,aH as tr,eH as zt,az as ir,aa as $t,eO as nr,gz as rr,d3 as sr,gu as ar,hs as or,n$ as lr,lM as Fi,fx as pr,ay as Ft,h6 as cr,da as gi,dc as hr,d8 as ur,o0 as dr,o1 as yr,hW as gr,a9 as Ze,ax as fr,X as Et,e as fi,o2 as mr,hV as vr,o3 as K,eh as mi,s as _r,j4 as vi,cw as br,eP as _i,ha as Ae}from"./main-DJoDgHy1.js";import{h as wr}from"./UpdatingHandles-B-5OkGd0.js";import{W as Ht,N as Sr,J as Tr,G as $r,L as Er}from"./projectionUtils-BnZegCzy.js";import Or from"./GraphicsLayer-DyM81qeL.js";import{e as Gr}from"./editableLayers-C0xHqn3u.js";import{g as bi,f as M,r as Mr,c as xr,n as wi,a as O}from"./utils-CjSTERX-.js";import{d as kr}from"./asyncUtils-dxk0lkVi.js";import{E as Ar,b as Zi,I as Cr,U as Ee}from"./elevationInfoUtils-DDBvXGGl.js";import{i as Wi,t as Ne,n as it}from"./projectVectorToVector-CKUUwHjx.js";import{v as It,R as I,P as H,q as A,o as ee,_ as pt,Z as Ut,c as mt,s as Zt,p as He,H as E,J as Pr,j as Bi,A as Rr,u as Dr,I as Lr}from"./vec32-Cug0iGhu.js";import{b as Hr}from"./Query-BDCdTeKY.js";import{n as B,r as nt,l as Ir}from"./vec2f64-Cgb6qxNH.js";import{s as Ur,j as Nr}from"./vec42-C8IJxs4z.js";import{n as jr}from"./vec4f64-DPb6J-GU.js";import{i as Vr}from"./projectBuffer-CvUxwxfU.js";import{j as Nt,q as Wt,b as Bt,y as Ki,R as qr,v as zr}from"./geodesicUtils-B3wsgxFJ.js";import{U as vt,j as V,W as jt,a as Ji,J as Xi,O as Fr,w as Yi,X as Zr,R as Qi,k as Kt,d as Wr,T as Br}from"./plane-ZGj-8_WI.js";import{X as Kr,q as Jr,T as Xr,c as Yr}from"./sphere-Dgp7tg6C.js";import{a as fe,l as Jt}from"./quantityUtils-m4o856R2.js";import{m as Qr,l as en}from"./geodeticLengthOperator-D9IB3V30.js";import{e as es}from"./earcut-D9gy186-.js";import{v as ts}from"./triangle-BpZbkAPp.js";import{c as is,a as ns}from"./spatialReferenceEllipsoidUtils-CJ_KWh8h.js";let Se=class extends pe{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],Se.prototype,"length",void 0),c([h()],Se.prototype,"verticalLength",void 0),c([h()],Se.prototype,"area",void 0),Se=c([R("esri.views.interactive.sketch.Units")],Se);const ct=Se;let he=class extends pe{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?"relative-bilateral":"relative";case"absolute":return"absolute"}}get displayUnits(){return this._get("displayUnits")??new ct}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new ct}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],he.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],he.prototype,"relativeDirectionIsBilateral",void 0),c([h()],he.prototype,"effectiveDirectionMode",null),c([h({type:ct,nonNullable:!0})],he.prototype,"displayUnits",null),c([h({type:ct,nonNullable:!0})],he.prototype,"inputUnits",null),he=c([R("esri.views.interactive.sketch.SketchValueOptions")],he);const Xt=he;function Si(t){switch(t){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the symbol type is not supported"}return""}function rs(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return 1;const e=t.operations?.data.type;if(!e)return 3;switch(e){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}return 0}function ss(t){return as(t).result}function as(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return{result:1};if(!t.operations)return{result:2};const e=t.operations.data.type,i=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:0,geometry:i}:{result:3}}function os(t){if(t.layer?.type!=="graphics")return 1;if(t.geometry==null)return 2;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return e&&e.some(i=>i.type==="object")?0:4}function Ti(t,e,i){if(!e||!t?.map)return;const{map:n}=t;n.layers.find(s=>s===e)||n.add(e,i)}function vo(t,e){const i=e?.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(n=>{const r=n.layer;return r===i||"sublayers"in r&&r.sublayers!=null&&r.sublayers.includes(i)})}function _o(t){return Gr(t)||Hn(t)||In(t)||Un(t)}let rt=class extends pe{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],rt.prototype,"enabled",void 0),rt=c([R("esri.views.interactive.sketch.SketchLabelOptions")],rt);const Yt=rt;let Ie=class extends pe{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],Ie.prototype,"mode",void 0),Ie=c([R("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Ie);let C=class extends pe{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],C.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"totalLength",void 0),C=c([R("esri.views.interactive.sketch.SketchTooltipVisibleElements")],C);const tn=C;let D=class extends pe{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Ie,this.placement="auto",this.offset=null,this.visibleElements=new tn,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],D.prototype,"enabled",void 0),c([h()],D.prototype,"forceEnabled",void 0),c([h()],D.prototype,"effectiveEnabled",null),c([h()],D.prototype,"helpMessage",void 0),c([h()],D.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],D.prototype,"inputEnabled",void 0),c([h({type:Ie,nonNullable:!0})],D.prototype,"elevation",void 0),c([h()],D.prototype,"placement",void 0),c([h()],D.prototype,"offset",void 0),c([h({type:tn,nonNullable:!0})],D.prototype,"visibleElements",void 0),c([h()],D.prototype,"visualVariables",void 0),c([h()],D.prototype,"xyMode",void 0),D=c([R("esri.views.interactive.sketch.SketchTooltipOptions")],D);const Qt=D;let Te=class extends pe{constructor(e){super(e),this.labels=new Yt,this.tooltips=new Qt,this.values=new Xt}};c([h({nonNullable:!0,type:Yt})],Te.prototype,"labels",void 0),c([h({nonNullable:!0,type:Qt})],Te.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:Xt})],Te.prototype,"values",void 0),Te=c([R("esri.views.interactive.sketch.SketchOptions")],Te);const nn=Te;function rn(t,e,i){return U(t,e,i)}function U(t=0,e=0,i=0){return ot(t,e,i)}function Eo(t){return t}function Oo(t){return t}function ge(t,e,i){return ot(t,e,i)}function Oe(t){const[e,i,n]=t;return t.length>3?[e,i,n,t[3]]:[e,i,n]}function Ot(t){return t[3]=1|((t.length>3?t[3]:void 0)??0),t}function Go(t){return!!(1&((t.length>3?t[3]:void 0)??0))}function $i(t,e,{coordinateHelper:i,elevationInfo:n},r){return t?Le(i.vectorToDehydratedPoint(t,ls),e,n,r):null}function Le(t,e,i,n=U()){return n[0]=t.x,n[1]=t.y,n[2]=t.z??0,e==null||(e.type==="2d"?n[2]=0:n[2]=Ar(e,t,i,Ee)??0),n}function Mo(t,e,i){return i?(Wi(i,t[0],t[1],t[2],e),i):Ne(t[0],t[1],t[2],e)}function Ei(t,e,{z:i,m:n},r,s){const{spatialReference:l,elevationInfo:p}=r;let a;i==null&&n==null?a=void 0:e==null||e.type==="2d"?a=i??void 0:a=Zi(e,t,l,Ee,p)??0;const[o,u]=t;return s?Wi(s,o,u,a,l):s=Ne(o,u,a,l),n!=null&&(s.m=n,s.hasM=!0),s}function xo(t,e,i,n,r=U()){const[s,l]=t;return r[0]=s,r[1]=l,t.length>3&&(r[3]=t[3]??0),i?.type!=="3d"?(r[2]=e.value,r):(r[2]=Cr(i,s,l,e.value,n,e.elevationInfo,Ee)??0,r)}const ls=Ne(0,0,0,null);let Z=class extends Ii{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],Z.prototype,"enabled",void 0),Z=c([R("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Z);let S=class extends Ii{constructor(e){super(e),this.lineSnapper=new Z,this.parallelLineSnapper=new Z,this.rightAngleSnapper=new Z,this.rightAngleTriangleSnapper=new Z,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new lt([255,127,0]),this.orangeTransparent=new lt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),c([h({type:lt,nonNullable:!0})],S.prototype,"orange",void 0),c([h({type:lt,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=c([R("esri.views.interactive.snapping.Settings.Defaults")],S);const ht=new S;let ae=class extends pe{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new _e}};c([h({constructOnly:!0})],ae.prototype,"layer",void 0),c([h()],ae.prototype,"enabled",void 0),c([h()],ae.prototype,"updating",void 0),c([h()],ae.prototype,"availability",void 0),c([h()],ae.prototype,"sublayerSources",void 0),ae=c([R("esri.views.interactive.snapping.FeatureSnappingLayerSource")],ae);let x=class extends pe{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new _e,this.distance=ht.distance,this.touchSensitivityMultiplier=ht.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(Oi)&&Ui.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const i=e.filter(cs),n=this._get("_effectiveFeatureSources")?.filter(Oi)??new _e;for(const a of i){const o=n.find(u=>u.layer===a.layer.parent);if(o)o.sublayerSources.includes(a)||o.sublayerSources.add(a);else if(a.layer.parent){const u=new ae({layer:a.layer.parent});u.sublayerSources.add(a),n.add(u)}}for(const a of n){const o=a.sublayerSources.filter(u=>!i.includes(u));a.sublayerSources.removeMany(o)}n.removeMany(n.filter(a=>a.sublayerSources.length===0));const r=e.filter(ps),s=this._get("_effectiveFeatureSources")??new _e,{added:l,removed:p}=Nn(s.toArray(),[...r,...n]);return s.removeMany(p),s.addMany(l),s}};function Oi(t){return t.layer.type==="subtype-group"}function ps(t){return t.layer.type!=="subtype-group"}function cs(t){return t.layer.type==="subtype-sublayer"}c([h()],x.prototype,"enabled",void 0),c([h()],x.prototype,"enabledToggled",void 0),c([h()],x.prototype,"forceDisabled",void 0),c([h()],x.prototype,"selfEnabled",void 0),c([h()],x.prototype,"featureEnabled",void 0),c([h()],x.prototype,"gridEnabled",void 0),c([h()],x.prototype,"attributeRulesEnabled",void 0),c([h({type:_e.ofType(ae)})],x.prototype,"featureSources",void 0),c([h()],x.prototype,"distance",void 0),c([h()],x.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],x.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],x.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],x.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],x.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],x.prototype,"_effectiveFeatureSources",null),x=c([R("esri.views.interactive.snapping.SnappingOptions")],x);const Ro=Symbol("grid-placement-graphic");function sn(t,e){const i=t.x-e.x,n=t.y-e.y;return i*i+n*n}function Do(t,e){return Math.sqrt(sn(t,e))}function hs(t,e){e.sort((i,n)=>It(i.targetPoint,t)-It(n.targetPoint,t))}function Lo({parameters:{point:t,distance:e,returnEdge:i,vertexMode:n,coordinateHelper:{spatialReference:r},filter:s},mode:l,returnZ:p,filter:a}){const o=a?.clone()??new Hr({where:"1=1"});return o.returnZ=p??l==="3d",s&&(o.geometry=s.geometry,o.distance=s.distance,o.spatialRelationship=s.spatialRelationship,o.where=jn(o.where,s.where),o.timeExtent=Vn(o.timeExtent,s.timeExtent),o.objectIds=us(o.objectIds,s.objectIds)),{point:Ne(t[0],t[1],t[2],r.toJSON()),mode:l,distance:e,returnEdge:i,vertexMode:n,query:o.toJSON()}}function us(t,e){return t||e?e?t?Array.from(qn(new Set(t),new Set(e))):e:t:null}function Ho(t,e,i){return{left:$i(t.leftVertex.pos,e,i),right:$i(t.rightVertex.pos,e,i)}}const Gi=Symbol("snapping-toggle");function ds(t,e=()=>{}){const i=de(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:n,snappingOptions:r})=>{if(t.removeHandles(Gi),!n||!r)return;const s=M.TOOL,l=[n.on("key-down",p=>{p.key!==bi.toggle||p.repeat||(r.enabledToggled=!0,e())},s),n.on("key-up",p=>{p.key===bi.toggle&&(r.enabledToggled=!1,e())},s),n.on("pointer-move",p=>{const a=p.native.ctrlKey;r.enabledToggled!==a&&(r.enabledToggled=a,e())},s)];t.addHandles(l,Gi)},$e);t.addHandles(i)}function Io(t){return Mr(t)&&"utilityNetworks"in t&&!!t.utilityNetworks?.length}function Uo(t){return t?.type==="line"}function Gt(t,e){return t[0]*e[1]-t[1]*e[0]}function ys(t,e,i){const n=Me(i,e)/we(i);return Fn(t,i,n)}function No(t,e,i,n,r=i){return L(be,n,i),L(ut,e,r),ys(Ge,ut,be),zn(t,r,Ge)}function jo(t,e,i,n){L(be,e,i);const r=n/Ni(be);return Q(t,i,be,r)}function Vo(t,e){const i=t.start,n=t.end,r=e.start,s=e.end,l=L(be,n,i),p=L(an,s,r),a=Gt(l,p);if(Math.abs(a)<=fs)return[];const o=L(ut,i,r),u=Gt(p,o)/a;return Gt(l,o)/a,u>=0?[Q(Ge,i,l,u)]:[Q(Ge,i,l,u)]}function gs(t,e,i){const n=[],r=L(be,t.end,t.start),s=L(an,t.start,e),l=we(r),p=2*Me(r,s),a=p*p-4*l*(we(s)-i*i);if(a===0){const o=-p/(2*l);n.push(Q(Ge,t.start,r,o))}else if(a>0){const o=Math.sqrt(a),u=(-p+o)/(2*l);n.push(Q(Ge,t.start,r,u));const d=(-p-o)/(2*l);n.push(Q(ut,t.start,r,d))}return n}const fs=1e-6,be=B(),an=B(),ut=B(),Ge=B();function ei({start:t,end:e,type:i},n,r){const s=[],l=L(je,e,t),p=L(_t,t,n),a=we(l),o=2*Me(l,p),u=o*o-4*a*(we(p)-r*r);if(u===0){const d=-o/(2*a);(i===0||d>=0)&&s.push(Q(B(),t,l,d))}else if(u>0){const d=Math.sqrt(u),m=(-o+d)/(2*a);(i===0||m>=0)&&s.push(Q(B(),t,l,m));const y=(-o-d)/(2*a);(i===0||y>=0)&&s.push(Q(B(),t,l,y))}return s}function on(t,e){const i=t.start,n=t.end,r=L(je,n,i),s=ee(wt,-r[1],r[0],0),l=e.start,p=e.end,a=I(ii,p,l),o=H(a,s),u=ee(gn,i[0],i[1],0),d=I(fn,u,l),m=H(d,s),y=Ue();if(Math.abs(o)<y)return[];const g=A(mn,l,a,m/o);if(e.type===0){const f=I(Vt,g,l);if(H(f,a)<-y)return[]}if(t.type===1){const f=Wn(_t,g,i);if(Me(f,r)<-y)return[]}return[le(g)]}function ms(t,e){return _s(dt(ni,e[2],t),e)}function ln(t,e){return dn(dt(ni,0,t),dt(Ts,0,e)).map(([n,r])=>nt(n,r))}function pn(t,e,i){return hn(t,dt(ni,t[2],e),i)}function cn(t,e,i,n=v()){const r=L(je,t,e),s=Ni(r);return Q(n,e,r,s===0?1:i/s),n[2]=t[2],n}function hn(t,{start:e,end:i,type:n},r=v()){const s=I(bt,t,e),l=I(wt,i,e),p=H(s,l)/H(l,l);return A(r,e,l,n===0?Math.max(p,0):p)}const vs=(()=>{const t=v(),e=v(),i=v();return({start:n,end:r},{center:s,radius:l,normal:p,slicePlane:a})=>{const o=vt(s,p,Ss);if(w(jt(o,n),0)&&w(jt(o,r),0)){Ji(p,t,e);const d=(g,f)=>(mt(i,f,s),ji(g,H(i,t),H(i,e)),g),m=gs({start:d(je,n),end:d(_t,r)},Ir,l),y=[];for(const[g,f]of m){const _=Zt(v(),s);A(_,_,t,g),A(_,_,e,f),a&&!ye(a,_)||y.push(_)}return y}const u=v();return Xi(o,n,r,u)?!w(He(u,s),l)||a&&!ye(a,u)?[]:[u]:[]}})();function un({start:t,end:e,type:i},n,r){const s=[],l=mt(bt,e,t),p=L(_t,t,n),a=we(l),o=2*Me(l,p),u=o*o-4*a*(we(p)-r*r);if(u===0){const d=-o/(2*a);(i===1||d>=0)&&s.push(A(v(),t,l,d))}else if(u>0){const d=Math.sqrt(u),m=(-o+d)/(2*a);(i===1||m>=0)&&s.push(A(v(),t,l,m));const y=(-o-d)/(2*a);(i===1||y>=0)&&s.push(A(v(),t,l,y))}return s}function dn(t,e){const i=t.start,n=t.end,r=e.start,s=e.end,l=I(bt,n,i),p=I(wt,s,r),a=I(ii,r,i),o=pt(gn,l,p);if(!w(H(a,o),0))return[];const u=Ut(o);if(w(u,0))return[];const d=pt(fn,a,p),m=H(d,o)/u,y=A(mn,i,l,m);if(t.type===0){const g=I(Vt,y,i);if(H(l,g)<-Ue())return[]}if(e.type===0){const g=I(Vt,y,r);if(H(p,g)<-Ue())return[]}return[le(y)]}function _s({start:t,end:e,type:i},n){const r=I(bt,n,t),s=I(wt,e,t),l=pt(ii,s,r),p=Ut(l)/Ut(s),a=Ue();if(p<a)switch(i){case 1:return[le(n)];case 0:return H(s,r)<-a?[]:[le(n)]}return[]}function ti(t,e,i,n){const[r,s]=t,[l,p]=i,a=l-r,o=p-s,u=a*a+o*o,d=Math.sqrt(u);if(d>e+n)return[];if(d<Math.abs(e-n))return[];if(w(d,0)&&w(e,n))return[];const m=(e*e-n*n+u)/(2*d),y=Math.sqrt(e*e-m*m),g=y*o/d,f=y*a/d,[_,$]=Bn(je,t,i,m/d);return w(g,f)?[nt(_,$)]:[nt(_+g,$-f),nt(_-g,$+f)]}function dt(t,e,{start:i,end:n,type:r}){return ee(t.start,i[0],i[1],e),ee(t.end,n[0],n[1],e),t.type=ws[r],t}function yn(t,e){return w(t[2],e[2])}function w(t,e){return Zn(Math.abs(t-e),0,Ue())}function bs(t,e){return e.filter(i=>ye(t,i))}function ye(t,e){return Fr(t,e)}const ws={0:1,1:0},je=B(),_t=B(),bt=v(),wt=v(),ii=v(),gn=v(),fn=v(),mn=v(),Vt=v(),Ss=V(),ni={start:v(),end:v(),type:1},Ts={start:v(),end:v(),type:1};class q{intersect(e){return ie(this,e)}closestPoints(e){return[this.closestTo(e)]}}class xe extends q{constructor(e){super(),this.point=e}equals(e){return this===e||z(e)&&E(this.point,e.point)}closestTo(){return Oe(this.point)}}class ri extends q{constructor(e,i,n){super(),this.start=e,this.end=i,this.lineLike={start:e,end:i,type:n}}equals(e){return this===e||J(e)&&this.lineLike.type===e.lineLike.type&&E(this.start,e.start)&&E(this.end,e.end)}closestTo(e){const i=U();return hn(e,this.lineLike,i),i}}class si extends ri{constructor(e,i){super(e,i,1)}}class $s extends ri{constructor(e,i){super(e,i,0)}}class vn extends q{constructor(e){super(),this.constraints=e}equals(e){return this===e||qt(e)&&Kn(this.constraints,e.constraints,(i,n)=>i.equals(n))}closestTo(e){let i,n=1/0;for(const r of this.constraints){const s=r.closestTo(e),l=It(e,s);l<n&&(n=l,i=s)}return Oe(i??e)}closestPoints(e){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(e))}}class _n extends q{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||Y(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=U();return cn(e,this.center,this.radius,i),i}}class ai extends q{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||re(e)&&E(this.center,e.center)&&this.radius===e.radius}closestTo(e){const i=U();return cn(e,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new oi(Oe(this.center),this.radius,ge(0,0,1))}}class oi extends q{constructor(e,i,n,r=void 0){super(),this.center=e,this.radius=i,this.normal=n,this.slicePlane=r}equals(e){return this===e||ue(e)&&E(this.center,e.center)&&E(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:i,radius:n}=this;Qi(this.getPlane(Es),e,Mt);const r=I(Mt,Mt,i),s=Bi(r);if(w(s,0))return Oe(e);const l=n/Math.sqrt(s),p=U();A(p,i,r,l);const{slicePlane:a}=this;return a&&!ye(a,p)?pi(a,this)?.closestTo(e)??Oe(e):p}getPlane(e=V()){return vt(this.center,this.normal,e)}}const Mt=v(),Es=V();class Os extends q{constructor(e){super(),this.z=e}equals(e){return this===e||ne(e)&&this.z===e.z}closestTo(e){return ge(e[0],e[1],this.z)}getPlane(e=V()){return ee(Mi,0,0,this.z),vt(Mi,Jn,e)}}const Mi=v();class li extends q{constructor(e,i,n){super(),this.start=e,this.end=i,this.planeLike={start:e,end:i,type:n}}equals(e){return this===e||X(e)&&this.planeLike.type===e.planeLike.type&&E(this.start,e.start)&&E(this.end,e.end)}closestTo(e){const i=U();return pn(e,this.planeLike,i),i}closestEndTo(e){const{start:i,end:n}=this.planeLike;return Math.sign(Me(L(Gs,n,i),L(Ms,e,i)))>0?this.end:this.start}getPlane(e=V()){const i=Zt(xi,this.end);return i[2]+=1,Yi(this.start,this.end,i,e)}getSlicePlane(e=V()){const{start:i,end:n,type:r}=this.planeLike;if(r===0)return;const s=ee(xi,i[0],i[1],0),l=ee(ki,n[0],n[1],0),p=mt(ki,l,s);return vt(s,p,e),e}}const Gs=B(),Ms=B(),xi=v(),ki=v();class qo extends li{constructor(e,i){super(e,i,1)}}class bn extends li{constructor(e,i){super(e,i,0)}}class xs extends q{constructor(e,i){super(),this.sphere=Jr(e,i),this._center=le(e)}equals(e){return this===e||se(e)&&Xr(this.sphere,e.sphere)}closestTo(e){const i=U();return Yr(this.sphere,e,i),i}get center(){return this._center}get radius(){return this.sphere[3]}}class wn extends q{constructor(e,i,n){super(),this.start=e,this.end=i,this.getZ=n,this.planeLike={start:e,end:i,type:0}}equals(e){return this===e||yt(e)&&E(this.start,e.start)&&E(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return Ds(this,e)}addIfOnTheGround(e,i){for(const n of i){const r=this.getZ(n[0],n[1])??0;w(n[2],r)&&(n[2]=r,e.push(n))}}}class ks extends q{constructor(e,i,n){super(),this._x=e,this._y=i,this._z=n}equals(e){return this===e||Xs(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,i,n]){return rn(this._x??e,this._y??i,this._z??n)}}class As extends q{constructor(e,i,n,r,s){super(),this._origin=e,this._spatialReference=i,this._distanceMeters=n,this._z=r,this._directionDegrees=s}equals(e){return this===e||Js(e)&&yi(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,i,n]){return ji(Ce,e,i),yi(Ce,this._origin)||this._applyDirectionAndDistance(Ce),rn(Ce[0],Ce[1],this._z??n)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Nt(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Ps(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=Wt(Cs,this._origin,e,this._spatialReference);Nt(e,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const Ce=[0,0],Cs=new Bt;function Ps(t,e,i,n,r){let{azimuth:s,distance:l}=Wt(Rs,e,n,r);s??=0;let p=l*Math.cos((s-i)*Vr);p=Math.max(0,p),Nt(t,e,i,p,r)}const Rs=new Bt;function Ds(t,e){const i=U();return pn(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??Tn,i}function ie(t,e){if(qt(t)){const i=[];for(const n of t.constraints){const r=n.intersect(e);r&&i.push(r)}return ci(i)}if(qt(e))return ie(e,t);if(yt(t))return Ai(t,e);if(yt(e))return Ai(e,t);if(z(t)){const{point:i}=t;if(z(e))return E(i,e.point)?t:void 0;const n=e.closestTo(i);return Pr(n,i)?t:void 0}if(J(t)){if(z(e))return ie(e,t);if(J(e))return W(dn(t.lineLike,e.lineLike));if(ne(e))return Ls(t,e);if(X(e))return W(on(e.planeLike,t.lineLike));if(Y(e))return W(un(t.lineLike,e.center,e.radius));if(ue(e))return W(vs(t.lineLike,e));if(re(e))return Hs(t,e);if(se(e))return Is(t,e)}else if(ne(t)){if(z(e)||J(e))return ie(e,t);if(ne(e))return Us(t,e);if(X(e))return Ns(t,e);if(Y(e))return js(t,e);if(ue(e))return qs(t,e);if(re(e))return Vs(t,e);if(se(e))return zs(t,e)}else if(X(t)){if(z(e)||J(e)||ne(e))return ie(e,t);if(X(e))return xt(ln(t.planeLike,e.planeLike));if(Y(e))return xt(ei(t.planeLike,e.center,e.radius));if(ue(e))return Zs(t,e);if(re(e))return Fs(t,e);if(se(e))return Ws(t,e)}else if(Y(t)){if(z(e)||J(e)||ne(e)||X(e))return ie(e,t);if(Y(e))return xt(ti(t.center,t.radius,e.center,e.radius));if(ue(e))return void 0;if(re(e))return Bs(t,e);if(se(e))return void 0}else if(ue(t)){if(z(e)||J(e)||ne(e)||X(e)||Y(e))return ie(e,t);if(ue(e))return void 0;if(re(e))return e.asCircle(),void 0;if(se(e))return void 0}else if(re(t)){if(z(e)||J(e)||ne(e)||X(e)||Y(e)||ue(e))return ie(e,t);if(re(e))return Ks(e,t);if(se(e))return void 0}else if(se(t)){if(z(e)||J(e)||ne(e)||X(e)||Y(e)||re(e))return ie(e,t);if(se(e))return void 0}}const Ls=(()=>{const t=V();return(e,i)=>{const{start:n,end:r}=e;if(yn(n,r)&&w(n[2],i.z))return e;const s=U();return Xi(i.getPlane(t),n,r,s)?new xe(s):void 0}})();function Hs({lineLike:t},{center:e,radius:i}){const n=e[2];return W(un(t,e,i).filter(r=>w(r[2],n)))}function Is({lineLike:t},{sphere:e}){return W(Kr(e,t.start,t.end))}const pi=(()=>{const t=jr(),e=v(),i=v();return(n,r,s)=>{const{normal:l,center:p,radius:a}=r;Ji(l,e,i);const o=Kt(n),u=a*H(o,e),d=a*H(o,i);Ur(t,p[0],p[1],p[2],1);const m=Nr(n,t),y=Math.hypot(u,d),g=w(y,0);if(w(jt(n,p),0)){if(g)return r;if(w(a,0))return!s||ye(s,p)?new xe(Oe(p)):void 0;pt(e,o,l),Rr(e,e);const Tt=new Array,ze=le(p);A(ze,ze,e,a),s&&!ye(s,ze)||Tt.push(ze);const Fe=le(p);return A(Fe,Fe,e,-a),s&&!ye(s,Fe)||Tt.push(Fe),W(Tt)}if(g)return;const f=-m/y;if(Math.abs(f)>1||w(f,1))return;const _=Math.atan(u/d),$=Xn(f)-_,T=Math.PI-$,me=new Array,Ve=v();A(Ve,p,e,a*Math.cos($)),A(Ve,Ve,i,a*Math.sin($)),me.push(Ve);const qe=v();return A(qe,p,e,a*Math.cos(T)),A(qe,qe,i,a*Math.sin(T)),me.push(qe),W(s?bs(s,me):me)}})();function Us(t,e){return w(t.z,e.z)?t:void 0}function Ns({z:t},{planeLike:e}){const[i,n]=e.start,[r,s]=e.end,l=ge(i,n,t),p=ge(r,s,t);return e.type===0?new si(l,p):new $s(l,p)}function js(t,e){const[i,n]=e.center;return new ai(ge(i,n,t.z),e.radius)}function Vs(t,e){return w(e.center[2],t.z)?e:void 0}const qs=(()=>{const t=V();return(e,i)=>pi(e.getPlane(t),i,i.slicePlane)})();function zs(t,{center:e,radius:i}){const n=Math.abs(e[2]-t.z);if(n>i&&!w(n,i))return;const r=ge(e[0],e[1],t.z),s=Math.sqrt(i**2-n**2);return w(s,0)?void 0:new ai(r,s)}const Fs=(()=>{const t=V();return(e,{center:i,radius:n})=>{const r=ei(e.planeLike,i,n),s=i[2];e.getSlicePlane(t);const l=new Array;for(const[p,a]of r){const o=[p,a,s];ye(t,o)&&l.push(o)}return W(l)}})(),Zs=(()=>{const t=V(),e=V();return(i,n)=>pi(i.getPlane(t),n,i.getSlicePlane(e))})(),Ws=(()=>{const t=V();return(e,{center:i,radius:n})=>{const r=e.getPlane(t),s=Zr(r,i),l=Math.abs(s);if(l>n&&!w(l,n))return;const p=Math.sqrt(n**2-s**2);if(w(p,0)){const u=U();return Qi(r,i,u),new xe(u)}const a=U(),o=le(Kt(r));return A(a,i,o,s),new oi(a,p,o,e.getSlicePlane())}})();function Bs(t,e){const i=qi(t.center,e.center);return w(i,0)&&w(t.radius,e.radius)?e:Sn(ti(t.center,t.radius,e.center,e.radius),e.center[2])}function Ks(t,e){if(!yn(t.center,e.center))return;const i=qi(t.center,e.center);return w(i,0)&&w(t.radius,e.radius)?t:Sn(ti(t.center,t.radius,e.center,e.radius),t.center[2])}function Ai(t,e){const{planeLike:i,getZ:n}=t,r=new Array;if(z(e))t.addIfOnTheGround(r,ms(i,e.point));else if(J(e))t.addIfOnTheGround(r,on(i,e.lineLike));else if(Y(e))for(const[s,l]of ei(i,e.center,e.radius)){const p=n(s,l);p!=null&&r.push(ot(s,l,p))}else if(X(e)||yt(e))for(const[s,l]of ln(i,e.planeLike)){const p=n(s,l)??Tn;r.push(ot(s,l,p))}return W(r)}function xt(t){return ci(t.map(([e,i])=>{const n=ge(e,i,0),r=ge(e,i,1);return new si(n,r)}))}function W(t){return ci(t.map(e=>e?new xe(e):void 0))}function Sn(t,e){return W(t.map(([i,n])=>[i,n,e]))}function ci(t){if(t.length!==0)return t.length===1?t[0]??void 0:new vn(t.filter(Vi))}function qt(t){return t instanceof vn}function z(t){return t instanceof xe}function J(t){return t instanceof ri}function ne(t){return t instanceof Os}function X(t){return t instanceof li}function Y(t){return t instanceof _n}function re(t){return t instanceof ai}function ue(t){return t instanceof oi}function se(t){return t instanceof xs}function yt(t){return t instanceof wn}function Js(t){return t instanceof As}function Xs(t){return t instanceof ks}const Tn=0;let ke=class{constructor(e,i,n,r){this.targetPoint=e,this.constraint=i,this.isDraped=n,this.domain=r}},$n=class extends ke{constructor({targetPoint:e,objectId:i,constraint:n,isDraped:r}){super(e,n,r,1),this.objectId=i}},St=class{constructor(e,i){this.isDraped=e,this.domain=i}},te=class En extends St{constructor(e,i,n,r,s=3,l=!0,p=!0){super(r,s),this.type=e,this.lineStart=i,this.lineEnd=n,this.fadeLeft=l,this.fadeRight=p}equals(e){return e instanceof En&&this.type===e.type&&E(this.lineStart,e.lineStart)&&E(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return He(this.lineStart,this.lineEnd)}},Ys=class extends $n{constructor(e){super({...e,isDraped:!0,constraint:new wn(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new te(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Qs=class extends $n{constructor(e){super({...e,constraint:new si(e.edgeStart,e.edgeEnd)})}get hints(){return[new te(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ea=class On extends St{constructor(e,i,n=3){super(i,n),this.intersectionPoint=e}equals(e){return e instanceof On&&E(this.intersectionPoint,e.intersectionPoint)}},st=class extends ke{constructor(e,i,n,r){super(e,new xe(e),r,3),this.first=i,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ea(this.targetPoint,this.isDraped,this.domain)]}},ta=class extends ke{constructor({lineStart:e,lineEnd:i,targetPoint:n,isDraped:r}){super(n,new bn(e,i),r,2),this._referenceLineHint=new te(2,e,i,r,this.domain)}get hints(){return[this._referenceLineHint,new te(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},ia=class Gn extends St{constructor(e,i,n,r=3){super(n,r),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof Gn&&E(this.lineStart,e.lineStart)&&E(this.lineEnd,e.lineEnd)}},na=class extends ke{constructor({referenceLine:e,lineStart:i,targetPoint:n,isDraped:r}){const s=le(i),{left:l,right:p}=e;mt(s,Dr(s,s,p),l),super(n,new bn(i,s),r,2),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new te(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new ia(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new te(1,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const i={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(n=>{E(e.right,n.edge.left)&&(n.fadeLeft=!1,i.fadeRight=!1),E(e.right,n.edge.right)&&(n.fadeRight=!1,i.fadeRight=!1),E(e.left,n.edge.right)&&(n.fadeRight=!1,i.fadeLeft=!1),E(e.left,n.edge.left)&&(n.fadeLeft=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}},Mn=class xn extends St{constructor(e,i,n,r,s=3){super(r,s),this.previousVertex=e,this.centerVertex=i,this.nextVertex=n}equals(e){return e instanceof xn&&E(this.previousVertex,e.previousVertex)&&E(this.centerVertex,e.centerVertex)&&E(this.nextVertex,e.nextVertex)}},ra=class extends ke{constructor({targetPoint:e,constraint:i,previousVertex:n,otherVertex:r,otherVertexType:s,isDraped:l,selfSnappingType:p,objectId:a,domain:o}){super(e,i,l,o??2),this.previousVertex=n,this.otherVertex=r,this.otherVertexType=s,this.selfSnappingType=p??0,this.objectId=a??null}get hints(){const e=this.previousVertex,i=this.otherVertexType===1?this.otherVertex:this.targetPoint,n=this.otherVertexType===1?this.targetPoint:this.otherVertex;return[new te(0,i,n,this.isDraped,this.domain),new te(1,e,i,this.isDraped,this.domain),new Mn(this.previousVertex,i,n,this.isDraped,this.domain)]}},sa=class extends ke{constructor({targetPoint:e,point1:i,point2:n,isDraped:r}){super(e,new _n(Lr(v(),i,n,.5),.5*Yn(i,n)),r,2),this._p1=i,this._p2=n}get hints(){return[new te(1,this.targetPoint,this._p1,this.isDraped,this.domain),new te(1,this.targetPoint,this._p2,this.isDraped,this.domain),new Mn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function aa(t,e,i,n,r=v()){const s=Zt(oa,t);return s[2]=Zi(n,s,e,i)||0,n.renderCoordsHelper.toRenderCoords(s,e,r),r}const oa=v();function la(t,e,i,n){return n.type==="2d"?(We.x=t[0],We.y=t[1],We.spatialReference=e,n.toScreen(We)):(aa(t,e,i,n,Ci),n.state.camera.projectToScreen(Ci,kt),Qn(kt[0],kt[1]))}const We=Ne(0,0,0,null),Ci=v(),kt=er();function el(t){return Ki(t)||zi(t)}function hi(t,e,i,...n){return Ki(t)?e.apply(void 0,n):t.isWebMercator?i.apply(void 0,n):null}function pa(t){const{spatialReference:e}=t;return hi(e,ya,ga,t)}function ca(t,e){if(!ft(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return Be[0]=t.x,Be[1]=t.y,Be[2]=t.hasZ?t.z:0,Ke[0]=e.x,Ke[1]=e.y,Ke[2]=e.hasZ?e.z:0,kn(Be,Ke,i)}function kn(t,e,i){return hi(i,ua,da,t,e,i)}const ha={geodesicLength:pa,geodesicDistanceBetweenPoints:ca,geodesicDistance:kn};async function An(){return await Qr(),ha}function ua(t,e,i){return fe(Wt(ma,t,e,i).distance,"meters")}function da(t,e,i){return fe(en(fa(t,e,i),{unit:"meters"}),"meters")}function ya(t){return fe(qr([t],"meters")[0],"meters")}function ga(t){return fe(en(t,{unit:"meters"}),"meters")}function fa(t,e,i){return new tr({spatialReference:i,paths:[[[...t],[...e]]]})}const ma=new Bt,Be=v(),Ke=v();let F=class extends zt{constructor(t){super(t),this.options=new x,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([de(()=>{const{distance:t,touchSensitivityMultiplier:e,effectiveSelfEnabled:i,effectiveFeatureEnabled:n,effectiveGridEnabled:r}=this.options;return{selfEnabled:i,featureEnabled:n,gridEnabled:this.view.type==="2d"&&r,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:t,touchSensitivityMultiplier:e}},(t,e)=>{e&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=kr(i=>this._updateEngines(t,e,i))},$e),de(()=>this.options,t=>{for(const e of this._engines)e.options=t},ir)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(t=>t.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(t=>t.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(t,e,i){if(!t.viewReady)return void this._destroyEngines();e?.viewSpatialReference!==t.viewSpatialReference&&this._destroyEngines();const n=this._engineCache,r=await Promise.allSettled([t.featureEnabled&&!n.has("feature")?this._createFeatureSnappingEngine(i):void 0,t.selfEnabled&&!n.has("self")?this._createSelfSnappingEngine(i):void 0,t.gridEnabled&&!n.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const s of r)s.status==="fulfilled"&&s.value?.engine.destroy();else{for(const s of r)s.status==="fulfilled"&&s.value&&n.set(s.value.type,s.value.engine);this._engines=Array.from(n.values())}}async _createSelfSnappingEngine(t){const[{SelfSnappingEngine:e},i]=await Promise.all([P(()=>import("./SelfSnappingEngine-C4xVb09U.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]),import.meta.url),An()]);return $t(t),{type:"self",engine:new e({view:this.view,options:this.options,geodesicLengthMeasurementUtils:i})}}async _createGridSnappingEngine(t){const{view:e}=this;if(e.type!=="2d")return;const{GridSnappingEngine:i}=await P(()=>import("./GridSnappingEngine-6DACG6f9.js"),__vite__mapDeps([49,1,2,3,11,13,14,15,50,4,51,52,53,54,55,17,18,19,20,21,22,23,24,25,26,27,7,8,28,29,30,31,32,33,6,12,16,34,35,36,10,37,38,39,40,41,42,5,43,44,45,46,47,48]),import.meta.url);return $t(t),{type:"grid",engine:new i({view:e,options:this.options})}}async _createFeatureSnappingEngine(t){const{FeatureSnappingEngine:e}=await P(()=>import("./FeatureSnappingEngine-DseCbdqp.js"),__vite__mapDeps([56,2,1,3,57,33,11,18,6,7,8,58,34,35,36,59,60,13,14,15,19,20,21,22,23,24,25,26,27,28,29,30,31,32,12,16,10,37,38,17,39,40,41,42,5,43,44,45,46,47,48]),import.meta.url);$t(t);const{view:i,options:n}=this,{spatialReference:r}=i;return{type:"feature",engine:new e({view:i,options:n,spatialReference:r})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:t,touchSensitivityMultiplier:e}=this.options,i=t*e;return i*i}snap(t){return ba(t)?this._snapMultiPoint(t):this._snapSinglePoint(t)}update(t){const{point:e,context:i}=t;this._removeVisualization();const n=this._currentMainCandidate;if(n==null)return e;const r=this._selectUpdateInput(t);if(r==null)return e;const{spatialReference:s}=i,l=Ht(r,s);if(l==null)return e;const{view:p}=this,{elevationInfo:a,visualizer:o}=i,u=[],d=Le(l,p,a),m=n.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,m,i)||!Ct(n,i.drawConstraints))return this._resetSnappingState(),e;n.targetPoint=Ot(m),u.push(...n.hints);for(const y of this._currentOtherActiveCandidates)Ct(y,i.drawConstraints)&&(y.targetPoint=Ot(m),u.push(...y.hints));return o!=null&&this.addHandles(o.draw(u,{spatialReference:s,elevationInfo:wa(i),view:p,selfSnappingZ:i.selfSnappingZ}),At),Ei(m,p,e,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:t,scenePoint:e}){switch(this._currentSnappedType){case 0:return t;case 1:return e}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(At)}async _snapSinglePoint({point:t,context:e,signal:i}){const{view:n}=this,{elevationInfo:r}=e,s=Le(t,n,r),l=await this._fetchCandidates(s,3,e,i);return this._createSnapResult(s,0,l,n,t,e,i)}async _snapMultiPoint({point:t,scenePoint:e,context:i,signal:n}){const{view:r}=this,{coordinateHelper:s,elevationInfo:l,spatialReference:p}=i;await Sr(e.spatialReference,p);const a=Ht(e,p),o=Le(a,r,l),u=await this._fetchCandidates(o,1,i,n);if(u.length>0){const y=await this._fetchCandidates(o,2,i,n);return this._createSnapResult(o,1,[...u,...y],r,a,i,n)}const d=Le(t,r,l),m=await this._fetchCandidates(d,2,i,n);return this._createSnapResult(d,0,m,r,{z:s.hasZ()&&t.hasZ?t.z??0:void 0,m:s.hasM()&&t.hasM?t.m??0:void 0},i,n)}async _fetchCandidates(t,e,i,n){return(await Promise.all(this._engines.map(r=>r.fetchCandidates(t,e,i,n)))).flat()}_createSnapResult(t,e,i,n,r,s,l){return{get valid(){return!nr(l)},apply:()=>{const{spatialReference:p}=s,{snappedPoint:a,hints:o}=this._processCandidates(t,e,i,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(o,{spatialReference:p,elevationInfo:Ee,view:n,selfSnappingZ:s.selfSnappingZ}),At),Ei(a,n,r,s)}}}_processCandidates(t,e,i,n){if(i.length<1)return this.doneSnapping(),{snappedPoint:t,hints:[]};this._currentSnappedType!==e&&this._resetSnappingState(),hs(t,i);const r=this._currentMainCandidate;if(r!=null){const s=_a(r,i);if(s>=0){if(!(i[s]instanceof st))return this._intersectWithOtherCandidates(s,i,t,e,n);if(this._arePointsWithinScreenThreshold(t,r.targetPoint,n))return this._updateSnappingCandidate(r,e,i,n)}}return this._intersectWithOtherCandidates(0,i,t,e,n)}_intersectWithOtherCandidates(t,e,i,n,r){const{coordinateHelper:s}=r,l=e[t],p=[];for(let a=0;a<e.length;++a){if(a===t)continue;const o=e[a],u=l.constraint.intersect(o.constraint);if(u)for(const d of u.closestPoints(l.targetPoint))p.push([new st(Ot(d),l,o,o.isDraped),this._squaredScreenDistance(i,d,s)])}return p.length>0&&(p.sort((a,o)=>a[1]-o[1]),p[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(p[0][0],n,e,r):Ct(l,r.drawConstraints)?this._updateSnappingCandidate(l,n,e,r):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(t,e,i,n){this.doneSnapping(),this._currentMainCandidate=t,this._currentSnappedType=e;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...t.hints);for(const l of i){if(t instanceof st){if(l.constraint.equals(t.first.constraint)||l.constraint.equals(t.second.constraint))continue}else if(l.constraint.equals(t.constraint))continue;const p=l.constraint.closestTo(r);this._squaredScreenDistance(p,r,n.coordinateHelper)<va()&&(l.targetPoint=r,this._currentOtherActiveCandidates.push(l),s.push(...l.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(t){return t==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(t,e,i){return this._squaredScreenDistance(t,e,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(t,e,i){return sn(this._toScreen(t,i),this._toScreen(e,i))}_toScreen(t,e){return la(t,e.spatialReference,Ee,this.view)}get test(){}};c([h({constructOnly:!0})],F.prototype,"view",void 0),c([h()],F.prototype,"options",void 0),c([h({readOnly:!0})],F.prototype,"updating",null),c([h()],F.prototype,"_loadTask",void 0),c([h()],F.prototype,"_engines",void 0),c([h()],F.prototype,"_squaredMouseProximityThreshold",null),c([h()],F.prototype,"_squaredTouchProximityThreshold",null),F=c([R("esri.views.interactive.snapping.SnappingManager")],F);const At="visualization-handle";function va(){return ht.satisfiesConstraintScreenThreshold*ht.satisfiesConstraintScreenThreshold}function Ct(t,e){return!e||e.direction==null&&e.distance==null||!(t instanceof Ys||t instanceof Qs||t instanceof ta||t instanceof na||t instanceof sa)&&(!(t instanceof ra)||e.direction==null&&t.selfSnappingType===1)}function _a(t,e){return t instanceof st?Pt(e,t.first)>=0&&Pt(e,t.second)>=0?0:-1:Pt(e,t)}function Pt(t,e){let i=-1;for(let n=0;n<t.length;++n)if(e.constraint.equals(t[n].constraint)){i=n;break}return i}function ba(t){return t.scenePoint!=null}function wa({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?Ee:e}function ui(t){return rr(t)?sr(t)||zi(t)||ar(t)||or(t)?is:t:ns(t)}function Sa(t,e=gt()){return Cn(t,e)}function Ta(t,e=gt()){return Cn(t,e,!1)}function Cn(t,e,i=t.hasZ){const n=ui(t.spatialReference),r=lr(n);if(r==null)return null;const s=(p,a)=>!(a.length<2)&&(ee(p,a[0],a[1],i&&a[2]||0),!0);let l=0;for(const p of t.rings){const a=p.length;if(a<3)continue;const{positionsWorldCoords:o}=e;for(;o.length<a;)o.push(v());const u=$a,d=ee(Ea,0,0,0),m=1/a;for(let f=0;f<a;f++){if(!s(u,p[f])||!it(u,t.spatialReference,o[f],n))return null;A(d,d,o[f],m)}const y=Yi(o[0],o[1],d,Wr());if(Bi(Kt(y))===0)continue;for(let f=0;f<a;f++)Br(y,d,o[f],o[f]);const g=Oa(o);for(let f=0;f<g.length;f+=3)l+=ts(o[g[f]],o[g[f+1]],o[g[f+2]])}return Jt(l,r)}const $a=v(),Ea=v();function gt(){return{positionsWorldCoords:[]}}function Oa(t){return es(Ga(t),[],2)}function Ga(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const n=t[i],r=2*i;e[r]=n[0],e[r+1]=n[1]}return e}const Ma=t=>({geodesicArea(e){const{spatialReference:i}=e;return hi(i,ka,n=>Aa(t,n),e)}});async function xa(){const t=await P(()=>import("./geometryEngine-Bflaz5q1.js"),__vite__mapDeps([61,1,2,3,62,63]),import.meta.url);return Ma(t)}function ka(t){return Jt(Math.abs(zr([t],"square-meters")[0]),"square-meters")}function Aa(t,e){try{return Jt(Math.abs(t.geodesicArea(e,"square-meters")),"square-meters")}catch{return null}}const Ca=t=>({autoAreaByElevationMode(e,i,n=gt()){if(i==="on-the-ground"){const r=t.geodesicArea(e);return r??Ta(e,n)}return Sa(e,n)},autoArea2D(e,i=gt()){return this.autoAreaByElevationMode(e,"on-the-ground",i)}});let Rt=null;async function Je(){return Rt||(Rt=Ca(await xa())),Rt}function Pa(t){return Ra(t)}function Ra(t,e){const{hasZ:i,spatialReference:n}=t,r=ui(n);let s=0;const l=Fi(r);if(l==null)return null;const p=di;for(const a of t.paths){if(a.length<2)continue;const o=a.length-1;for(let u=0;u<o;++u){const d=a[u];N[0]=d[0],N[1]=d[1],N[2]=i?d[2]:0;const m=a[u+1];j[0]=m[0],j[1]=m[1],j[2]=i?m[2]:0;const y=p(N,j,n);if(y==null)return null;s+=y.value}}return fe(s,l)}function Da(t,e){const{spatialReference:i}=t;return ft(i,e.spatialReference)?(N[0]=t.x,N[1]=t.y,N[2]=t.hasZ?t.z:0,j[0]=e.x,j[1]=e.y,j[2]=e.hasZ?e.z:0,di(N,j,i)):null}function tl(t,e){const{spatialReference:i}=t;return ft(i,e.spatialReference)?(N[0]=t.x,N[1]=t.y,N[2]=t.hasZ?t.z:0,j[0]=e.x,j[1]=e.y,j[2]=e.hasZ?e.z:0,Ha(N,j,i)):null}function il(t){return t!=null?La(t.hasZ?t.z:0,t.spatialReference):null}function La(t,e){const i=pr(e);return i!=null?fe(t??0,i):null}function di(t,e,i){const n=Pn(t,e,i,1);return n!=null?fe(n.horizontal,n.unit):null}function Ha(t,e,i){const n=Pn(t,e,i,2);return n!=null?fe(n.verticalSigned,n.unit):null}function Pn(t,e,i,n){const r=ui(i),s=Fi(r);if(s==null)return null;const l=e[2]-t[2];if(n===2)return{verticalSigned:l,unit:s};if(!it(t,i,Dt,r)||!it(e,i,Xe,r))return null;if(n===0)return{direct:He(Xe,Dt),unit:s};if(ee(Ye,t[0],t[1],e[2]),!it(Ye,i,Ye,r))return null;const p=He(Ye,Xe);return n===1?{horizontal:p,unit:s}:{direct:He(Xe,Dt),horizontal:p,vertical:Math.abs(l),unit:s}}const N=v(),j=v(),Dt=v(),Xe=v(),Ye=v();function Ia(t){return{autoLength2D:e=>t.geodesicLength(e)??Pa(e),autoDistanceBetweenPoints2D:(e,i)=>t.geodesicDistanceBetweenPoints(e,i)??Da(e,i),autoDistance2D:(e,i,n)=>(Pe[0]=e[0],Pe[1]=e[1],Pe[2]=e.length===3?e[2]:0,Re[0]=i[0],Re[1]=i[1],Re[2]=i.length===3?i[2]:0,t.geodesicDistance(Pe,Re,n)??di(Pe,Re,n))}}async function ve(){return Ia(await An())}const Pe=v(),Re=v();function Ua(t){return t?.type==="graphic"}function Na(t){return t.find(Ua)??null}class Rn{constructor(e){this.layer=e}get elevationInfo(){return this.layer.elevationInfo}add(e){this.layer.add(e)}addMany(e){this.layer.addMany(e)}onGraphicsChange(e){const{layer:i}=this;return Ft(()=>i.graphics,"change",n=>e(n))}has(e){return e.layer===this.layer}remove(e){this.layer.remove(e)}removeMany(e){this.layer.removeMany(e)}removeAll(){this.layer.removeAll()}}c([h()],Rn.prototype,"elevationInfo",null);class Dn{constructor(e){this.layer=e}get elevationInfo(){}add(e,i){(this._getSublayerForCreateTool(i)??this._getSublayerForGraphic(e))?.add(e)}addMany(e,i){if(i){const n=this._getSublayerForCreateTool(i);if(n)return void n.addMany(e)}e.forEach(n=>this._getSublayerForGraphic(n)?.add(n))}onGraphicsChange(e){const{layer:i}=this;if(i.sublayers?.length)return cr(i.sublayers?.toArray().map(n=>Ft(()=>n.graphics,"change",r=>e(r))))}has(e){const{layer:i}=this;return e.layer===i||e.sourceLayer===i||!!i.sublayers?.some(n=>e.layer===n||e.sourceLayer===n)}remove(e){this._getSublayerForGraphic(e)?.remove(e)}removeMany(e){e.forEach(i=>this._getSublayerForGraphic(i)?.remove(i))}removeAll(){this.layer.sublayers?.forEach(e=>e.removeAll())}_getSublayerForCreateTool(e){const{layer:i}=this;switch(e){case"point":return i.pointLayer;case"polyline":return i.polylineLayer;case"polygon":return i.polygonLayer;case"multipoint":return i.multipointLayer;case"text":return i.textLayer}}_getSublayerForGraphic(e){const{layer:i}=this;if(e?.geometry)switch(e.geometry.type){case"point":return e.symbol?.type==="text"?i.textLayer:i.pointLayer;case"polyline":return i.polylineLayer;case"polygon":return i.polygonLayer;case"multipoint":return i.multipointLayer}}}c([h()],Dn.prototype,"elevationInfo",null);let k=class extends zt{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){const{activeComponent:t}=this;if(!t)return null;switch(t.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":return t.graphicSymbol?.type==="text"?"text":t.geometryType;case"draw-3d":return t.geometryType}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};c([h()],k.prototype,"activeComponent",void 0),c([h()],k.prototype,"cancelled",void 0),c([h()],k.prototype,"history",void 0),c([h()],k.prototype,"tool",null),c([h()],k.prototype,"type",void 0),c([h()],k.prototype,"canUndo",null),c([h()],k.prototype,"canRedo",null),c([h()],k.prototype,"onEnd",void 0),c([h()],k.prototype,"undo",null),c([h()],k.prototype,"redo",null),c([h()],k.prototype,"toggleTool",void 0),c([h()],k.prototype,"addToSelection",void 0),c([h()],k.prototype,"removeFromSelection",void 0),k=c([R("esri.widgets.Sketch.support.OperationHandle")],k);let at=class extends k{};c([h()],at.prototype,"activeComponent",void 0),at=c([R("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],at);let oe=class extends k{};c([h()],oe.prototype,"activeComponent",void 0),oe=c([R("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],oe);function ja(t,e){return e==="freehandPolygon"||e==="freehandPolyline"?"freehand":t??(e==="rectangle"||e==="circle"?"hybrid":"click")}function Va(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";case"text":return"point";default:return t}}function Pi(t){if(t.length>1)return!1;const e=t.at(0)?.geometry;return e?.type==="point"||e?.type==="multipoint"&&e.points.length<2}const Ri={defaultZ:0},De={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:xr},tool:"transform"},Lt=Symbol(),Di=Symbol();let b=class extends zt{constructor(t){super(t),this._defaultSnappingManager=null,this._internalGraphicsLayer=new Or({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._updatingHandles=new wr,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new gi({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new hr({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new ur({color:[130,130,130,1],width:2}),this.meshSymbol=new dr({symbolLayers:new _e([new yr])}),this.textSymbol=new gr({text:"text"}),this.updateGraphics=new _e,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new gi({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new nn,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{const{_layerAdapter:e}=this;if(this.removeHandles(Di),!e)return;const i=[e.onGraphicsChange(n=>this._onLayerGraphicsChangeCallback(n)),de(()=>e.elevationInfo,n=>{n!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=n)},$e)].filter(Vi);this.addHandles(i,Di)},this._originalPopupEnabled=null,this.defaultCreateOptions=Ri,this.defaultUpdateOptions=De,this.snappingOptions=t?.snappingManager?.options??t?.snappingOptions??new x}initialize(){this.addHandles([Ft(()=>this.view?.map?.layers,"change",t=>{this.layer&&t.removed.includes(this.layer)&&this.cancel()}),de(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),$e),de(()=>this.view,t=>{this._defaultSnappingManager=Ze(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new F({view:t,options:this.snappingOptions})),t.type==="2d"?P(()=>import("./editingTools-wFUM0QGU.js"),__vite__mapDeps([64,1,2,3,65,10,66,67,11,5,68,33,69,70,26,71,41,37,72,73,74,29,30,31,32,18,75,76,77,78,79,80,81,6,7,8,82,4,83,9,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,91,92,93,94,95,38,39,40,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,42,47,117,118,119,120,121,122,28,34,35,36,43,44,45,46,48]),import.meta.url):t.type==="3d"&&(P(()=>import("./ImageMaterial.glsl-Da3F2gho.js").then(e=>e.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url),P(()=>import("./LineCallout.glsl-CYa4vQBU.js").then(e=>e.G),__vite__mapDeps([162,1,2,3,163,164,13,14,15,16,12,6,7,8,126,11,38,127,71,41,37,48,128,26,39,40,10,129,130,131,4,132,133,46,42,47,134,135,125,50,51,52,53,136,137,138,139,140,141,73,74,98,142,143,94,18,165,160,30,166,148,35,36,167,168,169,170,171,172,173,25,69,174,175,150,149,176,99,31,100,177,178,179,33,180,181,182,183,184,185,29,32,60,186,187]),import.meta.url)))},$e),de(()=>this.view?.spatialReference,(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),ds(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=Ze(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get _layerAdapter(){const{layer:t}=this;switch(t?.type){case"graphics":return new Rn(t);case"map-notes":return new Dn(t);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:t,destroyed:e}=this,i=!e&&t&&"tooltip"in t?t.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...Ri,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...De,...t,reshapeOptions:{...De.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...De.highlightOptions,...t?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(t){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=Ze(this._defaultSnappingManager)),this._override("snappingManager",t);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new F({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const t=!(!this.view?.ready||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:n,map:r}=e;n&&this._clearCursor(),r?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),t&&this.addHandles(fr(()=>t.ready,n=>{this.removeHandles(this._viewHandlesKey),n&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},$e),i),this._set("view",t)}addGraphic(t){this._layerAdapter?.add(t)}addGraphics(t){this._layerAdapter?.addMany(t)}hasGraphic(t){return!!this._layerAdapter?.has(t)}removeGraphic(t){this._layerAdapter?.remove(t)}removeGraphics(t){this._layerAdapter?.removeMany(t)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=Et(this._moduleLoaderAbortController),this._viewReadyAbortController=Et(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:i}=this,n=e.toArray();this.removeGraphics(n),this.cancel(),this._emitDeleteEvent({graphics:n,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.addGraphics(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:i,layer:n}=this;if(!i||this.state==="disabled")throw n||this._logMissingLayer(),fi();if(i.activeTool!=null&&(i.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Ti(i,this._internalGraphicsLayer);const r=await this._updatingHandles.addPromise(this._setupCreateOperation(t,e));if(r==null||this.destroyed)return void i.map?.remove(this._internalGraphicsLayer);const s=()=>{if(r===this._operationHandle){const l=this.createGraphic,p=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map?.remove(this._internalGraphicsLayer),r.cancelled||l==null||this.addGraphic(l),this._sketchContinuationFlag=!1,this.emit("create",{graphic:l,state:p?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),p||this._sketchContinuationFlag)return;const{creationMode:a}=this;if(a==="continuous"){if(e?.geometryToPlace)return;this._updatingHandles.addPromise(_i(this.create(t,e)))}else a==="update"&&l&&this._updatingHandles.addPromise(_i(this.update([l])))}};r.on("complete",s),this._operationHandle=r,i.ready&&i.focus()}async place(t,e){return await t.load(),this.create("mesh",{mode:"click",hasZ:t.hasZ,geometryToPlace:t,...e})}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:i,view:n,state:r}=this;if(!n||r==="disabled")throw i||this._logMissingLayer(),fi();n.activeTool!=null&&(n.activeTool=null);const s=Array.isArray(t)?t:[t];if(t==null||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(p=>this.hasGraphic(p)?p.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0)))return;const l=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,e));this.destroyed||l==null||G(l)||(Ti(n,this._internalGraphicsLayer),this._setUpdateOperationHandle(l,e),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:l.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){t=Array.isArray(t)?t:[t];for(const i of t)i.geometry==null||i.geometry.type==="mesh"||ft(i.geometry.spatialReference,e.spatialReference)||(Tr(i.geometry.spatialReference,e.spatialReference)||$r()||await Er(),i.geometry=Ht(i.geometry,e.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const r=[];e.map.allLayers.forEach(l=>{l.type!=="vector-tile"&&l.type!=="imagery"||r.push(l)});const s=await e.hitTest(t,{exclude:r});return Na(s.results)}const i=[e.map.ground];e.map.allLayers.forEach(r=>{mr(r)&&i.push(r)});const n=await e.hitTest(t,{exclude:i});if(n.results.length>0){const r=n.results[0];if(r!=null&&r.type==="graphic"&&r.graphic&&(!n.ground.mapPoint||e.map.ground.opacity<1||n.ground.distance-(r.distance??0)>-Math.min(3*n.ground.distance,e.viewingMode==="global"?vr(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return r}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},M.WIDGET)]}async _handleImmediateClick(t){const e=await t.defer(()=>this._getFirstHit(wi(t)));let i=null;if(e!=null){const n=e.graphic;this.updateGraphics.includes(n)||this.hasGraphic(n)?(t.stopPropagation(),i=n):this.view?.type!=="2d"||this._isComponentGraphic(n)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(t,e){const i=this.view;if(!i)return this._logMissingView(),null;const n={hasZ:i.type==="3d",...this.defaultCreateOptions,...e},r=await this._setupDrawGraphicTool(t,i,n);return r==null?null:(i.tools.add(r),i.activeTool=r,this._setupCreateOperationHandle(r,t))}async _setupDrawGraphicTool(t,e,i){if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const{cursor:n,defaultZ:r,hasZ:s,geometryToPlace:l,graphicProperties:p,mode:a,preserveAspectRatio:o}=i,u=ja(a,t),d=Va(t),m=i?.optionsPerTool?.has(t)?i.optionsPerTool.get(t):{},y=m?.preserveAspectRatio??o??t!=="rectangle",g={centered:t!=="rectangle"&&!(t==="circle"&&!y),cursor:n,defaultZ:r,forceUniformSize:y,graphicProperties:{...p,attributes:{...p?.attributes}},geometryToPlace:l,geometryType:d,mode:u,graphicSymbol:this._getGraphicSymbolFromTool(t),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:e,...m};return e.type==="2d"?this._makeDrawGraphicTool2D(g):this._makeDrawGraphicTool3D(g)}async _makeDrawGraphicTool2D(t){const[e,i,n]=await Promise.all([this._requireModule(P(()=>import("./editingTools-wFUM0QGU.js"),__vite__mapDeps([64,1,2,3,65,10,66,67,11,5,68,33,69,70,26,71,41,37,72,73,74,29,30,31,32,18,75,76,77,78,79,80,81,6,7,8,82,4,83,9,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,91,92,93,94,95,38,39,40,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,42,47,117,118,119,120,121,122,28,34,35,36,43,44,45,46,48]),import.meta.url)),Je(),ve()]);return G(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:za(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}async _makeDrawGraphicTool3D(t){const[e,i,n]=await Promise.all([this._requireModule(P(()=>import("./ImageMaterial.glsl-Da3F2gho.js").then(r=>r.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url)),Je(),ve()]);return G(e)||this.destroyed?null:new e.module.DrawGraphicTool3D({...t,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}_setupCreateOperationHandle(t,e){const i=this.view;if(!i)return this._logMissingView(),null;let n=null;const r=t.forceUniformSize,s=t.centered,l=[i.on("key-down",a=>{if(a.key===O.pan)a.stopPropagation(),a.repeat||(t.enabled=!1);else if(a.key===O.complete)a.stopPropagation(),t.completeCreateOperation();else if(a.key!==O.vertexAdd||a.repeat)a.key===O.undo?(a.stopPropagation(),p.undo()):a.key===O.redo?(a.stopPropagation(),p.redo()):a.key!==O.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||a.repeat?a.key===O.center&&(a.repeat||(t.centered=!s,a.stopPropagation())):(t.forceUniformSize=!r,a.stopPropagation());else{const o=t.drawOperation.geometryType;o!=="polyline"&&o!=="polygon"&&o!=="multipoint"||(a.stopPropagation(),t.drawOperation.commitStagedVertex())}},M.WIDGET),i.on("key-up",a=>{a.key===O.pan?t.enabled=!0:a.key!==O.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?a.key===O.center&&(t.centered=s,a.stopPropagation()):(t.forceUniformSize=r,a.stopPropagation())},M.WIDGET),t.on("vertex-add",a=>{switch(n=n==null?"start":"active",a.operation){case"apply":this.emit("create",{graphic:t.graphic,state:n,tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",a=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:a.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",a=>{switch(a.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",a=>{this._set("createGraphic",a.graphic),n="complete",a.aborted?p&&p.cancel():p&&p.complete()}),de(()=>this._getGraphicSymbolFromTool(e),a=>{t.graphicSymbol=a})],p=new at({activeComponent:t,type:"create",onEnd:()=>{K(l),i.tools?.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return p}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol;case"text":return this.textSymbol}}async _setupUpdateOperation(t,e){const{view:i}=this;if(!i)return this._logMissingView(),null;const n={...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...e?.highlightOptions}};let r=n.tool??De.tool;if(this.removeGraphics(t),this.addGraphics(t),i.type==="3d"){if(t.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(t,n,i,r);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(t[0],n,i);case"transform":return this._setupGraphicTransform3DOperation(t,n,i)}}switch(r){case"move":return this._setupMove2DOperation(t,n,i);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(t,r,n,i);case"transform":return Pi(t)&&(r="reshape"),this._setupTransformOrReshape2DOperation(t,r,n,i)}}async _setupMove3DOperation(t,e,i,n,r=!1){const[s,l]=await Promise.all([this._requireModule(P(()=>import("./ImageMaterial.glsl-Da3F2gho.js").then(g=>g.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url)),ve()]);if(G(s))return s;const{ManipulatedObject3DGraphic:p,MoveTool3D:a}=s.module,o=new Map,u=()=>{o.forEach(g=>g.destroy()),o.clear()};for(const g of t){const f=new p({view:i,graphic:g}),_=rs(f);if(_!==0)return u(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Si(_)}).`),null;o.set(g,f)}const d=new a({view:i,enableZ:e.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:l});i.tools.add(d),d.objects.addMany(Array.from(o.values())),r||this.updateGraphics.addMany(t);const m=[],y=new oe({activeComponent:d,tool:n,type:"update",onEnd:()=>{K(m),tt(i,d),u()},undo:()=>{Hi(this.view,d),Qe(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{et(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:g=>{this.updateGraphics.push(g);const f=new p({view:i,graphic:g});o.set(g,f),d.objects.push(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:g=>{const f=this.updateGraphics.indexOf(g);if(y.history.undo.forEach($=>$.updates.splice(f,1)),y.history.redo.forEach($=>$.updates.splice(f,1)),this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void y.complete();const _=o.get(g);_&&(d.objects.remove(_),_.destroy(),o.delete(g))},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||n!=="transform")return;const g=this.updateGraphics.at(0),f=await this._setupReshape3DOperation(g,e,i,!0);f&&!G(f)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(f,e))}});return m.push(...this._getHandlesForComponent(y,e),i.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,e),M.WIDGET),i.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},M.WIDGET)),y}_setupGraphicTransform3DOperation(t,e,i,n=!1){if(t.length===1&&os(t[0])===0){const r=t[0],s=r.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(r,e,i);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(r,e,i,n)}return this._setupMove3DOperation(t,e,i,"transform",n)}async _setupPointTransform3DOperation(t,e,i){const n="transform",{enableRotation:r,enableScaling:s,enableZ:l}=e,p=await this._requireModule(P(()=>import("./ImageMaterial.glsl-Da3F2gho.js").then(g=>g.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url));if(G(p))return p;const{TransformTool3D:a,ManipulatedObject3DGraphic:o}=p.module,u=new o({graphic:t,view:i}),d=new a({object:u,view:i,enableRotation:r,enableScaling:s,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(d),this.updateGraphics.add(t);const m=[],y=new oe({activeComponent:d,tool:n,type:"update",onEnd:()=>{K(m),tt(i,d),u.destroy()},undo:()=>{Hi(this.view,d),Qe(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{et(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const f=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);G(f)||this._setUpdateOperationHandle(f,e)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return m.push(...this._getHandlesForComponent(y,e),i.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,e),M.WIDGET),i.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},M.WIDGET)),y}async _setupPolyTransform3DOperation(t,e,i,n=!1){const r="transform",{enableRotation:s,enableScaling:l,enableZ:p,preserveAspectRatio:a}=e,[o,u]=await Promise.all([this._requireModule(P(()=>import("./ImageMaterial.glsl-Da3F2gho.js").then(T=>T.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url)),ve()]);if(G(o))return o;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:m}=o.module,y=this.view?.inputManager?.isModifierKeyDown(O.constraint),g=new d({view:i,graphic:t}),f=new m({object:g,view:i,enableRotation:s,enableScaling:l,enableZ:p,preserveAspectRatio:!!a!=!!y,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:u});i.tools.add(f),n||this.updateGraphics.add(t);const _=[],$=new oe({activeComponent:f,tool:r,type:"update",onEnd:()=>{K(_),tt(i,f),g.destroy()},canUndo:()=>!f.destroyed&&f.canUndo,undo:()=>{f.destroyed||(f.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!f.destroyed&&f.canRedo,redo:()=>{f.destroyed||(f.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async T=>{this.updateGraphics.add(T),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[T],removed:[],type:"selection-change"},type:"update"}),$.onEnd(),$.destroy();const me=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);G(me)||this._setUpdateOperationHandle(me,e)},removeFromSelection:T=>{this.updateGraphics.remove(T),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[T],type:"selection-change"},type:"update"}),$.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const T=await this._setupReshape3DOperation(t,e,i,!0);T&&!G(T)&&($.onEnd(),$.destroy(),this._setUpdateOperationHandle(T,e))}});return _.push(...this._getHandlesForComponent($,e),i.on("immediate-click",T=>this._getCommonUpdateOperationClickHandlers($,T,e),M.WIDGET),i.on("key-down",T=>this._getCommonUpdateOperationKeyDownHandlers($,T),M.WIDGET),i.on("key-down",T=>{T.key!==O.constraint||T.repeat||(f.preserveAspectRatio=!f.preserveAspectRatio,T.stopPropagation())},M.WIDGET),i.on("key-up",T=>{T.key===O.constraint&&(f.preserveAspectRatio=!f.preserveAspectRatio,T.stopPropagation())},M.WIDGET)),$}async _setupMove2DOperation(t,e,i){const n="move";this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const r=await this._getGraphicMover(t,e,i);if(G(r))return r;const s=new oe({activeComponent:r,tool:n,type:"update",onEnd:()=>{this._clearCursor(),K(a),K(p),r.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const o=this.updateGraphics.toArray();Qe(s,o),s.refreshComponent(),this._emitUndoEvent({graphics:o,tool:n})},redo:()=>{const o=this.updateGraphics.toArray();et(s,o),s.refreshComponent(),this._emitRedoEvent({graphics:o,tool:n})},addToSelection:async o=>{await this._updatingHandles.addPromise(this._updateSpatialReference(o)),this.updateGraphics.push(o),r.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[o],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:o=>{const u=this.updateGraphics.indexOf(o);s.history.undo.forEach(m=>m.updates.splice(u,1)),s.history.redo.forEach(m=>m.updates.splice(u,1)),this.updateGraphics.remove(o);const d=this.updateGraphics.toArray();this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[o],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?r.graphics=d:s.complete()}});let l=!1;const p=[i.on("immediate-click",o=>this._getCommonUpdateOperationClickHandlers(s,o,e),M.WIDGET),i.on("key-down",o=>{this._getCommonUpdateOperationKeyDownHandlers(s,o),o.key!==O.constraint||o.repeat||(l=!0,r.enableMoveAllGraphics=!r.enableMoveAllGraphics)},M.WIDGET),i.on("key-up",o=>{o.key===O.constraint&&l&&(l=!1,r.enableMoveAllGraphics=!r.enableMoveAllGraphics)},M.WIDGET)],a=this._getHandlesForComponent(s,e);return s}async _setupReshape3DOperation(t,e,i,n=!1){const r="reshape",[s,l,p]=await Promise.all([this._requireModule(P(()=>import("./ImageMaterial.glsl-Da3F2gho.js").then(_=>_.e),__vite__mapDeps([123,1,2,3,121,37,38,11,6,7,8,77,69,33,68,5,70,26,71,41,72,73,74,29,30,31,32,18,75,76,78,79,80,81,82,4,83,9,10,12,13,14,15,16,17,84,85,86,19,20,21,22,23,24,25,27,60,87,88,89,90,40,124,125,42,39,47,126,127,48,128,129,130,131,132,133,46,134,135,50,51,52,53,136,137,138,139,140,141,98,142,143,144,145,45,146,147,148,149,150,151,152,153,154,99,100,155,66,67,156,91,92,93,94,95,96,97,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,157,158,117,118,119,159,160,161,120]),import.meta.url)),Je(),ve()]);if(G(s))return s;const{ManipulatedObject3DGraphic:a,ReshapeTool3D:o}=s.module,u=new a({view:i,graphic:t}),d=ss(u);if(d!==0)return u.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Si(d)}).`),null;const m=e.reshapeOptions,y=new o({view:i,object:u,enableZVertex:e.enableZ&&m?.vertexOperation==="move",enableZShape:e.enableZ&&m?.shapeOperation==="move",enableMoveObject:m?.shapeOperation==="move"||m?.shapeOperation==="move-xy",enableMidpoints:m?.edgeOperation==="split",enableEdgeOffset:m?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:p});i.tools.add(y),n||this.updateGraphics.add(u.graphic);const g=[],f=new oe({activeComponent:y,tool:r,type:"update",onEnd:()=>{K(g),tt(i,y),u.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),f.onEnd(),f.destroy();const $=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);G($)||this._setUpdateOperationHandle($,e)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),f.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;f.onEnd(),f.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,i,!0);G(_)||this._setUpdateOperationHandle(_,e)}});return g.push(...this._getHandlesForComponent(f,e),i.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(f,_,e),M.WIDGET),i.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(f,_)},M.WIDGET)),f}async _setupTransformOrReshape2DOperation(t,e,i,n){this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const r=e==="transform"?await this._getBox(t,i,n):await this._getReshape(t,i,n);if(G(r))return r;const s=new oe({activeComponent:r,type:"update",onEnd:()=>{K(p),K(l),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Qe(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{et(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async a=>{let o=s.activeComponent;if(o?.type==="reshape"){const u=[...this.updateGraphics,a];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const d=await this._setupTransformOrReshape2DOperation(u,"transform",i,n);if(G(d))return;this._setUpdateOperationHandle(d,i)}else this.updateGraphics.add(a),o.graphics=this.updateGraphics.toArray(),o.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[a],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:a=>{const o=this.updateGraphics.indexOf(a);s.history.undo.forEach(d=>d.updates.splice(o,1)),s.history.redo.forEach(d=>d.updates.splice(o,1)),this.updateGraphics.remove(a);const u=this.updateGraphics.toArray();u.length===0?s.complete():Pi(u)?s.toggleTool():s.activeComponent.graphics=u,this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[a],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const a=this.updateGraphics.at(0),o=a.geometry;if(o!=null&&(s.tool==="reshape"&&o.type==="point"||s.tool==="transform"&&o.type==="extent"))return;let u=null;s.tool==="transform"?u=await this._getReshape([a],i,n):s.tool==="reshape"&&(u=await this._getBox([a],i,n)),G(u)||(s.activeComponent?.destroy(),s.activeComponent=u,s.activeComponent&&(K(p),p=this._getHandlesForComponent(s,i)))}}),l=[n.on("immediate-click",a=>this._getCommonUpdateOperationClickHandlers(s,a,i),M.WIDGET),n.on("key-down",a=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,a),a.key===O.constraint&&!a.repeat&&s){const o=s.activeComponent;o&&o.type==="box"&&(o.preserveAspectRatio=!o.preserveAspectRatio)}},M.WIDGET),n.on("key-up",a=>{if(a.key===O.constraint&&s){const o=s.activeComponent;o&&o.type==="box"&&(o.preserveAspectRatio=!o.preserveAspectRatio)}},M.WIDGET)];let p=this._getHandlesForComponent(s,i);return s}async _getGraphicMover(t,e,i){const{enableMoveAllGraphics:n,highlightOptions:r}=e,s=await this._requireModule(P(()=>import("./GraphicMover-C_OtEDHr.js").then(l=>l.G),__vite__mapDeps([188,1,2,3,19,20,21,22,23,24,25,26,27,7,8,122,97,29,30,31,32,60,120,11,13,14,15,16,6,87]),import.meta.url));return G(s)?s:new s.module.default({enableMoveAllGraphics:n,highlightName:r?.name,highlightsEnabled:!!r?.enabled,indicatorsEnabled:!1,graphics:t,view:i,callbacks:{onGraphicMoveStart:({dx:l,dy:p,graphic:a})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:a,type:"move-start"},type:"update"})},onGraphicMove:({dx:l,dy:p,graphic:a})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:a,type:"move"},type:"update"}),onGraphicMoveStop:({dx:l,dy:p,graphic:a})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:a,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(t,e,i){const{enableRotation:n,enableScaling:r,highlightOptions:s,preserveAspectRatio:l}=e,[p,a]=await Promise.all([this._requireModule(P(()=>import("./Box-BLSlNZpm.js"),__vite__mapDeps([189,1,2,3,5,96,122,97,188,19,20,21,22,23,24,25,26,27,7,8,29,30,31,32,60,120,11,13,14,15,16,6,87,190,68,33,69,70,71,41,37,72,73,74,18,75,76,77,78,79,80,81,82,4,83,9,10,12,17,84,85,86,88,89,90,161,157,28,34,35,36,38,39,40,42,43,44,45,46,47,48]),import.meta.url)),ve()]);if(G(p))return p;const o=this.view?.inputManager?.isModifierKeyDown(O.constraint);return new p.module.default({graphics:t,enableRotation:n,enableScaling:r,highlightName:s?.name,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!l!=!!o,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:a,callbacks:{onMoveStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMove:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMoveStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScale:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotate:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"})}})}async _getReshape(t,e,i){const{highlightOptions:n,reshapeOptions:r}=e,s=r?.edgeOperation==="split",l=r?.shapeOperation==="move",p=!!r?.enableCreateCurveFromStraightEdge,[a,o,u]=await Promise.all([this._requireModule(P(()=>import("./Reshape-VJsb3PDY.js"),__vite__mapDeps([191,1,2,3,33,110,103,106,105,107,108,109,111,19,20,21,22,23,24,25,26,27,7,8,65,10,66,67,11,5,68,69,70,71,41,37,72,73,74,29,30,31,32,18,75,76,77,78,79,80,81,6,82,4,83,9,12,13,14,15,16,17,84,85,86,60,87,88,89,90,192,158,117,118,119,159,160,121,38,193,114,156,122,97,188,120,157,190,95,39,40,96,28,34,35,36,42,43,44,45,46,47,48]),import.meta.url)),Je(),ve()]);return G(a)?a:new a.module.default({enableMidpoints:s,enableMovement:l,enableCurveOnMidpoint:p,graphic:t[0],highlightName:n?.name,highlightsEnabled:!!n?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:o,automaticLengthMeasurementUtils:u,view:i,callbacks:{onReshapeStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshape:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshapeStop:({mover:d,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d,type:m},type:"update"}),onMoveStart:({dx:d,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:m,mover:y,type:g},type:"update"}),onMove:({dx:d,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:m,mover:y,type:g},type:"update"}),onMoveStop:({dx:d,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:m,mover:y,type:g},type:"update"}),onVertexAdd:({added:d,type:m,vertices:y})=>{const g=d.map(f=>mi(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:y,type:m},type:"update"})},onVertexRemove:({removed:d,type:m,vertices:y})=>{const g=d.map(f=>mi(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:y,type:m},type:"update"})}}})}_getHandlesForComponent(t,e){const i=t.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:n,viewEvent:r})=>{r.native?.shiftKey&&e.multipleSelectionEnabled&&(r.stopPropagation(),t.removeFromSelection(n))}),i.on("graphic-move-start",n=>t.addToHistory(ce(n.allGraphics)))];case"box":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,e,n)),i.on("move-start",n=>t.addToHistory(ce(n.graphics))),i.on("rotate-start",n=>t.addToHistory(ce(n.graphics))),i.on("scale-start",n=>t.addToHistory(ce(n.graphics)))];case"reshape":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,e,n)),i.on("move-start",n=>t.addToHistory(ce([n.mover]))),i.on("reshape-start",n=>t.addToHistory(ce([n.graphic]))),i.on("vertex-add",n=>t.addToHistory(ce([n.oldGraphic]))),i.on("vertex-remove",n=>t.addToHistory(ce([n.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),i.events.on("move-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n.dx,dy:n.dy,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),i.events.on("translate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate"},type:"update"})}),i.events.on("scale",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("vertex-add",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("vertex-remove",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,i){const{graphic:n,viewEvent:r}=i;return r.native?.shiftKey&&this.hasGraphic(n)?(r.stopPropagation(),t.removeFromSelection(n)):e.toggleToolOnClick?(r.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){this._operationHandle=t;const i=this.view?.map;this._disablePopup(e);const n=()=>{if(t===this._operationHandle){const r=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:r,state:"complete",aborted:t.cancelled,tool:s,toolEventInfo:null,type:"update"})}};t.on("complete",n)}async _getCommonUpdateOperationClickHandlers(t,e,i){const n=wi(e),r=await e.defer(()=>this._getFirstHit(n));if(r==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([r.graphic],t,i))return void e.stopPropagation();this.updateGraphics.includes(r.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,i){const n=!!i.multipleSelectionEnabled;return t.some(r=>r!=null&&!(!n||!this.hasGraphic(r))&&(this.updateGraphics.includes(r)?e.removeFromSelection(r):e.addToSelection(r),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const i=e.key;i===O.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):i===O.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):i===O.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&O.delete.includes(i)&&this._onDeleteKey(e)}_onDeleteKey(t){if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,i=this.updateGraphics.toArray();e!=null&&(e.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Ze(this._internalGraphicsLayer))}_isComponentGraphic(t){const{activeComponent:e}=this;return!(!t||e==null)&&(t.attributes?.esriSketchTool||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_clearCursor(){this.removeHandles(Lt)}_displayCursor(t){this.removeHandles(Lt),this.view?.container&&t!=null&&this.addHandles(this.view.acquireCursor(t,"high"),Lt)}_logError(t,e,i){Ui.getLogger(this).error(new _r(t,e,i))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const i=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}_onLayerGraphicsChangeCallback(t){if(this._operationHandle!=null){const{updateGraphics:e}=this;for(const i of t.removed)if(e.includes(i)){if(!(e.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(i)}}}get test(){}wait(){return vi(()=>!this.updating)}_disablePopupEnabled(t){return this.view?.type!=="3d"||this.updateOnGraphicClick||(t?.toggleToolOnClick??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const t=this.view;t?(Et(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await br(vi(()=>t?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Li("view"))}_logMissingLayer(){this._logError(qa,Li("layer"))}};c([h()],b.prototype,"_defaultSnappingManager",void 0),c([h()],b.prototype,"_layerAdapter",null),c([h()],b.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],b.prototype,"_updatingHandles",void 0),c([h({readOnly:!0})],b.prototype,"activeTool",null),c([h({readOnly:!0})],b.prototype,"activeCreateToolDrawMode",null),c([h()],b.prototype,"activeTooltip",null),c([h({types:Ae})],b.prototype,"activeFillSymbol",void 0),c([h()],b.prototype,"activeLineSymbol",void 0),c([h()],b.prototype,"activeVertexSymbol",void 0),c([h()],b.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],b.prototype,"createGraphic",null),c([h()],b.prototype,"defaultCreateOptions",null),c([h()],b.prototype,"defaultUpdateOptions",null),c([h({type:Yt,nonNullable:!0})],b.prototype,"labelOptions",null),c([h()],b.prototype,"layer",void 0),c([h({types:Ae})],b.prototype,"pointSymbol",void 0),c([h({types:Ae})],b.prototype,"polygonSymbol",void 0),c([h({types:Ae})],b.prototype,"polylineSymbol",void 0),c([h()],b.prototype,"meshSymbol",void 0),c([h()],b.prototype,"textSymbol",void 0),c([h({type:x,nonNullable:!0})],b.prototype,"snappingOptions",null),c([h()],b.prototype,"snappingManager",null),c([h({readOnly:!0})],b.prototype,"state",null),c([h({type:Qt,nonNullable:!0})],b.prototype,"tooltipOptions",null),c([h({readOnly:!0})],b.prototype,"updateGraphics",void 0),c([h()],b.prototype,"updateOnGraphicClick",void 0),c([h()],b.prototype,"updating",null),c([h()],b.prototype,"creationMode",void 0),c([h({type:Xt,nonNullable:!0})],b.prototype,"valueOptions",null),c([h({types:Ae})],b.prototype,"vertexSymbol",void 0),c([h({value:null})],b.prototype,"view",null),c([h({constructOnly:!0,type:nn})],b.prototype,"sketchOptions",void 0),b=c([R("esri.widgets.Sketch.SketchViewModel")],b);const qa="sketch:missing-property",Li=t=>`Property '${t}' is missing on SketchViewModel.`;function za(t){return t==="polygon"||t==="rectangle"||t==="circle"}function Qe(t,e){Ln("undo",t.history.undo,t.history.redo,e)}function et(t,e){Ln("redo",t.history.redo,t.history.undo,e)}function Ln(t,e,i,n){const r=e.pop();if(!r)return;const s=r.updates,l=[];n.forEach((p,a)=>{const o=s[a];o!=null&&("geometry"in o&&o.geometry!=null&&(l.push({geometry:p.geometry}),p.geometry=o.geometry),"symbol"in o&&o.symbol!=null&&(l.push({symbol:p.symbol}),p.symbol=o.symbol),"undo"in o&&(l.push(o),o[t](p)))}),i.push({updates:l})}function Hi(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function ce(t){return{updates:t.map(({geometry:e})=>e?.type==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function tt(t,e){t.tools?.remove(e),e.destroyed||e.destroy()}function G(t){return"requireError"in t&&t.requireError==="aborted"}export{z as $,il as A,_o as B,sn as C,qo as D,Uo as E,Ho as F,No as G,na as H,jo as I,sa as J,ea as K,te as L,ia as M,Mn as N,hn as O,el as P,ve as Q,Je as R,x as S,Le as T,Ei as U,_n as V,ci as W,Os as X,As as Y,ks as Z,Yt as _,St as a,ds as a0,La as a1,Vo as a2,ae as a3,Xt as a4,Na as a5,aa as a6,Mo as a7,xo as a8,Go as a9,rs as aa,tl as ab,Ha as ac,Ot as b,Qs as c,Ro as d,Ys as e,U as f,ge as g,$n as h,ta as i,xe as j,Lo as k,rn as l,b as m,st as n,nn as o,ht as p,$i as q,ra as r,Oo as s,Ti as t,la as u,Do as v,vo as w,Io as x,hs as y,Eo as z};
