import{r as S,t as J}from"./arcadeEnvironment-CGtXgdl9.js";import{e as D,R as g,v as Z,q as X,L as x,_ as y,I as j,o as tt,p as b,P as w,y as z,S as u,g as N,d as xt,a as Ft,Q as G,t as A,H as et,B as rt,U as nt,s as It,b as P,r as kt,n as at}from"./Dictionary-B0UU8VOj.js";import{o as Ot,i as ot,s as it,j as Mt,E as Rt,P as Ct,g as Nt,C as At,a as Et,b as Bt,y as jt,d as q,f as st,c as Gt,p as Kt}from"./arcade-WEshytE2.js";import{n as o,i as lt}from"./enum-D3e-PyKo.js";import{I as ct}from"./Feature-DEFbFbhW.js";import{T as Ut}from"./aiServices-BhAKf1Iw.js";import{registerFunctions as _t}from"./geomasync-UH-KK5b6.js";import{z as ut,eS as Lt,eT as k,eU as h,eV as ft,eW as E,d$ as B,i as Dt}from"./main-CSjwO60s.js";const W=()=>Dt.getLogger("esri.arcade.arcadeAsyncRuntime"),M=Symbol("uninitialized");function K(e){if(e===M)throw new o(null,"InvalidIdentifier",null)}function wt(e){return K(e),e}function R(e,t){const r=S(t);if(e.localScope!==null){const i=e.localScope[r];if(i!==void 0)return{scope:e.localScope,id:r,var:i}}const n=e.globalScope[r];if(n!==void 0)return{scope:e.globalScope,id:r,var:n};throw new o(e,"InvalidIdentifier",t)}function pt(e,t,r="InvalidIdentifier"){const n=S(t);if(e.localScope!==null){const s=e.localScope[n];if(s!==void 0)return K(s),s.value}const i=e.globalScope[n];if(i!==void 0)return K(i),i.value;throw new o(e,r,t)}const U=function(){};async function dt(e,t){const r=[];for(let n=0;n<t.arguments.length;n++)r.push(await c(e,t.arguments[n]));return r}async function v(e,t,r){return t.preparsed===!0?r(e,null,t.arguments):r(e,t,await dt(e,t))}U.prototype=Object.freeze(Object.create(null));class Zt extends kt{constructor(t,r,n,i){super(),this.definition=t,this.context=r,this._params=n,this._locals=i}createFunction(t){return(...r)=>{const n={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,services:this.context.services,abortSignal:this.context.abortSignal,localScope:new U,depthCounter:{depth:t.depthCounter.depth+1},globalScope:this.context.globalScope,track:this.context.track};if(n.depthCounter.depth>64)throw new o(t,"MaximumCallDepth",null);return T(n,this.definition.body,this._params,this._locals,r,null)}}call(t,r){return V(t,r,(n,i,s)=>{const a={spatialReference:t.spatialReference,services:t.services,console:t.console,libraryResolver:t.libraryResolver,exports:t.exports,lrucache:t.lrucache,timeZone:t.timeZone??null,interceptor:t.interceptor,localScope:new U,abortSignal:t.abortSignal,globalScope:t.globalScope,depthCounter:{depth:t.depthCounter.depth+1},track:t.track};if(a.depthCounter.depth>64)throw new o(t,"MaximumCallDepth",r);return T(a,this.definition.body,this._params,this._locals,s,r)})}marshalledCall(t,r,n,i){return i(t,r,async(s,a,l)=>{const f={spatialReference:t.spatialReference,services:t.services,globalScope:n.globalScope,depthCounter:{depth:t.depthCounter.depth+1},libraryResolver:t.libraryResolver,exports:t.exports,console:t.console,abortSignal:t.abortSignal,lrucache:t.lrucache,timeZone:t.timeZone??null,interceptor:t.interceptor,localScope:new U,track:t.track};return l=l.map(p=>!x(p)||p instanceof P?p:at(p,t,i)),at(await T(f,this.definition.body,this._params,this._locals,l,r),n,i)})}}async function T(e,t,r,n,i,s){if(r.length!==i.length)throw new o(e,"WrongNumberOfParameters",s);if(e.localScope!=null){for(let l=0;l<r.length;l++)e.localScope[r[l]]={value:i[l]};for(const l of n)e.localScope[l]=M}const a=await m(e,t);if(a instanceof g)return a.value;if(a===y)throw new o(e,"UnexpectedToken",s);if(a===j)throw new o(e,"UnexpectedToken",s);return a instanceof Z?a.value:a}class I extends It{constructor(t){super(),this.moduleGlobalContext=t}global(t){const r=S(t),n=this.moduleGlobalContext.globalScope[r];if(K(n),x(n.value)&&!(n.value instanceof P)){const i=new P;return i.fn=n.value,i.parameterEvaluator=v,i.context=this.moduleGlobalContext,this.moduleGlobalContext.globalScope[r]={value:i},i}return n.value}setGlobal(t,r){if(x(r))throw new o(null,"AssignModuleFunction",null);const n=S(t);if(this.moduleGlobalContext.globalScope[n]===void 0)throw new o(null,"ModuleExportNotFound",null);this.moduleGlobalContext.globalScope[n]={value:r}}hasGlobal(t){return this.moduleGlobalContext.exports.has(S(t))}static async load(t,r){const{globals:n,exports:i}=ot(r),s=new Q;for(const f of n)f in s||(s[f]=M);const a=t.spatialReference??ut.WebMercator,l={lrucache:t.lrucache,interceptor:t.interceptor,services:t.services,console:t.console??vt,abortSignal:t.abortSignal??J,timeZone:t.timeZone??null,spatialReference:a,track:null,depthCounter:{depth:1},libraryResolver:new it(t.libraryResolver._moduleSingletons,r.loadedModules),exports:i,localScope:null,globalScope:s};return await $(l,r),new I(l)}}async function V(e,t,r){return t.preparsed===!0?r(e,null,t.arguments):r(e,t,await dt(e,t))}async function c(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case"UpdateExpression":return await Ht(e,t);case"AssignmentExpression":return await Qt(e,t);case"TemplateLiteral":return await fe(e,t);case"Identifier":return H(e,t);case"MemberExpression":return await oe(e,t);case"Literal":return t.value;case"CallExpression":return await ue(e,t);case"UnaryExpression":return await ie(e,t);case"BinaryExpression":return await le(e,t);case"LogicalExpression":return await ce(e,t);case"ArrayExpression":return await se(e,t);case"ObjectExpression":return await zt(e,t);default:throw new o(e,"Unrecognized",t)}}catch(r){throw lt(e,t,r)}}async function m(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case"ImportDeclaration":return await ee(e,t);case"ExportNamedDeclaration":return await re(e,t);case"VariableDeclaration":return await ne(e,t);case"BlockStatement":return await $(e,t);case"FunctionDeclaration":return await te(e,t);case"ReturnStatement":return await Xt(e,t);case"IfStatement":return await Jt(e,t);case"ExpressionStatement":return await Yt(e,t);case"ForStatement":return await qt(e,t);case"WhileStatement":return await Pt(e,t);case"ForInStatement":return await Vt(e,t);case"ForOfStatement":return await $t(e,t);case"BreakStatement":return y;case"EmptyStatement":return w;case"ContinueStatement":return j;default:throw new o(e,"Unrecognized",t)}}catch(r){throw lt(e,t,r)}}async function zt(e,t){const r=[];for(let a=0;a<t.properties.length;a++){const l=t.properties[a],f=await c(e,l.value),p=l.key.type==="Identifier"?l.key.name:await c(e,l.key);r[a]={key:p,value:f}}const n=Object.create(null),i=new Map;for(let a=0;a<r.length;a++){const l=r[a];if(x(l.value))throw new o(e,"NoFunctionInDictionary",t);if(h(l.key)===!1)throw new o(e,"KeyMustBeString",t);let f=l.key.toString();const p=f.toLowerCase();i.has(p)?f=i.get(p):i.set(p,f),l.value===w?n[f]=null:n[f]=l.value}const s=new b(n);return s.immutable=!1,s}async function Pt(e,t){let r=await c(e,t.test);if(r===!1)return w;if(r!==!0)throw new o(e,"BooleanConditionRequired",t);for(;r===!0;){const n=await m(e,t.body);if(n===y)break;if(n instanceof g)return n;if(r=await c(e,t.test),r!==!0&&r!==!1)throw new o(e,"BooleanConditionRequired",t)}return w}async function qt(e,t){try{for(t.init!==null&&(t.init.type==="VariableDeclaration"?await m(e,t.init):await c(e,t.init));;){if(t.test!==null){const n=await c(e,t.test);if(e.abortSignal?.aborted===!0)throw new o(e,"Cancelled",t);if(n===!1)break;if(n!==!0)throw new o(e,"BooleanConditionRequired",t)}const r=await m(e,t.body);if(r===y)break;if(r instanceof g)return r;t.update!==null&&await c(e,t.update)}return w}catch(r){throw r}}async function _(e,t,r,n,i="i"){const s=r.length;for(let a=0;a<s;a++){if(i==="k"){if(a>=r.length)throw new o(e,"OutOfBounds",t);n.scope[n.id]={value:r[a]}}else n.scope[n.id]={value:a};const l=await m(e,t.body);if(l===y)break;if(l instanceof g)return l}return w}async function ht(e,t,r,n,i="i"){const s=r.length();for(let a=0;a<s;a++){n.scope[n.id]=i==="k"?{value:r.get(a)}:{value:a};const l=await m(e,t.body);if(l===y)break;if(l instanceof g)return l}return w}async function mt(e,t,r,n){const i=r.iterator(e.abortSignal);let s;for(;(s=await i.next())!=null;){const a=ct.createFromGraphicLikeObject(s.geometry,s.attributes,r,e.timeZone);a._underlyingGraphic=s,n.scope[n.id]={value:a};const l=await m(e,t.body);if(l===y)break;if(l instanceof g)return l}return w}async function Wt(e,t,r,n){for(const i of r.keys()){const s=r.field(i);n.scope[n.id]={value:b.containerEntry(i,s)};const a=await m(e,t.body);if(a===y)break;if(a instanceof g)return a}return w}async function Tt(e,t,r,n){for(const i of st(r)){const s=q(r,i,e,t,1);n.scope[n.id]={value:b.containerEntry(i,s)};const a=await m(e,t.body);if(a===y)break;if(a instanceof g)return a}return w}async function Vt(e,t){const r=await c(e,t.right);t.left.type==="VariableDeclaration"&&await m(e,t.left);const n=R(e,t.left.type==="VariableDeclaration"?t.left.declarations[0].id:t.left);return E(r)||h(r)?await _(e,t,r,n):A(r)?await ht(e,t,r,n):r instanceof b||G(r)?await _(e,t,r.keys(),n,"k"):rt(r)?await mt(e,t,r,n):nt(r)?await _(e,t,st(r),n,"k"):w}async function $t(e,t){const r=await c(e,t.right);t.left.type==="VariableDeclaration"&&await m(e,t.left);const n=R(e,t.left.type==="VariableDeclaration"?t.left.declarations[0].id:t.left);return E(r)||h(r)?await _(e,t,r,n,"k"):A(r)?await ht(e,t,r,n,"k"):r instanceof b||G(r)?await Wt(e,t,r,n):rt(r)?await mt(e,t,r,n):nt(r)?await Tt(e,t,r,n):w}async function Ht(e,t){const r=t.argument;if(r.type==="CallExpression")throw new o(e,"NeverReach",t);if(r.type==="MemberExpression"){const a=await c(e,r.object);let l,f;if(r.computed===!0)l=await c(e,r.property);else{if(r.property.type!=="Identifier")throw new o(e,"Unrecognized",t);l=r.property.name}if(E(a)){if(!B(l))throw new o(e,"ArrayAccessMustBeNumber",t);if(l<0&&(l=a.length+l),l<0||l>=a.length)throw new o(e,"OutOfBounds",t);f=u(a[l]),a[l]=t.operator==="++"?f+1:f-1}else if(a instanceof b){if(h(l)===!1)throw new o(e,"KeyAccessorMustBeString",t);if(a.hasField(l)!==!0)throw new o(e,"FieldNotFound",t,{key:l});f=u(a.field(l)),a.setField(l,t.operator==="++"?f+1:f-1)}else if(a instanceof I){if(h(l)===!1)throw new o(e,"ModuleAccessorMustBeString",t);if(a.hasGlobal(l)!==!0)throw new o(e,"ModuleExportNotFound",t);f=u(a.global(l)),a.setGlobal(l,t.operator==="++"?f+1:f-1)}else{if(!et(a))throw A(a)?new o(e,"Immutable",t):new o(e,"InvalidParameter",t);if(h(l)===!1)throw new o(e,"KeyAccessorMustBeString",t);if(a.hasField(l)!==!0)throw new o(e,"FieldNotFound",t,{key:l});f=u(a.field(l)),a.setField(l,t.operator==="++"?f+1:f-1)}return t.prefix===!1?f:t.operator==="++"?f+1:f-1}const n=R(e,r),i=u(wt(n.var).value),s=t.operator==="++"?i+1:i-1;return n.scope[n.id]={value:s},t.prefix===!1?i:t.operator==="++"?i+1:i-1}function F(e,t,r,n,i){switch(t){case"=":return e===w?null:e;case"/=":return u(r)/u(e);case"*=":return u(r)*u(e);case"-=":return u(r)-u(e);case"+=":return h(r)||h(e)?N(r)+N(e):u(r)+u(e);case"%=":return u(r)%u(e);default:throw new o(i,"UnsupportedOperator",n)}}async function Qt(e,t){const r=t.left;if(r.type==="MemberExpression"){const s=await c(e,r.object);let a;if(r.computed===!0)a=await c(e,r.property);else{if(r.property.type!=="Identifier")throw new o(e,"InvalidIdentifier",t);a=r.property.name}const l=await c(e,t.right);if(E(s)){if(!B(a))throw new o(e,"ArrayAccessMustBeNumber",t);if(a<0&&(a=s.length+a),a<0||a>s.length)throw new o(e,"OutOfBounds",t);if(a===s.length){if(t.operator!=="=")throw new o(e,"OutOfBounds",t);s[a]=F(l,t.operator,s[a],t,e)}else s[a]=F(l,t.operator,s[a],t,e)}else if(s instanceof b){if(h(a)===!1)throw new o(e,"KeyAccessorMustBeString",t);if(s.hasField(a)===!0)s.setField(a,F(l,t.operator,s.field(a),t,e));else{if(t.operator!=="=")throw new o(e,"FieldNotFound",t,{key:a});s.setField(a,F(l,t.operator,null,t,e))}}else if(s instanceof I){if(h(a)===!1)throw new o(e,"KeyAccessorMustBeString",t);if(s.hasGlobal(a)!==!0)throw new o(e,"ModuleExportNotFound",t);s.setGlobal(a,F(l,t.operator,s.global(a),t,e))}else{if(!et(s))throw A(s)?new o(e,"Immutable",t):new o(e,"InvalidParameter",t);if(h(a)===!1)throw new o(e,"KeyAccessorMustBeString",t);if(s.hasField(a)===!0)s.setField(a,F(l,t.operator,s.field(a),t,e));else{if(t.operator!=="=")throw new o(e,"FieldNotFound",t,{key:a});s.setField(a,F(l,t.operator,null,t,e))}}return w}const n=R(e,r),i=await c(e,t.right);return n.scope[n.id]={value:F(i,t.operator,t.operator!=="="?wt(n.var).value:null,t,e)},w}async function Yt(e,t){const r=await c(e,t.expression);return r===w?w:new Z(r)}async function Jt(e,t){const r=await c(e,t.test);if(r===!0)return m(e,t.consequent);if(r===!1)return t.alternate!==null?m(e,t.alternate):w;throw new o(e,"BooleanConditionRequired",t)}async function $(e,t){return gt(e,t,0)}async function gt(e,t,r){if(r>=t.body.length)return w;const n=await m(e,t.body[r]);return n instanceof g||n===y||n===j||r===t.body.length-1?n:gt(e,t,r+1)}async function Xt(e,t){if(t.argument===null)return new g(w);const r=await c(e,t.argument);return new g(r)}async function te(e,t){if(e.localScope!=null)throw W().error("Function declarations are only valid in global scope."),new o(e,"NeverReach",t);const r=S(t.id);if(!(r in e.globalScope))throw W().error(`Function "${r}" not declared.`),new o(e,"NeverReach",t);const n=Gt(t),i=t.params.map(a=>S(a)),s=Array.from(n).filter(a=>!i.includes(a));return e.globalScope[r]={value:new Zt(t,e,i,s)},w}async function ee(e,t){const r=R(e,t.specifiers[0].local),n=e.libraryResolver;if(n==null)throw W().error("Internal error: module loader not initialized"),new o(e,"NeverReach",t);const i=n.loadLibrary(r.id);let s;return n._moduleSingletons?.has(i.uri)?s=n._moduleSingletons.get(i.uri):(s=await I.load(e,i.syntax),n._moduleSingletons?.set(i.uri,s)),r.scope[r.id]={value:s},w}async function re(e,t){return await m(e,t.declaration),w}async function ne(e,t){for(const r of t.declarations)await ae(e,r);return w}async function ae(e,t){let r=null;r=t.init===null?null:await c(e,t.init),r===w&&(r=null);const n=R(e,t.id);n.scope[n.id]={value:r}}async function oe(e,t){const r=await c(e,t.object);if(r===null)throw new o(e,"MemberOfNull",t);if(t.computed===!1){if(t.property.type==="Identifier"){if(r instanceof b||G(r))return r.field(t.property.name);if(r instanceof ft)return q(r,t.property.name,e,t);if(r instanceof I){if(!r.hasGlobal(t.property.name))throw new o(e,"InvalidIdentifier",t);return r.global(t.property.name)}throw new o(e,"InvalidMemberAccessKey",t)}throw new o(e,"InvalidMemberAccessKey",t)}let n=await c(e,t.property);if(r instanceof b||G(r)){if(h(n))return r.field(n);throw new o(e,"InvalidMemberAccessKey",t)}if(r instanceof I){if(h(n))return r.global(n);throw new o(e,"InvalidMemberAccessKey",t)}if(r instanceof ft){if(h(n))return q(r,n,e,t);throw new o(e,"InvalidMemberAccessKey",t)}if(E(r)){if(B(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=r.length+n),n>=r.length||n<0)throw new o(e,"OutOfBounds",t);return r[n]}throw new o(e,"InvalidMemberAccessKey",t)}if(A(r)){if(B(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=r.length()+n),n>=r.length()||n<0)throw new o(e,"OutOfBounds",t);return r.get(n)}throw new o(e,"InvalidMemberAccessKey",t)}if(h(r)){if(B(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=r.length+n),n>=r.length||n<0)throw new o(e,"OutOfBounds",t);return r[n]}throw new o(e,"InvalidMemberAccessKey",t)}throw new o(e,"InvalidMemberAccessKey",t)}async function ie(e,t){const r=await c(e,t.argument);if(k(r)){if(t.operator==="!")return!r;if(t.operator==="-")return-1*u(r);if(t.operator==="+")return 1*u(r);if(t.operator==="~")return~u(r);throw new o(e,"UnsupportUnaryOperator",t)}if(t.operator==="-")return-1*u(r);if(t.operator==="+")return 1*u(r);if(t.operator==="~")return~u(r);throw new o(e,"UnsupportUnaryOperator",t)}async function se(e,t){const r=[];for(let n=0;n<t.elements.length;n++)r.push(await c(e,t.elements[n]));for(let n=0;n<r.length;n++){if(x(r[n]))throw new o(e,"NoFunctionInArray",t);r[n]===w&&(r[n]=null)}return r}async function le(e,t){const r=await c(e,t.left),n=await c(e,t.right);switch(t.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return Ft(u(r),u(n),t.operator);case"==":return z(r,n);case"!=":return!z(r,n);case"<":case">":case"<=":case">=":return xt(r,n,t.operator);case"+":return h(r)||h(n)?N(r)+N(n):u(r)+u(n);case"-":return u(r)-u(n);case"*":return u(r)*u(n);case"/":return u(r)/u(n);case"%":return u(r)%u(n);default:throw new o(e,"UnsupportedOperator",t)}}async function ce(e,t){const r=await c(e,t.left);if(!k(r))throw new o(e,"LogicalExpressionOnlyBoolean",t);switch(t.operator){case"||":{if(r===!0)return r;const n=await c(e,t.right);if(k(n))return n;throw new o(e,"LogicExpressionOrAnd",t)}case"&&":{if(r===!1)return r;const n=await c(e,t.right);if(k(n))return n;throw new o(e,"LogicExpressionOrAnd",t)}default:throw new o(e,"LogicExpressionOrAnd",t)}}function H(e,t){return pt(e,t)}async function ue(e,t){if(t.callee.type==="MemberExpression"){const n=await c(e,t.callee.object);if(!(n instanceof I))throw new o(e,"FunctionNotFound",t);const i=t.callee.computed===!1?t.callee.property.name:await c(e,t.callee.property);if(!n.hasGlobal(i))throw new o(e,"FunctionNotFound",t);const s=n.global(i);if(!x(s))throw new o(e,"CallNonFunction",t);return s.call(e,t)}if(t.callee.type!=="Identifier")throw new o(e,"FunctionNotFound",t);const r=pt(e,t.callee,"FunctionNotFound");if(x(r))return r.call(e,t);throw new o(e,"CallNonFunction",t)}async function fe(e,t){let r="",n=0;for(const i of t.quasis)if(r+=i.value?i.value.cooked:"",i.tail===!1){if(t.expressions[n]){const s=await c(e,t.expressions[n]);if(x(s))throw new o(e,"NoFunctionInTemplateLiteral",t);r+=N(s)}n++}return r}async function we(e,t){tt(t.arguments===null?[]:t.arguments,3,3,e,t);const r=await c(e,t.arguments[0]);if(k(r)===!1)throw new o(e,"BooleanConditionRequired",t);return c(e,r?t.arguments[1]:t.arguments[2])}async function pe(e,t){tt(t.arguments===null?[]:t.arguments,2,3,e,t);const r=await c(e,t.arguments[0]);if(t.arguments.length===3){const n=await c(e,t.arguments[1]),i=jt(r,n);return i!=null&&i!==""?i:c(e,t.arguments[2])}return r==null||r===""?c(e,t.arguments[1]):r}async function de(e,t){if(t.arguments.length<2)throw new o(e,"WrongNumberOfParameters",t);if(t.arguments.length===2)return c(e,t.arguments[1]);if((t.arguments.length-1)%2==0)throw new o(e,"WrongNumberOfParameters",t);return yt(e,t,1,await c(e,t.arguments[0]))}async function yt(e,t,r,n){const i=await c(e,t.arguments[r]);if(z(i,n))return c(e,t.arguments[r+1]);const s=t.arguments.length-r;return s===1?c(e,t.arguments[r]):s===2?null:s===3?c(e,t.arguments[r+2]):yt(e,t,r+2,n)}async function he(e,t){if(t.arguments.length<3)throw new o(e,"WrongNumberOfParameters",t);if(t.arguments.length%2==0)throw new o(e,"WrongNumberOfParameters",t);const r=await c(e,t.arguments[0]);if(k(r)===!1)throw new o(e,"BooleanConditionRequired",t.arguments[0]);return bt(e,t,0,r)}async function bt(e,t,r,n){if(n===!0)return c(e,t.arguments[r+1]);if(t.arguments.length-r===3)return c(e,t.arguments[r+2]);const i=await c(e,t.arguments[r+2]);if(k(i)===!1)throw new o(e,"ModuleExportNotFound",t.arguments[r+2]);return bt(e,t,r+2,i)}function me(){const e=Object.create(null);Mt(e,v),Rt(e,v),Ct(e,v,H),Nt(e,v),At(e,v),Et(e,v),Bt(e,v),_t({functions:e,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:v,standardFunctionAsync:V}),e.iif=we,e.defaultvalue=pe,e.decode=de,e.when=he;const t=function(){this.textformatting={value:b.textFormatting()}};t.prototype=Object.create(null),t.prototype.infinity=Object.freeze({value:Number.POSITIVE_INFINITY}),t.prototype.pi=Object.freeze({value:Math.PI});for(const[r,n]of Object.entries(e))t.prototype[r]=Object.freeze({value:new D(n)});return t}const Q=me();function Y(e){const t={mode:"async",compiled:!1,functions:Object.create(null),signatures:[],standardFunction:v,standardFunctionAsync:V,evaluateIdentifier:H};for(let r=0;r<e.length;r++)e[r].registerFunctions(t);for(const[r,n]of Object.entries(t.functions))Q.prototype[r]=Object.freeze({value:new D(n)});for(let r=0;r<t.signatures.length;r++)Ot(t.signatures[r],"async")}function vt(e){console.log(e)}function St(e,t){const r=new Set(Object.keys(t?.vars||{}).map(a=>S(a))),n=new Set(Object.keys(t?.customfunctions||{}).map(a=>S(a))),{globals:i,exports:s}=ot(e);return async a=>{const l=a.spatialReference??ut.WebMercator;let f=null;e.usesModules&&(f=new it(new Map,e.loadedModules));const p=new Q;for(const d of n)a.customfunctions!=null&&d in a.customfunctions?p[d]={value:new D(a.customfunctions[d])}:p[d]=M;for(const d of r){if(a.vars==null||!(d in a.vars)){d in p||(p[d]=M);continue}const L=a.vars[d]??null;Lt(L)?p[d]={value:ct.createFromGraphic(L,a.timeZone??null)}:p[d]={value:L}}for(const d of i)d in p||(p[d]=M);const C={lrucache:a.lrucache,interceptor:a.interceptor,services:a.services,console:a.console??vt,abortSignal:a.abortSignal??J,timeZone:a.timeZone??null,spatialReference:l,track:a.track,depthCounter:{depth:1},libraryResolver:f,exports:s,localScope:null,globalScope:p},O=await $(C,e);if(O instanceof g||O instanceof Z){const d=O.value;if(X(d))return null;if(x(d))throw new o(C,"IllegalResult",null);return d}if(X(O))return null;throw O===y?new o(C,"IllegalResult",null):O===j?new o(C,"IllegalResult",null):new o(C,"NeverReach",null)}}function ge(e,t){return St(e,t)(t)}Y([Kt]),Y([Ut]);export{ge as executeScript,Y as extend,St as prepareScript};
