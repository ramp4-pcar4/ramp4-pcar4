{"version":3,"file":"persistable-vgejqKb5.js","sources":["../../node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport r from\"../../Error.js\";import{createMD5Hash as t}from\"../../MD5.js\";import{isMultiOriginJSONMixin as e}from\"../../multiOriginJSONSupportUtils.js\";import{isAbsolute as o,isBlobProtocol as s,join as n,blobUrlToBlob as i,getPathExtension as p}from\"../../urlUtils.js\";import{generateUUID as c}from\"../../uuid.js\";import{getPropertyMetadata as u}from\"../metadata.js\";import{nameToId as a}from\"../PropertyOrigin.js\";import{propertyJSONMeta as l}from\"./property.js\";import{getResourceContentExtension as m}from\"../../../portal/support/resourceExtension.js\";import{t as d,i as f,r as y,p as g,b as h}from\"../../../chunks/persistableUrlUtils.js\";function j(r){const t=r?.origins??[void 0];return(e,o)=>{const s=v(r,e,o);for(const r of t){const t=l(e,r,o);for(const r in s)t[r]=s[r]}}}function v(r,t,e){if(\"resource\"===r?.type)return U(r,t,e);switch(r?.type??\"other\"){case\"other\":return{read:!0,write:!0};case\"url\":{const{read:r,write:t}=h;return{read:r,write:t}}}}function U(r,t,n){const i=u(t,n);return{type:String,read:(r,t,e)=>{const o=y(r,t,e);return i.type===String?o:\"function\"==typeof i.type?new i.type({url:o}):void 0},write:{isRequired:i.json?.write?.isRequired,writer(t,p,c,u){if(!u?.resources)return\"string\"==typeof t?void(p[c]=d(t,u)):void(p[c]=t.write({},u));const l=S(t),m=d(l,{...u,verifyItemRelativeUrls:u?.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},1),y=i.type!==String&&(!e(this)||u?.origin&&this.originIdOf(n)>a(u.origin)),g={object:this,propertyName:n,value:t,targetUrl:m,dest:p,targetPropertyName:c,context:u,params:r};u?.portalItem&&m&&!o(m)?y&&r?.contentAddressed?w(g):y?I(g):P(g):u?.portalItem&&(null==m||null!=f(m)||s(m)||y)?w(g):p[c]=m}}}}function w(e){const{targetUrl:o,params:p,value:u,context:a,dest:l,targetPropertyName:d}=e;if(!a.portalItem)return;const f=g(o),y=N(u,o,a);if(p?.contentAddressed&&\"json\"!==y.type)return void a.messages?.push(new r(\"persistable:contentAddressingUnsupported\",`Property \"${d}\" is trying to serializing a resource with content of type ${y.type} with content addressing. Content addressing is only supported for json resources.`,{content:y}));const h=p?.contentAddressed&&\"json\"===y.type?t(y.jsonString):f?.filename??c(),j=n(p?.prefix??f?.prefix,h),v=`${j}.${m(y)}`;if(p?.contentAddressed&&a.resources&&\"json\"===y.type){const r=a.resources.toKeep.find(({resource:r})=>r.path===v)??a.resources.toAdd.find(({resource:r})=>r.path===v);if(r)return void(l[d]=r.resource.itemRelativeUrl)}const U=a.portalItem.resourceFromPath(v);s(o)&&a.resources&&a.resources.pendingOperations.push(i(o).then(r=>{U.path=`${j}.${m({type:\"blob\",blob:r})}`,l[d]=U.itemRelativeUrl}).catch(()=>{}));const w=p?.compress??!1;a.resources&&b({...e,resource:U,content:y,compress:w,updates:a.resources.toAdd}),l[d]=U.itemRelativeUrl}function I(r){const{context:t,targetUrl:e,params:o,value:s,dest:n,targetPropertyName:i}=r;if(!t.portalItem)return;const c=t.portalItem.resourceFromPath(e),u=N(s,e,t),a=m(u),l=p(c.path),d=o?.compress??!1;a===l?(t.resources&&b({...r,resource:c,content:u,compress:d,updates:t.resources.toUpdate}),n[i]=e):w(r)}function P({context:r,targetUrl:t,dest:e,targetPropertyName:o}){r.portalItem&&r.resources&&(r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(t),compress:!1}),e[o]=t)}function b({object:r,propertyName:t,updates:e,resource:o,content:s,compress:n}){const i=e=>{x(r,t,e)};e.push({resource:o,content:s,compress:n,finish:i})}function N(r,t,e){return\"string\"==typeof r?{type:\"url\",url:t}:{type:\"json\",jsonString:JSON.stringify(r.toJSON(e))}}function S(r){return null==r?null:\"string\"==typeof r?r:r.url}function x(r,t,e){\"string\"==typeof r[t]?r[t]=e.url:r[t].url=e.url}export{j as persistable};\n"],"names":["j","r","t","e","o","s","v","l","U","h","n","i","u","y","p","c","d","S","m","a","g","w","I","P","f","N","x"],"mappings":"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","x_google_ignoreList":[0]}