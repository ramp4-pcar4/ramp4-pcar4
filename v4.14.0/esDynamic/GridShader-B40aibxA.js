import{d as F}from"./WGLContainer-CV7lovie.js";import{_ as a,ie as f,dh as Ie,al as te,N as G,X as v,Y as W,h6 as Oe,ji as $,az as ee,cl as ut,aw as ie,gO as Ne,cS as qe,mD as oe,aJ as $e,hW as Et,lV as Ze,j7 as Ue,a8 as mt}from"./main-CSjwO60s.js";import{P as j,_ as c,d as g,p as M,b as P,C as l,v as E,q as V,Y as y,Q as se,X as Pt,t as z,G as ht,x as A,y as ne,A as ae,B as re,w as le,D as ue,f as I,m as h,n as dt,i as H,j as S,c as x,U as w,g as _,I as Q,e as ct,E as me,F as Ge,H as We,J as je,r as he,K as He,W as Qe,L as Je,M as Ke,u as Xe,T as Ye,N as zt,O as de,S as ce,R as ti}from"./GraphShaderModule-2-Wwh4Ie.js";import{g as pe,E as p,I as ei,F as ye}from"./utils-CVxMaYM5.js";import{t as ii}from"./CircularArray-DaQg3PQl.js";import{a as oi}from"./testSVGPremultipliedAlpha-CBm-g_aP.js";import{n as si}from"./SymbolFader-Bp4Rc0g4.js";import{o as ni}from"./definitions-DVO21zOC.js";import{r as ge,f as pt,k as yt,i as ai,G as ri,$ as li,j as Lt,p as ui,R as ve}from"./MapView-CrB-5KSL.js";import{f as we}from"./utils-DqlCEhl6.js";import{o as mi}from"./a11yUtils-tU3tY6-a.js";import{o as hi,r as di,g as fe}from"./vec32-CI1xtKog.js";import{n as it}from"./vec2f64-CkowXrDb.js";import{I as ci}from"./constants-CWFGCPkc.js";const pi={vertexShader:F("bitBlit/bitBlit.vert"),fragmentShader:F("bitBlit/bitBlit.frag")},yi={vertexShader:F("stencil/stencil.vert"),fragmentShader:F("stencil/stencil.frag")};class _e extends H{}a([I(0,x)],_e.prototype,"position",void 0);class gi extends Q{}class ot extends S{}a([h(w)],ot.prototype,"layerTexture",void 0),a([h(w)],ot.prototype,"backbufferTexture",void 0),a([h(l)],ot.prototype,"opacity",void 0),a([h(l)],ot.prototype,"inFadeOpacity",void 0);let st=class extends j{constructor(){super(...arguments),this.type="BlendShader"}vertex(e){return{uv:e.position,glPosition:new c(pe(e.position),0,1)}}fragment(e){const t=new E,i=g(this.config.layerTexture,e.uv),s=g(this.config.backbufferTexture,e.uv),o=M(P(i.a,new l(0)),i.rgb,i.rgb.divide(i.a)),n=M(P(s.a,new l(0)),s.rgb,s.rgb.divide(s.a)),r=this.config.opacity.multiply(i.a),u=s.a;switch(this.blendMode){case"destination-over":t.fragColor=new c(o.multiply(r).multiply(p(u)).add(n.multiply(u)),r.add(u).subtract(r.multiply(u)));break;case"source-in":{const m=new c(o.multiply(r).multiply(u),r.multiply(u)),d=new c(n.multiply(u),u).multiply(p(this.config.opacity)).multiply(this.config.inFadeOpacity);t.fragColor=m.add(d)}break;case"destination-in":{const m=new c(n.multiply(u).multiply(r),u.multiply(r)),d=new c(n.multiply(u),u).multiply(new c(p(this.config.opacity).multiply(this.config.inFadeOpacity)));t.fragColor=m.add(d)}break;case"source-out":t.fragColor=new c(o.multiply(r).multiply(p(u)),r.multiply(p(u)));break;case"destination-out":t.fragColor=new c(n.multiply(u).multiply(p(r)),u.multiply(p(r)));break;case"source-atop":t.fragColor=new c(o.multiply(r).multiply(u).add(n.multiply(u.multiply(p(r)))),u);break;case"destination-atop":t.fragColor=new c(o.multiply(r.multiply(p(u))).add(n.multiply(u).multiply(r)),r);break;case"xor":t.fragColor=new c(o.multiply(r.multiply(p(u))).add(n.multiply(u.multiply(p(r)))),r.multiply(p(u)).add(u.multiply(p(r))));break;case"multiply":t.fragColor=new c(o.multiply(r).multiply(n.multiply(u)).add(o.multiply(r).multiply(p(u))).add(n.multiply(u).multiply(p(r))),r.add(u.multiply(p(r))));break;case"screen":t.fragColor=new c(o.add(n).subtract(o.multiply(n)).multiply(r.multiply(u)).add(o.multiply(r).multiply(p(u))).add(n.multiply(u).multiply(p(r))),r.add(u.multiply(p(r))));break;case"overlay":{const m=new y(Rt(n.r,o.r),Rt(n.g,o.g),Rt(n.b,o.b));t.fragColor=T(m,o,n,r,u)}break;case"darken":{const m=z(o,n);t.fragColor=T(m,o,n,r,u)}break;case"lighter":t.fragColor=new c(o.multiply(r).add(n.multiply(u)),r.add(u));break;case"lighten":{const m=Pt(o,n);t.fragColor=T(m,o,n,r,u)}break;case"color-dodge":{const m=V(new y(gt(n.r,o.r),gt(n.g,o.g),gt(n.b,o.b)),new y(0),new y(1));t.fragColor=T(m,o,n,r,u)}break;case"color-burn":{const m=new y(vt(n.r,o.r),vt(n.g,o.g),vt(n.b,o.b));t.fragColor=T(m,o,n,r,u)}break;case"hard-light":{const m=new y(Vt(n.r,o.r),Vt(n.g,o.g),Vt(n.b,o.b));t.fragColor=T(m,o,n,r,u)}break;case"soft-light":{const m=new y(Bt(n.r,o.r),Bt(n.g,o.g),Bt(n.b,o.b));t.fragColor=T(m,o,n,r,u)}break;case"difference":{const m=se(n.subtract(o));t.fragColor=T(m,o,n,r,u)}break;case"exclusion":{const m=o.add(n).subtract(new l(2).multiply(o).multiply(n));t.fragColor=T(m,o,n,r,u)}break;case"invert":t.fragColor=new c(new y(1).subtract(n).multiply(r).multiply(u).add(n.multiply(u).multiply(p(r))),u);break;case"vivid-light":{const m=new y(V(Ft(n.r,o.r),new l(0),new l(1)),V(Ft(n.g,o.g),new l(0),new l(1)),V(Ft(n.b,o.b),new l(0),new l(1)));t.fragColor=T(m,o,n,r,u)}break;case"hue":{const m=Ce(o,n,n);t.fragColor=T(m,o,n,r,u)}break;case"saturation":{const m=Ce(n,o,n);t.fragColor=T(m,o,n,r,u)}break;case"color":{const m=Ot(o,n);t.fragColor=T(m,o,n,r,u)}break;case"luminosity":{const m=Ot(n,o);t.fragColor=T(m,o,n,r,u)}break;case"plus":t.fragColor=V(new c(i.r.add(n.r),i.g.add(n.g),i.b.add(n.b),r.add(u)),new c(0),new c(1));break;case"minus":t.fragColor=new c(V(new y(n.r.subtract(i.r),n.g.subtract(i.g),n.b.subtract(i.b)),new y(0),new y(1)),u.multiply(r));break;case"average":{const m=n.add(o).divide(2);t.fragColor=T(m,o,n,r,u)}break;case"reflect":{const m=V(new y(Nt(n.r,o.r),Nt(n.g,o.g),Nt(n.b,o.b)),new y(0),new y(1));t.fragColor=T(m,o,n,r,u)}break;default:t.fragColor=i.multiply(this.config.opacity)}return t}};function T(e,t,i,s,o){return new c(e.multiply(s).multiply(o).add(t.multiply(s).multiply(p(o))).add(i.multiply(o).multiply(p(s))),s.add(o.multiply(p(s))))}function Rt(e,t){return new l(1).subtract(A(new l(.5),t)).multiply(p(new l(2).multiply(p(t).multiply(p(e))))).add(A(new l(.5),t).multiply(new l(2).multiply(t).multiply(e)))}function gt(e,t){return M(P(e,new l(0)),new l(0),M(P(t,new l(1)),new l(1),z(new l(1),e.divide(new l(1).subtract(t)))))}function vt(e,t){return M(P(e,new l(1)),new l(1),M(P(t,new l(0)),new l(0),p(z(new l(1),p(e).divide(t)))))}function Vt(e,t){return new l(1).subtract(A(new l(.5),t)).multiply(new l(2).multiply(t).multiply(e)).add(A(new l(.5),t).multiply(p(new l(2).multiply(p(t).multiply(p(e))))))}function Bt(e,t){return ne([re(t,new l(.5)),()=>{const i=new l(2).multiply(t),s=p(i),o=p(e);return e.subtract(s.multiply(e).multiply(o))}],[re(e,new l(.25)),()=>{const i=new l(2).multiply(t),s=ye(i).multiply(e),o=new l(16).multiply(e).subtract(new l(12)).multiply(e).add(new l(3));return e.add(s.multiply(o))}],[!0,()=>{const i=new l(2).multiply(t),s=ye(i),o=ae(e).subtract(e);return e.add(s.multiply(o))}])}function Ft(e,t){const i=p(A(new l(.5),t)).multiply(vt(e,new l(2).multiply(t))),s=A(new l(.5),t).multiply(gt(e,new l(2).multiply(ei(t,.5))));return i.add(s)}function At(e){return z(z(e.r,e.g),e.b)}function be(e){return Pt(Pt(e.r,e.g),e.b)}function It(e){return le(e,new y(.3,.59,.11))}function xe(e){return be(e).subtract(At(e))}function vi(e){const t=It(e),i=At(e),s=be(e);return ne([ue(i,new l(0)),()=>{const o=e.subtract(t).multiply(t),n=t.subtract(i);return t.add(o.divide(n))}],[ht(s,new l(1)),()=>{const o=e.subtract(t),n=p(t),r=o.multiply(n),u=s.subtract(t);return t.add(r.divide(u))}],[!0,e])}function Ot(e,t){const i=It(e),s=It(t).subtract(i);return vi(e.add(new y(s)))}function Ce(e,t,i){const s=At(e),o=xe(e),n=xe(t);return Ot(M(ht(o,new l(0)),()=>e.subtract(s).multiply(n).divide(o),new y(0)),i)}function Nt(e,t){return M(P(t,new l(1)),t,()=>{const i=p(t),s=e.multiply(e).divide(i);return z(s,new l(1))})}a([dt],st.prototype,"blendMode",void 0),a([h(ot)],st.prototype,"config",void 0),a([f(0,_(_e))],st.prototype,"vertex",null),a([f(0,_(gi))],st.prototype,"fragment",null);let Te=class extends H{};a([I(0,x)],Te.prototype,"position",void 0);let wi=class extends Q{},qt=class extends S{};a([h(w)],qt.prototype,"layerTexture",void 0),a([h(l)],qt.prototype,"opacity",void 0);let wt=class extends j{constructor(){super(...arguments),this.type="OpacityShader"}vertex(e){return{uv:e.position,glPosition:new c(e.position.subtract(new x(.5)).multiply(2),0,1)}}fragment(e){const t=new E;return t.fragColor=g(this.config.layerTexture,e.uv).multiply(this.config.opacity),t}};a([h(qt)],wt.prototype,"config",void 0),a([f(0,_(Te))],wt.prototype,"vertex",null),a([f(0,_(wi))],wt.prototype,"fragment",null);const fi={vertexShader:F("highlight/textured.vert"),fragmentShader:F("highlight/highlight.frag")},_i={vertexShader:F("highlight/textured.vert"),fragmentShader:F("highlight/blur.frag")};let Me=class extends H{};a([I(0,x)],Me.prototype,"position",void 0);let Z=class extends Q{};class O extends j{constructor(){super(...arguments),this.type="PostProcessingShader"}vertex(t){return{uv:t.position,glPosition:new c(pe(t.position),0,1)}}}a([f(0,_(Me))],O.prototype,"vertex",null);let Se=class extends S{};a([h(w)],Se.prototype,"blitTexture",void 0);let $t=class extends O{fragment(e){const t=new E;return t.fragColor=g(this.blitConfig.blitTexture,e.uv),t}};a([h(Se)],$t.prototype,"blitConfig",void 0),a([f(0,_(Z))],$t.prototype,"fragment",null);class J extends S{}a([h(w)],J.prototype,"luminosityTexture",void 0),a([h(y)],J.prototype,"defaultColor",void 0),a([h(l)],J.prototype,"defaultOpacity",void 0),a([h(l)],J.prototype,"luminosityThreshold",void 0),a([h(l)],J.prototype,"smoothWidth",void 0);let Zt=class extends O{constructor(){super(...arguments),this.type="LuminosityHighPassShader"}fragment(e){const t=new E,i=g(this.luminosityHighPassConfig.luminosityTexture,e.uv),s=new y(.299,.587,.114),o=le(i.xyz,s),n=new c(this.luminosityHighPassConfig.defaultColor.rgb,this.luminosityHighPassConfig.defaultOpacity),r=me(this.luminosityHighPassConfig.luminosityThreshold,this.luminosityHighPassConfig.luminosityThreshold.add(this.luminosityHighPassConfig.smoothWidth),o);return t.fragColor=ct(n,i,r),t}};a([h(J)],Zt.prototype,"luminosityHighPassConfig",void 0),a([f(0,_(Z))],Zt.prototype,"fragment",null);let L=class extends S{};a([h(w)],L.prototype,"blurTexture1",void 0),a([h(w)],L.prototype,"blurTexture2",void 0),a([h(w)],L.prototype,"blurTexture3",void 0),a([h(w)],L.prototype,"blurTexture4",void 0),a([h(w)],L.prototype,"blurTexture5",void 0),a([h(l)],L.prototype,"bloomStrength",void 0),a([h(l)],L.prototype,"bloomRadius",void 0),a([h(Ge.ofType(l,5))],L.prototype,"bloomFactors",void 0),a([h(y)],L.prototype,"bloomTintColor",void 0);let ft=class extends O{constructor(){super(...arguments),this.type="CompositeShader"}fragment(e){const t=new E,{blurTexture1:i,blurTexture2:s,blurTexture3:o,blurTexture4:n,blurTexture5:r,bloomStrength:u,bloomFactors:m,bloomTintColor:d}=this.compositeConfig,C=this._lerpBloomFactor(m[0]).multiply(new c(d,1).multiply(g(i,e.uv))),b=this._lerpBloomFactor(m[1]).multiply(new c(d,1).multiply(g(s,e.uv))),D=this._lerpBloomFactor(m[2]).multiply(new c(d,1).multiply(g(o,e.uv))),B=this._lerpBloomFactor(m[3]).multiply(new c(d,1).multiply(g(n,e.uv))),kt=this._lerpBloomFactor(m[4]).multiply(new c(d,1).multiply(g(r,e.uv))),Dt=u.multiply(C.add(b.add(D.add(B.add(kt)))));return t.fragColor=V(Dt,new l(0),new l(1)),t}_lerpBloomFactor(e){const t=new l(1.2).subtract(e);return ct(e,t,this.compositeConfig.bloomRadius)}};a([dt],ft.prototype,"numMips",void 0),a([h(L)],ft.prototype,"compositeConfig",void 0),a([f(0,_(Z))],ft.prototype,"fragment",null);let nt=class extends S{};a([h(w)],nt.prototype,"texture",void 0),a([h(x)],nt.prototype,"texSize",void 0),a([h(x)],nt.prototype,"direction",void 0),a([h(l)],nt.prototype,"sigma",void 0);let _t=class extends O{constructor(){super(...arguments),this.type="GaussianBlurShader"}fragment(e){const t=new E,i=new l(1).divide(this.gaussianBlurConfig.texSize),s=this.gaussianBlurConfig.sigma;let o=ke(new l(0),s),n=g(this.gaussianBlurConfig.texture,e.uv).multiply(o);for(let r=1;r<this.kernelRadius;r++){const u=new l(r),m=ke(u,s),d=this.gaussianBlurConfig.direction.multiply(i).multiply(u),C=g(this.gaussianBlurConfig.texture,e.uv.add(d)),b=g(this.gaussianBlurConfig.texture,e.uv.subtract(d));n=n.add(C.multiply(m)).add(b.multiply(m)),o=o.add(new l(2).multiply(m))}return t.fragColor=n.divide(o),t}};function ke(e,t){return new l(.39894).multiply(We(new l(-.5).multiply(e).multiply(e).divide(t.multiply(t))).divide(t))}a([dt],_t.prototype,"kernelRadius",void 0),a([h(nt)],_t.prototype,"gaussianBlurConfig",void 0),a([f(0,_(Z))],_t.prototype,"fragment",null);class De extends S{}a([h(w)],De.prototype,"texture",void 0);const bi=1,xi=2.2,Ci=[-.08,-.05,-.03,-.02,-.01,.01,.02,.03,.05,.08];class bt extends O{constructor(){super(...arguments),this.type="RadialBlurShader"}fragment(t){const i=new E;let s=new l(.5).subtract(t.uv);const o=ae(s.x.multiply(s.y).add(s.y.multiply(s.y)));s=s.divide(o);const n=g(this.radialBlurConfig.texture,t.uv);let r=n;for(let d=0;d<10;d++){const C=g(this.radialBlurConfig.texture,t.uv.add(s).multiply(new l(Ci[d]).multiply(bi)));r=r.add(C)}const u=new l(1).divide(new l(11));r=r.multiply(u);let m=o.multiply(xi);return m=V(m,new l(0),new l(1)),i.fragColor=ct(n,r,m),i}}a([dt],bt.prototype,"kernelRadius",void 0),a([h(De)],bt.prototype,"radialBlurConfig",void 0),a([f(0,_(Z))],bt.prototype,"fragment",null);let Ut=class extends S{};a([h(w)],Ut.prototype,"colorTexture",void 0),a([h(je)],Ut.prototype,"coefficients",void 0);let Gt=class extends O{constructor(){super(...arguments),this.type="FilterEffectShader"}fragment(e){const t=new E,i=g(this.filterEffectConfig.colorTexture,e.uv),s=M(ht(i.a,new l(0)),i.rgb.divide(i.a),new y(0)),o=this.filterEffectConfig.coefficients.multiply(new c(s,1)),n=i.a;return t.fragColor=new c(n.multiply(o.rgb),n),t}};a([h(Ut)],Gt.prototype,"filterEffectConfig",void 0),a([f(0,_(Z))],Gt.prototype,"fragment",null);let K=class extends S{};a([h(w)],K.prototype,"layerFBOTexture",void 0),a([h(w)],K.prototype,"blurTexture",void 0),a([h(c)],K.prototype,"shadowColor",void 0),a([h(x)],K.prototype,"shadowOffset",void 0),a([h(he)],K.prototype,"displayViewMat3",void 0);let Wt=class extends O{constructor(){super(...arguments),this.type="CompositeShader"}fragment(e){const t=new E,{layerFBOTexture:i,blurTexture:s,shadowColor:o,shadowOffset:n,displayViewMat3:r}=this.compositeConfig,u=r.multiply(new y(n,new l(0))),m=g(i,e.uv),d=g(s,e.uv.subtract(u.xy.divide(2)));return t.fragColor=d.a.multiply(o).multiply(new l(1).subtract(m.a)).add(m),t}};a([h(K)],Wt.prototype,"compositeConfig",void 0),a([f(0,_(Z))],Wt.prototype,"fragment",null);const k=!!te("esri-2d-profiler");let Ti=class{constructor(e,t){if(this._events=new Ie,this._entries=new Map,this._timings=new ii(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!k)return;this._ext=oi(e.gl,{}),this._debugOutput=t;const i=e.gl;if(!this.enableCommandLogging)return;let s;for(s in i)if(typeof i[s]=="function"){const o=i[s],n=s.includes("draw");i[s]=(...r)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:s,args:r,isDrawCommand:n}),this._currentSummary&&(this._currentSummary.commands++,n&&this._currentSummary.drawCommands++),o.apply(i,r))}}get enableCommandLogging(){return typeof k=="object"&&k.commandLogging}get enableTimeLogging(){return typeof k=="object"&&k.timeLogging}get lastTime(){return this._timings.peekLast()}recordContainerStart(e){k&&(this._currentContainer=e)}recordContainerEnd(){k&&(this._currentContainer=null)}recordPassStart(e){k&&(this._currentPass=e,this._initSummary())}recordPassEnd(){k&&(this._currentPass=null,this._emitSummary())}recordBrushStart(e){k&&(this._currentBrush=e)}recordBrushEnd(){k&&(this._currentBrush=null)}recordStart(e){if(k&&this._ext!=null){if(this._entries.has(e)){const i=this._entries.get(e),s=this._ext.resultAvailable(i.query),o=this._ext.disjoint();if(s&&!o){const n=this._ext.getResult(i.query)/1e6;let r=0;if(this._timings.enqueue(n)!=null&&this.enableTimeLogging){const d=this._timings.entries,C=d.length;let b=0;for(const D of d)b+=D;r=b/C}const u=n.toFixed(2),m=r?r.toFixed(2):"--";this.enableCommandLogging?(this.enableTimeLogging?console.groupCollapsed(`Frame report for ${e}, ${u} ms (${m} last 10 avg)
              ${i.commandsLen} Commands (${i.drawCommands} draw)`):console.groupCollapsed(`Frame report for ${e}
              ${i.commandsLen} Commands (${i.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(i.summaries),console.log("Commands: ",i.commands),console.groupEnd()):this.enableTimeLogging&&console.log(`Frame report for ${e}, ${u} ms (${m} last 10 avg)`),this.enableTimeLogging&&(this._debugOutput.innerHTML=`${u} (${m})`)}for(const n of i.handles)n.remove();this._ext.deleteQuery(i.query),this._entries.delete(e)}const t={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(t.handles.push(this._events.on("command",i=>{t.commandsLen++,t.commands.push(i),i.isDrawCommand&&t.drawCommands++})),t.handles.push(this._events.on("summary",i=>{t.summaries.push(i)}))),this._ext.beginTimeElapsed(t.query),this._entries.set(e,t)}}recordEnd(e){k&&this._ext!=null&&this._entries.has(e)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}},xt=class extends H{};a([I(0,x)],xt.prototype,"position",void 0),a([I(1,x)],xt.prototype,"texcoord",void 0),a([I(2,l)],xt.prototype,"w",void 0);let Mi=class extends Q{};class jt extends S{}a([h(w)],jt.prototype,"texture",void 0),a([h(l)],jt.prototype,"opacity",void 0);let Ct=class extends j{constructor(){super(...arguments),this.type="VideoScreenShader"}vertex(e){const{position:t,texcoord:i,w:s}=e;return{glPosition:new c(t,0,s),texcoord:i}}fragment(e){const t=new E;return t.fragColor=g(this.config.texture,e.texcoord).multiply(this.config.opacity),t}};a([h(jt)],Ct.prototype,"config",void 0),a([f(0,_(xt))],Ct.prototype,"vertex",null),a([f(0,_(Mi))],Ct.prototype,"fragment",null);const Si=7e6;let ki=class{constructor(){this.styles=new Map,this.layerContexts=new Map}get cachedStyles(){return this.styles}setLabelClassStyle(e,t,i){this.layerContexts.set(e,t),this.styles.set(e,i)}removeContainer(e){for(const[t,i]of this.layerContexts.entries())i===e&&this.layerContexts.delete(t)}},X=class extends G{constructor(e){super(e),this._faderWorkingSet=[],this._styleRepository=new ki,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null;const t=(i,s)=>{i.updateLabelVisibility(),i.requestRender(),i.isReady&&(i.decluttered=!0)};this.symbolFader=new si("feature-tile",this._styleRepository,t,this._faderWorkingSet,ni,Si)}get updating(){return te("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:
-> updateRequested: ${this.updateRequested}`),this.updateRequested}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(e){this.doUpdate(e)?this.updateRequested=!1:(this.updateRequested=!0,this.view?.requestUpdate())}setLabelSchemaStyles(e,t){let i;switch(e.type){case"label":i=e.classes;break;case"subtype":i=Array.from(Object.values(e.renderers).flatMap(s=>s.classes));break;case"cluster":i=[...e.cluster.classes,...e.feature.classes];break;case"track":i=[...e.latestObservation.classes,...e.previousObservation.classes,...e.trackLine.classes]}for(const s of i){const o=Di(s);this._styleRepository.setLabelClassStyle(s.labelClassId,t,o)}}removeContainer(e){this._styleRepository.removeContainer(e),this.requestUpdate()}doUpdate(e){this._faderWorkingSet.length=0;const t=this.view;if(!t)return!1;const i=t.allLayerViews.map(s=>s.featureContainer).filter(s=>!!s&&s?.hasLabels);if(i.length>0){for(const n of i)for(const r of n.tiles||[])r.setTransform(e.state),this._faderWorkingSet.push(r);const s=e.state.scale,o=t.featuresTilingScheme.scaleToZoom(s);return this.symbolFader.update(o,e.state)}return!0}};function Di(e){const t=e.geometryType==="esriGeometryPolyline"?0:1,i=e.geometryType==="esriGeometryPolyline"?0:1;return{geometryType:e.geometryType,iconAllowOverlap:!e.deconflictionEnabled,iconIgnorePlacement:!1,textAllowOverlap:!e.deconflictionEnabled,textIgnorePlacement:!1,iconRotationAlignment:t,textRotationAlignment:t,iconTranslateAnchor:i,iconTranslate:[0,0],textTranslateAnchor:i,textTranslate:[0,0]}}a([v()],X.prototype,"updateRequested",void 0),a([v()],X.prototype,"updating",null),a([v()],X.prototype,"view",void 0),X=a([W("esri.views.2d.LabelManager")],X);const Tt="esri-zoom-box",Mt={container:`${Tt}__container`,overlay:`${Tt}__overlay`,background:`${Tt}__overlay-background`,box:`${Tt}__outline`},Ht={zoom:"Shift",counter:"Control"};let at=class extends G{constructor(e){super(e),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(e){this.removeAllHandles(),this._destroyOverlay(),this._set("view",e),e&&this.addHandles([e.on("drag",[Ht.zoom],t=>this._handleDrag(t,1),we.INTERNAL),e.on("drag",[Ht.zoom,Ht.counter],t=>this._handleDrag(t,-1),we.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(e,t,i,s){this._box.x=e,this._box.y=t,this._box.width=i,this._box.height=s,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(e,t,i,s,o){const n=this.view,r=n.toMap(Oe(e+.5*i,t+.5*s));let u=Math.max(i/n.width,s/n.height);o===-1&&(u=1/u),this._destroyOverlay(),this.navigation.end(),n.goTo({center:r,scale:n.scale*u},{animationMode:"always",duration:ge()})}_updateBox(e,t,i,s){const o=this._boxShape;o.setAttributeNS(null,"x",""+e),o.setAttributeNS(null,"y",""+t),o.setAttributeNS(null,"width",""+i),o.setAttributeNS(null,"height",""+s),o.setAttributeNS(null,"class",Mt.box)}_updateBackground(e,t,i,s){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(e,t,i,s,this.view.width,this.view.height))}_createContainer(){const e=document.createElement("div");e.className=Mt.container,this.view.root.appendChild(e),this._container=e}_createOverlay(){const e=this.view.width,t=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+e+" 0 L "+e+" "+t+" L 0 "+t+" Z"),i.setAttributeNS(null,"class",Mt.background);const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),o.setAttributeNS(null,"class",Mt.overlay),o.appendChild(i),o.appendChild(s),this._container.appendChild(o),this._backgroundShape=i,this._boxShape=s,this._overlay=o}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(e,t,i,s,o,n){const r=e+i,u=t+s;return"M 0 0 L "+o+" 0 L "+o+" "+n+" L 0 "+n+" ZM "+e+" "+t+" L "+e+" "+u+" L "+r+" "+u+" L "+r+" "+t+" Z"}_handleDrag(e,t){const i=e.x,s=e.y,o=e.origin.x,n=e.origin.y;let r,u,m,d;switch(i>o?(r=o,m=i-o):(r=i,m=o-i),s>n?(u=n,d=s-n):(u=s,d=n-s),e.action){case"start":this._start();break;case"update":this._update(r,u,m,d);break;case"end":this._end(r,u,m,d,t)}e.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:e,y:t,width:i,height:s}=this._box;this._updateBox(e,t,i,s),this._updateBackground(e,t,i,s),this._rafId=requestAnimationFrame(this._redraw)}};a([v()],at.prototype,"navigation",void 0),a([v()],at.prototype,"view",null),at=a([W("esri.views.2d.navigation.ZoomBox")],at);class N{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return this.lastValue===void 0?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class Qt{constructor(t,i,s){this._initialVelocity=t,this._stopVelocity=i,this._friction=s,this._duration=$(Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction)))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const s=this.value(t);return this.value(t+i)-s}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const s=1-this.friction;return t*(s**i-1)/Math.log(s)}}class Ei extends Qt{constructor(t,i,s,o,n){super(t,i,s),this._sceneVelocity=o,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class Pi{constructor(t=300,i=12,s=.84){this._minimumInitialVelocity=t,this._stopVelocity=i,this._friction=s,this.enabled=!0,this._time=new N(.6),this._screen=[new N(.4),new N(.4)],this._scene=[new N(.6),new N(.6),new N(.6)],this._tmpDirection=ee()}add(t,i,s){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(s)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(s)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,s=t==null||i==null?0:Math.sqrt(t*t+i*i),o=this._time.filteredDelta,n=o==null||s==null?0:s/o;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,i,s){hi(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const o=di(this._tmpDirection);o>0&&fe(this._tmpDirection,this._tmpDirection,1/o);const n=this._time.filteredDelta;return new Ei(t,i,s,n==null?0:o/n,this._tmpDirection)}}let Y=class extends G{constructor(e){super(e),this.animationTime=$(0),this.momentumEstimator=new Pi(500,6,.92),this.momentum=null,this.tmpMomentum=ee(),this.momentumFinished=!1,this.viewpoint=new pt({targetGeometry:new ut,scale:0,rotation:0}),this._previousDrag=null,this.addHandles(ie(()=>this.momentumFinished,()=>this.navigation.stop()))}begin(e,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this._previousDrag=t}update(e,t){this.addToEstimator(t);let i=t.center.x,s=t.center.y;const o=this._previousDrag;i=o?o.center.x-i:-i,s=o?s-o.center.y:s,e.viewpoint=yt(this.viewpoint,e.viewpoint,[i||0,s||0]),this._previousDrag=t}end(e,t){this.addToEstimator(t);const i=e.navigation.momentumEnabled&&!mi();this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=$(0),this.momentum&&this.onAnimationUpdate(e),this._previousDrag=null,this.navigation.end()}addToEstimator(e){const t=e.center.x,i=e.center.y,s=Ne(-t,i),o=qe(-t,i,0);this.momentumEstimator.add(s,o,.001*e.timestamp)}onAnimationUpdate(e){this.navigation.animationManager?.animateContinuous(e.viewpoint,(t,i)=>{const{momentum:s,animationTime:o,tmpMomentum:n}=this,r=this.momentumFinished=!s||s.isFinished(o),u=oe(i);if(!r){const m=s.valueDelta(o,u);fe(n,s.direction,m),yt(t,t,n),e.constraints.constrainByGeometry(t)}this.animationTime=$(this.animationTime+u)})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};a([v()],Y.prototype,"momentumFinished",void 0),a([v()],Y.prototype,"viewpoint",void 0),a([v()],Y.prototype,"navigation",void 0),Y=a([W("esri.views.2d.navigation.actions.Pan")],Y);let Ee=class{constructor(e=2.5,t=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new N(.8),this.time=new N(.3)}add(e,t){if(this.enabled&&t!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=$e(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,t,i){return new Qt(e,t,i)}};class zi extends Ee{constructor(t=3,i=.01,s=.95,o=12){super(t,i,s,o)}add(t,i){const s=this.value.lastValue;if(s!=null){let o=t-s;for(;o>Math.PI;)o-=2*Math.PI;for(;o<-Math.PI;)o+=2*Math.PI;t=s+o}super.add(t,i)}}class Li extends Qt{constructor(t,i,s){super(t,i,s)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const s=super.value(t),o=super.value(t+i)-s;return Math.exp(o)}}class Ri extends Ee{constructor(t=2.5,i=.01,s=.95,o=12){super(t,i,s,o)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,s){return new Li(t,i,s)}}let tt=class extends G{constructor(e){super(e),this._animationTime=$(0),this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new zi(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new Ri,this._zoomOnly=null,this.viewpoint=new pt({targetGeometry:new ut,scale:0,rotation:0}),this.zoomMomentum=null,this.rotateMomentum=null,this.addHandles(ie(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(e,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}update(e,t){this._updateTimestamp===null&&(this._updateTimestamp=t.timestamp);const i=t.angle,s=t.radius,o=t.center,n=Math.abs(180*(i-this._startAngle)/Math.PI),r=Math.abs(s-this._startRadius),u=this._startRadius/s;if(this._previousRadius&&this._previousCenter){const m=s/this._previousRadius;let d=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=d>=0?1:-1,this._zoomDirection=m>=1?1:-1,e.constraints.rotationEnabled?(this._zoomOnly===null&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=r-n>0),this._zoomOnly===null||this._zoomOnly?d=0:this.addToRotateEstimator(i-this._startAngle,t.timestamp)):d=0,this.addToZoomEstimator(t,u),this.navigation.setViewpoint([o.x,o.y],1/m,d,[this._previousCenter.x-o.x,o.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=s,this._previousCenter=o}end(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=$(0),(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}addToRotateEstimator(e,t){this._rotationMomentumEstimator.add(e,.001*t)}addToZoomEstimator(e,t){this._zoomMomentumEstimator.add(t,.001*e.timestamp)}canZoomIn(e){const t=e.scale,i=e.constraints.effectiveMaxScale;return i===0||t>i}canZoomOut(e){const t=e.scale,i=e.constraints.effectiveMinScale;return i===0||t<i}onAnimationUpdate(e){this.navigation.animationManager?.animateContinuous(e.viewpoint,(t,i)=>{const s=!this.canZoomIn(e)&&this._zoomDirection>1||!this.canZoomOut(e)&&this._zoomDirection<1,o=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),n=s||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),r=oe(i);if(this._momentumFinished=o&&n,!this._momentumFinished){const u=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,r))*this._rotationDirection*180/Math.PI:0;let m=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,r)):1;const d=it(),C=it();if(this._previousCenter){Et(d,this._previousCenter.x,this._previousCenter.y),ai(C,e.size,e.padding),Ze(d,d,C);const{constraints:b,scale:D}=e,B=D*m;m<1&&!b.canZoomInTo(B)?(m=D/b.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):m>1&&!b.canZoomOutTo(B)&&(m=D/b.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),ri(t,e.viewpoint,m,u,d,e.size),e.constraints.constrainByGeometry(t)}}this._animationTime=$(this._animationTime+r)})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};a([v()],tt.prototype,"_momentumFinished",void 0),a([v()],tt.prototype,"viewpoint",void 0),a([v()],tt.prototype,"navigation",void 0),tt=a([W("esri.views.2d.navigation.actions.Pinch")],tt);const Jt=it(),Pe=it();let rt=class extends G{constructor(e){super(e),this._previousCenter=it(),this.viewpoint=new pt({targetGeometry:new ut,scale:0,rotation:0})}begin(e,t){this.navigation.begin(),Et(this._previousCenter,t.center.x,t.center.y)}update(e,t){const{state:{size:i,padding:s}}=e;Et(Jt,t.center.x,t.center.y),li(Pe,i,s),e.viewpoint=Lt(this.viewpoint,e.state.paddedViewState.viewpoint,ui(Pe,this._previousCenter,Jt)),Ue(this._previousCenter,Jt)}end(){this.navigation.end()}};a([v()],rt.prototype,"viewpoint",void 0),a([v()],rt.prototype,"navigation",void 0),rt=a([W("esri.views.2d.navigation.actions.Rotate")],rt);const et=10,ze=1,Kt=new pt({targetGeometry:new ut}),Xt=[0,0],Le=250;let R=class extends G{constructor(e){super(e),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new Y({navigation:this}),this.rotate=new rt({navigation:this}),this.pinch=new tt({navigation:this}),this.zoomBox=new at({view:this.view,navigation:this})}destroy(){this.pan=mt(this.pan),this.rotate=mt(this.rotate),this.pinch=mt(this.pinch),this.zoomBox=mt(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(Le)}async zoom(e,t=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return e<1?this.zoomIn(t):this.zoomOut(t);this.setViewpoint(t,e,0,[0,0])}async zoomIn(e){const t=this.view,i=t.constraints.snapToNextScale(t.scale);return this._zoomToScale(i,e)}async zoomOut(e){const t=this.view,i=t.constraints.snapToPreviousScale(t.scale);return this._zoomToScale(i,e)}setViewpoint(e,t,i,s){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,i,s),this.end()}setViewpointImmediate(e,t=0,i=[0,0],s=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,s,e,t,i)}continuousRotateClockwise(){const e=this.view.viewpoint;this.animationManager?.animateContinuous(e,t=>{Lt(t,t,-ze)})}continuousRotateCounterclockwise(){const e=this.view.viewpoint;this.animationManager?.animateContinuous(e,t=>{Lt(t,t,ze)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-et,0])}continuousPanRight(){this._continuousPan([et,0])}continuousPanUp(){this._continuousPan([0,et])}continuousPanDown(){this._continuousPan([0,-et])}continuousPanVector({x:e,y:t}){this._continuousPan([e*et,t*et])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),this._endTimer!==null&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(e){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,i=>{yt(i,i,e),this.view.constraints.constrainByGeometry(i)})}_startTimer(e){return this._endTimer!==null||(this._endTimer=setTimeout(()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<Le?this._endTimer=this._startTimer(t):this._set("interacting",!1)},e)),this._endTimer}_getDefaultAnchor(){const{size:e,padding:{left:t,right:i,top:s,bottom:o}}=this.view;return Xt[0]=.5*(e[0]-i+t),Xt[1]=.5*(e[1]-o+s),Xt}async _zoomToScale(e,t=this._getDefaultAnchor()){const{view:i}=this,{constraints:s,scale:o,viewpoint:n,size:r,padding:u}=i,m=s.canZoomInTo(e),d=s.canZoomOutTo(e);if(!(e<o&&!m||e>o&&!d))return ve(Kt,n,e/o,0,t,r,u),s.constrainByGeometry(Kt),i.goTo(Kt,{animate:!0,animationMode:"always",duration:ge(),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(e,t,i,s,o){const{view:n}=this,{size:r,padding:u,constraints:m,scale:d,viewpoint:C}=n,b=d*i,D=m.canZoomInTo(b),B=m.canZoomOutTo(b);return(i<1&&!D||i>1&&!B)&&(i=1),yt(C,C,o),ve(e,C,i,s,t,r,u),m.constrainByGeometry(e)}};a([v()],R.prototype,"animationManager",void 0),a([v({type:Boolean,readOnly:!0})],R.prototype,"interacting",void 0),a([v()],R.prototype,"pan",void 0),a([v()],R.prototype,"pinch",void 0),a([v()],R.prototype,"rotate",void 0),a([v()],R.prototype,"view",void 0),a([v()],R.prototype,"zoomBox",void 0),R=a([W("esri.views.2d.navigation.MapViewNavigation")],R);const Vi=R;class Re extends H{}a([I(0,x)],Re.prototype,"position",void 0);class Bi extends Q{}class q extends S{}a([h(w)],q.prototype,"readbackTexture",void 0),a([h(w)],q.prototype,"maskTexture",void 0),a([h(w)],q.prototype,"overlayTexture",void 0),a([h(c)],q.prototype,"background",void 0),a([h(c)],q.prototype,"drawPos",void 0),a([h(l)],q.prototype,"maskEnabled",void 0),a([h(l)],q.prototype,"overlayEnabled",void 0);class St extends j{constructor(){super(...arguments),this.type="MagnifierShader"}vertex(t){const i=t.position,s=t.position.subtract(new x(.5)).multiply(this.config.drawPos.zw),o=this.config.drawPos.xy.add(s);return{glPosition:new c(o,0,1),texCoord:i}}fragment(t){let i=g(this.config.readbackTexture,Fi(t.texCoord));i=i.add(new l(1).subtract(i.a)).multiply(this.config.background);const s=M(P(this.config.maskEnabled,new l(1)),g(this.config.maskTexture,t.texCoord).a,new l(1));i=i.multiply(s);const o=M(P(this.config.overlayEnabled,new l(1)),g(this.config.overlayTexture,t.texCoord),new c(0)),n=new E;return n.fragColor=o.add(new l(1).subtract(o.a).multiply(i)),n}}function Fi(e){const t=e.multiply(new x(2)).subtract(1);return M(P(t.x,new l(0)).and(P(t.y,new l(0))),new x(.5),()=>{const i=He(t.y,t.x),s=Qe(Je(t),new l(ci)),o=new x(Ke(i),Xe(i));return s.multiply(o).multiply(new x(.5)).add(new l(.5))})}a([h(q)],St.prototype,"config",void 0),a([f(0,_(Re))],St.prototype,"vertex",null),a([f(0,_(Bi))],St.prototype,"fragment",null);class Ve extends H{}a([I(0,x)],Ve.prototype,"position",void 0);class Ai extends Q{}class Be extends S{}a([h(he)],Be.prototype,"dvs",void 0);class U extends S{}a([h(l)],U.prototype,"halfWidth",void 0),a([h(l)],U.prototype,"aaWidth",void 0),a([h(l)],U.prototype,"pxPerCell",void 0),a([h(c)],U.prototype,"minorLineColor",void 0),a([h(c)],U.prototype,"majorLineColor",void 0),a([h(zt)],U.prototype,"majorLineInterval",void 0);class lt extends j{constructor(){super(...arguments),this.type="GridShader"}vertex(t){const i=t.position.multiply(2).subtract(1);return{gridPos:this.transform.dvs.multiply(new y(i,1)).xy,glPosition:new c(i,0,1)}}fragment(t){const i=se(t.gridPos),s=Ye(i),o=z(s.x,new l(1).subtract(s.x)),n=z(s.y,new l(1).subtract(s.y)),r=new x(o,n).multiply(this.config.pxPerCell).subtract(this.config.halfWidth),u=z(r.x,r.y),m=new l(1).subtract(me(new l(0),this.config.aaWidth,u)),d=new zt(de(i.x)),C=new zt(de(i.y)),b=new l(ce(d,this.config.majorLineInterval)),D=new l(ce(C,this.config.majorLineInterval)),B=M(ue(r.x,r.y),b,D),kt=ht(ti(A(r.x,this.config.aaWidth),A(r.y,this.config.aaWidth)),new l(.5)),Dt=z(b,D),Fe=M(kt,Dt,B),Ae=ct(this.config.majorLineColor,this.config.minorLineColor,z(Fe,new l(1))),Yt=new E;return Yt.fragColor=Ae.multiply(m),Yt}}a([h(Be)],lt.prototype,"transform",void 0),a([h(U)],lt.prototype,"config",void 0),a([f(0,_(Ve))],lt.prototype,"vertex",null),a([f(0,_(Ai))],lt.prototype,"fragment",null);export{ft as C,st as E,St as P,bt as R,yi as a,_t as b,Wt as c,Ti as d,fi as e,$t as f,Ct as g,_i as h,Vi as i,X as l,lt as q,pi as r,wt as v,Zt as x,Gt as y};
