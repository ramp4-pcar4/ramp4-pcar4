import{N as ne,_ as c,X as h,Y as P,jW as to,mZ as no,jX as io,cS as $e,Z as En,bA as Je,O as ve,i as Gn,ff as oo,av as ce,fd as Se,ct as so,nV as ro,jS as ao,lV as lo,eb as H,nW as On,kx as $,kv as Te,kw as _e,lW as po,az as v,c2 as co,aB as Ae,aI as ie,mu as ho,ky as uo,hW as Mn,bJ as xn,gN as Cn,d3 as yo,cW as go,hs as fo,nX as kn,ku as mo,h6 as vo,gO as _o,aE as An,T as Xe,aG as bo,eE as Mt,ay as wo,a9 as xt,eL as So,gw as To,d0 as Eo,gr as Go,hq as Oo,nY as Mo,lI as Pn,fx as xo,ax as Ct,h3 as Co,d7 as Rn,d9 as ko,d5 as Ao,nZ as Po,n_ as Ro,hT as Ho,a8 as Ye,aw as Do,V as kt,d as Hn,n$ as Lo,hS as Io,o0 as J,ee as Dn,s as Uo,j1 as Ln,cu as No,eM as In,h7 as Pe}from"./main-CSjwO60s.js";import{h as jo}from"./UpdatingHandles-XotKWqvb.js";import{W as At,N as qo,J as Vo,G as zo,L as Fo}from"./projectionUtils-CsX1UTBu.js";import Zo from"./GraphicsLayer-DPoztXf7.js";import{e as Wo}from"./editableLayers-BTZOOiKD.js";import{g as Un,f as x,r as Bo,c as Ko,n as Nn,a as O}from"./utils-DqlCEhl6.js";import{d as $o}from"./asyncUtils-Cu__bxqs.js";import{E as Jo,b as jn,I as Xo,U as Ee}from"./elevationInfoUtils-DFX5QvG8.js";import{i as qn,t as Re,n as Qe}from"./projectVectorToVector-OCoJKalB.js";import{v as Pt,R as U,P as L,q as k,o as X,_ as et,Z as Rt,c as tt,s as Ht,p as He,H as G,J as Yo,j as Vn,A as Qo,u as es,I as ts}from"./vec32-CI1xtKog.js";import{b as ns}from"./Query-DKLDaFaA.js";import{n as F,r as nt,l as is}from"./vec2f64-CkowXrDb.js";import{s as os,j as ss}from"./vec42-DHp-FUwt.js";import{n as rs}from"./vec4f64-DD-nkcCV.js";import{i as as}from"./projectBuffer-CMNsPBq1.js";import{j as Dt,q as Lt,b as It,y as zn,R as ls,v as ps}from"./geodesicUtils-DHDMXkUY.js";import{U as it,j as N,W as Ut,a as Fn,J as Zn,O as cs,w as Wn,X as hs,R as Bn,k as Nt,d as ds,T as us}from"./plane-wUwHaY3K.js";import{X as ys,q as gs,T as fs,c as ms}from"./sphere-CIGsF4vz.js";import{a as he,l as jt}from"./quantityUtils-v7kjLywD.js";import{m as vs,l as Kn}from"./geodeticLengthOperator-CMi-Z1ZN.js";import{e as _s}from"./earcut-C6NeZYSh.js";import{v as bs}from"./triangle-DA_o7I-u.js";import{c as ws,a as Ss}from"./spatialReferenceEllipsoidUtils-Ty3j4VoE.js";let Ge=class extends ne{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],Ge.prototype,"length",void 0),c([h()],Ge.prototype,"verticalLength",void 0),c([h()],Ge.prototype,"area",void 0),Ge=c([P("esri.views.interactive.sketch.Units")],Ge);const ot=Ge;let de=class extends ne{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?"relative-bilateral":"relative";case"absolute":return"absolute"}}get displayUnits(){return this._get("displayUnits")??new ot}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new ot}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],de.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],de.prototype,"relativeDirectionIsBilateral",void 0),c([h()],de.prototype,"effectiveDirectionMode",null),c([h({type:ot,nonNullable:!0})],de.prototype,"displayUnits",null),c([h({type:ot,nonNullable:!0})],de.prototype,"inputUnits",null),de=c([P("esri.views.interactive.sketch.SketchValueOptions")],de);const st=de;function $n(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the symbol type is not supported"}return""}function Jn(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return 1;const t=e.operations?.data.type;if(!t)return 3;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}return 0}function Ts(e){return Es(e).result}function Es(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:1};if(!e.operations)return{result:2};const t=e.operations.data.type,n=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:0,geometry:n}:{result:3}}function Gs(e){if(e.layer?.type!=="graphics")return 1;if(e.geometry==null)return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return t&&t.some(n=>n.type==="object")?0:4}function qt(e,t,n){if(!t||!e?.map)return;const{map:i}=e;i.layers.find(o=>o===t)||i.add(t,n)}function Os(e,t){const n=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(i=>{const o=i.layer;return o===n||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(n)})}function Ms(e){return Wo(e)||to(e)||no(e)||io(e)}let rt=class extends ne{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],rt.prototype,"enabled",void 0),rt=c([P("esri.views.interactive.sketch.SketchLabelOptions")],rt);const at=rt;let De=class extends ne{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],De.prototype,"mode",void 0),De=c([P("esri.views.interactive.sketch.SketchTooltipElevationOptions")],De);let R=class extends ne{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],R.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],R.prototype,"totalLength",void 0),R=c([P("esri.views.interactive.sketch.SketchTooltipVisibleElements")],R);const Xn=R;let D=class extends ne{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new De,this.placement="auto",this.offset=null,this.visibleElements=new Xn,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],D.prototype,"enabled",void 0),c([h()],D.prototype,"forceEnabled",void 0),c([h()],D.prototype,"effectiveEnabled",null),c([h()],D.prototype,"helpMessage",void 0),c([h()],D.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],D.prototype,"inputEnabled",void 0),c([h({type:De,nonNullable:!0})],D.prototype,"elevation",void 0),c([h()],D.prototype,"placement",void 0),c([h()],D.prototype,"offset",void 0),c([h({type:Xn,nonNullable:!0})],D.prototype,"visibleElements",void 0),c([h()],D.prototype,"visualVariables",void 0),c([h()],D.prototype,"xyMode",void 0),D=c([P("esri.views.interactive.sketch.SketchTooltipOptions")],D);const Vt=D;let Oe=class extends ne{constructor(e){super(e),this.labels=new at,this.tooltips=new Vt,this.values=new st}};c([h({nonNullable:!0,type:at})],Oe.prototype,"labels",void 0),c([h({nonNullable:!0,type:Vt})],Oe.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:st})],Oe.prototype,"values",void 0),Oe=c([P("esri.views.interactive.sketch.SketchOptions")],Oe);const zt=Oe;function Ft(e,t,n){return I(e,t,n)}function I(e=0,t=0,n=0){return $e(e,t,n)}function xs(e){return e}function Cs(e){return e}function oe(e,t,n){return $e(e,t,n)}function Me(e){const[t,n,i]=e;return e.length>3?[t,n,i,e[3]]:[t,n,i]}function lt(e){return e[3]=1|((e.length>3?e[3]:void 0)??0),e}function ks(e){return!!(1&((e.length>3?e[3]:void 0)??0))}function Zt(e,t,{coordinateHelper:n,elevationInfo:i},o){return e?xe(n.vectorToDehydratedPoint(e,Rs),t,i,o):null}function xe(e,t,n,i=I()){return i[0]=e.x,i[1]=e.y,i[2]=e.z??0,t==null||(t.type==="2d"?i[2]=0:i[2]=Jo(t,e,n,Ee)??0),i}function As(e,t,n){return n?(qn(n,e[0],e[1],e[2],t),n):Re(e[0],e[1],e[2],t)}function Wt(e,t,{z:n,m:i},o,s){const{spatialReference:l,elevationInfo:p}=o;let r;n==null&&i==null?r=void 0:t==null||t.type==="2d"?r=n??void 0:r=jn(t,e,l,Ee,p)??0;const[a,d]=e;return s?qn(s,a,d,r,l):s=Re(a,d,r,l),i!=null&&(s.m=i,s.hasM=!0),s}function Ps(e,t,n,i,o=I()){const[s,l]=e;return o[0]=s,o[1]=l,e.length>3&&(o[3]=e[3]??0),n?.type!=="3d"?(o[2]=t.value,o):(o[2]=Xo(n,s,l,t.value,i,t.elevationInfo,Ee)??0,o)}const Rs=Re(0,0,0,null);let Z=class extends En{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],Z.prototype,"enabled",void 0),Z=c([P("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Z);let S=class extends En{constructor(e){super(e),this.lineSnapper=new Z,this.parallelLineSnapper=new Z,this.rightAngleSnapper=new Z,this.rightAngleTriangleSnapper=new Z,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Je([255,127,0]),this.orangeTransparent=new Je([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),c([h({type:Z,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),c([h({type:Je,nonNullable:!0})],S.prototype,"orange",void 0),c([h({type:Je,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=c([P("esri.views.interactive.snapping.Settings.Defaults")],S);const Le=new S;let Y=class extends ne{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new ve}};c([h({constructOnly:!0})],Y.prototype,"layer",void 0),c([h()],Y.prototype,"enabled",void 0),c([h()],Y.prototype,"updating",void 0),c([h()],Y.prototype,"availability",void 0),c([h()],Y.prototype,"sublayerSources",void 0),Y=c([P("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Y);let M=class extends ne{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new ve,this.distance=Le.distance,this.touchSensitivityMultiplier=Le.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(Yn)&&Gn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Ds),n=this._get("_effectiveFeatureSources")?.filter(Yn)??new ve;for(const p of t){const r=n.find(a=>a.layer===p.layer.parent);if(r)r.sublayerSources.includes(p)||r.sublayerSources.add(p);else if(p.layer.parent){const a=new Y({layer:p.layer.parent});a.sublayerSources.add(p),n.add(a)}}for(const p of n){const r=p.sublayerSources.filter(a=>!t.includes(a));p.sublayerSources.removeMany(r)}n.removeMany(n.filter(p=>p.sublayerSources.length===0));const i=e.filter(Hs),o=this._get("_effectiveFeatureSources")??new ve,{added:s,removed:l}=oo(o.toArray(),[...i,...n]);return o.removeMany(l),o.addMany(s),o}};function Yn(e){return e.layer.type==="subtype-group"}function Hs(e){return e.layer.type!=="subtype-group"}function Ds(e){return e.layer.type==="subtype-sublayer"}c([h()],M.prototype,"enabled",void 0),c([h()],M.prototype,"enabledToggled",void 0),c([h()],M.prototype,"forceDisabled",void 0),c([h()],M.prototype,"selfEnabled",void 0),c([h()],M.prototype,"featureEnabled",void 0),c([h()],M.prototype,"gridEnabled",void 0),c([h()],M.prototype,"attributeRulesEnabled",void 0),c([h({type:ve.ofType(Y)})],M.prototype,"featureSources",void 0),c([h()],M.prototype,"distance",void 0),c([h()],M.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],M.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],M.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],M.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],M.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],M.prototype,"_effectiveFeatureSources",null),M=c([P("esri.views.interactive.snapping.SnappingOptions")],M);const Ls=Symbol("grid-placement-graphic");function Bt(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function Is(e,t){return Math.sqrt(Bt(e,t))}function Qn(e,t){t.sort((n,i)=>Pt(n.targetPoint,e)-Pt(i.targetPoint,e))}function Us({parameters:{point:e,distance:t,returnEdge:n,vertexMode:i,coordinateHelper:{spatialReference:o},filter:s},mode:l,returnZ:p,filter:r}){const a=r?.clone()??new ns({where:"1=1"});return a.returnZ=p??l==="3d",s&&(a.geometry=s.geometry,a.distance=s.distance,a.spatialRelationship=s.spatialRelationship,a.where=so(a.where,s.where),a.timeExtent=ro(a.timeExtent,s.timeExtent),a.objectIds=Ns(a.objectIds,s.objectIds)),{point:Re(e[0],e[1],e[2],o.toJSON()),mode:l,distance:t,returnEdge:n,vertexMode:i,query:a.toJSON()}}function Ns(e,t){return e||t?t?e?Array.from(ao(new Set(e),new Set(t))):t:e:null}function js(e,t,n){return{left:Zt(e.leftVertex.pos,t,n),right:Zt(e.rightVertex.pos,t,n)}}const ei=Symbol("snapping-toggle");function ti(e,t=()=>{}){const n=ce(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:i,snappingOptions:o})=>{if(e.removeHandles(ei),!i||!o)return;const s=x.TOOL,l=[i.on("key-down",p=>{p.key!==Un.toggle||p.repeat||(o.enabledToggled=!0,t())},s),i.on("key-up",p=>{p.key===Un.toggle&&(o.enabledToggled=!1,t())},s),i.on("pointer-move",p=>{const r=p.native.ctrlKey;o.enabledToggled!==r&&(o.enabledToggled=r,t())},s)];e.addHandles(l,ei)},Se);e.addHandles(n)}function qs(e){return Bo(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}function Vs(e){return e?.type==="line"}function Kt(e,t){return e[0]*t[1]-e[1]*t[0]}function zs(e,t,n){const i=Te(n,t)/_e(n);return po(e,n,i)}function Fs(e,t,n,i,o=n){return H(be,i,n),H(pt,t,o),zs(Ce,pt,be),lo(e,o,Ce)}function Zs(e,t,n,i){H(be,t,n);const o=i/On(be);return $(e,n,be,o)}function Ws(e,t){const n=e.start,i=e.end,o=t.start,s=t.end,l=H(be,i,n),p=H(ni,s,o),r=Kt(l,p);if(Math.abs(r)<=Ks)return[];const a=H(pt,n,o),d=Kt(p,a)/r;return Kt(l,a)/r,d>=0?[$(Ce,n,l,d)]:[$(Ce,n,l,d)]}function Bs(e,t,n){const i=[],o=H(be,e.end,e.start),s=H(ni,e.start,t),l=_e(o),p=2*Te(o,s),r=p*p-4*l*(_e(s)-n*n);if(r===0){const a=-p/(2*l);i.push($(Ce,e.start,o,a))}else if(r>0){const a=Math.sqrt(r),d=(-p+a)/(2*l);i.push($(Ce,e.start,o,d));const u=(-p-a)/(2*l);i.push($(pt,e.start,o,u))}return i}const Ks=1e-6,be=F(),ni=F(),pt=F(),Ce=F();function $t({start:e,end:t,type:n},i,o){const s=[],l=H(Ie,t,e),p=H(ht,e,i),r=_e(l),a=2*Te(l,p),d=a*a-4*r*(_e(p)-o*o);if(d===0){const u=-a/(2*r);(n===0||u>=0)&&s.push($(F(),e,l,u))}else if(d>0){const u=Math.sqrt(d),m=(-a+u)/(2*r);(n===0||m>=0)&&s.push($(F(),e,l,m));const y=(-a-u)/(2*r);(n===0||y>=0)&&s.push($(F(),e,l,y))}return s}function ii(e,t){const n=e.start,i=e.end,o=H(Ie,i,n),s=X(ut,-o[1],o[0],0),l=t.start,p=t.end,r=U(Yt,p,l),a=L(r,s),d=X(ci,n[0],n[1],0),u=U(hi,d,l),m=L(u,s),y=Ae();if(Math.abs(a)<y)return[];const g=k(di,l,r,m/a);if(t.type===0){const f=U(Qt,g,l);if(L(f,r)<-y)return[]}if(e.type===1){const f=ho(ht,g,n);if(Te(f,o)<-y)return[]}return[ie(g)]}function $s(e,t){return Xs(ct(en,t[2],e),t)}function oi(e,t){return li(ct(en,0,e),ct(tr,0,t)).map(([n,i])=>nt(n,i))}function si(e,t,n){return Jt(e,ct(en,e[2],t),n)}function ri(e,t,n,i=v()){const o=H(Ie,e,t),s=On(o);return $(i,t,o,s===0?1:n/s),i[2]=e[2],i}function Jt(e,{start:t,end:n,type:i},o=v()){const s=U(dt,e,t),l=U(ut,n,t),p=L(s,l)/L(l,l);return k(o,t,l,i===0?Math.max(p,0):p)}const Js=(()=>{const e=v(),t=v(),n=v();return({start:i,end:o},{center:s,radius:l,normal:p,slicePlane:r})=>{const a=it(s,p,er);if(w(Ut(a,i),0)&&w(Ut(a,o),0)){Fn(p,e,t);const u=(g,f)=>(tt(n,f,s),Mn(g,L(n,e),L(n,t)),g),m=Bs({start:u(Ie,i),end:u(ht,o)},is,l),y=[];for(const[g,f]of m){const _=Ht(v(),s);k(_,_,e,g),k(_,_,t,f),r&&!ue(r,_)||y.push(_)}return y}const d=v();return Zn(a,i,o,d)?!w(He(d,s),l)||r&&!ue(r,d)?[]:[d]:[]}})();function ai({start:e,end:t,type:n},i,o){const s=[],l=tt(dt,t,e),p=H(ht,e,i),r=_e(l),a=2*Te(l,p),d=a*a-4*r*(_e(p)-o*o);if(d===0){const u=-a/(2*r);(n===1||u>=0)&&s.push(k(v(),e,l,u))}else if(d>0){const u=Math.sqrt(d),m=(-a+u)/(2*r);(n===1||m>=0)&&s.push(k(v(),e,l,m));const y=(-a-u)/(2*r);(n===1||y>=0)&&s.push(k(v(),e,l,y))}return s}function li(e,t){const n=e.start,i=e.end,o=t.start,s=t.end,l=U(dt,i,n),p=U(ut,s,o),r=U(Yt,o,n),a=et(ci,l,p);if(!w(L(r,a),0))return[];const d=Rt(a);if(w(d,0))return[];const u=et(hi,r,p),m=L(u,a)/d,y=k(di,n,l,m);if(e.type===0){const g=U(Qt,y,n);if(L(l,g)<-Ae())return[]}if(t.type===0){const g=U(Qt,y,o);if(L(p,g)<-Ae())return[]}return[ie(y)]}function Xs({start:e,end:t,type:n},i){const o=U(dt,i,e),s=U(ut,t,e),l=et(Yt,s,o),p=Rt(l)/Rt(s),r=Ae();if(p<r)switch(n){case 1:return[ie(i)];case 0:return L(s,o)<-r?[]:[ie(i)]}return[]}function Xt(e,t,n,i){const[o,s]=e,[l,p]=n,r=l-o,a=p-s,d=r*r+a*a,u=Math.sqrt(d);if(u>t+i)return[];if(u<Math.abs(t-i))return[];if(w(u,0)&&w(t,i))return[];const m=(t*t-i*i+d)/(2*u),y=Math.sqrt(t*t-m*m),g=y*a/u,f=y*r/u,[_,E]=uo(Ie,e,n,m/u);return w(g,f)?[nt(_,E)]:[nt(_+g,E-f),nt(_-g,E+f)]}function ct(e,t,{start:n,end:i,type:o}){return X(e.start,n[0],n[1],t),X(e.end,i[0],i[1],t),e.type=Qs[o],e}function pi(e,t){return w(e[2],t[2])}function w(e,t){return co(Math.abs(e-t),0,Ae())}function Ys(e,t){return t.filter(n=>ue(e,n))}function ue(e,t){return cs(e,t)}const Qs={0:1,1:0},Ie=F(),ht=F(),dt=v(),ut=v(),Yt=v(),ci=v(),hi=v(),di=v(),Qt=v(),er=N(),en={start:v(),end:v(),type:1},tr={start:v(),end:v(),type:1};class j{intersect(t){return se(this,t)}closestPoints(t){return[this.closestTo(t)]}}class we extends j{constructor(t){super(),this.point=t}equals(t){return this===t||q(t)&&G(this.point,t.point)}closestTo(){return Me(this.point)}}class tn extends j{constructor(t,n,i){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:i}}equals(t){return this===t||Q(t)&&this.lineLike.type===t.lineLike.type&&G(this.start,t.start)&&G(this.end,t.end)}closestTo(t){const n=I();return Jt(t,this.lineLike,n),n}}class nn extends tn{constructor(t,n){super(t,n,1)}}class nr extends tn{constructor(t,n){super(t,n,0)}}class ui extends j{constructor(t){super(),this.constraints=t}equals(t){return this===t||hn(t)&&go(this.constraints,t.constraints,(n,i)=>n.equals(i))}closestTo(t){let n,i=1/0;for(const o of this.constraints){const s=o.closestTo(t),l=Pt(t,s);l<i&&(i=l,n=s)}return Me(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class on extends j{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||te(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=I();return ri(t,this.center,this.radius,n),n}}class sn extends j{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||ae(t)&&G(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=I();return ri(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new rn(Me(this.center),this.radius,oe(0,0,1))}}class rn extends j{constructor(t,n,i,o=void 0){super(),this.center=t,this.radius=n,this.normal=i,this.slicePlane=o}equals(t){return this===t||ye(t)&&G(this.center,t.center)&&G(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:i}=this;Bn(this.getPlane(ir),t,an);const o=U(an,an,n),s=Vn(o);if(w(s,0))return Me(t);const l=i/Math.sqrt(s),p=I();k(p,n,o,l);const{slicePlane:r}=this;return r&&!ue(r,p)?pn(r,this)?.closestTo(t)??Me(t):p}getPlane(t=N()){return it(this.center,this.normal,t)}}const an=v(),ir=N();class yi extends j{constructor(t){super(),this.z=t}equals(t){return this===t||re(t)&&this.z===t.z}closestTo(t){return oe(t[0],t[1],this.z)}getPlane(t=N()){return X(gi,0,0,this.z),it(gi,yo,t)}}const gi=v();class ln extends j{constructor(t,n,i){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:i}}equals(t){return this===t||ee(t)&&this.planeLike.type===t.planeLike.type&&G(this.start,t.start)&&G(this.end,t.end)}closestTo(t){const n=I();return si(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:i}=this.planeLike;return Math.sign(Te(H(or,i,n),H(sr,t,n)))>0?this.end:this.start}getPlane(t=N()){const n=Ht(fi,this.end);return n[2]+=1,Wn(this.start,this.end,n,t)}getSlicePlane(t=N()){const{start:n,end:i,type:o}=this.planeLike;if(o===0)return;const s=X(fi,n[0],n[1],0),l=X(mi,i[0],i[1],0),p=tt(mi,l,s);return it(s,p,t),t}}const or=F(),sr=F(),fi=v(),mi=v();class rr extends ln{constructor(t,n){super(t,n,1)}}class vi extends ln{constructor(t,n){super(t,n,0)}}class ar extends j{constructor(t,n){super(),this.sphere=gs(t,n),this._center=ie(t)}equals(t){return this===t||le(t)&&fs(this.sphere,t.sphere)}closestTo(t){const n=I();return ms(this.sphere,t,n),n}get center(){return this._center}get radius(){return this.sphere[3]}}class _i extends j{constructor(t,n,i){super(),this.start=t,this.end=n,this.getZ=i,this.planeLike={start:t,end:n,type:0}}equals(t){return this===t||gt(t)&&G(this.start,t.start)&&G(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return hr(this,t)}addIfOnTheGround(t,n){for(const i of n){const o=this.getZ(i[0],i[1])??0;w(i[2],o)&&(i[2]=o,t.push(i))}}}class bi extends j{constructor(t,n,i){super(),this._x=t,this._y=n,this._z=i}equals(t){return this===t||Mr(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,i]){return Ft(this._x??t,this._y??n,this._z??i)}}class wi extends j{constructor(t,n,i,o,s){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=i,this._z=o,this._directionDegrees=s}equals(t){return this===t||Or(t)&&kn(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,i]){return Mn(Ue,t,n),kn(Ue,this._origin)||this._applyDirectionAndDistance(Ue),Ft(Ue[0],Ue[1],this._z??i)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)Dt(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)pr(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=Lt(lr,this._origin,t,this._spatialReference);Dt(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const Ue=[0,0],lr=new It;function pr(e,t,n,i,o){let{azimuth:s,distance:l}=Lt(cr,t,i,o);s??=0;let p=l*Math.cos((s-n)*as);p=Math.max(0,p),Dt(e,t,n,p,o)}const cr=new It;function hr(e,t){const n=I();return si(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??Ei,n}function se(e,t){if(hn(e)){const n=[];for(const i of e.constraints){const o=i.intersect(t);o&&n.push(o)}return yt(n)}if(hn(t))return se(t,e);if(gt(e))return Si(e,t);if(gt(t))return Si(t,e);if(q(e)){const{point:n}=e;if(q(t))return G(n,t.point)?e:void 0;const i=t.closestTo(n);return Yo(i,n)?e:void 0}if(Q(e)){if(q(t))return se(t,e);if(Q(t))return W(li(e.lineLike,t.lineLike));if(re(t))return dr(e,t);if(ee(t))return W(ii(t.planeLike,e.lineLike));if(te(t))return W(ai(e.lineLike,t.center,t.radius));if(ye(t))return W(Js(e.lineLike,t));if(ae(t))return ur(e,t);if(le(t))return yr(e,t)}else if(re(e)){if(q(t)||Q(t))return se(t,e);if(re(t))return gr(e,t);if(ee(t))return fr(e,t);if(te(t))return mr(e,t);if(ye(t))return _r(e,t);if(ae(t))return vr(e,t);if(le(t))return br(e,t)}else if(ee(e)){if(q(t)||Q(t)||re(t))return se(t,e);if(ee(t))return cn(oi(e.planeLike,t.planeLike));if(te(t))return cn($t(e.planeLike,t.center,t.radius));if(ye(t))return Sr(e,t);if(ae(t))return wr(e,t);if(le(t))return Tr(e,t)}else if(te(e)){if(q(t)||Q(t)||re(t)||ee(t))return se(t,e);if(te(t))return cn(Xt(e.center,e.radius,t.center,t.radius));if(ye(t))return;if(ae(t))return Er(e,t);if(le(t))return}else if(ye(e)){if(q(t)||Q(t)||re(t)||ee(t)||te(t))return se(t,e);if(ye(t))return;if(ae(t))return t.asCircle(),void 0;if(le(t))return}else if(ae(e)){if(q(t)||Q(t)||re(t)||ee(t)||te(t)||ye(t))return se(t,e);if(ae(t))return Gr(t,e);if(le(t))return}else if(le(e)){if(q(t)||Q(t)||re(t)||ee(t)||te(t)||ae(t))return se(t,e);if(le(t))return}}const dr=(()=>{const e=N();return(t,n)=>{const{start:i,end:o}=t;if(pi(i,o)&&w(i[2],n.z))return t;const s=I();return Zn(n.getPlane(e),i,o,s)?new we(s):void 0}})();function ur({lineLike:e},{center:t,radius:n}){const i=t[2];return W(ai(e,t,n).filter(o=>w(o[2],i)))}function yr({lineLike:e},{sphere:t}){return W(ys(t,e.start,e.end))}const pn=(()=>{const e=rs(),t=v(),n=v();return(i,o,s)=>{const{normal:l,center:p,radius:r}=o;Fn(l,t,n);const a=Nt(i),d=r*L(a,t),u=r*L(a,n);os(e,p[0],p[1],p[2],1);const m=ss(i,e),y=Math.hypot(d,u),g=w(y,0);if(w(Ut(i,p),0)){if(g)return o;if(w(r,0))return!s||ue(s,p)?new we(Me(p)):void 0;et(t,a,l),Qo(t,t);const Ot=new Array,Be=ie(p);k(Be,Be,t,r),s&&!ue(s,Be)||Ot.push(Be);const Ke=ie(p);return k(Ke,Ke,t,-r),s&&!ue(s,Ke)||Ot.push(Ke),W(Ot)}if(g)return;const f=-m/y;if(Math.abs(f)>1||w(f,1))return;const _=Math.atan(d/u),E=fo(f)-_,T=Math.PI-E,me=new Array,Ze=v();k(Ze,p,t,r*Math.cos(E)),k(Ze,Ze,n,r*Math.sin(E)),me.push(Ze);const We=v();return k(We,p,t,r*Math.cos(T)),k(We,We,n,r*Math.sin(T)),me.push(We),W(s?Ys(s,me):me)}})();function gr(e,t){return w(e.z,t.z)?e:void 0}function fr({z:e},{planeLike:t}){const[n,i]=t.start,[o,s]=t.end,l=oe(n,i,e),p=oe(o,s,e);return t.type===0?new nn(l,p):new nr(l,p)}function mr(e,t){const[n,i]=t.center;return new sn(oe(n,i,e.z),t.radius)}function vr(e,t){return w(t.center[2],e.z)?t:void 0}const _r=(()=>{const e=N();return(t,n)=>pn(t.getPlane(e),n,n.slicePlane)})();function br(e,{center:t,radius:n}){const i=Math.abs(t[2]-e.z);if(i>n&&!w(i,n))return;const o=oe(t[0],t[1],e.z),s=Math.sqrt(n**2-i**2);return w(s,0)?void 0:new sn(o,s)}const wr=(()=>{const e=N();return(t,{center:n,radius:i})=>{const o=$t(t.planeLike,n,i),s=n[2];t.getSlicePlane(e);const l=new Array;for(const[p,r]of o){const a=[p,r,s];ue(e,a)&&l.push(a)}return W(l)}})(),Sr=(()=>{const e=N(),t=N();return(n,i)=>pn(n.getPlane(e),i,n.getSlicePlane(t))})(),Tr=(()=>{const e=N();return(t,{center:n,radius:i})=>{const o=t.getPlane(e),s=hs(o,n),l=Math.abs(s);if(l>i&&!w(l,i))return;const p=Math.sqrt(i**2-s**2);if(w(p,0)){const d=I();return Bn(o,n,d),new we(d)}const r=I(),a=ie(Nt(o));return k(r,n,a,s),new rn(r,p,a,t.getSlicePlane())}})();function Er(e,t){const n=Cn(e.center,t.center);return w(n,0)&&w(e.radius,t.radius)?t:Ti(Xt(e.center,e.radius,t.center,t.radius),t.center[2])}function Gr(e,t){if(!pi(e.center,t.center))return;const n=Cn(e.center,t.center);return w(n,0)&&w(e.radius,t.radius)?e:Ti(Xt(e.center,e.radius,t.center,t.radius),e.center[2])}function Si(e,t){const{planeLike:n,getZ:i}=e,o=new Array;if(q(t))e.addIfOnTheGround(o,$s(n,t.point));else if(Q(t))e.addIfOnTheGround(o,ii(n,t.lineLike));else if(te(t))for(const[s,l]of $t(n,t.center,t.radius)){const p=i(s,l);p!=null&&o.push($e(s,l,p))}else if(ee(t)||gt(t))for(const[s,l]of oi(n,t.planeLike)){const p=i(s,l)??Ei;o.push($e(s,l,p))}return W(o)}function cn(e){return yt(e.map(([t,n])=>{const i=oe(t,n,0),o=oe(t,n,1);return new nn(i,o)}))}function W(e){return yt(e.map(t=>t?new we(t):void 0))}function Ti(e,t){return W(e.map(([n,i])=>[n,i,t]))}function yt(e){if(e.length!==0)return e.length===1?e[0]??void 0:new ui(e.filter(xn))}function hn(e){return e instanceof ui}function q(e){return e instanceof we}function Q(e){return e instanceof tn}function re(e){return e instanceof yi}function ee(e){return e instanceof ln}function te(e){return e instanceof on}function ae(e){return e instanceof sn}function ye(e){return e instanceof rn}function le(e){return e instanceof ar}function gt(e){return e instanceof _i}function Or(e){return e instanceof wi}function Mr(e){return e instanceof bi}const Ei=0;let ke=class{constructor(e,t,n,i){this.targetPoint=e,this.constraint=t,this.isDraped=n,this.domain=i}},dn=class extends ke{constructor({targetPoint:e,objectId:t,constraint:n,isDraped:i}){super(e,n,i,1),this.objectId=t}},Ne=class{constructor(e,t){this.isDraped=e,this.domain=t}},B=class Xi extends Ne{constructor(t,n,i,o,s=3,l=!0,p=!0){super(o,s),this.type=t,this.lineStart=n,this.lineEnd=i,this.fadeLeft=l,this.fadeRight=p}equals(t){return t instanceof Xi&&this.type===t.type&&G(this.lineStart,t.lineStart)&&G(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return He(this.lineStart,this.lineEnd)}},Gi=class extends dn{constructor(e){super({...e,isDraped:!0,constraint:new _i(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new B(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Oi=class extends dn{constructor(e){super({...e,constraint:new nn(e.edgeStart,e.edgeEnd)})}get hints(){return[new B(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Mi=class Yi extends Ne{constructor(t,n,i=3){super(n,i),this.intersectionPoint=t}equals(t){return t instanceof Yi&&G(this.intersectionPoint,t.intersectionPoint)}},je=class extends ke{constructor(e,t,n,i){super(e,new we(e),i,3),this.first=t,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Mi(this.targetPoint,this.isDraped,this.domain)]}},xi=class extends ke{constructor({lineStart:e,lineEnd:t,targetPoint:n,isDraped:i}){super(n,new vi(e,t),i,2),this._referenceLineHint=new B(2,e,t,i,this.domain)}get hints(){return[this._referenceLineHint,new B(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Ci=class Qi extends Ne{constructor(t,n,i,o=3){super(i,o),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof Qi&&G(this.lineStart,t.lineStart)&&G(this.lineEnd,t.lineEnd)}},ki=class extends ke{constructor({referenceLine:e,lineStart:t,targetPoint:n,isDraped:i}){const o=ie(t),{left:s,right:l}=e;tt(o,es(o,o,l),s),super(n,new vi(t,o),i,2),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new B(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Ci(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new B(1,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(n=>{G(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),G(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),G(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),G(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},un=class eo extends Ne{constructor(t,n,i,o,s=3){super(o,s),this.previousVertex=t,this.centerVertex=n,this.nextVertex=i}equals(t){return t instanceof eo&&G(this.previousVertex,t.previousVertex)&&G(this.centerVertex,t.centerVertex)&&G(this.nextVertex,t.nextVertex)}},Ai=class extends ke{constructor({targetPoint:e,constraint:t,previousVertex:n,otherVertex:i,otherVertexType:o,isDraped:s,selfSnappingType:l,objectId:p,domain:r}){super(e,t,s,r??2),this.previousVertex=n,this.otherVertex=i,this.otherVertexType=o,this.selfSnappingType=l??0,this.objectId=p??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===1?this.otherVertex:this.targetPoint,n=this.otherVertexType===1?this.targetPoint:this.otherVertex;return[new B(0,t,n,this.isDraped,this.domain),new B(1,e,t,this.isDraped,this.domain),new un(this.previousVertex,t,n,this.isDraped,this.domain)]}},Pi=class extends ke{constructor({targetPoint:e,point1:t,point2:n,isDraped:i}){super(e,new on(ts(v(),t,n,.5),.5*mo(t,n)),i,2),this._p1=t,this._p2=n}get hints(){return[new B(1,this.targetPoint,this._p1,this.isDraped,this.domain),new B(1,this.targetPoint,this._p2,this.isDraped,this.domain),new un(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function Ri(e,t,n,i,o=v()){const s=Ht(xr,e);return s[2]=jn(i,s,t,n)||0,i.renderCoordsHelper.toRenderCoords(s,t,o),o}const xr=v();function Hi(e,t,n,i){return i.type==="2d"?(ft.x=e[0],ft.y=e[1],ft.spatialReference=t,i.toScreen(ft)):(Ri(e,t,n,i,Di),i.state.camera.projectToScreen(Di,yn),vo(yn[0],yn[1]))}const ft=Re(0,0,0,null),Di=v(),yn=_o();function Cr(e){return zn(e)||An(e)}function gn(e,t,n,...i){return zn(e)?t.apply(void 0,i):e.isWebMercator?n.apply(void 0,i):null}function kr(e){const{spatialReference:t}=e;return gn(t,Dr,Lr,e)}function Ar(e,t){if(!Xe(e.spatialReference,t.spatialReference))return null;const{spatialReference:n}=e;return mt[0]=e.x,mt[1]=e.y,mt[2]=e.hasZ?e.z:0,vt[0]=t.x,vt[1]=t.y,vt[2]=t.hasZ?t.z:0,Li(mt,vt,n)}function Li(e,t,n){return gn(n,Rr,Hr,e,t,n)}const Pr={geodesicLength:kr,geodesicDistanceBetweenPoints:Ar,geodesicDistance:Li};async function Ii(){return await vs(),Pr}function Rr(e,t,n){return he(Lt(Ur,e,t,n).distance,"meters")}function Hr(e,t,n){return he(Kn(Ir(e,t,n),{unit:"meters"}),"meters")}function Dr(e){return he(ls([e],"meters")[0],"meters")}function Lr(e){return he(Kn(e,{unit:"meters"}),"meters")}function Ir(e,t,n){return new bo({spatialReference:n,paths:[[[...e],[...t]]]})}const Ur=new It,mt=v(),vt=v();let K=class extends Mt{constructor(e){super(e),this.options=new M,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([ce(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:i,effectiveGridEnabled:o}=this.options;return{selfEnabled:n,featureEnabled:i,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=$o(n=>this._updateEngines(e,t,n))},Se),ce(()=>this.options,e=>{for(const t of this._engines)t.options=e},wo)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const i=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!i.has("feature")?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!i.has("self")?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!i.has("grid")?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(const s of o)s.status==="fulfilled"&&s.value?.engine.destroy();else{for(const s of o)s.status==="fulfilled"&&s.value&&i.set(s.value.type,s.value.engine);this._engines=Array.from(i.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},n]=await Promise.all([import("./SelfSnappingEngine-Bl56UoIA.js"),Ii()]);return xt(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:n})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:n}=await import("./GridSnappingEngine-Dq-tYQYn.js");return xt(e),{type:"grid",engine:new n({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await import("./FeatureSnappingEngine-B7r4319G.js");xt(e);const{view:n,options:i}=this,{spatialReference:o}=n;return{type:"feature",engine:new t({view:n,options:i,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return qr(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:s}=n,l=At(o,s);if(l==null)return t;const{view:p}=this,{elevationInfo:r,visualizer:a}=n,d=[],u=xe(l,p,r),m=i.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,m,n)||!mn(i,n.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=lt(m),d.push(...i.hints);for(const y of this._currentOtherActiveCandidates)mn(y,n.drawConstraints)&&(y.targetPoint=lt(m),d.push(...y.hints));return a!=null&&this.addHandles(a.draw(d,{spatialReference:s,elevationInfo:Vr(n),view:p,selfSnappingZ:n.selfSnappingZ}),fn),Wt(m,p,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(fn)}async _snapSinglePoint({point:e,context:t,signal:n}){const{view:i}=this,{elevationInfo:o}=t,s=xe(e,i,o),l=await this._fetchCandidates(s,3,t,n);return this._createSnapResult(s,0,l,i,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:i}){const{view:o}=this,{coordinateHelper:s,elevationInfo:l,spatialReference:p}=n;await qo(t.spatialReference,p);const r=At(t,p),a=xe(r,o,l),d=await this._fetchCandidates(a,1,n,i);if(d.length>0){const y=await this._fetchCandidates(a,2,n,i);return this._createSnapResult(a,1,[...d,...y],o,r,n,i)}const u=xe(e,o,l),m=await this._fetchCandidates(u,2,n,i);return this._createSnapResult(u,0,m,o,{z:s.hasZ()&&e.hasZ?e.z??0:void 0,m:s.hasM()&&e.hasM?e.m??0:void 0},n,i)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,n,i)))).flat()}_createSnapResult(e,t,n,i,o,s,l){return{get valid(){return!So(l)},apply:()=>{const{spatialReference:p}=s,{snappedPoint:r,hints:a}=this._processCandidates(e,t,n,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(a,{spatialReference:p,elevationInfo:Ee,view:i,selfSnappingZ:s.selfSnappingZ}),fn),Wt(r,i,o,s)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Qn(e,n);const o=this._currentMainCandidate;if(o!=null){const s=jr(o,n);if(s>=0){if(!(n[s]instanceof je))return this._intersectWithOtherCandidates(s,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,i))return this._updateSnappingCandidate(o,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_intersectWithOtherCandidates(e,t,n,i,o){const{coordinateHelper:s}=o,l=t[e],p=[];for(let r=0;r<t.length;++r){if(r===e)continue;const a=t[r],d=l.constraint.intersect(a.constraint);if(d)for(const u of d.closestPoints(l.targetPoint))p.push([new je(lt(u),l,a,a.isDraped),this._squaredScreenDistance(n,u,s)])}return p.length>0&&(p.sort((r,a)=>r[1]-a[1]),p[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(p[0][0],i,t,o):mn(l,o.drawConstraints)?this._updateSnappingCandidate(l,i,t,o):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const l of n){if(e instanceof je){if(l.constraint.equals(e.first.constraint)||l.constraint.equals(e.second.constraint))continue}else if(l.constraint.equals(e.constraint))continue;const p=l.constraint.closestTo(o);this._squaredScreenDistance(p,o,i.coordinateHelper)<Nr()&&(l.targetPoint=o,this._currentOtherActiveCandidates.push(l),s.push(...l.hints))}return{snappedPoint:o,hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return Bt(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return Hi(e,t.spatialReference,Ee,this.view)}get test(){}};c([h({constructOnly:!0})],K.prototype,"view",void 0),c([h()],K.prototype,"options",void 0),c([h({readOnly:!0})],K.prototype,"updating",null),c([h()],K.prototype,"_loadTask",void 0),c([h()],K.prototype,"_engines",void 0),c([h()],K.prototype,"_squaredMouseProximityThreshold",null),c([h()],K.prototype,"_squaredTouchProximityThreshold",null),K=c([P("esri.views.interactive.snapping.SnappingManager")],K);const fn="visualization-handle";function Nr(){return Le.satisfiesConstraintScreenThreshold*Le.satisfiesConstraintScreenThreshold}function mn(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Gi||e instanceof Oi||e instanceof xi||e instanceof ki||e instanceof Pi)&&(!(e instanceof Ai)||t.direction==null&&e.selfSnappingType===1)}function jr(e,t){return e instanceof je?vn(t,e.first)>=0&&vn(t,e.second)>=0?0:-1:vn(t,e)}function vn(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}function qr(e){return e.scenePoint!=null}function Vr({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Ee:t}function _n(e){return To(e)?Eo(e)||An(e)||Go(e)||Oo(e)?ws:e:Ss(e)}function zr(e,t=_t()){return Ui(e,t)}function Fr(e,t=_t()){return Ui(e,t,!1)}function Ui(e,t,n=e.hasZ){const i=_n(e.spatialReference),o=Mo(i);if(o==null)return null;const s=(p,r)=>!(r.length<2)&&(X(p,r[0],r[1],n&&r[2]||0),!0);let l=0;for(const p of e.rings){const r=p.length;if(r<3)continue;const{positionsWorldCoords:a}=t;for(;a.length<r;)a.push(v());const d=Zr,u=X(Wr,0,0,0),m=1/r;for(let f=0;f<r;f++){if(!s(d,p[f])||!Qe(d,e.spatialReference,a[f],i))return null;k(u,u,a[f],m)}const y=Wn(a[0],a[1],u,ds());if(Vn(Nt(y))===0)continue;for(let f=0;f<r;f++)us(y,u,a[f],a[f]);const g=Br(a);for(let f=0;f<g.length;f+=3)l+=bs(a[g[f]],a[g[f+1]],a[g[f+2]])}return jt(l,o)}const Zr=v(),Wr=v();function _t(){return{positionsWorldCoords:[]}}function Br(e){return _s(Kr(e),[],2)}function Kr(e){const t=new Float64Array(2*e.length);for(let n=0;n<e.length;++n){const i=e[n],o=2*n;t[o]=i[0],t[o+1]=i[1]}return t}const $r=e=>({geodesicArea(t){const{spatialReference:n}=t;return gn(n,Xr,i=>Yr(e,i),t)}});async function Jr(){const e=await import("./geometryEngine-63haXLQ5.js");return $r(e)}function Xr(e){return jt(Math.abs(ps([e],"square-meters")[0]),"square-meters")}function Yr(e,t){try{return jt(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch{return null}}const Qr=e=>({autoAreaByElevationMode(t,n,i=_t()){return n==="on-the-ground"?e.geodesicArea(t)??Fr(t,i):zr(t,i)},autoArea2D(t,n=_t()){return this.autoAreaByElevationMode(t,"on-the-ground",n)}});let bn=null;async function qe(){return bn||(bn=Qr(await Jr())),bn}function ea(e){return ta(e)}function ta(e,t){const{hasZ:n,spatialReference:i}=e,o=_n(i);let s=0;const l=Pn(o);if(l==null)return null;const p=wn;for(const r of e.paths){if(r.length<2)continue;const a=r.length-1;for(let d=0;d<a;++d){const u=r[d];V[0]=u[0],V[1]=u[1],V[2]=n?u[2]:0;const m=r[d+1];z[0]=m[0],z[1]=m[1],z[2]=n?m[2]:0;const y=p(V,z,i);if(y==null)return null;s+=y.value}}return he(s,l)}function na(e,t){const{spatialReference:n}=e;return Xe(n,t.spatialReference)?(V[0]=e.x,V[1]=e.y,V[2]=e.hasZ?e.z:0,z[0]=t.x,z[1]=t.y,z[2]=t.hasZ?t.z:0,wn(V,z,n)):null}function ia(e,t){const{spatialReference:n}=e;return Xe(n,t.spatialReference)?(V[0]=e.x,V[1]=e.y,V[2]=e.hasZ?e.z:0,z[0]=t.x,z[1]=t.y,z[2]=t.hasZ?t.z:0,ji(V,z,n)):null}function oa(e){return e!=null?Ni(e.hasZ?e.z:0,e.spatialReference):null}function Ni(e,t){const n=xo(t);return n!=null?he(e??0,n):null}function wn(e,t,n){const i=qi(e,t,n,1);return i!=null?he(i.horizontal,i.unit):null}function ji(e,t,n){const i=qi(e,t,n,2);return i!=null?he(i.verticalSigned,i.unit):null}function qi(e,t,n,i){const o=_n(n),s=Pn(o);if(s==null)return null;const l=t[2]-e[2];if(i===2)return{verticalSigned:l,unit:s};if(!Qe(e,n,Sn,o)||!Qe(t,n,bt,o))return null;if(i===0)return{direct:He(bt,Sn),unit:s};if(X(wt,e[0],e[1],t[2]),!Qe(wt,n,wt,o))return null;const p=He(wt,bt);return i===1?{horizontal:p,unit:s}:{direct:He(bt,Sn),horizontal:p,vertical:Math.abs(l),unit:s}}const V=v(),z=v(),Sn=v(),bt=v(),wt=v();function sa(e){return{autoLength2D:t=>e.geodesicLength(t)??ea(t),autoDistanceBetweenPoints2D:(t,n)=>e.geodesicDistanceBetweenPoints(t,n)??na(t,n),autoDistance2D:(t,n,i)=>(Ve[0]=t[0],Ve[1]=t[1],Ve[2]=t.length===3?t[2]:0,ze[0]=n[0],ze[1]=n[1],ze[2]=n.length===3?n[2]:0,e.geodesicDistance(Ve,ze,i)??wn(Ve,ze,i))}}async function ge(){return sa(await Ii())}const Ve=v(),ze=v();function ra(e){return e?.type==="graphic"}function Vi(e){return e.find(ra)??null}class zi{constructor(t){this.layer=t}get elevationInfo(){return this.layer.elevationInfo}add(t){this.layer.add(t)}addMany(t){this.layer.addMany(t)}onGraphicsChange(t){const{layer:n}=this;return Ct(()=>n.graphics,"change",i=>t(i))}has(t){return t.layer===this.layer}remove(t){this.layer.remove(t)}removeMany(t){this.layer.removeMany(t)}removeAll(){this.layer.removeAll()}}c([h()],zi.prototype,"elevationInfo",null);class Fi{constructor(t){this.layer=t}get elevationInfo(){}add(t,n){(this._getSublayerForCreateTool(n)??this._getSublayerForGraphic(t))?.add(t)}addMany(t,n){if(n){const i=this._getSublayerForCreateTool(n);if(i)return void i.addMany(t)}t.forEach(i=>this._getSublayerForGraphic(i)?.add(i))}onGraphicsChange(t){const{layer:n}=this;if(n.sublayers?.length)return Co(n.sublayers?.toArray().map(i=>Ct(()=>i.graphics,"change",o=>t(o))))}has(t){const{layer:n}=this;return t.layer===n||t.sourceLayer===n||!!n.sublayers?.some(i=>t.layer===i||t.sourceLayer===i)}remove(t){this._getSublayerForGraphic(t)?.remove(t)}removeMany(t){t.forEach(n=>this._getSublayerForGraphic(n)?.remove(n))}removeAll(){this.layer.sublayers?.forEach(t=>t.removeAll())}_getSublayerForCreateTool(t){const{layer:n}=this;switch(t){case"point":return n.pointLayer;case"polyline":return n.polylineLayer;case"polygon":return n.polygonLayer;case"multipoint":return n.multipointLayer;case"text":return n.textLayer}}_getSublayerForGraphic(t){const{layer:n}=this;if(t?.geometry)switch(t.geometry.type){case"point":return t.symbol?.type==="text"?n.textLayer:n.pointLayer;case"polyline":return n.polylineLayer;case"polygon":return n.polygonLayer;case"multipoint":return n.multipointLayer}}}c([h()],Fi.prototype,"elevationInfo",null);let A=class extends Mt{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){const{activeComponent:e}=this;if(!e)return null;switch(e.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":return e.graphicSymbol?.type==="text"?"text":e.geometryType;case"draw-3d":return e.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([h()],A.prototype,"activeComponent",void 0),c([h()],A.prototype,"cancelled",void 0),c([h()],A.prototype,"history",void 0),c([h()],A.prototype,"tool",null),c([h()],A.prototype,"type",void 0),c([h()],A.prototype,"canUndo",null),c([h()],A.prototype,"canRedo",null),c([h()],A.prototype,"onEnd",void 0),c([h()],A.prototype,"undo",null),c([h()],A.prototype,"redo",null),c([h()],A.prototype,"toggleTool",void 0),c([h()],A.prototype,"addToSelection",void 0),c([h()],A.prototype,"removeFromSelection",void 0),A=c([P("esri.widgets.Sketch.support.OperationHandle")],A);let St=class extends A{};c([h()],St.prototype,"activeComponent",void 0),St=c([P("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],St);let pe=class extends A{};c([h()],pe.prototype,"activeComponent",void 0),pe=c([P("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],pe);function aa(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function la(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";case"text":return"point";default:return e}}function Zi(e){if(e.length>1)return!1;const t=e.at(0)?.geometry;return t?.type==="point"||t?.type==="multipoint"&&t.points.length<2}const Wi={defaultZ:0},Fe={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:Ko},tool:"transform"},Tn=Symbol(),Bi=Symbol();let b=class extends Mt{constructor(e){super(e),this._defaultSnappingManager=null,this._internalGraphicsLayer=new Zo({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._updatingHandles=new jo,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Rn({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new ko({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Ao({color:[130,130,130,1],width:2}),this.meshSymbol=new Po({symbolLayers:new ve([new Ro])}),this.textSymbol=new Ho({text:"text"}),this.updateGraphics=new ve,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new Rn({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new zt,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{const{_layerAdapter:t}=this;if(this.removeHandles(Bi),!t)return;const n=[t.onGraphicsChange(i=>this._onLayerGraphicsChangeCallback(i)),ce(()=>t.elevationInfo,i=>{i!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=i)},Se)].filter(xn);this.addHandles(n,Bi)},this._originalPopupEnabled=null,this.defaultCreateOptions=Wi,this.defaultUpdateOptions=Fe,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new M}initialize(){this.addHandles([Ct(()=>this.view?.map?.layers,"change",e=>{this.layer&&e.removed.includes(this.layer)&&this.cancel()}),ce(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),Se),ce(()=>this.view,e=>{this._defaultSnappingManager=Ye(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new K({view:e,options:this.snappingOptions})),e.type==="2d"?import("./editingTools-Owi9EJyN.js"):e.type==="3d"&&(import("./ImageMaterial.glsl-C9IVRq6S.js").then(t=>t.e),import("./LineCallout.glsl-Banmijl9.js").then(t=>t.G)))},Se),ce(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),ti(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=Ye(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get _layerAdapter(){const{layer:e}=this;switch(e?.type){case"graphics":return new zi(e);case"map-notes":return new Fi(e);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,n=!t&&e&&"tooltip"in e?e.tooltip:null;return n?.visible?n:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Wi,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Fe,...e,reshapeOptions:{...Fe.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...Fe.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=Ye(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new K({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:i,map:o}=t;i&&this._clearCursor(),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const n="view-ready";this.removeHandles(n),e&&this.addHandles(Do(()=>e.ready,i=>{this.removeHandles(this._viewHandlesKey),i&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},Se),n),this._set("view",e)}addGraphic(e){this._layerAdapter?.add(e)}addGraphics(e){this._layerAdapter?.addMany(e)}hasGraphic(e){return!!this._layerAdapter?.has(e)}removeGraphic(e){this._layerAdapter?.remove(e)}removeGraphics(e){this._layerAdapter?.removeMany(e)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=kt(this._moduleLoaderAbortController),this._viewReadyAbortController=kt(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:n}=this,i=t.toArray();this.removeGraphics(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:n})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.addGraphics(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:n,layer:i}=this;if(!n||this.state==="disabled")throw i||this._logMissingLayer(),Hn();if(n.activeTool!=null&&(n.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");qt(n,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void n.map?.remove(this._internalGraphicsLayer);const s=()=>{if(o===this._operationHandle){const l=this.createGraphic,p=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map?.remove(this._internalGraphicsLayer),o.cancelled||l==null||this.addGraphic(l),this._sketchContinuationFlag=!1,this.emit("create",{graphic:l,state:p?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),p||this._sketchContinuationFlag)return;const{creationMode:r}=this;if(r==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(In(this.create(e,t)))}else r==="update"&&l&&this._updatingHandles.addPromise(In(this.update([l])))}};o.on("complete",s),this._operationHandle=o,n.ready&&n.focus()}async place(e,t){return await e.load(),this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:n,view:i,state:o}=this;if(!i||o==="disabled")throw n||this._logMissingLayer(),Hn();i.activeTool!=null&&(i.activeTool=null);const s=Array.isArray(e)?e:[e];if(e==null||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(p=>this.hasGraphic(p)?p.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0)))return;const l=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||l==null||C(l)||(qt(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(l,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:l.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const n of e)n.geometry==null||n.geometry.type==="mesh"||Xe(n.geometry.spatialReference,t.spatialReference)||(Vo(n.geometry.spatialReference,t.spatialReference)||zo()||await Fo(),n.geometry=At(n.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(l=>{l.type!=="vector-tile"&&l.type!=="imagery"||o.push(l)});const s=await t.hitTest(e,{exclude:o});return Vi(s.results)}const n=[t.map.ground];t.map.allLayers.forEach(o=>{Lo(o)&&n.push(o)});const i=await t.hitTest(e,{exclude:n});if(i.results.length>0){const o=i.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(o.distance??0)>-Math.min(3*i.ground.distance,t.viewingMode==="global"?Io(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const n=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!n&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},x.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit(Nn(e)));let n=null;if(t!=null){const i=t.graphic;this.updateGraphics.includes(i)||this.hasGraphic(i)?(e.stopPropagation(),n=i):this.view?.type!=="2d"||this._isComponentGraphic(i)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();n==null||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const n=this.view;if(!n)return this._logMissingView(),null;const i={hasZ:n.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,n,i);return o==null?null:(n.tools.add(o),n.activeTool=o,this._setupCreateOperationHandle(o,e))}async _setupDrawGraphicTool(e,t,n){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:o,hasZ:s,geometryToPlace:l,graphicProperties:p,mode:r,preserveAspectRatio:a}=n,d=aa(r,e),u=la(e),m=n?.optionsPerTool?.has(e)?n.optionsPerTool.get(e):{},y=m?.preserveAspectRatio??a??e!=="rectangle",g={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:i,defaultZ:o,forceUniformSize:y,graphicProperties:{...p,attributes:{...p?.attributes}},geometryToPlace:l,geometryType:u,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...m};return t.type==="2d"?this._makeDrawGraphicTool2D(g):this._makeDrawGraphicTool3D(g)}async _makeDrawGraphicTool2D(e){const[t,n,i]=await Promise.all([this._requireModule(import("./editingTools-Owi9EJyN.js")),qe(),ge()]);return C(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:ca(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:i})}async _makeDrawGraphicTool3D(e){const[t,n,i]=await Promise.all([this._requireModule(import("./ImageMaterial.glsl-C9IVRq6S.js").then(o=>o.e)),qe(),ge()]);return C(t)||this.destroyed?null:new t.module.DrawGraphicTool3D({...e,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:i})}_setupCreateOperationHandle(e,t){const n=this.view;if(!n)return this._logMissingView(),null;let i=null;const o=e.forceUniformSize,s=e.centered,l=[n.on("key-down",r=>{if(r.key===O.pan)r.stopPropagation(),r.repeat||(e.enabled=!1);else if(r.key===O.complete)r.stopPropagation(),e.completeCreateOperation();else if(r.key!==O.vertexAdd||r.repeat)r.key===O.undo?(r.stopPropagation(),p.undo()):r.key===O.redo?(r.stopPropagation(),p.redo()):r.key!==O.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||r.repeat?r.key===O.center&&(r.repeat||(e.centered=!s,r.stopPropagation())):(e.forceUniformSize=!o,r.stopPropagation());else{const a=e.drawOperation.geometryType;a!=="polyline"&&a!=="polygon"&&a!=="multipoint"||(r.stopPropagation(),e.drawOperation.commitStagedVertex())}},x.WIDGET),n.on("key-up",r=>{r.key===O.pan?e.enabled=!0:r.key!==O.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?r.key===O.center&&(e.centered=s,r.stopPropagation()):(e.forceUniformSize=o,r.stopPropagation())},x.WIDGET),e.on("vertex-add",r=>{switch(i=i==null?"start":"active",r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",r=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:r.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",r=>{switch(r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",r=>{this._set("createGraphic",r.graphic),i="complete",r.aborted?p&&p.cancel():p&&p.complete()}),ce(()=>this._getGraphicSymbolFromTool(t),r=>{e.graphicSymbol=r})],p=new St({activeComponent:e,type:"create",onEnd:()=>{J(l),n.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return p}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol;case"text":return this.textSymbol}}async _setupUpdateOperation(e,t){const{view:n}=this;if(!n)return this._logMissingView(),null;const i={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let o=i.tool??Fe.tool;if(this.removeGraphics(e),this.addGraphics(e),n.type==="3d"){if(e.length===0)return null;switch(o){case"move":return this._setupMove3DOperation(e,i,n,o);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],i,n);case"transform":return this._setupGraphicTransform3DOperation(e,i,n)}}switch(o){case"move":return this._setupMove2DOperation(e,i,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,o,i,n);case"transform":return Zi(e)&&(o="reshape"),this._setupTransformOrReshape2DOperation(e,o,i,n)}}async _setupMove3DOperation(e,t,n,i,o=!1){const[s,l]=await Promise.all([this._requireModule(import("./ImageMaterial.glsl-C9IVRq6S.js").then(g=>g.e)),ge()]);if(C(s))return s;const{ManipulatedObject3DGraphic:p,MoveTool3D:r}=s.module,a=new Map,d=()=>{a.forEach(g=>g.destroy()),a.clear()};for(const g of e){const f=new p({view:n,graphic:g}),_=Jn(f);if(_!==0)return d(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${$n(_)}).`),null;a.set(g,f)}const u=new r({view:n,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:l});n.tools.add(u),u.objects.addMany(Array.from(a.values())),o||this.updateGraphics.addMany(e);const m=[],y=new pe({activeComponent:u,tool:i,type:"update",onEnd:()=>{J(m),Gt(n,u),d()},undo:()=>{Ji(this.view,u),Tt(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{Et(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:g=>{this.updateGraphics.push(g);const f=new p({view:n,graphic:g});a.set(g,f),u.objects.push(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:g=>{const f=this.updateGraphics.indexOf(g);if(y.history.undo.forEach(E=>E.updates.splice(f,1)),y.history.redo.forEach(E=>E.updates.splice(f,1)),this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void y.complete();const _=a.get(g);_&&(u.objects.remove(_),_.destroy(),a.delete(g))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||i!=="transform")return;const g=this.updateGraphics.at(0),f=await this._setupReshape3DOperation(g,t,n,!0);f&&!C(f)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(f,t))}});return m.push(...this._getHandlesForComponent(y,t),n.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,t),x.WIDGET),n.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},x.WIDGET)),y}_setupGraphicTransform3DOperation(e,t,n,i=!1){if(e.length===1&&Gs(e[0])===0){const o=e[0],s=o.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(o,t,n);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,n,i)}return this._setupMove3DOperation(e,t,n,"transform",i)}async _setupPointTransform3DOperation(e,t,n){const i="transform",{enableRotation:o,enableScaling:s,enableZ:l}=t,p=await this._requireModule(import("./ImageMaterial.glsl-C9IVRq6S.js").then(g=>g.e));if(C(p))return p;const{TransformTool3D:r,ManipulatedObject3DGraphic:a}=p.module,d=new a({graphic:e,view:n}),u=new r({object:d,view:n,enableRotation:o,enableScaling:s,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(u),this.updateGraphics.add(e);const m=[],y=new pe({activeComponent:u,tool:i,type:"update",onEnd:()=>{J(m),Gt(n,u),d.destroy()},undo:()=>{Ji(this.view,u),Tt(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{Et(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const f=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);C(f)||this._setUpdateOperationHandle(f,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return m.push(...this._getHandlesForComponent(y,t),n.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,t),x.WIDGET),n.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},x.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,n,i=!1){const o="transform",{enableRotation:s,enableScaling:l,enableZ:p,preserveAspectRatio:r}=t,[a,d]=await Promise.all([this._requireModule(import("./ImageMaterial.glsl-C9IVRq6S.js").then(T=>T.e)),ge()]);if(C(a))return a;const{ManipulatedObject3DGraphic:u,ExtentTransformTool:m}=a.module,y=this.view?.inputManager?.isModifierKeyDown(O.constraint),g=new u({view:n,graphic:e}),f=new m({object:g,view:n,enableRotation:s,enableScaling:l,enableZ:p,preserveAspectRatio:!!r!=!!y,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});n.tools.add(f),i||this.updateGraphics.add(e);const _=[],E=new pe({activeComponent:f,tool:o,type:"update",onEnd:()=>{J(_),Gt(n,f),g.destroy()},canUndo:()=>!f.destroyed&&f.canUndo,undo:()=>{f.destroyed||(f.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!f.destroyed&&f.canRedo,redo:()=>{f.destroyed||(f.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async T=>{this.updateGraphics.add(T),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[T],removed:[],type:"selection-change"},type:"update"}),E.onEnd(),E.destroy();const me=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);C(me)||this._setUpdateOperationHandle(me,t)},removeFromSelection:T=>{this.updateGraphics.remove(T),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[T],type:"selection-change"},type:"update"}),E.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const T=await this._setupReshape3DOperation(e,t,n,!0);T&&!C(T)&&(E.onEnd(),E.destroy(),this._setUpdateOperationHandle(T,t))}});return _.push(...this._getHandlesForComponent(E,t),n.on("immediate-click",T=>this._getCommonUpdateOperationClickHandlers(E,T,t),x.WIDGET),n.on("key-down",T=>this._getCommonUpdateOperationKeyDownHandlers(E,T),x.WIDGET),n.on("key-down",T=>{T.key!==O.constraint||T.repeat||(f.preserveAspectRatio=!f.preserveAspectRatio,T.stopPropagation())},x.WIDGET),n.on("key-up",T=>{T.key===O.constraint&&(f.preserveAspectRatio=!f.preserveAspectRatio,T.stopPropagation())},x.WIDGET)),E}async _setupMove2DOperation(e,t,n){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,n);if(C(o))return o;const s=new pe({activeComponent:o,tool:i,type:"update",onEnd:()=>{this._clearCursor(),J(r),J(p),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const a=this.updateGraphics.toArray();Tt(s,a),s.refreshComponent(),this._emitUndoEvent({graphics:a,tool:i})},redo:()=>{const a=this.updateGraphics.toArray();Et(s,a),s.refreshComponent(),this._emitRedoEvent({graphics:a,tool:i})},addToSelection:async a=>{await this._updatingHandles.addPromise(this._updateSpatialReference(a)),this.updateGraphics.push(a),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[a],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:a=>{const d=this.updateGraphics.indexOf(a);s.history.undo.forEach(m=>m.updates.splice(d,1)),s.history.redo.forEach(m=>m.updates.splice(d,1)),this.updateGraphics.remove(a);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[a],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=u:s.complete()}});let l=!1;const p=[n.on("immediate-click",a=>this._getCommonUpdateOperationClickHandlers(s,a,t),x.WIDGET),n.on("key-down",a=>{this._getCommonUpdateOperationKeyDownHandlers(s,a),a.key!==O.constraint||a.repeat||(l=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},x.WIDGET),n.on("key-up",a=>{a.key===O.constraint&&l&&(l=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},x.WIDGET)],r=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,n,i=!1){const o="reshape",[s,l,p]=await Promise.all([this._requireModule(import("./ImageMaterial.glsl-C9IVRq6S.js").then(_=>_.e)),qe(),ge()]);if(C(s))return s;const{ManipulatedObject3DGraphic:r,ReshapeTool3D:a}=s.module,d=new r({view:n,graphic:e}),u=Ts(d);if(u!==0)return d.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${$n(u)}).`),null;const m=t.reshapeOptions,y=new a({view:n,object:d,enableZVertex:t.enableZ&&m?.vertexOperation==="move",enableZShape:t.enableZ&&m?.shapeOperation==="move",enableMoveObject:m?.shapeOperation==="move"||m?.shapeOperation==="move-xy",enableMidpoints:m?.edgeOperation==="split",enableEdgeOffset:m?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:p});n.tools.add(y),i||this.updateGraphics.add(d.graphic);const g=[],f=new pe({activeComponent:y,tool:o,type:"update",onEnd:()=>{J(g),Gt(n,y),d.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),f.onEnd(),f.destroy();const E=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);C(E)||this._setUpdateOperationHandle(E,t)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),f.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;f.onEnd(),f.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,n,!0);C(_)||this._setUpdateOperationHandle(_,t)}});return g.push(...this._getHandlesForComponent(f,t),n.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(f,_,t),x.WIDGET),n.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(f,_)},x.WIDGET)),f}async _setupTransformOrReshape2DOperation(e,t,n,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,n,i):await this._getReshape(e,n,i);if(C(o))return o;const s=new pe({activeComponent:o,type:"update",onEnd:()=>{J(p),J(l),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Tt(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{Et(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async r=>{let a=s.activeComponent;if(a?.type==="reshape"){const d=[...this.updateGraphics,r];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const u=await this._setupTransformOrReshape2DOperation(d,"transform",n,i);if(C(u))return;this._setUpdateOperationHandle(u,n)}else this.updateGraphics.add(r),a.graphics=this.updateGraphics.toArray(),a.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[r],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:r=>{const a=this.updateGraphics.indexOf(r);s.history.undo.forEach(u=>u.updates.splice(a,1)),s.history.redo.forEach(u=>u.updates.splice(a,1)),this.updateGraphics.remove(r);const d=this.updateGraphics.toArray();d.length===0?s.complete():Zi(d)?s.toggleTool():s.activeComponent.graphics=d,this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[r],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const r=this.updateGraphics.at(0),a=r.geometry;if(a!=null&&(s.tool==="reshape"&&a.type==="point"||s.tool==="transform"&&a.type==="extent"))return;let d=null;s.tool==="transform"?d=await this._getReshape([r],n,i):s.tool==="reshape"&&(d=await this._getBox([r],n,i)),C(d)||(s.activeComponent?.destroy(),s.activeComponent=d,s.activeComponent&&(J(p),p=this._getHandlesForComponent(s,n)))}}),l=[i.on("immediate-click",r=>this._getCommonUpdateOperationClickHandlers(s,r,n),x.WIDGET),i.on("key-down",r=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,r),r.key===O.constraint&&!r.repeat&&s){const a=s.activeComponent;a&&a.type==="box"&&(a.preserveAspectRatio=!a.preserveAspectRatio)}},x.WIDGET),i.on("key-up",r=>{if(r.key===O.constraint&&s){const a=s.activeComponent;a&&a.type==="box"&&(a.preserveAspectRatio=!a.preserveAspectRatio)}},x.WIDGET)];let p=this._getHandlesForComponent(s,n);return s}async _getGraphicMover(e,t,n){const{enableMoveAllGraphics:i,highlightOptions:o}=t,s=await this._requireModule(import("./GraphicMover-DhdSHNnj.js").then(l=>l.G));return C(s)?s:new s.module.default({enableMoveAllGraphics:i,highlightName:o?.name,highlightsEnabled:!!o?.enabled,indicatorsEnabled:!1,graphics:e,view:n,callbacks:{onGraphicMoveStart:({dx:l,dy:p,graphic:r})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:r,type:"move-start"},type:"update"})},onGraphicMove:({dx:l,dy:p,graphic:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:r,type:"move"},type:"update"}),onGraphicMoveStop:({dx:l,dy:p,graphic:r})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:p,mover:r,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(e,t,n){const{enableRotation:i,enableScaling:o,highlightOptions:s,preserveAspectRatio:l}=t,[p,r]=await Promise.all([this._requireModule(import("./Box-Bl0kNUz2.js")),ge()]);if(C(p))return p;const a=this.view?.inputManager?.isModifierKeyDown(O.constraint);return new p.module.default({graphics:e,enableRotation:i,enableScaling:o,highlightName:s?.name,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!l!=!!a,layer:this._internalGraphicsLayer,view:n,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:r,callbacks:{onMoveStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onMove:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onMoveStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScaleStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScale:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScaleStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotateStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotate:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotateStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"})}})}async _getReshape(e,t,n){const{highlightOptions:i,reshapeOptions:o}=t,s=o?.edgeOperation==="split",l=o?.shapeOperation==="move",p=!!o?.enableCreateCurveFromStraightEdge,[r,a,d]=await Promise.all([this._requireModule(import("./Reshape-BN0WJMw6.js")),qe(),ge()]);return C(r)?r:new r.module.default({enableMidpoints:s,enableMovement:l,enableCurveOnMidpoint:p,graphic:e[0],highlightName:i?.name,highlightsEnabled:!!i?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:d,view:n,callbacks:{onReshapeStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onReshape:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onReshapeStop:({mover:u,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:u,type:m},type:"update"}),onMoveStart:({dx:u,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:m,mover:y,type:g},type:"update"}),onMove:({dx:u,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:m,mover:y,type:g},type:"update"}),onMoveStop:({dx:u,dy:m,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:m,mover:y,type:g},type:"update"}),onVertexAdd:({added:u,type:m,vertices:y})=>{const g=u.map(f=>Dn(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:y,type:m},type:"update"})},onVertexRemove:({removed:u,type:m,vertices:y})=>{const g=u.map(f=>Dn(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:y,type:m},type:"update"})}}})}_getHandlesForComponent(e,t){const n=e.activeComponent;if(!n)return[];switch(n.type){case"graphic-mover":return[n.on("graphic-click",({graphic:i,viewEvent:o})=>{o.native?.shiftKey&&t.multipleSelectionEnabled&&(o.stopPropagation(),e.removeFromSelection(i))}),n.on("graphic-move-start",i=>e.addToHistory(fe(i.allGraphics)))];case"box":return[n.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),n.on("move-start",i=>e.addToHistory(fe(i.graphics))),n.on("rotate-start",i=>e.addToHistory(fe(i.graphics))),n.on("scale-start",i=>e.addToHistory(fe(i.graphics)))];case"reshape":return[n.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),n.on("move-start",i=>e.addToHistory(fe([i.mover]))),n.on("reshape-start",i=>e.addToHistory(fe([i.graphic]))),n.on("vertex-add",i=>e.addToHistory(fe([i.oldGraphic]))),n.on("vertex-remove",i=>e.addToHistory(fe([i.oldGraphic])))];case"move-3d":return[n.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),n.events.on("move-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-start"},type:"update"})}),n.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:i.dx,dy:i.dy,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move"},type:"update"})}),n.events.on("move-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-stop"},type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[n.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),n.events.on("translate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-start"},type:"update"})}),n.events.on("translate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-stop"},type:"update"})}),n.events.on("rotate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-start"},type:"update"})}),n.events.on("rotate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-stop"},type:"update"})}),n.events.on("scale-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-start"},type:"update"})}),n.events.on("scale-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-stop"},type:"update"})}),n.events.on("translate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move"},type:"update"})}),n.events.on("rotate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate"},type:"update"})}),n.events.on("scale",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale"},type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[n.events.on("reshape",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),n.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),n.events.on("vertex-add",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),n.events.on("vertex-remove",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,n){const{graphic:i,viewEvent:o}=n;return o.native?.shiftKey&&this.hasGraphic(i)?(o.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const n=this.view?.map;this._disablePopup(t);const i=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),n&&n.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:s,toolEventInfo:null,type:"update"})}};e.on("complete",i)}async _getCommonUpdateOperationClickHandlers(e,t,n){const i=Nn(t),o=await t.defer(()=>this._getFirstHit(i));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,n))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,n){const i=!!n.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!i||!this.hasGraphic(o))&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const n=t.key;n===O.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):n===O.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):n===O.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&O.delete.includes(n)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,n=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||n.length===1&&n[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Ye(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_clearCursor(){this.removeHandles(Tn)}_displayCursor(e){this.removeHandles(Tn),this.view?.container&&e!=null&&this.addHandles(this.view.acquireCursor(e,"high"),Tn)}_logError(e,t,n){Gn.getLogger(this).error(new Uo(e,t,n))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const n=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:n}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}_onLayerGraphicsChangeCallback(e){if(this._operationHandle!=null){const{updateGraphics:t}=this;for(const n of e.removed)if(t.includes(n)){if(!(t.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(n)}}}get test(){}wait(){return Ln(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(kt(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await No(Ln(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Ki("view"))}_logMissingLayer(){this._logError(pa,Ki("layer"))}};c([h()],b.prototype,"_defaultSnappingManager",void 0),c([h()],b.prototype,"_layerAdapter",null),c([h()],b.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],b.prototype,"_updatingHandles",void 0),c([h({readOnly:!0})],b.prototype,"activeTool",null),c([h({readOnly:!0})],b.prototype,"activeCreateToolDrawMode",null),c([h()],b.prototype,"activeTooltip",null),c([h({types:Pe})],b.prototype,"activeFillSymbol",void 0),c([h()],b.prototype,"activeLineSymbol",void 0),c([h()],b.prototype,"activeVertexSymbol",void 0),c([h()],b.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],b.prototype,"createGraphic",null),c([h()],b.prototype,"defaultCreateOptions",null),c([h()],b.prototype,"defaultUpdateOptions",null),c([h({type:at,nonNullable:!0})],b.prototype,"labelOptions",null),c([h()],b.prototype,"layer",void 0),c([h({types:Pe})],b.prototype,"pointSymbol",void 0),c([h({types:Pe})],b.prototype,"polygonSymbol",void 0),c([h({types:Pe})],b.prototype,"polylineSymbol",void 0),c([h()],b.prototype,"meshSymbol",void 0),c([h()],b.prototype,"textSymbol",void 0),c([h({type:M,nonNullable:!0})],b.prototype,"snappingOptions",null),c([h()],b.prototype,"snappingManager",null),c([h({readOnly:!0})],b.prototype,"state",null),c([h({type:Vt,nonNullable:!0})],b.prototype,"tooltipOptions",null),c([h({readOnly:!0})],b.prototype,"updateGraphics",void 0),c([h()],b.prototype,"updateOnGraphicClick",void 0),c([h()],b.prototype,"updating",null),c([h()],b.prototype,"creationMode",void 0),c([h({type:st,nonNullable:!0})],b.prototype,"valueOptions",null),c([h({types:Pe})],b.prototype,"vertexSymbol",void 0),c([h({value:null})],b.prototype,"view",null),c([h({constructOnly:!0,type:zt})],b.prototype,"sketchOptions",void 0),b=c([P("esri.widgets.Sketch.SketchViewModel")],b);const pa="sketch:missing-property",Ki=e=>`Property '${e}' is missing on SketchViewModel.`;function ca(e){return e==="polygon"||e==="rectangle"||e==="circle"}function Tt(e,t){$i("undo",e.history.undo,e.history.redo,t)}function Et(e,t){$i("redo",e.history.redo,e.history.undo,t)}function $i(e,t,n,i){const o=t.pop();if(!o)return;const s=o.updates,l=[];i.forEach((p,r)=>{const a=s[r];a!=null&&("geometry"in a&&a.geometry!=null&&(l.push({geometry:p.geometry}),p.geometry=a.geometry),"symbol"in a&&a.symbol!=null&&(l.push({symbol:p.symbol}),p.symbol=a.symbol),"undo"in a&&(l.push(a),a[e](p)))}),n.push({updates:l})}function Ji(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function fe(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function Gt(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function C(e){return"requireError"in e&&e.requireError==="aborted"}export{q as $,oa as A,Ms as B,Bt as C,rr as D,Vs as E,js as F,Fs as G,ki as H,Zs as I,Pi as J,Mi as K,B as L,Ci as M,un as N,Jt as O,Cr as P,ge as Q,qe as R,M as S,xe as T,Wt as U,on as V,yt as W,yi as X,wi as Y,bi as Z,at as _,Ne as a,ti as a0,Ni as a1,Ws as a2,Y as a3,st as a4,Vi as a5,Ri as a6,As as a7,Ps as a8,ks as a9,Jn as aa,ia as ab,ji as ac,lt as b,Oi as c,Ls as d,Gi as e,I as f,oe as g,dn as h,xi as i,we as j,Us as k,Ft as l,b as m,je as n,zt as o,Le as p,Zt as q,Ai as r,Cs as s,qt as t,Hi as u,Is as v,Os as w,qs as x,Qn as y,xs as z};
