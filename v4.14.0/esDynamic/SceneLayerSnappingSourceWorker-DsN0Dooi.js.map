{"version":3,"file":"SceneLayerSnappingSourceWorker-DsN0Dooi.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{h as s,c as o,k as r,g as c}from\"../../../../../chunks/vec32.js\";import{create as t}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{j as e}from\"../../../../../chunks/sphere.js\";const n=1e3;function a(t,n,a){const m=i;s(m,t,.5),o(m,m,n,.5);const f=r(m,t);return c(m,m,a),e(m,f)}const i=t();export{a as boundsFromEdge,n as maxCandidateCount};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import{throwIfAborted as t}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/has.js\";import\"../../../../../core/RandomLCG.js\";import\"../../../../../core/Error.js\";import{subclass as o}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{g as s,k as n}from\"../../../../../chunks/vec32.js\";import{create as i,clone as r}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as c,fromPoints as d,projectPoint as a}from\"../../../../../geometry/support/lineSegment.js\";import{n as p,B as m,a as u}from\"../../../../../chunks/sphere.js\";import{Octree as h}from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as g}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{maxCandidateCount as l,boundsFromEdge as f}from\"./sceneLayerSnappingUtils.js\";let _=class{constructor(){this._idToComponent=new Map,this._components=new h(e=>e.bounds),this._edges=new h(e=>e.bounds),this._tmpLineSegment=c(),this._tmpP1=i(),this._tmpP2=i(),this._tmpP3=i(),this.remoteClient=null}async fetchCandidates(e,o){await Promise.resolve(),t(o),await this._ensureEdgeLocations(e,o);const s=[];return this._edges.forEachNeighbor(t=>(this._addCandidates(e,t,s),s.length<l),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,t){const o=[];if(this._components.forEachNeighbor(e=>{if(null==e.info){const{id:t,uid:s}=e;o.push({id:t,uid:s})}return!0},e.bounds),!o.length)return;const s={components:o},n=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",s,t??{});for(const i of n.components)this._setFetchEdgeLocations(i)}async add(e){const t=new w(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor(o=>(o.component===t&&e.push(o),!0),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const t=this._idToComponent.get(e.id);if(null==t||e.uid!==t.uid)return;const o=g.createView(e.locations),s=new Array(o.count),n=i(),r=i();for(let i=0;i<o.count;i++){o.position0.getVec(i,n),o.position1.getVec(i,r);const c=f(n,r,e.origin),d=new C(t,i,c);s[i]=d}this._edges.add(s);const{objectIds:c,origin:d}=e;t.info={locations:o,objectIds:c,origin:d}}_addCandidates(e,t,o){const{info:n}=t.component,{origin:i,objectIds:r}=n,c=n.locations,d=c.position0.getVec(t.index,this._tmpP1),a=c.position1.getVec(t.index,this._tmpP2);s(d,d,i),s(a,a,i);const p=r[c.componentIndex.get(t.index)];this._addEdgeCandidate(e,p,d,a,o),j(e,p,d,o),j(e,p,a,o)}_addEdgeCandidate(e,t,o,s,i){if(!e.returnEdge)return;const c=p(e.bounds,E),u=d(o,s,this._tmpLineSegment),h=a(u,c,this._tmpP3);m(e.bounds,h)&&i.push({type:\"edge\",objectId:t,target:r(h),distance:n(c,h),start:r(o),end:r(s)})}};_=e([o(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],_);const b=_;function j(e,t,o,s){e.returnVertex&&m(e.bounds,o)&&s.push({type:\"vertex\",objectId:t,target:r(o),distance:n(u(e.bounds),o)})}class w{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++w.uid}static{this.uid=0}}class C{constructor(e,t,o){this.component=e,this.index=t,this.bounds=o}}const E=i();export{b as default};\n"],"names":["n","a","m","i","s","o","f","r","c","e","t","_","h","l","w","g","d","C","p","j","E","u","b"],"mappings":"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","x_google_ignoreList":[0,1]}