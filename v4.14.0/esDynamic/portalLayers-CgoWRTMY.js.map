{"version":3,"file":"portalLayers-CgoWRTMY.js","sources":["../../node_modules/@arcgis/core/portal/support/portalLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{findAssociatedFeatureService as a}from\"../../layers/support/associatedFeatureServiceUtils.js\";import{getLayerModuleType as r}from\"../../layers/support/fetchService.js\";import{LayerLoadContext as t}from\"../../layers/support/LayerLoadContext.js\";import{sceneServiceLayerTypeToClassName as s,applyPreferredHostToPortalItem as n,getPreferredHost as c}from\"../../layers/support/layerUtils.js\";import{layerLookupMap as o}from\"../../layers/support/lazyLayerLoader.js\";import i from\"../PortalItem.js\";import{getFirstLayerOrTable as u,getNumLayersAndTables as l,preprocessFSItemData as y,getLayerOrTable as m,layerTypeToLayerModuleType as f,populateSceneServiceItemData as p}from\"./loadUtils.js\";import{hasTypeKeyword as d}from\"./portalItemUtils.js\";async function L(e){let{portalItem:a}=e;!a||a instanceof i||(a=new i(a));const r=await w(a);return new(0,r.constructor)({portalItem:a,...r.properties})}async function w(e){await e.load();const a=new t;return N(await S(e,a))}async function S(a,r){switch(a.type){case\"3DTiles Service\":return a.typeKeywords.includes(\"3DObject\")?F():a.typeKeywords.includes(\"GaussianSplat\")?b():P();case\"CSV\":return K();case\"Feature Collection\":return M(a);case\"Feature Service\":return h(a,r);case\"Feed\":return J();case\"GeoJson\":return G();case\"Group Layer\":return k();case\"Image Service\":return g(a,r);case\"KML\":return V();case\"Knowledge Graph Layer\":return W();case\"Map Service\":return v(a,r);case\"Media Layer\":return $();case\"Scene Service\":return I(a,r);case\"Stream Service\":return j();case\"Video Service\":return T(a,r);case\"Vector Tile Service\":return C();case\"WCS\":return U();case\"WFS\":return D();case\"WMS\":return O();case\"WMTS\":return x();default:throw new e(\"portal:unknown-item-type\",\"Unknown item type '${type}'\",{type:a.type})}}async function N(e){const a=e.className,r=o[a];return{constructor:await r(),properties:e.properties}}async function v(e,a){return await A(e,a)?{className:\"TileLayer\"}:{className:\"MapImageLayer\"}}async function h(e,a){const r=await E(e,a);if(\"object\"==typeof r){const{sourceJSON:e,className:a}=r,t={sourceJSON:e};return null!=r.id&&(t.layerId=r.id),{className:a||\"FeatureLayer\",properties:t}}return{className:\"GroupLayer\"}}async function I(e,r){const t=await E(e,r,async()=>{try{if(!e.url)return[];const{serverUrl:t}=await a(e.url,{sceneLayerItem:e}),s=await r.fetchServiceMetadata(t);return s?.tables??[]}catch{return[]}});if(\"object\"==typeof t){const a={};let n;if(null!=t.id?(a.layerId=t.id,n=`${e.url}/layers/${t.id}`):n=e.url,e.typeKeywords?.length)for(const r of Object.keys(s))if(e.typeKeywords.includes(r))return{className:s[r]};const c=await r.fetchServiceMetadata(n,{customParameters:await r.fetchCustomParameters(e,e=>u(e)?.customParameters)});return{className:s[c?.layerType]||\"SceneLayer\",properties:a}}if(!1===t){const a=await r.fetchServiceMetadata(e.url);if(\"Voxel\"===a?.layerType)return{className:\"VoxelLayer\"}}return{className:\"GroupLayer\"}}async function M(e){await e.load();const a=d(e,\"Map Notes\"),r=d(e,\"Markup\");if(a||r)return{className:\"MapNotesLayer\"};if(d(e,\"Route Layer\"))return{className:\"RouteLayer\"};const t=await e.fetchData();return 1===l(t)?{className:\"FeatureLayer\"}:{className:\"GroupLayer\"}}async function g(e,a){await e.load();const r=e.typeKeywords?.map(e=>e.toLowerCase())??[];if(r.includes(\"elevation 3d layer\"))return{className:\"ElevationLayer\"};if(r.includes(\"tiled imagery\"))return{className:\"ImageryTileLayer\"};const t=await a.fetchItemData(e),s=t?.layerType;if(\"ArcGISTiledImageServiceLayer\"===s)return{className:\"ImageryTileLayer\"};if(\"ArcGISImageServiceLayer\"===s)return{className:\"ImageryLayer\"};const n=await a.fetchServiceMetadata(e.url,{customParameters:await a.fetchCustomParameters(e)}),c=n.cacheType?.toLowerCase(),o=n.capabilities?.toLowerCase().includes(\"tilesonly\"),i=n.tileInfo?.format?.toLowerCase()??\"\",u=null==c&&[\"jpg\",\"jpeg\",\"png\",\"png8\",\"png24\",\"png32\",\"mixed\"].includes(i);return\"map\"===c||u||o?{className:\"ImageryTileLayer\"}:{className:\"ImageryLayer\"}}function j(){return{className:\"StreamLayer\"}}async function T(e,a){return\"object\"==typeof await E(e,a)?{className:\"VideoLayer\"}:{className:\"GroupLayer\"}}function C(){return{className:\"VectorTileLayer\"}}function G(){return{className:\"GeoJSONLayer\"}}function P(){return{className:\"IntegratedMesh3DTilesLayer\"}}function b(){return{className:\"GaussianSplatLayer\"}}function F(){return{className:\"UnsupportedLayer\"}}function K(){return{className:\"CSVLayer\"}}function V(){return{className:\"KMLLayer\"}}function W(){return{className:\"KnowledgeGraphLayer\"}}function U(){return{className:\"WCSLayer\"}}function D(){return{className:\"WFSLayer\"}}function O(){return{className:\"WMSLayer\"}}function x(){return{className:\"WMTSLayer\"}}function J(){return{className:\"StreamLayer\"}}function k(){return{className:\"GroupLayer\"}}function $(){return{className:\"MediaLayer\"}}async function A(e,a){const{tileInfo:r}=await a.fetchServiceMetadata(e.url,{customParameters:await a.fetchCustomParameters(e)});return r}async function E(e,a,t){const{url:s,type:o}=e,i=\"Feature Service\"===o;if(!s)return{};if(/\\/\\d+$/.test(s)){if(i){const t=await a.fetchServiceMetadata(s,{customParameters:await a.fetchCustomParameters(e,e=>u(e)?.customParameters)});return n(e,c()),{id:t.id,className:r(t.type),sourceJSON:t}}return{}}if(\"Video Service\"===o){const e=await a.fetchServiceMetadata(s);return!((e.layers?.length??0)>1)&&{}}await e.load();let d=await a.fetchItemData(e);if(i){const{data:r,preferredHost:t}=await y(d,s,a);n(e,t);const c=R(r);if(\"object\"==typeof c){const e=m(r,c.id);c.className=f(e?.layerType)}return c}\"Scene Service\"===o&&(d=await p(e,d,a));if(l(d)>0)return R(d);const L=await a.fetchServiceMetadata(s);return t&&(L.tables=await t()),R(L)}function R(e){return 1===l(e)&&{id:u(e)?.id}}export{L as fromItem,S as selectLayerClassPath};\n"],"names":["L","i","w","e","t","N","S","a","r","F","b","P","K","M","h","J","G","k","g","V","W","v","$","I","j","T","C","U","D","O","x","o","A","E","n","s","u","d","l","c","y","R","m","f","p"],"mappings":"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","x_google_ignoreList":[0]}