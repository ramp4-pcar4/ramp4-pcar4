{"version":3,"file":"TextureCompressionWorker-Cno5etXM.js","sources":["../../node_modules/@arcgis/core/libs/basisu/BasisUEncoder.js","../../node_modules/@arcgis/core/libs/dxtEncoder/DXTEncoder.js","../../node_modules/@arcgis/core/views/support/TextureCompressionWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as i}from\"../../assets.js\";function s(){return t??=(async()=>{const s=await import(\"../../chunks/basis_encoder.js\"),t=await s.default({locateFile:s=>i(`esri/libs/basisu/${s}`)});return t.initializeBasis(),t})(),t}let t;function a(){t=null}export{a as destroyBasisEncoder,s as getBasisEncoder};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return n??=(async()=>{const e=await import(\"../../chunks/dxt_encoder.js\");return await e.default({locateFile:e=>t(`esri/libs/dxtEncoder/${e}`)})})(),n}let n;function r(){n=null}export{r as destroyDXTEncoder,e as getDXTEncoder};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{getBasisEncoder as e,destroyBasisEncoder as t}from\"../../libs/basisu/BasisUEncoder.js\";import{getDXTEncoder as n,destroyDXTEncoder as r}from\"../../libs/dxtEncoder/DXTEncoder.js\";import{CompressedTextureFormat as a}from\"../webgl/enums.js\";let l,s,i=null,o=null;class u{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}function c(){i=null,l=null,o=null,s=null,t(),r()}async function h(e){let t;t=e.data instanceof ImageBitmap?w(e.data):y(e.data,e.width,e.height,e.components,e.needsFlip);try{if(e.hasS3TC){o||await d();const n=new Uint8Array(t.length);if(o?.encode(t,e.width,e.height,e.preMultiplyAlpha,n)){const e=U(n,!0),t=[n.buffer];return{result:new u(e?.internalFormat??null,e?.textureData??null),transferList:t}}return{result:new u(null,null)}}if(e.hasETC){if(i||await f(),e.preMultiplyAlpha&&!o&&await d(),e.preMultiplyAlpha){const n=new Uint8ClampedArray(t.length);o?.premultiply(new Uint8Array(t),e.width,e.height,n),t=n}const n=p(t,e.width,e.height,e.hasMipmap),r=n?m(n):null,a=r?.compressedTexture?.levels.map(e=>e.buffer)||[];return{result:new u(r?.internalFormat??null,r?.compressedTexture??null),transferList:a}}return{result:new u(null,null)}}finally{t instanceof ImageBitmap&&t.close()}}async function f(){i||(i=await(l??=e()),l=null)}async function d(){o||(o=await(s??=n()),s=null)}function p(e,t,n,r,a=255,l=0,s=!1,o=!1){if(!i)return null;const u=new i.BasisEncoder;u.setPerceptual(!o),u.setCheckForAlpha(!0),u.setForceAlpha(!1),u.setRenormalize(o),u.setMipGen(r),u.setMipSRGB(!o),u.setCreateKTX2File(!0),u.setKTX2SRGBTransferFunc(!o),u.setQualityLevel(a),u.setCompressionLevel(l);const c=new Uint8Array(e.byteLength);u.setSliceSourceImage(0,new Uint8Array(e),t,n,s);const h=u.encode(c),f=new Uint8Array(c.buffer,0,h),d=new i.KTX2File(new Uint8Array(f));return d.isValid()?(u.delete(),f):(d.close(),d.delete(),u.delete(),null)}function m(e){if(!i)return new u(null,null);const t=new i.KTX2File(new Uint8Array(e));t.startTranscoding();const[n,r]=t.getHasAlpha()?[1,a.COMPRESSED_RGBA8_ETC2_EAC]:[0,a.COMPRESSED_RGB8_ETC2],l=t.getLevels(),s=[];for(let a=0;a<l;a++)s.push(new Uint8Array(t.getImageTranscodedSizeInBytes(a,0,0,n))),t.transcodeImage(s[a],a,0,0,n,0,-1,-1);return t.close(),t.delete(),{internalFormat:r,compressedTexture:{type:\"compressed\",levels:s}}}function w(e){const t=new OffscreenCanvas(e.width,e.height),n=t.getContext(\"2d\");n.drawImage(e,0,0);return n.getImageData(0,0,t.width,t.height).data}function y(e,t,n,r,a){const l=new Uint8ClampedArray(e).subarray(0,t*n*r);if(!a)return l;const s=new Uint8ClampedArray(l.length),i=t*r;for(let o=0;o<n;o++){const e=o*i,t=(n-o-1)*i;s.set(l.subarray(e,e+i),t)}return s}const T=31,A=1,g=2,C=3,E=4,S=7,b=21,_=131072;function D(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const M=D(\"DXT1\"),X=D(\"DXT3\"),R=D(\"DXT5\");function U(e,t){const n=new Int32Array(e.buffer,e.byteOffset,T);let r,l;switch(n[b]){case M:r=8,l=a.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case X:r=16,l=a.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case R:r=16,l=a.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let s=1,i=n[E],o=n[C];(3&i||3&o)&&(i=i+3&-4,o=o+3&-4);const u=i,c=o;let h,f;n[g]&_&&!1!==t&&(s=Math.max(1,n[S]));let d=e.byteOffset+n[A]+4;const p=[];for(let a=0;a<s;++a)f=(i+3>>2)*(o+3>>2)*r,h=new Uint8Array(e.buffer,d,f),p.push(h),d+=f,i=Math.max(1,i>>1),o=Math.max(1,o>>1);return{textureData:{type:\"compressed\",levels:p},internalFormat:l,width:u,height:c}}export{u as TextureCompressionWorkerOutput,h as compress,p as compressRGBADataToKTX2,m as createTextureDataKTX2,c as destroy,f as initializeBasisEncoder,d as initializeDXTEncoder};\n"],"names":["s","t","i","a","e","n","r","l","o","u","c","h","w","y","d","U","f","p","m","T","A","g","C","E","S","b","_","D","M","X","R"],"mappings":";;AAI8C,SAASA,IAAG;AAAC,SAAOC,OAAK,YAAS;AAAC,UAAMD,IAAE,MAAM,OAAO,6BAA+B,GAAEC,IAAE,MAAMD,EAAE,QAAQ,EAAC,YAAW,CAAAA,MAAGE,EAAE,oBAAoBF,CAAC,EAAE,EAAC,CAAC;AAAE,WAAOC,EAAE,gBAAe,GAAGA;AAAA,EAAC,GAAC,GAAIA;AAAC;AAAC,IAAIA;AAAE,SAASE,IAAG;AAAC,EAAAF,IAAE;AAAI;ACAnN,SAASG,IAAG;AAAC,SAAOC,OAAK,YAAqE,OAAnD,MAAM,OAAO,2BAA6B,GAAiB,QAAQ,EAAC,YAAW,OAAGJ,EAAE,wBAAwB,CAAC,EAAE,EAAC,CAAC,MAAMI;AAAC;AAAC,IAAIA;AAAE,SAASC,IAAG;AAAC,EAAAD,IAAE;AAAI;ACAU,IAAIE,GAAEP,GAAEE,IAAE,MAAKM,IAAE;AAAK,MAAMC,EAAC;AAAA,EAAC,YAAY,GAAER,GAAE;AAAC,SAAK,iBAAe,GAAE,KAAK,oBAAkBA;AAAA,EAAC;AAAC;AAAC,SAASS,IAAG;AAAC,EAAAR,IAAE,MAAKK,IAAE,MAAKC,IAAE,MAAKR,IAAE,MAAKC,EAAC,GAAGK,EAAC;AAAE;AAAC,eAAeK,EAAEP,GAAE;AAAC,MAAIH;AAAE,EAAAA,IAAEG,EAAE,gBAAgB,cAAYQ,EAAER,EAAE,IAAI,IAAES,EAAET,EAAE,MAAKA,EAAE,OAAMA,EAAE,QAAOA,EAAE,YAAWA,EAAE,SAAS;AAAE,MAAG;AAAC,QAAGA,EAAE,SAAQ;AAAC,MAAAI,KAAG,MAAMM,EAAC;AAAG,YAAM,IAAE,IAAI,WAAWb,EAAE,MAAM;AAAE,UAAGO,GAAG,OAAOP,GAAEG,EAAE,OAAMA,EAAE,QAAOA,EAAE,kBAAiB,CAAC,GAAE;AAAC,cAAMA,IAAEW,EAAE,GAAE,EAAE,GAAEd,IAAE,CAAC,EAAE,MAAM;AAAE,eAAM,EAAC,QAAO,IAAIQ,EAAEL,GAAG,kBAAgB,MAAKA,GAAG,eAAa,IAAI,GAAE,cAAaH,EAAC;AAAA,MAAC;AAAC,aAAM,EAAC,QAAO,IAAIQ,EAAE,MAAK,IAAI,EAAC;AAAA,IAAC;AAAC,QAAGL,EAAE,QAAO;AAAC,UAAGF,KAAG,MAAMc,EAAC,GAAGZ,EAAE,oBAAkB,CAACI,KAAG,MAAMM,EAAC,GAAGV,EAAE,kBAAiB;AAAC,cAAMC,IAAE,IAAI,kBAAkBJ,EAAE,MAAM;AAAE,QAAAO,GAAG,YAAY,IAAI,WAAWP,CAAC,GAAEG,EAAE,OAAMA,EAAE,QAAOC,CAAC,GAAEJ,IAAEI;AAAA,MAAC;AAAC,YAAM,IAAEY,EAAEhB,GAAEG,EAAE,OAAMA,EAAE,QAAOA,EAAE,SAAS,GAAEE,IAAE,IAAEY,EAAE,CAAC,IAAE,MAAKf,IAAEG,GAAG,mBAAmB,OAAO,IAAI,CAAAF,MAAGA,EAAE,MAAM,KAAG,CAAA;AAAG,aAAM,EAAC,QAAO,IAAIK,EAAEH,GAAG,kBAAgB,MAAKA,GAAG,qBAAmB,IAAI,GAAE,cAAaH,EAAC;AAAA,IAAC;AAAC,WAAM,EAAC,QAAO,IAAIM,EAAE,MAAK,IAAI,EAAC;AAAA,EAAC,UAAC;AAAQ,IAAAR,aAAa,eAAaA,EAAE;EAAO;AAAC;AAAC,eAAee,IAAG;AAAC,EAAAd,MAAIA,IAAE,OAAMK,MAAIH,EAAC,IAAIG,IAAE;AAAK;AAAC,eAAeO,IAAG;AAAC,EAAAN,MAAIA,IAAE,OAAMR,MAAIK,MAAKL,IAAE;AAAK;AAAC,SAASiB,EAAEb,GAAEH,GAAE,GAAEK,GAAEH,IAAE,KAAII,IAAE,GAAEP,IAAE,IAAGQ,IAAE,IAAG;AAAC,MAAG,CAACN,EAAE,QAAO;AAAK,QAAMO,IAAE,IAAIP,EAAE;AAAa,EAAAO,EAAE,cAAc,CAACD,CAAC,GAAEC,EAAE,iBAAiB,EAAE,GAAEA,EAAE,cAAc,EAAE,GAAEA,EAAE,eAAeD,CAAC,GAAEC,EAAE,UAAUH,CAAC,GAAEG,EAAE,WAAW,CAACD,CAAC,GAAEC,EAAE,kBAAkB,EAAE,GAAEA,EAAE,wBAAwB,CAACD,CAAC,GAAEC,EAAE,gBAAgBN,CAAC,GAAEM,EAAE,oBAAoBF,CAAC;AAAE,QAAM,IAAE,IAAI,WAAWH,EAAE,UAAU;AAAE,EAAAK,EAAE,oBAAoB,GAAE,IAAI,WAAWL,CAAC,GAAEH,GAAE,GAAED,CAAC;AAAE,QAAMW,IAAEF,EAAE,OAAO,CAAC,GAAEO,IAAE,IAAI,WAAW,EAAE,QAAO,GAAEL,CAAC,GAAEG,IAAE,IAAIZ,EAAE,SAAS,IAAI,WAAWc,CAAC,CAAC;AAAE,SAAOF,EAAE,QAAO,KAAIL,EAAE,OAAM,GAAGO,MAAIF,EAAE,SAAQA,EAAE,OAAM,GAAGL,EAAE,OAAM,GAAG;AAAK;AAAC,SAASS,EAAEd,GAAE;AAAC,MAAG,CAACF,EAAE,QAAO,IAAIO,EAAE,MAAK,IAAI;AAAE,QAAMR,IAAE,IAAIC,EAAE,SAAS,IAAI,WAAWE,CAAC,CAAC;AAAE,EAAAH,EAAE,iBAAgB;AAAG,QAAK,CAAC,GAAEK,CAAC,IAAEL,EAAE,YAAW,IAAG,CAAC,GAAEE,EAAE,yBAAyB,IAAE,CAAC,GAAEA,EAAE,oBAAoB,GAAEI,IAAEN,EAAE,UAAS,GAAG,IAAE;AAAG,WAAQE,IAAE,GAAEA,IAAEI,GAAEJ,IAAI,GAAE,KAAK,IAAI,WAAWF,EAAE,8BAA8BE,GAAE,GAAE,GAAE,CAAC,CAAC,CAAC,GAAEF,EAAE,eAAe,EAAEE,CAAC,GAAEA,GAAE,GAAE,GAAE,GAAE,GAAE,IAAG,EAAE;AAAE,SAAOF,EAAE,MAAK,GAAGA,EAAE,OAAM,GAAG,EAAC,gBAAeK,GAAE,mBAAkB,EAAC,MAAK,cAAa,QAAO,EAAC,EAAC;AAAC;AAAC,SAASM,EAAER,GAAE;AAAC,QAAMH,IAAE,IAAI,gBAAgBG,EAAE,OAAMA,EAAE,MAAM,GAAE,IAAEH,EAAE,WAAW,IAAI;AAAE,WAAE,UAAUG,GAAE,GAAE,CAAC,GAAS,EAAE,aAAa,GAAE,GAAEH,EAAE,OAAMA,EAAE,MAAM,EAAE;AAAI;AAAC,SAASY,EAAET,GAAEH,GAAE,GAAEK,GAAEH,GAAE;AAAC,QAAMI,IAAE,IAAI,kBAAkBH,CAAC,EAAE,SAAS,GAAEH,IAAE,IAAEK,CAAC;AAAE,MAAG,CAACH,EAAE,QAAOI;AAAE,QAAMP,IAAE,IAAI,kBAAkBO,EAAE,MAAM,GAAE,IAAEN,IAAEK;AAAE,WAAQE,IAAE,GAAEA,IAAE,GAAEA,KAAI;AAAC,UAAMJ,IAAEI,IAAE,GAAEP,KAAG,IAAEO,IAAE,KAAG;AAAE,IAAAR,EAAE,IAAIO,EAAE,SAASH,GAAEA,IAAE,CAAC,GAAEH,CAAC;AAAA,EAAC;AAAC,SAAOD;AAAC;AAAC,MAAMmB,IAAE,IAAGC,IAAE,GAAEC,IAAE,GAAEC,IAAE,GAAEC,IAAE,GAAEC,IAAE,GAAEC,IAAE,IAAGC,IAAE;AAAO,SAASC,EAAEvB,GAAE;AAAC,SAAOA,EAAE,WAAW,CAAC,KAAGA,EAAE,WAAW,CAAC,KAAG,MAAIA,EAAE,WAAW,CAAC,KAAG,OAAKA,EAAE,WAAW,CAAC,KAAG;AAAG;AAAC,MAAMwB,IAAED,EAAE,MAAM,GAAEE,IAAEF,EAAE,MAAM,GAAEG,IAAEH,EAAE,MAAM;AAAE,SAASZ,EAAEX,GAAEH,GAAE;AAAC,QAAM,IAAE,IAAI,WAAWG,EAAE,QAAOA,EAAE,YAAWe,CAAC;AAAE,MAAIb,GAAEC;AAAE,UAAO,EAAEkB,CAAC;IAAG,KAAKG;AAAE,MAAAtB,IAAE,GAAEC,IAAEJ,EAAE;AAA6B;AAAA,IAAM,KAAK0B;AAAE,MAAAvB,IAAE,IAAGC,IAAEJ,EAAE;AAA8B;AAAA,IAAM,KAAK2B;AAAE,MAAAxB,IAAE,IAAGC,IAAEJ,EAAE;AAA8B;AAAA,IAAM;AAAQ,aAAO;AAAA,EAAI;AAAC,MAAI,IAAE,GAAED,IAAE,EAAEqB,CAAC,GAAEf,IAAE,EAAEc,CAAC;AAAE,GAAC,IAAEpB,KAAG,IAAEM,OAAKN,IAAEA,IAAE,IAAE,IAAGM,IAAEA,IAAE,IAAE;AAAI,QAAMC,IAAEP,GAAE,IAAEM;AAAE,MAAIG,GAAEK;AAAE,IAAEK,CAAC,IAAEK,KAAQzB,MAAL,OAAS,IAAE,KAAK,IAAI,GAAE,EAAEuB,CAAC,CAAC;AAAG,MAAIV,IAAEV,EAAE,aAAW,EAAEgB,CAAC,IAAE;AAAE,QAAMH,IAAE;AAAG,WAAQd,IAAE,GAAEA,IAAE,GAAE,EAAEA,EAAE,CAAAa,KAAGd,IAAE,KAAG,MAAIM,IAAE,KAAG,KAAGF,GAAEK,IAAE,IAAI,WAAWP,EAAE,QAAOU,GAAEE,CAAC,GAAEC,EAAE,KAAKN,CAAC,GAAEG,KAAGE,GAAEd,IAAE,KAAK,IAAI,GAAEA,KAAG,CAAC,GAAEM,IAAE,KAAK,IAAI,GAAEA,KAAG,CAAC;AAAE,SAAM,EAAC,aAAY,EAAC,MAAK,cAAa,QAAOS,EAAC,GAAE,gBAAeV,GAAE,OAAME,GAAE,QAAO,EAAC;AAAC;","x_google_ignoreList":[0,1,2]}