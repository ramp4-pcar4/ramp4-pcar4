import{bP as f,O as w,bJ as y,ai as p,av as h,fc as o,ax as m,_ as V,Y as _}from"./main-CSjwO60s.js";import{b as v}from"./LayerView2D-D_-BpxcP.js";import{i as g}from"./GraphicContainer-Db3U58dc.js";import{O as d}from"./GraphicsView2D-s8uCM1cW.js";import{d as C}from"./LayerView-DBq501tj.js";import{r as b}from"./highlightOptionsUtils-D6RCaXjG.js";const u="sublayers",l="layerView";let c=class extends v(C){*graphicsViews(){this._graphicsViewsFeatureCollectionMap==null?this._graphicsViews==null?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(e,a){return Array.from(this.graphicsViews(),s=>{const t=s.hitTest(e);if(this._graphicsViewsFeatureCollectionMap!=null){const r=this._graphicsViewsFeatureCollectionMap.get(s);for(const i of t)!i.popupTemplate&&r.popupTemplate&&(i.popupTemplate=r.popupTemplate),i.sourceLayer=i.layer=this.layer}return t}).flat().map(s=>({type:"graphic",graphic:s,layer:this.layer,mapPoint:e}))}highlight(e,a){let s;typeof e=="number"?s=[e]:e instanceof f?s=[e.uid]:Array.isArray(e)&&e.length>0?s=typeof e[0]=="number"?e:e.map(i=>i&&i.uid):w.isCollection(e)&&(s=e.map(i=>i&&i.uid).toArray());const t=s?.filter(y);if(!t?.length)return p();const r=b(a);return this._addHighlights(t,r),p(()=>this._removeHighlights(t,r))}update(e){for(const a of this.graphicsViews())a.processUpdate(e)}attach(){const e=this.view,a=()=>this.requestUpdate(),s=this.layer.featureCollections;if(s!=null&&s.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const t of s){const r=new g(this.view.featuresTilingScheme),i=new d({view:e,graphics:t.source,renderer:t.renderer,requestUpdateCallback:a,container:r});this._graphicsViewsFeatureCollectionMap.set(i,t),this.container.addChild(i.container),this.addHandles([h(()=>t.visible,n=>i.container.visible=n,o),h(()=>i.updating,()=>this.notifyChange("updating"),o)],l)}this._processHighlight()}else this.layer.sublayers!=null&&this.addHandles(m(()=>this.layer.sublayers,"change",()=>this._createGraphicsViews(),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),u)}detach(){this._destroyGraphicsViews(),this.removeHandles(u)}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(l);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),this.layer.sublayers==null)return;const e=[],a=this.view,s=()=>this.requestUpdate();for(const t of this.layer.sublayers){const r=new g(this.view.featuresTilingScheme);r.fadeTransitionEnabled=!0;const i=new d({view:a,graphics:t.graphics,requestUpdateCallback:s,container:r});this.addHandles([t.on("graphic-update",i.graphicUpdateHandler),h(()=>t.visible,n=>i.container.visible=n,o),h(()=>i.updating,()=>this.notifyChange("updating"),o)],l),this.container.addChild(i.container),e.push(i)}this._graphicsViews=e,this._processHighlight()}_processHighlight(){const e=this._getHighlights();for(const a of this._graphicsViews||[])a.setHighlight(e);this._graphicsViewsFeatureCollectionMap?.forEach((a,s)=>{s.setHighlight(e)})}};c=V([_("esri.views.2d.layers.MapNotesLayerView2D")],c);const H=c;export{H as default};
