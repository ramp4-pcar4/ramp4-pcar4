import{_ as f,X as b,Y as z,dy as se,bH as re,Z as ae,cl as v,fY as w,a5 as oe,a6 as ne,cy as B,aJ as j,al as k,i as L,s as u,kT as N,V as le,a9 as V,aa as ce}from"./main-CSjwO60s.js";import{a as pe}from"./Cyclical-Bzwh_QaL.js";import{Y as _,E as n,G as C,T as S,N as X,S as he,O as Y}from"./enums-DDJfd4_p.js";let D=class extends se{constructor(t){super(t),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(t){return t!=null&&this.row===t.row&&this.rows===t.rows&&this.column===t.column&&this.columns===t.columns}};f([b({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"row",void 0),f([b({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"column",void 0),f([b({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"rows",void 0),f([b({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"columns",void 0),D=f([z("esri.CameraLayout")],D);const K=D;let R=class extends re(ae){constructor(...t){super(...t),this.position=new v([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new K}normalizeCtorArgs(t,e,i,r){if(t&&typeof t=="object"&&("x"in t||Array.isArray(t))){const s={position:t};return e!=null&&(s.heading=e),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return t}writePosition(t,e,i,r){const s=t.clone();s.x=w(t.x||0),s.y=w(t.y||0),s.z=t.hasZ?w(t.z||0):t.z,e[i]=s.write({},r)}readPosition(t,e){const i=new v;return i.read(t,e),i.x=w(i.x||0),i.y=w(i.y||0),i.z=i.hasZ?w(i.z||0):i.z,i}equals(t){return t!=null&&this.tilt===t.tilt&&this.heading===t.heading&&this.fov===t.fov&&this.position.equals(t.position)&&this.layout.equals(t.layout)}};f([b({type:v,json:{write:{isRequired:!0}}})],R.prototype,"position",void 0),f([oe("position")],R.prototype,"writePosition",null),f([ne("position")],R.prototype,"readPosition",null),f([b({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),B(t=>pe.normalize(w(t)))],R.prototype,"heading",void 0),f([b({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),B(t=>j(w(t),-180,180))],R.prototype,"tilt",void 0),f([b({type:Number,nonNullable:!0,json:{default:55,write:!0}}),B(t=>j(w(t,55),1,170))],R.prototype,"fov",void 0),f([b({type:K,nonNullable:!0,json:{read:!1,write:!1}})],R.prototype,"layout",void 0),R=f([z("esri.Camera")],R);const ue=R,de=()=>L.getLogger("esri.views.webgl.checkWebGLError");function W(t){switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const q=!!k("enable-feature:webgl-debug");function H(){return q}function me(){return q}function A(t,e=H()){if(e){const i=W(t);if(i){const r=new Error().stack;de().error(new u("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}function _e(t,e,i,r=0){const s=t.gl;t.bindBuffer(i);for(const a of i.layout){const l=e.get(a.name);if(l==null){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=r*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&s.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let o=0;o<3;o++)s.vertexAttribPointer(l+o,3,a.type,a.normalized,a.stride,a.offset+12*o+c),s.enableVertexAttribArray(l+o),a.divisor>0&&s.vertexAttribDivisor(l+o,a.divisor);else if(a.count===16)for(let o=0;o<4;o++)s.vertexAttribPointer(l+o,4,a.type,a.normalized,a.stride,a.offset+16*o+c),s.enableVertexAttribArray(l+o),a.divisor>0&&s.vertexAttribDivisor(l+o,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count);if(H()){const o=W(t.gl);o&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}:`,o,a)}}}function ge(t){switch(t){case 6406:case 6409:case 6403:case 36244:case 6402:case 34041:return 1;case 6410:case 33319:case 33320:return 2;case 6407:case 36248:return 3;case 6408:case 36249:return 4}return 0}function Z(t){switch(t){case 6406:case 6409:case 6403:case 36244:case n.R8:case n.R8I:case n.R8UI:case n.R8_SNORM:case 36168:return 1;case 6410:case 33319:case 33320:case n.RGBA4:case n.R16F:case n.R16I:case n.R16UI:case n.RG8:case n.RG8I:case n.RG8UI:case n.RG8_SNORM:case n.RGB565:case n.RGB5_A1:case S.DEPTH_COMPONENT16:return 2;case 6407:case 36248:case n.RGB8:case n.RGB8I:case n.RGB8UI:case n.RGB8_SNORM:case n.SRGB8:case S.DEPTH_COMPONENT24:return 3;case 6408:case 36249:case n.RGBA8:case n.R32F:case n.R11F_G11F_B10F:case n.RG16F:case n.R32I:case n.R32UI:case n.RG16I:case n.RG16UI:case n.RGBA8I:case n.RGBA8UI:case n.RGBA8_SNORM:case n.SRGB8_ALPHA8:case n.RGB9_E5:case n.RGB10_A2UI:case n.RGB10_A2:case S.DEPTH_COMPONENT32F:case C.DEPTH24_STENCIL8:return 4;case C.DEPTH32F_STENCIL8:return 5;case n.RGB16F:case n.RGB16I:case n.RGB16UI:return 6;case n.RG32F:case n.RG32I:case n.RG32UI:case n.RGBA16F:case n.RGBA16I:case n.RGBA16UI:return 8;case n.RGB32F:case n.RGB32I:case n.RGB32UI:return 12;case n.RGBA32F:case n.RGBA32I:case n.RGBA32UI:return 16;case _.COMPRESSED_RGB_S3TC_DXT1_EXT:case _.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case _.COMPRESSED_RGBA_S3TC_DXT3_EXT:case _.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case _.COMPRESSED_R11_EAC:case _.COMPRESSED_SIGNED_R11_EAC:case _.COMPRESSED_RGB8_ETC2:case _.COMPRESSED_SRGB8_ETC2:case _.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case _.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case _.COMPRESSED_RG11_EAC:case _.COMPRESSED_SIGNED_RG11_EAC:case _.COMPRESSED_RGBA8_ETC2_EAC:case _.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let $=class{constructor(t=0,e=t){this.width=t,this.height=e,this.type=0,this.target=3553,this.pixelFormat=6408,this.dataType=X.UNSIGNED_BYTE,this.samplingMode=9729,this.wrapMode=10497,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}};function xe(t){return t.width<=0||t.height<=0||t.depth<=0?0:Math.round(t.width*t.height*t.depth*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:Z(t.internalFormat))*(t.target===34067?6:1))}const F=()=>L.getLogger("esri/views/webgl/textureUtils");function P(t){const{width:e,height:i,depth:r}=t;(e!=null&&e<0||i!=null&&i<0||r!=null&&r<0)&&F().error("Negative dimension parameters are not allowed!");const{internalFormat:s}=t;if(s&&(J(s)||Q(s))){const{linearFilterDepth:a,compareEnabled:l,samplingMode:c,hasMipmap:o}=t;o&&F().error("Depth textures cannot have mipmaps"),a?c!==9729&&c!==9728&&F().error("Depth textures cannot sample mipmaps"):(c!==9728&&F().error("Depth textures without filtering must use NEAREST filtering"),l&&F().error("Depth textures without filtering cannot use compare function"))}}function Te(t){return he.includes(t)}function J(t){return N(S,t)}function Q(t){return N(C,t)}function fe(t){return t!=null&&N(_,t)}function I(t){return t!=null&&"type"in t&&t.type==="compressed"}function Ee(t){return t!=null&&"byteLength"in t}function ee(t){return t!=null&&!I(t)&&!Ee(t)}function y(t){return t===32879||t===35866}function te(t,e,i,r=1){let s=Math.max(e,i);return t===32879&&(s=Math.max(s,r)),Math.floor(Math.log2(s))+1}function O(t){if(t.internalFormat!=null)return t.internalFormat;switch(t.dataType){case X.FLOAT:switch(t.pixelFormat){case 6408:return n.RGBA32F;case 6407:return n.RGB32F;default:throw new u("texture:unknown-format","Unable to derive format")}case X.UNSIGNED_BYTE:switch(t.pixelFormat){case 6408:return n.RGBA8;case 6407:return n.RGB8}}const{pixelFormat:e}=t;return t.internalFormat=e===34041?C.DEPTH24_STENCIL8:e===6402?S.DEPTH_COMPONENT24:e,t.internalFormat}function Re(t){let e="width"in t?t.width:t.codedWidth,i="height"in t?t.height:t.codedHeight;return t instanceof HTMLVideoElement&&(e=t.videoWidth,i=t.videoHeight),{width:e,height:i,depth:1}}class G extends ${constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case n.R16F:case n.R32F:case n.R8_SNORM:case n.R8:this.pixelFormat=6403;break;case n.R8I:case n.R8UI:case n.R16I:case n.R16UI:case n.R32I:case n.R32UI:this.pixelFormat=36244}}static validate(e,i){return new G(e,i)}}const be=!!k("esri-tests-disable-gpu-memory-measurements"),M=()=>L.getLogger("esri/views/webgl/Texture");let we=class T{static{this.TEXTURE_UNIT_FOR_UPDATES=0}static{this.compressionWorkerHandle=null}constructor(e,i=null,r=null){if(this.type=1,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const s=G.validate(e,i);if(!s)throw new u("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=s}this._descriptor.target===34067?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return be?0:xe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){this.abortCompression(),this.hasWebGLTextureObject&&this._descriptor.context?.gl&&(this._descriptor.context.instanceCounter.decrement(Y.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor=null)}release(){this.dispose()}[Symbol.dispose](){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new u("texture:immutable-resize","Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===34067?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!I(e)&&this._descriptor.internalFormat&&N(_,this._descriptor.internalFormat)&&(this._descriptor.internalFormat=void 0),this._setData(e),!I(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(e,i,r,s,a,l,c=0){l||M().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||M().error("An attempt to update uninitialized texture!");const o=this._descriptor;o.internalFormat=O(o);const{context:p,pixelFormat:h,dataType:g,target:d,isImmutable:m}=o;if(m&&!this._wasImmutablyAllocated)throw new u("texture:uninitialized","Cannot update immutable texture before allocation!");const E=p.bindTexture(this,T.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>o.width||r+a>o.height)&&M().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:x}=p;c&&(s&&a||M().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),x.pixelStorei(x.UNPACK_SKIP_ROWS,c)),ee(l)?x.texSubImage2D(d,e,i,r,s,a,h,g,l):I(l)?x.compressedTexSubImage2D(d,e,i,r,s,a,o.internalFormat,l.levels[e]):x.texSubImage2D(d,e,i,r,s,a,h,g,l),c&&x.pixelStorei(x.UNPACK_SKIP_ROWS,0),p.bindTexture(E,T.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,a,l,c,o){o||M().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||M().error("An attempt to update an uninitialized texture!");const p=this._descriptor;p.internalFormat=O(p);const{context:h,pixelFormat:g,dataType:d,isImmutable:m,target:E}=p;if(m&&!this._wasImmutablyAllocated)throw new u("texture:uninitialized","Cannot update immutable texture before allocation!");y(E)||M().warn("Attempting to set 3D texture data on a non-3D texture");const x=h.bindTexture(this,T.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(T.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+a>p.width||r+l>p.height||s+c>p.depth)&&M().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:U}=h;if(I(o))o=o.levels[e],U.compressedTexSubImage3D(E,e,i,r,s,a,l,c,p.internalFormat,o);else{const ie=o;U.texSubImage3D(E,e,i,r,s,a,l,c,g,d,ie)}h.bindTexture(x,T.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(e.width===0||e.height===0)return;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new u("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,P(e)}e.samplingMode===9729?(this._samplingModeDirty=!0,e.samplingMode=9985):e.samplingMode===9728&&(this._samplingModeDirty=!0,e.samplingMode=9984);const i=this._descriptor.context.bindTexture(this,T.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(T.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,T.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new u("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,P(e)}e.samplingMode===9985?(this._samplingModeDirty=!0,e.samplingMode=9729):e.samplingMode===9984&&(this._samplingModeDirty=!0,e.samplingMode=9728)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,P(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?9729:9728),P(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=le(this._compressionAbortController)}_setData(e,i){const r=this._descriptor,s=r.context?.gl;if(!s)return;A(s),this.hasWebGLTextureObject||(this._glName=s.createTexture(),r.context.instanceCounter.increment(Y.Texture,this)),P(r);const a=r.context.bindTexture(this,T.TEXTURE_UNIT_FOR_UPDATES);r.context.setActiveTexture(T.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),A(s);const l=i??r.target,c=y(l);if(ee(e))this._setDataFromTexImageSource(e,l);else{const{width:o,height:p,depth:h}=r;if(o==null||p==null)throw new u("texture:missing-size","Width and height must be specified!");if(c&&h==null)throw new u("texture:missing-depth","Depth must be specified!");if(r.internalFormat=O(r),r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,r.internalFormat,r.hasMipmap,o,p,h),I(e)){if(!fe(r.internalFormat))throw new u("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(e,r.internalFormat,l)}else this._texImage(l,0,r.internalFormat,o,p,h,e),A(s),r.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),A(s),r.context.bindTexture(a,T.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let i=34069;i<=34074;i++)this._setData(e,i)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_setDataFromTexImageSource(e,i){const{gl:r}=this._descriptor.context,s=this._descriptor;s.internalFormat=O(s);const a=y(i),{width:l,height:c,depth:o}=Re(e);s.width&&s.height,s.width||(s.width=l),s.height||(s.height=c),a&&s.depth,a&&(s.depth=o),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,s.internalFormat,s.hasMipmap,l,c,o),this._texImage(i,0,s.internalFormat,l,c,o,e),A(r),s.hasMipmap&&(this.generateMipmap(),A(r))}_setDataFromCompressedSource(e,i,r){const s=this._descriptor,{width:a,height:l,depth:c}=s,o=e.levels,p=te(r,a,l,c),h=Math.min(p,o.length)-1;this._descriptor.context.gl.texParameteri(s.target,33085,h),this._forEachMipmapLevel((g,d,m,E)=>{const x=o[Math.min(g,o.length-1)];this._compressedTexImage(r,g,i,d,m,E,x)},h)}_texStorage(e,i,r,s,a,l){const{gl:c}=this._descriptor.context;if(!Te(i)&&!J(i)&&!Q(i))throw new u("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const o=r?te(e,s,a,l):1;if(y(e)){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");c.texStorage3D(e,o,i,s,a,l)}else c.texStorage2D(e,o,i,s,a);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,a,l,c){const o=this._descriptor.context.gl,p=y(e),{isImmutable:h,pixelFormat:g,dataType:d}=this._descriptor;if(h){if(c!=null){const m=c;if(p){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");o.texSubImage3D(e,i,0,0,0,s,a,l,g,d,m)}else o.texSubImage2D(e,i,0,0,s,a,g,d,m)}}else{const m=c;if(p){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");o.texImage3D(e,i,r,s,a,l,0,g,d,m)}else o.texImage2D(e,i,r,s,a,0,g,d,m)}}_compressedTexImage(e,i,r,s,a,l,c){const o=this._descriptor.context.gl,p=y(e);if(this._descriptor.isImmutable){if(c!=null)if(p){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");o.compressedTexSubImage3D(e,i,0,0,0,s,a,l,r,c)}else o.compressedTexSubImage2D(e,i,0,0,s,a,r,c)}else if(p){if(l==null)throw new u("texture:missing-depth","Missing depth dimension for 3D texture upload");o.compressedTexImage3D(e,i,r,s,a,l,0,c)}else o.compressedTexImage2D(e,i,r,s,a,0,c)}async _compressOnWorker(e){const{width:i,height:r,context:s,flipped:a,preMultiplyAlpha:l,hasMipmap:c}=this._descriptor,o=this._descriptor.compress?.compressionTracker,p=this._descriptor.compress?.compressionCallback,{compressedTextureETC:h,compressedTextureS3TC:g}=s.capabilities;if(!T.compressionWorkerHandle?.isCompressible(e,this._descriptor)||!h&&!g)return;this.abortCompression();const d=new AbortController;let m;this._compressionAbortController=d,o?.increment();try{e instanceof Uint8Array?m=e.buffer:(m=await createImageBitmap(e,{imageOrientation:a?"flipY":"none"}),V(d));const E={data:m,width:i,height:r,needsFlip:e instanceof Uint8Array&&this.descriptor.flipped,components:this._descriptor.pixelFormat===6408?4:3,preMultiplyAlpha:l,hasMipmap:c,hasETC:!!h,hasS3TC:!!g},x=await T.compressionWorkerHandle.invoke(E,d.signal,"low");if(V(d),x.compressedTexture&&this.hasWebGLTextureObject){const U=this.usedMemory;this._descriptor.internalFormat=x.internalFormat,this._setData(x.compressedTexture),p?.(U-this.usedMemory)}}catch(E){ce(E)||M().error("Texture compression failed!")}finally{o?.decrement(),this._compressionAbortController?.signal.aborted&&(this._compressionAbortController=null),m instanceof ImageBitmap&&m.close()}}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:a,hasMipmap:l,target:c}=this._descriptor;const o=c===32879;if(r==null||s==null||o&&a==null)throw new u("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let p=0;e(p,r,s,a),l&&(r!==1||s!==1||o&&a!==1)&&!(p>=i);++p)r=Math.max(1,r>>1),s=Math.max(1,s>>1),o&&(a=Math.max(1,a>>1))}_applySamplingMode(){const e=this._descriptor,i=e.context?.gl;let r=e.samplingMode,s=e.samplingMode;r===9985||r===9987?(r=9729,e.hasMipmap||(s=9729)):r!==9984&&r!==9986||(r=9728,e.hasMipmap||(s=9728)),i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,r),i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,s)}_applyWrapMode(){const e=this._descriptor,i=e.context?.gl;typeof e.wrapMode=="number"?(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode)):(i.texParameteri(e.target,i.TEXTURE_WRAP_S,e.wrapMode.s),i.texParameteri(e.target,i.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){const e=this._descriptor,i=e.context?.gl,r=e.compareEnabled?i.COMPARE_REF_TO_TEXTURE:i.NONE;i.texParameteri(e.target,i.TEXTURE_COMPARE_MODE,r),e.compareEnabled&&i.texParameteri(e.target,i.TEXTURE_COMPARE_FUNC,i.GREATER),A(i)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,i=e.context.capabilities.textureFilterAnisotropic;i&&e.context.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};export{we as A,_e as R,Z as _,H as a,G as b,me as c,ue as d,$ as h,ge as n,W as t,A as u};
