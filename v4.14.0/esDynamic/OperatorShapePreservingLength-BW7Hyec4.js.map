{"version":3,"file":"OperatorShapePreservingLength-BW7Hyec4.js","sources":["../../node_modules/@arcgis/core/chunks/OperatorShapePreservingLength.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{a as e,G as t,f as s,d as n}from\"./Geometry.js\";import{a8 as o,G as r,r as a,x as i,a9 as m}from\"./UnitFactory.js\";import{a as c,P as g}from\"./MultiPathImpl.js\";import{k as u,d as p,P as h}from\"./Point2D.js\";import{d as y}from\"./Envelope.js\";import{Envelope2D as l}from\"./Envelope2D.js\";import{O as f}from\"./OperatorDensify.js\";import{O as x}from\"./OperatorClip.js\";function _(){return{m_pGcs:new h,m_xyz:new y,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:d,setLength:P,assign:S}}function d(e,t,s,n){this.m_factor=e,this.m_pGcs.assign(t),this.m_xyz.assign(n),this.m_geoLength=s}function P(e){this.m_geoLength=e}function S(e){this.m_pGcs.assign(e.m_pGcs),this.m_xyz.assign(e.m_xyz),this.m_factor=e.m_factor,this.m_geoLength=e.m_geoLength}class w{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,s,n,a){if(e.hasNonLinearSegments()){e=(new f).execute(e,0,t.getTolerance(0),0,a)}if(t.isPannable()){let n=90,r=-90;if(1===s.getUnit().getUnitToBaseFactor()&&(n*=Math.PI/180,r*=Math.PI/180),2===t.getCoordinateSystemType()){let e=null;const s=[0,0,0,0];e=t.getPECoordSys(),s[0]=0,s[1]=n,s[2]=0,s[3]=r,o.geogToProj(e,2,s),n=s[1],r=s[3]}const i=new l;e.queryEnvelope(i),i.ymin=r,i.ymax=n,e=(new x).execute(e,i,t,a)}else{const s=t.getPCSHorizon();if((e=(new r).execute(e,s,t,a))===s){const t=e.clone();e=t}}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,s,n,1,a)}_ExecuteIterativeApproach(e,t,s,r,i,m){const c=a();s.querySpheroidData(c);const g=c.majorSemiAxis,l=c.e2,f=s.getUnit().getUnitToBaseFactor(),x=40,d=u(_,x),P=p(x,Number.NaN),S=_(),w=_();let E;const G=[0,0,0,0],L=t.getPECoordSys(),j=new h,v=new h,T=new h,D=new h,b=new h;let z=0;const I=e.querySegmentIterator();for(;I.nextPath();)for(;I.hasNextSegment();){const e=I.nextSegment();j.assign(e.getStartXY()),v.assign(e.getEndXY()),2===t.getCoordinateSystemType()?(G[0]=j.x,G[1]=j.y,G[2]=v.x,G[3]=v.y,o.projToGeog(L,2,G),T.x=G[0]*f,T.y=G[1]*f,D.x=G[2]*f,D.y=G[3]*f):(T.setCoordsPoint2D(j),D.setCoordsPoint2D(v),T.scale(f),D.scale(f));const s=new y,r=new y;N(g,l,T,s),N(g,l,D,r);let a=C(g,s,r);S.setValues(0,T,Number.NaN,s),w.setValues(1,D,a,r),E=i,d[0].assign(w),P[0]=i;let m=0;for(;;){m>128&&n(\"iterations exceeded\");const s=.5*(S.m_factor+w.m_factor),r=e.getCoord2D(s);2===t.getCoordinateSystemType()?(G[0]=r.x,G[1]=r.y,o.projToGeog(L,1,G),b.x=G[0]*f,b.y=G[1]*f):(b.setCoordsPoint2D(r),b.scale(f)),T.setCoordsPoint2D(S.m_pGcs),D.setCoordsPoint2D(w.m_pGcs);const c=new y;N(g,l,b,c);const u=C(g,S.m_xyz,c),p=C(g,w.m_xyz,c);a=w.m_geoLength,Number.isNaN(a)&&(a=C(g,S.m_xyz,w.m_xyz));const h=u+p,_=E===i&&h>=20&&Math.abs(h-a)>1e-8*(a+h);if(m+2<x&&(_||Math.abs(h-a)>0&&E>0))w.setLength(p),d[m].assign(w),w.setValues(s,b,u,c),d[++m].assign(w),_?(E=i,P[m]=i):(E--,P[m-1]=E,P[m]=E);else{if(z+=h,0===m)break;S.assign(w),w.assign(d[--m]),E=P[m]}}}return z}execute(n,o,r){if(o&&0!==o.getCoordinateSystemType()||e(\"\"),n.isEmpty()||n.getDimension()<1)return 0;let a=null;const m=o.getGCS();m!==o&&(a=i(o,m,null));const u=n.getGeometryType();if(u===t.enumEnvelope){const e=new c;return e.addEnvelope(n,!1),this._ExecuteShapePreservingLength(e,o,m,a,r)}if(s(u)){const e=new g;return e.addSegment(n,!0),this._ExecuteShapePreservingLength(e,o,m,a,r)}return this._ExecuteShapePreservingLength(n,o,m,a,r)}}function N(e,t,s,n){n.assign(m(e,t,s))}function C(e,t,s){const n=e,o=new y;o.setSub(t,s);const r=o.length();return 2*n*Math.asin(r/(2*n))}export{w as O};\n"],"names":["_","h","y","d","P","S","e","t","s","w","n","a","f","o","i","l","x","r","c","u","p","E","G","L","j","v","T","D","b","z","I","N","C","m","g"],"mappings":"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","x_google_ignoreList":[0]}