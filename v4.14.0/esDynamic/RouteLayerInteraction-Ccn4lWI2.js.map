{"version":3,"file":"RouteLayerInteraction-Ccn4lWI2.js","sources":["../../node_modules/@arcgis/core/views/2d/layers/support/RouteLayerInteraction.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import r from\"../../../../core/Accessor.js\";import{destroyHandle as t}from\"../../../../core/handleUtils.js\";import{destroyMaybe as o}from\"../../../../core/maybe.js\";import{watch as s,initial as i}from\"../../../../core/reactiveUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{UpdatingHandles as p}from\"../../../../core/support/UpdatingHandles.js\";import n from\"../../../../layers/GraphicsLayer.js\";import c from\"../../../../rest/support/PointBarrier.js\";import h from\"../../../../rest/support/PolygonBarrier.js\";import y from\"../../../../rest/support/PolylineBarrier.js\";import d from\"../../../../rest/support/Stop.js\";import m from\"../../../../widgets/Sketch/SketchViewModel.js\";function g(e,r){e.networkFeature=r}function u(e){const r=w(e.graphic);return{...e,networkFeature:r}}function b(e){const r=e.graphics.map(e=>w(e));return{...e,networkFeatures:r}}function w(e){return e.networkFeature}function k(e){return\"point\"===e?.type||\"polyline\"===e?.type||\"polygon\"===e?.type}let _=class extends r{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new n({internal:!0,listMode:\"hide\",title:\"RouteLayerInteraction layer\"}),this._updatingHandles=new p,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case\"update\":switch(e.state){case\"active\":case\"complete\":for(const r of e.graphics){w(r).geometry=k(r.geometry)?r.geometry.clone():null}}break;case\"undo\":case\"redo\":break;case\"delete\":for(const r of e.graphics){const e=w(r);this._removeNetworkFeature(e)}break;case\"create\":if(e.graphic&&\"complete\"===e.state&&this._createMode){const r=e.graphic.geometry?.clone(),t=e.graphic.symbol?.clone();if(!r)break;switch(this._createMode){case\"stop\":{if(\"point\"!==r.type)break;const{stops:t}=this.layer;if(t.length>0&&t.every(({geometry:e})=>!e)){t.at(0).geometry=r;break}if(t.length>1&&t.filter((e,r)=>0!==r).every(({geometry:e})=>!e)){t.at(1).geometry=r;break}const o=new d({geometry:r});t.add(o),g(e.graphic,o);break}case\"point-barrier\":{if(\"point\"!==r.type)break;const o=new c({geometry:r,symbol:t});this.layer.pointBarriers.add(o),g(e.graphic,o);break}case\"polyline-barrier\":{if(\"polyline\"!==r.type)break;const o=new y({geometry:r,symbol:t});this.layer.polylineBarriers.add(o),g(e.graphic,o);break}case\"polygon-barrier\":{if(\"polygon\"!==r.type)break;const o=new h({geometry:r,symbol:t});this.layer.polygonBarriers.add(o),g(e.graphic,o);break}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,\"create\"===e.type?u(e):b(e))}}initialize(){this._sketchViewModel=new m({layer:this._graphicsLayer,view:this.view}),this.addHandles([s(()=>this.enabled,e=>{e?this._activate():this._deactivate()},i),s(()=>{const{stops:e,pointBarriers:r,polylineBarriers:t,polygonBarriers:o}=this.layer;return{stops:e,pointBarriers:r,polylineBarriers:t,polygonBarriers:o}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on([\"create\",\"delete\",\"redo\",\"undo\",\"update\"],this._handleSketchViewModelEvents),t(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=o(this._graphicsLayer),this._sketchViewModel=o(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>w(e))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case\"stop\":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case\"point-barrier\":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case\"polyline-barrier\":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case\"polygon-barrier\":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case\"stop\":case\"point-barrier\":return this._sketchViewModel.create(\"point\");case\"polyline-barrier\":return this._sketchViewModel.create(\"polyline\");case\"polygon-barrier\":return this._sketchViewModel.create(\"polygon\")}}remove(e){const r=this._graphicsLayer.graphics.find(r=>w(r)===e);r&&this._graphicsLayer.remove(r),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(e=>e.toArray().map(e=>{const r=e.toGraphic();return r.networkFeature=e,r}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case\"stop\":this.layer.stops.remove(e);break;case\"point-barrier\":this.layer.pointBarriers.remove(e);break;case\"polyline-barrier\":this.layer.polylineBarriers.remove(e);break;case\"polygon-barrier\":this.layer.polygonBarriers.remove(e)}}};e([a()],_.prototype,\"enabled\",void 0),e([a({constructOnly:!0})],_.prototype,\"layer\",void 0),e([a({readOnly:!0})],_.prototype,\"selectedNetworkFeatures\",null),e([a()],_.prototype,\"updating\",null),e([a({constructOnly:!0})],_.prototype,\"view\",void 0),_=e([l(\"esri.views.2d.layers.support.RouteLayerInteraction\")],_);export{_ as RouteLayerInteraction};\n"],"names":["g","u","w","b","e","k","_","r","n","p","t","o","d","c","y","h","m","s","i","a","l"],"mappings":"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","x_google_ignoreList":[0]}