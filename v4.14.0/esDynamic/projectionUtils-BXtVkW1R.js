import{s as r,p as b,a9 as M}from"./main-CSjwO60s.js";import{m as l}from"./HeightModelInfo-Cjals-AI.js";import{H as k,W as I,G as R,J as U,L as T}from"./projectionUtils-CsX1UTBu.js";function H(e,t,o){const a=f(e),s=t,g=S(a,s,o);if(a){const n=l.deriveUnitFromSR(a,e.spatialReference).heightUnit;if(!o&&n!==a.heightUnit){const i=new r("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${n})`,{horizontalUnit:n});return new r("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:a,error:i})}}if(!$(e)||g===4)return new r("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:a});switch(g){case 1:{const n=a?.heightUnit||"unknown",i=s?.heightUnit||"unknown",c=new r("layerview:incompatible-height-unit",`The vertical units of the layer (${n}) must match the vertical units of the scene (${i})`,{layerUnit:n,sceneUnit:i});return new r("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:s,error:c})}case 2:{const n=a?.heightModel||"unknown",i=s?.heightModel||"unknown",c=new r("layerview:incompatible-height-model",`The height model of the layer (${n}) must match the height model of the scene (${i})`,{layerHeightModel:n,sceneHeightModel:i});return new r("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:s,error:c})}case 3:{const n=a?.vertCRS||"unknown",i=s?.vertCRS||"unknown",c=new r("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${n}) must match the vertical datum of the scene (${i})`,{layerDatum:n,sceneDatum:i});return new r("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:s,error:c})}}return null}function S(e,t,o){if(!d(e)||!d(t))return 4;if(e==null||t==null)return 0;if(!o&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}function d(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function $(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!y(e)}function f(e){if(e.type==="integrated-mesh-3dtiles"||e.type==="gaussian-splat")return null;const t=e.url?b(e.url):void 0;return!(e.spatialReference?.vcsWkid==null&&t!=null&&t.serverType==="ImageServer")&&m(e)&&e.heightModelInfo?e.heightModelInfo:y(e)?l.deriveUnitFromSR(j,e.spatialReference):null}function m(e){return"heightModelInfo"in e}function p(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function y(e){return p(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):w(e)}function C(e){return e.layers!=null||w(e)||p(e)||m(e)}function w(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"gaussian-splat":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const j=new l({heightModel:"gravity-related-height"});let h,u=null;async function D(e){u||(u=import("./geometryServiceUtils-xDNkl0XV.js").then(t=>h=t)),await u,M(e)}async function v(e,t,o,a){if(!e)return null;const s=e.spatialReference;return R()||U(s,t)?I(e,t):h?h.projectGeometry(e,t,o,a):(await Promise.race([D(a),T(a)]),v(e,t,o,a))}async function F(e,t){try{return e?.spatialReference?await k(e,t):null}catch{return null}}export{H as a,f as c,C as g,F as p,v as s};
