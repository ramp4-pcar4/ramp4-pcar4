import{s as H,ca as x,i as $,eP as I,eQ as A,eR as G}from"./main-CSjwO60s.js";import{B as J,U as K}from"./colorUtils-DlmOacVt.js";import{b as V,h as X,w as N,f as Y,d as _}from"./utils-DvP1Tc7W.js";import{u as S,t as j,s as ee,l as ae,L as te,p as se,o as le,n as ne,e as oe,c as re,m as ie}from"./previewUtils-1NSa4tp5.js";import{l as q,d as ce}from"./symbolUtils-BWODOwTq.js";import{resolveWebStyleSymbol as pe}from"./webStyleSymbolUtils-CyolzL_F.js";const L=22,P=120,D=80,T=50,E=20;function z(e){const a=e.outline,l=e.material!=null?e.material.color:null,t=l!=null?l.toHex():null;if(a==null||"pattern"in a&&a.pattern!=null&&a.pattern.type==="style"&&a.pattern.style==="none")return e.type==="fill"&&t==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const s=x(a.size)||0;return{color:"rgba("+(a.color!=null?a.color.toRgba():"255,255,255,1")+")",width:Math.min(s,D),style:"pattern"in a&&a.pattern!=null&&a.pattern.type==="style"?N(a.pattern.style):null,join:"butt",cap:"patternCap"in a?a.patternCap:"butt"}}async function ue(e,a){if(e.thumbnail?.url)return e.thumbnail.url;if(a.type==="icon"&&a?.resource?.href)return _(a);const l=I("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const t=await pe(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(t&&"thumbnail"in t&&t.thumbnail?.url)return t.thumbnail.url}return l}function F(e,a=1){const l=e.a,t=J(e),s=t.h,o=t.s/a,k=100-(100-t.v)/a,{r:g,g:m,b:i}=K({h:s,s:o,v:k});return[g,m,i,l]}function C(e){return e.type==="water"?e.color==null?null:e.color:e.material?.color==null?null:e.material.color}function r(e,a=0){const l=C(e);if(!l){if(e.type==="fill")return null;const s=V.r,o=S(s,a);return[o,o,o,100]}const t=l.toRgba();for(let s=0;s<3;s++)t[s]=S(t[s],a);return t}async function B(e,a){const l=e.style;return l==="none"?null:{type:"pattern",x:0,y:0,src:await Y(I(`esri/symbols/patterns/${l}.png`),a.toCss(!0)),width:5,height:5}}function Q(e){return e.outline?z(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function U(e,a){const l=C(e);if(!l)return null;let t="rgba(";return t+=S(l.r,a)+",",t+=S(l.g,a)+",",t+=S(l.b,a)+",",t+l.a+");"}function W(e,a){const l=e.edges;return!l||!l.color||!l.size?null:{color:l.color.toCss(!0),width:Math.min(x(l.size),a,D),join:"round"}}function Z(e,a){const l=U(e,a);if(!l||"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none")return null;const t={color:l,width:Math.min(e.size?x(e.size):.75,D)};return"pattern"in e&&e.pattern?.type==="style"&&(t.style=N(e.pattern.style)),"cap"in e&&e.cap&&(t.cap=e.cap),"join"in e&&e.join&&(t.join=e.join==="miter"?x(2):e.join),t}function O(e,a,l){const t=l!=null?.75*l:0;return{type:"linear",x1:t?.25*t:0,y1:t?.5*t:0,x2:t||4,y2:t?.5*t:4,colors:[{color:e,offset:0},{color:a,offset:1}]}}function he(e){const a=e.depth,l=e.height,t=e.width;return t!==0&&a!==0&&l!==0&&t===a&&t!=null&&l!=null&&t<l}function me(e,a,l){const t=[];if(!e)return t;switch(e.type){case"icon":{const s=a,o=a;switch(e.resource?.primitive??G){case"circle":t.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:r(e,0),stroke:z(e)});break;case"square":t.push({shape:{type:"path",path:[{command:"M",values:[0,o]},{command:"L",values:[0,0]},{command:"L",values:[s,0]},{command:"L",values:[s,o]},{command:"Z",values:[]}]},fill:r(e,0),stroke:z(e)});break;case"triangle":t.push({shape:{type:"path",path:[{command:"M",values:[0,o]},{command:"L",values:[.5*s,0]},{command:"L",values:[s,o]},{command:"Z",values:[]}]},fill:r(e,0),stroke:z(e)});break;case"cross":t.push({shape:{type:"path",path:[{command:"M",values:[.5*s,0]},{command:"L",values:[.5*s,o]},{command:"M",values:[0,.5*o]},{command:"L",values:[s,.5*o]}]},stroke:Q(e)});break;case"x":t.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[s,o]},{command:"M",values:[s,0]},{command:"L",values:[0,o]}]},stroke:Q(e)});break;case"kite":t.push({shape:{type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*s,0]},{command:"L",values:[s,.5*o]},{command:"L",values:[.5*s,o]},{command:"Z",values:[]}]},fill:r(e,0),stroke:z(e)})}break}case"object":switch(e.resource?.primitive??A){case"cone":{const s=O(r(e,0),r(e,-.6),l?E:a),o=ne(a,l);t.push({shape:o[0],fill:s},{shape:o[1],fill:s});break}case"inverted-cone":{const s=r(e,0),o=O(s,r(e,-.6),a),k=le(a);t.push({shape:k[0],fill:o},{shape:k[1],fill:s});break}case"cube":{const s=se(a,l);t.push({shape:s[0],fill:r(e,0)},{shape:s[1],fill:r(e,-.3)},{shape:s[2],fill:r(e,-.5)});break}case"cylinder":{const s=O(r(e,0),r(e,-.6),l?E:a),o=te(a,l);t.push({shape:o[0],fill:s},{shape:o[1],fill:s},{shape:o[2],fill:r(e,0)});break}case"diamond":{const s=ae(a);t.push({shape:s[0],fill:r(e,-.3)},{shape:s[1],fill:r(e,0)},{shape:s[2],fill:r(e,-.3)},{shape:s[3],fill:r(e,-.7)});break}case"sphere":{const s=O(r(e,0),r(e,-.6));s.x1=0,s.y1=0,s.x2=.25*a,s.y2=.25*a,t.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:s});break}case"tetrahedron":{const s=ee(a);t.push({shape:s[0],fill:r(e,-.3)},{shape:s[1],fill:r(e,0)},{shape:s[2],fill:r(e,-.6)});break}}break}return t}function R(e){const a=typeof e?.size=="number"?e?.size:null;return a?x(a):null}function fe(e){return e.type==="icon"?"multiply":"tint"}async function ye(e,a){const l=R(a),t=a?.maxSize?x(a.maxSize):null,s=a?.disableUpsampling??!1,o=e.symbolLayers,k=[],g=[];let m=!1,i=0,f=0,w=0;o.forEach(n=>{if(n.type!=="icon"&&n.type!=="object")return;n&&n.type==="icon"&&(w=Math.max(n.size&&x(n.size),w));const p=n.type==="icon"?n.size&&x(n.size):0,u=l||p?Math.ceil(Math.min(l||p,t||P)):L;let h=n.type==="icon"?n.angle:null;if(a?.rotation!=null&&(h=(h??0)+a.rotation),g.push(h),n?.resource?.href){const y=ue(e,n).then(b=>{const v=n?.material?.color,M=fe(n);return ce(b,u,v,M,s)}).then(b=>{const v=b.width,M=b.height;return i=Math.max(i,v),f=Math.max(f,M),h&&(m=!0),[{shape:{type:"image",x:0,y:0,width:v,height:M,src:b.url},fill:null,stroke:null}]});k.push(y)}else{let y=u;n.type==="icon"&&l&&(y=u*(p/w));const b=a?.symbolConfig==="tall"||a?.symbolConfig?.isTall||n.type==="object"&&he(n);i=Math.max(i,b?E:y),f=Math.max(f,y),h&&n.resource?.primitive&&["square","triangle","x"].includes(n.resource?.primitive)&&(m=!0),k.push(Promise.resolve(me(n,y,b)))}});const c=await Promise.allSettled(k),d=[];return c.forEach(n=>{n.status==="fulfilled"?d.push(n.value):n.reason&&$.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",n.reason)}),q(d,[i,f],{node:a?.node,scale:!1,opacity:a?.opacity,ariaLabel:a?.ariaLabel,rotations:g,useRotationSize:m})}function be(e,a){const l=e.symbolLayers,t=[],s=X(e),o=R(a),k=(a?.maxSize?x(a.maxSize):null)||D;let g,m=0,i=0;return l.forEach((f,w)=>{if(!f||f.type!=="line"&&f.type!=="path")return;const c=[];switch(f.type){case"line":{const d=Z(f,0);if(d==null)break;const n=d?.width||0;w===0&&(g=n);const p=Math.min(o||n,k),u=w===0?p:o?p*(n/g):p,h=u>T/2?2*u:T;i=Math.max(i,u),m=Math.max(m,h),d.width=u,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[m,.5*i]}]},stroke:d});break}case"path":{const d=Math.min(o||L,k),n=r(f,0),p=r(f,-.2),u=U(f,-.4),h=u?{color:u,width:1}:{};if(f.profile==="quad"){const y=f.width,b=f.height,v=oe(y&&b?y/b:1,b===0,y===0),M={...h,join:"bevel"};c.push({shape:v[0],fill:p,stroke:M},{shape:v[1],fill:p,stroke:M},{shape:v[2],fill:n,stroke:M})}else c.push({shape:j.pathSymbol3DLayer[0],fill:p,stroke:h},{shape:j.pathSymbol3DLayer[1],fill:n,stroke:h});i=Math.max(i,d),m=i}}t.push(c)}),Promise.resolve(q(t,[m,i],{node:a?.node,scale:s,opacity:a?.opacity,ariaLabel:a?.ariaLabel}))}async function de(e,a){const l=e.type==="mesh-3d",t=e.symbolLayers,s=R(a),o=a?.maxSize?x(a.maxSize):null,k=s||L,g=[];let m=0,i=0,f=!1;for(let w=0;w<t.length;w++){const c=t.at(w),d=[];if(!l||c.type==="fill"){switch(c.type){case"fill":{const n=Math.min(k,o||P);if(m=Math.max(m,n),i=Math.max(i,n),f=!0,l){const p=j.meshSymbol3DFill,u=U(c,-.4),h=W(c,.05*n)??(u?{join:"round",color:u,width:1}:null);d.push({shape:p[0],fill:r(c,0),stroke:h},{shape:p[1],fill:r(c,-.2),stroke:h},{shape:p[2],fill:r(c,-.6),stroke:h})}else{let p=r(c,0);const u="pattern"in c?c.pattern:null,h=z(c),y=C(c);u!=null&&u.type==="style"&&u.style!=="solid"&&y&&(p=await B(u,y)),d.push({shape:j.fill[0],fill:p,stroke:h})}break}case"line":{const n=Z(c,0);if(n==null)break;const p={stroke:n,shape:j.fill[0]};m=Math.max(m,L),i=Math.max(i,L),d.push(p);break}case"extrude":{const n=r(c,0),p=r(c,-.2),u=Math.min(k,o||P),h=ie(u),y=L,b=.7*L+.5*u,v=W(c,.1*Math.min(y,b))??{join:"round",...Z(c,-.4),width:1};d.push({shape:h[0],fill:p,stroke:v},{shape:h[1],fill:p,stroke:v},{shape:h[2],fill:n,stroke:v}),m=Math.max(m,y),i=Math.max(i,b);break}case"water":{const n=C(c),p=F(n),u=F(n,2),h=F(n,3),y=re();f=!0,d.push({shape:y[0],fill:p},{shape:y[1],fill:u},{shape:y[2],fill:h});const b=Math.min(k,o||P);m=Math.max(m,b),i=Math.max(i,b);break}}g.push(d)}}return q(g,[m,i],{node:a?.node,scale:f,opacity:a?.opacity,ariaLabel:a?.ariaLabel})}function ke(e,a){if(e.symbolLayers.length===0)return Promise.reject(new H("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return ye(e,a);case"line-3d":return be(e,a);case"polygon-3d":case"mesh-3d":return de(e,a)}return Promise.reject(new H("symbolPreview: swatchInfo3D","symbol not supported."))}export{B as getPatternDescriptor,R as getSizeFromOptions,r as getSymbolLayerFill,ke as previewSymbol3D};
