import{a0 as re,bc as Mr,aQ as Ie,Z as Ot,_ as L,X as D,Y as Ut,a6 as Gr,a5 as Dr,G as ot,cl as Br,ch as Ee,z as Nr,s as pt,eL as zr,d as Fr,eP as Pe,a_ as Vt,i as Re}from"./main-CSjwO60s.js";import{c as $,l as oe}from"./PixelBlock-DwvqalBN.js";import{o as Le}from"./_commonjsHelpers-BITg13Vk.js";import{g as ne,u as Oe}from"./pixelRangeUtils-DcEknavd.js";import{o as vt,h as ie,d as Vr,e as Ue,g as Mt}from"./vectorFieldUtils-BL5wnf_H.js";import{B as _t,C as Me,q as Ge,U as _r}from"./colorUtils-DlmOacVt.js";const jr=re()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),Hr=re()({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"}),De=re()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"}),Wr=["random","ndvi","ndvi2","ndvi3","elevation","gray","hillshade"],ae=[{id:"aspect",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"black-to-white",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blue-bright",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blue-light-to-dark",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blue-green-bright",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blue-green-light-to-dark",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brown-light-to-dark",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brown-to-blue-green-diverging-right",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brown-to-blue-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficient-bias",fromColor:[214,214,255],toColor:[0,57,148]},{id:"cold-to-hot-diverging",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"condition-number",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyan-to-purple",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyan-light-to-blue-dark",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors",fromColor:[255,235,214],toColor:[196,10,10]},{id:"gray-light-to-dark",fromColor:[219,219,219],toColor:[69,69,69]},{id:"green-bright",fromColor:[204,255,204],toColor:[14,204,14]},{id:"green-light-to-dark",fromColor:[220,245,233],toColor:[34,102,51]},{id:"green-to-blue",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orange-bright",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orange-light-to-dark",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partial-spectrum",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partial-spectrum-1-diverging",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partial-spectrum-2-diverging",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pink-to-yellow-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pink-to-yellow-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purple-bright",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purple-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purple-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purple-blue-bright",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purple-blue-light-to-dark",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purple-red-bright",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purple-red-light-to-dark",fromColor:[250,215,246],toColor:[143,17,57]},{id:"red-bright",fromColor:[255,204,204],toColor:[219,0,0]},{id:"red-light-to-dark",fromColor:[255,224,224],toColor:[143,10,10]},{id:"red-to-blue-diverging-bright",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"red-to-blue-diverging-dark",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"red-to-green",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"red-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"red-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrum-full-bright",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrum-full-dark",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrum-full-light",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"white-to-black",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellow-to-dark-red",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellow-to-green-to-dark-blue",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellow-to-red",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellow-green-bright",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellow-green-light-to-dark",fromColor:[215,240,175],toColor:[96,107,45]}],Be=new Ie({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging","Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging","Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","Purple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark","Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark","Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});function jt(t,e){if(!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]>e[r]+2||t[r]<e[r]-2)return!1;return!0}function Ne(t){const e=t.clone();return e.fromColor=t.toColor,e.toColor=t.fromColor,e}function Kr(t){if(t.type==="multipart"){const e=t.clone();return e.colorRamps?.length&&(e.colorRamps=e.colorRamps.reverse().map(r=>Ne(r))),e}return Ne(t)}function ze(t,e){const r=ae;if(t.type==="algorithmic"){const o=t.fromColor.toRgb(),l=t.toColor.toRgb();return r.find(h=>jt(o,h.fromColor)&&jt(l,h.toColor))?.id}if(t.weights?.length)return;const n=t.colorRamps?.map(o=>({fromColor:o.fromColor.toRgb(),toColor:o.toColor.toRgb()}));return r.find(o=>{const l=o.colorRamps;return!(!n||!l||n.length!==l.length)&&l.every((h,a)=>jt(n[a].fromColor,h.fromColor)&&jt(n[a].toColor,h.toColor))})?.id}function qr(t,e,r=!1){if(!t)return;let n=!1,o=ze(t);return o!=null||r||(n=!0,o=ze(t=Kr(t))),o?{id:o,inverted:n}:void 0}function Fe(t,e=!1){const r=typeof t=="string"?t:qr(t,void 0,e)?.id;return r?Be.toJSON(r):null}function Jr(t,e="esriCIELabAlgorithm"){const r=ae.find(({id:n})=>n===t);return r?r.colorRamps?{type:"multipart",colorRamps:r.colorRamps.map(n=>({type:"algorithmic",algorithm:e,fromColor:[...n.fromColor],toColor:[...n.toColor]}))}:{type:"algorithmic",algorithm:e,fromColor:[...r.fromColor],toColor:[...r.toColor]}:null}function Ve(t){t??={};const e=t.numColors||256,r=t.distanceOffset||0,n=t.isCustomInterval!=null?t.isCustomInterval:t.distanceInterval!==null&&t.distanceInterval!==1/(e-1),o=t.distanceInterval||1/(e-1);return{...t,numColors:e,distanceOffset:r,interpolateAlpha:!!t.interpolateAlpha,distanceInterval:o,isCustomInterval:n,weights:t.weights}}function Yr(t,e,r){const{numColors:n,distanceOffset:o,distanceInterval:l,isCustomInterval:h}=r,a=t.s===0,i=e.s===0;let u=t.h,c=e.h;a&&!i?u=c:i&&!a&&(e={...e,h:u},c=u);let s=Math.abs(c-u),f=0;const d=360;s<d/2?f=(c-u)*l:(s=d-s,f=u>c?s*l:-s*l);const m=(e.s-t.s)*l,C=(e.v-t.v)*l;let{s:y,v:p}=t,b=u;if(o){const g=o/l;b=(b+g*f+d)%d,y+=g*m,p+=g*C}const k=[];for(let g=0;g<n-1;g++)k.push({h:b,s:y,v:p}),b=(b+f+d)%d,y+=m,p+=C;return k.push(h?{h:b,s:y,v:p}:e),k}function Zr(t,e,r){const{numColors:n,distanceOffset:o,distanceInterval:l,isCustomInterval:h}=r;let{l:a,a:i,b:u}=t;const c=(e.l-a)*l,s=(e.a-i)*l,f=(e.b-u)*l,d=[];if(o){const m=o/l;a+=m*c,i+=m*s,u+=m*f}for(let m=0;m<n-1;m++)d.push({l:a,a:i,b:u}),a+=c,i+=s,u+=f;return d.push(h?{l:a,a:i,b:u}:e),d}function Xr(t,e,r){const{numColors:n,distanceOffset:o,distanceInterval:l,isCustomInterval:h}=r,a=t.h,i=e.h,u=2*Math.PI;let c=0;if(a<=i){const b=i-a,k=i-a-u;c=Math.abs(k)<Math.abs(b)?k:b}else{const b=i+u-a,k=i-a;c=Math.abs(k)<Math.abs(b)?k:b}const s=c*l,f=(e.l-t.l)*l,d=(e.c-t.c)*l;let{l:m,c:C,h:y}=t;if(o){const b=o/l;m+=b*f,C+=b*d,y=(y+b*s+u)%u}const p=[];for(let b=0;b<n-1;b++)p.push({l:m,c:C,h:y}),m+=f,C+=d,y=(y+s+u)%u;return p.push(h?{l:m,c:C,h:y}:e),p}function _e(t,e){const{fromColor:r,toColor:n}=t,o=r.length===3?[...r,255]:[...r],l=n.length===3?[...n,255]:[...n],h=t.algorithm||"esriCIELabAlgorithm",a=Ve(e),{numColors:i,distanceOffset:u,isCustomInterval:c,interpolateAlpha:s}=a;if(i===1&&u===0)return[o];if(i===2&&u===0&&!c)return[o,l];const f={r:o[0],g:o[1],b:o[2]},d={r:l[0],g:l[1],b:l[2]},m=h==="esriCIELabAlgorithm"?Zr(Me(f),Me(d),a):h==="esriHSVAlgorithm"?Yr(_t(f),_t(d),a):Xr(Ge(f),Ge(d),a),C=[],y=o[3]??255,p=((l[3]??255)-y)/(i-1);for(let b=0;b<i;b++){const{r:k,g,b:w}=_r(m[b]),v=s?Math.round(y+p*b):255;C.push([k,g,w,v])}return C}function Qr(t,e){const{colorRamps:r}=t;if(e??=r.map(({start:o,stop:l})=>o==null||l==null?-1:l-o),e.length!==r.length||e.some(o=>o<0))return Array.from({length:r.length},()=>1/r.length);const n=e.reduce((o,l)=>o+l);return e.map(o=>o/n)}function $r(t,e){const{numColors:r,interpolateAlpha:n}=Ve(e),o=Qr(t,e?.weights),{colorRamps:l}=t,h=[],a=1/(r-1);let i=0,u=!1;for(let s=0;s<l.length;s++){const f=h.length,d=u?0:f*a-i;i+=o[s];let m=s===l.length-1?r-1-f:(o[s]-d)/a;if(u=Math.ceil(m)===m,m=Math.ceil(m),m===0)continue;const C=_e(l[s],{numColors:m,interpolateAlpha:n,distanceOffset:d/o[s],distanceInterval:a/o[s]});h.push(...C)}const c=[...l[l.length-1].toColor];return c.length===3&&c.push(255),h.push(c),h}function je(t,e){const r=Mr(t)?t.toJSON():t;return r.type==="multipart"?$r(r,e):_e(r,e)}function se(t,e){const r=je(t,e),n=e?.interpolateAlpha;return r.forEach((o,l)=>{o.unshift(l),n||o.pop()}),r}function He(t){const e=[];for(let r=0;r<t.length;r+=4){const n=_t({r:t[r],g:t[r+1],b:t[r+2]});e.push([n.h/60,n.s/100,255*n.v/100])}return e}function We(t){const e=_t(t);return{type:"HsvColor",Hue:e.h,Saturation:e.s,Value:e.v,AlphaValue:255}}function Ke(t){return{Algorithm:t.toJSON()?.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:We(t.fromColor),ToColor:We(t.toColor)}}function to(t){const e=Fe(t);if(!e)return null;if(t.type==="algorithmic")return{...Ke(t),Name:e};if(t.colorRamps){const r=t.colorRamps.map(Ke);return{type:"MultiPartColorRamp",NumColorRamps:r.length,ArrayOfColorRamp:r,Name:e}}return null}function eo(t){const e=[...t].reverse().map(r=>{const n=r.toString(16);return n.length<2?"0"+n:n});return 4294967295&Number.parseInt(e.join(""),16)}const ro=new Ie({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),qe={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"};var le;function Tt(t){return t=Number(t),isNaN(t)?void 0:t}let ut=class extends Ot{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}static{le=this}clone(){return new le({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};L([D({json:{name:"BandName",write:!0}})],ut.prototype,"name",void 0),L([D({json:{read:{source:["WavelengthMin","Wavelength"],reader:(t,e)=>Tt(e.WavelengthMin??e.Wavelength)},write:{target:"WavelengthMin"}}})],ut.prototype,"minWavelength",void 0),L([D({json:{name:"WavelengthMax",read:{reader:Tt},write:!0}})],ut.prototype,"maxWavelength",void 0),L([D({json:{name:"RadianceBias",read:{reader:Tt},write:!0}})],ut.prototype,"radianceBias",void 0),L([D({json:{name:"RadianceGain",read:{reader:Tt},write:!0}})],ut.prototype,"radianceGain",void 0),L([D({json:{name:"ReflectanceBias",read:{reader:Tt},write:!0}})],ut.prototype,"reflectanceBias",void 0),L([D({json:{name:"ReflectanceGain",read:{reader:Tt},write:!0}})],ut.prototype,"reflectanceGain",void 0),L([D({json:{name:"SolarIrradiance",read:{reader:Tt},write:!0}})],ut.prototype,"solarIrradiance",void 0),ut=le=L([Ut("esri.layers.support.RasterBandInfo")],ut);var ue;function Gt(t){return t=Number(t),isNaN(t)?void 0:t}let st=ue=class extends Ot{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(t){return new Date(t)}writeAcquisitionDate(t,e){e.AcquisitionDate=t.getTime()}clone(){return new ue({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};L([D({type:Date,json:{name:"AcquisitionDate",write:!0}})],st.prototype,"acquisitionDate",void 0),L([Gr("acquisitionDate")],st.prototype,"readAcquisitionDate",null),L([Dr("acquisitionDate")],st.prototype,"writeAcquisitionDate",null),L([D({json:{name:"CloudCover",read:{reader:Gt},write:!0}})],st.prototype,"cloudCover",void 0),L([D({json:{name:"ProductName",write:!0}})],st.prototype,"productName",void 0),L([D({json:{name:"SensorName",write:!0}})],st.prototype,"sensorName",void 0),L([D({json:{name:"SensorAzimuth",read:{reader:Gt},write:!0}})],st.prototype,"sensorAzimuth",void 0),L([D({json:{name:"SensorElevation",read:{reader:Gt},write:!0}})],st.prototype,"sensorElevation",void 0),L([D({json:{name:"SunAzimuth",read:{reader:Gt},write:!0}})],st.prototype,"sunAzimuth",void 0),L([D({json:{name:"SunElevation",read:{reader:Gt},write:!0}})],st.prototype,"sunElevation",void 0),st=ue=L([Ut("esri.layers.support.RasterSensorInfo")],st);var ce;let Q=ce=class extends Ot{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isBsqTile=!1,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new ce({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:ot(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:ot(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isBsqTile:this.isBsqTile,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:ot(this.tileInfo),transposeInfo:ot(this.transposeInfo),blockBoundary:ot(this.blockBoundary)})}};L([D({type:Number,json:{write:!0}})],Q.prototype,"blockWidth",void 0),L([D({type:Number,json:{write:!0}})],Q.prototype,"blockHeight",void 0),L([D({type:String,json:{write:!0}})],Q.prototype,"compression",void 0),L([D({type:Br,json:{write:!0}})],Q.prototype,"origin",void 0),L([D({type:Number,json:{write:!0}})],Q.prototype,"firstPyramidLevel",void 0),L([D({type:Number,json:{write:!0}})],Q.prototype,"maximumPyramidLevel",void 0),L([D({json:{write:!0}})],Q.prototype,"pyramidResolutions",void 0),L([D({type:Number,json:{write:!0}})],Q.prototype,"pyramidScalingFactor",void 0),L([D({type:Number,json:{write:!0}})],Q.prototype,"pyramidBlockWidth",void 0),L([D({type:Number,json:{write:!0}})],Q.prototype,"pyramidBlockHeight",void 0),L([D({json:{write:!0}})],Q.prototype,"isBsqTile",void 0),L([D({type:Boolean,json:{write:!0}})],Q.prototype,"isVirtualTileInfo",void 0),L([D({json:{write:!0}})],Q.prototype,"tileInfo",void 0),L([D()],Q.prototype,"transposeInfo",void 0),L([D({json:{write:!0}})],Q.prototype,"blockBoundary",void 0),Q=ce=L([Ut("esri.layers.support.RasterStorageInfo")],Q);var he;let Z=he=class extends Ot{constructor(t){super(t),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){const t=this.keyProperties.BandProperties,{bandCount:e}=this;if(!t?.length||t.length<e){const n=[];for(let o=1;o<=e;o++)n.push(new ut({name:"band_"+o}));return n}const r=t.map(n=>ut.fromJSON(n));for(let n=0;n<r.length;n++)r[n].name=r[n].name||"band_"+(n+1);return r}get dataType(){const t=this.keyProperties?.DataType?.toLowerCase()??"generic";return t==="stdtime"?"standard-time":t}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(t){t&&this._set("nativeExtent",t)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;const t=this.nativeExtent;return{x:t.width/this.width,y:t.height/this.height}}get hasMultidimensionalTranspose(){return!!this.storageInfo?.transposeInfo}get sensorInfo(){if(this.keyProperties?.SensorName)return st.fromJSON(this.keyProperties)}clone(){return new he({attributeTable:ot(this.attributeTable),bandCount:this.bandCount,colormap:ot(this.colormap),extent:ot(this.extent),format:this.format,height:this.height,width:this.width,histograms:ot(this.histograms),keyProperties:ot(this.keyProperties),multidimensionalInfo:ot(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:ot(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:ot(this.spatialReference),statistics:ot(this.statistics),storageInfo:ot(this.storageInfo),transform:ot(this.transform)})}};L([D({json:{write:!0}})],Z.prototype,"attributeTable",void 0),L([D({json:{write:!0}})],Z.prototype,"bandCount",void 0),L([D({readOnly:!0})],Z.prototype,"bandInfos",null),L([D({json:{write:!0}})],Z.prototype,"colormap",void 0),L([D({type:String,readOnly:!0})],Z.prototype,"dataType",null),L([D({type:Ee,json:{write:!0}})],Z.prototype,"extent",void 0),L([D({type:Ee,json:{write:!0}})],Z.prototype,"nativeExtent",null),L([D({json:{write:!0}})],Z.prototype,"nativePixelSize",null),L([D({json:{write:!0}})],Z.prototype,"format",void 0),L([D({json:{write:!0}})],Z.prototype,"height",void 0),L([D({json:{write:!0}})],Z.prototype,"width",void 0),L([D({json:{write:!0}})],Z.prototype,"hasMultidimensionalTranspose",null),L([D({json:{write:!0}})],Z.prototype,"histograms",void 0),L([D({json:{write:!0}})],Z.prototype,"keyProperties",void 0),L([D({json:{write:!0}})],Z.prototype,"multidimensionalInfo",void 0),L([D({json:{write:!0}})],Z.prototype,"noDataValue",void 0),L([D({json:{write:!0}})],Z.prototype,"pixelSize",void 0),L([D({type:De.apiValues,json:{write:!0}})],Z.prototype,"pixelType",void 0),L([D()],Z.prototype,"isPseudoSpatialReference",void 0),L([D({readOnly:!0})],Z.prototype,"sensorInfo",null),L([D({type:Nr,json:{write:!0}})],Z.prototype,"spatialReference",void 0),L([D({json:{write:!0}})],Z.prototype,"statistics",void 0),L([D({type:Q,json:{write:!0}})],Z.prototype,"storageInfo",void 0),L([D({json:{write:!0}})],Z.prototype,"transform",void 0),Z=he=L([Ut("esri.layers.support.RasterInfo")],Z);var Je,Ye={exports:{}};function oo(){return Je||(Je=1,e=Ye,t=function(){function n(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return n.prototype={ensureBuffer:function(o){var l=this.buffer,h=l?l.byteLength:0;if(o<h)return l;for(var a=512;a<o;)a<<=1;for(var i=new Uint8Array(a),u=0;u<h;++u)i[u]=l[u];return this.buffer=i},getByte:function(){for(var o=this.pos;this.bufferLength<=o;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(o){var l=this.pos;if(o){this.ensureBuffer(l+o);for(var h=l+o;!this.eof&&this.bufferLength<h;)this.readBlock();var a=this.bufferLength;h>a&&(h=a)}else{for(;!this.eof;)this.readBlock();h=this.bufferLength}return this.pos=h,this.buffer.subarray(l,h)},lookChar:function(){for(var o=this.pos;this.bufferLength<=o;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var o=this.pos;this.bufferLength<=o;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(o,l,h){for(var a=o+l;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,o,l,h)},skip:function(o){o||(o=1),this.pos+=o},reset:function(){this.pos=0}},n}(),(r=function(){if(!self||!self.Uint32Array)return null;var n=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),l=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),h=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function i(c){throw new Error(c)}function u(c){var s=0,f=c[s++],d=c[s++];f!=-1&&d!=-1||i("Invalid header in flate stream"),(15&f)!=8&&i("Unknown compression method in flate stream"),((f<<8)+d)%31!=0&&i("Bad FCHECK in flate stream"),32&d&&i("FDICT bit set in flate stream"),this.bytes=c,this.bytesPos=s,this.codeSize=0,this.codeBuf=0,t.call(this)}return u.prototype=Object.create(t.prototype),u.prototype.getBits=function(c){for(var s,f=this.codeSize,d=this.codeBuf,m=this.bytes,C=this.bytesPos;f<c;)(s=m[C++])===void 0&&i("Bad encoding in flate stream"),d|=s<<f,f+=8;return s=d&(1<<c)-1,this.codeBuf=d>>c,this.codeSize=f-=c,this.bytesPos=C,s},u.prototype.getCode=function(c){for(var s=c[0],f=c[1],d=this.codeSize,m=this.codeBuf,C=this.bytes,y=this.bytesPos;d<f;){var p;(p=C[y++])===void 0&&i("Bad encoding in flate stream"),m|=p<<d,d+=8}var b=s[m&(1<<f)-1],k=b>>16,g=65535&b;return(d==0||d<k||k==0)&&i("Bad encoding in flate stream"),this.codeBuf=m>>k,this.codeSize=d-k,this.bytesPos=y,g},u.prototype.generateHuffmanTable=function(c){for(var s=c.length,f=0,d=0;d<s;++d)c[d]>f&&(f=c[d]);for(var m=1<<f,C=new Uint32Array(m),y=1,p=0,b=2;y<=f;++y,p<<=1,b<<=1)for(var k=0;k<s;++k)if(c[k]==y){var g=0,w=p;for(d=0;d<y;++d)g=g<<1|1&w,w>>=1;for(d=g;d<m;d+=b)C[d]=y<<16|k;++p}return[C,f]},u.prototype.readBlock=function(){function c(F,J,j,_,W){for(var tt=F.getBits(j)+_;tt-- >0;)J[b++]=W}var s=this.getBits(3);if(1&s&&(this.eof=!0),(s>>=1)!=0){var f,d;if(s==1)f=h,d=a;else if(s==2){for(var m=this.getBits(5)+257,C=this.getBits(5)+1,y=this.getBits(4)+4,p=Array(n.length),b=0;b<y;)p[n[b++]]=this.getBits(3);for(var k=this.generateHuffmanTable(p),g=0,w=(b=0,m+C),v=new Array(w);b<w;){var S=this.getCode(k);S==16?c(this,v,2,3,g):S==17?c(this,v,3,3,g=0):S==18?c(this,v,7,11,g=0):v[b++]=g=S}f=this.generateHuffmanTable(v.slice(0,m)),d=this.generateHuffmanTable(v.slice(m,w))}else i("Unknown block type in flate stream");for(var x=(O=this.buffer)?O.length:0,T=this.bufferLength;;){var A=this.getCode(f);if(A<256)T+1>=x&&(x=(O=this.ensureBuffer(T+1)).length),O[T++]=A;else{if(A==256)return void(this.bufferLength=T);var I=(A=o[A-=257])>>16;I>0&&(I=this.getBits(I)),g=(65535&A)+I,A=this.getCode(d),(I=(A=l[A])>>16)>0&&(I=this.getBits(I));var E=(65535&A)+I;T+g>=x&&(x=(O=this.ensureBuffer(T+g)).length);for(var P=0;P<g;++P,++T)O[T]=O[T-E]}}}else{var R,z=this.bytes,G=this.bytesPos;(R=z[G++])===void 0&&i("Bad block header in flate stream");var B=R;(R=z[G++])===void 0&&i("Bad block header in flate stream"),B|=R<<8,(R=z[G++])===void 0&&i("Bad block header in flate stream");var U=R;(R=z[G++])===void 0&&i("Bad block header in flate stream"),(U|=R<<8)!=(65535&~B)&&i("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var K=this.bufferLength,O=this.ensureBuffer(K+B),V=K+B;this.bufferLength=V;for(var N=K;N<V;++N){if((R=z[G++])===void 0){this.eof=!0;break}O[N]=R}this.bytesPos=G}},u}())!==void 0&&(e.exports=r)),Ye.exports;var t,e,r}const Dt=Le(oo());let no=class Or{constructor(e){this._canvas=null,this._ctx=null,e&&(this._canvas=e.canvas,this._ctx=e.ctx||e.canvas&&e.canvas.getContext("2d"))}decode(e,r,n){if(!e||e.byteLength<10)throw new pt("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:o=0,height:l=0,format:h}=r;const{applyJpegMask:a}=r;if(a&&(!o||!l))throw new pt("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((i,u)=>{let c=null;h==="jpg"&&a&&(c=Or._getMask(e,{width:o,height:l}));const s=new Blob([new Uint8Array(e)],{type:"image/"+h=="jpg"?"jpeg":h}),f=URL.createObjectURL(s),d=new Image;let m;d.src=f,d.onload=()=>{if(URL.revokeObjectURL(f),zr(n))return void u(Fr());o=d.width,l=d.height,this._canvas&&this._ctx?(this._canvas.width===o&&this._canvas.height===l||(this._canvas.width=o,this._canvas.height=l),this._ctx.clearRect(0,0,o,l)):(this._canvas=document.createElement("canvas"),this._canvas.width=o,this._canvas.height=l,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(d,0,0);const C=this._ctx.getImageData(0,0,o,l);let y;if(m=C.data,r.renderOnCanvas){if(c)for(y=0;y<c.length;y++)c[y]?m[4*y+3]=255:m[4*y+3]=0;return this._ctx.putImageData(C,0,0),void i(null)}const p=o*l,b=new Uint8Array(p),k=new Uint8Array(p),g=new Uint8Array(p);if(c)for(y=0;y<p;y++)b[y]=m[4*y],k[y]=m[4*y+1],g[y]=m[4*y+2];else for(c=new Uint8Array(p),y=0;y<p;y++)b[y]=m[4*y],k[y]=m[4*y+1],g[y]=m[4*y+2],c[y]=m[4*y+3];i({width:o,height:l,pixels:[b,k,g],mask:c,pixelType:"u8"})},d.onerror=()=>{URL.revokeObjectURL(f),u("cannot load image")}})}static _getMask(e,r){let n=null;try{const o=new Uint8Array(e),l=Math.ceil(o.length/2);let h=0;const a=o.length-2;for(h=l;h<a&&(o[h]!==255||o[h+1]!==217);h++);if(h+=2,h<o.length-1){const i=new Dt(o.subarray(h)).getBytes();n=new Uint8Array(r.width*r.height);let u=0;for(let c=0;c<i.length;c++)for(let s=7;s>=0;s--)n[u++]=i[c]>>s&1}}catch{}return n}};var Ze,Xe={exports:{}};function io(){return Ze||(Ze=1,t=Xe,e=function(){var n=function(){function o(l){this.message="JPEG error: "+l}return o.prototype=new Error,o.prototype.name="JpegError",o.constructor=o,o}();return function(){if(!self||!self.Uint8ClampedArray)return null;var o=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),l=4017,h=799,a=3406,i=2276,u=1567,c=3784,s=5793,f=2896;function d(){this.decodeTransform=null,this.colorTransform=-1}function m(g,w){for(var v,S,x=0,T=[],A=16;A>0&&!g[A-1];)A--;T.push({children:[],index:0});var I,E=T[0];for(v=0;v<A;v++){for(S=0;S<g[v];S++){for((E=T.pop()).children[E.index]=w[x];E.index>0;)E=T.pop();for(E.index++,T.push(E);T.length<=v;)T.push(I={children:[],index:0}),E.children[E.index]=I.children,E=I;x++}v+1<A&&(T.push(I={children:[],index:0}),E.children[E.index]=I.children,E=I)}return T[0].children}function C(g,w,v){return 64*((g.blocksPerLine+1)*w+v)}function y(g,w,v,S,x,T,A,I,E){var P=v.mcusPerLine,R=v.progressive,z=w,G=0,B=0;function U(){if(B>0)return B--,G>>B&1;if((G=g[w++])===255){var M=g[w++];if(M)throw new n("unexpected marker "+(G<<8|M).toString(16))}return B=7,G>>>7}function K(M){for(var q=M;;){if(typeof(q=q[U()])=="number")return q;if(typeof q!="object")throw new n("invalid huffman sequence")}}function O(M){for(var q=0;M>0;)q=q<<1|U(),M--;return q}function V(M){if(M===1)return U()===1?1:-1;var q=O(M);return q>=1<<M-1?q:q+(-1<<M)+1}function N(M,q){var Y=K(M.huffmanTableDC),et=Y===0?0:V(Y);M.blockData[q]=M.pred+=et;for(var it=1;it<64;){var ht=K(M.huffmanTableAC),rt=15&ht,at=ht>>4;if(rt!==0){var Ur=o[it+=at];M.blockData[q+Ur]=V(rt),it++}else{if(at<15)break;it+=16}}}function F(M,q){var Y=K(M.huffmanTableDC),et=Y===0?0:V(Y)<<E;M.blockData[q]=M.pred+=et}function J(M,q){M.blockData[q]|=U()<<E}var j=0;function _(M,q){if(j>0)j--;else for(var Y=T,et=A;Y<=et;){var it=K(M.huffmanTableAC),ht=15&it,rt=it>>4;if(ht!==0){var at=o[Y+=rt];M.blockData[q+at]=V(ht)*(1<<E),Y++}else{if(rt<15){j=O(rt)+(1<<rt)-1;break}Y+=16}}}var W,tt=0;function Rt(M,q){for(var Y,et,it=T,ht=A,rt=0;it<=ht;){var at=o[it];switch(tt){case 0:if(rt=(et=K(M.huffmanTableAC))>>4,(Y=15&et)==0)rt<15?(j=O(rt)+(1<<rt),tt=4):(rt=16,tt=1);else{if(Y!==1)throw new n("invalid ACn encoding");W=V(Y),tt=rt?2:3}continue;case 1:case 2:M.blockData[q+at]?M.blockData[q+at]+=U()<<E:--rt===0&&(tt=tt===2?3:0);break;case 3:M.blockData[q+at]?M.blockData[q+at]+=U()<<E:(M.blockData[q+at]=W<<E,tt=0);break;case 4:M.blockData[q+at]&&(M.blockData[q+at]+=U()<<E)}it++}tt===4&&--j===0&&(tt=0)}function te(M,q,Y,et,it){var ht=Y%P;q(M,C(M,(Y/P|0)*M.v+et,ht*M.h+it))}function ee(M,q,Y){q(M,C(M,Y/M.blocksPerLine|0,Y%M.blocksPerLine))}var mt,ct,ft,yt,X,Lt,Ct=S.length;Lt=R?T===0?I===0?F:J:I===0?_:Rt:N;var lt,bt,Nt,zt,dt=0;for(bt=Ct===1?S[0].blocksPerLine*S[0].blocksPerColumn:P*v.mcusPerColumn;dt<bt;){var Ft=x?Math.min(bt-dt,x):bt;for(ct=0;ct<Ct;ct++)S[ct].pred=0;if(j=0,Ct===1)for(mt=S[0],X=0;X<Ft;X++)ee(mt,Lt,dt),dt++;else for(X=0;X<Ft;X++){for(ct=0;ct<Ct;ct++)for(Nt=(mt=S[ct]).h,zt=mt.v,ft=0;ft<zt;ft++)for(yt=0;yt<Nt;yt++)te(mt,Lt,dt,ft,yt);dt++}B=0,(lt=k(g,w))&&lt.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+lt.invalid),w=lt.offset);var wt=lt&&lt.marker;if(!wt||wt<=65280)throw new n("marker was not found");if(!(wt>=65488&&wt<=65495))break;w+=2}return(lt=k(g,w))&&lt.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+lt.invalid),w=lt.offset),w-z}function p(g,w,v){var S,x,T,A,I,E,P,R,z,G,B,U,K,O,V,N,F,J=g.quantizationTable,j=g.blockData;if(!J)throw new n("missing required Quantization Table.");for(var _=0;_<64;_+=8)z=j[w+_],G=j[w+_+1],B=j[w+_+2],U=j[w+_+3],K=j[w+_+4],O=j[w+_+5],V=j[w+_+6],N=j[w+_+7],z*=J[_],(G|B|U|K|O|V|N)!==0?(G*=J[_+1],B*=J[_+2],U*=J[_+3],K*=J[_+4],O*=J[_+5],V*=J[_+6],N*=J[_+7],x=(S=(S=s*z+128>>8)+(x=s*K+128>>8)+1>>1)-x,F=(T=B)*c+(A=V)*u+128>>8,T=T*u-A*c+128>>8,P=(I=(I=f*(G-N)+128>>8)+(P=O<<4)+1>>1)-P,E=(R=(R=f*(G+N)+128>>8)+(E=U<<4)+1>>1)-E,A=(S=S+(A=F)+1>>1)-A,T=(x=x+T+1>>1)-T,F=I*i+R*a+2048>>12,I=I*a-R*i+2048>>12,R=F,F=E*h+P*l+2048>>12,E=E*l-P*h+2048>>12,P=F,v[_]=S+R,v[_+7]=S-R,v[_+1]=x+P,v[_+6]=x-P,v[_+2]=T+E,v[_+5]=T-E,v[_+3]=A+I,v[_+4]=A-I):(F=s*z+512>>10,v[_]=F,v[_+1]=F,v[_+2]=F,v[_+3]=F,v[_+4]=F,v[_+5]=F,v[_+6]=F,v[_+7]=F);for(var W=0;W<8;++W)z=v[W],((G=v[W+8])|(B=v[W+16])|(U=v[W+24])|(K=v[W+32])|(O=v[W+40])|(V=v[W+48])|(N=v[W+56]))!==0?(x=(S=4112+((S=s*z+2048>>12)+(x=s*K+2048>>12)+1>>1))-x,F=(T=B)*c+(A=V)*u+2048>>12,T=T*u-A*c+2048>>12,A=F,P=(I=(I=f*(G-N)+2048>>12)+(P=O)+1>>1)-P,E=(R=(R=f*(G+N)+2048>>12)+(E=U)+1>>1)-E,F=I*i+R*a+2048>>12,I=I*a-R*i+2048>>12,R=F,F=E*h+P*l+2048>>12,E=E*l-P*h+2048>>12,z=(z=(S=S+A+1>>1)+R)<16?0:z>=4080?255:z>>4,G=(G=(x=x+T+1>>1)+(P=F))<16?0:G>=4080?255:G>>4,B=(B=(T=x-T)+E)<16?0:B>=4080?255:B>>4,U=(U=(A=S-A)+I)<16?0:U>=4080?255:U>>4,K=(K=A-I)<16?0:K>=4080?255:K>>4,O=(O=T-E)<16?0:O>=4080?255:O>>4,V=(V=x-P)<16?0:V>=4080?255:V>>4,N=(N=S-R)<16?0:N>=4080?255:N>>4,j[w+W]=z,j[w+W+8]=G,j[w+W+16]=B,j[w+W+24]=U,j[w+W+32]=K,j[w+W+40]=O,j[w+W+48]=V,j[w+W+56]=N):(F=(F=s*z+8192>>14)<-2040?0:F>=2024?255:F+2056>>4,j[w+W]=F,j[w+W+8]=F,j[w+W+16]=F,j[w+W+24]=F,j[w+W+32]=F,j[w+W+40]=F,j[w+W+48]=F,j[w+W+56]=F)}function b(g,w){for(var v=w.blocksPerLine,S=w.blocksPerColumn,x=new Int16Array(64),T=0;T<S;T++)for(var A=0;A<v;A++)p(w,C(w,T,A),x);return w.blockData}function k(g,w,v){function S(E){return g[E]<<8|g[E+1]}var x=g.length-1,T=v<w?v:w;if(w>=x)return null;var A=S(w);if(A>=65472&&A<=65534)return{invalid:null,marker:A,offset:w};for(var I=S(T);!(I>=65472&&I<=65534);){if(++T>=x)return null;I=S(T)}return{invalid:A.toString(16),marker:I,offset:T}}return d.prototype={parse:function(g){function w(){var M=g[A]<<8|g[A+1];return A+=2,M}function v(){var M=w(),q=A+M-2,Y=k(g,q,A);Y&&Y.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+Y.invalid),q=Y.offset);var et=g.subarray(A,q);return A+=et.length,et}function S(M){for(var q=Math.ceil(M.samplesPerLine/8/M.maxH),Y=Math.ceil(M.scanLines/8/M.maxV),et=0;et<M.components.length;et++){X=M.components[et];var it=Math.ceil(Math.ceil(M.samplesPerLine/8)*X.h/M.maxH),ht=Math.ceil(Math.ceil(M.scanLines/8)*X.v/M.maxV),rt=q*X.h,at=Y*X.v*64*(rt+1);X.blockData=new Int16Array(at),X.blocksPerLine=it,X.blocksPerColumn=ht}M.mcusPerLine=q,M.mcusPerColumn=Y}var x,T,A=0,I=null,E=null,P=[],R=[],z=[],G=w();if(G!==65496)throw new n("SOI not found");for(G=w();G!==65497;){var B,U,K;switch(G){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var O=v();G===65504&&O[0]===74&&O[1]===70&&O[2]===73&&O[3]===70&&O[4]===0&&(I={version:{major:O[5],minor:O[6]},densityUnits:O[7],xDensity:O[8]<<8|O[9],yDensity:O[10]<<8|O[11],thumbWidth:O[12],thumbHeight:O[13],thumbData:O.subarray(14,14+3*O[12]*O[13])}),G===65518&&O[0]===65&&O[1]===100&&O[2]===111&&O[3]===98&&O[4]===101&&(E={version:O[5]<<8|O[6],flags0:O[7]<<8|O[8],flags1:O[9]<<8|O[10],transformCode:O[11]});break;case 65499:for(var V=w()+A-2;A<V;){var N=g[A++],F=new Uint16Array(64);if(N>>4){if(N>>4!=1)throw new n("DQT - invalid table spec");for(U=0;U<64;U++)F[o[U]]=w()}else for(U=0;U<64;U++)F[o[U]]=g[A++];P[15&N]=F}break;case 65472:case 65473:case 65474:if(x)throw new n("Only single frame JPEGs supported");w(),(x={}).extended=G===65473,x.progressive=G===65474,x.precision=g[A++],x.scanLines=w(),x.samplesPerLine=w(),x.components=[],x.componentIds={};var J,j=g[A++],_=0,W=0;for(B=0;B<j;B++){J=g[A];var tt=g[A+1]>>4,Rt=15&g[A+1];_<tt&&(_=tt),W<Rt&&(W=Rt);var te=g[A+2];K=x.components.push({h:tt,v:Rt,quantizationId:te,quantizationTable:null}),x.componentIds[J]=K-1,A+=3}x.maxH=_,x.maxV=W,S(x);break;case 65476:var ee=w();for(B=2;B<ee;){var mt=g[A++],ct=new Uint8Array(16),ft=0;for(U=0;U<16;U++,A++)ft+=ct[U]=g[A];var yt=new Uint8Array(ft);for(U=0;U<ft;U++,A++)yt[U]=g[A];B+=17+ft,(mt>>4?R:z)[15&mt]=m(ct,yt)}break;case 65501:w(),T=w();break;case 65498:w();var X,Lt=g[A++],Ct=[];for(B=0;B<Lt;B++){var lt=x.componentIds[g[A++]];X=x.components[lt];var bt=g[A++];X.huffmanTableDC=z[bt>>4],X.huffmanTableAC=R[15&bt],Ct.push(X)}var Nt=g[A++],zt=g[A++],dt=g[A++],Ft=y(g,A,x,Ct,T,Nt,zt,dt>>4,15&dt);A+=Ft;break;case 65535:g[A]!==255&&A--;break;default:if(g[A-3]===255&&g[A-2]>=192&&g[A-2]<=254){A-=3;break}throw new n("unknown marker "+G.toString(16))}G=w()}for(this.width=x.samplesPerLine,this.height=x.scanLines,this.jfif=I,this.eof=A,this.adobe=E,this.components=[],B=0;B<x.components.length;B++){var wt=P[(X=x.components[B]).quantizationId];wt&&(X.quantizationTable=wt),this.components.push({output:b(x,X),scaleX:X.h/x.maxH,scaleY:X.v/x.maxV,blocksPerLine:X.blocksPerLine,blocksPerColumn:X.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(g,w){var v,S,x,T,A,I,E,P,R,z,G,B=this.width/g,U=this.height/w,K=0,O=this.components.length,V=g*w*O,N=new Uint8ClampedArray(V),F=new Uint32Array(g),J=4294967288;for(E=0;E<O;E++){for(S=(v=this.components[E]).scaleX*B,x=v.scaleY*U,K=E,G=v.output,T=v.blocksPerLine+1<<3,A=0;A<g;A++)P=0|A*S,F[A]=(P&J)<<3|7&P;for(I=0;I<w;I++)for(z=T*((P=0|I*x)&J)|(7&P)<<3,A=0;A<g;A++)N[K]=G[z+F[A]],K+=O}var j=this.decodeTransform;if(j)for(E=0;E<V;)for(P=0,R=0;P<O;P++,E++,R+=2)N[E]=(N[E]*j[R]>>8)+j[R+1];return N},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(g){for(var w,v,S,x=0,T=g.length;x<T;x+=3)w=g[x],v=g[x+1],S=g[x+2],g[x]=w-179.456+1.402*S,g[x+1]=w+135.459-.344*v-.714*S,g[x+2]=w-226.816+1.772*v;return g},_convertYcckToRgb:function(g){for(var w,v,S,x,T=0,A=0,I=g.length;A<I;A+=4)w=g[A],v=g[A+1],S=g[A+2],x=g[A+3],g[T++]=v*(-660635669420364e-19*v+.000437130475926232*S-54080610064599e-18*w+.00048449797120281*x-.154362151871126)-122.67195406894+S*(-.000957964378445773*S+.000817076911346625*w-.00477271405408747*x+1.53380253221734)+w*(.000961250184130688*w-.00266257332283933*x+.48357088451265)+x*(-.000336197177618394*x+.484791561490776),g[T++]=107.268039397724+v*(219927104525741e-19*v-.000640992018297945*S+.000659397001245577*w+.000426105652938837*x-.176491792462875)+S*(-.000778269941513683*S+.00130872261408275*w+.000770482631801132*x-.151051492775562)+w*(.00126935368114843*w-.00265090189010898*x+.25802910206845)+x*(-.000318913117588328*x-.213742400323665),g[T++]=v*(-.000570115196973677*v-263409051004589e-19*S+.0020741088115012*w-.00288260236853442*x+.814272968359295)-20.810012546947+S*(-153496057440975e-19*S-.000132689043961446*w+.000560833691242812*x-.195152027534049)+w*(.00174418132927582*w-.00255243321439347*x+.116935020465145)+x*(-.000343531996510555*x+.24165260232407);return g},_convertYcckToCmyk:function(g){for(var w,v,S,x=0,T=g.length;x<T;x+=4)w=g[x],v=g[x+1],S=g[x+2],g[x]=434.456-w-1.402*S,g[x+1]=119.541-w+.344*v+.714*S,g[x+2]=481.816-w-1.772*v;return g},_convertCmykToRgb:function(g){for(var w,v,S,x,T=0,A=1/255,I=0,E=g.length;I<E;I+=4)w=g[I]*A,v=g[I+1]*A,S=g[I+2]*A,x=g[I+3]*A,g[T++]=255+w*(-4.387332384609988*w+54.48615194189176*v+18.82290502165302*S+212.25662451639585*x-285.2331026137004)+v*(1.7149763477362134*v-5.6096736904047315*S-17.873870861415444*x-5.497006427196366)+S*(-2.5217340131683033*S-21.248923337353073*x+17.5119270841813)-x*(21.86122147463605*x+189.48180835922747),g[T++]=255+w*(8.841041422036149*w+60.118027045597366*v+6.871425592049007*S+31.159100130055922*x-79.2970844816548)+v*(-15.310361306967817*v+17.575251261109482*S+131.35250912493976*x-190.9453302588951)+S*(4.444339102852739*S+9.8632861493405*x-24.86741582555878)-x*(20.737325471181034*x+187.80453709719578),g[T++]=255+w*(.8842522430003296*w+8.078677503112928*v+30.89978309703729*S-.23883238689178934*x-14.183576799673286)+v*(10.49593273432072*v+63.02378494754052*S+50.606957656360734*x-112.23884253719248)+S*(.03296041114873217*S+115.60384449646641*x-193.58209356861505)-x*(22.33816807309886*x+180.12613974708367);return g},getData:function(g,w,v){if(this.numComponents>4)throw new n("Unsupported color mode");var S=this._getLinearizedBlockData(g,w);if(this.numComponents===1&&v){for(var x=S.length,T=new Uint8ClampedArray(3*x),A=0,I=0;I<x;I++){var E=S[I];T[A++]=E,T[A++]=E,T[A++]=E}return T}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(S);if(this.numComponents===4){if(this._isColorConversionNeeded())return v?this._convertYcckToRgb(S):this._convertYcckToCmyk(S);if(v)return this._convertCmykToRgb(S)}return S}},d}()},(r=e())!==void 0&&(t.exports=r)),Xe.exports;var t,e,r}const Qe=Le(io());let ao=class{static decode(t,e=!1){const r=new Uint8Array(t),n=new Qe;n.parse(r);const{width:o,height:l,numComponents:h,eof:a}=n,i=n.getData(o,l,!0),u=o*l;let c,s=null,f=0,d=0,m=0;if(!e&&a<r.length-1)try{const C=new Dt(r.subarray(a)).getBytes();s=new Uint8Array(u);let y=0;for(f=0;f<C.length;f++)for(m=7;m>=0;m--)s[y++]=C[f]>>m&1}catch{}if(h===1&&i.length===o*l){const C=new Uint8Array(i.buffer);c=[C,C,C]}else{for(c=[],f=0;f<3;f++)c.push(new Uint8Array(u));for(m=0,d=0;d<u;d++)for(f=0;f<3;f++)c[f][d]=i[m++]}return{width:o,height:l,pixels:c,mask:s}}};const $e=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let fe=null;function tr(){return fe||(fe=import("./lerc-wasm-CS48exwl.js").then(t=>t.l).then(({default:t})=>t({locateFile:e=>Pe(`esri/layers/support/rasterFormats/${e}`)})).then(t=>{lo(t)}),fe)}const Ht={getBlobInfo:null,decode:null};function so(t){return 16+(t>>3<<3)}function gt(t,e,r){r.set(t.slice(e,e+r.length))}function lo(t){const{_malloc:e,_free:r,_lerc_getBlobInfo:n,_lerc_getDataRanges:o,_lerc_decode_4D:l,asm:h}=t;let a;const i=Object.values(h).find(c=>c&&"buffer"in c&&c.buffer===t.HEAPU8.buffer),u=c=>{const s=c.map(C=>so(C)),f=s.reduce((C,y)=>C+y),d=e(f);a=new Uint8Array(i.buffer);let m=s[0];s[0]=d;for(let C=1;C<s.length;C++){const y=s[C];s[C]=s[C-1]+m,m=y}return s};Ht.getBlobInfo=c=>{const s=new Uint8Array(48),f=new Uint8Array(24),[d,m,C]=u([c.length,s.length,f.length]);a.set(c,d),a.set(s,m),a.set(f,C);let y=n(d,c.length,m,C,12,3);if(y)throw r(d),new Error(`lerc-getBlobInfo: error code is ${y}`);a=new Uint8Array(i.buffer),gt(a,m,s),gt(a,C,f);const p=new Uint32Array(s.buffer),b=new Float64Array(f.buffer),[k,g,,w,v,S,x,T,A,I,E]=p,P={version:k,depthCount:I,width:w,height:v,validPixelCount:x,bandCount:S,blobSize:T,maskCount:A,dataType:g,minValue:b[0],maxValue:b[1],maxZerror:b[2],statistics:[],bandCountWithNoData:E};if(E&&I>1)return r(d),P;if(I===1&&S===1)return r(d),P.statistics.push({minValue:b[0],maxValue:b[1]}),P;const R=I*S*8,z=new Uint8Array(R),G=new Uint8Array(R);let B=d,U=0,K=0,O=!1;if(a.byteLength<d+2*R?(r(d),O=!0,[B,U,K]=u([c.length,R,R]),a.set(c,B)):[U,K]=u([R,R]),a.set(z,U),a.set(G,K),y=o(B,c.length,I,S,U,K),y)throw r(B),O||r(U),new Error(`lerc-getDataRanges: error code is ${y}`);a=new Uint8Array(i.buffer),gt(a,U,z),gt(a,K,G);const V=new Float64Array(z.buffer),N=new Float64Array(G.buffer),F=P.statistics;for(let J=0;J<S;J++)if(I>1){const j=V.slice(J*I,(J+1)*I),_=N.slice(J*I,(J+1)*I),W=Math.min.apply(null,j),tt=Math.max.apply(null,_);F.push({minValue:W,maxValue:tt,depthStats:{minValues:j,maxValues:_}})}else F.push({minValue:V[J],maxValue:N[J]});return r(B),O||r(U),P},Ht.decode=(c,s)=>{const{maskCount:f,depthCount:d,bandCount:m,width:C,height:y,dataType:p,bandCountWithNoData:b}=s,k=$e[p],g=C*y,w=new Uint8Array(g*m),v=g*d*m*k.size,S=new Uint8Array(v),x=new Uint8Array(m),T=new Uint8Array(8*m),[A,I,E,P,R]=u([c.length,w.length,S.length,x.length,T.length]);a.set(c,A),a.set(w,I),a.set(S,E),a.set(x,P),a.set(T,R);const z=l(A,c.length,f,I,d,C,y,m,p,E,P,R);if(z)throw r(A),new Error(`lerc-decode: error code is ${z}`);a=new Uint8Array(i.buffer),gt(a,E,S),gt(a,I,w);let G=null;if(b){gt(a,P,x),gt(a,R,T),G=[];const B=new Float64Array(T.buffer);for(let U=0;U<x.length;U++)G.push(x[U]?B[U]:null)}return r(A),{data:S,maskData:w,noDataValues:G}}}function uo(t,e,r,n,o){if(r<2)return t;const l=new n(e*r);for(let h=0,a=0;h<e;h++)for(let i=0,u=h;i<r;i++,u+=e)l[u]=t[a++];return l}function er(t,e={}){const r=e.inputOffset??0,n=t instanceof Uint8Array?t.subarray(r):new Uint8Array(t,r),o=Ht.getBlobInfo(n),{data:l,maskData:h,noDataValues:a}=Ht.decode(n,o),{width:i,height:u,bandCount:c,depthCount:s,dataType:f,maskCount:d,statistics:m}=o,C=$e[f],y=new C.ctor(l.buffer),p=[],b=[],k=i*u,g=k*s;for(let A=0;A<c;A++){const I=y.subarray(A*g,(A+1)*g);if(e.returnInterleaved)p.push(I);else{const E=uo(I,k,s,C.ctor);p.push(E)}b.push(h.subarray(A*g,(A+1)*g))}const w=d===0?null:d===1?b[0]:new Uint8Array(k);if(d>1){w.set(b[0]);for(let A=1;A<b.length;A++){const I=b[A];for(let E=0;E<k;E++)w[E]=w[E]&I[E]}}const{noDataValue:v}=e,S=v!=null&&C.range[0]<=v&&C.range[1]>=v;if(d>0&&S)for(let A=0;A<c;A++){const I=p[A],E=b[A]||w;for(let P=0;P<k;P++)E[P]===0&&(I[P]=v)}const x=d===c&&c>1?b:null,{pixelType:T}=C;return{width:i,height:u,bandCount:c,pixelType:T,depthCount:s,statistics:m,pixels:p,mask:w,bandMasks:x,noDataValues:a}}function co(t,e,r,n=!0){if(e%4!=0||r%4!=0){const o=new ArrayBuffer(4*Math.ceil(r/4)),l=new Uint8Array(o),h=new Uint8Array(t,e,r);if(n)for(let a=0;a<l.length;a+=4)l[a]=h[a+3],l[a+1]=h[a+2],l[a+2]=h[a+1],l[a+3]=h[a];else l.set(h);return new Uint32Array(l.buffer)}if(n){const o=new Uint8Array(t,e,r),l=new Uint8Array(o.length);for(let h=0;h<l.length;h+=4)l[h]=o[h+3],l[h+1]=o[h+2],l[h+2]=o[h+1],l[h+3]=o[h];return new Uint32Array(l.buffer)}return new Uint32Array(t,e,r/4)}function rr(){const t=[];for(let e=0;e<=257;e++)t[e]=[e];return t}function or(t,e){for(let r=0;r<e.length;r++)t.push(e[r])}const kt=new Set;function de(t,e,r,n=!0){const o=co(t,e,r,n);let l=9,h=rr(),a=32,i=h.length,u=[],c=1,s=o[0],f=0;const d=o.length,m=8*(4*d-r),C=[];for(;s!=null;){if(a>=l)a-=l,f=s>>>32-l,s<<=l;else{f=s>>>32-a,s=o[c++];const p=l-a;a=32-p,f=(f<<p)+(s>>>a),s<<=p}if(f===257)break;if(f===256){l=9,h=rr(),i=h.length,u=[];continue}const y=h[f];if(y==null){if(f>h.length)throw new Error("data integrity issue: code does not exist on code page");u.push(u[0]),h[i++]=u.slice(),or(C,u)}else or(C,y),u.push(y[0]),u.length>1&&(h[i++]=u.slice()),u=y.slice();if(kt.has(i)&&l++,a===0&&(s=o[c++],a=32),c>d||c===d&&a<=m)break}return new Uint8Array(C)}kt.add(511),kt.add(1023),kt.add(2047),kt.add(4095),kt.add(8191);const ho=new Set(["uint8","int8","uint16","int16","uint32","int32","int64","uint64"]),nr=new Map([["uint8",{byteCount:1,ctor:Uint8Array}],["int8",{byteCount:1,ctor:Int8Array}],["uint16",{byteCount:2,ctor:Uint16Array}],["int16",{byteCount:2,ctor:Int16Array}],["uint32",{byteCount:4,ctor:Uint32Array}],["int32",{byteCount:4,ctor:Int32Array}],["uint64",{byteCount:8,ctor:BigUint64Array}],["int64",{byteCount:8,ctor:BigInt64Array}]]);let ir;function fo(){return ir??=import("./qb3-wasm-BS23zyI8.js").then(({default:t})=>t({locateFile:e=>Pe(`esri/layers/support/rasterFormats/${e}`)})).then(t=>{po(t)}),ir}const Wt={getBlobInfo:null,decode:null};function ar(t){if(!nr.has(t))throw new Error("Unsupported data type: "+t);return nr.get(t)}function po(t){const{_GetInfo:e,_decode:r,_malloc:n,_free:o,writeArrayToMemory:l,UTF8ToString:h}=t;Wt.getBlobInfo=a=>{a.length>1e3&&(a=a.slice(0,1e3));const i=n(a.length);l(a,i);const u=e(i,a.length);if(o(i),!u)return null;const c=h(u);o(u);try{const s=JSON.parse(c);return{width:s.xsize,height:s.ysize,bandCount:s.nbands,dataType:s.dtype,mode:s.mode,bandMap:s.bandmap}}catch{return null}},Wt.decode=(a,i)=>{const{dataType:u,width:c,height:s,bandCount:f}=i;if(!ho.has(u))throw new Error("Unsupported data type: "+u);const{_malloc:d,_free:m}=t,C=d(a.length);t.writeArrayToMemory(a,C);const{ctor:y,byteCount:p}=ar(u),b=c*s*f*p,k=d(b),g=d(1024);if(r(C,a.length,k,g)===0)throw m(C),m(k),m(g),new Error("Decoding failed: "+t.UTF8ToString(g));const w=new y(t.HEAPU8.slice(k,k+b).buffer);if(m(C),m(k),m(g),w instanceof BigInt64Array||w instanceof BigUint64Array){const v=new Float64Array(w.length);for(let S=0;S<w.length;S++)v[S]=Number(w[S]);return v}return w}}function mo(t){const e=new Uint8Array(t),r=Wt.getBlobInfo(e);if(!r)return null;const n=Wt.decode(e,r);if(!n)return null;const{width:o,height:l,bandCount:h,dataType:a}=r,{ctor:i}=ar(a),u=i===BigInt64Array||i===BigUint64Array?Float64Array:i,c=Array.from({length:h},()=>new u(o*l));for(let s=0,f=0;s<o*l;s++)for(let d=0;d<h;d++)c[d][s]=n[f++];return{width:o,height:l,pixels:c}}const sr=(t,e)=>{const r=e.width*e.height,n=e.pixelType;return Math.floor(t.byteLength/(r*lr(n)))},lr=t=>{let e=1;switch(t){case Uint8Array:case Int8Array:e=1;break;case Uint16Array:case Int16Array:e=2;break;case Uint32Array:case Int32Array:case Float32Array:e=4;break;case Float64Array:e=8}return e},go=(t,e)=>{if(8*t.byteLength<e)return null;const r=new Uint8Array(t,0,Math.ceil(e/8)),n=new Uint8Array(e);let o=0,l=0,h=0,a=0;for(h=0;h<r.length-1;h++)for(l=r[h],a=7;a>=0;a--)n[o++]=l>>a&1;for(a=7;o<e-1;)l=r[r.length-1],n[o++]=l>>a&1,a--;return n};let yo=class{static decode(t,e){const r=e.pixelType,n=[],o=e.width*e.height,l=sr(t,e),{bandIds:h,format:a}=e,i=h?.length||sr(t,e),u=t.byteLength-t.byteLength%(o*lr(r)),c=new r(t,0,o*l);let s,f,d,m,C=null;if(a==="bip")for(s=0;s<i;s++){for(d=new r(o),m=h?h[s]:s,f=0;f<o;f++)d[f]=c[f*l+m];n.push(d)}else if(a==="bsq")for(s=0;s<i;s++)m=h?h[s]:s,n.push(c.subarray(m*o,(m+1)*o));return u<t.byteLength-1&&(C=go(t.slice(u),o)),{pixels:n,mask:C}}};function ur(t,e){let r=0,n="",o=0,l=0;const h=t.length;for(;r<h;)l=t[r++],o=l>>4,o<8?o=1:o===15?(o=4,l=(7&l)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++]):o===14?(o=3,l=(15&l)<<12|(63&t[r++])<<6|63&t[r++]):(o=2,l=(31&l)<<6|63&t[r++]),(l!==0||e)&&(n+=String.fromCharCode(l));return n}const It=(()=>{const t=[];return t[254]="NEWSUBFILETYPE",t[255]="SUBFILETYPE",t[256]="IMAGEWIDTH",t[257]="IMAGELENGTH",t[258]="BITSPERSAMPLE",t[259]="COMPRESSION",t[262]="PHOTOMETRICINTERPRETATION",t[263]="THRESHHOLDING",t[264]="CELLWIDTH",t[265]="CELLLENGTH",t[266]="FILLORDER",t[269]="DOCUMENTNAME",t[270]="IMAGEDESCRIPTION",t[271]="MAKE",t[272]="MODEL",t[273]="STRIPOFFSETS",t[274]="ORIENTATION",t[277]="SAMPLESPERPIXEL",t[278]="ROWSPERSTRIP",t[279]="STRIPBYTECOUNTS",t[280]="MINSAMPLEVALUE",t[281]="MAXSAMPLEVALUE",t[282]="XRESOLUTION",t[283]="YRESOLUTION",t[284]="PLANARCONFIGURATION",t[285]="PAGENAME",t[286]="XPOSITION",t[287]="YPOSITION",t[288]="FREEOFFSETS",t[289]="FREEBYTECOUNTS",t[290]="GRAYRESPONSEUNIT",t[291]="GRAYRESPONSECURVE",t[292]="T4OPTIONS",t[293]="T6OPTIONS",t[296]="RESOLUTIONUNIT",t[297]="PAGENUMBER",t[300]="COLORRESPONSEUNIT",t[301]="TRANSFERFUNCTION",t[305]="SOFTWARE",t[306]="DATETIME",t[315]="ARTIST",t[316]="HOSTCOMPUTER",t[317]="PREDICTOR",t[318]="WHITEPOINT",t[319]="PRIMARYCHROMATICITIES",t[320]="COLORMAP",t[321]="HALFTONEHINTS",t[322]="TILEWIDTH",t[323]="TILELENGTH",t[324]="TILEOFFSETS",t[325]="TILEBYTECOUNTS",t[326]="BADFAXLINES",t[327]="CLEANFAXDATA",t[328]="CONSECUTIVEBADFAXLINES",t[330]="SUBIFD",t[332]="INKSET",t[333]="INKNAMES",t[334]="NUMBEROFINKS",t[336]="DOTRANGE",t[337]="TARGETPRINTER",t[338]="EXTRASAMPLES",t[339]="SAMPLEFORMAT",t[340]="SMINSAMPLEVALUE",t[341]="SMAXSAMPLEVALUE",t[342]="TRANSFERRANGE",t[347]="JPEGTABLES",t[512]="JPEGPROC",t[513]="JPEGIFOFFSET",t[514]="JPEGIFBYTECOUNT",t[515]="JPEGRESTARTINTERVAL",t[517]="JPEGLOSSLESSPREDICTORS",t[518]="JPEGPOINTTRANSFORM",t[519]="JPEGQTABLES",t[520]="JPEGDCTABLES",t[521]="JPEGACTABLES",t[529]="YCBCRCOEFFICIENTS",t[530]="YCBCRSUBSAMPLING",t[531]="YCBCRPOSITIONING",t[532]="REFERENCEBLACKWHITE",t[700]="XMP",t[33550]="GEOPIXELSCALE",t[33922]="GEOTIEPOINTS",t[33432]="COPYRIGHT",t[42112]="GDAL_METADATA",t[42113]="GDAL_NODATA",t[50844]="RPCCOEFFICIENT",t[34264]="GEOTRANSMATRIX",t[34735]="GEOKEYDIRECTORY",t[34736]="GEODOUBLEPARAMS",t[34737]="GEOASCIIPARAMS",t[34665]="EXIFIFD",t[34853]="GPSIFD",t[40965]="INTEROPERABILITYIFD",t})(),Co=(()=>{const t=It.slice();return t[36864]="ExifVersion",t[40960]="FlashpixVersion",t[40961]="ColorSpace",t[42240]="Gamma",t[37121]="ComponentsConfiguration",t[37122]="CompressedBitsPerPixel",t[40962]="PixelXDimension",t[40963]="PixelYDimension",t[37500]="MakerNote",t[37510]="UserComment",t[40964]="RelatedSoundFile",t[36867]="DateTimeOriginal",t[36868]="DateTimeDigitized",t[36880]="OffsetTime",t[36881]="OffsetTimeOriginal",t[36882]="OffsetTimeDigitized",t[37520]="SubSecTime",t[37521]="SubSecTimeOriginal",t[37522]="SubSecTimeDigitized",t[37888]="Temperature",t[37889]="Humidity",t[37890]="Pressure",t[37891]="WaterDepth",t[37892]="Acceleration",t[37893]="CameraElevationAngle",t[42016]="ImageUniqueID",t[42032]="CameraOwnerName",t[42033]="BodySerialNumber",t[42034]="LensSpecification",t[42035]="LensMake",t[42036]="LensModel",t[42037]="LensSerialNumber",t[33434]="ExposureTime",t[33437]="FNumber",t[34850]="ExposureProgram",t[34852]="SpectralSensitivity",t[34855]="PhotographicSensitivity",t[34856]="OECF",t[34864]="SensitivityType",t[34865]="StandardOutputSensitivity",t[34866]="RecommendedExposureIndex",t[34867]="ISOSpeed",t[34868]="ISOSpeedLatitudeyyy",t[34869]="ISOSpeedLatitudezzz",t[37377]="ShutterSpeedValue",t[37378]="ApertureValue",t[37379]="BrightnessValue",t[37380]="ExposureBiasValue",t[37381]="MaxApertureValue",t[37382]="SubjectDistance",t[37383]="MeteringMode",t[37384]="LightSource",t[37385]="Flash",t[37386]="FocalLength",t[37396]="SubjectArea",t[41483]="FlashEnergy",t[41484]="SpatialFrequencyResponse",t[41486]="FocalPlaneXResolution",t[41487]="FocalPlaneYResolution",t[41488]="FocalPlaneResolutionUnit",t[41492]="SubjectLocation",t[41493]="ExposureIndex",t[41495]="SensingMethod",t[41728]="FileSource",t[41729]="SceneType",t[41730]="CFAPattern",t[41985]="CustomRendered",t[41986]="ExposureMode",t[41987]="WhiteBalance",t[41988]="DigitalZoomRatio",t[41989]="FocalLengthIn35mmFilm",t[41990]="SceneCaptureType",t[41991]="GainControl",t[41992]="Contrast",t[41993]="Saturation",t[41994]="Sharpness",t[41995]="DeviceSettingDescription",t[41996]="SubjectDistanceRange",t})(),bo=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],cr=(()=>{const t=[];return t[1024]="GTModelTypeGeoKey",t[1025]="GTRasterTypeGeoKey",t[1026]="GTCitationGeoKey",t[2048]="GeographicTypeGeoKey",t[2049]="GeogCitationGeoKey",t[2050]="GeogGeodeticDatumGeoKey",t[2051]="GeogPrimeMeridianGeoKey",t[2052]="GeogLinearUnitsGeoKey",t[2053]="GeogLinearUnitSizeGeoKey",t[2054]="GeogAngularUnitsGeoKey",t[2055]="GeogAngularUnitSizeGeoKey",t[2056]="GeogEllipsoidGeoKey",t[2057]="GeogSemiMajorAxisGeoKey",t[2058]="GeogSemiMinorAxisGeoKey",t[2059]="GeogInvFlatteningGeoKey",t[2061]="GeogPrimeMeridianLongGeoKey",t[2060]="GeogAzimuthUnitsGeoKey",t[3072]="ProjectedCSTypeGeoKey",t[3073]="PCSCitationGeoKey",t[3074]="ProjectionGeoKey",t[3075]="ProjCoordTransGeoKey",t[3076]="ProjLinearUnitsGeoKey",t[3077]="ProjLinearUnitSizeGeoKey",t[3078]="ProjStdParallel1GeoKey",t[3079]="ProjStdParallel2GeoKey",t[3080]="ProjNatOriginLongGeoKey",t[3081]="ProjNatOriginLatGeoKey",t[3082]="ProjFalseEastingGeoKey",t[3083]="ProjFalseNorthingGeoKey",t[3084]="ProjFalseOriginLongGeoKey",t[3085]="ProjFalseOriginLatGeoKey",t[3086]="ProjFalseOriginEastingGeoKey",t[3087]="ProjFalseOriginNorthingGeoKey",t[3088]="ProjCenterLongGeoKey",t[3090]="ProjCenterEastingGeoKey",t[3091]="ProjCenterNorthingGeoKey",t[3092]="ProjScaleAtNatOriginGeoKey",t[3093]="ProjScaleAtCenterGeoKey",t[3094]="ProjAzimuthAngleGeoKey",t[3095]="ProjStraightVertPoleLongGeoKey",t[4096]="VerticalCSTypeGeoKey",t[4097]="VerticalCitationGeoKey",t[4098]="VerticalDatumGeoKey",t[4099]="VerticalUnitsGeoKey",t})(),wo=(t,e)=>{let r=(e||It)[t];return r===void 0&&(r="unknown"+String(t)),r},vo=new Map([["EXIFIFD",Co],["GPSIFD",bo]]),Kt=(()=>{const t=new ArrayBuffer(4),e=new Uint8Array(t);return new Uint32Array(t)[0]=1,e[0]===1})(),hr=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Et=4294967296,To=new Set([1,5,6,7,8,34712,34887]);function pe(t,e){let r="unknown";return t===3?r=e===64?"f64":"f32":t===1?e===1?r="u1":e===2?r="u2":e===4?r="u4":e<=8?r="u8":e<=16?r="u16":e<=32&&(r="u32"):t===2&&(e<=8?r="s8":e<=16?r="s16":e<=32&&(r="s32")),r}function qt(t){let e=null;switch(t?t.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f64":e=Float64Array;break;default:e=Float32Array}return e}function Ao(t,e){return{x:e[0]*t.x+e[1]*t.y+e[2],y:e[3]*t.x+e[4]*t.y+e[5]}}function fr(t,e){return t.get(e)?.values}function At(t,e){return t.get(e)?.values}function dr(t,e){return t.get(e)?.values?.[0]}function H(t,e){return t.get(e)?.values?.[0]}function me(t,e,r,n=0,o=It,l=4){const h=l===8,a=h?Te(new DataView(t,r,8),0,e):new DataView(t,r,2).getUint16(0,e),i=4+2*l,u=h?8:2,c=u+a*i;if(r+c>t.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:c};const s=l===8?8:4,f=r+c+s<=t.byteLength?Yt(new DataView(t,r+c,s),0,e,l===8):null,d=r+u,m=new Map;let C,y,p,b,k,g=0,w=0;for(let v=0;v<a;v++){y=new DataView(t,d+i*v,i),p=y.getUint16(0,e),k=y.getUint16(2,e),b=wo(p,o);const S=[];l===2?(g=y.getUint16(4,e),w=y.getUint16(6,e)):l===4?(g=y.getUint32(4,e),w=y.getUint32(8,e)):l===8&&(g=Yt(y,4,e,!0),w=Yt(y,12,e,!0),S.push(y.getUint32(12,e)),S.push(y.getUint32(16,e))),C={id:p,type:k,valueCount:g,valueOffset:w,valueOffsets:S,values:null},mr(t,e,C,n,!1,l),m.set(b,C)}return{success:!0,ifd:m,nextIFD:f,requiredBufferSize:c}}const So=(t,e)=>er(t,{inputOffset:e}).pixels[0];function ge(t,e){if(e%8==0)return t;const r=e>16?32:e>8?16:8;r>8&&(t=pr(t,r===32?4:2));const n=r===32?Uint32Array:r===16?Uint16Array:Uint8Array,o=new n(t),l=Math.floor(8*t.byteLength/e+1e-6),h=new n(l),a=(1<<e)-1;let i=0,u=0,c=0;for(let s=0;s<l;s++)if(u===0&&(c=o[i++],u=r),u>=e)h[s]=c>>>u-e&a,u-=e;else{const f=e-u;let d=(c&a)<<f&a;c=o[i++],u=r-f,d+=c>>>u,h[s]=d}return h.buffer}function ye(t,e,r){const n=new Qe;n.parse(t),n.colorTransform=r===6?-1:0;const o=n.getData(n.width,n.height,e!==1&&e!==4);return new Uint8Array(o.buffer)}function Ce(t){const e=new Dt(t).getBytes(),r=new ArrayBuffer(e.length),n=new Uint8Array(r);return n.set(e),n}function pr(t,e){const r=new Uint8Array(t),n=new Uint8Array(r.length);if(e===2)for(let o=0;o<r.length;o+=2)n[o]=r[o+1],n[o+1]=r[o];else if(e===4)for(let o=0;o<r.length;o+=4)n[o]=r[o+3],n[o+1]=r[o+2],n[o+2]=r[o+1],n[o+3]=r[o];else for(let o=0;o<r.length;o+=8)n[o]=r[o+7],n[o+1]=r[o+6],n[o+2]=r[o+5],n[o+3]=r[o+4],n[o+4]=r[o+3],n[o+5]=r[o+2],n[o+6]=r[o+1],n[o+7]=r[o];return n.buffer}async function be(t,e,r,n,o){const l=Kt===e,h=H(r,"BITSPERSAMPLE"),a=H(r,"SAMPLESPERPIXEL")??1,i=H(r,"PHOTOMETRICINTERPRETATION"),u=H(r,"SAMPLEFORMAT")??1,c=pe(u,h),s=H(r,"COMPRESSION")??1,f=qt(c);let d,m,C;if(s===34887)return await tr(),So(t,n);if(s===1)d=t.slice(n,n+o),m=new Uint8Array(d);else if(s===8||s===32946)m=new Uint8Array(t,n,o),m=Ce(m),d=m.buffer;else if(s===6)m=new Uint8Array(t,n,o),m=ye(m,a,i),d=m.buffer;else if(s===7){const k=r.get("JPEGTABLES").values,g=k.length-2;m=new Uint8Array(g+o-2);for(let v=0;v<g;v++)m[v]=k[v];const w=new Uint8Array(t,n+2,o-2);for(let v=0;v<w.length;v++)m[g+v]=w[v];m=ye(m,a,i),d=m.buffer}else{if(s!==5)throw new Error("tiff-decode: unsupport compression "+s);m=de(t,n,o,e),d=m.buffer}if(d=ge(d,h),l||h<=8)C=new f(d);else{const k=h>32?8:h>16?4:2;C=new f(pr(m.buffer,k))}const y=H(r,"PREDICTOR")??1,p=H(r,"TILEWIDTH"),b=H(r,"TILELENGTH");if(y>1&&(s===5||s===8||s===32946)&&p&&b){const k=Bt(r),g=new f(C.length);g.set(C),C=Lo(g,b,p,u===3&&y===3,k?1:a)}return C}async function xo(t,e,r){const n=At(r,"TILEOFFSETS");if(n===void 0)return null;const o=At(r,"TILEBYTECOUNTS"),{width:l,height:h,pixelType:a,tileWidth:i,tileHeight:u}=Jt([r]),c=Bt(r,e),s=H(r,"SAMPLESPERPIXEL")||e.planes,f=l*h,d=H(r,"BITSPERSAMPLE"),m=(H(r,"COMPRESSION")??1)===34887,C=qt(a),y=[];for(let B=0;B<s;B++)y.push(new C(f));let p,b,k,g,w,v,S,x,T,A,I,E,P;const R=Math.ceil(l/i),z=new Uint8Array(f).fill(255);let G=!1;if(d%8==0)if(m&&c&&s>1){const B=Math.round(n.length/s);for(p=0;p<B;p++){v=Math.floor(p/R)*u,S=p%R*i,x=v*l+S;for(let U=0;U<s;U++){const K=p*s+U;for(o[K]===0?(k=null,G=!0):k=await be(t,e.littleEndian,r,n[K],o[K]),A=0,T=x,E=Math.min(i,l-S),I=Math.min(u,h-v),P=y[U],g=0;g<I;g++)for(T=x+g*l,A=g*i,w=0;w<E;w++,T++,A++)k?P[T]=k[A]:z[T]=0}}}else for(p=0;p<n.length;p++)for(v=Math.floor(p/R)*u,S=p%R*i,x=v*l+S,o[p]===0?(k=null,G=!0):k=await be(t,e.littleEndian,r,n[p],o[p]),A=0,T=x,E=Math.min(i,l-S),I=Math.min(u,h-v),b=0;b<s;b++)if(P=y[b],c||m)for(g=0;g<I;g++)for(T=x+g*l,A=i*u*b+g*i,w=0;w<E;w++,T++,A++)k?P[T]=k[A]:z[T]=0;else for(g=0;g<I;g++)for(T=x+g*l,A=g*i*s+b,w=0;w<E;w++,T++,A+=s)k?P[T]=k[A]:z[T]=0;return{width:l,height:h,pixelType:a,pixels:y,mask:G?z:void 0}}const ko=(t,e,r)=>{const n=Kt===e.littleEndian,o=At(r,"STRIPOFFSETS");if(o===void 0)return null;const{width:l,height:h,pixelType:a}=Jt([r]),i=H(r,"SAMPLESPERPIXEL")||e.planes,u=H(r,"PHOTOMETRICINTERPRETATION"),c=l*h,s=H(r,"BITSPERSAMPLE"),f=qt(a),d=new f(c*i),m=At(r,"STRIPBYTECOUNTS"),C=H(r,"ROWSPERSTRIP"),y=H(r,"COMPRESSION")??1;let p,b,k,g,w,v,S,x,T;if(s%8==0)for(p=0;p<o.length;p++){if(w=p*(C*l)*i,a==="u8"||a==="s8"||n)y===8||y===32946?(S=new Uint8Array(t,o[p],m[p]),S=Ce(S),v=S.buffer):y===6?(S=new Uint8Array(t,o[p],m[p]),S=ye(S,i,u),v=S.buffer):y===5?(S=de(t,o[p],m[p],e.littleEndian),v=S.buffer):v=t.slice(o[p],o[p]+m[p]),v=ge(v,s),g=new f(v);else{switch(y===6||y===8||y===32946?(S=new Uint8Array(t,o[p],m[p]),x=Ce(S),v=x.buffer):(v=new ArrayBuffer(m[p]),S=new Uint8Array(t,o[p],m[p]),x=new Uint8Array(v)),a){case"u16":case"s16":for(k=0;k<S.length;k+=2)x[k]=S[k+1],x[k+1]=S[k];break;case"u32":case"s32":case"f32":for(k=0;k<S.length;k+=4)x[k]=S[k+3],x[k+1]=S[k+2],x[k+2]=S[k+1],x[k+3]=S[k]}v=ge(v,s),g=new f(v)}d.set(g,w)}const A=[];if(i===1)A.push(d);else for(p=0;p<i;p++){for(T=new f(c),b=0;b<c;b++)T[b]=d[b*i+p];A.push(T)}return{width:l,height:h,pixelType:a,pixels:A}},Io=(t,e,r)=>{if(!(t&&t.length>0&&e&&r))return null;let n,o,l;const h=t[0].length,a=t.length,i=new Uint8Array(h);for(let u=0;u<a;u++)if(n=t[u],o=e[u],l=r[u],u===0)for(let c=0;c<h;c++)i[c]=n[c]<o||n[c]>l?0:1;else for(let c=0;c<h;c++)i[c]&&(i[c]=n[c]<o||n[c]>l?0:1);return i},Eo=t=>{if(!t)return null;const e=t.match(/<Item(.*?)Item>/gi);if(!e||e.length===0)return null;const r=new Map;let n,o,l,h,a;for(let p=0;p<e.length;p++)n=e[p],o=n.slice(6,n.indexOf(">")),h=n.indexOf("sample="),h>-1&&(a=n.slice(h+8,n.indexOf('"',h+8))),h=n.indexOf("name="),h>-1&&(o=n.slice(h+6,n.indexOf('"',h+6))),o&&(l=n.slice(n.indexOf(">")+1,n.indexOf("</Item>")).trim(),a!=null?r.has(o)?r.get(o)[a]=l:r.set(o,[l]):r.set(o,l)),a=null;const i=r.get("STATISTICS_MINIMUM"),u=r.get("STATISTICS_MAXIMUM"),c=r.get("STATISTICS_MEAN"),s=r.get("STATISTICS_STDDEV");let f=null;if(i&&u){f=[];for(let p=0;p<i.length;p++)f.push({min:parseFloat(i[p]),max:parseFloat(u[p]),avg:c&&parseFloat(c[p]),stddev:s&&parseFloat(s[p])})}const d=r.get("BandName"),m=r.get("WavelengthMin"),C=r.get("WavelengthMax");let y=null;if(d){y=[];for(let p=0;p<d.length;p++)y.push({BandName:d[p],WavelengthMin:m&&parseFloat(m[p]),WavelengthMax:C&&parseFloat(C[p])})}return{statistics:f,bandProperties:y,dataType:r.get("DataType"),rawMetadata:r}};function mr(t,e,r,n=0,o=!1,l=4){if(r.values)return!0;const h=r.type,a=r.valueCount;let i=r.valueOffset,u=[];const c=hr[h],s=8*c,f=a*c,d=a*hr[h]*8;let m,C;const y=l===8?64:32,p=r.valueOffsets;if(d>y&&f>(o?t.byteLength:t?t.byteLength-i+n:0))return r.offlineOffsetSize=[i,f],r.values=null,!1;if(d<=y){if(!e)if(y<=32)i>>>=32-d;else{const b=p?.length?p[0]:i>>>0,k=p?.length?p[1]:Math.round((i-b)/Et);d<=32?(i=b>>>32-d,p[0]=i):(i=b*2**(32-d)+(k>>>32-d),p[0]=b,p[1]=k>>>32-d)}if(a===1&&s===y)u=[i];else if(y===64){const b=p?.length?p[0]:i>>>0,k=p?.length?p[1]:Math.round((i-b)/Et);let g=b,w=32;for(C=1;C<=a;C++){const v=32-s*C%32;if(w<s){const S=g<<v>>>32-w,x=k<<32-w>>>32-w;g=k,u.push(S+x*2**(s-w)),w-=32-(s-w)}else u.push(g<<v>>>32-s),w-=s;w===0&&(w=32,g=k)}}else for(C=1;C<=a;C++){const b=32-s*C;u.push(i<<b>>>32-s)}}else{i-=n,o&&(i=0);for(let b=i;b<i+f;b+=c){switch(h){case 1:case 2:case 7:m=new DataView(t,b,1).getUint8(0);break;case 3:m=new DataView(t,b,2).getUint16(0,e);break;case 4:case 13:m=new DataView(t,b,4).getUint32(0,e);break;case 5:m=new DataView(t,b,4).getUint32(0,e)/new DataView(t,b+4,4).getUint32(0,e);break;case 6:m=new DataView(t,b,1).getInt8(0);break;case 8:m=new DataView(t,b,2).getInt16(0,e);break;case 9:m=new DataView(t,b,4).getInt32(0,e);break;case 10:m=new DataView(t,b,4).getInt32(0,e)/new DataView(t,b+4,4).getInt32(0,e);break;case 11:m=new DataView(t,b,4).getFloat32(0,e);break;case 12:m=new DataView(t,b,8).getFloat64(0,e);break;case 16:case 18:m=Te(new DataView(t,b,8),0,e);break;case 17:m=Ro(new DataView(t,b,8),0,e);break;default:m=null}u.push(m)}}if(h===2){let b="";const k=u;for(u=[],C=0;C<k.length;C++)k[C]===0&&b!==""?(u.push(b),b=""):b+=String.fromCharCode(k[C]);b===""&&u.length!==0||u.push(b)}return r.values=u,!0}function Jt(t){const e=t[0],r=H(e,"TILEWIDTH"),n=H(e,"TILELENGTH"),o=H(e,"IMAGEWIDTH"),l=H(e,"IMAGELENGTH"),h=H(e,"BITSPERSAMPLE"),a=H(e,"SAMPLESPERPIXEL"),i=H(e,"SAMPLEFORMAT")??1,u=pe(i,h),c=Bt(e),s=fr(e,"GDAL_NODATA");let f=null;s?.length&&(f=s.map(V=>parseFloat(V)),f.some(V=>isNaN(V))&&(f=null));const d=H(e,"COMPRESSION")??1;let m;switch(d){case 1:m="NONE";break;case 2:case 3:case 4:case 32771:m="CCITT";break;case 5:m="LZW";break;case 6:case 7:m="JPEG";break;case 32773:m="PACKBITS";break;case 8:case 32946:m="DEFLATE";break;case 34712:m="JPEG2000";break;case 34887:m="LERC";break;default:m=String(d)}let C=!0,y="";To.has(d)||(C=!1,y+="unsupported tag compression "+d),i>3&&(C=!1,y+="unsupported tag sampleFormat "+i),h>32&&h!==64&&(C=!1,y+="unsupported tag bitsPerSample "+h);const p=dr(e,"GEOASCIIPARAMS");let b;if(p){const V=p.split("|").find(F=>F.includes("ESRI PE String = ")),N=V?V.replace("ESRI PE String = ",""):"";b=N.startsWith("COMPD_CS")||N.startsWith("PROJCS")||N.startsWith("GEOGCS")?{wkid:null,wkt:N}:null}const k=At(e,"GEOTIEPOINTS"),g=At(e,"GEOPIXELSCALE"),w=At(e,"GEOTRANSMATRIX"),v=e.has("GEOKEYDIRECTORY")?e.get("GEOKEYDIRECTORY").data:null;let S,x,T=!1,A=!1;if(v){T=H(v,"GTRasterTypeGeoKey")===2;const V=H(v,"GTModelTypeGeoKey");if(V===2){const N=H(v,"GeographicTypeGeoKey");N>=1024&&N<=32766&&(b={wkid:N}),b||N!==32767||(A=!0,b={wkid:4326})}else if(V===1){const N=H(v,"ProjectedCSTypeGeoKey");N>=1024&&N<=32766&&(b={wkid:N})}}if(g&&k&&k.length>=6?(S=[g[0],0,k[3]-k[0]*g[0],0,-Math.abs(g[1]),k[4]-k[1]*g[1]],T&&(S[2]-=.5*S[0]+.5*S[1],S[5]-=.5*S[3]+.5*S[4])):w&&w.length===16&&(S=T?[w[0],w[1],w[3]-.5*w[0],w[4],w[5],w[7]-.5*w[5]]:[w[0],w[1],w[3],w[4],w[5],w[7]]),S){const V=[{x:0,y:l},{x:0,y:0},{x:o,y:l},{x:o,y:0}];let N,F=Number.POSITIVE_INFINITY,J=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,_=Number.NEGATIVE_INFINITY;for(let W=0;W<V.length;W++)N=Ao(V[W],S),F=N.x>F?F:N.x,j=N.x<j?j:N.x,J=N.y>J?J:N.y,_=N.y<_?_:N.y;x={xmin:F,xmax:j,ymin:J,ymax:_,spatialReference:b}}else x={xmin:-.5,ymin:.5-l,xmax:o-.5,ymax:.5,spatialReference:b};A&&(x.xmax-x.xmin>400||Math.max(Math.abs(x.xmin),Math.abs(x.xmax))>361)&&(b=null,x.spatialReference=null);const I=we(t);let E,P,R,z,G;if(I.length>0){R=Math.round(Math.log(o/H(I[0],"IMAGEWIDTH"))/Math.LN2);const V=I[I.length-1];z=I.length,E=H(V,"TILEWIDTH"),P=H(V,"TILELENGTH")}E=z!=null&&z>0?E||r:null,P=z!=null&&z>0?P||n:null,r&&(G=[{maxCol:Math.ceil(o/r)-1,maxRow:Math.ceil(l/n)-1,minRow:0,minCol:0}],I.forEach(V=>{G.push({maxCol:Math.ceil(H(V,"IMAGEWIDTH")/H(V,"TILEWIDTH"))-1,maxRow:Math.ceil(H(V,"IMAGELENGTH")/H(V,"TILELENGTH"))-1,minRow:0,minCol:0})}));const B=dr(t[0],"GDAL_METADATA"),U=Eo(B);y+=" "+Cr({width:o,height:l,tileWidth:r,tileHeight:n,planes:a,ifds:t});const K=ve(t).length===I.length+1,O=I?.length?I.map(V=>({x:o/H(V,"IMAGEWIDTH"),y:l/H(V,"IMAGELENGTH")})):void 0;return{width:o,height:l,tileWidth:r,tileHeight:n,planes:a,isBSQ:c,pixelType:u,compression:m,noData:f,hasMaskBand:K,isSupported:C,pyramidResolutions:O,message:y,extent:x,isPseudoGeographic:A,affine:g?null:S,firstPyramidLevel:R,maximumPyramidLevel:z,pyramidBlockWidth:E,pyramidBlockHeight:P,tileBoundary:G,metadata:U}}function Bt(t,e){const r=fr(t,"PLANARCONFIGURATION");return r?r[0]===2:!!e&&e.isBSQ}function we(t){return t.filter(e=>H(e,"NEWSUBFILETYPE")===1)}function ve(t){return t.filter(e=>{const r=!(4&~(H(e,"NEWSUBFILETYPE")??0)),n=H(e,"PHOTOMETRICINTERPRETATION")===4;return r&&n})}function Po(t){const{littleEndian:e,isBigTiff:r,firstIFDPos:n}=gr(t);let o=n;const l=[];do{const h=yr(t,e,o,0,It,r?8:4);if(!h.success)break;l.push(h.ifd),o=h.nextIFD}while(o>0);return{...Jt(l),littleEndian:e,isBigTiff:r,ifds:l,pyramidIFDs:we(l),maskIFDs:ve(l)}}function Te(t,e,r){const n=t.getUint32(e,r),o=t.getUint32(e+4,r);return r?o*Et+n:n*Et+o}function Ro(t,e,r){let n=r?t.getInt32(e,r):t.getUint32(e,r),o=r?t.getUint32(e+4,r):t.getInt32(e+4,r);const l=(r?n:o)>=0?1:-1;return r?n*=l:o*=l,l*(r?o*Et+n:n*Et+o)}function Yt(t,e,r,n){return n?Te(t,e,r):t.getUint32(e,r)}function gr(t){const e=new DataView(t,0,16),r=e.getUint16(0,!1);let n=null;if(r===18761)n=!0;else{if(r!==19789)throw new Error("unexpected endianess byte");n=!1}const o=e.getUint16(2,n);if(o!==42&&o!==43)throw new Error("unexpected tiff identifier");let l=4;const h=o===43;if(h){const a=e.getUint16(l,n);if(l+=2,a!==8)throw new Error("unsupported bigtiff version");if(e.getUint16(l,n)!==0)throw new Error("unsupported bigtiff version");l+=2}return{littleEndian:n,isBigTiff:h,firstIFDPos:Yt(e,l,n,h)}}function yr(t,e,r,n=0,o=It,l=4){const h=me(t,e,r,n,o,l);let a;const i=h.ifd;if(i){if(vo.forEach((u,c)=>{i.has(c)&&(a=i.get(c),a.data=me(t,e,a.valueOffset-n,n,u).ifd)}),i.has("GEOKEYDIRECTORY")){a=i.get("GEOKEYDIRECTORY");const u=a.values;if(u&&u.length>4){const c=u[0]+"."+u[1]+"."+u[2];a.data=me(t,e,a.valueOffset+6-n,n,cr,2).ifd,a.data&&a.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[c]})}}if(i.has("XMP")){a=i.get("XMP");const u=a.values;typeof u[0]=="number"&&a.type===7&&(a.values=[ur(new Uint8Array(u))])}}return h}function Cr(t){const{width:e,height:r,tileHeight:n,tileWidth:o}=t,l=t.planes,h=o?o*n:e*r,a=H(t.ifds[0],"BITSPERSAMPLE");let i="";return h*l>2**30/(a>8?a/8:1)&&(i=o?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),i}function Lo(t,e,r,n,o){const l=n?4:1,h=r*l*o;n&&(t=new Uint8Array(t.buffer));for(let u=0;u<e;u++){const c=u*h;for(let s=o;s<h;s++)t[c+s]+=t[c+s-o]}if(!n)return t;const a=new Uint8Array(t.length),i=r*o;for(let u=0;u<e;u++){const c=u*h;for(let s=0;s<i;s++)for(let f=0;f<l;f++)a[c+s*l+f]=t[c+s+(l-f-1)*i]}return new Float32Array(a.buffer)}async function Oo(t,e){const{headerInfo:r,ifd:n,offsets:o,sizes:l}=e,h=[];for(let T=0;T<o.length;T++){l[T];const A=await be(t,r.littleEndian,n,o[T],l[T]||t.byteLength);h.push(A)}const a=Bt(n,r),i=H(n,"BITSPERSAMPLE"),u=pe(H(n,"SAMPLEFORMAT")??1,i),c=H(n,"SAMPLESPERPIXEL")||r.planes,s=qt(u),f=H(n,"TILEWIDTH"),d=H(n,"TILELENGTH"),m=H(n,"COMPRESSION")??1,C=f*d;let y;const p=[];let b=h[0];const k=m===34887;for(let T=0;T<c;T++){if(y=new s(C),h.length===c)b=h[T],b.length===C&&(y=b);else if(b.length)if(a||k)y=b.length===C?b:b.slice(C*T,C*(T+1));else for(let A=0;A<C;A++)y[A]=b[A*c+T];p.push(y)}const g=r.noData?r.noData[0]:e.noDataValue,w=r.metadata?r.metadata.statistics:null,v=w?w.map(T=>T.min):null,S=w?w.map(T=>T.max):null,x={pixelType:u,width:f,height:d,pixels:p,noDataValue:g};return g!=null?ne(x,g,{matchAllNoData:e?.matchAllNoData}):v&&S&&e.applyMinMaxConstraint&&(x.mask=Io(p,v,S)),x}async function Uo(t,e={}){const r=e.pyramidLevel||0,n=e.headerInfo||Po(t),{ifds:o,noData:l}=n;if(o.length===0)throw new Error("no valid image file directory");const h=Cr(n);if(h)throw h;let a=null;const i=r===-1?o[o.length-1]:o[r],u=l??e.noDataValue;return a=n.tileWidth?await xo(t,n,i):ko(t,n,i),a&&(u!=null&&ne(a,u,{matchAllNoData:l==null&&e?.matchAllNoData}),a)}var Mo=function(t){var e,r,n,o,l,h;function a(i){var u,c,s,f,d,m,C,y,p,b,k,g,w;for(this.data=i,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},d=null;;){switch(u=this.readUInt32(),y=function(){var v,S;for(S=[],v=0;v<4;++v)S.push(String.fromCharCode(this.data[this.pos++]));return S}.call(this).join(""),y){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(u);break;case"fcTL":d&&this.animation.frames.push(d),this.pos+=4,d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},f=this.readUInt16(),s=this.readUInt16()||100,d.delay=1e3*f/s,d.disposeOp=this.data[this.pos++],d.blendOp=this.data[this.pos++],d.data=[];break;case"IDAT":case"fdAT":for(y==="fdAT"&&(this.pos+=4,u-=4),i=d?.data||this.imgData,k=0;0<=u?k<u:k>u;0<=u?++k:--k)i.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(u),(p=255-this.transparency.indexed.length)>0)for(g=0;0<=p?g<p:g>p;0<=p?++g:--g)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(u)[0];break;case 2:this.transparency.rgb=this.read(u)}break;case"tEXt":m=(b=this.read(u)).indexOf(0),C=String.fromCharCode.apply(String,b.slice(0,m)),this.text[C]=String.fromCharCode.apply(String,b.slice(m+1));break;case"IEND":return d&&this.animation.frames.push(d),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(w=this.colorType)===4||w===6,c=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*c,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=u}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return a.load=function(i,u,c){var s;return typeof u=="function"&&(c=u),(s=new XMLHttpRequest).open("GET",i,!0),s.responseType="arraybuffer",s.onload=function(){var f;return f=new a(new Uint8Array(s.response||s.mozResponseArrayBuffer)),typeof u?.getContext=="function"&&f.render(u),typeof c=="function"?c(f):void 0},s.send(null)},r=1,n=2,e=0,a.prototype.read=function(i){var u,c;for(c=[],u=0;0<=i?u<i:u>i;0<=i?++u:--u)c.push(this.data[this.pos++]);return c},a.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},a.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},a.prototype.decodePixels=function(i){var u,c,s,f,d,m,C,y,p,b,k,g,w,v,S,x,T,A,I,E,P,R,z;if(i==null&&(i=this.imgData),i.length===0)return new Uint8Array(0);for(i=(i=new Dt(i)).getBytes(),x=(g=this.pixelBitlength/8)*this.width,w=new Uint8Array(x*this.height),m=i.length,S=0,v=0,c=0;v<m;){switch(i[v++]){case 0:for(f=I=0;I<x;f=I+=1)w[c++]=i[v++];break;case 1:for(f=E=0;E<x;f=E+=1)u=i[v++],d=f<g?0:w[c-g],w[c++]=(u+d)%256;break;case 2:for(f=P=0;P<x;f=P+=1)u=i[v++],s=(f-f%g)/g,T=S&&w[(S-1)*x+s*g+f%g],w[c++]=(T+u)%256;break;case 3:for(f=R=0;R<x;f=R+=1)u=i[v++],s=(f-f%g)/g,d=f<g?0:w[c-g],T=S&&w[(S-1)*x+s*g+f%g],w[c++]=(u+Math.floor((d+T)/2))%256;break;case 4:for(f=z=0;z<x;f=z+=1)u=i[v++],s=(f-f%g)/g,d=f<g?0:w[c-g],S===0?T=A=0:(T=w[(S-1)*x+s*g+f%g],A=s&&w[(S-1)*x+(s-1)*g+f%g]),C=d+T-A,y=Math.abs(C-d),b=Math.abs(C-T),k=Math.abs(C-A),p=y<=b&&y<=k?d:b<=k?T:A,w[c++]=(u+p)%256;break;default:throw new Error("Invalid filter algorithm: "+i[v-1])}S++}return w},a.prototype.decodePalette=function(){var i,u,c,s,f,d,m,C,y;for(c=this.palette,d=this.transparency.indexed||[],f=new Uint8Array((d.length||0)+c.length),s=0,c.length,i=0,u=m=0,C=c.length;m<C;u=m+=3)f[s++]=c[u],f[s++]=c[u+1],f[s++]=c[u+2],f[s++]=(y=d[i++])!=null?y:255;return f},a.prototype.copyToImageData=function(i,u){var c,s,f,d,m,C,y,p,b,k,g;if(s=this.colors,b=null,c=this.hasAlphaChannel,this.palette.length&&(b=(g=this._decodedPalette)!=null?g:this._decodedPalette=this.decodePalette(),s=4,c=!0),p=(f=i.data||i).length,m=b||u,d=C=0,s===1)for(;d<p;)y=b?4*u[d/4]:C,k=m[y++],f[d++]=k,f[d++]=k,f[d++]=k,f[d++]=c?m[y++]:this.transparency.grayscale&&this.transparency.grayscale===k?0:255,C=y;else for(;d<p;)y=b?4*u[d/4]:C,f[d++]=m[y++],f[d++]=m[y++],f[d++]=m[y++],f[d++]=c?m[y++]:this.transparency.rgb&&this.transparency.rgb[1]===m[y-3]&&this.transparency.rgb[3]===m[y-2]&&this.transparency.rgb[5]===m[y-1]?0:255,C=y},a.prototype.decode=function(){var i;return i=new Uint8Array(this.width*this.height*4),this.copyToImageData(i,this.decodePixels()),i},l=t.document&&t.document.createElement("canvas"),h=l&&l.getContext("2d"),o=function(i){var u;return h.width=i.width,h.height=i.height,h.clearRect(0,0,i.width,i.height),h.putImageData(i,0,0),(u=new Image).src=l.toDataURL(),u},a.prototype.decodeFrames=function(i){var u,c,s,f,d,m,C,y;if(this.animation){for(y=[],c=d=0,m=(C=this.animation.frames).length;d<m;c=++d)u=C[c],s=i.createImageData(u.width,u.height),f=this.decodePixels(new Uint8Array(u.data)),this.copyToImageData(s,f),u.imageData=s,y.push(u.image=o(s));return y}},a.prototype.renderFrame=function(i,u){var c,s,f;return c=(s=this.animation.frames)[u],f=s[u-1],u===0&&i.clearRect(0,0,this.width,this.height),f?.disposeOp===r?i.clearRect(f.xOffset,f.yOffset,f.width,f.height):f?.disposeOp===n&&i.putImageData(f.imageData,f.xOffset,f.yOffset),c.blendOp===e&&i.clearRect(c.xOffset,c.yOffset,c.width,c.height),i.drawImage(c.image,c.xOffset,c.yOffset)},a.prototype.animate=function(i){var u,c,s,f,d,m,C=this;return c=0,m=this.animation,f=m.numFrames,s=m.frames,d=m.numPlays,(u=function(){var y,p;if(y=c++%f,p=s[y],C.renderFrame(i,y),f>1&&c/f<d)return C.animation._timeout=setTimeout(u,p.delay)})()},a.prototype.stopAnimation=function(){var i;return clearTimeout((i=this.animation)!=null?i._timeout:void 0)},a.prototype.render=function(i){var u,c;return i._png&&i._png.stopAnimation(),i._png=this,i.width=this.width,i.height=this.height,u=i.getContext("2d"),this.animation?(this.decodeFrames(u),this.animate(u)):(c=u.createImageData(this.width,this.height),this.copyToImageData(c,this.decodePixels()),u.putImageData(c,0,0))},a}(self);const Go=new Set(["jpg","png","bmp","gif"]);async function Do(t,e){if(!Kt)throw new pt("rasterCoded:decode","lerc decoder is not supported on big endian platform");await tr();const{offset:r}=e,{width:n,height:o,pixelType:l,statistics:h,depthCount:a,noDataValues:i,bandMasks:u,pixels:c,mask:s}=er(t,{inputOffset:r,returnInterleaved:e.returnInterleaved}),f=new $({width:n,height:o,pixelType:l.toLowerCase(),pixels:c,mask:s,statistics:h.map(({minValue:d,maxValue:m})=>new oe(d,m)),bandMasks:u,depthCount:a,noDataValues:i});return h?.length||f.updateStatistics(),f}async function Bo(t,e){await fo();const r=mo(t);if(!r)throw new pt("rasterCodec:decode","failed to decode the input data.");const{width:n,height:o,pixels:l}=r,h=new $({width:n,height:o,pixelType:"u16",pixels:l});return h.updateStatistics(),h}async function No(t,e){const r=await Uo(t,{...e,noDataValue:e.tiffNoDataValue,matchAllNoData:e.matchAllNoData});Vt(r);const n=new $({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,bandMasks:r.bandMasks,statistics:null});return n.updateStatistics(),n}async function zo(t,e){const r=await Oo(t,e.customOptions),n=new $({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return n.updateStatistics(),n}function br(t,e){const r=e.pixelType||"u8",n=$.getPixelArrayConstructor(r),o=r==="u8"?t:new n(t.buffer),l=[],h=e.planes||1;if(h===1)l.push(o);else for(let i=0;i<h;i++){const u=(e.width||1)*(e.height||t.length),c=new n(u);for(let s=0;s<u;s++)c[s]=o[s*h+i];l.push(c)}const a=new $({width:e.width||1,height:e.height||t.length,pixels:l,pixelType:r,statistics:null});return a.updateStatistics(),a}function Fo(t,e){return br(new Dt(new Uint8Array(t)).getBytes(),e)}function Vo(t,e){return br(de(t,e.offset,e.eof,!e.isInputBigEndian),e)}function _o(t,e,r){const{pixelTypeCtor:n}=qo(e.pixelType),o=(0,yo.decode)(t,{width:e.width,height:e.height,pixelType:n,format:r}),l=new $({width:e.width,height:e.height,pixels:o.pixels,pixelType:e.pixelType,mask:o.mask,statistics:null});return l.updateStatistics(),l}function jo(t,e){const r=ao.decode(t,e.hasNoZlibMask??void 0),n=new $({width:r.width,height:r.height,pixels:r.pixels,pixelType:"u8",mask:r.mask,statistics:null});return n.updateStatistics(),n}function Ho(t,e){const r=new Uint8Array(t),n=new Mo(r),{width:o,height:l}=e,h=o*l,a=n.decode();let i,u=0,c=0;const s=new Uint8Array(h);for(u=0;u<h;u++)s[u]=a[4*u+3];const f=new $({width:o,height:l,pixels:[],pixelType:"u8",mask:s,statistics:[]});for(u=0;u<3;u++){for(i=new Uint8Array(h),c=0;c<h;c++)i[c]=a[4*c+u];f.addData({pixels:i})}return f.updateStatistics(),f}async function Wo(t,e,r,n){const o=new no,l={applyJpegMask:!1,format:e,...r},h=await o.decode(t,l,n),a=new $(h);return a.updateStatistics(),a}function wr(t){if(t==null)throw new pt("rasterCodec:decode","parameter encodeddata is required.");const e=new Uint8Array(t,0,10);let r="";return e[0]===255&&e[1]===216?r="jpg":e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71?r="png":e[0]===67&&e[1]===110&&e[2]===116&&e[3]===90&&e[4]===73&&e[5]===109&&e[6]===97&&e[7]===103&&e[8]===101&&e[9]===32?r="lerc":e[0]===76&&e[1]===101&&e[2]===114&&e[3]===99&&e[4]===50&&e[5]===32?r="lerc2":e[0]===73&&e[1]===73&&e[2]===42&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===42||e[0]===73&&e[1]===73&&e[2]===43&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===43?r="tiff":e[0]===71&&e[1]===73&&e[2]===70?r="gif":e[0]===66&&e[1]===77?r="bmp":e[0]===81&&e[1]===66&&e[2]===51?r="qb3":String.fromCharCode.apply(null,e).toLowerCase().includes("error")&&(r="error"),r}function Ko(t){let e=null;switch(t){case"lerc":case"lerc2":e=Do;break;case"jpg":e=jo;break;case"png":e=Ho;break;case"bsq":case"bip":e=(r,n)=>_o(r,n,t);break;case"tiff":e=No;break;case"deflate":e=Fo;break;case"lzw":e=Vo;break;case"qb3":e=Bo;break;case"error":e=()=>{throw new pt("rasterCodec:decode","input data contains error")};break;default:e=()=>{throw new pt("rasterCodec:decode","unsupported raster format")}}return e}function qo(t){let e=null,r=null;switch(t?t.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,e=Uint8Array;break;case"u16":r=r||65535,e=Uint16Array;break;case"u32":r=r||2**32-1,e=Uint32Array;break;case"s8":r=r||-128,e=Int8Array;break;case"s16":r=r||-32768,e=Int16Array;break;case"s32":r=r||0-2**31,e=Int32Array;break;default:e=Float32Array}return{pixelTypeCtor:e,noDataValue:r}}function Jo(t,e=1){if(!t)return;const{pixels:r,width:n,height:o,mask:l}=t;if(!r||r.length===0)return;const h=r.length,a=n-1,i=o-1,u=[];let c,s,f,d,m,C,y=null;const p=$.getPixelArrayConstructor(t.pixelType);if(e===0){for(c=0;c<h;c++){for(m=r[c],C=new p(a*i),s=0;s<i;s++)for(d=s*n,f=0;f<a;f++)C[s*a+f]=m[d+f];u.push(C)}if(l!=null)for(y=new Uint8Array(a*i),s=0;s<i;s++)for(d=s*n,f=0;f<a;f++)y[s*a+f]=l[d+f]}else{for(c=0;c<h;c++){for(m=r[c],C=new p(a*i),s=0;s<i;s++)for(d=s*n,f=0;f<a;f++)C[s*a+f]=(m[d+f]+m[d+f+1]+m[d+n+f]+m[d+n+f+1])/4;u.push(C)}if(l)for(y=new Uint8Array(a*i),s=0;s<i;s++)for(d=s*n,f=0;f<a;f++)y[s*a+f]=Math.min.apply(null,[l[d+f],l[d+f+1],l[d+n+f],l[d+n+f+1]])}t.width=a,t.height=i,t.mask=y,t.pixels=u}function Yo(t){let e=wr(t);return e==="lerc2"?e="lerc":e==="error"&&(e=""),e}async function Zo(t,e={},r){if(t==null)throw new pt("rasterCodec:decode","missing encodeddata parameter.");let n=e.format?.toLowerCase();if(!(n!=="bsq"&&n!=="bip"||e.width!=null&&e.height!=null))throw new pt("rasterCodec:decode","requires width and height in options parameter.");if(n==="tiff"&&e.customOptions)return zo(t,e);if((!n||n!=="bsq"&&n!=="bip"&&n!=="deflate"&&n!=="lzw")&&(n=wr(t)),e.useCanvas&&Go.has(n))return Wo(t,n,e,r);const o=Ko(n);let l;e.isPoint&&((e={...e}).width!=null&&e.width++,e.height!=null&&e.height++);const{offsets:h}=e;if(h&&h.length>1){const a=h.map((c,s)=>o(t.slice(c,h[s+1]),e)),i=await Promise.all(a);l=i[0],l.pixels=i.map(c=>c.pixels[0]);const u=i.map(c=>c.mask);i.some(c=>c!=null)&&(u.forEach((c,s)=>{c==null&&(u[s]=new Uint8Array(l.width*l.height).fill(255))}),l.bandMasks=u,l.mask=$.combineBandMasks(u)),l.updateStatistics()}else l=await o(t,{...e,offset:h?.[0]??e.offset});return n!=="jpg"&&e.noDataValue!=null&&l.depthCount===1&&ne(l,e.noDataValue,{customFloatTolerance:e.tolerance}),e.isPoint&&Jo(l),l}function Xo(t){return["u8","s8"].includes(t.pixelType)&&t.statistics?.[0]?.min!=null&&t.statistics[0]?.max!=null&&t.bandCount===1}function vr(t,e){const{attributeTable:r,bandCount:n}=t;return r==null&&Xo(t)?!0:!(r==null||n>1||e&&r.fields.find(o=>o.name.toLowerCase()===e.toLowerCase())==null)}function Tr(t){const{bandCount:e,dataType:r,pixelType:n}=t;return r==="elevation"||r==="generic"&&e===1&&(n==="s16"||n==="s32"||n==="f32"||n==="f64")}function Ar(t,e=!1){const{bandCount:r,colormap:n,pixelType:o}=t;return r===1&&(!!n?.length||!e&&o==="u8")}function Qo(t,e=!1){const{attributeTable:r,bandCount:n}=t;return n===1&&(!e||r!=null||t.histograms!=null)}function $o(t){const{dataType:e}=t;return e==="vector-uv"||e==="vector-magdir"}function tn(t){const{dataType:e}=t;return e==="vector-uv"||e==="vector-magdir"}function Zt(t){return!!t?.length&&t.length<=16384}const Ae=1;function Sr(t){if(t==null)return!1;const{max:e,min:r,size:n}=t;return(e-r)/n===1&&r>=-.5&&Math.abs(r%1)===.5&&e<=255.5}function xr(t,e=256){e=Math.min(e,256);const{size:r,counts:n}=t,o=new Float64Array(r);o[0]=n[0]/e;for(let a=1;a<r;a++)o[a]=o[a-1]+n[a]/e;const l=new Uint8Array(e),h=e/o[o.length-1];if(r<=e){const a=Sr(t)?Math.max(0,Math.round(t.min+.5)):0;for(let i=a;i<e;i++)l[i]=i>=r+a?255:Math.min(255,Math.trunc(o[i-a]*h))}else{const a=o.map(i=>Math.min(255,Math.trunc(i*h)));for(let i=0;i<e;i++)l[i]=a[Math.round(r/e)];l[e-1]=255}return l}function Se(t){const{minCutOff:e,maxCutOff:r,gamma:n,pixelType:o,rounding:l}=t;if(!["u8","u16","s8","s16"].includes(o))return null;const h=e.length,a=o==="s8"?-127:o==="s16"?-32767:0,i=["u16","s16"].includes(o)?65536:256,u=[],c=[],{minOutput:s=0,maxOutput:f=255}=t,d=f-s;for(let C=0;C<h;C++)c[C]=r[C]-e[C],u[C]=c[C]===0?0:d/c[C];const m=[];if(n&&n.length>=h){const C=xe(h,n);for(let y=0;y<h;y++){const p=[];for(let b=0;b<i;b++){if(c[y]===0){p[b]=s;continue}const k=b+a,g=(k-e[y])/c[y];let w=1;if(n[y]>1&&(w-=(1/d)**(g*C[y])),k<r[y]&&k>e[y]){const v=w*d*g**(1/n[y])+s;p[b]=l==="floor"?Math.floor(v):l==="round"?Math.round(v):v}else k>=r[y]?p[b]=f:p[b]=s}m[y]=p}}else for(let C=0;C<h;C++){const y=[];for(let p=0;p<i;p++){const b=p+a;if(b<=e[C])y[p]=s;else if(b>=r[C])y[p]=f;else{const k=(b-e[C])*u[C]+s;y[p]=l==="floor"?Math.floor(k):l==="round"?Math.round(k):k}}m[C]=y}if(t.contrastOffset!=null){const C=kr(t.contrastOffset,t.brightnessOffset);for(let y=0;y<h;y++){const p=m[y];for(let b=0;b<i;b++)p[b]=C[p[b]]}}return{lut:m,offset:a}}function kr(t,e){const r=Math.min(Math.max(t,-100),100),n=Math.min(Math.max(e??0,-100),100),o=255,l=128,h=new Uint8Array(256);for(let a=0;a<256;a++){let i=0;r>0&&r<100?i=(200*a-100*o+2*o*n)/(2*(100-r))+l:r<=0&&r>-100?i=(200*a-100*o+2*o*n)*(100+r)/2e4+l:r===100?(i=200*a-100*o+(o+1)*(100-r)+2*o*n,i=i>0?o:0):r===-100&&(i=l),h[a]=i>o?o:i<0?0:i}return h}function en(t,e,r){const n=[];for(let o=0;o<e.length;o++){let l=0,h=0,a=0;"min"in e[o]?{min:l,max:h,avg:a}=e[o]:[l,h,a]=e[o];let i=a??0;t!=="u8"&&(i=255*(i-l)/(h-l)),n.push(rn(i))}return n}function rn(t){if(t<=0||t>=255)return Ae;const e=255,r=t+(t===150?0:t<150?45*Math.cos(.01047*t):17*Math.sin(.021*t)),n=Math.log(t/e),o=Math.log(r/e);if(o===0)return Ae;const l=n/o;return isNaN(l)?Ae:Math.min(9.9,Math.max(.01,l))}function on(t,e,r){let{min:n,max:o,count:l,avg:h,mode:a,median:i}=nn(t,e,!0);if(l===0)return{statistics:{min:0,max:0,avg:0,stddev:0,count:l,mode:0,median:0},histogram:null};const u={min:n,max:o,avg:h,mode:a,count:l,median:i},c=sn(t,e,h,!r.includeSkewnessKurtosis);c&&(u.stddev=c.stddev,r.includeSkewnessKurtosis&&(u.skewness=c.skewness,u.kurtosis=c.kurtosis));const s=r?.histogramSize??256,f=!!r?.pixelType&&["u8","s8","u4","u2","u1"].includes(r.pixelType),d=!r?.skipHistograms;if(i==null){const m=Ir({band:t,mask:e,min:n,max:o,size:1e4,use8BitHistogram:f});if(i=an(t,e,m,50),d&&f&&s===256)return{statistics:u,histogram:m}}return d?{statistics:u,histogram:Ir({band:t,mask:e,min:n,max:o,size:s,use8BitHistogram:f&&s===256})}:{statistics:u,histogram:null}}function Ir(t){const{band:e,mask:r,min:n,max:o,use8BitHistogram:l}=t;if(l){const s=o-n+1,f=new Uint32Array(s);for(let d=0;d<e.length;d++)r&&!r[d]||f[e[d]-n]++;return{min:n-.5,max:o+.5,size:s,counts:f}}const h=t.size??256,a=new Uint32Array(h),i=(o-n)/h;if(i===0){const s=r?r.reduce((f,d)=>f+(d?1:0),0):e.length;return{min:n,max:o,size:1,counts:new Uint32Array(1).fill(s)}}const u=new Uint32Array(h+1),c=1/i;for(let s=0;s<e.length;s++)r&&!r[s]||u[Math.floor((e[s]-n)*c)]++;for(let s=0;s<h-1;s++)a[s]=u[s];return a[h-1]=u[h-1]+u[h],{min:n,max:o,size:h,counts:a}}function nn(t,e,r=!1,n=!1){let o=1/0,l=-1/0,h=0,a=0,i=0,u=0;const c=t.length,s=new Map;for(let y=0;y<c;y++){const p=t[y];if(!e||e[y]){const b=(s.get(p)??0)+1;s.set(p,b),b>u&&(u=b,i=p),o=p<o?p:o,l=p>l?p:l,h+=p,a++}}const f=a>0?h/a:0;let d=o===l?o:void 0,m=o===l?o:void 0,C=o===l?o:void 0;if(r&&a>0&&a<2**24){let y=t.slice();if(e){let b=0;for(let k=0;k<c;k++){const g=t[k];e[k]&&(y[b++]=g)}}y=y.slice(0,a),y.sort((b,k)=>b-k);const p=a>>>1;d=a%2?y[Math.floor(p)]:(y[p-1]+y[p])/2,n&&(m=y[Math.floor(.25*a)],C=y[Math.floor(.75*a)])}return{min:o,max:l,count:a,avg:f,mode:i,median:d,quartile1:m,quartile3:C}}function an(t,e,r,n=50){const{counts:o,min:l,max:h,size:a}=r,i=o.reduce((y,p)=>y+p)*(n/=100);let u=0,c=0;for(;c<o.length&&(u+=o[c],!(u>=i+1));c++);const s=(h-l)/a,f=l+s*c,d=l+s*(c+1);if(s===1&&Math.abs(l%1)===.5)return f+.5;const m=t.slice(0,o[c]).fill(0);for(let y=0,p=0;y<t.length;y++)if(!e||e[y]){const b=t[y];b>=f&&b<d&&(m[p++]=b)}m.sort((y,p)=>y-p);const C=u-Math.floor(i)-1;return m[Math.max(0,m.length-1-C)]}function sn(t,e,r,n=!1,o=!1){let l=0,h=0,a=0,i=0;for(let c=0;c<t.length;c++)if(!e||e[c]){const s=t[c]-r,f=s*s;if(l+=f,!n){const d=f*s;h+=d,a+=d*s}i++}if(i<2)return null;l/=i-1;const u=Math.sqrt(l);return n?{stddev:u}:(a/=i,{stddev:u,skewness:o?h*(i/((i-1)*(i-2)))/l**1.5:h/i/l**1.5,kurtosis:a/(l*l)})}function ln(t,e){const{pixels:r,mask:n,pixelType:o,bandMasks:l}=t,h=r.map((a,i)=>on(a,l?.[i]??n,{pixelType:o,...e}));return{statistics:h.map(({statistics:a})=>a),histograms:h.map(({histogram:a})=>a)}}function Er(t){if(!t?.pixels?.length)return null;const{pixels:e,mask:r,bandMasks:n,pixelType:o}=t,l=t.width*t.height,h=e.length,a=[],i=[],u=256;let c,s;for(let f=0;f<h;f++){let d=new Uint32Array(u);const m=e[f],C=n?.[f]??r;if(o==="u8"){if(c=255,s=0,C){for(let A=0;A<l;A++)if(C[A]){const I=m[A];c=I<c?I:c,s=I>s?I:s,d[I]++}}else for(let A=0;A<l;A++){const I=m[A];c=I<c?I:c,s=I>s?I:s,d[I]++}d=d.slice(c,s+1)}else{let A=!1;t.statistics||(t.updateStatistics(),A=!0);const I=t.statistics;c=I[f].minValue,s=I[f].maxValue;const E=(s-c)/u;if(E===0){!I||t.validPixelCount||A||t.updateStatistics();const P=(t.validPixelCount||t.width*t.height)/u;for(let R=0;R<u;R++)d[R]=Math.round(P*(R+1))-Math.round(P*R)}else{const P=new Uint32Array(u+1);for(let R=0;R<l;R++)C&&!C[R]||P[Math.floor((m[R]-c)/E)]++;for(let R=0;R<u-1;R++)d[R]=P[R];d[u-1]=P[u-1]+P[u]}}const y=o==="u8"?c-.5:c,p=o==="u8"?s+.5:s;a.push({min:y,max:p,size:d.length,counts:d});let b=0,k=0,g=0;for(let A=0;A<d.length;A++)b+=d[A],k+=A*d[A];const w=k/b;for(let A=0;A<d.length;A++)g+=d[A]*(A-w)**2;const v=Math.sqrt(g/(b-1)),S=(p-y)/d.length,x=(w+(o==="u8"?0:.5))*S+c,T=v*S;i.push({min:c,max:s,avg:x,stddev:T})}return{statistics:i,histograms:a}}function un(t){const e=[];for(let r=0;r<t.length;r++){const{min:n,max:o,size:l,counts:h}=t[r];let a=0,i=0;for(let m=0;m<l;m++)a+=h[m],i+=m*h[m];const u=i/a;let c=0;for(let m=0;m<l;m++)c+=h[m]*(m-u)**2;const s=(o-n)/l,f=(u+.5)*s+n,d=Math.sqrt(c/(a-1))*s;e.push({min:n,max:o,avg:f,stddev:d})}return e}function Pt(t,e){const{pixelBlock:r,bandIds:n,returnHistogramLut:o,rasterInfo:l}=e;let h=null,a=null,i=t.stretchType;if(typeof i=="number"&&(i=qe[i]),t.dra)if(i==="minMax"&&r?.statistics)h=r.statistics.map(p=>[p.minValue,p.maxValue,0,0]);else{const p=Er(r);h=p!=null?p.statistics:null,a=p!=null?p.histograms:null}else h=t.statistics?.length?t.statistics:l.statistics,a="histograms"in t?t.histograms:void 0,a||(a=l.histograms);i!=="percentClip"&&i!=="histogramEqualization"||a?.length||(i="minMax");const u=h?.length||a?.length||l.bandCount,c=[],s=[];h&&!Array.isArray(h[0])&&(h=h.map(p=>[p.min,p.max,p.avg,p.stddev]));const[f,d]=Oe(l.pixelType);if(!h?.length){h=[];for(let p=0;p<u;p++)h.push([f,d,1,1]);i==="standardDeviation"&&(i="minMax")}switch(i){case"none":for(let p=0;p<u;p++)c[p]=f,s[p]=d;break;case"minMax":for(let p=0;p<u;p++){const b=h[p];c[p]=b[0],s[p]=b[1]}break;case"standardDeviation":{const{numberOfStandardDeviations:p=2}=t;for(let b=0;b<u;b++){const k=h[b];c[b]=k[2]-p*k[3],s[b]=k[2]+p*k[3],c[b]<k[0]&&(c[b]=k[0]),s[b]>k[1]&&(s[b]=k[1])}}break;case"histogramEqualization":Vt(a);for(let p=0;p<u;p++)c[p]=a[p].min,s[p]=a[p].max;break;case"percentClip":Vt(a);for(let p=0;p<a.length;p++){const b=a[p],k=new Uint32Array(b.size),g=[...b.counts];g.length>=20&&(g[0]=g[1]=g[2]=g[g.length-1]=g[g.length-2]=0);let w=0;const v=(b.max-b.min)/b.size,S=b.min===-.5&&v===1?.5:0;for(let T=0;T<b.size;T++)w+=g[T],k[T]=w;let x=(t.minPercent||0)*w/100;c[p]=b.min+S;for(let T=0;T<b.size;T++)if(k[T]>x){c[p]=b.min+v*(T+S);break}x=(1-(t.maxPercent||0)/100)*w,s[p]=b.max+S;for(let T=b.size-2;T>=0;T--)if(k[T]<x){s[p]=b.min+v*(T+2-S);break}if(s[p]<c[p]){const T=c[p];c[p]=s[p],s[p]=T}}break;default:for(let p=0;p<u;p++){const b=h[p];c[p]=b[0],s[p]=b[1]}}let m,C,y;return i==="histogramEqualization"?(Vt(a),C=a[0].size||256,m=0,o&&(y=a.map(p=>xr(p)))):(C=t.max||255,m=t.min||0),cn({minCutOff:c,maxCutOff:s,maxOutput:C,minOutput:m,histogramLut:y},n)}function cn(t,e){if(e==null||e.length===0)return t;const r=Math.max.apply(null,e),{minCutOff:n,maxCutOff:o,minOutput:l,maxOutput:h,histogramLut:a}=t;return n.length===e.length||n.length<=r?t:{minCutOff:e.map(i=>n[i]),maxCutOff:e.map(i=>o[i]),histogramLut:a?e.map(i=>a[i]):null,minOutput:l,maxOutput:h}}function xe(t,e){const r=new Float32Array(t);for(let n=0;n<t;n++)e[n]>1?e[n]>2?r[n]=6.5+(e[n]-2)**2.5:r[n]=6.5+100*(2-e[n])**4:r[n]=1;return r}function Xt(t,e){if(!t?.pixels?.length)return t;const{mask:r,bandMasks:n,width:o,height:l,pixels:h}=t,{minCutOff:a,maxCutOff:i,minOutput:u,maxOutput:c,gamma:s}=e,f=o*l,d=e.outputPixelType||"u8",m=t.pixels.map(()=>$.createEmptyBand(d,f)),C=m.length,y=c-u,p=[],b=[];for(let S=0;S<C;S++)b[S]=i[S]-a[S],p[S]=b[S]===0?0:y/b[S];const k=d.startsWith("u")||d.startsWith("s"),g=s&&s.length>=C,w=!!e.isRenderer;if(g){const S=xe(C,s);for(let x=0;x<C;x++){const T=n?.[x]??r;for(let A=0;A<f;A++)if(T==null||T[A]){if(b[x]===0){m[x][A]=u;continue}const I=h[x][A],E=(I-a[x])/b[x];let P=1;if(s[x]>1&&(P-=(1/y)**(E*S[x])),I<i[x]&&I>a[x]){const R=P*y*E**(1/s[x])+u;m[x][A]=w?Math.floor(R):k?Math.round(R):R}else I>=i[x]?m[x][A]=c:m[x][A]=u}}}else for(let S=0;S<C;S++){const x=n?.[S]??r;for(let T=0;T<f;T++)if(x==null||x[T]){const A=h[S][T];if(A<i[S]&&A>a[S]){const I=(A-a[S])*p[S]+u;m[S][T]=w?Math.floor(I):k?Math.round(I):I}else A>=i[S]?m[S][T]=c:m[S][T]=u}}const v=new $({width:o,height:l,mask:r,bandMasks:n,pixels:m,pixelType:d});return v.updateStatistics(),v}const nt=1,St=1/111e3;function ke(t){let{altitude:e,azimuth:r}=t;const{hillshadeType:n,pixelSizePower:o=1,pixelSizeFactor:l=1,scalingType:h,isGCS:a,resolution:i}=t,u=n==="multi-directional"?2*t.zFactor:t.zFactor,{x:c,y:s}=i;let f=u/(8*c),d=u/(8*s);if(a&&u>.001&&(f/=St,d/=St),h==="adjusted")if(a){const E=c*St,P=s*St;f=(u+E**o*l)/(8*E),d=(u+P**o*l)/(8*P)}else f=(u+c**o*l)/(8*c),d=(u+s**o*l)/(8*s);let m=(90-e)*Math.PI/180,C=Math.cos(m),y=(360-r+90)*Math.PI/180,p=Math.sin(m)*Math.cos(y),b=Math.sin(m)*Math.sin(y);const k=[315,270,225,360,180,0],g=[60,60,60,60,60,90],w=new Float32Array([3,5,3,2,1,4]),v=w.reduce((E,P)=>E+P),S=w.map(E=>E/v),x=n==="multi-directional"?k.length:1,T=new Float32Array(6),A=new Float32Array(6),I=new Float32Array(6);if(n==="multi-directional")for(let E=0;E<x;E++)e=g[E],r=k[E],m=(90-e)*Math.PI/180,C=Math.cos(m),y=(360-r+90)*Math.PI/180,p=Math.sin(m)*Math.cos(y),b=Math.sin(m)*Math.sin(y),T[E]=C,A[E]=p,I[E]=b;else T.fill(C),A.fill(p),I.fill(b);return{resolution:i,factor:[f,d],sinZcosA:p,sinZsinA:b,cosZ:C,sinZcosAs:[...A],sinZsinAs:[...I],cosZs:[...T],weights:[...S],hillshadeType:["traditional","multi-directional"].indexOf(n)}}function Qt(t,e){const{width:r,height:n}=t,o=r*n,l=new Uint8Array(o),h=t.mask!=null;let a;if(h){a=new Uint8Array(t.mask);for(let v=0;v<a.length;v++)a[v]&&(l[v]=1,a[v]=1)}const i=t.pixels[0],u=new Float32Array(o),c=new Float32Array(o);let s,f=0;if(e){const{resolution:v}=e,S=v?(v.x+v.y)/2:1;f=200*e.zFactor/(S*S),s=new Float32Array(o)}const d=e?.curvatureType;let m,C,y,p,b,k,g,w;for(let v=nt;v<n-nt;v++){const S=v*r;for(let x=nt;x<r-nt;x++){const T=S+x;if(!a||a[T]!==0){if(a){if(a[T-r-1]+a[T-r]+a[T-r+1]+a[T-1]+a[T+1]+a[T+r-1]+a[T+r]+a[T+r+1]<7){l[T]=0;continue}m=a[T-r-1]?i[T-r-1]:i[T],C=a[T-r]?i[T-r]:i[T],y=a[T-r+1]?i[T-r+1]:i[T],p=a[T-1]?i[T-1]:i[T],b=a[T+1]?i[T+1]:i[T],k=a[T+r-1]?i[T+r-1]:i[T],g=a[T+r]?i[T+r]:i[T],w=a[T+r+1]?i[T+r+1]:i[T]}else m=i[T-r-1],C=i[T-r],y=i[T-r+1],p=i[T-1],b=i[T+1],k=i[T+r-1],g=i[T+r],w=i[T+r+1];if(u[T]=y+b+b+w-(m+p+p+k),c[T]=k+g+g+w-(m+C+C+y),s!=null){const A=i[T],I=.5*(p+b)-A,E=.5*(C+g)-A;if(d==="standard")s[T]=-f*(I+E);else{const P=(-m+y+k-w)/4,R=(-p+b)/2,z=(C-g)/2,G=R*R,B=z*z,U=G+B;U&&(s[T]=d==="profile"?f*(I*G+E*B+P*R*z)/U:-f*(I*B+E*G-P*R*z)/U)}}}}}return{outMask:h?l:null,dzxs:u,dzys:c,curvatures:s}}function $t(t,e,r){for(let n=0;n<r;n++)t[n*e]=t[n*e+1],t[(n+1)*e-1]=t[(n+1)*e-2];for(let n=1;n<e-1;n++)t[n]=t[n+e],t[n+(r-1)*e]=t[n+(r-2)*e]}function Pr(t,e){if(!vt(t))return t;const{factor:r,sinZcosA:n,sinZsinA:o,cosZ:l,sinZcosAs:h,sinZsinAs:a,cosZs:i,weights:u}=ke(e),[c,s]=r,f=e.hillshadeType==="traditional",{width:d,height:m}=t,C=new Uint8Array(d*m),{dzxs:y,dzys:p,outMask:b}=Qt(t);for(let k=nt;k<m-nt;k++){const g=k*d;for(let w=nt;w<d-nt;w++){const v=g+w;if(!b||b[v]){const S=y[v]*c,x=p[v]*s,T=Math.sqrt(1+S*S+x*x);let A=0;if(f){let I=255*(l+o*x-n*S)/T;I<0&&(I=0),A=I}else{const I=a.length;for(let E=0;E<I;E++){let P=255*(i[E]+a[E]*x-h[E]*S)/T;P<0&&(P=0),A+=P*u[E]}}C[v]=255&A}}}return $t(C,d,m),new $({width:d,height:m,pixels:[C],mask:b,pixelType:"u8",validPixelCount:t.validPixelCount,statistics:[new oe(0,255)]})}function Rr(t,e,r,n){if(!vt(t)||!vt(e))return;const{min:o,max:l}=n,h=t.pixels[0],{pixels:a,mask:i}=e,u=a[0],c=255.00001/(l-o),s=new Uint8ClampedArray(u.length),f=new Uint8ClampedArray(u.length),d=new Uint8ClampedArray(u.length),m=r.length-1;for(let C=0;C<u.length;C++){if(i&&i[C]===0)continue;const y=Math.floor((u[C]-o)*c),[p,b]=r[y<0?0:y>m?m:y],k=h[C],g=k*b,w=g*(1-Math.abs(p%2-1)),v=k-g;switch(Math.floor(p)){case 0:s[C]=g+v,f[C]=w+v,d[C]=v;break;case 1:s[C]=w+v,f[C]=g+v,d[C]=v;break;case 2:s[C]=v,f[C]=g+v,d[C]=w+v;break;case 3:s[C]=v,f[C]=w+v,d[C]=g+v;break;case 4:s[C]=w+v,f[C]=v,d[C]=g+v;break;case 5:case 6:s[C]=g+v,f[C]=v,d[C]=w+v}}t.pixels=[s,f,d],t.updateStatistics()}function hn(t,e){if(!vt(t))return t;const r=e.zFactor,n=e.pixelSizePower??1,o=e.pixelSizeFactor??1,l=e.slopeType,h=e.isGCS,{x:a,y:i}=e.resolution;let u=r/(8*a),c=r/(8*i);h&&Math.abs(r-1)<1e-4&&(u/=St,c/=St),l==="adjusted"&&(u=(r+a**n*o)/(8*a),c=(r+i**n*o)/(8*i));const{dzxs:s,dzys:f,outMask:d}=Qt(t),{width:m,height:C}=t,y=new Float32Array(m*C);for(let b=nt;b<C-nt;b++){const k=b*m;for(let g=nt;g<m-nt;g++){const w=k+g;if(!d||d[w]){const v=s[w]*u,S=f[w]*c,x=Math.sqrt(v*v+S*S);y[k+g]=l==="percent-rise"?100*x:57.2957795*Math.atan(x)}}}$t(y,m,C);const p=new $({width:m,height:C,pixels:[y],mask:d,pixelType:"f32",validPixelCount:t.validPixelCount});return p.updateStatistics(),p}function fn(t,e={}){if(!vt(t))return t;const{resolution:r}=e,n=r?1/r.x:1,o=r?1/r.y:1,{dzxs:l,dzys:h,outMask:a}=Qt(t),{width:i,height:u}=t,c=new Float32Array(i*u);for(let s=nt;s<u-nt;s++){const f=s*i;for(let d=nt;d<i-nt;d++){const m=f+d;if(!a||a[m]){const C=l[m]*n,y=h[m]*o;let p=-1;C===0&&y===0||(p=90-57.29578*Math.atan2(y,-C),p<0&&(p+=360),p===360?p=0:p>360&&(p%=360)),c[f+d]=p}}}return $t(c,i,u),new $({width:i,height:u,pixels:[c],mask:a,pixelType:"f32",validPixelCount:t.validPixelCount,statistics:[new oe(-1,360)]})}function dn(t,e){if(!vt(t))return t;const{curvatures:r,outMask:n}=Qt(t,e),{width:o,height:l}=t;$t(r,o,l);const h=new $({width:o,height:l,pixels:[r],mask:n,pixelType:"f32",validPixelCount:t.validPixelCount});return h.updateStatistics(),h}function pn(t,e,r){const{hillshadeType:n,altitude:o,azimuth:l,zFactor:h,pixelSizeFactor:a,pixelSizePower:i,slopeType:u}=t;return{hillshadeType:n,altitude:o,azimuth:l,zFactor:h,pixelSizePower:i,pixelSizeFactor:a,scalingType:u==="scaled"?"adjusted":"none",resolution:e,isGCS:r}}let xt=class extends Ot{constructor(t){super(t),this.lookup={rendererJSON:{}},this.canRenderInWebGL=!1}bind(){const{rendererJSON:t}=this;if(!t)return{success:!1};let e;switch(this.lookup={rendererJSON:{}},t.type){case"uniqueValue":e=this._updateUVRenderer(t);break;case"rasterColormap":e=this._updateColormapRenderer(t);break;case"rasterStretch":e=this._updateStretchRenderer(t);break;case"classBreaks":e=this._updateClassBreaksRenderer(t);break;case"rasterShadedRelief":e=this._updateShadedReliefRenderer(t);break;case"vectorField":e=this._updateVectorFieldRenderer();break;case"flowRenderer":e=this._updateFlowRenderer()}return e}symbolize(t){let e=t?.pixelBlock;if(!Lr(e))return e;if(t.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(e,t.simpleStretchParams);try{let r;switch(e.pixels.length>3&&(e=e.extractBands(t.bandIds??[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolizeColormap(e);break;case"classBreaks":r=this._symbolizeClassBreaks(e);break;case"rasterStretch":r=this._symbolizeStretch(e,t.bandIds);break;case"rasterShadedRelief":{const n=t.extent,o=n.spatialReference.isGeographic,l={x:(n.xmax-n.xmin)/e.width,y:(n.ymax-n.ymin)/e.height};r=this._symbolizeShadedRelief(e,{isGCS:o,resolution:l});break}}return r}catch(r){return Re.getLogger(this).error("symbolize",r.message),e}}simpleStretch(t,e){if(!Lr(t))return t;try{return t.pixels.length>3&&(t=t.extractBands([0,1,2])),Xt(t,{...e,isRenderer:!0})}catch(r){return Re.getLogger(this).error("symbolize",r.message),t}}generateWebGLParameters(t){const{rendererJSON:e}=this;switch(e.type){case"uniqueValue":case"rasterColormap":case"classBreaks":return this._generateColormapWebGLParams(e.type==="classBreaks");case"rasterStretch":return this._generateStretchWebGLParams(t.pixelBlock,e,t.bandIds);case"rasterShadedRelief":return this._generateShadedReliefWebGLParams(e,t.isGCS,t.resolution??void 0);case"vectorField":return this._generateVectorFieldWebGLParams(e);default:return null}}_isLUTChanged(t){const e=this.lookup.rendererJSON;if(!e)return!0;const{rendererJSON:r}=this;if("colorRamp"in r&&r.colorRamp){const n=r.colorRamp;if(t)return JSON.stringify(n)!==JSON.stringify(e.colorRamp)}return JSON.stringify(r)!==JSON.stringify(e)}_symbolizeColormap(t){return this._isLUTChanged()&&!this.bind().success?t:ie(t,this.lookup.colormapLut)}_symbolizeClassBreaks(t){const{canUseIndexedLUT:e}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?t:e?ie(t,this.lookup.colormapLut):Vr(t,this.lookup.remapLut??[])}_symbolizeStretch(t,e){if(!t)return null;const{rasterInfo:r,lookup:n}=this,{pixelType:o,bandCount:l}=r,h=this.rendererJSON,a=["u8","u16","s8","s16"].includes(o);let i;const{dra:u}=h,{gamma:c}=n;if(u&&(e=null),h.stretchType==="histogramEqualization"){const s=u?null:n.histogramLut,f=Pt(h,{rasterInfo:r,pixelBlock:t,bandIds:e,returnHistogramLut:!s}),d=r.pixelType==="u8"&&!u&&Sr(r.histograms?.[0])?t:Xt(t,{...f,gamma:c,isRenderer:!0});i=Ue(d,{lut:u?f.histogramLut:e?.length?e.map(m=>s[m]):s,offset:0})}else if(a){let s;if(u){const f=Pt(h,{rasterInfo:r,pixelBlock:t,bandIds:e});s=Se({pixelType:o,...f,gamma:c,rounding:"floor"})}else{if(this._isLUTChanged()&&!this.bind().success)return t;s=n.stretchLut}if(!s)return t;l>1&&e!=null&&e.length===t?.pixels.length&&s.lut.length===l&&(s={lut:e.map(f=>s.lut[f]),offset:s.offset}),i=Ue(t,s)}else{const s=Pt(h,{rasterInfo:r,pixelBlock:t,bandIds:e});i=Xt(t,{...s,gamma:c,isRenderer:!0})}if(h.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return t;i=ie(i,n.colormapLut)}return i}_symbolizeShadedRelief(t,e){const r=this.rendererJSON,n={...r,...e},o=Pr(t,n);if(!r.colorRamp||this._isLUTChanged(!0)&&!this.bind().success)return o;const{hsvMap:l}=this.lookup;if(!l)return o;const h=this.rasterInfo.statistics?.[0]??{min:0,max:8e3};return Rr(o,t,l,h),o}_isVectorFieldData(){const{bandCount:t,dataType:e}=this.rasterInfo;return t===2&&(e==="vector-magdir"||e==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(t){const{bandCount:e,attributeTable:r,pixelType:n}=this.rasterInfo,o=t.field1;if(!o)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const l=t.defaultSymbol,h=e===1&&["u8","s8"].includes(n);if(!vr(this.rasterInfo,o)&&!h)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const a=[];if(r!=null){const u=r.fields.find(c=>c.name.toLowerCase()==="value");if(!u)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};r.features.forEach(c=>{const s=t.uniqueValueInfos?.find(d=>String(d.value)===String(c.attributes[o])),f=s?.symbol?.color;f?a.push([c.attributes[u.name]].concat(f)):l&&a.push([c.attributes[u.name]].concat(l.color))})}else{if(o.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not available.'};t.uniqueValueInfos?.forEach(u=>{const c=u?.symbol?.color;c?a.push([parseInt(""+u.value,10)].concat(c)):l&&a.push([parseInt(""+u.value,10)].concat(l?.color))})}if(a.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const i=Mt({colormap:a});return this.lookup={rendererJSON:t,colormapLut:i},this.canRenderInWebGL=Zt(i?.indexedColormap),{success:!0}}_updateColormapRenderer(t){if(!Ar(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const e=t.colormapInfos.map(n=>[n.value].concat(n.color)).sort((n,o)=>n[0]-o[0]);if(!e||e.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const r=Mt({colormap:e});return this.lookup={rendererJSON:t,colormapLut:r},this.canRenderInWebGL=Zt(r?.indexedColormap),{success:!0}}_updateShadedReliefRenderer(t){if(!Tr(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(t.colorRamp){const e=se(t.colorRamp,{interpolateAlpha:!0}),r=Mt({colormap:e}),n=He(r.indexedColormap);this.lookup={rendererJSON:t,colormapLut:r,hsvMap:n}}else this.lookup={rendererJSON:t};return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(t){const{attributeTable:e,pixelType:r}=this.rasterInfo,n=e?.fields.find(h=>h.name.toLowerCase()==="value"),o=e?.fields.find(h=>h.name.toLowerCase()===t.field.toLowerCase()),l=n!=null&&o!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(r)||l,tableValueField:n,tableBreakField:o}}_updateClassBreaksRenderer(t){const{attributeTable:e}=this.rasterInfo,{canUseIndexedLUT:r,tableValueField:n,tableBreakField:o}=this._analyzeClassBreaks(t),l=t.classBreakInfos;if(!l?.length)return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const h=l.sort((s,f)=>s.classMaxValue-f.classMaxValue),a=h[h.length-1];let i=t.minValue;if(!r){const s=[];for(let f=0;f<h.length;f++)s.push({value:h[f].classMinValue??i,mappedColor:h[f].symbol.color}),i=h[f].classMaxValue;return s.push({value:a.classMaxValue,mappedColor:a.symbol.color}),this.lookup={rendererJSON:t,remapLut:s},this.canRenderInWebGL=!1,{success:!0}}const u=[];if(e!=null&&n!=null&&o!==null&&n!==o){const s=n.name,f=o.name,d=h[h.length-1],{classMaxValue:m}=d;i=t.minValue;for(const C of e.features){const y=C.attributes[s],p=C.attributes[f],b=p===m?d:p<i?null:h.find(({classMaxValue:k})=>k>p);b&&u.push([y].concat(b.symbol.color))}}else{const[s,f]=Oe(this.rasterInfo.pixelType);i=Math.max(s,Math.floor(t.minValue));for(let d=0;d<h.length;d++){const m=h[d],C=Math.min(f,Math.ceil(m.classMaxValue));for(let y=i;y<C;y++)u.push([y].concat(m.symbol.color));i=C}a.classMaxValue!==i&&i!==f||u.push([i].concat(a.symbol.color))}const c=Mt({colormap:u,fillUnspecified:!1});return this.lookup={rendererJSON:t,colormapLut:c},this.canRenderInWebGL=Zt(c?.indexedColormap),{success:!0}}_updateStretchRenderer(t){let{stretchType:e,dra:r}=t;if(!(e==="none"||t.statistics?.length||gn(this.rasterInfo.statistics)||r))return{success:!1,error:"Unsupported renderer; StretchRenderer.customStatistics is required when dynamic range adjustment is not used."};const n=t.histograms||this.rasterInfo.histograms;!mn(t.stretchType)||n?.length||r||(e="minMax");const{computeGamma:o,useGamma:l,colorRamp:h}=t;let{gamma:a}=t;if(l&&o&&!a?.length){const c=t.statistics?.length?t.statistics:this.rasterInfo.statistics;a=en(this.rasterInfo.pixelType,c)}const i=this.rasterInfo.pixelType,u=!r&&["u8","u16","s8","s16"].includes(i);if(e==="histogramEqualization"){const c=n.map(s=>xr(s));this.lookup={rendererJSON:t,histogramLut:c}}else if(u){const c=Pt(t,{rasterInfo:this.rasterInfo}),s=Se({pixelType:i,...c,gamma:l?a:null,rounding:"floor"});this.lookup={rendererJSON:t,stretchLut:s}}else this.lookup={rendererJSON:t};if(h&&!yn(h)){const c=se(h,{interpolateAlpha:!0});this.lookup.colormapLut=Mt({colormap:c}),this.lookup.rendererJSON=t}return this.lookup.gamma=l&&a?.length?a:null,this.canRenderInWebGL=e!=="histogramEqualization",{success:!0}}_generateColormapWebGLParams(t){const{indexedColormap:e,offset:r}=this.lookup.colormapLut||{};return{colormap:e,colormapOffset:r,isClassBreaks:t,type:"lut"}}_generateStretchWebGLParams(t,e,r){const{colormapLut:n}=this.lookup,o=e.colorRamp?n?.indexedColormap:null,l=e.colorRamp?n?.offset:null;e.stretchType==="histogramEqualization"&&(e={...e,stretchType:"minMax"});const{gamma:h}=this.lookup,a=!(!e.useGamma||!h?.some(g=>g!==1));let i=0;t!=null&&(i=t.getPlaneCount(),i===2&&((t=t.clone()).statistics=[t.statistics[0]],t.pixels=[t.pixels[0]]));const{bandCount:u}=this.rasterInfo,c=Math.min(3,r?.length||i||u,u),s=o||a?1:255,f=new Float32Array(c);if(a&&h)for(let g=0;g<c;g++)h[g]>1?h[g]>2?f[g]=6.5+(h[g]-2)**2.5:f[g]=6.5+100*(2-h[g])**4:f[g]=1;const d=a&&h?[h[0],h[1]??h[0],h[2]??h[0]]:[1,1,1],m=a?[f[0],f[1]??f[0],f[2]??f[0]]:[1,1,1];if(e.dra&&t==null&&(e.stretchType==="minMax"||e.stretchType==="standardDeviation"))return{bandCount:c,minOutput:(e.min??0)/s,maxOutput:(e.max??255)/s,minCutOff:[0,0,0],maxCutOff:[1,1,1],factor:[1,1,1],useGamma:a,gamma:d,gammaCorrection:m,colormap:o,colormapOffset:l,stretchType:e.stretchType,dynamicRangeAdjustment:e.dra,numberOfStandardDeviations:e.numberOfStandardDeviations??2,type:"stretch"};const{minCutOff:C,maxCutOff:y,minOutput:p,maxOutput:b}=Pt(e,{rasterInfo:this.rasterInfo,pixelBlock:t,bandIds:r});C.length===1&&(C[2]=C[1]=C[0]),y.length===1&&(y[2]=y[1]=y[0]);const k=y.map((g,w)=>y[w]===C[w]?0:(b-p)/(y[w]-C[w])/s);return{bandCount:c,minOutput:p/s,maxOutput:b/s,minCutOff:C,maxCutOff:y,factor:k,useGamma:a,gamma:d,gammaCorrection:m,colormap:o,colormapOffset:l,stretchType:e.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(t,e=!1,r={x:0,y:0}){const{colormapLut:n}=this.lookup,o=t.colorRamp?n?.indexedColormap:null,l=t.colorRamp?n?.offset:null,h={...t,isGCS:e,resolution:r},a=ke(h),i=this.rasterInfo.statistics?.[0];return{...a,minValue:i?.min??0,maxValue:i?.max??8e3,hillshadeType:t.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:o,colormapOffset:l}}_generateVectorFieldWebGLParams(t){const{style:e,inputUnit:r,outputUnit:n,visualVariables:o,symbolTileSize:l,flowRepresentation:h}=t,a=this.rasterInfo.statistics?.[0].min??0,i=this.rasterInfo.statistics?.[0].max??50,u=o?.find(p=>p.type==="sizeInfo")??{maxDataValue:i,maxSize:.8*l,minDataValue:a,minSize:.2*l},c=u.minDataValue??a,s=u.maxDataValue??i,f=u.maxSize!=null&&u.minSize!=null?[u.minSize/l,u.maxSize/l]:[.2,.8];if(e==="wind_speed"){const p=(f[0]+f[1])/2;f[0]=f[1]=p}const d=c!=null&&s!=null?[c,s]:null;let m=null;if(e==="classified_arrow")if(c!=null&&s!=null&&u!=null){m=[];const p=(u.maxDataValue-u.minDataValue)/5;for(let b=0;b<6;b++)m.push(u.minDataValue+p*b)}else m=[0,1e-6,3.5,7,10.5,14];const C=h==="flow_to"==(e==="ocean_current_kn"||e==="ocean_current_m")?0:Math.PI,y=o?.find(p=>p.type==="rotationInfo");return{breakValues:m,dataRange:d,inputUnit:r,outputUnit:n,symbolTileSize:l,symbolPercentRange:f,style:e||"single_arrow",rotation:C,rotationType:this.rasterInfo.storageInfo?.tileInfo&&this.rasterInfo.dataType==="vector-uv"?"geographic":y?.rotationType||t.rotationType,type:"vectorField"}}};function mn(t){return t==="percentClip"||t==="histogramEqualization"}function gn(t){return t!=null&&t.length>0&&t[0].min!=null&&t[0].max!=null}function Lr(t){return vt(t)&&t.validPixelCount!==0}function yn(t){return t.type==="algorithmic"&&["0,0,0,255","0,0,0"].includes(t.fromColor.join(","))&&["255,255,255,255","255,255,255"].includes(t.toColor.join(","))}L([D({json:{write:!0}})],xt.prototype,"rendererJSON",void 0),L([D({type:Z,json:{write:!0}})],xt.prototype,"rasterInfo",void 0),L([D({json:{write:!0}})],xt.prototype,"lookup",void 0),L([D()],xt.prototype,"canRenderInWebGL",void 0),xt=L([Ut("esri.renderers.support.RasterSymbolizer")],xt);export{xe as $,Be as A,se as B,Bt as C,Wr as D,je as E,Jr as F,we as G,gr as H,Zt as I,kr as J,St as K,Yo as L,dn as M,mr as N,xt as O,eo as P,pn as Q,Zo as R,Pr as S,ke as T,He as U,Rr as V,hn as W,Pt as X,yr as Y,Se as Z,Xt as _,jr as a,ur as b,ve as c,Jt as d,It as e,ro as f,qe as g,vr as h,Qo as i,Tr as j,ln as k,Q as l,Z as m,De as n,$o as o,tn as p,ae as q,Kt as r,to as s,cr as t,Ar as u,un as v,Fe as w,Hr as x,Er as y,fn as z};
