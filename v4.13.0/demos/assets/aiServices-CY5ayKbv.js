import{a as N,r as T}from"./enum-DjCgFROZ.js";import{r as Et,i as Ht,h as I,l as Kt}from"./TimeOnly-C1MWI3zZ.js";import{S as Wt,c4 as Y,dY as b,de as S,d_ as m,d$ as j,e0 as Q,c1 as ft,dZ as x,aZ as Jt,j0 as Xt,dX as Qt,by as te,ao as ht,an as dt,cu as mt,R as ee,gZ as ne,I as re,fT as se,aY as At,z as yt,q as w,v as C,x as pt,$ as ae,s as ie,i as oe,Y as le,aU as ue}from"./main-6eEsl9OJ.js";import{t as J}from"./ImmutableArray-BPVd6ESQ.js";import{y as ce,P as Ot}from"./shared-C3O93oAv.js";import{l as fe,p as he}from"./number-BtRhnL1q.js";import{t as de}from"./commonProperties-DHiB1uzW.js";import{a as me,f as ye,s as pe}from"./utils-DSziZ_FA.js";function ge(t){if(typeof t=="string")return t.toLowerCase();if("name"in t)return t.name.toLowerCase();if(typeof t.value!="string")throw new N(null,T.InvalidIdentifier,null);return t.value.toLowerCase()}const on=Object.freeze({aborted:!1});let gt=class{};class B{constructor(){}}function Ft(t,e,n){if(t instanceof B&&!(t instanceof it)){const s=new it;return s.fn=t,s.parameterEvaluator=n,s.context=e,s}return t}let un=class extends B{constructor(e){super(),this.fn=e}createFunction(e){return(...n)=>this.fn(e,{preparsed:!0,arguments:n})}call(e,n){return this.fn(e,n)}marshalledCall(e,n,s,r){return r(e,n,(a,i,l)=>{l=l.map(u=>u instanceof B&&!(u instanceof it)?Ft(u,e,r):u);const c=this.call(s,{args:l});return Wt(c)?c.then(u=>Ft(u,s,r)):c})}},it=class extends B{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,n){return this.fn.marshalledCall(e,n,this.context,this.parameterEvaluator)}marshalledCall(e,n,s){return this.fn.marshalledCall(e,n,this.context,this.parameterEvaluator)}},K=class Lt extends J{constructor(e,n,s,r,a,i){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=n,this._hasZ=s,this._hasM=r,this._cacheId=a,this._partId=i}get(e){if(this._lazyPt[e]===void 0){const n=this._elements[e];if(n===void 0)return;const s=new Y(n[0],n[1],this._spRef);this._hasZ&&(s.z=n[2]),this._hasM&&(s.m=this._hasZ?n[3]:n[2]),s.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=s}return this._lazyPt[e]}equalityTest(e){return e===this||e!==null&&e instanceof Lt&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}};class bt extends J{constructor(e,n,s,r,a){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=s,this._hasM=r,this._spRef=n,this._cacheId=a}get(e){if(this._lazyPath[e]===void 0){const n=this._elements[e];if(n===void 0)return;this._lazyPath[e]=new K(n,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||e!==null&&e instanceof bt&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}let be=class{constructor(e){this.value=e}};class Se{constructor(e){this.value=e}}const _={type:"VOID"},_e=Symbol("BREAK"),we=Symbol("CONTINUE");function E(t,e,n){return e===""||e==null||e===n||e===n?t:t=t.split(e).join(n)}function V(t){return t instanceof B}function St(t){return t instanceof gt}function U(t){return!!m(t)||!!S(t)||!!d(t)||!!y(t)||!!p(t)||!!b(t)||t===null||t===_||typeof t=="number"}function Ne(t,e){return t===void 0?e:t}function Te(t){return t==null?"":x(t)||k(t)?"Array":d(t)?"Date":p(t)?"Time":y(t)?"DateOnly":m(t)?"String":b(t)?"Boolean":S(t)?"Number":t?.declaredClass==="esri.arcade.Attachment"?"Attachment":t?.declaredClass==="esri.arcade.Portal"?"Portal":t?.declaredClass==="esri.arcade.Dictionary"?"Dictionary":xt(t)?"KnowledgeGraph":t instanceof gt?"Module":W(t)?"Feature":t instanceof Y?"Point":t instanceof ht?"Polygon":t instanceof dt?"Polyline":t instanceof mt?"Multipoint":t instanceof ft?"Extent":V(t)?"Function":wt(t)?"FeatureSet":Tt(t)?"FeatureSetCollection":_t(t)?"Voxel":t===_?"":typeof t=="number"&&isNaN(t)?"Number":"Unrecognized Type"}function xe(t){return t===_}function nt(t){return t instanceof j}function W(t){return t?.arcadeDeclaredClass==="esri.arcade.Feature"}function _t(t){return t?.arcadeDeclaredClass==="esri.arcade.Voxel"}function wt(t){return t?.declaredRootClass==="esri.arcade.featureset.support.FeatureSet"}function Nt(t){return t?.declaredClass==="esri.arcade.Dictionary"}function ve(t){return Nt(t)||W(t)||_t(t)}function Tt(t){return t?.declaredRootClass==="esri.arcade.featureSetCollection"}function xt(t){return t?.declaredClass==="esri.rest.knowledgeGraph.KnowledgeGraph"}function k(t){return t instanceof J}function d(t){return t instanceof I}function y(t){return t instanceof Ht}function p(t){return t instanceof Et}function ot(t){return t!=null&&typeof t=="object"}function Mt(t,e,n,s,r){if(t.length<e||t.length>n)throw new N(s,T.WrongNumberOfParameters,r)}function Ce(t){return t<0?-Math.round(-t):Math.round(t)}function vt(t,e){return isNaN(t)||e==null||e===""?t.toString():(e=E(e,"‰",""),e=E(e,"¤",""),fe(t,{pattern:e}))}function rt(t,e){return e==null||e===""?t.toISOString(!0):t.toFormat(jt(e),{locale:Jt(),numberingSystem:"latn"})}function jt(t,e=!1){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const s=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const r of t.match(s)||[])switch(r){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=e?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=e?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?n+=`'${r.slice(1,-1)}'`:n+=`'${r}'`}return n}function o(t,e,n){switch(n){case">":return t>e;case"<":return t<e;case">=":return t>=e;case"<=":return t<=e}return!1}function Ze(t,e,n){if(t===null){if(e===null||e===_)return o(null,null,n);if(S(e))return o(0,e,n);if(m(e)||b(e))return o(0,f(e),n);if(d(e))return o(0,e.toNumber(),n);if(p(e)||y(e))return o(t,e.toNumber(),n)}if(t===_){if(e===null||e===_)return o(null,null,n);if(S(e))return o(0,e,n);if(m(e)||b(e))return o(0,f(e),n);if(d(e))return o(0,e.toNumber(),n);if(p(e)||y(e))return o(t,e.toNumber(),n)}else if(S(t)){if(S(e))return o(t,e,n);if(b(e))return o(t,f(e),n);if(e===null||e===_)return o(t,0,n);if(m(e))return o(t,f(e),n);if(d(e)||p(e)||y(e))return o(t,e.toNumber(),n)}else if(m(t)){if(m(e))return o(D(t),D(e),n);if(d(e)||p(e)||y(e))return o(f(t),e.toNumber(),n);if(S(e))return o(f(t),e,n);if(e===null||e===_)return o(f(t),0,n);if(b(e))return o(f(t),f(e),n)}else if(d(t)){if(d(e))return t.timeZone!==e.timeZone&&(t.isUnknownTimeZone?t=I.arcadeDateAndZoneToArcadeDate(t,e.timeZone):e.isUnknownTimeZone&&(e=I.arcadeDateAndZoneToArcadeDate(e,t.timeZone))),o(t.toNumber(),e.toNumber(),n);if(e===null||e===_)return o(t.toNumber(),0,n);if(S(e))return o(t.toNumber(),e,n);if(b(e)||m(e))return o(t.toNumber(),f(e),n);if(p(e))throw new N(null,T.CannotCompareDateAndTime,null);if(y(e))return o(t.toNumber(),e.toNumber(),n)}else if(b(t)){if(b(e))return o(t,e,n);if(S(e))return o(f(t),f(e),n);if(d(e)||p(e)||y(e))return o(f(t),e.toNumber(),n);if(e===null||e===_)return o(f(t),0,n);if(m(e))return o(f(t),f(e),n)}else if(y(t)){if(d(e))return o(t.toNumber(),e.toNumber(),n);if(e===null||e===_)return o(t.toNumber(),0,n);if(S(e))return o(t.toNumber(),e,n);if(b(e)||m(e))return o(t.toNumber(),f(e),n);if(p(e))throw new N(null,T.CannotCompareDateAndTime,null);if(y(e))return o(t.toNumber(),e.toNumber(),n)}else if(p(t)){if(d(e))throw new N(null,T.CannotCompareDateAndTime,null);if(e===null||e===_)return o(t.toNumber(),0,n);if(S(e))return o(t.toNumber(),e,n);if(b(e)||m(e))return o(t.toNumber(),f(e),n);if(p(e))return o(t.toNumber(),e.toNumber(),n);if(y(e))throw new N(null,T.CannotCompareDateAndTime,null)}return!!Pt(t,e)&&(n==="<="||n===">=")}function Pt(t,e){if(t===e||t===null&&e===_||e===null&&t===_)return!0;if(d(t)&&d(e)||p(t)&&p(e)||y(t)&&y(e))return t.equals(e);if(t instanceof bt||t instanceof K)return t.equalityTest(e);if(t instanceof Y&&e instanceof Y){const n=t.cache._arcadeCacheId,s=e.cache._arcadeCacheId;if(n!=null)return n===s}return!!(ot(t)&&ot(e)&&(t._arcadeCacheId===e._arcadeCacheId&&t._arcadeCacheId!==void 0&&t._arcadeCacheId!==null||t._underlyingGraphic===e._underlyingGraphic&&t._underlyingGraphic!==void 0&&t._underlyingGraphic!==null))}function Rt(t,{useNumbersForDates:e}){let n="";for(const s in t){n!==""&&(n+=",");const r=t[s];r==null?n+=JSON.stringify(s)+":null":b(r)||S(r)||m(r)?n+=JSON.stringify(s)+":"+JSON.stringify(r):nt(r)?n+=JSON.stringify(s)+":"+q(r):p(r)||y(r)?n+=`${JSON.stringify(s)}:${JSON.stringify(r.toString())}`:k(r)||Array.isArray(r)?n+=JSON.stringify(s)+":"+q(r,null,e):d(r)?n+=e?JSON.stringify(s)+":"+JSON.stringify(r.getTime()):JSON.stringify(s)+":"+r.stringify():r!==null&&typeof r=="object"&&"castToText"in r&&(n+=JSON.stringify(s)+":"+r.castToText(e))}return"{"+n+"}"}function D(t,e){if(m(t))return t;if(t===null)return"";if(S(t))return vt(t,e);if(b(t))return t.toString();if(d(t))return rt(t,e);if(p(t)||y(t))return t.toFormat(e);if(t instanceof j)return JSON.stringify(t.toJSON());if(x(t)){const n=[];for(let s=0;s<t.length;s++)n[s]=tt(t[s]);return"["+n.join(",")+"]"}if(t instanceof J){const n=[];for(let s=0;s<t.length();s++)n[s]=tt(t.get(s));return"["+n.join(",")+"]"}return t!==null&&typeof t=="object"&&"castToText"in t?t.castToText():V(t)?"object, Function":t===_?"":St(t)?"object, Module":""}function ke(t){const e=[];if(t instanceof J){for(let n=0;n<t.length();n++)e[n]=f(t.get(n));return e}if(!x(t))return null;for(let n=0;n<t.length;n++)e[n]=f(t[n]);return e}function q(t,e,n=!1){if(m(t))return t;if(t===null)return"";if(S(t))return vt(t,e);if(b(t))return t.toString();if(d(t))return rt(t,e);if(p(t)||y(t))return t.toFormat(e);if(t instanceof j)return t instanceof ft?'{"xmin":'+t.xmin.toString()+',"ymin":'+t.ymin.toString()+","+(t.hasZ?'"zmin":'+t.zmin.toString()+",":"")+(t.hasM?'"mmin":'+t.mmin.toString()+",":"")+'"xmax":'+t.xmax.toString()+',"ymax":'+t.ymax.toString()+","+(t.hasZ?'"zmax":'+t.zmax.toString()+",":"")+(t.hasM?'"mmax":'+t.mmax.toString()+",":"")+'"spatialReference":'+lt(t.spatialReference)+"}":lt(t.toJSON(),(s,r)=>s.key===r.key?0:s.key==="spatialReference"?1:r.key==="spatialReference"||s.key<r.key?-1:s.key>r.key?1:0);if(x(t)){const s=[];for(let r=0;r<t.length;r++)s[r]=tt(t[r],n);return"["+s.join(",")+"]"}if(t instanceof J){const s=[];for(let r=0;r<t.length();r++)s[r]=tt(t.get(r),n);return"["+s.join(",")+"]"}return t!==null&&typeof t=="object"&&"castToText"in t?t.castToText(n):V(t)?"object, Function":t===_?"":St(t)?"object, Module":""}function tt(t,e=!1){if(t===null)return"null";if(b(t)||S(t)||m(t))return JSON.stringify(t);if(t instanceof j||t instanceof J||Array.isArray(t))return q(t,null,e);if(d(t))return JSON.stringify(e?t.getTime():rt(t,""));if(p(t)||y(t))return JSON.stringify(t.toString());if(t!==null&&typeof t=="object"){if("castToText"in t)return t.castToText(e)}else if(t===_)return"null";return"null"}function f(t,e){return S(t)?t:t===null||t===""?0:d(t)||y(t)||p(t)?NaN:b(t)?t?1:0:x(t)||t===""||t===void 0?NaN:e!==void 0&&m(t)?(e=E(e,"‰",""),e=E(e,"¤",""),he(t,{pattern:e})):t===_?0:Number(t)}function Ae(t,e){if(d(t))return t;if(m(t)){const n=Oe(t,e);if(n)return I.dateTimeToArcadeDate(n)}return null}function Oe(t,e){const n=/ (\d\d)/,s=Kt(e);let r=At.fromISO(t,{zone:s});return r.isValid||n.test(t)&&(t=t.replace(n,"T$1"),r=At.fromISO(t,{zone:e}),r.isValid)?r:null}function Fe(t){return b(t)?t:m(t)?(t=t.toLowerCase())==="true":!!S(t)&&t!==0&&!isNaN(t)}function $e(t,e){const n=JSON.parse(t);return n&&!n.spatialReference&&(n.spatialReference=e),te(n)}function De(t,e){return t==null?null:(t.spatialReference!==null&&t.spatialReference!==void 0||(t.spatialReference=e),t)}function Je(t){if(t===null)return null;if(t instanceof Y)return t.x==="NaN"||t.x===null||isNaN(t.x)?null:t;if(t instanceof ht){if((t.curveRings??t.rings).length===0)return null;for(const e of t.curveRings??t.rings)if(e.length>0)return t;return null}if(t instanceof dt){if((t.curvePaths??t.paths).length===0)return null;for(const e of t.curvePaths??t.paths)if(e.length>0)return t;return null}return t instanceof mt?t.points.length===0?null:t:t instanceof ft?t.xmin==="NaN"||t.xmin===null||isNaN(t.xmin)?null:t:null}function It(t,e){if(!t||!t.domain)return e;let n=null,s=null;if(d(e))n=e.toNumber();else if(y(e))n=e.toString();else if(p(e))n=e.toStorageString();else if(t.field.type==="string"||t.field.type==="esriFieldTypeString")n=D(e);else{if(e==null)return null;if(e==="")return e;n=f(e)}for(let r=0;r<t.domain.codedValues.length;r++){const a=t.domain.codedValues[r];a.code===n&&(s=a)}return s===null?D(e):s.name}function zt(t,e){if(!t||!t.domain)return e;let n=null;const s=D(e);for(let r=0;r<t.domain.codedValues.length;r++){const a=t.domain.codedValues[r];a.name===s&&(n=a)}return n===null?e:n.code}function st(t,e,n=null,s=null){if(!e||!e.fields)return null;let r,a,i=null;for(let h=0;h<e.fields.length;h++){const g=e.fields[h];g.name.toLowerCase()===t.toString().toLowerCase()&&(i=g)}if(i===null)throw new N(null,T.FieldNotFound,null,{key:t});let l=e.typeIdField,c="id",u=e.types;if(e.subtypeField&&(l=e.subtypeField,c="code",u=e.subtypes??[]),s===null&&n&&l)s=n.hasField(l)?n.field(l):null;else if(l&&s!==null){let h=!1;for(const g of u||[])if(s===g[c]){h=!0;break}if(!h){for(const g of u||[])if(s===g.name){s=g[c],h=!0;break}}h||(s=null,n&&l&&(s=n.hasField(l)?n.field(l):null))}return s!=null&&u.some(h=>h[c]===s&&(r=h.domains?.[i.name],r&&r.type==="inherited"&&(r=$t(i.name,e),a=!0),!0)),a||r||(r=$t(t,e)),{field:i,domain:r}}function $t(t,e){let n;return e.fields.some(s=>(s.name.toLowerCase()===t.toLowerCase()&&(n=s.domain),!!n)),n}function lt(t,e){e||(e={}),typeof e=="function"&&(e={cmp:e});const n=typeof e.cycles=="boolean"&&e.cycles,s=e.cmp&&(r=e.cmp,function(i){return function(l,c){const u={key:l,value:i[l]},h={key:c,value:i[c]};return r(u,h)}});var r;const a=[];return function i(l){if(l?.toJSON&&typeof l.toJSON=="function"&&(l=l.toJSON()),l===void 0)return;if(typeof l=="number")return isFinite(l)?""+l:"null";if(typeof l!="object")return JSON.stringify(l);let c,u;if(Array.isArray(l)){for(u="[",c=0;c<l.length;c++)c&&(u+=","),u+=i(l[c])||"null";return u+"]"}if(l===null)return"null";if(a.includes(l)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=a.push(l)-1,g=Object.keys(l).sort(s?.(l));for(u="",c=0;c<g.length;c++){const F=g[c],v=i(l[F]);v&&(u&&(u+=","),u+=JSON.stringify(F)+":"+v)}return a.splice(h,1),"{"+u+"}"}(t)}function Le(t){if(t===null)return null;const e=[];for(const n of t)W(n)?e.push(n.geometry()):e.push(n);return e}function G(t,e){if(!(e instanceof Y))throw new N(null,T.InvalidParameter,null);t.push(e.hasZ?e.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])}function Me(t,e){if(x(t)||k(t)){let n=!1,s=!1,r=[],a=e;if(x(t)){for(const i of t)G(r,i);r.length>0&&(a=t[0].spatialReference,n=t[0].hasZ,s=t[0].hasM)}else if(t instanceof K)r=t._elements,r.length>0&&(n=t._hasZ,s=t._hasM,a=t.get(0).spatialReference);else{if(!k(t))throw new N(null,T.InvalidParameter,null);for(const i of t.toArray())G(r,i);r.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,s=t.get(0).hasM===!0)}return r.length===0?null:(se(r)||(r=r.slice().reverse()),new ht({rings:[r],spatialReference:a,hasZ:n,hasM:s}))}return t}function je(t,e){if(x(t)||k(t)){let n=!1,s=!1,r=[],a=e;if(x(t)){for(const i of t)G(r,i);r.length>0&&(a=t[0].spatialReference,n=t[0].hasZ===!0,s=t[0].hasM===!0)}else if(t instanceof K)r=t._elements,r.length>0&&(n=t._hasZ,s=t._hasM,a=t.get(0).spatialReference);else if(k(t)){for(const i of t.toArray())G(r,i);r.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,s=t.get(0).hasM===!0)}return r.length===0?null:new dt({paths:[r],spatialReference:a,hasZ:n,hasM:s})}return t}function Pe(t,e){if(x(t)||k(t)){let n=!1,s=!1,r=[],a=e;if(x(t)){for(const i of t)G(r,i);r.length>0&&(a=t[0].spatialReference,n=t[0].hasZ===!0,s=t[0].hasM===!0)}else if(t instanceof K)r=t._elements,r.length>0&&(n=t._hasZ,s=t._hasM,a=t.get(0).spatialReference);else if(k(t)){for(const i of t.toArray())G(r,i);r.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,s=t.get(0).hasM===!0)}return r.length===0?null:new mt({points:r,spatialReference:a,hasZ:n,hasM:s})}return t}function ut(t,e=!0){if(t==null)return[];if(x(t)){const n=[];for(const s of t){const r=D(s);(e||r!=="")&&n.push(r)}return n}if(k(t)){const n=[];for(let s=0;s<t.length();s++){const r=D(t.get(s));(e||r!=="")&&n.push(r)}return n}if(U(t)){const n=D(t);if(e||n!=="")return[n]}return[]}let at=0;function Re(t){return at++,at%100==0?(at=0,new Promise(e=>{setTimeout(()=>{e(t)},0)})):t}function Ie(t,e,n){switch(n){case"&":return t&e;case"|":return t|e;case"^":return t^e;case"<<":return t<<e;case">>":return t>>e;case">>>":return t>>>e}}function z(t,e=null){return t==null?null:b(t)||S(t)||m(t)?t:t instanceof j?e?.keepGeometryType===!0?t:t.toJSON():t instanceof J?t.toArray().map(n=>z(n,e)):Array.isArray(t)?t.map(n=>z(n,e)):Q(t)?t:d(t)?t.toJSDate():p(t)?t.toString():y(t)?t.toJSDate():t!==null&&typeof t=="object"&&t.castAsJson!==void 0?t.castAsJson(e):null}async function ze(t,e,n,s,r){const a=await Ct(t,e,n);r[s]=a}async function Ct(t,e=null,n=null){if(t instanceof J&&(t=t.toArray()),t==null)return null;if(U(t)||t instanceof j||Q(t)||d(t))return z(t,n);if(Array.isArray(t)){const s=[],r=[];for(const a of t)a===null||U(a)||a instanceof j||Q(a)||d(a)?r.push(z(a,n)):(r.push(null),s.push(ze(a,e,n,r.length-1,r)));return s.length>0&&await Promise.all(s),r}return t!==null&&typeof t=="object"&&t.castAsJsonAsync!==void 0?t.castAsJsonAsync(e,n):null}function X(t){return qt(t)?t.parent:t}function qt(t){return t&&"declaredClass"in t&&t.declaredClass==="esri.layers.support.SubtypeSublayer"}function qe(t){return t&&"declaredClass"in t&&t.declaredClass==="esri.layers.SubtypeGroupLayer"}function Ye(t,e,n){const s=X(t.fullSchema());return s===null||!s.fields?null:st(e,s,t,n)}function Ue(t){const e=X(t.fullSchema());return e===null?null:e.fields?e.subtypeField?{subtypeField:e.subtypeField,subtypes:e.subtypes?e.subtypes.map(n=>({name:n.name,code:n.code})):[]}:e.typeIdField?{subtypeField:e.typeIdField,subtypes:e.types?e.types.map(n=>({name:n.name,code:n.id})):[]}:null:null}function Ge(t,e,n,s){const r=X(t.fullSchema());if(r===null||!r.fields)return null;const a=st(e,r,t,s);if(n===void 0)try{n=t.field(e)}catch{return null}return It(a,n)}function Ve(t,e,n,s){const r=X(t.fullSchema());if(r===null||!r.fields)return null;if(n===void 0){try{n=t.field(e)}catch{return null}return n}return zt(st(e,r,t,s),n)}function Be(t){return t?.timeZone??"system"}function Ee(t){const e=X(t.fullSchema());if(e===null||!e.fields)return null;const n=[];for(const s of e.fields)n.push(ce(s));return{objectIdField:e.objectIdField,globalIdField:e.globalIdField??"",geometryType:Ot[e.geometryType]===void 0?"":Ot[e.geometryType],fields:n}}function He(t,e){const n=I.systemTimeZoneCanonicalName;return t==="system"&&(t=n),{version:Yt,engineVersion:ne,timeZone:t,userTimeZone:n,spatialReference:e instanceof re?e.toJSON():e,application:ee.applicationName??"",engine:"web",locale:Jt()}}const Yt="1.32",dn=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Se,ReturnResult:be,absRound:Ce,arcadeVersion:Yt,autoCastArrayOfPointsToMultiPoint:Pe,autoCastArrayOfPointsToPolygon:Me,autoCastArrayOfPointsToPolyline:je,autoCastFeatureToGeometry:Le,binaryOperator:Ie,breakResult:_e,castAsJson:z,castAsJsonAsync:Ct,castRecordToText:Rt,continueResult:we,defaultExecutingContext:He,defaultTimeZone:Be,defaultUndefined:Ne,equalityTest:Pt,featureDomainCodeLookup:Ve,featureDomainValueLookup:Ge,featureFullDomain:Ye,featureSchema:Ee,featureSubtypes:Ue,fixNullGeometry:Je,fixSpatialReference:De,formatDate:rt,formatNumber:vt,getDomain:st,getDomainCode:zt,getDomainValue:It,getType:Te,greaterThanLessThan:Ze,isArray:x,isBoolean:b,isDate:d,isDateOnly:y,isDictionary:Nt,isDictionaryLike:ve,isFeature:W,isFeatureSet:wt,isFeatureSetCollection:Tt,isFunctionParameter:V,isGeometry:nt,isGraphic:Qt,isImmutableArray:k,isInteger:Xt,isJsDate:Q,isKnowledgeGraph:xt,isModule:St,isNumber:S,isObject:ot,isSimpleType:U,isString:m,isSubtypeGrouplayer:qe,isSubtypeSublayer:qt,isTime:p,isVoid:xe,isVoxel:_t,multiReplace:E,parseGeometryFromJson:$e,pcCheck:Mt,stableStringify:lt,standardiseDateFormat:jt,tick:Re,toBoolean:Fe,toDate:Ae,toNumber:f,toNumberArray:ke,toString:D,toStringArray:ut,toStringExplicit:q,voidOperation:_},Symbol.toStringTag,{value:"Module"}));function mn(t){Ut=t}let Ut;function ct(t){return t===null?null:d(t)?t.clone():U(t)?t:nt(t)?t.clone():k(t)?t.toArray().map(e=>ct(e)):x(t)?t.map(e=>ct(e)):W(t)?Ut.createFromArcadeFeature(t):Tt(t)||wt(t)?t:Nt(t)||t?.declaredClass==="esri.arcade.Attachment"?t.deepClone():(t?.declaredClass==="esri.arcade.Portal"||xt(t)||t instanceof gt||V(t),t)}function et(t,e,n=!1,s=!1){if(t==null)return null;if(S(t)||b(t)||m(t)||d(t)||y(t)||p(t))return t;if(x(t)){const a=[];for(const i of t)a.push(et(i,e,n,s));return a}if(s&&nt(t))return t;const r=new O;r.immutable=!1;for(const[a,i]of Object.entries(t))i!==void 0&&r.setField(a,et(i,e,n,s));return r.immutable=n,r}class O{constructor(e){this.declaredClass="esri.arcade.Dictionary",this.plain=!1,this.immutable=!0,e instanceof O?this.attributes=e.attributes:e==null?this.attributes=Object.create(null):Object.getPrototypeOf(e)!=null?this.attributes={__proto__:null,...e}:this.attributes=e}static containerEntry(e,n){return new O({__proto__:null,key:e,value:n})}static textFormatting(){const e=new O({__proto__:null,newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});return e.immutable=!1,e}field(e){const n=e.toLowerCase(),s=this.attributes[e];if(s!==void 0)return s;for(const r in this.attributes)if(r.toLowerCase()===n)return this.attributes[r];throw new N(null,T.FieldNotFound,null,{key:e})}setField(e,n){if(this.immutable)throw new N(null,T.Immutable,null);if(V(n))throw new N(null,T.NoFunctionInDictionary,null);const s=e.toLowerCase();if(n instanceof Date&&(n=I.dateJSToArcadeDate(n)),this.attributes[e]===void 0){for(const r in this.attributes)if(r.toLowerCase()===s)return void(this.attributes[r]=n);this.attributes[e]=n}else this.attributes[e]=n}hasField(e){const n=e.toLowerCase();if(this.attributes[e]!==void 0)return!0;for(const s in this.attributes)if(s.toLowerCase()===n)return!0;return!1}keys(){let e=[];for(const n in this.attributes)e.push(n);return e=e.sort(),e}castToText(e=!1){return Rt(this.attributes,{useNumbersForDates:e})}static convertObjectToArcadeDictionary(e,n,s=!0,r=!1){const a=new O;a.immutable=!1;for(const i in e){const l=e[i];l!==void 0&&a.setField(i.toString(),et(l,n,s,r))}return a.immutable=s,a}static convertJsonToArcade(e,n,s=!1,r=!1){return et(e,n,s,r)}castAsJson(e=null){const n=Object.create(null);for(let s in this.attributes){const r=this.attributes[s];r!==void 0&&(e?.keyTranslate&&(s=e.keyTranslate(s)),n[s]=z(r,e))}return n}async castDictionaryValueAsJsonAsync(e,n,s,r=null,a){const i=await Ct(s,r,a);return e[n]=i,i}async castAsJsonAsync(e=null,n=null){const s=Object.create(null),r=[];for(let a in this.attributes){const i=this.attributes[a];n?.keyTranslate&&(a=n.keyTranslate(a)),i!==void 0&&(U(i)||i instanceof j||i instanceof I?s[a]=z(i,n):r.push(this.castDictionaryValueAsJsonAsync(s,a,i,e,n)))}return r.length>0&&await Promise.all(r),s}deepClone(){const e=new O;e.immutable=!1;for(const n of this.keys())e.setField(n,ct(this.field(n)));return e}}let $=class extends yt{constructor(t){super(t),this.text=null,this.detectedLanguage="en",this.detectedLanguageScore=-1}};w([C({type:String,json:{write:!0}})],$.prototype,"key",void 0),w([C({type:String,json:{write:!0}})],$.prototype,"text",void 0),w([C({type:String,json:{read:{source:"detectedLanguage.language"},write:{target:"detectedLanguage.language"}}})],$.prototype,"detectedLanguage",void 0),w([C({type:Number,json:{read:{source:"detectedLanguage.score"},write:{target:"detectedLanguage.score"}}})],$.prototype,"detectedLanguageScore",void 0),w([C({type:Object,json:{write:!0}})],$.prototype,"translation",void 0),$=w([pt("esri.rest.support.TranslateResult")],$);async function Ke(t,e,n){const s=e.toJSON();s.contents=JSON.stringify(s.contents),s.token=await me(e.portalUrl,e.apiKey,{signal:n?.signal,prompt:n?.authMode!=="no-prompt"});const r=ye(t),a=pe(r.query,{...n,query:s,method:"post",authMode:"anonymous"});return(await ae(r.path,a)).data.results.map(i=>$.fromJSON(i))}let R=class extends yt{constructor(t){super(t)}};w([C({type:String,json:{write:!0}})],R.prototype,"key",void 0),w([C({type:String,json:{write:!0}})],R.prototype,"text",void 0),R=w([pt("esri.rest.support.TranslateContent")],R);let A=class extends yt{constructor(t){super(t),this.to=null,this.contents=null,this.portalUrl="https://www.arcgis.com",this.translator="esri",this.from=null,this.apiKey=null,this.requestSource=null}};w([C({type:[String],json:{write:!0}})],A.prototype,"to",void 0),w([C({type:[R],json:{write:!0}})],A.prototype,"contents",void 0),w([C({type:String,json:{write:!0}})],A.prototype,"portalUrl",void 0),w([C({type:String,json:{write:!0,default:"esri"}})],A.prototype,"translator",void 0),w([C({type:String,json:{write:!0}})],A.prototype,"from",void 0),w([C(de)],A.prototype,"apiKey",void 0),w([C({type:String,json:{name:"x-esri-request-source"}})],A.prototype,"requestSource",void 0),A=w([pt("esri.rest.support.TranslateParameters")],A);class Zt{constructor(e,n){this.portal=e,this._debugLog=n}async translate(e){this.portal.loaded||await this.portal.load();const n=this.portal.helperServices?.aiUtilityServices;if(n==null)return{success:!1};const s=n.url+n.translateUtility;try{return e.requestSource??="arcade",{success:!0,results:(await Ke(s,e,{authMode:"no-prompt"})).map(r=>r.toJSON())}}catch(r){return this._debugLog!=null&&(r instanceof Error||r instanceof ie)&&this._debugLog(`TranslateText error: ${r.message}`),oe.getLogger("esri.arcade.functions.aiServices").error(r),{success:!1}}}}class We{constructor(e,n,s){this._parameters=e,this._maxTotalContentSize=n,this._maxContentsLength=s,this._requests=[],this._normalizedContents=new Map,this._contentsTotalSize=0}tryAdd(e){const n=new Set(e.filter(a=>!this._normalizedContents.has(a.text)).map(a=>a.text));if(this._requests.length+n.size>this._maxContentsLength)return null;let s=0;for(const a of n)s+=a.length;if((s+this._contentsTotalSize)*(this._parameters.to.length??1)>this._maxTotalContentSize)return null;const r=this._requests.length;for(const{key:a,text:i}of e)ue(this._normalizedContents,i,()=>[]).push({batchIdx:r,key:a});return this._requests.push(e),this._contentsTotalSize+=s,r}async send(e){const n=[],s=[];let r=0;for(const[c,u]of this._normalizedContents)n.push(new R({key:String(r++),text:c})),s.push(u);const a=new A(this._parameters);a.contents=n;const i=await e.translate(a);if(!i.success)return Array.from(this._requests,()=>i);const l=Array.from(this._requests,()=>({success:!0,results:[]}));for(const c of i.results){const u=Number(c.key);for(const h of s[u])l[h.batchIdx].results.push({...c,key:h.key})}return l}}function H(t){const e=[...new Set(t.to)].sort(),n=t.from??null,s=t.portalUrl,r=t.translator,a=t.apiKey??null;return JSON.stringify([e,n,s,r,a])}async function Dt(t,e,n){try{return(await t.yieldFor(n))[e]}catch{return{success:!1}}}class Gt{constructor(e,n,{maxTotalContentSize:s=5e4,maxContentsLength:r=1e3}={}){this._executor=e,this._service=n,this._openBatches=new Map,this._maxTotalContentSize=s,this._maxContentsLength=r}create(e){return{translate:async n=>{const s=H(n),{contents:r,to:a,from:i,translator:l,portalUrl:c,apiKey:u}=n;if(a==null)return{success:!1};if(r==null||r.every(v=>v.text.length===0))return{success:!1};const h=this._openBatches.get(s);if(h!=null){const v=h.data.tryAdd(r);if(v!=null)return await Dt(e,v,h);h.send()}const g=new We({to:a,from:i,translator:l,portalUrl:c,apiKey:u},this._maxTotalContentSize,this._maxContentsLength),F=g.tryAdd(r);if(F!=null){const v=this._executor.openBatch(g,{open:P=>{this._openBatches.set(s,P)},execute:P=>P.send(this._service),close:P=>{this._openBatches.get(s)===P&&this._openBatches.delete(s)}});return await Dt(e,F,v)}return await this._service.translate(n)}}}}function Vt(t){t.mode==="async"&&(t.functions[ge("TranslateText")]=function(e,n){return t.standardFunctionAsync(e,n,async(s,r,a)=>{if(Mt(a,2,3,s,r),!m(a[0])&&!x(a[0])&&!k(a[0]))throw new N(s,T.InvalidParameter,r);const i=ut(a[0]);if(!m(a[1])&&!x(a[1])&&!k(a[1]))throw new N(s,T.InvalidParameter,r);const l=ut(a[1]);let c=null;if(a.length>=3){if(!m(a[2]))throw new N(s,T.InvalidParameter,r);c=a[2]}const u=i.map((L,Z)=>new R({key:String(Z),text:L})),h=s.services?.portal??le.getDefault(),g=new A({to:l,contents:u,from:c,portalUrl:h.restUrl.replace(/\/sharing\/rest$/,"")}),F=new Map;let v=null;if(s.lrucache!=null){const L=s.lrucache;v??=H(g),g.contents=g.contents?.filter(Z=>{const M=L.getCachedTranslation(v,Z.text);return M==null||(F.set(Z.key,{...M,key:Z.key,text:Z.text}),!1)})}if(g.contents?.length){const L=s.services?.translation??new Zt(h,s.console),Z=await L.translate(g);if(!Z.success)return new O({__proto__:null,success:!1});for(const M of Z.results){const kt=g.contents?.find(Bt=>Bt.key===M.key)?.text;if(kt==null)throw new N(null,T.NeverReach,null);F.set(M.key,M),s.lrucache!=null&&(v??=H(g),s.lrucache.setCachedTranslation(v,kt,{detectedLanguage:M.detectedLanguage,translation:M.translation}))}}const P=Array.from(u,L=>{const Z=$.fromJSON(F.get(L.key));if(Z==null)throw new N(null,T.NeverReach,null);return Z.text=L.text,O.convertJsonToArcade(Z.toJSON(),s.timeZone??"system",!0)});return new O({__proto__:null,success:!0,results:P})})})}const yn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Gt,PortalTranslationService:Zt,getTranslateParametersKey:H,registerFunctions:Vt},Symbol.toStringTag,{value:"Module"})),pn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Gt,PortalTranslationService:Zt,getTranslateParametersKey:H,registerFunctions:Vt},Symbol.toStringTag,{value:"Module"}));export{W as $,p as A,Ve as B,st as C,It as D,Nt as E,Rt as F,V as G,nt as H,_ as I,De as J,wt as K,Pe as L,Me as M,f as N,zt as O,_e as P,ve as Q,je as R,Ae as S,Fe as T,xe as U,ut as V,Ee as W,Tt as X,we as Y,E as Z,Se as _,Mt as a,Re as a0,qt as a1,K as a2,bt as a3,U as a4,z as a5,mn as a6,ct as a7,Te as a8,jt as a9,Ce as aa,Je as ab,_t as ac,ke as ad,He as ae,dn as af,pn as ag,k as b,Ie as c,Pt as d,un as e,Ft as f,gt as g,yn as h,Be as i,O as j,Ye as k,Ue as l,Ze as m,on as n,Ge as o,D as p,Ne as q,B as r,it as s,ge as t,q as u,be as v,Le as w,xt as x,d as y,y as z};
