const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./visualVariableUtils-Q9XaDxnO.js","./main-6eEsl9OJ.js","./preload-helper-B76NpbEU.js","./main-B_8sIZOq.css","./lengthUtils-DL53yBUT.js"])))=>i.map(i=>d[i]);
import{ah as I,dx as C,aV as $,br as y,bj as A}from"./main-6eEsl9OJ.js";import{e as V}from"./utils-CcyJ7vzx.js";import{n as E,v as x}from"./jsxFactory-vcCo5QL-.js";import{_ as d}from"./preload-helper-B76NpbEU.js";import{r as R}from"./TimeExtent-DG27ZQvz.js";import{o as U}from"./intl-Dk1N7wZP.js";import{N,$ as M}from"./utils-Bbh3Mh7q.js";import{c as _}from"./typeUtils-BHaCxg3_.js";function lt({level:t,class:e,...n},o){const l=w(t);return E(`h${l}`,{...n,"aria-level":String(l),class:x(V.heading,e),role:"heading"},o)}function w(t){return I(Math.ceil(t),1,6)}function rt(t,e=1){return w(t+e)}const O=/^-?(\d+)(\.(\d+))?$/i;function T(t,e){return t-e}function B(t,e){let n,o;return n=Number(t.toFixed(e)),n<t?o=n+1/10**e:(o=n,n-=1/10**e),n=Number(n.toFixed(e)),o=Number(o.toFixed(e)),[n,o]}function Q(t,e,n,o,l){const r=F(t,e,n,o),i=r.previous==null||r.previous<=l,a=r.next==null||r.next<=l;return i&&a||r.previous+r.next<=2*l}function v(t){const e=String(t),n=e.match(O);if(n?.[1])return{integer:n[1].split("").length,fractional:n[3]?n[3].split("").length:0};if(e.toLowerCase().includes("e")){const o=e.split("e"),l=o[0],r=o[1];if(l&&r){const i=Number(l);let a=Number(r);const u=a>0;u||(a=Math.abs(a));const s=v(i);return u?(s.integer+=a,a>s.fractional?s.fractional=0:s.fractional-=a):(s.fractional+=a,a>s.integer?s.integer=1:s.integer-=a),s}}return{integer:0,fractional:0}}function F(t,e,n,o){const l={previous:null,next:null};if(n!=null){const r=t-n,i=e-n-r;l.previous=Math.floor(Math.abs(100*i/r))}if(o!=null){const r=o-t,i=o-e-r;l.next=Math.floor(Math.abs(100*i/r))}return l}function at(t,e={}){const n=t.slice(),{tolerance:o=2,strictBounds:l=!1,indexes:r=n.map((i,a)=>a)}=e;r.sort(T);for(let i=0;i<r.length;i++){const a=r[i],u=n[a],s=a===0?null:n[a-1],c=a===n.length-1?null:n[a+1],f=v(u).fractional;if(f){let m,p=0,g=!1;for(;p<=f&&!g;){const h=B(u,p);m=l&&i===0?h[1]:h[0],g=Q(u,m,s,c,o),p++}g&&(n[a]=m)}}return n}const L={maximumFractionDigits:20};function q(t){return U(t,L)}const j="<",k=">";function D(t,e,n,o){let l="";return e===0?l=`${j} `:e===n&&(l=`${k} `),l+(o?N(t,o):q(t))}const it=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function S(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const e=t.visualVariables.find(i=>i.type==="color");if(!e)return null;let n=null,o=null;if(e.stops){if(e.stops.length===1)return e.stops[0].color;n=e.stops[0].value,o=e.stops[e.stops.length-1].value}const l=n!=null&&o!=null?n+(o-n)/2:0,{getColor:r}=await d(async()=>{const{getColor:i}=await import("./visualVariableUtils-Q9XaDxnO.js").then(a=>a.b);return{getColor:i}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);return r(e,l)??null}async function st(t,e){const n=t.trailCap,o=t.trailWidth||1,l=e||await S(t)||t.color;return new C({cap:n,color:l,width:o})}function K(t,e){if(!e.field)return null;if("featureReduction"in t)switch(t.featureReduction?.type){case"cluster":case"binning":{const n=t.featureReduction.fields.find(({name:o})=>o.toLowerCase()===e.field.toLowerCase());return n&&"getField"in t?t.getField(n.onStatisticField):null}}return"getField"in t?t.getField?.(e.field):null}function W(t,e){const n="popupTemplate"in t?t.popupTemplate?.fieldInfos:null;if(n?.length&&e)return n.find(o=>o.fieldName?.toLowerCase()===e.toLowerCase())?.format?.dateFormat}function ut(t,e,n){const o=K(t,e);if(!o||!M(o)&&!$(o))return null;let l=W(t,o.name);if(!l&&o.type==="date"){let r=0,i=0;e.stops?(r=e.stops?.at(0)?.value??r,i=e.stops?.at(-1)?.value??i):"minDataValue"in e&&"maxDataValue"in e&&(r=e.minDataValue??r,i=e.maxDataValue??i),l=i-r>2*R.days?"short-date":"short-date-short-time"}return{fieldType:o.type,format:l,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in t?t.preferredTimeZone:null,viewTimeZone:n,datesInUnknownTimezone:"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone}}}function ct(t,e){if("authoringInfo"in t)return t.authoringInfo?.visualVariables?.find(({theme:n})=>n===e)}const G=new A([64,64,64]);function b(t,e){const n=[],o=t.length-1;return t.length===5?n.push(0,2,4):n.push(0,o),t.map((l,r)=>n.includes(r)?D(l,r,o,e):null)}async function At(t,e,n){let o=!1,l=[],r=[];if(t.stops){const s=t.stops;l=s.map(c=>c.value),o=s.some(c=>!!c.label),o&&(r=s.map(c=>c.label))}const i=l[0],a=l[l.length-1];if(i==null&&a==null)return null;const u=o?null:b(l,n);return(await Promise.all(l.map(async(s,c)=>{const f=t.type==="opacity"?await P(s,t,e):(await d(async()=>{const{getColor:p}=await import("./visualVariableUtils-Q9XaDxnO.js").then(g=>g.b);return{getColor:p}},__vite__mapDeps([0,1,2,3,4]),import.meta.url)).getColor(t,s),m=o?r[c]:u?.[c]??"";return f==null?null:{value:s,color:f,label:m}}))).filter(y).reverse()}async function P(t,e,n){const o=new A(n??G),l=(await d(async()=>{const{getOpacity:r}=await import("./visualVariableUtils-Q9XaDxnO.js").then(i=>i.b);return{getOpacity:r}},__vite__mapDeps([0,1,2,3,4]),import.meta.url)).getOpacity(e,t);return l!=null&&(o.a=l),o}function ft(t){let e=!1,n=[],o=[];n=t.map(a=>a.value),e=t.some(a=>!!a.label),e&&(o=t.map(a=>a.label??""));const l=n[0],r=n[n.length-1];if(l==null&&r==null)return null;const i=e?null:b(n);return n.map((a,u)=>({value:a,color:H(a,t),label:e?o[u]:i?.[u]??""})).reverse()}function H(t,e){const{startIndex:n,endIndex:o,weight:l}=Z(t,e);if(n===o)return e[n].color;const r=A.blendColors(e[n].color,e[o].color,l);return new A(r)}function Z(t,e){let n=0,o=e.length-1;return e.some((l,r)=>t<l.value?(o=r,!0):(n=r,!1)),{startIndex:n,endIndex:o,weight:(t-e[n].value)/(e[o].value-e[n].value)}}function mt(t,e){let n=[];if(t&&t.type==="multipart")t.colorRamps.reverse().forEach((o,l)=>{l===0?n.push({value:e.max,color:new A(o.toColor),label:"high"}):n.push({value:null,color:new A(o.toColor),label:""}),l===t.colorRamps.length-1?n.push({value:e.min,color:new A(o.fromColor),label:"low"}):n.push({value:null,color:new A(o.fromColor),label:""})});else{let o,l;t&&t.type==="algorithmic"?(o=t.fromColor,l=t.toColor):(o=[0,0,0,1],l=[255,255,255,1]),n=[{value:e.max,color:new A(l),label:"high"},{value:e.min,color:new A(o),label:"low"}]}return n}function pt(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(o=>o.color?.a>0);let n=e.length-1;if(e&&e[0]){const o=e[n];o&&o.ratio!==1&&(e.push(new _({ratio:1,color:o.color})),n++)}return e.map((o,l)=>{let r="";return l===0?r=t.legendOptions?.minLabel||"low":l===n&&(r=t.legendOptions?.maxLabel||"high"),{color:o.color,label:r,ratio:o.ratio}}).reverse()}export{k as a,ft as b,ct as c,pt as d,mt as e,S as f,it as g,ut as h,v as i,lt as j,F as l,rt as n,j as o,st as p,D as r,H as s,At as t,at as u};
