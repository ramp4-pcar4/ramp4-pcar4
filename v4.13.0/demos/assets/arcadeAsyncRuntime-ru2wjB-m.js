import{n as _,v as g,_ as U,U as P,G as b,P as m,Y as A,e as Z,t as w,I as p,a as z,j as v,d as j,b as k,Q as N,K as T,H as Y,N as f,p as $,m as pe,c as we,$ as Q,r as de,f as q,s as K,g as he,h as ge}from"./aiServices-CY5ayKbv.js";import{s as X,o as me,D as H,x as ye,E as be,j as ve,p as Se,C as xe,f as Ie,y as Fe,a as J,d as D,b as Me}from"./arcade--ugU4jnO.js";import{a as i,r as l,u as ee}from"./enum-DjCgFROZ.js";import{registerFunctions as Oe}from"./geomasync-wjnG5URO.js";import{I as te,dX as $e,dY as F,dZ as C,d_ as d,d$ as V,de as O}from"./main-6eEsl9OJ.js";import"./TimeOnly-C1MWI3zZ.js";import"./UnknownTimeZone-ZLOR0Bi8.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-C3O93oAv.js";import"./Field-CzUupKXc.js";import"./fieldType-B4FIlvI-.js";import"./number-BtRhnL1q.js";import"./commonProperties-DHiB1uzW.js";import"./utils-DSziZ_FA.js";import"./preload-helper-B76NpbEU.js";import"./featureConversionUtils-qJGwMYPr.js";import"./OptimizedFeature-DHftxjFm.js";import"./memoryEstimations-5hBnZCeh.js";import"./OptimizedGeometry-OYT6ACAY.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./FieldsIndex-CRdljKn6.js";import"./timeZoneUtils-DmTpvLBr.js";import"./WhereClause-Dv3x-MsT.js";import"./unitConversion-HPy-1Vfr.js";import"./uuid-Cl5lrJ4c.js";import"./portalUtils-PGxtWSpY.js";import"./operatorsWorkerConnection-DDzoV8pC.js";import"./workers-m_rvw_QY.js";import"./Queue-DXtZaugk.js";import"./intl-Dk1N7wZP.js";async function re(t,e){const r=[];for(let o=0;o<e.arguments.length;o++)r.push(await u(t,e.arguments[o]));return r}async function I(t,e,r){return e.preparsed===!0?r(t,null,e.arguments):r(t,e,await re(t,e))}class ke extends de{constructor(e,r){super(),this.definition=null,this.context=null,this.definition=e,this.context=r}createFunction(e){return(...r)=>{const o={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,services:this.context.services,abortSignal:this.context.abortSignal,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(o.depthCounter.depth>64)throw new i(e,l.MaximumCallDepth,null);return B(this.definition,o,r,null)}}call(e,r){return E(e,r,(o,n,a)=>{const s={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(s.depthCounter.depth>64)throw new i(e,l.MaximumCallDepth,r);return B(this.definition,s,a,r)})}marshalledCall(e,r,o,n){return n(e,r,async(a,s,c)=>{const S={spatialReference:e.spatialReference,services:e.services,globalScope:o.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{}};return c=c.map(y=>!b(y)||y instanceof K?y:q(y,e,n)),q(await B(this.definition,S,c,r),o,n)})}}async function B(t,e,r,o){const n=t.body;if(r.length!==t.params.length)throw new i(e,l.WrongNumberOfParameters,null);for(let s=0;s<r.length;s++){const c=t.params[s];c.type==="Identifier"&&e.localScope!=null&&(e.localScope[w(c)]={value:r[s]})}const a=await h(e,n);if(a instanceof g)return a.value;if(a===m)throw new i(e,l.UnexpectedToken,o);if(a===A)throw new i(e,l.UnexpectedToken,o);return a instanceof U?a.value:a}class M extends he{constructor(e){super(),this.source=e}global(e){const r=this.executingContext.globalScope[w(e)];if(b(r.value)&&!(r.value instanceof K)){const o=new K;return o.fn=r.value,o.parameterEvaluator=E,o.context=this.executingContext,this.executingContext.globalScope[w(e)]={value:o},o}return r.value}setGlobal(e,r){if(b(r))throw new i(null,l.AssignModuleFunction,null);this.executingContext.globalScope[w(e)]={value:r}}hasGlobal(e){return this.executingContext.exports[e]===void 0&&(e=w(e)),this.executingContext.exports[e]!==void 0}async loadModule(e){const r=e.spatialReference??te.WebMercator;this.moduleScope=ue(null,null,e.timeZone),this.executingContext={spatialReference:r,services:e.services,libraryResolver:new X(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:e.abortSignal??_,globalScope:this.moduleScope,console:e.console??fe,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},await G(this.executingContext,this.source.syntax)}}async function E(t,e,r){return e.preparsed===!0?r(t,null,e.arguments):r(t,e,await re(t,e))}async function u(t,e){e.breakpoint&&await e.breakpoint();try{switch(e.type){case"UpdateExpression":return await Ke(t,e);case"AssignmentExpression":return await De(t,e);case"TemplateLiteral":return await Xe(t,e);case"Identifier":return L(t,e);case"MemberExpression":return await We(t,e);case"Literal":return e.value;case"CallExpression":return await Qe(t,e);case"UnaryExpression":return await _e(t,e);case"BinaryExpression":return await Te(t,e);case"LogicalExpression":return await Ye(t,e);case"ArrayExpression":return await ze(t,e);case"ObjectExpression":return await Ce(t,e);default:throw new i(t,l.Unrecognized,e)}}catch(r){throw ee(t,e,r)}}async function h(t,e){e.breakpoint&&await e.breakpoint();try{switch(e.type){case"ImportDeclaration":return await Pe(t,e);case"ExportNamedDeclaration":return await qe(t,e);case"VariableDeclaration":return await ie(t,e,0);case"BlockStatement":return await G(t,e);case"FunctionDeclaration":return await Le(t,e);case"ReturnStatement":return await Ge(t,e);case"IfStatement":return await Ze(t,e);case"ExpressionStatement":return await Ue(t,e);case"ForStatement":return await Ne(t,e);case"WhileStatement":return await Re(t,e);case"ForInStatement":return await Be(t,e);case"ForOfStatement":return await je(t,e);case"BreakStatement":return m;case"EmptyStatement":return p;case"ContinueStatement":return A;default:throw new i(t,l.Unrecognized,e)}}catch(r){throw ee(t,e,r)}}async function Ce(t,e){const r=[];for(let s=0;s<e.properties.length;s++){const c=e.properties[s],S=await u(t,c.value),y=c.key.type==="Identifier"?c.key.name:await u(t,c.key);r[s]={key:y,value:S}}const o=Object.create(null),n=new Map;for(let s=0;s<r.length;s++){const c=r[s];if(b(c.value))throw new i(t,l.NoFunctionInDictionary,e);if(d(c.key)===!1)throw new i(t,l.KeyMustBeString,e);let S=c.key.toString();const y=S.toLowerCase();n.has(y)?S=n.get(y):n.set(y,S),c.value===p?o[S]=null:o[S]=c.value}const a=new v(o);return a.immutable=!1,a}async function Re(t,e){let r=await u(t,e.test);if(r===!1)return p;if(r!==!0)throw new i(t,l.BooleanConditionRequired,e);for(;r===!0;){const o=await h(t,e.body);if(o===m)break;if(o instanceof g)return o;if(r=await u(t,e.test),r!==!0&&r!==!1)throw new i(t,l.BooleanConditionRequired,e)}return p}async function Ne(t,e){try{for(e.init!==null&&(e.init.type==="VariableDeclaration"?await h(t,e.init):await u(t,e.init));;){if(e.test!==null){const o=await u(t,e.test);if(t.abortSignal?.aborted===!0)throw new i(t,l.Cancelled,e);if(o===!1)break;if(o!==!0)throw new i(t,l.BooleanConditionRequired,e)}const r=await h(t,e.body);if(r===m)break;if(r instanceof g)return r;e.update!==null&&await u(t,e.update)}return p}catch(r){throw r}}async function R(t,e,r,o,n="i"){const a=r.length;for(let s=0;s<a;s++){if(n==="k"){if(s>=r.length)throw new i(t,l.OutOfBounds,e);o.value=r[s]}else o.value=s;const c=await h(t,e.body);if(c===m)break;if(c instanceof g)return c}return p}async function oe(t,e,r,o,n="i"){const a=r.length();for(let s=0;s<a;s++){o.value=n==="k"?r.get(s):s;const c=await h(t,e.body);if(c===m)break;if(c instanceof g)return c}return p}async function ne(t,e,r,o){const n=r.iterator(t.abortSignal);let a;for(;(a=await n.next())!=null;){const s=H.createFromGraphicLikeObject(a.geometry,a.attributes,r,t.timeZone);s._underlyingGraphic=a,o.value=s;const c=await h(t,e.body);if(c===m)break;if(c instanceof g)return c}return p}async function Ae(t,e,r,o){for(const n of r.keys()){const a=r.field(n);o.value=v.containerEntry(n,a);const s=await h(t,e.body);if(s===m)break;if(s instanceof g)return s}return p}async function Ee(t,e,r,o){for(const n of J(r)){const a=D(r,n,t,e,1);o.value=v.containerEntry(n,a);const s=await h(t,e.body);if(s===m)break;if(s instanceof g)return s}return p}async function Be(t,e){const r=await u(t,e.right);e.left.type==="VariableDeclaration"&&await h(t,e.left);const o=w(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left);let n=null;if(t.localScope!=null&&t.localScope[o]!==void 0&&(n=t.localScope[o]),n===null&&t.globalScope[o]!==void 0){const a=t.globalScope[o].value;n=t.globalScope[o]={value:a}}if(n===null)throw new i(t,l.InvalidIdentifier,e);return C(r)||d(r)?await R(t,e,r,n):k(r)?await oe(t,e,r,n):r instanceof v||N(r)?await R(t,e,r.keys(),n,"k"):T(r)?await ne(t,e,r,n):Y(r)?await R(t,e,J(r),n,"k"):p}async function je(t,e){const r=await u(t,e.right);e.left.type==="VariableDeclaration"&&await h(t,e.left);const o=w(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left);let n=null;if(t.localScope!=null&&t.localScope[o]!==void 0&&(n=t.localScope[o]),n===null&&t.globalScope[o]!==void 0){const a=t.globalScope[o].value;n=t.globalScope[o]={value:a}}if(n===null)throw new i(t,l.InvalidIdentifier,e);return C(r)||d(r)?await R(t,e,r,n,"k"):k(r)?await oe(t,e,r,n,"k"):r instanceof v||N(r)?await Ae(t,e,r,n):T(r)?await ne(t,e,r,n):Y(r)?await Ee(t,e,r,n):p}async function Ke(t,e){const r=e.argument;if(r.type==="CallExpression")throw new i(t,l.NeverReach,e);if(r.type==="MemberExpression"){const a=await u(t,r.object);let s,c;if(r.computed===!0)s=await u(t,r.property);else{if(r.property.type!=="Identifier")throw new i(t,l.Unrecognized,e);s=r.property.name}if(C(a)){if(!O(s))throw new i(t,l.ArrayAccessorMustBeNumber,e);if(s<0&&(s=a.length+s),s<0||s>=a.length)throw new i(t,l.OutOfBounds,e);c=f(a[s]),a[s]=e.operator==="++"?c+1:c-1}else if(a instanceof v){if(d(s)===!1)throw new i(t,l.KeyAccessorMustBeString,e);if(a.hasField(s)!==!0)throw new i(t,l.FieldNotFound,e,{key:s});c=f(a.field(s)),a.setField(s,e.operator==="++"?c+1:c-1)}else if(a instanceof M){if(d(s)===!1)throw new i(t,l.ModuleAccessorMustBeString,e);if(a.hasGlobal(s)!==!0)throw new i(t,l.ModuleExportNotFound,e);c=f(a.global(s)),a.setGlobal(s,e.operator==="++"?c+1:c-1)}else{if(!Q(a))throw k(a)?new i(t,l.Immutable,e):new i(t,l.InvalidParameter,e);if(d(s)===!1)throw new i(t,l.KeyAccessorMustBeString,e);if(a.hasField(s)!==!0)throw new i(t,l.FieldNotFound,e,{key:s});c=f(a.field(s)),a.setField(s,e.operator==="++"?c+1:c-1)}return e.prefix===!1?c:e.operator==="++"?c+1:c-1}const o=w(r);let n;if(t.localScope!=null&&t.localScope[o]!==void 0)return n=f(t.localScope[o].value),t.localScope[o]={value:e.operator==="++"?n+1:n-1},e.prefix===!1?n:e.operator==="++"?n+1:n-1;if(t.globalScope[o]!==void 0)return n=f(t.globalScope[o].value),t.globalScope[o]={value:e.operator==="++"?n+1:n-1},e.prefix===!1?n:e.operator==="++"?n+1:n-1;throw new i(t,l.InvalidIdentifier,e)}function x(t,e,r,o,n){switch(e){case"=":return t===p?null:t;case"/=":return f(r)/f(t);case"*=":return f(r)*f(t);case"-=":return f(r)-f(t);case"+=":return d(r)||d(t)?$(r)+$(t):f(r)+f(t);case"%=":return f(r)%f(t);default:throw new i(n,l.UnsupportedOperator,o)}}async function De(t,e){const r=e.left;if(r.type==="MemberExpression"){const n=await u(t,r.object);let a;if(r.computed===!0)a=await u(t,r.property);else{if(r.property.type!=="Identifier")throw new i(t,l.InvalidIdentifier,e);a=r.property.name}const s=await u(t,e.right);if(C(n)){if(!O(a))throw new i(t,l.ArrayAccessorMustBeNumber,e);if(a<0&&(a=n.length+a),a<0||a>n.length)throw new i(t,l.OutOfBounds,e);if(a===n.length){if(e.operator!=="=")throw new i(t,l.OutOfBounds,e);n[a]=x(s,e.operator,n[a],e,t)}else n[a]=x(s,e.operator,n[a],e,t)}else if(n instanceof v){if(d(a)===!1)throw new i(t,l.KeyAccessorMustBeString,e);if(n.hasField(a)===!0)n.setField(a,x(s,e.operator,n.field(a),e,t));else{if(e.operator!=="=")throw new i(t,l.FieldNotFound,e,{key:a});n.setField(a,x(s,e.operator,null,e,t))}}else if(n instanceof M){if(d(a)===!1)throw new i(t,l.KeyAccessorMustBeString,e);if(n.hasGlobal(a)!==!0)throw new i(t,l.ModuleExportNotFound,e);n.setGlobal(a,x(s,e.operator,n.global(a),e,t))}else{if(!Q(n))throw k(n)?new i(t,l.Immutable,e):new i(t,l.InvalidParameter,e);if(d(a)===!1)throw new i(t,l.KeyAccessorMustBeString,e);if(n.hasField(a)===!0)n.setField(a,x(s,e.operator,n.field(a),e,t));else{if(e.operator!=="=")throw new i(t,l.FieldNotFound,e,{key:a});n.setField(a,x(s,e.operator,null,e,t))}}return p}const o=w(r);if(t.localScope!=null&&t.localScope[o]!==void 0){const n=await u(t,e.right);return t.localScope[o]={value:x(n,e.operator,t.localScope[o].value,e,t)},p}if(t.globalScope[o]!==void 0){const n=await u(t,e.right);return t.globalScope[o]={value:x(n,e.operator,t.globalScope[o].value,e,t)},p}throw new i(t,l.InvalidIdentifier,e)}async function Ue(t,e){const r=await u(t,e.expression);return r===p?p:new U(r)}async function Ze(t,e){const r=await u(t,e.test);if(r===!0)return h(t,e.consequent);if(r===!1)return e.alternate!==null?h(t,e.alternate):p;throw new i(t,l.BooleanConditionRequired,e)}async function G(t,e){return ae(t,e,0)}async function ae(t,e,r){if(r>=e.body.length)return p;const o=await h(t,e.body[r]);return o instanceof g||o===m||o===A||r===e.body.length-1?o:ae(t,e,r+1)}async function Ge(t,e){if(e.argument===null)return new g(p);const r=await u(t,e.argument);return new g(r)}async function Le(t,e){const r=w(e.id);return t.globalScope[r]={value:new ke(e,t)},p}async function Pe(t,e){const r=w(e.specifiers[0].local),o=t.libraryResolver.loadLibrary(r);let n;return t.libraryResolver._moduleSingletons?.has(o.uri)?n=t.libraryResolver._moduleSingletons.get(o.uri):(n=new M(o),await n.loadModule(t),t.libraryResolver._moduleSingletons?.set(o.uri,n)),t.globalScope[r]={value:n},p}async function qe(t,e){if(await h(t,e.declaration),e.declaration.type==="FunctionDeclaration")t.exports[w(e.declaration.id)]="function";else if(e.declaration.type==="VariableDeclaration")for(const r of e.declaration.declarations)t.exports[w(r.id)]="variable";return p}async function ie(t,e,r){return r>=e.declarations.length?p:(await Ve(t,e.declarations[r]),r===e.declarations.length-1||await ie(t,e,r+1),p)}async function Ve(t,e){let r=null;if(r=e.init===null?null:await u(t,e.init),t.localScope!==null){if(r===p&&(r=null),e.id.type!=="Identifier")throw new i(t,l.InvalidIdentifier,e);const n=w(e.id);return void(t.localScope!=null&&(t.localScope[n]={value:r}))}if(e.id.type!=="Identifier")throw new i(t,l.InvalidIdentifier,e);const o=w(e.id);r===p&&(r=null),t.globalScope[o]={value:r}}async function We(t,e){const r=await u(t,e.object);if(r===null)throw new i(t,l.MemberOfNull,e);if(e.computed===!1){if(e.property.type==="Identifier"){if(r instanceof v||N(r))return r.field(e.property.name);if(r instanceof V)return D(r,e.property.name,t,e);if(r instanceof M){if(!r.hasGlobal(e.property.name))throw new i(t,l.InvalidIdentifier,e);return r.global(e.property.name)}throw new i(t,l.InvalidMemberAccessKey,e)}throw new i(t,l.InvalidMemberAccessKey,e)}let o=await u(t,e.property);if(r instanceof v||N(r)){if(d(o))return r.field(o);throw new i(t,l.InvalidMemberAccessKey,e)}if(r instanceof M){if(d(o))return r.global(o);throw new i(t,l.InvalidMemberAccessKey,e)}if(r instanceof V){if(d(o))return D(r,o,t,e);throw new i(t,l.InvalidMemberAccessKey,e)}if(C(r)){if(O(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=r.length+o),o>=r.length||o<0)throw new i(t,l.OutOfBounds,e);return r[o]}throw new i(t,l.InvalidMemberAccessKey,e)}if(k(r)){if(O(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=r.length()+o),o>=r.length()||o<0)throw new i(t,l.OutOfBounds,e);return r.get(o)}throw new i(t,l.InvalidMemberAccessKey,e)}if(d(r)){if(O(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=r.length+o),o>=r.length||o<0)throw new i(t,l.OutOfBounds,e);return r[o]}throw new i(t,l.InvalidMemberAccessKey,e)}throw new i(t,l.InvalidMemberAccessKey,e)}async function _e(t,e){const r=await u(t,e.argument);if(F(r)){if(e.operator==="!")return!r;if(e.operator==="-")return-1*f(r);if(e.operator==="+")return 1*f(r);if(e.operator==="~")return~f(r);throw new i(t,l.UnsupportedUnaryOperator,e)}if(e.operator==="-")return-1*f(r);if(e.operator==="+")return 1*f(r);if(e.operator==="~")return~f(r);throw new i(t,l.UnsupportedUnaryOperator,e)}async function ze(t,e){const r=[];for(let o=0;o<e.elements.length;o++)r.push(await u(t,e.elements[o]));for(let o=0;o<r.length;o++){if(b(r[o]))throw new i(t,l.NoFunctionInArray,e);r[o]===p&&(r[o]=null)}return r}async function Te(t,e){const r=await u(t,e.left),o=await u(t,e.right);switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return we(f(r),f(o),e.operator);case"==":return j(r,o);case"!=":return!j(r,o);case"<":case">":case"<=":case">=":return pe(r,o,e.operator);case"+":return d(r)||d(o)?$(r)+$(o):f(r)+f(o);case"-":return f(r)-f(o);case"*":return f(r)*f(o);case"/":return f(r)/f(o);case"%":return f(r)%f(o);default:throw new i(t,l.UnsupportedOperator,e)}}async function Ye(t,e){const r=await u(t,e.left);if(!F(r))throw new i(t,l.LogicalExpressionOnlyBoolean,e);switch(e.operator){case"||":{if(r===!0)return r;const o=await u(t,e.right);if(F(o))return o;throw new i(t,l.LogicExpressionOrAnd,e)}case"&&":{if(r===!1)return r;const o=await u(t,e.right);if(F(o))return o;throw new i(t,l.LogicExpressionOrAnd,e)}default:throw new i(t,l.LogicExpressionOrAnd,e)}}function L(t,e){const r=w(e);if(t.localScope!=null&&t.localScope[r]!==void 0)return t.localScope[r].value;if(t.globalScope[r]!==void 0)return t.globalScope[r].value;throw new i(t,l.InvalidIdentifier,e)}async function Qe(t,e){if(e.callee.type==="MemberExpression"){const o=await u(t,e.callee.object);if(!(o instanceof M))throw new i(t,l.FunctionNotFound,e);const n=e.callee.computed===!1?e.callee.property.name:await u(t,e.callee.property);if(!o.hasGlobal(n))throw new i(t,l.FunctionNotFound,e);const a=o.global(n);if(!b(a))throw new i(t,l.CallNonFunction,e);return a.call(t,e)}if(e.callee.type!=="Identifier")throw new i(t,l.FunctionNotFound,e);const r=w(e.callee);if(t.localScope!=null&&t.localScope[r]!==void 0){const o=t.localScope[r];if(b(o.value))return o.value.call(t,e);throw new i(t,l.CallNonFunction,e)}if(t.globalScope[r]!==void 0){const o=t.globalScope[r];if(b(o.value))return o.value.call(t,e);throw new i(t,l.CallNonFunction,e)}throw new i(t,l.FunctionNotFound,e)}async function Xe(t,e){let r="",o=0;for(const n of e.quasis)if(r+=n.value?n.value.cooked:"",n.tail===!1){if(e.expressions[o]){const a=await u(t,e.expressions[o]);if(b(a))throw new i(t,l.NoFunctionInTemplateLiteral,e);r+=$(a)}o++}return r}async function He(t,e){z(e.arguments===null?[]:e.arguments,3,3,t,e);const r=await u(t,e.arguments[0]);if(F(r)===!1)throw new i(t,l.BooleanConditionRequired,e);return u(t,r?e.arguments[1]:e.arguments[2])}async function Je(t,e){z(e.arguments===null?[]:e.arguments,2,3,t,e);const r=await u(t,e.arguments[0]);if(e.arguments.length===3){const o=await u(t,e.arguments[1]),n=Fe(r,o);return n!=null&&n!==""?n:u(t,e.arguments[2])}return r==null||r===""?u(t,e.arguments[1]):r}async function et(t,e){if(e.arguments.length<2)throw new i(t,l.WrongNumberOfParameters,e);if(e.arguments.length===2)return u(t,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new i(t,l.WrongNumberOfParameters,e);return le(t,e,1,await u(t,e.arguments[0]))}async function le(t,e,r,o){const n=await u(t,e.arguments[r]);if(j(n,o))return u(t,e.arguments[r+1]);const a=e.arguments.length-r;return a===1?u(t,e.arguments[r]):a===2?null:a===3?u(t,e.arguments[r+2]):le(t,e,r+2,o)}async function tt(t,e){if(e.arguments.length<3)throw new i(t,l.WrongNumberOfParameters,e);if(e.arguments.length%2==0)throw new i(t,l.WrongNumberOfParameters,e);const r=await u(t,e.arguments[0]);if(F(r)===!1)throw new i(t,l.BooleanConditionRequired,e.arguments[0]);return se(t,e,0,r)}async function se(t,e,r,o){if(o===!0)return u(t,e.arguments[r+1]);if(e.arguments.length-r===3)return u(t,e.arguments[r+2]);const n=await u(t,e.arguments[r+2]);if(F(n)===!1)throw new i(t,l.ModuleExportNotFound,e.arguments[r+2]);return se(t,e,r+2,n)}function rt(){const t=Object.create(null);ye(t,I),be(t,I),ve(t,I,L),Se(t,I),xe(t,I),Ie(t,I),Oe({functions:t,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:I,standardFunctionAsync:E}),t.iif=He,t.defaultvalue=Je,t.decode=et,t.when=tt;const e=function(){this.textformatting={value:v.textFormatting()}};e.prototype=Object.create(null),e.prototype.infinity=Object.freeze({value:Number.POSITIVE_INFINITY}),e.prototype.pi=Object.freeze({value:Math.PI});for(const[r,o]of Object.entries(t))e.prototype[r]=Object.freeze({value:new Z(o)});return e}const ce=rt();function W(t){const e={mode:"async",compiled:!1,functions:Object.create(null),signatures:[],standardFunction:I,standardFunctionAsync:E,evaluateIdentifier:L};for(let r=0;r<t.length;r++)t[r].registerFunctions(e);for(const[r,o]of Object.entries(e.functions))ce.prototype[r]=Object.freeze({value:new Z(o)});for(let r=0;r<e.signatures.length;r++)me(e.signatures[r],"async")}function ue(t,e,r){const o=new ce;t==null&&(t={}),e==null&&(e={});for(const n in e)o[n]={value:new Z(e[n])};for(const n in t)o[n]={value:$e(t[n])?H.createFromGraphic(t[n],r):t[n]};return o}function fe(t){console.log(t)}async function Et(t,e){const r=e.spatialReference??te.WebMercator;let o=null;t.usesModules&&(o=new X(new Map,t.loadedModules));const n=ue(e.vars,e.customfunctions,e.timeZone),a={spatialReference:r,services:e.services,exports:{},libraryResolver:o,abortSignal:e.abortSignal??_,globalScope:n,console:e.console??fe,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},s=await G(a,t);if(s instanceof g||s instanceof U){const c=s.value;if(P(c))return null;if(b(c))throw new i(a,l.IllegalResult,null);return c}if(P(s))return null;throw s===m?new i(a,l.IllegalResult,null):s===A?new i(a,l.IllegalResult,null):new i(a,l.NeverReach,null)}W([Me]),W([ge]);export{Et as executeScript,W as extend};
