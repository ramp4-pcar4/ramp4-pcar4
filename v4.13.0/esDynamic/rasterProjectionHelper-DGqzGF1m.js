import{am as U,L as ke,b$ as A,bp as Ee,bL as L,c2 as T,ct as Te,s as xe,d6 as v,d7 as C,J as he,d8 as ve,d9 as me,da as Ce}from"./main-BFDurRCu.js";import{$ as _e}from"./projectionUtils-B-CplN3q.js";var V;function z(){if(!ne)throw new xe("rasterprojectionhelper-project","projection operator is not loaded")}(function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"})(V||(V={}));const pe=(e,n,o,i=0)=>{if(o[0]===1)return[0,0];let r=1,t=-1,s=1,c=-1;for(let f=0;f<e.length;f+=2)isNaN(e[f])||(r=r>e[f]?e[f]:r,t=t>e[f]?t:e[f],s=s>e[f+1]?e[f+1]:s,c=c>e[f+1]?c:e[f+1]);const{cols:l,rows:a}=n,u=(t-r)/l/o[0],d=(c-s)/a/o[1],h=2*i;let m=0,x=!1,p=[0,0];for(let f=0;f<l-3;f++){for(let M=0;M<a-3;M++){const g=f*a*2+2*M,y=(e[g]+e[g+4]+e[g+4*a]+e[g+4*a+4])/4,w=(e[g+1]+e[g+5]+e[g+4*a+1]+e[g+4*a+5])/4,R=Math.abs((y-e[g+2*a+2])/u),S=Math.abs((w-e[g+2*a+3])/d);if(R+S>m&&(m=R+S,p=[R,S]),h&&m>h){x=!0;break}}if(x)break}return p},Le={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},F=32,q=4,H=q,Z=new Map,ee=new Map,Y=500,ze=39.37,Oe=96;let J,k,B,ne=!1;async function We(){return J||(J=ke(),k=await import("./projectOperator-BEghhU44.js"),B=await import("./geographicTransformationUtils-BzAGUyRl.js"),k.isLoaded()||await k.load(),B.isLoaded()||await B.load(),ne=!0,J.resolve()),J.promise}function ge(e,n,o){if(z(),o){const i=k.execute(e,n);return B.getTransformation(n,e.spatialReference,i)}return B.getTransformation(e.spatialReference,n,e)}function Ie(e,n,o,i){const r=e.spatialReference;if(!r||!n||r.equals(n))return e;z();const t=o.center,s=new A({xmin:t.x-e.x/2,xmax:t.x+e.x/2,ymin:t.y-e.y/2,ymax:t.y+e.y/2,spatialReference:r}),c=k.execute(s,n,{geographicTransformation:i}),l=E(n);return c==null||l!=null&&c.width>=l?K(e,r,n):{x:c.width,y:c.height}}function K(e,n,o){const i=L(n)/L(o);return{x:e.x*i,y:e.y*i}}function te(e,n,o){const{spatialReference:i}=o;if(!i||!n||i.equals(n))return e;if(i.isGeographic&&n.isGeographic)return K(e,i,n);if(z(),!ne)throw new xe("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:r,y:t}=e;const s=(r+t)/2*L(i);let c=1;s>30&&(c=30/s,r*=c,t*=c);const l=256,a=r*l/2,u=t*l/2,{x:d,y:h}=o.center,m=[];for(let b=0;b<=l;b++)m.push([d-a,h-u+b*t]);for(let b=1;b<=l;b++)m.push([d-a+b*r,h+u]);for(let b=1;b<=l;b++)m.push([d+a,h+u-b*t]);for(let b=1;b<l;b++)m.push([d+a-b*r,h-u]);m.push(m[0]);const x=new U({rings:[m],spatialReference:i}),p=k.execute(x,n);if(!p)return K(e,i,n);const f=p.extent,M=E(n);if(f==null||M!=null&&f.width>=M)return K(e,i,n);const g=Ze(p.rings),y=r*t*l*l,w=Math.sqrt(g/y)/c,R={x:f.width/c/l,y:f.height/c/l},S={x:r*w,y:t*w},P=R.x*R.y;return Math.abs(P-S.x*S.y)/P<.1?R:S}function oe(e,n){return(typeof e=="number"?e:(e.x+e.y)/2)*L(n)*Oe*ze}function je(e,n){const{pixelSize:o,extent:i}=e;return oe(te(o,n,i),n)}function N(e,n=.01){return L(e)?n/L(e):0}function ie(e,n,o,i=!0){const r=e.spatialReference;if(r.equals(n))return e;z();const t=k.execute(e,n,{geographicTransformation:o});return i&&t&&ye([e],[t],r,n),t}function ye(e,n,o,i){const r=$(o,!0),t=$(i,!0),s=N(o,Y),c=N(i,Y);if(s&&r!=null&&t!=null)for(let l=0;l<e.length;l++){const a=n[l];if(!a)continue;const{x:u}=e[l],{x:d}=a;d>=t[1]-c&&Math.abs(u-r[0])<s?a.x-=t[1]-t[0]:d<=t[0]+c&&Math.abs(u-r[1])<s&&(a.x+=t[1]-t[0])}}function Ae(e){const{inSR:n,outSR:o,preferPE:i}=e;if(n.equals(o)){const{points:r}=se(e,null);return r}return n.isWebMercator&&o.isWGS84||n.isWGS84&&o.isWebMercator?qe(e):i&&(n.isGeographic||O(n)!=null)?Fe(e):Be(e)}function Be(e){const{points:n}=se(e,null),{inSR:o,outSR:i,datumTransformation:r}=e,t=n.map(c=>new T(c[0],c[1],o)),s=k.executeMany(t,i,{geographicTransformation:r});return r&&ye(t,s,o,i),s.map(c=>c?[c.x,c.y]:[NaN,NaN])}function Fe(e){const{inSR:n,outSR:o,datumTransformation:i}=e,r=O(n),{points:t,mask:s}=se(e,r);if(!n.isGeographic){const l=n.wkid?v.coordsys(n.wkid):v.fromString(n.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,n.wkt2||n.wkt);me.projToGeog(l,t.length,t)}if(i!=null&&i.steps.length){let l;if(o.isGeographic&&(l=t.map(([a])=>a>179.9955?1:a<-179.9955?-1:0)),i.steps.forEach(a=>{const u=a.wkid?v.geogtran(a.wkid):v.fromString(C.PE_TYPE_GEOGTRAN,a.wkt);Ce.geogToGeog(u,t.length,t,null,a.isInverse?C.PE_TRANSFORM_2_TO_1:C.PE_TRANSFORM_1_TO_2)}),l)for(let a=0;a<t.length;a++){const u=l[a],d=t[a][0],h=d>179.9955?1:d<-179.9955?-1:0;u&&h&&u!==h&&(t[a][0]=u>0?d+360:d-360)}}if(!o.isGeographic){const l=O(o,!0),a=l!=null&&l.isEnvelope?[l.bbox[1],l.bbox[3]]:[-90,90];Ye(t,a);const u=o.wkid?v.coordsys(o.wkid):v.fromString(o.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,o.wkt2||o.wkt);me.geogToProj(u,t.length,t)}let c=t;if(s&&t.length!==s.length){c=[];for(let l=0,a=0;l<s.length;l++)s[l]?c.push(t[a++]):c.push([NaN,NaN])}return c}function qe(e){const{cols:n,rows:o,xres:i,yres:r,usePixelCenter:t,inSR:s,outSR:c}=e;let{xmin:l,ymax:a}=e;t&&(l+=i/2,a-=r/2);const u=[],d=[],h=Math.max(n,o);for(let x=0;x<h;x++){const p=l+i*Math.min(n,x),f=a-r*Math.min(o,x),M=_e(new T({x:p,y:f,spatialReference:s}),s,c);x<=n&&u.push(M.x),x<=o&&d.push(M.y)}const m=[];for(let x=0;x<n;x++)for(let p=0;p<o;p++)m.push([u[x],d[p]]);return m}function O(e,n=!1){let o=e.wkid||e.wkt2||e.wkt;if(!o||e.isGeographic)return null;if(o=String(o),Z.has(o)){const s=Z.get(o);return n?s?.gcs:s?.pcs}const i=e.wkid?v.coordsys(e.wkid):v.fromString(e.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,e.wkt2||e.wkt),r=de(i,N(e,1e-4)),t=de(i,0,!0);return Z.set(o,{pcs:r,gcs:t}),n?t:r}function de(e,n=0,o=!1){const i=ve.generate(e),r=o?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!i||!r?.length)return null;let t=!1,s=r.find(f=>f.getInclusive()===1&&f.getKind()===1);if(!s){if(s=r.find(f=>f.getInclusive()===1&&f.getKind()===0),!s)return null;t=!0}const c=o?0:(i.getNorthPoleLocation()===2?1:0)|(i.getSouthPoleLocation()===2?2:0),l=i.isPannableRectangle(),a=s.getCoord();if(t)return{isEnvelope:t,isPannable:l,vertices:a,coef:null,bbox:[a[0][0]-n,a[0][1]-n,a[1][0]+n,a[1][1]+n],poleLocation:c};let u=0;const d=[];let[h,m]=a[0],[x,p]=a[0];for(let f=0,M=a.length;f<M;f++){u++,u===M&&(u=0);const[g,y]=a[f],[w,R]=a[u];if(R===y)d.push([g,w,y,R,2]);else{const S=(w-g)/(R-y||1e-4),P=g-S*y;y<R?d.push([S,P,y,R,0]):d.push([S,P,R,y,1])}h=h<g?h:g,m=m<y?m:y,x=x>g?x:g,p=p>y?p:y}return{isEnvelope:!1,isPannable:l,vertices:a,coef:d,bbox:[h,m,x,p],poleLocation:c}}function se(e,n){const o=[],{cols:i,rows:r,xres:t,yres:s,usePixelCenter:c}=e;let{xmin:l,ymax:a}=e;if(c&&(l+=t/2,a-=s/2),n==null){for(let m=0;m<i;m++)for(let x=0;x<r;x++)o.push([l+t*m,a-s*x]);return{points:o}}const u=new Uint8Array(i*r);if(n.isEnvelope){const{bbox:[m,x,p,f]}=n;for(let M=0,g=0;M<i;M++){const y=l+t*M,w=n.isPannable||y>=m&&y<=p;for(let R=0;R<r;R++,g++){const S=a-s*R;w&&S>=x&&S<=f&&(o.push([y,S]),u[g]=1)}}return{points:o,mask:u}}const d=n.coef,h=[];for(let m=0;m<r;m++){const x=a-s*m,p=[],f=[];for(let g=0;g<d.length;g++){const[y,w,R,S,P]=d[g];if(x===R&&R===S)p.push(y),p.push(w),f.push(2),f.push(2);else if(x>=R&&x<=S){const b=y*x+w;p.push(b),f.push(P)}}let M=p;if(p.length>2){let g=f[0]===2?0:f[0],y=p[0];M=[];for(let w=1;w<f.length;w++)f[w]===2&&w!==f.length-1||(f[w]!==g&&(M.push(g===0?Math.min(y,p[w-1]):Math.max(y,p[w-1])),g=f[w],y=p[w]),w===f.length-1&&M.push(f[w]===0?Math.min(y,p[w]):Math.max(y,p[w])));M.sort((w,R)=>w-R)}else p[0]>p[1]&&(M=[p[1],p[0]]);h.push(M)}for(let m=0,x=0;m<i;m++){const p=l+t*m;for(let f=0;f<r;f++,x++){const M=a-s*f,g=h[f];if(g.length===2)p>=g[0]&&p<=g[1]&&(o.push([p,M]),u[x]=1);else if(g.length>2){let y=!1;for(let w=0;w<g.length;w+=2)if(p>=g[w]&&p<=g[w+1]){y=!0;break}y&&(o.push([p,M]),u[x]=1)}}}return{points:o,mask:u}}function Ye(e,n){const[o,i]=n;for(let r=0;r<e.length;r++){const t=e[r][1];(t<o||t>i)&&(e[r]=[NaN,NaN])}}function we(e,n){const o=E(e[0].spatialReference);if(e.length<2||o==null||(n=n??N(e[0].spatialReference),(e=e.filter(c=>c.width>n)).length===1))return e[0];let{xmin:i,xmax:r,ymin:t,ymax:s}=e[0];for(let c=1;c<e.length;c++){const l=e[c];r=l.xmax+o*c,t=Math.min(t,l.ymin),s=Math.max(s,l.ymax)}return new A({xmin:i,xmax:r,ymin:t,ymax:s,spatialReference:e[0].spatialReference})}function re(e,n,o=null,i=!0){const r=e.spatialReference;if(r.equals(n)||!n)return e;const t=X(e),s=E(r,!0),c=E(n);if(t===0||s==null||c==null){const u=ae(e,n,o,i);if(u&&s==null&&c!=null&&Math.abs(u.width-c)<N(n)&&k.isLoaded()){const d=O(r);if(d!=null&&d.poleLocation===V.None&&e.width<(d.bbox[2]-d.bbox[0])/2)return Ke(e,n)||u}return u}const l=e.clone().normalize();if(l.length===1&&e.xmax<s&&e.xmax-s/2>N(r)){const{xmin:u,xmax:d}=e;for(let h=0;h<=t;h++){const m=h===0?u:-s/2,x=h===t?d-s*h:s/2;l[h]=new A({xmin:m,xmax:x,ymin:e.ymin,ymax:e.ymax,spatialReference:r})}}const a=l.map(u=>ae(u,n,o,i)).filter(Ee);return a.length===0?null:we(a)}function Je(e,n,o){if(e.type==="extent"){const{xmin:i,ymin:r,xmax:t,ymax:s,spatialReference:c}=e;e=new U({rings:[[[i,s],[t,s],[t,r],[i,r],[i,s]]],spatialReference:c})}return e.spatialReference.equals(n)?e:(z(),k.execute(e,n,{geographicTransformation:o}))}function Ke(e,n){const o=E(n);if(o==null)return null;let{xmin:i,ymin:r,xmax:t,ymax:s}=e;const c=e.spatialReference,l=new U({spatialReference:c,rings:[[[i,r],[t,r],[t,s],[i,s],[i,r]]]}),a=k.execute(l,n);if(a.rings.length!==2||!a.rings[0].length||!a.rings[1].length)return null;const{rings:u}=a,d=N(c),h=new A({spatialReference:n});for(let m=0;m<2;m++){i=t=u[m][0][0],r=s=u[m][0][1];for(let x=0;x<u[m].length;x++)i=i>u[m][x][0]?u[m][x][0]:i,t=t<u[m][x][0]?u[m][x][0]:t,r=r>u[m][x][1]?u[m][x][1]:r,s=s<u[m][x][1]?u[m][x][1]:s;if(m===0)h.ymin=r,h.ymax=s,h.xmin=i,h.xmax=t;else if(h.ymin=Math.min(h.ymin,r),h.ymax=Math.max(h.ymax,s),Math.abs(t-o/2)<d)h.xmin=i,h.xmax=h.xmax+o;else{if(!(Math.abs(i+o/2)<d))return null;h.xmax=t+o}}return h}function ae(e,n,o,i=!0,r=!0){const t=e.spatialReference;if(t.equals(n)||!n)return e;z();const s=k.execute(e,n,{geographicTransformation:o});if(r&&n.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!i||!s)return s;const c=$(t,!0),l=$(n,!0);if(c==null||l==null)return s;const a=N(t,.001),u=N(t,Y),d=N(n,.001);if(Math.abs(s.xmin-l[0])<d&&Math.abs(s.xmax-l[1])<d){const h=Math.abs(e.xmin-c[0]),m=Math.abs(c[1]-e.xmax);if(h<a&&m>u){s.xmin=l[0];const x=[];x.push(new T(e.xmax,e.ymin,t)),x.push(new T(e.xmax,(e.ymin+e.ymax)/2,t)),x.push(new T(e.xmax,e.ymax,t));const p=x.map(f=>ie(f,n,o)).filter(f=>!isNaN(f?.x)).map(f=>f.x);s.xmax=Math.max.apply(null,p)}if(m<a&&h>u){s.xmax=l[1];const x=[];x.push(new T(e.xmin,e.ymin,t)),x.push(new T(e.xmin,(e.ymin+e.ymax)/2,t)),x.push(new T(e.xmin,e.ymax,t));const p=x.map(f=>ie(f,n,o)).filter(f=>!isNaN(f?.x)).map(f=>f.x);s.xmin=Math.min.apply(null,p)}}else{const h=N(n,.001);Math.abs(s.xmin-l[0])<h&&(s.xmin=l[0]),Math.abs(s.xmax-l[1])<h&&(s.xmax=l[1])}return s}function E(e,n=!1){if(!e)return null;const o=n?20037508342787e-6:20037508342788905e-9;return e.isWebMercator?2*o:e.wkid&&e.isGeographic?360:2*Le[e.wkid]||null}function $(e,n=!1){if(e.isGeographic)return[-180,180];const o=E(e,n);return o!=null?[-o/2,o/2]:null}function Me(e,n,o,i){let r=(e-n)/o;return r-Math.floor(r)!==0?r=Math.floor(r):i&&(r-=1),r}function X(e,n=!1){const o=E(e.spatialReference);if(o==null)return 0;const i=n?0:-(o/2),r=N(e.spatialReference),t=!n&&Math.abs(e.xmax-o/2)<r?o/2:e.xmax,s=!n&&Math.abs(e.xmin+o/2)<r?-o/2:e.xmin;return Me(t,i,o,!0)-Me(s,i,o,!1)}function $e(e){const n=e.storageInfo.origin.x,o=E(e.spatialReference,!0);if(o==null)return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const i=o/2,{nativePixelSize:r,storageInfo:t,extent:s}=e,{maximumPyramidLevel:c,blockWidth:l,pyramidScalingFactor:a}=t;let u=r.x;const d=[],h=e.transform!=null&&e.transform.type==="gcs-shift",m=n+(h?0:i),x=h?o-n:i-n;for(let p=0;p<=c;p++){const f=(s.xmax-n)/u/l,M=f-Math.floor(f)===0?f:Math.ceil(f),g=x/u/l,y=g-Math.floor(g)===0?g:Math.ceil(g),w=Math.floor(m/u/l),R=Math.round(m/u)%l,S=(l-Math.round(x/u)%l)%l;d.push({resolutionX:u,blockWidth:l,datasetColumnCount:M,worldColumnCountFromOrigin:y,leftMargin:R,rightPadding:S,originColumnOffset:w}),u*=a}return{originX:n,halfWorldWidth:i,pyramidsInfo:d,hasGCSSShiftTransform:h}}function Xe(e){if(!e||e.isGeographic)return e;const n=String(e.wkid||e.wkt2||e.wkt);let o;return ee.has(n)?o=ee.get(n):(o=(e.wkid?v.coordsys(e.wkid):v.fromString(C.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),ee.set(n,o)),new he({wkid:o})}function De(e){const n=e.isAdaptive&&e.spacing==null;let o=e.spacing||[F,F],i=le(e),r={cols:i.size[0]+1,rows:i.size[1]+1};const t=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2;let s=i.outofBoundPointCount===i.offsets.length/2||n&&t?[0,0]:pe(i.offsets,r,o,H);const c=(s[0]+s[1])/2,l=e.projectedExtent.spatialReference,a=e.srcBufferExtent.spatialReference;if(n&&(t||c>H)&&(l.isGeographic||O(l),o=[q,q],i=le({...e,spacing:o}),r={cols:i.size[0]+1,rows:i.size[1]+1},s=pe(i.offsets,r,o,H)),i.error=s,o[0]>1&&(i.coefficients=Re(i.offsets,r,t)),e.includeGCSGrid&&!l.isGeographic&&!l.isWebMercator)if(a.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:o};else{const u=O(l);if(u!=null&&!u.isEnvelope){const d=Xe(l),h=re(e.projectedExtent,d),{offsets:m}=le({...e,srcBufferExtent:h,spacing:o}),x=Re(m,r,t);i.gcsGrid={offsets:m,coefficients:x,spacing:o}}}return i}function le(e){const{projectedExtent:n,srcBufferExtent:o,pixelSize:i,datumTransformation:r,rasterTransform:t}=e,s=n.spatialReference,c=o.spatialReference;z();const{xmin:l,ymin:a,xmax:u,ymax:d}=n,h=E(c),m=h!=null&&(e.hasWrapAround||t?.type==="gcs-shift"),x=e.spacing||[F,F],p=x[0]*i.x,f=x[1]*i.y,M=x[0]===1,g=Math.ceil((u-l)/p-.1/x[0])+(M?0:1),y=Math.ceil((d-a)/f-.1/x[1])+(M?0:1),w=Ae({cols:g,rows:y,xmin:l,ymax:d,xres:p,yres:f,inSR:s,outSR:c,datumTransformation:r,preferPE:x[0]<=q,usePixelCenter:M}),R=[];let S,P=0;const b=M?-1:NaN,{xmin:_,xmax:W,ymax:D,width:be,height:Se}=o,Pe=N(c,Y),Ge=h!=null&&_>0&&W>h/2,fe=O(s),Ne=fe!=null&&fe.poleLocation>0;for(let I=0;I<g;I++){const Q=[];for(let j=0;j<y;j++){let G=w[I*y+j];if(m&&G[0]>W&&G[0]>h/2-Pe?G[0]-=h:m&&I===0&&G[0]<0&&Ge&&!t&&(G[0]+=h),!G||isNaN(G[0])||isNaN(G[1]))R.push(b),R.push(b),Q.push(null),P++;else{if(t){const ue=t.inverseTransform(new T({x:G[0],y:G[1],spatialReference:c}));G=[ue.x,ue.y]}Q.push(G),I>0&&m&&S[j]&&G[0]<S[j][0]&&(G[0]+=h,Ne&&G[0]>W&&G[0]>h&&(G[0]-=h)),R.push((G[0]-_)/be),R.push((D-G[1])/Se)}}S=Q}return{offsets:R,error:null,coefficients:null,outofBoundPointCount:P,spacing:x,size:M?[g,y]:[g-1,y-1]}}function Re(e,n,o){const{cols:i,rows:r}=n,t=new Float32Array((i-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),c=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<i-1;l++){for(let a=0;a<r-1;a++){let u=l*r*2+2*a;const d=e[u],h=e[u+1],m=e[u+2],x=e[u+3];u+=2*r;const p=e[u],f=e[u+1],M=e[u+2],g=e[u+3];let y=0,w=12*(a*(i-1)+l);for(let R=0;R<3;R++)t[w++]=s[y++]*d+s[y++]*m+s[y++]*M;y=0;for(let R=0;R<3;R++)t[w++]=s[y++]*h+s[y++]*x+s[y++]*g;y=0;for(let R=0;R<3;R++)t[w++]=c[y++]*d+c[y++]*p+c[y++]*M;y=0;for(let R=0;R<3;R++)t[w++]=c[y++]*h+c[y++]*f+c[y++]*g}if(o)for(let a=0;a<t.length;a++)isNaN(t[a])&&(t[a]=-1)}return t}function Qe(e,n){const o=e.clone().normalize();return o.length===1?o[0]:we(o,n)}function Ue(e){const{spatialReference:n}=e,o=Te(n);if(!o)return e;const[i,r]=o.valid,t=r-i;let s=0;if(e.xmin<i){const c=i-e.xmin;s=Math.ceil(c/t)}else if(e.xmin>r){const c=e.xmin-r;s=-Math.ceil(c/t)}return new A({spatialReference:e.spatialReference,xmin:e.xmin+s*t,ymin:e.ymin,xmax:e.xmax+s*t,ymax:e.ymax})}function Ve(e,n,o){const{storageInfo:i,pixelSize:r}=n;let t=0,s=!1;const{pyramidResolutions:c}=i,l=i.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,i.tileInfo.dpi/96)):1,a=(e.x+e.y)/2/l;if(c!=null&&c.length){const x=c[c.length-1],p=(x.x+x.y)/2,f=(r.x+r.y)/2;if(a<=f)t=0;else if(a>=p)t=c.length,s=a/p>8;else{let g,y=f;for(let w=1;w<=c.length;w++){if(g=(c[w-1].x+c[w-1].y)/2,a<=g){a===g?t=w:o==="down"?(t=w-1,s=a/y>8):t=o==="up"||a-y>g-a||a/y>2?w:w-1;break}y=g}}const M=t===0?r:c[t-1];return s&&Math.min(M.x,M.y)*L(n.spatialReference)>19567&&(s=!1),{pyramidLevel:t,pyramidResolution:new T({x:M.x,y:M.y,spatialReference:n.spatialReference}),excessiveReading:s}}const u=Math.log(e.x/r.x)/Math.LN2,d=Math.log(e.y/r.y)/Math.LN2,h=n.storageInfo.maximumPyramidLevel||0;t=o==="down"?Math.floor(Math.min(u,d)):o==="up"?Math.ceil(Math.max(u,d)):Math.round((u+d)/2),t<0?t=0:t>h&&(s=t>h+3,t=h);const m=2**t;return{pyramidLevel:t,pyramidResolution:new T({x:m*n.nativePixelSize.x,y:m*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:s}}function ce(e,n,o=!1){const{pixelSize:i,extent:r}=e,t=ge(r,n,!1),s=re(Qe(r,(i.x+i.y)/16),n,t);return!s||o||X(s)===0?s:ae(r,n,t)}function He(e,n,o){const i=o?.tileSize,r=o?.alignGlobalDatasetWithAGOL,{extent:t,spatialReference:s,pixelSize:c}=e,l=te(c,n,t);if(l==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const a=(l.x+l.y)/2,u=oe(a,n),d=n.isGeographic?256/i*2958287637958547e-7:256/i*591657527591555e-6;let h=e.dataType==="vector-magdir"||e.dataType==="vector-uv";const m=ce(e,n,!0),x=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/u)/Math.LN2));if(!h&&m&&r&&(n.isGeographic||n.isWebMercator)){const P=E(n);if(h=X(m)>0||P!=null&&m.width>P/4,!h&&P!=null){let b=-1;if(x<3)b=2**x*a*i;else if(e.storageInfo){const{maximumPyramidLevel:W=0,pyramidScalingFactor:D=2}=e.storageInfo;b=D**W*a*i}const _=Math.ceil(P/b);h=_===1||_===2&&P/2-m.xmax<b}}let p,f=u;const M=1.001,g=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(h){f=d;const P=n.isGeographic?1341104507446289e-21:.29858214164761665,b=oe(P,n),_=n.isGeographic?4326:3857;p=te({x:P,y:P},s,ce(e,new he({wkid:_}),!0)),p.x*=f/b,p.y*=f/b}else{p={x:c.x,y:c.y};let P=0;for(;f<d*(M/2)&&P<x;)P++,f*=g,p.x*=g,p.y*=g;Math.max(f,d)/Math.min(f,d)<=M&&(f=d)}const y=[f],w=[{x:p.x,y:p.y}],R=70.5310735,S=Math.min(R,u)/M;for(;f>=S;)f/=g,p.x/=g,p.y/=g,y.push(f),w.push({x:p.x,y:p.y});return{projectedPixelSize:l,scales:y,srcResolutions:w,isCustomTilingScheme:!h}}function Ze(e){let n=0;for(const o of e){const i=o.length;let r=o[0][0]*(o[1][1]-o[i-2][1]);for(let t=1;t<i-1;t++)r+=o[t][0]*(o[t+1][1]-o[t-1][1]);n+=r/2}return Math.abs(n)}export{ie as A,ge as C,je as O,re as Q,Je as V,Ie as _,E as e,Ue as f,$e as i,ce as m,X as o,De as s,Ve as u,We as v,He as x};
