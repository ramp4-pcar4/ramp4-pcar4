{"version":3,"file":"StreamLayerView2D-CmjvwU1I.js","sources":["../../node_modules/@arcgis/core/views/layers/StreamLayerView.js","../../node_modules/@arcgis/core/views/2d/layers/StreamLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as s}from\"../../chunks/tslib.es6.js\";import{property as e}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../layers/support/FeatureFilter.js\";const r=r=>{let i=class extends r{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}disconnect(){this._doDisconnect()}connect(){this._doConnect()}clear(){this._doClear()}constructor(...s){super(...s),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return(this._isUserPaused||this.suspended)&&\"connected\"===this._streamConnectionStatus?\"paused\":this._streamConnectionStatus}_onSuspendedChange(s){s?this._doPause():this._isUserPaused||this._doResume()}};return s([e()],i.prototype,\"_isUserPaused\",void 0),s([e({readOnly:!0})],i.prototype,\"connectionStatus\",null),s([e({type:o})],i.prototype,\"filter\",void 0),i=s([t(\"esri.views.layers.StreamLayerView\")],i),i};export{r as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import r from\"../../../core/Error.js\";import{handlesGroup as t,makeHandle as s}from\"../../../core/handleUtils.js\";import{watch as n}from\"../../../core/reactiveUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/RandomLCG.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../../../rest/support/FeatureSet.js\";import{isNumber as c}from\"../../../support/guards.js\";import l from\"./FeatureLayerView2D.js\";import{handleNoEngineError as h}from\"./support/handleNoEngineError.js\";import u from\"../../layers/StreamLayerView.js\";let p=class extends(u(l)){constructor(){super(...arguments),this.pipelineConnectionStatus=\"disconnected\",this.pipelineErrorString=null}initialize(){this.addHandles([n((()=>this.layer.customParameters),(async e=>{(await this.getWorker()).streamMessenger.updateCustomParameters(e)})),this.layer.on(\"send-message-to-socket\",(async e=>{(await this.getWorker()).streamMessenger.sendMessageToSocket(e)})),this.layer.on(\"send-message-to-client\",(async e=>{(await this.getWorker()).streamMessenger.sendMessageToClient(e),this._isUserPaused&&\"type\"in e&&\"clear\"===e.type&&this.incrementSourceRefreshVersion()})),n((()=>this.layer.purgeOptions),(()=>this._update())),n((()=>this.suspended),this._onSuspendedChange.bind(this))],\"constructor\"),this._doResume()}destroy(){this._doPause()}get connectionError(){return this.pipelineErrorString?new r(\"stream-controller\",this.pipelineErrorString):null}on(e,r){if(Array.isArray(e))return t(e.map((e=>this.on(e,r))));const n=[\"data-received\",\"message-received\"].includes(e);n&&this.getWorker().then((r=>r.streamMessenger.enableEvent(e,!0)));const o=super.on(e,r),i=this;return s((()=>{o.remove(),n&&(i._workerProxy.closed||i.hasEventListener(e)||i.getWorker().then((r=>r.streamMessenger.enableEvent(e,!1))))}))}async queryLatestObservations(e,t){if(!(this.layer.timeInfo?.endField||this.layer.timeInfo?.startField||this.layer.timeInfo?.trackIdField))throw new r(\"streamlayer-no-timeField\",\"queryLatestObservation can only be used with services that define a TrackIdField\");const s=await this.getWorker();return h(s.features.executeQueryForLatestObservations(this._cleanUpQuery(e),t).then((e=>{const r=a.fromJSON(e);return r.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),r})),new a({features:[]}))}detach(){super.detach(),this.pipelineConnectionStatus=\"disconnected\"}async queryObjectIds(e,r){return(await super.queryObjectIds(e,r)).filter(c)}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){null!=this._refreshInterval&&(clearInterval(this._refreshInterval),this._refreshInterval=null)}_doResume(){null==this._refreshInterval&&(this._refreshInterval=setInterval((()=>this.incrementSourceRefreshVersion()),this.layer.updateInterval))}_doDisconnect(){this.getWorker().then((e=>e.streamMessenger.disconnect())),this._doPause()}_doConnect(){this.getWorker().then((e=>e.streamMessenger.connect())),this.resume()}_doClear(){this.getWorker().then((e=>e.streamMessenger.clear())),null==this._refreshInterval&&this.incrementSourceRefreshVersion()}_createClientOptions(){const e=super._createClientOptions(),r=this;return{...e,get container(){return r.featureContainer},setProperty:e=>{this.set(e.propertyName,e.value)}}}};e([o()],p.prototype,\"pipelineConnectionStatus\",void 0),e([o()],p.prototype,\"pipelineErrorString\",void 0),e([o({readOnly:!0})],p.prototype,\"connectionError\",null),e([o({readOnly:!0})],p.prototype,\"_streamConnectionStatus\",null),p=e([i(\"esri.views.2d.layers.StreamLayerView2D\")],p);const d=p;export{d as default};\n"],"names":["r","i","s","e","o","t","p","u","l","n","h","a","c","d"],"mappings":"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","x_google_ignoreList":[0,1]}