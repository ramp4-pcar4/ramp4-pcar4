{"version":3,"file":"meshFeatureSet-CqseLOVN.js","sources":["../../node_modules/@arcgis/core/rest/support/meshFeatureSet.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../Graphic.js\";import t from\"../../core/Logger.js\";import{getOrCreateMapValue as r}from\"../../core/MapUtils.js\";import s from\"../../geometry/Extent.js\";import o from\"../../geometry/Mesh.js\";import n from\"../../geometry/SpatialReference.js\";import{ServiceAssetPart as a,ServiceAsset as u}from\"../../geometry/support/meshUtils/External.js\";import{getFormatIdMimeType as i}from\"../../layers/support/infoFor3D.js\";import f from\"./FeatureSet.js\";import{extractMeshFeatureOrigin as c,extractMeshFeatureTransform as m}from\"./meshFeatureAttributes.js\";const p=()=>t.getLogger(\"esri.rest.support.meshFeatureSet\");function l(t,r,s){const o=s.features;s.features=[],delete s.geometryType;const a=f.fromJSON(s);if(a.geometryType=\"mesh\",!s.assetMaps)return a;const u=g(r,s.assetMaps),i=t.sourceSpatialReference??n.WGS84,c=s.globalIdFieldName,{outFields:m}=t,p=null!=m&&m.length>0?y(m.includes(\"*\")?null:new Set(m)):()=>({});for(const n of o){const t=E(n,c,i,r,u);a.features.push(new e({geometry:t,attributes:p(n)}))}return a}function y(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(const r in t)e.has(r)||delete t[r];return t}}function E(e,t,r,n,a){const u=e.attributes[t],i=a.get(u);if(null==i||!e.geometry)return null;const f=c(e.attributes,r,n.transformFieldRoles),p=s.fromJSON(e.geometry);p.spatialReference=r;const l=m(e.attributes,n.transformFieldRoles),y=r.isGeographic?\"local\":\"georeferenced\",E=d(i);return E?o.createWithExternalSource(f,E,{extent:p,transform:l,vertexSpace:y,unitConversionDisabled:!0}):o.createIncomplete(f,{extent:p,transform:l,vertexSpace:y})}var h;function g(e,t){const s=new Map;for(const o of t){const t=o.parentGlobalId;if(null==t)continue;const n=o.assetName,a=o.assetType,u=o.assetHash,f=o.assetURL,c=o.conversionStatus,m=o.seqNo,l=i(a,e.supportedFormats);if(!l){p().error(\"mesh-feature-set:unknown-format\",`Service returned an asset of type ${a}, but it does not list it as a supported type`);continue}const y=r(s,t,(()=>({files:new Map})));r(y.files,n,(()=>({name:n,type:a,mimeType:l,status:S(c),parts:[]}))).parts[m]={hash:u,url:f}}return s}function d(e){const t=Array.from(e.files.values()),r=new Array;for(const s of t){if(s.status!==h.COMPLETED)return null;const e=new Array;for(const t of s.parts){if(!t)return null;e.push(new a(t.url,t.hash))}r.push(new u(s.name,s.mimeType,e))}return{type:\"service\",assets:r}}function S(e){switch(e){case\"COMPLETED\":case\"SUBMITTED\":return h.COMPLETED;case\"INPROGRESS\":return h.PENDING;default:return h.FAILED}}!function(e){e[e.FAILED=0]=\"FAILED\",e[e.PENDING=1]=\"PENDING\",e[e.COMPLETED=2]=\"COMPLETED\"}(h||(h={}));export{g as assetMapFromAssetMapsJSON,E as extractMesh,l as meshFeatureSetFromJSON};\n"],"names":["p","t","l","r","s","o","a","f","u","g","i","n","m","y","E","e","c","d","h","S"],"mappings":"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","x_google_ignoreList":[0]}