{"version":3,"file":"kmlUtils-in2U-qbi.js","sources":["../../node_modules/@arcgis/core/layers/support/kmlUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../config.js\";import{id as o}from\"../../kernel.js\";import t from\"../../PopupTemplate.js\";import r from\"../../request.js\";import{clone as s}from\"../../core/lang.js\";import{addQueryParameters as n}from\"../../core/urlUtils.js\";import i from\"../../geometry/SpatialReference.js\";import{create as f,negativeInfinity as a,expandWithAABB as l,equals as u}from\"../../geometry/support/aaBoundingBox.js\";import{getBoundsXYZ as m}from\"../../geometry/support/boundsUtils.js\";import{fromJSON as p}from\"../../renderers/support/jsonUtils.js\";import y from\"../../rest/support/FeatureSet.js\";const c={esriGeometryPoint:\"points\",esriGeometryPolyline:\"polylines\",esriGeometryPolygon:\"polygons\"};function d(e){const o=e.folders||[],t=o.slice(),r=new Map,n=new Map,i=new Map,f=new Map,a=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:i,esriGeometryPolygon:f};(e.featureCollection?.layers||[]).forEach((e=>{const o=s(e);o.featureSet.features=[];const t=e.featureSet.geometryType;r.set(t,o);const a=e.layerDefinition.objectIdField;\"esriGeometryPoint\"===t?h(n,a,e.featureSet.features):\"esriGeometryPolyline\"===t?h(i,a,e.featureSet.features):\"esriGeometryPolygon\"===t&&h(f,a,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{a.set(e.id,e)})),o.forEach((o=>{o.networkLinkIds.forEach((r=>{const s=P(r,o.id,e.networkLinks);s&&t.push(s)}))})),t.forEach((e=>{if(e.featureInfos){e.points=s(r.get(\"esriGeometryPoint\")),e.polylines=s(r.get(\"esriGeometryPolyline\")),e.polygons=s(r.get(\"esriGeometryPolygon\")),e.mapImages=[];for(const o of e.featureInfos)switch(o.type){case\"esriGeometryPoint\":case\"esriGeometryPolyline\":case\"esriGeometryPolygon\":{const t=l[o.type].get(o.id);t&&e[c[o.type]]?.featureSet.features.push(t);break}case\"GroundOverlay\":{const t=a.get(o.id);t&&e.mapImages.push(t);break}}e.fullExtent=j([e])}}));const u=j(t);return{folders:o,sublayers:t,extent:u}}function g(t,s,i,f){const a=o?.findCredential(t);t=n(t,{token:a?.token});const l=e.kmlServiceUrl;return r(l,{query:{url:t,model:\"simple\",folders:\"\",refresh:0!==i||void 0,outSR:JSON.stringify(s)},responseType:\"json\",signal:f})}function S(e,o,t=null,r=[]){const s=[],n={},i=o.sublayers,f=new Set(o.folders.map((e=>e.id)));return i.forEach((o=>{const i=new e;if(t?i.read(o,t):i.read(o),r.length&&f.has(i.id)&&(i.visible=r.includes(i.id)),n[o.id]=i,null!=o.parentFolderId&&-1!==o.parentFolderId){const e=n[o.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers?.unshift(i)}else s.unshift(i)})),s}function h(e,o,t){t.forEach((t=>{e.set(t.attributes[o],t)}))}function G(e,o){let t;return o.some((o=>o.id===e&&(t=o,!0))),t}function P(e,o,t){const r=G(e,t);return r&&(r.parentFolderId=o,r.networkLink=r),r}async function b(e){const o=y.fromJSON(e.featureSet).features,r=e.layerDefinition,s=p(r.drawingInfo.renderer),n=t.fromJSON(e.popupInfo),i=[];for(const t of o){const e=await s.getSymbolAsync(t);t.symbol=e,t.popupTemplate=n,t.visible=!0,i.push(t)}return i}function j(e){const o=f(a),t=f(a);for(const r of e){if(r.polygons?.featureSet?.features)for(const e of r.polygons.featureSet.features)m(o,e.geometry),l(t,o);if(r.polylines?.featureSet?.features)for(const e of r.polylines.featureSet.features)m(o,e.geometry),l(t,o);if(r.points?.featureSet?.features)for(const e of r.points.featureSet.features)m(o,e.geometry),l(t,o);if(r.mapImages)for(const e of r.mapImages)m(o,e.extent),l(t,o)}return u(t,a)?void 0:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:i.WGS84}}export{j as computeExtent,g as fetchService,b as getGraphics,d as parseKML,S as sublayersFromJSON};\n"],"names":["c","d","e","r","a","o","s","t","P","j","g","i","f","n","l","S","G","b","y","p","m","u"],"mappings":"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","x_google_ignoreList":[0]}