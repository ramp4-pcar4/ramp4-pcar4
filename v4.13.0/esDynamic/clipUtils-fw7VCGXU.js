import{b$ as D,bL as L,c2 as j}from"./main-BFDurRCu.js";import{c as A}from"./dataUtils-CfR0oe2x.js";function B(t,x){if(t.spatialReference.equals(x))return t;const e=L(t.spatialReference),n=L(x);if(e===n)return t;const i=e/n;return{x:t.x*i,y:t.y*i}}async function F(t,x,e){if(e.type==="extent")return N(t,x,e);const{width:n,height:i}=t,a=new Uint8Array(n*i);return(await import("./intersectsOperator-ZBnSpPTv.js").then(r=>r.i)).execute(x,e)?e.type==="polyline"?Z(t,x,e):(await import("./containsOperator-CnkxASyq.js").then(r=>r.c)).execute(e,x)?t:G(t,x,e):new A({pixelType:t.pixelType,width:n,height:i,mask:a,maskIsAlpha:!1,pixels:[...t.pixels]})}function G(t,x,e){if(!t)return t;const{width:n,height:i}=t,a=O({geometry:e,size:[n,i],srcExtent:x,srcMask:t.mask});return new A({pixelType:t.pixelType,width:n,height:i,mask:a,maskIsAlpha:!1,pixels:[...t.pixels]})}function O(t){const{geometry:x,size:e,srcExtent:n,srcMask:i}=t,[a,r]=e;let o;const l=n.width/a,u=n.height/r,{xmin:s,ymax:h}=n;if(x.type==="extent"){const y=(x.xmin-s)/l,p=(x.xmax-s)/l,c=(h-x.ymax)/u,f=(h-x.ymin)/u;o=[[[y,c],[y,f],[p,f],[p,c],[y,c]]]}else o=x.rings.map(y=>y.map(([p,c])=>[(p-s)/l,(h-c)/u]));return K(o,e,i)}function K(t,x,e){const[n,i]=x,a=new OffscreenCanvas(n,i).getContext("2d");a.fillStyle="#f00",a.beginPath(),t.forEach(s=>{a.moveTo(s[0][0],s[0][1]);for(let h=0;h<s.length;h++)a.lineTo(s[h][0],s[h][1]);a.closePath()}),a.fill();const r=a.getImageData(0,0,n,i).data,o=n*i,l=new Uint8Array(o);let u=!1;for(let s=0;s<o;s++)e&&!e[s]||(r[4*s+3]>127?l[s]=255:u=!0);return u||e?l:void 0}function N(t,x,e){const{width:n,height:i}=t,a=new Uint8Array(n*i),r=x.width/n,o=x.height/i;if(e.width/r<.5||e.height/o<.5)return new A({pixelType:t.pixelType,width:n,height:i,mask:a,pixels:[...t.pixels]});const{xmin:l,xmax:u,ymin:s,ymax:h}=x,{xmin:y,xmax:p,ymin:c,ymax:f}=e,m=Math.max(l,y),z=Math.min(u,p),g=Math.max(s,c),M=Math.min(h,f),w=.5*r,S=.5*o;if(z-m<w||M-g<S||z<l+w||m>u-w||g>h-S||M<s+S)return new A({pixelType:t.pixelType,width:n,height:i,mask:a,pixels:[...t.pixels]});const d=Math.max(0,(m-l)/r),v=Math.min(n,Math.max(0,(z-l)/r)),E=Math.max(0,(h-M)/o),R=Math.min(i,Math.max(0,(h-g)/o)),T=Math.round(d),U=Math.round(v)-1,k=Math.round(E),b=Math.round(R)-1;if(T===U&&d%1>.5&&v%1<.5||k===b&&E%1>.5&&R%1<.5)return new A({pixelType:t.pixelType,width:n,height:i,mask:a,pixels:[...t.pixels]});if(T===0&&k===0&&U===n&&b===i)return t;const P=t.mask;for(let I=k;I<=b;I++)for(let C=T;C<=U;C++){const q=I*n+C;a[q]=P?P[q]:255}return new A({pixelType:t.pixelType,width:n,height:i,mask:a,pixels:[...t.pixels]})}function Z(t,x,e){const{width:n,height:i}=t,a=new Uint8Array(n*i),r=x.width/n,o=x.height/i,{xmin:l,ymax:u}=x,{paths:s}=e,h=t.mask;for(let y=0;y<s.length;y++){const p=s[y];for(let c=0;c<p.length-1;c++){const[f,m]=p[c],[z,g]=p[c+1];let M=Math.floor((u-m)/o),w=Math.floor((u-g)/o);if(w<M){const d=M;M=w,w=d}M=Math.max(0,M),w=Math.min(i-1,w);const S=(z-f)/(g-m);for(let d=M;d<=w;d++){const v=d===M?Math.max(m,g):(i+1-d)*o,E=d===w?Math.min(m,g):v-o;let R=Math.floor(g===m?(f-l)/r:(S*(v-m)+f-l)/r),T=Math.floor(g===m?(z-l)/r:(S*(E-m)+f-l)/r);if(T<R){const k=R;R=T,T=k}const U=d*n;R=Math.max(0,R),T=Math.min(n-1,T);for(let k=U+R;k<=U+T;k++)a[k]=h?h[k]:255}}}return new A({pixelType:t.pixelType,width:n,height:i,mask:a,pixels:[...t.pixels]})}function _(t,x){const{extent:e}=$(t,x,new j({x:t.pixelSize.x,y:t.pixelSize.y,spatialReference:t.spatialReference})),{extent:n}=t.extent;if(e.xmax=Math.min(e.xmax,n.xmax),e.ymax=Math.min(e.ymax,n.ymax),e.xmin<e.xmax&&e.ymin<e.ymax){const{x:i,y:a}=t.pixelSize,r=Math.round(e.width/i),o=Math.round(e.height/a);t.extent=e,t.width=r,t.height=o}}function $(t,x,e,n=!0){const{spatialReference:i}=t,{x:a,y:r}=B(e,i);let o,l,u;const s=x.type==="extent"?x:x.extent;let{xmin:h,xmax:y,ymax:p,ymin:c}=s;const{xmin:f,ymax:m}=t.extent;return n?(h=f+(h>f?a*Math.round((h-f)/a):0),p=m-(p<m?r*Math.round((m-p)/r):0),y=f+(y>f?a*Math.round((y-f)/a):0),c=m-(c<m?r*Math.round((m-c)/r):0),o=new D({xmin:h,ymax:p,xmax:y,ymin:c,spatialReference:i}),l=Math.round(o.width/a),u=Math.round(o.height/r)):(l=Math.floor((y-h)/a+.8),u=Math.floor((p-c)/r+.8),h=f+(h>f?a*Math.floor((h-f)/a+.1):0),p=m-(p<m?r*Math.floor((m-p)/r+.1):0),y=h+l*a,c=p-u*r,o=new D({xmin:h,ymax:p,xmax:y,ymin:c,spatialReference:i})),{extent:o,width:l,height:u}}export{_ as l,$ as p,F as r,O as x};
