{"version":3,"file":"TextureCompressionWorker-5r4wB1I7.js","sources":["../../node_modules/@arcgis/core/libs/basisu/BasisUEncoder.js","../../node_modules/@arcgis/core/libs/dxtEncoder/DXTEncoder.js","../../node_modules/@arcgis/core/views/support/TextureCompressionWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as s}from\"../../assets.js\";function i(){return t??=(async()=>{const i=await import(\"../../chunks/basis_encoder.js\"),t=await i.default({locateFile:i=>s(`esri/libs/basisu/${i}`)});return t.initializeBasis(),t})(),t}let t;export{i as getBasisEncoder};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return r??=(async()=>{const e=await import(\"../../chunks/dxt_encoder.js\");return await e.default({locateFile:e=>t(`esri/libs/dxtEncoder/${e}`)})})(),r}let r;export{e as getDXTEncoder};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{getBasisEncoder as e}from\"../../libs/basisu/BasisUEncoder.js\";import{TextureFormat as t}from\"../../libs/basisu/TextureFormat.js\";import{getDXTEncoder as n}from\"../../libs/dxtEncoder/DXTEncoder.js\";import{CompressedTextureFormat as r}from\"../webgl/enums.js\";let a,s,l=null,i=null;class o{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}async function u(e){let t;if(t=e.data instanceof ImageBitmap?p(e.data):m(e.data,e.width,e.height,e.components,e.needsFlip),e.hasS3TC){i||await h();const n=new Uint8Array(t.length);if(i?.encode(t,e.width,e.height,e.preMultiplyAlpha,n)){const e=M(n,!0),t=[n.buffer];return{result:new o(e?.internalFormat??null,e?.textureData??null),transferList:t}}return{result:new o(null,null)}}if(e.hasETC){if(l||await c(),e.preMultiplyAlpha&&!i&&await h(),e.preMultiplyAlpha){const n=new Uint8ClampedArray(t.length);i?.premultiply(new Uint8Array(t),e.width,e.height,n),t=n}const n=await d(t,e.width,e.height,e.hasMipmap),r=n?await f(n):null,a=r?.compressedTexture?.levels.map((e=>e.buffer))||[];return{result:new o(r?.internalFormat??null,r?.compressedTexture??null),transferList:a}}return{result:new o(null,null)}}async function c(){l||(l=await(a??=e()))}async function h(){i||(i=await(s??=n()))}async function d(e,t,n,r,a=255,s=0,i=!1,o=!1){if(!l)return null;const u=new l.BasisEncoder;u.setPerceptual(!o),u.setCheckForAlpha(!0),u.setForceAlpha(!1),u.setRenormalize(o),u.setMipGen(r),u.setMipSRGB(!o),u.setCreateKTX2File(!0),u.setKTX2SRGBTransferFunc(!o),u.setQualityLevel(a),u.setCompressionLevel(s);const c=new Uint8Array(e.byteLength);u.setSliceSourceImage(0,new Uint8Array(e),t,n,i);const h=u.encode(c),d=new Uint8Array(c.buffer,0,h),f=new l.KTX2File(new Uint8Array(d));return f.isValid()?(u.delete(),d):(f.close(),f.delete(),u.delete(),null)}async function f(e){if(!l)return new o(null,null);const n=new l.KTX2File(new Uint8Array(e));n.startTranscoding();const[a,s]=n.getHasAlpha()?[t.ETC2_RGBA,r.COMPRESSED_RGBA8_ETC2_EAC]:[t.ETC1_RGB,r.COMPRESSED_RGB8_ETC2],i=n.getLevels(),u=[];for(let t=0;t<i;t++)u.push(new Uint8Array(n.getImageTranscodedSizeInBytes(t,0,0,a))),n.transcodeImage(u[t],t,0,0,a,0,-1,-1);return n.close(),n.delete(),{internalFormat:s,compressedTexture:{type:\"compressed\",levels:u}}}function p(e){const t=new OffscreenCanvas(e.width,e.height),n=t.getContext(\"2d\");n.drawImage(e,0,0);return n.getImageData(0,0,t.width,t.height).data}function m(e,t,n,r,a){const s=new Uint8ClampedArray(e).subarray(0,t*n*r);if(!a)return s;const l=new Uint8ClampedArray(s.length),i=t*r;for(let o=0;o<n;o++){const e=o*i,t=(n-o-1)*i;l.set(s.subarray(e,e+i),t)}return l}const w=31,y=1,T=2,A=3,C=4,g=7,E=21,b=131072;function S(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const _=S(\"DXT1\"),D=S(\"DXT3\"),R=S(\"DXT5\");function M(e,t){const n=new Int32Array(e.buffer,e.byteOffset,w);let a,s;switch(n[E]){case _:a=8,s=r.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case D:a=16,s=r.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case R:a=16,s=r.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let l=1,i=n[C],o=n[A];(3&i||3&o)&&(i=i+3&-4,o=o+3&-4);const u=i,c=o;let h,d;n[T]&b&&!1!==t&&(l=Math.max(1,n[g]));let f=e.byteOffset+n[y]+4;const p=[];for(let r=0;r<l;++r)d=(i+3>>2)*(o+3>>2)*a,h=new Uint8Array(e.buffer,f,d),p.push(h),f+=d,i=Math.max(1,i>>1),o=Math.max(1,o>>1);return{textureData:{type:\"compressed\",levels:p},internalFormat:s,width:u,height:c}}export{o as TextureCompressionWorkerOutput,u as compress,d as compressRGBADataToKTX2,f as createTextureDataKTX2,c as initializeBasisEncoder,h as initializeDXTEncoder};\n"],"names":["i","t","s","e","r","a","l","o","u","p","m","h","M","c","n","d","f","w","y","T","A","C","g","E","b","S","_","D","R"],"mappings":"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","x_google_ignoreList":[0,1,2]}