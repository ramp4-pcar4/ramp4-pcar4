import{i as p,A as b,k as Q,U as X,T as _,m as tt,q as nt,r as rt,t as k}from"./arcade-BoHTeCSG.js";import{w,y as z,a as y,A as H,z as W,p as Y,b as O,J as q,K as R,M as E,H as C,R as Z,L as M,N as P,T as at,q as x,j as L,i as D}from"./aiServices-u5nRiq9H.js";import{a as i,r as s}from"./enum-g1DWyQyu.js";import{o as J}from"./TimeOnly-CGkId3bj.js";import{l as B}from"./portalUtils-COohlq76.js";import{a as d}from"./operatorsWorkerConnection-TmW3NQ3Q.js";import{Y as et,a0 as K,dY as h,bw as m,dW as v,b$ as j,al as T,c2 as I,am as F,cr as V,ea as ot,Z as $}from"./main-BFDurRCu.js";async function G(e,n,r){if(!et?.findCredential(e.restUrl))return null;if(e.loadStatus==="loaded"&&n===""&&e.user?.sourceJSON&&r===!1)return e.user.sourceJSON;const u={responseType:"json",query:{f:"json"}};if(r&&(u.query.returnUserLicenseTypeExtensions=!0),n===""){const t=await K(e.restUrl+"/community/self",u);if(t.data){const a=t.data;if(a?.username)return a}return null}const f=await K(e.restUrl+"/community/users/"+n,u);if(f.data){const t=f.data;return t.error?null:t}return null}function N(e){if(e==null)return e;switch(typeof e){case"string":case"number":return e;default:throw new i(null,s.InvalidParameter,null)}}function it(e){e.mode==="async"&&(e.functions.disjoint=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>(t=w(t),p(t,n,r),t[0]===null||t[1]===null||d("disjoint",[t[0].toJSON(),t[1].toJSON()])))},e.functions.intersects=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>(t=w(t),p(t,n,r),t[0]!==null&&t[1]!==null&&d("intersects",[t[0].toJSON(),t[1].toJSON()])))},e.functions.touches=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>(t=w(t),p(t,n,r),t[0]!==null&&t[1]!==null&&d("touches",[t[0].toJSON(),t[1].toJSON()])))},e.functions.crosses=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>(t=w(t),p(t,n,r),t[0]!==null&&t[1]!==null&&d("crosses",[t[0].toJSON(),t[1].toJSON()])))},e.functions.within=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>(t=w(t),p(t,n,r),t[0]!==null&&t[1]!==null&&d("within",[t[0].toJSON(),t[1].toJSON()])))},e.functions.contains=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>(t=w(t),p(t,n,r),t[0]!==null&&t[1]!==null&&d("contains",[t[0].toJSON(),t[1].toJSON()])))},e.functions.overlaps=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>(t=w(t),p(t,n,r),t[0]!==null&&t[1]!==null&&d("overlaps",[t[0].toJSON(),t[1].toJSON()])))},e.functions.equals=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>(y(t,2,2,n,r),t[0]===t[1]||(t[0]instanceof h&&t[1]instanceof h?d("equals",[t[0].toJSON(),t[1].toJSON()]):(z(t[0])&&z(t[1])||!!(H(t[0])&&H(t[1])||W(t[0])&&W(t[1])))&&t[0].equals(t[1]))))},e.functions.relate=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>{if(t=w(t),y(t,3,3,n,r),t[0]instanceof h&&t[1]instanceof h)return d("relate",[t[0].toJSON(),t[1].toJSON(),Y(t[2])]);if(t[0]instanceof h&&t[1]===null||t[1]instanceof h&&t[0]===null||t[0]===null&&t[1]===null)return!1;throw new i(n,s.InvalidParameter,r)})},e.functions.intersection=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>(t=w(t),p(t,n,r),t[0]===null||t[1]===null?null:m(await d("intersection",[t[0].toJSON(),t[1].toJSON()]))))},e.functions.union=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if((t=w(t)).length===0)throw new i(n,s.WrongNumberOfParameters,r);const a=[];if(t.length===1)if(v(t[0])){for(const o of w(t[0]))if(o!==null){if(!(o instanceof h))throw new i(n,s.InvalidParameter,r);a.push(o.toJSON())}}else{if(!O(t[0])){if(t[0]instanceof h)return q(J(t[0]),n.spatialReference);if(t[0]===null)return null;throw new i(n,s.InvalidParameter,r)}for(const o of w(t[0].toArray()))if(o!==null){if(!(o instanceof h))throw new i(n,s.InvalidParameter,r);a.push(o.toJSON())}}else for(const o of t)if(o!==null){if(!(o instanceof h))throw new i(n,s.InvalidParameter,r);a.push(o.toJSON())}return a.length===0?null:m(await d("union",[a]))})},e.functions.difference=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>(t=w(t),p(t,n,r),t[0]===null?null:t[1]===null?J(t[0]):m(await d("difference",[t[0].toJSON(),t[1].toJSON()]))))},e.functions.symmetricdifference=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>(t=w(t),p(t,n,r),t[0]===null&&t[1]===null?null:t[0]===null?J(t[1]):t[1]===null?J(t[0]):m(await d("symmetricDifference",[t[0].toJSON(),t[1].toJSON()]))))},e.functions.clip=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,2,n,r),!(t[1]instanceof j)&&t[1]!==null)throw new i(n,s.InvalidParameter,r);if(t[0]===null)return null;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);return t[1]===null?null:m(await d("clip",[t[0].toJSON(),t[1].toJSON()]))})},e.functions.cut=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,2,n,r),!(t[1]instanceof T)&&t[1]!==null)throw new i(n,s.InvalidParameter,r);if(t[0]===null)return[];if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);return t[1]===null?[J(t[0])]:(await d("cut",[t[0].toJSON(),t[1].toJSON()])).map(a=>m(a))})},e.functions.area=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(y(t,1,2,n,r),t=w(t),R(t[0])){const o=await t[0].sumArea(N(t[1]),null,n.abortSignal);if(n.abortSignal.aborted)throw new i(n,s.Cancelled,r);return o}let a=t[0];if((v(a)||O(a))&&(a=E(t[0],n.spatialReference)),a===null)return 0;if(!(a instanceof h))throw new i(n,s.InvalidParameter,r);return d("area",[a.toJSON(),N(t[1])])})},e.functions.areageodetic=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{y(t,1,3,n,r);let a=(t=w(t))[0];(v(a)||O(a))&&(a=E(a,n.spatialReference));const o=N(t[1]),c=b(t[2]);if(R(a)){const l=await a.sumArea(o,c,n.abortSignal);if(n.abortSignal.aborted)throw new i(n,s.Cancelled,r);return l}if(a==null)return 0;if(!C(a))throw new i(n,s.InvalidParameter,r);return d("geodeticArea",[a.toJSON(),o,c])})},e.functions.length=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(y(t,1,2,n,r),t=w(t),R(t[0])){const o=await t[0].sumLength(N(t[1]),null,n.abortSignal);if(n.abortSignal.aborted)throw new i(n,s.Cancelled,r);return o}let a=t[0];if((v(t[0])||O(t[0]))&&(a=Z(t[0],n.spatialReference)),a===null)return 0;if(!(a instanceof h))throw new i(n,s.InvalidParameter,r);return d("length",[a.toJSON(),N(t[1])])})},e.functions.length3d=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(y(t,1,2,n,r),(t=w(t))[0]===null)return 0;let a=t[0];if((v(t[0])||O(t[0]))&&(a=Z(t[0],n.spatialReference)),a===null)return 0;if(!(a instanceof h))throw new i(n,s.InvalidParameter,r);if(a.hasZ===!0){const{convertFromSpatialReferenceUnit:o,toLengthUnit:c}=await import("./unitConversion-BxD3RA9Y.js"),l=Q(a);return o(a.spatialReference,c(t[1]),l)}return d("length",[a.toJSON(),N(t[1])])})},e.functions.lengthgeodetic=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{y(t,1,3,n,r);let a=(t=w(t))[0];(v(t[0])||O(t[0]))&&(a=Z(t[0],n.spatialReference));const o=N(t[1]),c=b(t[2]);if(R(a)){const l=await a.sumLength(o,c,n.abortSignal);if(n.abortSignal.aborted)throw new i(n,s.Cancelled,r);return l}if(a===null)return 0;if(!C(a))throw new i(n,s.InvalidParameter,r);return d("geodeticLength",[a.toJSON(),o,c])})},e.functions.distance=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{t=w(t),y(t,2,3,n,r);let a=t[0];if((v(t[0])||O(t[0]))&&(a=M(t[0],n.spatialReference)),!(a instanceof h))throw new i(n,s.InvalidParameter,r);let o=t[1];if((v(t[1])||O(t[1]))&&(o=M(t[1],n.spatialReference)),!(o instanceof h))throw new i(n,s.InvalidParameter,r);return d("distance",[a.toJSON(),o.toJSON(),N(t[2])])})},e.functions.distancegeodetic=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{t=w(t),y(t,2,4,n,r);const a=t[0];if(!(a instanceof I))throw new i(n,s.InvalidParameter,r);const o=t[1];if(!(o instanceof I))throw new i(n,s.InvalidParameter,r);const c=new T({paths:[],spatialReference:a.spatialReference});return c.addPath([a,o]),d("geodeticLength",[c.toJSON(),N(t[2]),b(t[3])])})},e.functions.densify=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);const a=P(t[1]);if(isNaN(a))throw new i(n,s.InvalidParameter,r);if(a<=0)throw new i(n,s.InvalidParameter,r);switch(t[0].type){case"polygon":case"polyline":case"extent":return m(await d("densify",[t[0].toJSON(),a,N(t[2])]));default:return t[0]}})},e.functions.densifygeodetic=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{t=w(t),y(t,2,4,n,r);const a=t[0];if(a==null)return null;if(!C(a))throw new i(n,s.InvalidParameter,r);const o=P(t[1]);if(isNaN(o))throw new i(n,s.InvalidParameter,r);if(o<=0)throw new i(n,s.InvalidParameter,r);const c=N(t[2]),l=b(t[3]);switch(a.type){case"polygon":case"polyline":case"extent":return m(await d("geodeticDensify",[a.toJSON(),o,c,l]));default:return a}})},e.functions.generalize=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,4,n,r),t[0]===null)return null;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);const a=P(t[1]);if(isNaN(a))throw new i(n,s.InvalidParameter,r);const o=at(x(t[2],!0));return m(await d("generalize",[t[0].toJSON(),a,N(t[3]),{removeDegenerateParts:o}]))})},e.functions.buffer=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);const a=P(t[1]);if(isNaN(a))throw new i(n,s.InvalidParameter,r);return a===0?J(t[0]):m(await d("buffer",[t[0].toJSON(),a,N(t[2])]))})},e.functions.buffergeodetic=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{t=w(t),y(t,2,4,n,r);const a=t[0];if(a==null)return null;if(!C(a))throw new i(n,s.InvalidParameter,r);const o=P(t[1]);if(isNaN(o))throw new i(n,s.InvalidParameter,r);if(o===0)return J(a);const c=N(t[2]),l=b(t[3]);return m(await d("geodesicBuffer",[a.toJSON(),o,c,l]))})},e.functions.offset=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,6,n,r),t[0]===null)return null;if(!(t[0]instanceof F||t[0]instanceof T))throw new i(n,s.InvalidParameter,r);const a=P(t[1]);if(isNaN(a))throw new i(n,s.InvalidParameter,r);const o=X(t[3]),c=P(x(t[4],10));if(isNaN(c))throw new i(n,s.InvalidParameter,r);const l=P(x(t[5],0));if(isNaN(l))throw new i(n,s.InvalidParameter,r);return m(await d("offset",[t[0].toJSON(),a,N(t[2]),{joins:o,miterLimit:c,flattenError:l}]))})},e.functions.rotate=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);const a=t[0]instanceof j?F.fromExtent(t[0]):t[0],o=P(t[1]);if(isNaN(o))throw new i(n,s.InvalidParameter,r);const c=x(t[2],null);if(c===null){const l=a.type==="point"?a:a.extent?.center;return m(await d("rotate",[a.toJSON(),o,l?.x,l?.y]))}if(c instanceof I)return m(await d("rotate",[a.toJSON(),o,c.x,c.y]));throw new i(n,s.InvalidParameter,r)})},e.functions.centroid=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,1,2,n,r),t[0]===null)return null;const a=_(t[1]);let o=t[0];if((v(t[0])||O(t[0]))&&(o=a==="geometric"?M(t[0],n.spatialReference):E(t[0],n.spatialReference),o===null))return null;if(!(o instanceof h))throw new i(n,s.InvalidParameter,r);return m(a==="geometric"?await d("centroid",[o.toJSON()]):await d("labelPoint",[o.toJSON()]))})},e.functions.measuretocoordinate=function(n,r){return e.standardFunctionAsync(n,r,tt)},e.functions.pointtocoordinate=function(n,r){return e.standardFunctionAsync(n,r,nt)},e.functions.distancetocoordinate=function(n,r){return e.standardFunctionAsync(n,r,rt)},e.functions.multiparttosinglepart=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);if(t[0]instanceof I)return[q(J(t[0]),n.spatialReference)];if(t[0]instanceof j)return[q(J(t[0]),n.spatialReference)];const a=m(await d("simplify",[t[0].toJSON()]));if(a instanceof F){const o=[],c=[];for(let l=0;l<a.rings.length;l++)if(a.isClockwise(a.rings[l])){const S=m({rings:[a.rings[l]],hasZ:a.hasZ===!0,hasM:a.hasM===!0,spatialReference:a.spatialReference.toJSON()});o.push(S)}else c.push({ring:a.rings[l],pt:a.getPoint(l,0)});for(let l=0;l<c.length;l++)for(let S=0;S<o.length;S++)if(o[S].contains(c[l].pt)){o[S].addRing(c[l].ring);break}return o}if(a instanceof T){const o=[];for(let c=0;c<a.paths.length;c++){const l=m({paths:[a.paths[c]],hasZ:a.hasZ===!0,hasM:a.hasM===!0,spatialReference:a.spatialReference.toJSON()});o.push(l)}return o}if(t[0]instanceof V){const o=[],c=q(J(t[0]),n.spatialReference);for(let l=0;l<c.points.length;l++)o.push(c.getPoint(l));return o}return null})},e.functions.isselfintersecting=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{y(t,1,1,u,f);let a=(t=w(t))[0];if((v(t[0])||O(t[0]))&&(a=Z(t[0],u.spatialReference)),a instanceof V){const o=a.points;for(let c=0;c<o.length;c++)for(let l=c+1;l<o.length;l++)if(ot(o[c],o[l]))return!0;return!1}return(a instanceof T||a instanceof F)&&await d("isSelfIntersecting",[a.toJSON()])})},e.functions.issimple=function(n,r){return e.standardFunctionAsync(n,r,(u,f,t)=>{if(t=w(t),y(t,1,1,n,r),t[0]===null)return!0;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);return d("isSimple",[t[0].toJSON()])})},e.functions.simplify=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);return m(await d("simplify",[t[0].toJSON()]))})},e.functions.convexhull=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof h))throw new i(n,s.InvalidParameter,r);return m(await d("convexHull",[t[0].toJSON()]))})},e.functions.getuser=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{y(t,0,2,n,r);let a=x(t[1],""),o=a===!0;if(a=a===!0||a===!1?"":Y(a),t.length===0||t[0]instanceof k){let l;l=n.services?.portal?n.services.portal:$.getDefault(),t.length>0&&(l=B(t[0],l));const S=await G(l,a,o);if(S){const A=JSON.parse(JSON.stringify(S));for(const g of["lastLogin","created","modified"])A[g]!==void 0&&A[g]!==null&&(A[g]=new Date(A[g]));return L.convertObjectToArcadeDictionary(A,D(n))}return null}let c=null;if(R(t[0])&&(c=t[0]),c){if(o=!1,a)return null;await c.load();const l=await c.getOwningSystemUrl();if(!l){if(!a){const g=await c.getIdentityUser();return g?L.convertObjectToArcadeDictionary({username:g},D(n)):null}return null}let S;S=n.services?.portal?n.services.portal:$.getDefault(),S=B(new k(l),S);const A=await G(S,a,o);if(A){const g=JSON.parse(JSON.stringify(A));for(const U of["lastLogin","created","modified"])g[U]!==void 0&&g[U]!==null&&(g[U]=new Date(g[U]));return L.convertObjectToArcadeDictionary(g,D(n))}return null}throw new i(n,s.InvalidParameter,r)})},e.functions.nearestcoordinate=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,2,n,r),!(t[0]instanceof h||t[0]===null))throw new i(n,s.InvalidParameter,r);if(!(t[1]instanceof I||t[1]===null))throw new i(n,s.InvalidParameter,r);if(t[0]===null||t[1]===null)return null;const a=t[0]instanceof j?F.fromExtent(t[0]):t[0],o=await d("getNearestCoordinate",[a.toJSON(),t[1].toJSON(),{calculateLeftRightSide:!0}]);return o===null?null:L.convertObjectToArcadeDictionary({coordinate:m(o.coordinate),distance:o.distance,sideOfLine:o.distance===0?"straddle":o.isRightSide?"right":"left"},D(n),!1,!0)})},e.functions.nearestvertex=function(n,r){return e.standardFunctionAsync(n,r,async(u,f,t)=>{if(t=w(t),y(t,2,2,n,r),!(t[0]instanceof h||t[0]===null))throw new i(n,s.InvalidParameter,r);if(!(t[1]instanceof I||t[1]===null))throw new i(n,s.InvalidParameter,r);if(t[0]===null||t[1]===null)return null;const a=t[0]instanceof j?F.fromExtent(t[0]):t[0],o=await d("getNearestVertex",[a.toJSON(),t[1].toJSON()]);return o===null?null:L.convertObjectToArcadeDictionary({coordinate:m(o.coordinate),distance:o.distance,sideOfLine:o.distance===0?"straddle":o.isRightSide?"right":"left"},D(n),!1,!0)})})}export{it as registerFunctions};
