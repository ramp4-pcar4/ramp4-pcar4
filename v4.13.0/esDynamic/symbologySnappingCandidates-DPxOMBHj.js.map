{"version":3,"file":"symbologySnappingCandidates-DPxOMBHj.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationAlignment.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationFilter.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/symbologySnappingCandidates.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{getOrCreateMapValue as t}from\"../../../../core/MapUtils.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{getMetersPerVerticalUnitForSR as n}from\"../../../../core/unitUtils.js\";import{getMetersPerUnit as o}from\"../../../../symbols/support/unitConversionUtils.js\";function i(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:s}=t;return new c(e,s)}return new a}class a{async alignCandidates(e,t,s){return e}notifyElevationSourceChange(){}}const r=1024;class c{constructor(t,s){this._elevationInfo=t,this._alignPointsInFeatures=s,this._alignmentsCache=new e(r),this._cacheVersion=0}async alignCandidates(e,t,s){const n=this._elevationInfo;return null==n||\"absolute-height\"!==n.mode||n.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,s):(l(e,t,n),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,n,o){const i=new Map;for(const s of e)t(i,s.objectId,d).push(s);const[a,r,c]=this._prepareQuery(i,n),h=await this._alignPointsInFeatures(a,o);s(o);if(c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,n,o);this._applyCacheAndResponse(a,h,r);const{drapedObjectIds:u,failedObjectIds:l}=h,p=[];for(const t of e){const{objectId:e}=t;u.has(e)&&\"edge\"===t.type&&(t.draped=!0),l.has(e)||p.push(t)}return p}_prepareQuery(e,t){const s=[],n=[];for(const[o,i]of e){const e=[];for(const t of i)this._addToQueriesOrCachedResult(o,t.target,e,n),\"edge\"===t.type&&(this._addToQueriesOrCachedResult(o,t.start,e,n),this._addToQueriesOrCachedResult(o,t.end,e,n));0!==e.length&&s.push({objectId:o,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:s},n,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,s,n){const o=u(e,t),i=this._alignmentsCache.get(o);null==i?s.push(t):n.push(new h(t,i))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:s,failedObjectIds:n},o){for(const r of o)r.apply();let i=0;const a=this._alignmentsCache;for(const{objectId:r,points:c}of e.pointsInFeatures){if(n.has(r)){i+=c.length;continue}const e=!s.has(r);for(const s of c){const n=u(r,s),o=t[i++];s.z=o,e&&a.put(n,o,1)}}}}class h{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function u(e,{x:t,y:s,z:n,spatialReference:o}){return`${e}-${t}-${s}-${n??0}}-wkid:${o?.wkid}`}function l(e,t,s){const{offset:i,unit:a}=s;if(null==i)return;const r=n(t),c=i*(o(a??\"meters\")/r);for(const n of e)switch(n.type){case\"edge\":n.start.z+=c,n.end.z+=c;continue;case\"vertex\":n.target.z+=c;continue}}function d(){return[]}export{i as getSnappingCandidateElevationAligner};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";class t{filter(t,n){return n}notifyElevationSourceChange(){}}class n{filter(t,n){const{point:r,distance:c}=t,{z:i}=r;if(!(null!=i))return n;if(0===n.length)return n;const o=s(c),u=this._updateCandidatesTo3D(n,r,o).filter(e);return u.sort(a),u}_updateCandidatesTo3D(t,n,e){for(const r of t)switch(r.type){case\"edge\":c(r,n,e);continue;case\"vertex\":o(r,n,e);continue}return t}}function e(t){return t.distance<=1}function r(e=!1){return e?new n:new t}function c(t,n,{x:e,y:r,z:c}){const{start:o,end:s,target:a}=t;t.draped||i(a,n,o,s);const u=(n.x-a.x)/e,d=(n.y-a.y)/r,f=(n.z-a.z)/c;t.distance=Math.sqrt(u*u+d*d+f*f)}function i(t,n,e,r){const c=r.x-e.x,i=r.y-e.y,o=r.z-e.z,s=c*c+i*i+o*o,a=(n.x-e.x)*c+(n.y-e.y)*i+o*(n.z-e.z),u=Math.min(1,Math.max(0,a/s)),d=e.x+c*u,f=e.y+i*u,x=e.z+o*u;t.x=d,t.y=f,t.z=x}function o(t,n,{x:e,y:r,z:c}){const{target:i}=t,o=(n.x-i.x)/e,s=(n.y-i.y)/r,a=(n.z-i.z)/c,u=Math.sqrt(o*o+s*s+a*a);t.distance=u}function s(t){return\"number\"==typeof t?{x:t,y:t,z:t}:t}function a(t,n){return t.distance-n.distance}export{r as getSnappingCandidateElevationFilter};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{clone as t}from\"../../../../core/lang.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{numericHash as o}from\"../../../../core/string.js\";function n(t=!1,e){return t?new i(e):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}const r=1024;class i{constructor(t){this._getSymbologyCandidates=t,this._candidatesCache=new e(r),this._cacheVersion=0}async fetch(e,o){if(0===e.length)return[];const n=[],c=[],r=this._candidatesCache;for(const s of e){const e=a(s),o=r.get(e);if(o)for(const s of o)c.push(t(s));else n.push(s),r.put(e,[],1)}if(0===n.length)return c;const i=this._cacheVersion,{candidates:h,sourceCandidateIndices:d}=await this._getSymbologyCandidates(n,o);s(o);if(i!==this._cacheVersion)return this.fetch(e,o);const f=[],{length:g}=h;for(let s=0;s<g;++s){const e=h[s],o=a(n[d[s]]),c=r.get(o);c.push(e),r.put(o,c,c.length),f.push(t(e))}return c.concat(f)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function a(t){switch(t.type){case\"vertex\":{const{objectId:e,target:s}=t,n=`${e}-vertex-${s.x}-${s.y}-${s.z??0}`;return o(n).toString()}case\"edge\":{const{objectId:e,start:s,end:n}=t,c=`${e}-edge-${s.x}-${s.y}-${s.z??0}-to-${n.x}-${n.y}-${n.z??0}`;return o(c).toString()}default:return\"\"}}export{n as getSymbologySnappingCandidatesFetcher};\n"],"names":["i","e","t","s","c","a","a$2","r","n","l","o","d","h","u","p","n$1","f","x","g"],"mappings":"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","x_google_ignoreList":[0,1,2]}