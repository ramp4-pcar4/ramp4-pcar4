{"version":3,"file":"label-DeyAgFGa.js","sources":["../../node_modules/@esri/calcite-components/dist/chunks/label.js"],"sourcesContent":["/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.\nv3.2.1 */\nimport { q as queryElementRoots, l as closestElementCrossShadowBoundary, m as isBefore } from \"./dom.js\";\nconst labelClickEvent = \"calciteInternalLabelClick\";\nconst labelConnectedEvent = \"calciteInternalLabelConnected\";\nconst labelDisconnectedEvent = \"calciteInternalLabelDisconnected\";\nconst labelTagName = \"calcite-label\";\nconst labelToLabelables = /* @__PURE__ */ new WeakMap();\nconst onLabelClickMap = /* @__PURE__ */ new WeakMap();\nconst onLabelConnectedMap = /* @__PURE__ */ new WeakMap();\nconst onLabelDisconnectedMap = /* @__PURE__ */ new WeakMap();\nconst unlabeledComponents = /* @__PURE__ */ new Set();\nconst findLabelForComponent = (componentEl) => {\n  const { id } = componentEl;\n  const forLabel = id && queryElementRoots(componentEl, { selector: `${labelTagName}[for=\"${id}\"]` });\n  if (forLabel) {\n    return forLabel;\n  }\n  const parentLabel = closestElementCrossShadowBoundary(componentEl, labelTagName);\n  if (!parentLabel || // labelable components within other custom elements are not considered labelable\n  hasAncestorCustomElements(parentLabel, componentEl)) {\n    return null;\n  }\n  return parentLabel;\n};\nfunction hasAncestorCustomElements(label, componentEl) {\n  let traversedElements;\n  const customElementAncestorCheckEventType = \"custom-element-ancestor-check\";\n  const listener = (event) => {\n    event.stopImmediatePropagation();\n    const composedPath = event.composedPath();\n    traversedElements = composedPath.slice(composedPath.indexOf(componentEl), composedPath.indexOf(label));\n  };\n  label.addEventListener(customElementAncestorCheckEventType, listener, { once: true });\n  componentEl.dispatchEvent(new CustomEvent(customElementAncestorCheckEventType, { composed: true, bubbles: true }));\n  label.removeEventListener(customElementAncestorCheckEventType, listener);\n  const ancestorCustomElements = traversedElements.filter((el) => el !== componentEl && el !== label).filter((el) => el.tagName?.includes(\"-\"));\n  return ancestorCustomElements.length > 0;\n}\nfunction connectLabel(component) {\n  if (!component) {\n    return;\n  }\n  const labelEl = findLabelForComponent(component.el);\n  if (onLabelClickMap.has(labelEl) && labelEl === component.labelEl || !labelEl && unlabeledComponents.has(component)) {\n    return;\n  }\n  const boundOnLabelDisconnected = onLabelDisconnected.bind(component);\n  if (labelEl) {\n    component.labelEl = labelEl;\n    const labelables = labelToLabelables.get(labelEl) || [];\n    labelables.push(component);\n    labelToLabelables.set(labelEl, labelables.sort(sortByDOMOrder));\n    if (!onLabelClickMap.has(component.labelEl)) {\n      onLabelClickMap.set(component.labelEl, onLabelClick);\n      component.labelEl.addEventListener(labelClickEvent, onLabelClick);\n    }\n    unlabeledComponents.delete(component);\n    document.removeEventListener(labelConnectedEvent, onLabelConnectedMap.get(component));\n    onLabelDisconnectedMap.set(component, boundOnLabelDisconnected);\n    document.addEventListener(labelDisconnectedEvent, boundOnLabelDisconnected);\n  } else if (!unlabeledComponents.has(component)) {\n    boundOnLabelDisconnected();\n    document.removeEventListener(labelDisconnectedEvent, onLabelDisconnectedMap.get(component));\n  }\n}\nfunction disconnectLabel(component) {\n  if (!component) {\n    return;\n  }\n  unlabeledComponents.delete(component);\n  document.removeEventListener(labelConnectedEvent, onLabelConnectedMap.get(component));\n  document.removeEventListener(labelDisconnectedEvent, onLabelDisconnectedMap.get(component));\n  onLabelConnectedMap.delete(component);\n  onLabelDisconnectedMap.delete(component);\n  if (!component.labelEl) {\n    return;\n  }\n  const labelables = labelToLabelables.get(component.labelEl);\n  if (labelables.length === 1) {\n    component.labelEl.removeEventListener(labelClickEvent, onLabelClickMap.get(component.labelEl));\n    onLabelClickMap.delete(component.labelEl);\n  }\n  labelToLabelables.set(\n    component.labelEl,\n    labelables.filter((labelable) => labelable !== component).sort(sortByDOMOrder)\n  );\n  component.labelEl = null;\n}\nfunction sortByDOMOrder(a, b) {\n  return isBefore(a.el, b.el) ? -1 : 1;\n}\nfunction getLabelText(component) {\n  return component.label || component.labelEl?.textContent?.trim() || \"\";\n}\nfunction onLabelClick(event) {\n  const labelClickTarget = event.detail.sourceEvent.target;\n  const labelables = labelToLabelables.get(this);\n  const clickedLabelable = labelables.find((labelable) => labelable.el === labelClickTarget);\n  const labelableChildClicked = labelables.includes(clickedLabelable);\n  if (labelableChildClicked) {\n    return;\n  }\n  const firstLabelable = labelables[0];\n  if (firstLabelable.disabled) {\n    return;\n  }\n  firstLabelable.onLabelClick(event);\n}\nfunction onLabelConnected() {\n  if (unlabeledComponents.has(this)) {\n    connectLabel(this);\n  }\n}\nfunction onLabelDisconnected() {\n  unlabeledComponents.add(this);\n  const boundOnLabelConnected = onLabelConnectedMap.get(this) || onLabelConnected.bind(this);\n  onLabelConnectedMap.set(this, boundOnLabelConnected);\n  document.addEventListener(labelConnectedEvent, boundOnLabelConnected);\n}\nasync function associateExplicitLabelToUnlabeledComponent(label) {\n  await label.componentOnReady();\n  const alreadyLabeled = labelToLabelables.has(label);\n  if (alreadyLabeled) {\n    return;\n  }\n  const forComponentEl = label.ownerDocument?.getElementById(label.for);\n  if (!forComponentEl) {\n    return;\n  }\n  requestAnimationFrame(() => {\n    for (const labelable of unlabeledComponents) {\n      if (labelable.el === forComponentEl) {\n        connectLabel(labelable);\n        break;\n      }\n    }\n  });\n}\nexport {\n  associateExplicitLabelToUnlabeledComponent as a,\n  labelDisconnectedEvent as b,\n  connectLabel as c,\n  disconnectLabel as d,\n  getLabelText as g,\n  labelConnectedEvent as l\n};\n"],"names":["labelClickEvent","labelConnectedEvent","labelDisconnectedEvent","labelTagName","labelToLabelables","onLabelClickMap","onLabelConnectedMap","onLabelDisconnectedMap","unlabeledComponents","findLabelForComponent","componentEl","id","forLabel","queryElementRoots","parentLabel","closestElementCrossShadowBoundary","hasAncestorCustomElements","label","traversedElements","customElementAncestorCheckEventType","listener","event","composedPath","el","connectLabel","component","labelEl","boundOnLabelDisconnected","onLabelDisconnected","labelables","sortByDOMOrder","onLabelClick","disconnectLabel","labelable","a","b","isBefore","getLabelText","labelClickTarget","clickedLabelable","firstLabelable","onLabelConnected","boundOnLabelConnected","associateExplicitLabelToUnlabeledComponent","forComponentEl"],"mappings":"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","x_google_ignoreList":[0]}