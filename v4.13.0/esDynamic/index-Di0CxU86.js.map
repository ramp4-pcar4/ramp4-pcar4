{"version":3,"file":"index-Di0CxU86.js","sources":["../../src/fixtures/panguard/lang/lang.csv?raw","../../src/fixtures/panguard/map-panguard.vue","../../src/fixtures/panguard/index.ts"],"sourcesContent":["export default \"key,enValue,enValid,frValue,frValid\\npanguard.instructions,Use two fingers to pan the map,1,Utilisez deux doigts pour faire un panoramique de la carte,1\\n\"","<template>\n    <div class=\"pg\" ref=\"panGuard\">\n        <p class=\"pg-label\">{{ t('panguard.instructions') }}</p>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { inject, onBeforeUnmount, onMounted, reactive, ref } from 'vue';\nimport { GlobalEvents, InstanceAPI } from '@/api';\nimport { useI18n } from 'vue-i18n';\n\nconst { t } = useI18n();\nconst iApi = inject('iApi') as InstanceAPI;\nconst panGuard = ref<HTMLElement>();\n\nconst timeoutID = ref(-1);\nconst esriHandlers = reactive<Array<any>>([]);\nconst rampHanders = reactive<Array<string>>([]);\n\nonMounted(() => {\n    setup();\n    // setup again when the map reloads\n    rampHanders.push(\n        iApi.event.on(GlobalEvents.MAP_CREATED, () => {\n            setup();\n        })\n    );\n    rampHanders.push(\n        iApi.event.on(GlobalEvents.MAP_DESTROYED, () => {\n            esriHandlers.forEach(h => h.remove());\n        })\n    );\n    rampHanders.push(\n        iApi.event.on(GlobalEvents.MAP_REFRESH_START, () => {\n            esriHandlers.forEach(h => h.remove());\n        })\n    );\n    rampHanders.push(\n        iApi.event.on(GlobalEvents.MAP_REFRESH_END, () => {\n            setup();\n        })\n    );\n});\n\nonBeforeUnmount(() => {\n    rampHanders.forEach(h => iApi.event.off(h));\n    esriHandlers.forEach(h => h.remove());\n});\n\nconst setup = () => {\n    // keep track of how many concurrent pointers are on the screen and their initial positions. This is a javascript map, not a map-map\n    const pointers = new Map();\n\n    // prevent possible issues with esri event registration if this fixture runs before the map has built itself\n    iApi.geo.map.viewPromise.then(() => {\n        esriHandlers.push(\n            iApi.geo.map.esriView!.on('pointer-down', e => {\n                if (e.pointerType !== 'touch') return;\n                pointers.set(e.pointerId, { x: e.x, y: e.y });\n            })\n        );\n\n        esriHandlers.push(\n            //@ts-expect-error TODO: explain why this is needed or remove\n            iApi.geo.map.esriView!.on(['pointer-up', 'pointer-leave'], e => {\n                if (e.pointerType !== 'touch') return;\n                // small delay as to not offend panguard when lifting more than one finger\n                window.setTimeout(() => {\n                    pointers.delete(e.pointerId);\n                }, 200);\n            })\n        );\n\n        esriHandlers.push(\n            iApi.geo.map.esriView!.on('pointer-move', e => {\n                const { pointerId, pointerType, x, y } = e;\n                const pointer = pointers.get(pointerId);\n\n                if (!pointer || pointerType !== 'touch' || pointers.size !== 1) {\n                    panGuard.value!.classList.remove('pg-active');\n                    return;\n                }\n\n                // ignore very small movements to avoid scrolling when someone is tapping the screen\n                const distance = Math.sqrt(Math.pow(x - pointer.x, 2) + Math.pow(y - pointer.y, 2));\n                if (distance < 20) return;\n\n                // show the text on screen and remove after 2 seconds of no movement\n                panGuard.value!.classList.add('pg-active');\n\n                if (timeoutID.value !== -1) {\n                    clearTimeout(timeoutID.value);\n                }\n\n                timeoutID.value = window.setTimeout(() => {\n                    panGuard.value!.classList.remove('pg-active');\n                }, 2000);\n            })\n        );\n    });\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.pg {\n    transition: opacity ease-in-out;\n    background-color: rgba(0, 0, 0, 0.45);\n    text-align: center;\n\n    position: absolute;\n    padding: 0px;\n    margin: 0px;\n    border-width: 0px;\n    width: 100%;\n    height: 100%;\n    left: 0px;\n    top: 0px;\n\n    transition-duration: 0.8s;\n\n    opacity: 0;\n    pointer-events: none !important;\n    z-index: 100;\n\n    &.pg-active {\n        opacity: 1;\n        transition-duration: 0.3s;\n        pointer-events: auto !important;\n        touch-action: auto;\n    }\n\n    .pg-label {\n        font-size: 1em * 1.5;\n        color: white;\n        position: relative;\n        margin: 0;\n        top: 50% !important;\n        transform: translateY(-50%);\n    }\n}\n</style>\n","import messages from './lang/lang.csv?raw';\nimport PanguardV from './map-panguard.vue';\nimport { FixtureInstance } from '@/api';\n\nclass PanguardFixture extends FixtureInstance {\n    added(): void {\n        // console.log(`[fixture] ${this.id} added`);\n        // Manually add lang entries to i18n\n        Object.entries(messages).forEach(value => (<any>this.$iApi.$i18n).mergeLocaleMessage(...value));\n\n        const { destroy, el } = this.mount(PanguardV, {\n            app: this.$element\n        });\n        const innerShell = this.$vApp.$el.getElementsByClassName('inner-shell')[0];\n        innerShell.appendChild(el.childNodes[0]);\n\n        // override the removed method here to get access to scope\n        this.removed = () => {\n            // console.log(`[fixture] ${this.id} removed`);\n            destroy();\n        };\n    }\n}\n\nexport default PanguardFixture;\n"],"names":["messages","t","useI18n","iApi","inject","panGuard","ref","timeoutID","esriHandlers","reactive","rampHanders","onMounted","setup","GlobalEvents","h","onBeforeUnmount","pointers","e","pointerId","pointerType","x","y","pointer","PanguardFixture","FixtureInstance","value","destroy","el","PanguardV"],"mappings":"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"}