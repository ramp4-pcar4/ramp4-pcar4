{"version":3,"file":"portalLayers-CI9PJ-2j.js","sources":["../../node_modules/@arcgis/core/portal/support/portalLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{findAssociatedFeatureService as a}from\"../../layers/support/associatedFeatureServiceUtils.js\";import{getLayerModuleType as r}from\"../../layers/support/fetchService.js\";import{LayerLoadContext as t}from\"../../layers/support/LayerLoadContext.js\";import{sceneServiceLayerTypeToClassName as s,applyPreferredHostToPortalItem as c,getPreferredHost as n}from\"../../layers/support/layerUtils.js\";import{layerLookupMap as o}from\"../../layers/support/lazyLayerLoader.js\";import i from\"../PortalItem.js\";import{getFirstLayerOrTable as u,getNumLayersAndTables as l,preprocessFSItemData as y,getLayerOrTable as m,layerTypeToLayerModuleType as f,populateSceneServiceItemData as p}from\"./loadUtils.js\";import{hasTypeKeyword as d}from\"./portalItemUtils.js\";async function L(e){let{portalItem:a}=e;!a||a instanceof i||(a=new i(a));const r=await w(a);return new(0,r.constructor)({portalItem:a,...r.properties})}async function w(e){await e.load();const a=new t;return S(await N(e,a))}async function N(a,r){switch(a.type){case\"3DTiles Service\":return a.typeKeywords.includes(\"3DObject\")?b():P();case\"CSV\":return F();case\"Feature Collection\":return M(a);case\"Feature Service\":return h(a,r);case\"Feed\":return x();case\"GeoJson\":return G();case\"Group Layer\":return J();case\"Image Service\":return g(a,r);case\"KML\":return V();case\"Knowledge Graph Layer\":return K();case\"Map Service\":return v(a,r);case\"Media Layer\":return k();case\"Scene Service\":return I(a,r);case\"Stream Service\":return j();case\"Video Service\":return T(a,r);case\"Vector Tile Service\":return C();case\"WCS\":return W();case\"WFS\":return U();case\"WMS\":return D();case\"WMTS\":return O();default:throw new e(\"portal:unknown-item-type\",\"Unknown item type '${type}'\",{type:a.type})}}async function S(e){const a=e.className,r=o[a];return{constructor:await r(),properties:e.properties}}async function v(e,a){return await $(e,a)?{className:\"TileLayer\"}:{className:\"MapImageLayer\"}}async function h(e,a){const r=await A(e,a);if(\"object\"==typeof r){const{sourceJSON:e,className:a}=r,t={sourceJSON:e};return null!=r.id&&(t.layerId=r.id),{className:a||\"FeatureLayer\",properties:t}}return{className:\"GroupLayer\"}}async function I(e,r){const t=await A(e,r,(async()=>{try{if(!e.url)return[];const{serverUrl:t}=await a(e.url,{sceneLayerItem:e}),s=await r.fetchServiceMetadata(t);return s?.tables??[]}catch{return[]}}));if(\"object\"==typeof t){const a={};let c;if(null!=t.id?(a.layerId=t.id,c=`${e.url}/layers/${t.id}`):c=e.url,e.typeKeywords?.length)for(const r of Object.keys(s))if(e.typeKeywords.includes(r))return{className:s[r]};const n=await r.fetchServiceMetadata(c,{customParameters:await r.fetchCustomParameters(e,(e=>u(e)?.customParameters))});return{className:s[n?.layerType]||\"SceneLayer\",properties:a}}if(!1===t){const a=await r.fetchServiceMetadata(e.url);if(\"Voxel\"===a?.layerType)return{className:\"VoxelLayer\"}}return{className:\"GroupLayer\"}}async function M(e){await e.load();const a=d(e,\"Map Notes\"),r=d(e,\"Markup\");if(a||r)return{className:\"MapNotesLayer\"};if(d(e,\"Route Layer\"))return{className:\"RouteLayer\"};const t=await e.fetchData();return 1===l(t)?{className:\"FeatureLayer\"}:{className:\"GroupLayer\"}}async function g(e,a){await e.load();const r=e.typeKeywords?.map((e=>e.toLowerCase()))??[];if(r.includes(\"elevation 3d layer\"))return{className:\"ElevationLayer\"};if(r.includes(\"tiled imagery\"))return{className:\"ImageryTileLayer\"};const t=await a.fetchItemData(e),s=t?.layerType;if(\"ArcGISTiledImageServiceLayer\"===s)return{className:\"ImageryTileLayer\"};if(\"ArcGISImageServiceLayer\"===s)return{className:\"ImageryLayer\"};const c=await a.fetchServiceMetadata(e.url,{customParameters:await a.fetchCustomParameters(e)}),n=c.cacheType?.toLowerCase(),o=c.capabilities?.toLowerCase().includes(\"tilesonly\"),i=c.tileInfo?.format?.toLowerCase()??\"\",u=null==n&&[\"jpg\",\"jpeg\",\"png\",\"png8\",\"png24\",\"png32\",\"mixed\"].includes(i);return\"map\"===n||u||o?{className:\"ImageryTileLayer\"}:{className:\"ImageryLayer\"}}function j(){return{className:\"StreamLayer\"}}async function T(e,a){return\"object\"==typeof await A(e,a)?{className:\"VideoLayer\"}:{className:\"GroupLayer\"}}function C(){return{className:\"VectorTileLayer\"}}function G(){return{className:\"GeoJSONLayer\"}}function P(){return{className:\"IntegratedMesh3DTilesLayer\"}}function b(){return{className:\"UnsupportedLayer\"}}function F(){return{className:\"CSVLayer\"}}function V(){return{className:\"KMLLayer\"}}function K(){return{className:\"KnowledgeGraphLayer\"}}function W(){return{className:\"WCSLayer\"}}function U(){return{className:\"WFSLayer\"}}function D(){return{className:\"WMSLayer\"}}function O(){return{className:\"WMTSLayer\"}}function x(){return{className:\"StreamLayer\"}}function J(){return{className:\"GroupLayer\"}}function k(){return{className:\"MediaLayer\"}}async function $(e,a){const{tileInfo:r}=await a.fetchServiceMetadata(e.url,{customParameters:await a.fetchCustomParameters(e)});return r}async function A(e,a,t){const{url:s,type:o}=e,i=\"Feature Service\"===o;if(!s)return{};if(/\\/\\d+$/.test(s)){if(i){const t=await a.fetchServiceMetadata(s,{customParameters:await a.fetchCustomParameters(e,(e=>u(e)?.customParameters))});return c(e,n()),{id:t.id,className:r(t.type),sourceJSON:t}}return{}}if(\"Video Service\"===o){const e=await a.fetchServiceMetadata(s);return!((e.layers?.length??0)>1)&&{}}await e.load();let d=await a.fetchItemData(e);if(i){const{data:r,preferredHost:t}=await y(d,s,a);c(e,t);const n=E(r);if(\"object\"==typeof n){const e=m(r,n.id);n.className=f(e?.layerType)}return n}\"Scene Service\"===o&&(d=await p(e,d,a));if(l(d)>0)return E(d);const L=await a.fetchServiceMetadata(s);return t&&(L.tables=await t()),E(L)}function E(e){return 1===l(e)&&{id:u(e)?.id}}export{L as fromItem,N as selectLayerClassPath};\n"],"names":["L","i","w","e","t","S","N","a","r","b","P","F","M","h","x","G","J","g","V","K","v","k","I","j","T","C","W","U","D","O","o","$","A","c","s","u","d","l","n","y","E","m","f","p"],"mappings":"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","x_google_ignoreList":[0]}