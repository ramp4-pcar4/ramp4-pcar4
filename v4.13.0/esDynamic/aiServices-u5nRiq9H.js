import{a as w,r as N}from"./enum-g1DWyQyu.js";import{r as Tt,i as xt,h as z,l as vt}from"./TimeOnly-CGkId3bj.js";import{S as Ct,c2 as G,dV as b,db as S,dX as d,dY as R,dZ as te,b$ as pe,dW as T,aX as Re,iY as Zt,dU as kt,bw as At,am as ye,al as ge,cr as be,T as Ft,gW as Ot,J as Dt,fQ as Jt,aW as Ie,B as Se,v as x,x as C,z as _e,a0 as Lt,s as Mt,i as jt,Z as Rt,aS as It}from"./main-BFDurRCu.js";import{t as J}from"./ImmutableArray-CiJxhY8_.js";import{y as Pt,P as Pe}from"./shared-DttuBH5Z.js";import{l as zt,p as qt}from"./number-mnL_JN3f.js";import{t as Yt}from"./commonProperties-D1Pjvz5u.js";import{a as Ut,f as Gt,s as Vt}from"./utils-BO8hgPs3.js";function ze(e){if(typeof e=="string")return e.toLowerCase();if("name"in e)return e.name.toLowerCase();if(typeof e.value!="string")throw new w(null,N.InvalidIdentifier,null);return e.value.toLowerCase()}const Bt=Object.freeze({aborted:!1});let ne=class{};class V{constructor(){}}function we(e,t,n){if(e instanceof V&&!(e instanceof re)){const r=new re;return r.fn=e,r.parameterEvaluator=n,r.context=t,r}return e}let Et=class extends V{constructor(e){super(),this.fn=e}createFunction(e){return(...t)=>this.fn(e,{preparsed:!0,arguments:t})}call(e,t){return this.fn(e,t)}marshalledCall(e,t,n,r){return r(e,t,(s,a,i)=>{i=i.map(u=>u instanceof V&&!(u instanceof re)?we(u,e,r):u);const o=this.call(n,{args:i});return Ct(o)?o.then(u=>we(u,n,r)):o})}},re=class extends V{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,t){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}marshalledCall(e,t,n){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}},B=class wt extends J{constructor(t,n,r,s,a,i){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=n,this._hasZ=r,this._hasM=s,this._cacheId=a,this._partId=i}get(t){if(this._lazyPt[t]===void 0){const n=this._elements[t];if(n===void 0)return;const r=new G(n[0],n[1],this._spRef);this._hasZ&&(r.z=n[2]),this._hasM&&(r.m=this._hasZ?n[3]:n[2]),r.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=r}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof wt&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}};class me extends J{constructor(t,n,r,s,a){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=n,this._cacheId=a}get(t){if(this._lazyPath[t]===void 0){const n=this._elements[t];if(n===void 0)return;this._lazyPath[t]=new B(n,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof me&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}let qe=class{constructor(e){this.value=e}};class Ye{constructor(t){this.value=t}}const _={type:"VOID"},Ue=Symbol("BREAK"),Ge=Symbol("CONTINUE");function E(e,t,n){return t===""||t==null||t===n||t===n?e:e=e.split(t).join(n)}function q(e){return e instanceof V}function Ne(e){return e instanceof ne}function Y(e){return!!d(e)||!!S(e)||!!c(e)||!!m(e)||!!p(e)||!!b(e)||e===null||e===_||typeof e=="number"}function Ve(e,t){return e===void 0?t:e}function Be(e){return e==null?"":T(e)||Z(e)?"Array":c(e)?"Date":p(e)?"Time":m(e)?"DateOnly":d(e)?"String":b(e)?"Boolean":S(e)?"Number":e?.declaredClass==="esri.arcade.Attachment"?"Attachment":e?.declaredClass==="esri.arcade.Portal"?"Portal":e?.declaredClass==="esri.arcade.Dictionary"?"Dictionary":le(e)?"KnowledgeGraph":e instanceof ne?"Module":H(e)?"Feature":e instanceof G?"Point":e instanceof ye?"Polygon":e instanceof ge?"Polyline":e instanceof be?"Multipoint":e instanceof pe?"Extent":q(e)?"Function":ae(e)?"FeatureSet":oe(e)?"FeatureSetCollection":se(e)?"Voxel":e===_?"":typeof e=="number"&&isNaN(e)?"Number":"Unrecognized Type"}function Ee(e){return e===_}function $(e){return e instanceof R}function H(e){return e?.arcadeDeclaredClass==="esri.arcade.Feature"}function se(e){return e?.arcadeDeclaredClass==="esri.arcade.Voxel"}function ae(e){return e?.declaredRootClass==="esri.arcade.featureset.support.FeatureSet"}function ie(e){return e?.declaredClass==="esri.arcade.Dictionary"}function He(e){return ie(e)||H(e)||se(e)}function oe(e){return e?.declaredRootClass==="esri.arcade.featureSetCollection"}function le(e){return e?.declaredClass==="esri.rest.knowledgeGraph.KnowledgeGraph"}function Z(e){return e instanceof J}function c(e){return e instanceof z}function m(e){return e instanceof xt}function p(e){return e instanceof Tt}function Te(e){return e!=null&&typeof e=="object"}function xe(e,t,n,r,s){if(e.length<t||e.length>n)throw new w(r,N.WrongNumberOfParameters,s)}function Ke(e){return e<0?-Math.round(-e):Math.round(e)}function ve(e,t){return isNaN(e)||t==null||t===""?e.toString():(t=E(t,"\u2030",""),t=E(t,"\xA4",""),zt(e,{pattern:t}))}function ue(e,t){return t==null||t===""?e.toISOString(!0):e.toFormat(Ce(t),{locale:Re(),numberingSystem:"latn"})}function Ce(e,t=!1){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const s of e.match(r)||[])switch(s){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=s;break;default:s.length>=2&&s.slice(0,1)==="["&&s.slice(-1)==="]"?n+=`'${s.slice(1,-1)}'`:n+=`'${s}'`}return n}function l(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function $e(e,t,n){if(e===null){if(t===null||t===_)return l(null,null,n);if(S(t))return l(0,t,n);if(d(t)||b(t))return l(0,y(t),n);if(c(t))return l(0,t.toNumber(),n);if(p(t)||m(t))return l(e,t.toNumber(),n)}if(e===_){if(t===null||t===_)return l(null,null,n);if(S(t))return l(0,t,n);if(d(t)||b(t))return l(0,y(t),n);if(c(t))return l(0,t.toNumber(),n);if(p(t)||m(t))return l(e,t.toNumber(),n)}else if(S(e)){if(S(t))return l(e,t,n);if(b(t))return l(e,y(t),n);if(t===null||t===_)return l(e,0,n);if(d(t))return l(e,y(t),n);if(c(t)||p(t)||m(t))return l(e,t.toNumber(),n)}else if(d(e)){if(d(t))return l(O(e),O(t),n);if(c(t)||p(t)||m(t))return l(y(e),t.toNumber(),n);if(S(t))return l(y(e),t,n);if(t===null||t===_)return l(y(e),0,n);if(b(t))return l(y(e),y(t),n)}else if(c(e)){if(c(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=z.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=z.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),l(e.toNumber(),t.toNumber(),n);if(t===null||t===_)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||d(t))return l(e.toNumber(),y(t),n);if(p(t))throw new w(null,N.CannotCompareDateAndTime,null);if(m(t))return l(e.toNumber(),t.toNumber(),n)}else if(b(e)){if(b(t))return l(e,t,n);if(S(t))return l(y(e),y(t),n);if(c(t)||p(t)||m(t))return l(y(e),t.toNumber(),n);if(t===null||t===_)return l(y(e),0,n);if(d(t))return l(y(e),y(t),n)}else if(m(e)){if(c(t))return l(e.toNumber(),t.toNumber(),n);if(t===null||t===_)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||d(t))return l(e.toNumber(),y(t),n);if(p(t))throw new w(null,N.CannotCompareDateAndTime,null);if(m(t))return l(e.toNumber(),t.toNumber(),n)}else if(p(e)){if(c(t))throw new w(null,N.CannotCompareDateAndTime,null);if(t===null||t===_)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||d(t))return l(e.toNumber(),y(t),n);if(p(t))return l(e.toNumber(),t.toNumber(),n);if(m(t))throw new w(null,N.CannotCompareDateAndTime,null)}return!!Ze(e,t)&&(n==="<="||n===">=")}function Ze(e,t){if(e===t||e===null&&t===_||t===null&&e===_)return!0;if(c(e)&&c(t)||p(e)&&p(t)||m(e)&&m(t))return e.equals(t);if(e instanceof me||e instanceof B)return e.equalityTest(t);if(e instanceof G&&t instanceof G){const n=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(n!=null)return n===r}return!!(Te(e)&&Te(t)&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null))}function ke(e,{useNumbersForDates:t}){let n="";for(const r in e){n!==""&&(n+=",");const s=e[r];s==null?n+=JSON.stringify(r)+":null":b(s)||S(s)||d(s)?n+=JSON.stringify(r)+":"+JSON.stringify(s):$(s)?n+=JSON.stringify(r)+":"+W(s):p(s)||m(s)?n+=`${JSON.stringify(r)}:${JSON.stringify(s.toString())}`:Z(s)||Array.isArray(s)?n+=JSON.stringify(r)+":"+W(s,null,t):c(s)?n+=t?JSON.stringify(r)+":"+JSON.stringify(s.getTime()):JSON.stringify(r)+":"+s.stringify():s!==null&&typeof s=="object"&&"castToText"in s&&(n+=JSON.stringify(r)+":"+s.castToText(t))}return"{"+n+"}"}function O(e,t){if(d(e))return e;if(e===null)return"";if(S(e))return ve(e,t);if(b(e))return e.toString();if(c(e))return ue(e,t);if(p(e)||m(e))return e.toFormat(t);if(e instanceof R)return JSON.stringify(e.toJSON());if(T(e)){const n=[];for(let r=0;r<e.length;r++)n[r]=ce(e[r]);return"["+n.join(",")+"]"}if(e instanceof J){const n=[];for(let r=0;r<e.length();r++)n[r]=ce(e.get(r));return"["+n.join(",")+"]"}return e!==null&&typeof e=="object"&&"castToText"in e?e.castToText():q(e)?"object, Function":e===_?"":Ne(e)?"object, Module":""}function We(e){const t=[];if(e instanceof J){for(let n=0;n<e.length();n++)t[n]=y(e.get(n));return t}if(!T(e))return null;for(let n=0;n<e.length;n++)t[n]=y(e[n]);return t}function W(e,t,n=!1){if(d(e))return e;if(e===null)return"";if(S(e))return ve(e,t);if(b(e))return e.toString();if(c(e))return ue(e,t);if(p(e)||m(e))return e.toFormat(t);if(e instanceof R)return e instanceof pe?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+Oe(e.spatialReference)+"}":Oe(e.toJSON(),(r,s)=>r.key===s.key?0:r.key==="spatialReference"?1:s.key==="spatialReference"||r.key<s.key?-1:r.key>s.key?1:0);if(T(e)){const r=[];for(let s=0;s<e.length;s++)r[s]=ce(e[s],n);return"["+r.join(",")+"]"}if(e instanceof J){const r=[];for(let s=0;s<e.length();s++)r[s]=ce(e.get(s),n);return"["+r.join(",")+"]"}return e!==null&&typeof e=="object"&&"castToText"in e?e.castToText(n):q(e)?"object, Function":e===_?"":Ne(e)?"object, Module":""}function ce(e,t=!1){if(e===null)return"null";if(b(e)||S(e)||d(e))return JSON.stringify(e);if(e instanceof R||e instanceof J||Array.isArray(e))return W(e,null,t);if(c(e))return JSON.stringify(t?e.getTime():ue(e,""));if(p(e)||m(e))return JSON.stringify(e.toString());if(e!==null&&typeof e=="object"){if("castToText"in e)return e.castToText(t)}else if(e===_)return"null";return"null"}function y(e,t){return S(e)?e:e===null||e===""?0:c(e)||m(e)||p(e)?NaN:b(e)?e?1:0:T(e)||e===""||e===void 0?NaN:t!==void 0&&d(e)?(t=E(t,"\u2030",""),t=E(t,"\xA4",""),qt(e,{pattern:t})):e===_?0:Number(e)}function Xe(e,t){if(c(e))return e;if(d(e)){const n=Ht(e,t);if(n)return z.dateTimeToArcadeDate(n)}return null}function Ht(e,t){const n=/ (\d\d)/,r=vt(t);let s=Ie.fromISO(e,{zone:r});return s.isValid||n.test(e)&&(e=e.replace(n,"T$1"),s=Ie.fromISO(e,{zone:t}),s.isValid)?s:null}function Qe(e){return b(e)?e:d(e)?(e=e.toLowerCase())==="true":!!S(e)&&e!==0&&!isNaN(e)}function Kt(e,t){const n=JSON.parse(e);return n&&!n.spatialReference&&(n.spatialReference=t),At(n)}function et(e,t){return e==null?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function tt(e){if(e===null)return null;if(e instanceof G)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof ye){if((e.curveRings??e.rings).length===0)return null;for(const t of e.curveRings??e.rings)if(t.length>0)return e;return null}if(e instanceof ge){if((e.curvePaths??e.paths).length===0)return null;for(const t of e.curvePaths??e.paths)if(t.length>0)return e;return null}return e instanceof be?e.points.length===0?null:e:e instanceof pe?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function Ae(e,t){if(!e||!e.domain)return t;let n=null,r=null;if(c(t))n=t.toNumber();else if(m(t))n=t.toString();else if(p(t))n=t.toStorageString();else if(e.field.type==="string"||e.field.type==="esriFieldTypeString")n=O(t);else{if(t==null)return null;if(t==="")return t;n=y(t)}for(let s=0;s<e.domain.codedValues.length;s++){const a=e.domain.codedValues[s];a.code===n&&(r=a)}return r===null?O(t):r.name}function Fe(e,t){if(!e||!e.domain)return t;let n=null;const r=O(t);for(let s=0;s<e.domain.codedValues.length;s++){const a=e.domain.codedValues[s];a.name===r&&(n=a)}return n===null?t:n.code}function X(e,t,n=null,r=null){if(!t||!t.fields)return null;let s,a,i=null;for(let f=0;f<t.fields.length;f++){const g=t.fields[f];g.name.toLowerCase()===e.toString().toLowerCase()&&(i=g)}if(i===null)throw new w(null,N.FieldNotFound,null,{key:e});let o=t.typeIdField,u="id",h=t.types;if(t.subtypeField&&(o=t.subtypeField,u="code",h=t.subtypes??[]),r===null&&n&&o)r=n.hasField(o)?n.field(o):null;else if(o&&r!==null){let f=!1;for(const g of h||[])if(r===g[u]){f=!0;break}if(!f){for(const g of h||[])if(r===g.name){r=g[u],f=!0;break}}f||(r=null,n&&o&&(r=n.hasField(o)?n.field(o):null))}return r!=null&&h.some(f=>f[u]===r&&(s=f.domains?.[i.name],s&&s.type==="inherited"&&(s=nt(i.name,t),a=!0),!0)),a||s||(s=nt(e,t)),{field:i,domain:s}}function nt(e,t){let n;return t.fields.some(r=>(r.name.toLowerCase()===e.toLowerCase()&&(n=r.domain),!!n)),n}function Oe(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const n=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(i){return function(o,u){const h={key:o,value:i[o]},f={key:u,value:i[u]};return s(h,f)}});var s;const a=[];return function i(o){if(o?.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);let u,h;if(Array.isArray(o)){for(h="[",u=0;u<o.length;u++)u&&(h+=","),h+=i(o[u])||"null";return h+"]"}if(o===null)return"null";if(a.includes(o)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const f=a.push(o)-1,g=Object.keys(o).sort(r?.(o));for(h="",u=0;u<g.length;u++){const D=g[u],v=i(o[D]);v&&(h&&(h+=","),h+=JSON.stringify(D)+":"+v)}return a.splice(f,1),"{"+h+"}"}(e)}function rt(e){if(e===null)return null;const t=[];for(const n of e)H(n)?t.push(n.geometry()):t.push(n);return t}function K(e,t){if(!(t instanceof G))throw new w(null,N.InvalidParameter,null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function st(e,t){if(T(e)||Z(e)){let n=!1,r=!1,s=[],a=t;if(T(e)){for(const i of e)K(s,i);s.length>0&&(a=e[0].spatialReference,n=e[0].hasZ,r=e[0].hasM)}else if(e instanceof B)s=e._elements,s.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else{if(!Z(e))throw new w(null,N.InvalidParameter,null);for(const i of e.toArray())K(s,i);s.length>0&&(a=e.get(0).spatialReference,n=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(Jt(s)||(s=s.slice().reverse()),new ye({rings:[s],spatialReference:a,hasZ:n,hasM:r}))}return e}function at(e,t){if(T(e)||Z(e)){let n=!1,r=!1,s=[],a=t;if(T(e)){for(const i of e)K(s,i);s.length>0&&(a=e[0].spatialReference,n=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof B)s=e._elements,s.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(Z(e)){for(const i of e.toArray())K(s,i);s.length>0&&(a=e.get(0).spatialReference,n=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new ge({paths:[s],spatialReference:a,hasZ:n,hasM:r})}return e}function it(e,t){if(T(e)||Z(e)){let n=!1,r=!1,s=[],a=t;if(T(e)){for(const i of e)K(s,i);s.length>0&&(a=e[0].spatialReference,n=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof B)s=e._elements,s.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(Z(e)){for(const i of e.toArray())K(s,i);s.length>0&&(a=e.get(0).spatialReference,n=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new be({points:s,spatialReference:a,hasZ:n,hasM:r})}return e}function fe(e,t=!0){if(e==null)return[];if(T(e)){const n=[];for(const r of e){const s=O(r);(t||s!=="")&&n.push(s)}return n}if(Z(e)){const n=[];for(let r=0;r<e.length();r++){const s=O(e.get(r));(t||s!=="")&&n.push(s)}return n}if(Y(e)){const n=O(e);if(t||n!=="")return[n]}return[]}let De=0;function ot(e){return De++,De%100==0?(De=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function lt(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function I(e,t=null){return e==null?null:b(e)||S(e)||d(e)?e:e instanceof R?t?.keepGeometryType===!0?e:e.toJSON():e instanceof J?e.toArray().map(n=>I(n,t)):Array.isArray(e)?e.map(n=>I(n,t)):te(e)?e:c(e)?e.toJSDate():p(e)?e.toString():m(e)?e.toJSDate():e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function $t(e,t,n,r,s){const a=await Je(e,t,n);s[r]=a}async function Je(e,t=null,n=null){if(e instanceof J&&(e=e.toArray()),e==null)return null;if(Y(e)||e instanceof R||te(e)||c(e))return I(e,n);if(Array.isArray(e)){const r=[],s=[];for(const a of e)a===null||Y(a)||a instanceof R||te(a)||c(a)?s.push(I(a,n)):(s.push(null),r.push($t(a,t,n,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,n):null}function Q(e){return Le(e)?e.parent:e}function Le(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.support.SubtypeSublayer"}function Wt(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.SubtypeGroupLayer"}function ut(e,t,n){const r=Q(e.fullSchema());return r===null||!r.fields?null:X(t,r,e,n)}function ct(e){const t=Q(e.fullSchema());return t===null?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map(n=>({name:n.name,code:n.code})):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(n=>({name:n.name,code:n.id})):[]}:null:null}function ft(e,t,n,r){const s=Q(e.fullSchema());if(s===null||!s.fields)return null;const a=X(t,s,e,r);if(n===void 0)try{n=e.field(t)}catch{return null}return Ae(a,n)}function ht(e,t,n,r){const s=Q(e.fullSchema());if(s===null||!s.fields)return null;if(n===void 0){try{n=e.field(t)}catch{return null}return n}return Fe(X(t,s,e,r),n)}function dt(e){return e?.timeZone??"system"}function mt(e){const t=Q(e.fullSchema());if(t===null||!t.fields)return null;const n=[];for(const r of t.fields)n.push(Pt(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:Pe[t.geometryType]===void 0?"":Pe[t.geometryType],fields:n}}function pt(e,t){const n=z.systemTimeZoneCanonicalName;return e==="system"&&(e=n),{version:yt,engineVersion:Ot,timeZone:e,userTimeZone:n,spatialReference:t instanceof Dt?t.toJSON():t,application:Ft.applicationName??"",engine:"web",locale:Re()}}const yt="1.32",Xt=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Ye,ReturnResult:qe,absRound:Ke,arcadeVersion:yt,autoCastArrayOfPointsToMultiPoint:it,autoCastArrayOfPointsToPolygon:st,autoCastArrayOfPointsToPolyline:at,autoCastFeatureToGeometry:rt,binaryOperator:lt,breakResult:Ue,castAsJson:I,castAsJsonAsync:Je,castRecordToText:ke,continueResult:Ge,defaultExecutingContext:pt,defaultTimeZone:dt,defaultUndefined:Ve,equalityTest:Ze,featureDomainCodeLookup:ht,featureDomainValueLookup:ft,featureFullDomain:ut,featureSchema:mt,featureSubtypes:ct,fixNullGeometry:tt,fixSpatialReference:et,formatDate:ue,formatNumber:ve,getDomain:X,getDomainCode:Fe,getDomainValue:Ae,getType:Be,greaterThanLessThan:$e,isArray:T,isBoolean:b,isDate:c,isDateOnly:m,isDictionary:ie,isDictionaryLike:He,isFeature:H,isFeatureSet:ae,isFeatureSetCollection:oe,isFunctionParameter:q,isGeometry:$,isGraphic:kt,isImmutableArray:Z,isInteger:Zt,isJsDate:te,isKnowledgeGraph:le,isModule:Ne,isNumber:S,isObject:Te,isSimpleType:Y,isString:d,isSubtypeGrouplayer:Wt,isSubtypeSublayer:Le,isTime:p,isVoid:Ee,isVoxel:se,multiReplace:E,parseGeometryFromJson:Kt,pcCheck:xe,stableStringify:Oe,standardiseDateFormat:Ce,tick:ot,toBoolean:Qe,toDate:Xe,toNumber:y,toNumberArray:We,toString:O,toStringArray:fe,toStringExplicit:W,voidOperation:_},Symbol.toStringTag,{value:"Module"}));function Qt(e){gt=e}let gt;function he(e){return e===null?null:c(e)?e.clone():Y(e)?e:$(e)?e.clone():Z(e)?e.toArray().map(t=>he(t)):T(e)?e.map(t=>he(t)):H(e)?gt.createFromArcadeFeature(e):oe(e)||ae(e)?e:ie(e)||e?.declaredClass==="esri.arcade.Attachment"?e.deepClone():(e?.declaredClass==="esri.arcade.Portal"||le(e)||e instanceof ne||q(e),e)}function de(e,t,n=!1,r=!1){if(e==null)return null;if(S(e)||b(e)||d(e)||c(e)||m(e)||p(e))return e;if(T(e)){const a=[];for(const i of e)a.push(de(i,t,n,r));return a}if(r&&$(e))return e;const s=new F;s.immutable=!1;for(const[a,i]of Object.entries(e))i!==void 0&&s.setField(a,de(i,t,n,r));return s.immutable=n,s}class F{constructor(t){this.declaredClass="esri.arcade.Dictionary",this.plain=!1,this.immutable=!0,t instanceof F?this.attributes=t.attributes:t==null?this.attributes=Object.create(null):Object.getPrototypeOf(t)!=null?this.attributes={__proto__:null,...t}:this.attributes=t}static containerEntry(t,n){return new F({__proto__:null,key:t,value:n})}static textFormatting(){const t=new F({__proto__:null,newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});return t.immutable=!1,t}field(t){const n=t.toLowerCase(),r=this.attributes[t];if(r!==void 0)return r;for(const s in this.attributes)if(s.toLowerCase()===n)return this.attributes[s];throw new w(null,N.FieldNotFound,null,{key:t})}setField(t,n){if(this.immutable)throw new w(null,N.Immutable,null);if(q(n))throw new w(null,N.NoFunctionInDictionary,null);const r=t.toLowerCase();if(n instanceof Date&&(n=z.dateJSToArcadeDate(n)),this.attributes[t]===void 0){for(const s in this.attributes)if(s.toLowerCase()===r)return void(this.attributes[s]=n);this.attributes[t]=n}else this.attributes[t]=n}hasField(t){const n=t.toLowerCase();if(this.attributes[t]!==void 0)return!0;for(const r in this.attributes)if(r.toLowerCase()===n)return!0;return!1}keys(){let t=[];for(const n in this.attributes)t.push(n);return t=t.sort(),t}castToText(t=!1){return ke(this.attributes,{useNumbersForDates:t})}static convertObjectToArcadeDictionary(t,n,r=!0,s=!1){const a=new F;a.immutable=!1;for(const i in t){const o=t[i];o!==void 0&&a.setField(i.toString(),de(o,n,r,s))}return a.immutable=r,a}static convertJsonToArcade(t,n,r=!1,s=!1){return de(t,n,r,s)}castAsJson(t=null){const n=Object.create(null);for(let r in this.attributes){const s=this.attributes[r];s!==void 0&&(t?.keyTranslate&&(r=t.keyTranslate(r)),n[r]=I(s,t))}return n}async castDictionaryValueAsJsonAsync(t,n,r,s=null,a){const i=await Je(r,s,a);return t[n]=i,i}async castAsJsonAsync(t=null,n=null){const r=Object.create(null),s=[];for(let a in this.attributes){const i=this.attributes[a];n?.keyTranslate&&(a=n.keyTranslate(a)),i!==void 0&&(Y(i)||i instanceof R||i instanceof z?r[a]=I(i,n):s.push(this.castDictionaryValueAsJsonAsync(r,a,i,t,n)))}return s.length>0&&await Promise.all(s),r}deepClone(){const t=new F;t.immutable=!1;for(const n of this.keys())t.setField(n,he(this.field(n)));return t}}let L=class extends Se{constructor(e){super(e),this.text=null,this.detectedLanguage="en",this.detectedLanguageScore=-1}};x([C({type:String,json:{write:!0}})],L.prototype,"key",void 0),x([C({type:String,json:{write:!0}})],L.prototype,"text",void 0),x([C({type:String,json:{read:{source:"detectedLanguage.language"},write:{target:"detectedLanguage.language"}}})],L.prototype,"detectedLanguage",void 0),x([C({type:Number,json:{read:{source:"detectedLanguage.score"},write:{target:"detectedLanguage.score"}}})],L.prototype,"detectedLanguageScore",void 0),x([C({type:Object,json:{write:!0}})],L.prototype,"translation",void 0),L=x([_e("esri.rest.support.TranslateResult")],L);async function en(e,t,n){const r=t.toJSON();r.contents=JSON.stringify(r.contents),r.token=await Ut(t.portalUrl,t.apiKey,{signal:n?.signal,prompt:n?.authMode!=="no-prompt"});const s=Gt(e),a=Vt(s.query,{...n,query:r,method:"post",authMode:"anonymous"});return(await Lt(s.path,a)).data.results.map(i=>L.fromJSON(i))}let U=class extends Se{constructor(e){super(e)}};x([C({type:String,json:{write:!0}})],U.prototype,"key",void 0),x([C({type:String,json:{write:!0}})],U.prototype,"text",void 0),U=x([_e("esri.rest.support.TranslateContent")],U);let A=class extends Se{constructor(e){super(e),this.to=null,this.contents=null,this.portalUrl="https://www.arcgis.com",this.translator="esri",this.from=null,this.apiKey=null,this.requestSource=null}};x([C({type:[String],json:{write:!0}})],A.prototype,"to",void 0),x([C({type:[U],json:{write:!0}})],A.prototype,"contents",void 0),x([C({type:String,json:{write:!0}})],A.prototype,"portalUrl",void 0),x([C({type:String,json:{write:!0,default:"esri"}})],A.prototype,"translator",void 0),x([C({type:String,json:{write:!0}})],A.prototype,"from",void 0),x([C(Yt)],A.prototype,"apiKey",void 0),x([C({type:String,json:{name:"x-esri-request-source"}})],A.prototype,"requestSource",void 0),A=x([_e("esri.rest.support.TranslateParameters")],A);class Me{constructor(t,n){this.portal=t,this._debugLog=n}async translate(t){this.portal.loaded||await this.portal.load();const n=this.portal.helperServices?.aiUtilityServices;if(n==null)return{success:!1};const r=n.url+n.translateUtility;try{return t.requestSource??="arcade",{success:!0,results:(await en(r,t,{authMode:"no-prompt"})).map(s=>s.toJSON())}}catch(s){return this._debugLog!=null&&(s instanceof Error||s instanceof Mt)&&this._debugLog(`TranslateText error: ${s.message}`),jt.getLogger("esri.arcade.functions.aiServices").error(s),{success:!1}}}}class tn{constructor(t,n,r){this._parameters=t,this._maxTotalContentSize=n,this._maxContentsLength=r,this._requests=[],this._normalizedContents=new Map,this._contentsTotalSize=0}tryAdd(t){const n=new Set(t.filter(a=>!this._normalizedContents.has(a.text)).map(a=>a.text));if(this._requests.length+n.size>this._maxContentsLength)return null;let r=0;for(const a of n)r+=a.length;if((r+this._contentsTotalSize)*(this._parameters.to.length??1)>this._maxTotalContentSize)return null;const s=this._requests.length;for(const{key:a,text:i}of t)It(this._normalizedContents,i,()=>[]).push({batchIdx:s,key:a});return this._requests.push(t),this._contentsTotalSize+=r,s}async send(t){const n=[],r=[];let s=0;for(const[u,h]of this._normalizedContents)n.push(new U({key:String(s++),text:u})),r.push(h);const a=new A(this._parameters);a.contents=n;const i=await t.translate(a);if(!i.success)return Array.from(this._requests,()=>i);const o=Array.from(this._requests,()=>({success:!0,results:[]}));for(const u of i.results){const h=Number(u.key);for(const f of r[h])o[f.batchIdx].results.push({...u,key:f.key})}return o}}function ee(e){const t=[...new Set(e.to)].sort(),n=e.from??null,r=e.portalUrl,s=e.translator,a=e.apiKey??null;return JSON.stringify([t,n,r,s,a])}async function bt(e,t,n){try{return(await e.yieldFor(n))[t]}catch{return{success:!1}}}class St{constructor(t,n,{maxTotalContentSize:r=5e4,maxContentsLength:s=1e3}={}){this._executor=t,this._service=n,this._openBatches=new Map,this._maxTotalContentSize=r,this._maxContentsLength=s}create(t){return{translate:async n=>{const r=ee(n),{contents:s,to:a,from:i,translator:o,portalUrl:u,apiKey:h}=n;if(a==null)return{success:!1};if(s==null||s.every(v=>v.text.length===0))return{success:!1};const f=this._openBatches.get(r);if(f!=null){const v=f.data.tryAdd(s);if(v!=null)return await bt(t,v,f);f.send()}const g=new tn({to:a,from:i,translator:o,portalUrl:u,apiKey:h},this._maxTotalContentSize,this._maxContentsLength),D=g.tryAdd(s);if(D!=null){const v=this._executor.openBatch(g,{open:P=>{this._openBatches.set(r,P)},execute:P=>P.send(this._service),close:P=>{this._openBatches.get(r)===P&&this._openBatches.delete(r)}});return await bt(t,D,v)}return await this._service.translate(n)}}}}function _t(e){e.mode==="async"&&(e.functions[ze("TranslateText")]=function(t,n){return e.standardFunctionAsync(t,n,async(r,s,a)=>{if(xe(a,2,3,r,s),!d(a[0])&&!T(a[0])&&!Z(a[0]))throw new w(r,N.InvalidParameter,s);const i=fe(a[0]);if(!d(a[1])&&!T(a[1])&&!Z(a[1]))throw new w(r,N.InvalidParameter,s);const o=fe(a[1]);let u=null;if(a.length>=3){if(!d(a[2]))throw new w(r,N.InvalidParameter,s);u=a[2]}const h=i.map((M,k)=>new U({key:String(k),text:M})),f=r.services?.portal??Rt.getDefault(),g=new A({to:o,contents:h,from:u,portalUrl:f.restUrl.replace(/\/sharing\/rest$/,"")}),D=new Map;let v=null;if(r.lrucache!=null){const M=r.lrucache;v??=ee(g),g.contents=g.contents?.filter(k=>{const j=M.getCachedTranslation(v,k.text);return j==null||(D.set(k.key,{...j,key:k.key,text:k.text}),!1)})}if(g.contents?.length){const M=r.services?.translation??new Me(f,r.console),k=await M.translate(g);if(!k.success)return new F({__proto__:null,success:!1});for(const j of k.results){const je=g.contents?.find(Nt=>Nt.key===j.key)?.text;if(je==null)throw new w(null,N.NeverReach,null);D.set(j.key,j),r.lrucache!=null&&(v??=ee(g),r.lrucache.setCachedTranslation(v,je,{detectedLanguage:j.detectedLanguage,translation:j.translation}))}}const P=Array.from(h,M=>{const k=L.fromJSON(D.get(M.key));if(k==null)throw new w(null,N.NeverReach,null);return k.text=M.text,F.convertJsonToArcade(k.toJSON(),r.timeZone??"system",!0)});return new F({__proto__:null,success:!0,results:P})})})}const nn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:St,PortalTranslationService:Me,getTranslateParametersKey:ee,registerFunctions:_t},Symbol.toStringTag,{value:"Module"})),rn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:St,PortalTranslationService:Me,getTranslateParametersKey:ee,registerFunctions:_t},Symbol.toStringTag,{value:"Module"}));export{H as $,p as A,ht as B,X as C,Ae as D,ie as E,ke as F,q as G,$ as H,_ as I,et as J,ae as K,it as L,st as M,y as N,Fe as O,Ue as P,He as Q,at as R,Xe as S,Qe as T,Ee as U,fe as V,mt as W,oe as X,Ge as Y,E as Z,Ye as _,xe as a,ot as a0,Le as a1,B as a2,me as a3,Y as a4,I as a5,Qt as a6,he as a7,Be as a8,Ce as a9,Ke as aa,tt as ab,se as ac,We as ad,pt as ae,Xt as af,rn as ag,Z as b,lt as c,Ze as d,Et as e,we as f,ne as g,nn as h,dt as i,F as j,ut as k,ct as l,$e as m,Bt as n,ft as o,O as p,Ve as q,V as r,re as s,ze as t,W as u,qe as v,rt as w,le as x,c as y,m as z};
