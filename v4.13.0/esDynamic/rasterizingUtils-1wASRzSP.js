import{o as I}from"./floatRGBA-DRFmbkvz.js";import{fE as z,i as L}from"./main-BFDurRCu.js";import{n as C}from"./defaultCIMValues-BcSaJjm-.js";import{c as R}from"./definitions-MCCItX4r.js";const U=15.5,M=4,b=64,$=1024,E={outlineWidth:.75,referenceWidth:.75,cap:C.CIMSolidStroke.capstyle,join:C.CIMSolidStroke.joinstyle,miterLimit:C.CIMSolidStroke.miterlimit},N=()=>L.getLogger("esri.symbols.cim.rasterizingUtils"),P=32,q=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function G(t,l,a){const r=l.style,n=z(Math.ceil(a)),o=q(r)?8*n:16*n,e=2*n;t.width=o,t.height=o;const i=t.getContext("2d");i.strokeStyle="#ffffff",i.lineWidth=n,i.beginPath(),r!=="vertical"&&r!=="cross"&&r!=="esriSFSCross"&&r!=="esriSFSVertical"||(i.moveTo(o/2,-e),i.lineTo(o/2,o+e)),r!=="horizontal"&&r!=="cross"&&r!=="esriSFSCross"&&r!=="esriSFSHorizontal"||(i.moveTo(-e,o/2),i.lineTo(o+e,o/2)),r!=="backward-diagonal"&&r!=="diagonal-cross"&&r!=="esriSFSDiagonalCross"&&r!=="esriSFSBackwardDiagonal"||(i.moveTo(-e,-e),i.lineTo(o+e,o+e),i.moveTo(o-e,-e),i.lineTo(o+e,e),i.moveTo(-e,o-e),i.lineTo(e,o+e)),r!=="forward-diagonal"&&r!=="diagonal-cross"&&r!=="esriSFSForwardDiagonal"&&r!=="esriSFSDiagonalCross"||(i.moveTo(o+e,-e),i.lineTo(-e,o+e),i.moveTo(e,-e),i.lineTo(-e,e),i.moveTo(o+e,o-e),i.lineTo(o-e,o+e)),i.stroke();const h=i.getImageData(0,0,t.width,t.height),s=new Uint8Array(h.data);let f;for(let c=0;c<s.length;c+=4)f=s[c+3]/255,s[c]=s[c]*f,s[c+1]=s[c+1]*f,s[c+2]=s[c+2]*f;return[s,t.width,t.height,n]}function V(t){t.length%2==1&&(t=[...t,...t]);const l=t.reduce((c,u)=>c+u,0),a=Math.round(l*M),r=1,n=new Float32Array(a*r);let o=0,e=0,i=.5,h=!0;for(const c of t){for(o=e,e+=c*M;i<=e;){const u=i-.5,m=Math.min(Math.abs(i-o),Math.abs(i-e));n[u]=h?-m:m,i++}h=!h}const s=n.length,f=new Uint8Array(4*s);for(let c=0;c<s;++c){const u=n[c]/M;I(u/b*.5+.5,f,4*c)}return[f,a,r]}function W(t,l){t==null&&(t=[]);const a=l==="Butt",r=l==="Square",n=!a&&!r;t.length%2==1&&(t=[...t,...t]);const o=U,e=2*o;let i=0;for(const g of t)i+=g;const h=Math.round(i*o),s=new Float32Array(h*e),f=.5*o;let c=0,u=0,m=.5,x=!0;for(const g of t){for(c=u,u+=g*o;m<=u;){let p=.5;for(;p<e;){const A=(p-.5)*h+m-.5,d=n?(p-o)*(p-o):Math.abs(p-o);s[A]=x?a?Math.max(Math.max(c+f-m,d),Math.max(m-u+f,d)):d:n?Math.min((m-c)*(m-c)+d,(m-u)*(m-u)+d):r?Math.min(Math.max(m-c,d),Math.max(u-m,d)):Math.min(Math.max(m-c+f,d),Math.max(u+f-m,d)),p++}m++}x=!x}const T=s.length,v=new Uint8Array(4*T);for(let g=0;g<T;++g){const p=(n?Math.sqrt(s[g]):s[g])/o;I(p,v,4*g)}return[v,h,e]}function j(t,l){const{colorRamp:a,gradientType:r}=l,n=a.type==="CIMFixedColorRamp",o=l.interval||C.CIMGradientFill.interval;let e=w(a);return n&&(e=k(e,o)),r==="Discrete"||n?O(t,e,o):H(t,e)}let y;function B(t,l){const{colorRamp:a,gradientType:r}=l,n=w(a),o=a.type==="CIMFixedColorRamp";if(r==="Continuous"&&!o)return S(t,n);const e=l.interval??C.CIMGradientFill.interval;if(o)return S(t,k(n,e));const i=[];y??=document.createElement("canvas"),F(y,n,e,1,0);const h=y.getContext("2d").getImageData(0,0,e,1).data;for(let s=0,f=0;s<e;s++,f=4*s){const c=[h[f+0],h[f+1],h[f+2],h[f+3]];i.push({offset:s/e,color:c}),i.push({offset:(s+1)/e,color:c})}return S(t,i)}function w(t){const l=[];switch(t.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{t.type==="CIMPolarContinuousColorRamp"&&N().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const a=t;l.push({offset:0,color:[a.fromColor[0],a.fromColor[1],a.fromColor[2],a.fromColor[3]/255]}),l.push({offset:1,color:[a.toColor[0],a.toColor[1],a.toColor[2],a.toColor[3]/255]});break}case"CIMFixedColorRamp":{const a=t,r=1/(a.colors.length-1);let n=0;for(const o of a.colors)l.push({offset:n,color:[o[0],o[1],o[2],o[3]/255]}),n+=r;break}case"CIMMultipartColorRamp":{const a=t,r=a.weights.reduce((o,e)=>o+e,0);let n=0;for(let o=0;o<a.colorRamps.length;o++){const e=a.colorRamps[o],i=a.weights[o],h=w(e);for(const s of h)l.push({offset:(n+s.offset*i)/r,color:s.color});n+=i}break}default:N().error(`Color ramp "${t.type}" currently unsupported.`)}return l}function k(t,l){const a=[],r=(t.length-1)/(l-1);for(let n=0;n<l;n++){const o=t[Math.round(n*r)].color;a.push({offset:n/l,color:o}),a.push({offset:(n+1)/l,color:o})}return a}function H(t,l){return F(t,l,P,1,R),D(t)}function O(t,l,a){return F(t,l,a,1,R),D(t)}function S(t,l,a=0){for(const{offset:r,color:n}of l)t.addColorStop(Math.min(Math.max(r,a),1-a),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`)}function F(t,l,a,r,n){const o=a+2*n;t.width=o,t.height=r;const e=(n+1)/o,i=t.getContext("2d",{willReadFrequently:!0});if(l.length>0){const h=i.createLinearGradient(0,0,o,r);S(h,l,e),i.fillStyle=h}else i.fillStyle="rgba(128, 128, 128, 1)";i.fillRect(0,0,o,r)}function D(t){const{width:l,height:a}=t,r=t.getContext("2d").getImageData(0,0,l,a),n=new Uint8Array(r.data);for(let o=0;o<n.length;o+=4){const e=n[o+3]/255;n[o]*=e,n[o+1]*=e,n[o+2]*=e}return[n,l,a]}function J(t){const l=t[0]?.[0]?.[0]??0,a=t[0]?.[0]?.[1]??0,r={ymin:a,xmin:l,ymax:a,xmax:l,width:0,height:0};for(let n=0;n<t.length;n++){const o=t[n];for(let e=0;e<o.length;e++){const i=o[e][0],h=o[e][1];i<r.xmin&&(r.xmin=i),i>r.xmax&&(r.xmax=i),h<r.ymin&&(r.ymin=h),h>r.ymax&&(r.ymax=h)}}return r.width=Math.abs(r.xmax-r.xmin),r.height=Math.abs(r.ymax-r.ymin),r}function K(t,l){const a=J(t),r=a.width===0?1:a.width,n=a.height===0?1:a.height,o=[];for(let e=0;e<t.length;e++){const i=t[e],h=[];for(let s=0;s<i.length;s++){let f=Math.round(i[s][0]-a.xmin),c=Math.round(i[s][1]-a.ymin);if(f=l.xmin+f*l.width/r,c=l.ymin+c*l.height/n,isNaN(f)||isNaN(c))throw new Error("Scaled shape has NaN values");h.push([f,c])}o.push(h)}return o}function Q(t,l,a){const r=[];for(let n=0;n<t.length;n++){const o=t[n],e=[];for(let i=0;i<o.length;i++){const h=o[i][0]+l,s=o[i][1]+a;if(isNaN(h)||isNaN(s))throw new Error("Scaled shape has NaN values");e.push([h,s])}r.push(e)}return r}export{Q as R,K as T,G as f,j as g,M as i,E as l,V as m,b as o,B as p,$ as r,W as u};
