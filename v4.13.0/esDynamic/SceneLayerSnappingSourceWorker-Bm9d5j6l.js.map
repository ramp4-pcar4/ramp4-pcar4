{"version":3,"file":"SceneLayerSnappingSourceWorker-Bm9d5j6l.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{b as s,j as o,f as r}from\"../../../../../chunks/vec32.js\";import{c,a as n}from\"../../../../../chunks/sphere.js\";const t=1e3;function a(t,a,e){const f=c(),m=n(f);return s(m,m,t,.5),s(m,m,a,.5),f[3]=o(m,t),r(m,m,e),f}export{a as boundsFromEdge,t as maxCandidateCount};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{throwIfAborted as t}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/has.js\";import\"../../../../../core/RandomLCG.js\";import\"../../../../../core/Error.js\";import{subclass as o}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{f as s,j as n}from\"../../../../../chunks/vec32.js\";import{create as i,clone as r}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as c,fromPoints as d,projectPoint as a}from\"../../../../../geometry/support/lineSegment.js\";import{a as p,o as m}from\"../../../../../chunks/sphere.js\";import u from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as h}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{maxCandidateCount as g,boundsFromEdge as l}from\"./sceneLayerSnappingUtils.js\";let f=class{constructor(){this._idToComponent=new Map,this._components=new u((e=>e.bounds)),this._edges=new u((e=>e.bounds)),this._tmpLineSegment=c(),this._tmpP1=i(),this._tmpP2=i(),this._tmpP3=i(),this.remoteClient=null}async fetchCandidates(e,o){await Promise.resolve(),t(o),await this._ensureEdgeLocations(e,o);const s=[];return this._edges.forEachNeighbor((t=>(this._addCandidates(e,t,s),s.length<g)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,t){const o=[];if(this._components.forEachNeighbor((e=>{if(null==e.info){const{id:t,uid:s}=e;o.push({id:t,uid:s})}return!0}),e.bounds),!o.length)return;const s={components:o},n=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",s,t??{});for(const i of n.components)this._setFetchEdgeLocations(i)}async add(e){const t=new j(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((o=>(o.component===t&&e.push(o),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const t=this._idToComponent.get(e.id);if(null==t||e.uid!==t.uid)return;const o=h.createView(e.locations),s=new Array(o.count),n=i(),r=i();for(let i=0;i<o.count;i++){o.position0.getVec(i,n),o.position1.getVec(i,r);const c=l(n,r,e.origin),d=new w(t,i,c);s[i]=d}this._edges.add(s);const{objectIds:c,origin:d}=e;t.info={locations:o,objectIds:c,origin:d}}_addCandidates(e,t,o){const{info:n}=t.component,{origin:i,objectIds:r}=n,c=n.locations,d=c.position0.getVec(t.index,this._tmpP1),a=c.position1.getVec(t.index,this._tmpP2);s(d,d,i),s(a,a,i);const p=r[c.componentIndex.get(t.index)];this._addEdgeCandidate(e,p,d,a,o),b(e,p,d,o),b(e,p,a,o)}_addEdgeCandidate(e,t,o,s,i){if(!e.returnEdge)return;const c=p(e.bounds),u=d(o,s,this._tmpLineSegment),h=a(u,c,this._tmpP3);m(e.bounds,h)&&i.push({type:\"edge\",objectId:t,target:r(h),distance:n(c,h),start:r(o),end:r(s)})}};f=e([o(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],f);const _=f;function b(e,t,o,s){if(!e.returnVertex||!m(e.bounds,o))return;const i=p(e.bounds);s.push({type:\"vertex\",objectId:t,target:r(o),distance:n(i,o)})}class j{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++j.uid}static{this.uid=0}}class w{constructor(e,t,o){this.component=e,this.index=t,this.bounds=o}}export{_ as default};\n"],"names":["t","a","f","c","m","n","s","o","r","u","e","i","g","j","h","l","d","w","p","b","_"],"mappings":"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","x_google_ignoreList":[0,1]}