{"version":3,"file":"DictionaryScriptEvaluator-DW5hOK9A.js","sources":["../../node_modules/@arcgis/core/renderers/support/DictionaryScriptEvaluator.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import r from\"../../core/Logger.js\";import{Version as i}from\"../../core/Version.js\";import t from\"../../layers/support/FieldsIndex.js\";import{createDictionaryExpression as o,ArcadeFeatureReader as n}from\"../../support/ArcadeExpression.js\";class s{static async from(t,n,c){const l=t.dictionary_version?i.parse(t.dictionary_version):null,d=new Set(t.itemsNames),u={};if(n)for(const e in n)u[e]=n[e];if(t.authoringInfo.configuration)for(const e of t.authoringInfo.configuration)u.hasOwnProperty(e.name)||(u[e.name]=e.value);const p=new Set(t.authoringInfo.symbol);for(const e of Object.keys(c))p.delete(e);p.size&&r.getLogger(\"esri.renderers.support.DictionaryScriptEvaluator\").warnOnce(\"missing-fields: fieldMap entries for the following symbol fields are missing\",{symbolFields:p});const f=await o(t.expression,null,u);if(!f)throw new e(\"dictionary-renderer:expression-error\",\"Unable to create dictionary renderer expression\");const g=!l||!l.greaterEqual(4,0);g&&r.getLogger(\"esri.renderers.support.DictionaryScriptEvaluator\").warnOnce(\"Dictionary script does not support native field types. Applying fallback\",{version:l});const m=new a(c,g);return new s(g,d,f,m)}constructor(e,r,i,t){this._requiresFieldCoercionToString=e,this._itemNames=r,this._compiled=i,this._reader=t}get itemNames(){return this._itemNames}evaluate(e,i,t,o){try{return this._reader.bind(e,t,o),this._compiled.evaluate(this._reader,{$view:{scale:i}})}catch(n){r.getLogger(\"esri.renderers.support.DictionaryScriptEvaluator\").warnOnce(\"arcade: dictionary script evaluation failed\",{error:n})}return null}createDictionaryFieldsIndex(e){if(!this._requiresFieldCoercionToString)return new t(e);const r=e.map((e=>({...e,type:\"esriFieldTypeString\"})));return new t(r)}}class a extends n{constructor(e,r){super(),this._fieldMap=e,this._requiresFieldCoercionToString=r}_getField(e){const r=this._fieldMap[e]??e;return this._boundSchema.fieldsIndex.get(r)}field(e){if(!this._requiresFieldCoercionToString)return super.field(e,!1);const r=this._getField(e);if(null==r)return\"\";return null==this._boundTarget.attributes[r.name]?\"\":\"\"+this._boundTarget.attributes[r.name]}}export{s as DictionaryScriptEvaluator};\n"],"names":["s","t","n","c","l","i","d","u","e","p","r","f","o","g","m","a"],"mappings":";;;;AAIkR,MAAMA,EAAC;AAAA,EAAC,aAAa,KAAKC,GAAEC,GAAEC,GAAE;AAAC,UAAMC,IAAEH,EAAE,qBAAmBI,EAAE,MAAMJ,EAAE,kBAAkB,IAAE,MAAKK,IAAE,IAAI,IAAIL,EAAE,UAAU,GAAEM,IAAE,CAAA;AAAG,QAAGL,EAAE,YAAUM,KAAKN,EAAE,CAAAK,EAAEC,CAAC,IAAEN,EAAEM,CAAC;AAAE,QAAGP,EAAE,cAAc,cAAc,YAAUO,KAAKP,EAAE,cAAc,cAAc,CAAAM,EAAE,eAAeC,EAAE,IAAI,MAAID,EAAEC,EAAE,IAAI,IAAEA,EAAE;AAAO,UAAMC,IAAE,IAAI,IAAIR,EAAE,cAAc,MAAM;AAAE,eAAUO,KAAK,OAAO,KAAKL,CAAC,EAAE,CAAAM,EAAE,OAAOD,CAAC;AAAE,IAAAC,EAAE,QAAMC,EAAE,UAAU,kDAAkD,EAAE,SAAS,gFAA+E,EAAC,cAAaD,EAAC,CAAC;AAAE,UAAME,IAAE,MAAMC,EAAEX,EAAE,YAAW,MAAKM,CAAC;AAAE,QAAG,CAACI,EAAE,OAAM,IAAIH,EAAE,wCAAuC,iDAAiD;AAAE,UAAMK,IAAE,CAACT,KAAG,CAACA,EAAE,aAAa,GAAE,CAAC;AAAE,IAAAS,KAAGH,EAAE,UAAU,kDAAkD,EAAE,SAAS,4EAA2E,EAAC,SAAQN,EAAC,CAAC;AAAE,UAAMU,IAAE,IAAIC,EAAEZ,GAAEU,CAAC;AAAE,WAAO,IAAIb,EAAEa,GAAEP,GAAEK,GAAEG,CAAC;AAAA,EAAC;AAAA,EAAC,YAAY,GAAE,GAAE,GAAEb,GAAE;AAAC,SAAK,iCAA+B,GAAE,KAAK,aAAW,GAAE,KAAK,YAAU,GAAE,KAAK,UAAQA;AAAA,EAAC;AAAA,EAAC,IAAI,YAAW;AAAC,WAAO,KAAK;AAAA,EAAU;AAAA,EAAC,SAAS,GAAEI,GAAEJ,GAAEW,GAAE;AAAC,QAAG;AAAC,aAAO,KAAK,QAAQ,KAAK,GAAEX,GAAEW,CAAC,GAAE,KAAK,UAAU,SAAS,KAAK,SAAQ,EAAC,OAAM,EAAC,OAAMP,EAAC,EAAC,CAAC;AAAA,IAAC,SAAOH,GAAE;AAACQ,MAAAA,EAAE,UAAU,kDAAkD,EAAE,SAAS,+CAA8C,EAAC,OAAMR,EAAC,CAAC;AAAA,IAAC;AAAC,WAAO;AAAA,EAAI;AAAA,EAAC,4BAA4B,GAAE;AAAC,QAAG,CAAC,KAAK,+BAA+B,QAAO,IAAID,EAAE,CAAC;AAAE,UAAM,IAAE,EAAE,IAAK,CAAAO,OAAI,EAAC,GAAGA,GAAE,MAAK,sBAAqB,EAAE;AAAG,WAAO,IAAIP,EAAE,CAAC;AAAA,EAAC;AAAC;AAAC,MAAMc,UAAUb,EAAC;AAAA,EAAC,YAAY,GAAE,GAAE;AAAC,UAAK,GAAG,KAAK,YAAU,GAAE,KAAK,iCAA+B;AAAA,EAAC;AAAA,EAAC,UAAU,GAAE;AAAC,UAAM,IAAE,KAAK,UAAU,CAAC,KAAG;AAAE,WAAO,KAAK,aAAa,YAAY,IAAI,CAAC;AAAA,EAAC;AAAA,EAAC,MAAM,GAAE;AAAC,QAAG,CAAC,KAAK,+BAA+B,QAAO,MAAM,MAAM,GAAE,EAAE;AAAE,UAAM,IAAE,KAAK,UAAU,CAAC;AAAE,WAAS,KAAN,QAA8B,KAAK,aAAa,WAAW,EAAE,IAAI,KAAzC,OAAV,KAAwD,KAAG,KAAK,aAAa,WAAW,EAAE,IAAI;AAAA,EAAC;AAAC;","x_google_ignoreList":[0]}