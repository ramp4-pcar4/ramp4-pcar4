{"version":3,"file":"RefreshableLayer-Qpvyi8qY.js","sources":["../../node_modules/@arcgis/core/layers/mixins/refresh.js","../../node_modules/@arcgis/core/layers/mixins/RefreshableLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Collection.js\";import{sync as r}from\"../../core/reactiveUtils.js\";import{autorun as t}from\"../../core/accessorSupport/trackingUtils.js\";const n=new e,o=new WeakMap;function f(e){i(e)&&n.push(new WeakRef(e))}function s(e){const r=n.find((r=>r.deref()===e));r&&n.remove(r)}function i(e){return null!=e&&\"object\"==typeof e&&\"refreshInterval\"in e&&\"refresh\"in e}function c(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:c(r,e%r):0}let l=0,a=0;function u(){const e=Date.now();let r=!1;for(const t of n){const n=t.deref();if(n){if(n.refreshInterval){e-(o.get(n)??0)+5>=6e4*n.refreshInterval&&(o.set(n,e),n.refresh(e))}}else r=!0}if(r)for(let t=n.length-1;t>=0;t--){n.at(t).deref()||n.removeAt(t)}}t((()=>{const e=Date.now();let r=0;for(const t of n){const n=t.deref();n&&(r=c(Math.round(6e4*n.refreshInterval),r),n.refreshInterval?o.get(n)||o.set(n,e):o.delete(n))}if(r!==a){if(a=r,clearInterval(l),0===a)return void(l=0);l=setInterval(u,a)}}),r);const h={get hasRefreshTimer(){return l>0},get tickInterval(){return a},forceRefresh(){u()},hasLayer:e=>i(e)&&n.some((r=>r.deref()===e)),clear(){for(const e of n){const r=e.deref();r&&o.delete(r)}n.removeAll()}};export{f as registerLayer,h as test,s as unregisterLayer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import r from\"../../core/Logger.js\";import{debounce as s,ignoreAbortErrors as t}from\"../../core/promiseUtils.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import{cast as a}from\"../../core/accessorSupport/decorators/cast.js\";import\"../../core/RandomLCG.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{excludeTables as n}from\"../../core/accessorSupport/layerContainerType.js\";import{registerLayer as h,unregisterLayer as p}from\"./refresh.js\";function m(e){return null!=e&&\"object\"==typeof e&&\"refreshTimestamp\"in e&&\"refresh\"in e}const c=.1,f=m=>{let f=class extends m{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=s((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||h(this)}),(()=>{}))}destroy(){p(this)}castRefreshInterval(e){return e>=c?e:e<=0?0:c}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){t(this._debounceHasDataChanged()).then((r=>{r&&this._set(\"refreshTimestamp\",e),this.emit(\"refresh\",{dataChanged:r})}),(e=>{r.getLogger(this).error(e),this.emit(\"refresh\",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){}};return e([o({type:Number,json:{write:!0,origins:{\"web-scene\":{write:{enabled:!0,layerContainerTypes:n}}}}})],f.prototype,\"refreshInterval\",void 0),e([a(\"refreshInterval\")],f.prototype,\"castRefreshInterval\",null),e([o({readOnly:!0})],f.prototype,\"refreshTimestamp\",void 0),e([o({readOnly:!0})],f.prototype,\"refreshParameters\",null),f=e([i(\"esri.layers.mixins.RefreshableLayer\")],f),f};export{f as RefreshableLayer,m as isRefreshableLayer};\n"],"names":["n","e","o","f","i","s","r","c","l","a","u","t","m","h","p"],"mappings":"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","x_google_ignoreList":[0,1]}