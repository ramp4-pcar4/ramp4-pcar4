{"version":3,"file":"resourceUtils-CSI08ItO.js","sources":["../../node_modules/@arcgis/core/webdoc/support/resourceUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{allSettledErrors as t,throwIfAborted as r,eachAlways as o}from\"../../core/promiseUtils.js\";import{generateUUID as s}from\"../../core/uuid.js\";import{getSiblingOfSameTypeI as a,contentToBlob as c}from\"../../portal/support/resourceUtils.js\";async function p(e,t,r){const o=await u(e,t,r);await h(o,t,r)}async function n(e,t,r,o,s){const a=await u(r,o,s);await e.update({data:t}),await h(a,o,s)}async function u(o,p,n){if(!p?.resources)return;const u=p.portalItem===o.portalItem?new Set(o.paths):new Set;o.paths.length=0,o.portalItem=p.portalItem;const h=new Set(p.resources.toKeep.map((e=>e.resource.path))),i=new Set,m=[];h.forEach((e=>{u.delete(e),o.paths.push(e)}));const f=[],l=[],w=[];for(const e of p.resources.toUpdate)if(u.delete(e.resource.path),h.has(e.resource.path)||i.has(e.resource.path)){const{resource:t,content:r,finish:p}=e,n=a(t,s());o.paths.push(n.path),f.push({resource:n,content:await c(r),compress:e.compress}),p&&w.push((()=>p(n)))}else{o.paths.push(e.resource.path),l.push({resource:e.resource,content:await c(e.content),compress:e.compress});const t=e.finish;t&&w.push((()=>t(e.resource))),i.add(e.resource.path)}for(const e of p.resources.toAdd)if(o.paths.push(e.resource.path),u.has(e.resource.path))u.delete(e.resource.path);else{f.push({resource:e.resource,content:await c(e.content),compress:e.compress});const t=e.finish;t&&w.push((()=>t(e.resource)))}if(f.length||l.length){const{addOrUpdateResources:e}=await import(\"../../portal/support/resourceUtils.js\");await e(p.portalItem,f,\"add\",n),await e(p.portalItem,l,\"update\",n)}if(w.forEach((e=>e())),0===m.length)return u;const d=await t(m);if(r(n),d.length>0)throw new e(\"save:resources\",\"Failed to save one or more resources\",{errors:d});return u}async function h(e,t,r){if(!e||!t.portalItem)return;const s=[];for(const o of e){const e=t.portalItem.resourceFromPath(o);s.push(e.portalItem.removeResource(e,r))}await o(s)}export{p as saveResources,n as updateItemWithResources};\n"],"names":["p","e","r","o","u","h","n","s","a","i","m","f","l","w","t","c","d"],"mappings":";;;AAIwR,eAAeA,EAAEC,GAAE,GAAEC,GAAE;AAAC,QAAMC,IAAE,MAAMC,EAAEH,GAAE,GAAEC,CAAC;AAAE,QAAMG,EAAEF,GAAE,GAAED,CAAC;AAAC;AAAC,eAAeI,EAAEL,GAAE,GAAEC,GAAEC,GAAEI,GAAE;AAAC,QAAMC,IAAE,MAAMJ,EAAEF,GAAEC,GAAEI,CAAC;AAAE,QAAMN,EAAE,OAAO,EAAC,MAAK,EAAC,CAAC,GAAE,MAAMI,EAAEG,GAAEL,GAAEI,CAAC;AAAC;AAAC,eAAeH,EAAED,GAAEH,GAAEM,GAAE;AAAC,MAAG,CAACN,GAAG,UAAU;AAAO,QAAMI,IAAEJ,EAAE,eAAaG,EAAE,aAAW,IAAI,IAAIA,EAAE,KAAK,IAAE,oBAAI;AAAI,EAAAA,EAAE,MAAM,SAAO,GAAEA,EAAE,aAAWH,EAAE;AAAW,QAAMK,IAAE,IAAI,IAAIL,EAAE,UAAU,OAAO,IAAK,OAAG,EAAE,SAAS,IAAI,CAAE,GAAES,IAAE,oBAAI,OAAIC,IAAE,CAAA;AAAG,EAAAL,EAAE,QAAS,OAAG;AAAC,IAAAD,EAAE,OAAO,CAAC,GAAED,EAAE,MAAM,KAAK,CAAC;AAAA,EAAC,CAAC;AAAG,QAAMQ,IAAE,CAAA,GAAGC,IAAE,IAAGC,IAAE,CAAA;AAAG,aAAU,KAAKb,EAAE,UAAU,SAAS,KAAGI,EAAE,OAAO,EAAE,SAAS,IAAI,GAAEC,EAAE,IAAI,EAAE,SAAS,IAAI,KAAGI,EAAE,IAAI,EAAE,SAAS,IAAI,GAAE;AAAC,UAAK,EAAC,UAASK,GAAE,SAAQZ,GAAE,QAAOF,EAAC,IAAE,GAAEM,IAAEE,EAAEM,GAAEP,GAAG;AAAE,IAAAJ,EAAE,MAAM,KAAKG,EAAE,IAAI,GAAEK,EAAE,KAAK,EAAC,UAASL,GAAE,SAAQ,MAAMS,EAAEb,CAAC,GAAE,UAAS,EAAE,SAAQ,CAAC,GAAEF,KAAGa,EAAE,KAAM,MAAIb,EAAEM,CAAC,CAAC;AAAA,EAAE,OAAK;AAAC,IAAAH,EAAE,MAAM,KAAK,EAAE,SAAS,IAAI,GAAES,EAAE,KAAK,EAAC,UAAS,EAAE,UAAS,SAAQ,MAAMG,EAAE,EAAE,OAAO,GAAE,UAAS,EAAE,SAAQ,CAAC;AAAE,UAAMD,IAAE,EAAE;AAAO,IAAAA,KAAGD,EAAE,KAAM,MAAIC,EAAE,EAAE,QAAQ,IAAIL,EAAE,IAAI,EAAE,SAAS,IAAI;AAAA,EAAC;AAAC,aAAU,KAAKT,EAAE,UAAU,MAAM,KAAGG,EAAE,MAAM,KAAK,EAAE,SAAS,IAAI,GAAEC,EAAE,IAAI,EAAE,SAAS,IAAI,EAAE,CAAAA,EAAE,OAAO,EAAE,SAAS,IAAI;AAAA,OAAM;AAAC,IAAAO,EAAE,KAAK,EAAC,UAAS,EAAE,UAAS,SAAQ,MAAMI,EAAE,EAAE,OAAO,GAAE,UAAS,EAAE,SAAQ,CAAC;AAAE,UAAMD,IAAE,EAAE;AAAO,IAAAA,KAAGD,EAAE,KAAM,MAAIC,EAAE,EAAE,QAAQ;EAAG;AAAC,MAAGH,EAAE,UAAQC,EAAE,QAAO;AAAC,UAAK,EAAC,sBAAqB,EAAC,IAAE,MAAM,OAAO,6BAAuC;AAAE,UAAM,EAAEZ,EAAE,YAAWW,GAAE,OAAML,CAAC,GAAE,MAAM,EAAEN,EAAE,YAAWY,GAAE,UAASN,CAAC;AAAA,EAAC;AAAC,MAAGO,EAAE,QAAS,OAAG,GAAG,GAAOH,EAAE,WAAN,EAAa,QAAON;AAAE,QAAMY,IAAE,MAAMF,EAAEJ,CAAC;AAAE,MAAGR,EAAEI,CAAC,GAAEU,EAAE,SAAO,EAAE,OAAM,IAAIf,EAAE,kBAAiB,wCAAuC,EAAC,QAAOe,EAAC,CAAC;AAAE,SAAOZ;AAAC;AAAC,eAAeC,EAAEJ,GAAE,GAAEC,GAAE;AAAC,MAAG,CAACD,KAAG,CAAC,EAAE,WAAW;AAAO,QAAMM,IAAE,CAAA;AAAG,aAAUJ,KAAKF,GAAE;AAAC,UAAMA,IAAE,EAAE,WAAW,iBAAiBE,CAAC;AAAE,IAAAI,EAAE,KAAKN,EAAE,WAAW,eAAeA,GAAEC,CAAC,CAAC;AAAA,EAAC;AAAC,QAAMC,EAAEI,CAAC;AAAC;","x_google_ignoreList":[0]}