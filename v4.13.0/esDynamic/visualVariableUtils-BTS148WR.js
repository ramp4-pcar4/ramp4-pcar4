import{ff as Z,i as _,bv as W,bh as R}from"./main-BFDurRCu.js";import{m as $}from"./lengthUtils-C61nRlXw.js";var S,v;function D(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function y(e){return e!=null&&!isNaN(e)&&isFinite(e)}function M(e){return e.valueExpression?S.Expression:e.field&&typeof e.field=="string"?S.Field:S.Unknown}function j(e,i){const a=i||M(e),n=e.valueUnit||"unknown";return a===S.Unknown?v.Constant:e.stops?v.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?v.ClampedLinear:n==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?v.Proportional:v.Additive:v.Identity:v.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(S||(S={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(v||(v={}));const U=()=>_.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),z=e=>U().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),g=()=>U().error("Use of arcade expressions requires an arcade context"),N=new W,w=Math.PI,T=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function I(e,i,a){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(u=>u.type==="color"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void z("ColorVariable");const r=typeof i=="number",l=r?null:i,s=l?.attributes;let o=r?i:null;const t=n.field,{ipData:c,hasExpression:m}=n.cache;let f=n.cache.compiledFunc;if(!t&&!m){const u=n.stops;return u&&u[0]&&u[0].color}if(typeof o!="number")if(m){if(a?.arcade==null)return void g();const u={viewingMode:a.viewingMode,scale:a.scale,spatialReference:a.spatialReference},p=a.arcade.arcadeUtils,V=p.getViewInfo(u),x=p.createExecContext(l,V,a.timeZone);if(!f){const k=p.createSyntaxTree(n.valueExpression);f=p.createFunction(k),n.cache.compiledFunc=f}o=p.executeFunction(f,x)}else s&&(o=s[t]);const d=n.normalizationField,b=s!=null&&d!=null?parseFloat(s[d]):void 0;if(o!=null&&(!d||r||!isNaN(b)&&b!==0)){y(b)&&!r&&(o/=b);const u=C(o,c);if(u){const p=u[0],V=u[1],x=p===V?n.stops[p].color:R.blendColors(n.stops[p].color,n.stops[V].color,u[2],a?.color);return new R(x)}}}function q(e,i,a){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(u=>u.type==="opacity"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void z("OpacityVariable");const r=typeof i=="number",l=r?null:i,s=l?.attributes;let o=r?i:null;const t=n.field,{ipData:c,hasExpression:m}=n.cache;let f=n.cache.compiledFunc;if(!t&&!m){const u=n.stops;return u&&u[0]&&u[0].opacity}if(typeof o!="number")if(m){if(a?.arcade==null)return void g();const u={viewingMode:a.viewingMode,scale:a.scale,spatialReference:a.spatialReference},p=a.arcade.arcadeUtils,V=p.getViewInfo(u),x=p.createExecContext(l,V,a.timeZone);if(!f){const k=p.createSyntaxTree(n.valueExpression);f=p.createFunction(k),n.cache.compiledFunc=f}o=p.executeFunction(f,x)}else s&&(o=s[t]);const d=n.normalizationField,b=s!=null&&d!=null?parseFloat(s[d]):void 0;if(o!=null&&(!d||r||!isNaN(b)&&b!==0)){y(b)&&!r&&(o/=b);const u=C(o,c);if(u){const p=u[0],V=u[1];if(p===V)return n.stops[p].opacity;{const x=n.stops[p].opacity;return x+(n.stops[V].opacity-x)*u[2]}}}}function E(e,i,a){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(b=>b.type==="rotation"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void z("RotationVariable");const r=n.axis||"heading",l=r==="heading"&&n.rotationType==="arithmetic"?90:0,s=r==="heading"&&n.rotationType==="arithmetic"?-1:1,o=typeof i=="number"?null:i,t=o?.attributes,c=n.field,{hasExpression:m}=n.cache;let f=n.cache.compiledFunc,d=null;if(!c&&!m)return d;if(m){if(a?.arcade==null)return void g();const b={viewingMode:a.viewingMode,scale:a.scale,spatialReference:a.spatialReference},u=a.arcade.arcadeUtils,p=u.getViewInfo(b),V=u.createExecContext(o,p,a.timeZone);if(!f){const x=u.createSyntaxTree(n.valueExpression);f=u.createFunction(x),n.cache.compiledFunc=f}d=u.executeFunction(f,V)}else t&&(d=t[c]);return d=typeof d!="number"||isNaN(d)?null:l+s*d,d}function B(e,i,a){const n=typeof i=="number",r=n?null:i,l=r?.attributes;let s=n?i:null;const{isScaleDriven:o}=e.cache;let t=e.cache.compiledFunc;if(o){const m=a?.scale,f=a?.view;s=m==null||f==="3d"?G(e):m}else if(!n)switch(e.inputValueType){case S.Expression:{if(a?.arcade==null)return void g();const m={viewingMode:a.viewingMode,scale:a.scale,spatialReference:a.spatialReference},f=a.arcade.arcadeUtils,d=f.getViewInfo(m),b=f.createExecContext(r,d,a.timeZone);if(!t){const u=f.createSyntaxTree(e.valueExpression);t=f.createFunction(u),e.cache.compiledFunc=t}s=f.executeFunction(t,b);break}case S.Field:l&&(s=l[e.field]);break;case S.Unknown:s=null}if(!y(s))return null;if(n||!e.normalizationField)return s;const c=l?parseFloat(l[e.normalizationField]):null;return y(c)&&c!==0?s/c:null}function G(e){let i=null,a=null;const n=e.stops;return n?(i=n[0].value,a=n[n.length-1].value):(i=e.minDataValue||0,a=e.maxDataValue||0),(i+a)/2}function F(e,i,a){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(l=>l.type==="size"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void z("SizeVariable");const r=O(B(n,i,a),n,i,a,n.cache.ipData);return r==null||isNaN(r)?void 0:r}function h(e,i,a){return e==null?null:D(e)?F(e,i,a):y(e)?e:null}function A(e,i,a){return y(a)&&e>a?a:y(i)&&e<i?i:e}function H(e,i,a,n){const r=h(i.minSize,a,n)||i.minDataValue;return e==null&&r==null?null:(e??0)+(r??0)}function J(e,i,a){const n=e.stops;let r=n?.length&&n[0].size;return r==null&&(r=e.minSize),h(r,i,a)}function K(e,i,a,n){const r=h(i.minSize,a,n);if(e==null)return r;const{minDataValue:l,maxDataValue:s}=i;if(l==null||s==null)return null;const o=(e-l)/(s-l),t=h(i.maxSize,a,n),c=n?.shape;if(e<=l)return r;if(e>=s)return t;if(r==null||t==null)return null;if(i.scaleBy==="area"&&c){const m=c==="circle",f=m?w*(r/2)**2:r*r,d=f+o*((m?w*(t/2)**2:t*t)-f);return m?2*Math.sqrt(d/w):Math.sqrt(d)}return r+o*(t-r)}function Q(e,i,a,n){const r=h(i.minSize,a,n);if(e==null||r==null)return r;const l=n?.shape,{minDataValue:s}=i;if(s==null)return null;const o=e/s,t=h(i.maxSize,a,n);let c=null;return c=l==="circle"?2*Math.sqrt(o*(r/2)**2):l==="square"||l==="diamond"||l==="image"?Math.sqrt(o*r**2):o*r,A(c,r,t)}function X(e,i,a,n,r){if(e==null)return null;const[l,s,o]=C(e,r);if(l===s)return h(i.stops?.[l].size,a,n);{const t=h(i.stops?.[l].size,a,n),c=h(i.stops?.[s].size,a,n);return t==null||c==null?null:t+(c-t)*o}}function Y(e,i,a,n){const r=(n?.resolution??1)*$[i.valueUnit],l=h(i.minSize,a,n),s=h(i.maxSize,a,n),{valueRepresentation:o}=i;if(e==null)return l;let t=null;return t=o==="area"?2*Math.sqrt(e/w)/r:o==="radius"||o==="distance"?2*e/r:e/r,A(t,l,s)}function O(e,i,a,n,r){switch(i.transformationType){case v.Additive:return H(e,i,a,n);case v.Constant:return J(i,a,n);case v.ClampedLinear:return K(e,i,a,n);case v.Proportional:return Q(e,i,a,n);case v.Stops:return X(e,i,a,n,r);case v.RealWorldSize:return Y(e,i,a,n);case v.Identity:return e;case v.Unknown:return null}}function ee(e,i,a){const{isScaleDriven:n}=e.cache;if(!(n&&a==="3d"||i))return null;const r={scale:i,view:a};let l=h(e.minSize,N,r),s=h(e.maxSize,N,r);if(l!=null||s!=null){if(l>s){const o=s;s=l,l=o}return{minSize:l,maxSize:s}}}function P(e,i,a){if(!e.visualVariables)return;const n=[],r=[],l=[],s=[],o=[];for(const t of e.visualVariables)switch(t.type){case"color":r.push(t);break;case"opacity":l.push(t);break;case"rotation":o.push(t);break;case"size":s.push(t)}return r.forEach(t=>{const c=I(t,i,a);n.push({variable:t,value:c})}),l.forEach(t=>{const c=q(t,i,a);n.push({variable:t,value:c})}),o.forEach(t=>{const c=E(t,i,a);n.push({variable:t,value:c})}),s.forEach(t=>{const c=F(t,i,a);n.push({variable:t,value:c})}),n}function C(e,i){if(!i)return;let a=0,n=i.length-1;return i.some((r,l)=>e<r?(n=l,!0):(a=l,!1)),[a,n,(e-i[a])/(i[n]-i[a])]}function L(e,i,a){const n=["proportional","proportional","proportional"];for(const r of e){const l=r.useSymbolValue?"symbol-value":F(r,i,a)??"proportional";switch(r.axis){case"width":n[0]=l;break;case"depth":n[1]=l;break;case"height":n[2]=l;break;case"width-and-depth":n[0]=l,n[1]=l;break;case"all":case void 0:case null:n[0]=l,n[1]=l,n[2]=l;break;default:Z(r.axis)}}return n}const ne=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:L,getColor:I,getOpacity:q,getRotationAngle:E,getSize:F,getSizeForValue:O,getSizeFromNumberOrVariable:h,getSizeRangeAtScale:ee,getVisualVariableValues:P,viewScaleRE:T},Symbol.toStringTag,{value:"Module"}));export{P as D,L as N,j as a,ne as b,D as e,E as h,v as i,M as t,T as v};
