import{h as m}from"./TimeOnly-CGkId3bj.js";import{a as F,r as A}from"./enum-g1DWyQyu.js";import{a as p,K as u,b as f,q as s,i as h}from"./aiServices-u5nRiq9H.js";import{l as c}from"./arcade-BoHTeCSG.js";import{R as l,i as w}from"./WhereClause-D4rZJkVN.js";import{dW as d,dX as S}from"./main-BFDurRCu.js";async function a(t,e,n,o){if(n.length===1){if(d(n[0]))return c(t,n[0],s(n[1],-1));if(f(n[0]))return c(t,n[0].toArray(),s(n[1],-1))}else if(n.length===2){if(d(n[0]))return c(t,n[0],s(n[1],-1));if(f(n[0]))return c(t,n[0].toArray(),s(n[1],-1));if(u(n[0])){const r=await n[0].load(),i=await y(l.create(n[1],{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}),o,e);return g(e,await n[0].calculateStatistic(t,i,s(n[2],1e3),e.abortSignal))}}else if(n.length===3&&u(n[0])){const r=await n[0].load(),i=await y(l.create(n[1],{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}),o,e);return g(e,await n[0].calculateStatistic(t,i,s(n[2],1e3),e.abortSignal))}return c(t,n,-1)}function g(t,e){return e instanceof w?m.fromReaderAsTimeStampOffset(e.toStorageFormat()):e instanceof Date?m.dateJSAndZoneToArcadeDate(e,h(t)):e}async function y(t,e,n){const o=t.getVariables();if(o.length>0){const r={};for(const i of o)r[i]=e.evaluateIdentifier(n,{name:i});t.parameters=r}return t}function v(t){t.mode==="async"&&(t.functions.stdev=function(e,n){return t.standardFunctionAsync(e,n,(o,r,i)=>a("stdev",e,i,t))},t.functions.variance=function(e,n){return t.standardFunctionAsync(e,n,(o,r,i)=>a("variance",e,i,t))},t.functions.average=function(e,n){return t.standardFunctionAsync(e,n,(o,r,i)=>a("mean",e,i,t))},t.functions.mean=function(e,n){return t.standardFunctionAsync(e,n,(o,r,i)=>a("mean",e,i,t))},t.functions.sum=function(e,n){return t.standardFunctionAsync(e,n,(o,r,i)=>a("sum",e,i,t))},t.functions.min=function(e,n){return t.standardFunctionAsync(e,n,(o,r,i)=>a("min",e,i,t))},t.functions.max=function(e,n){return t.standardFunctionAsync(e,n,(o,r,i)=>a("max",e,i,t))},t.functions.count=function(e,n){return t.standardFunctionAsync(e,n,async(o,r,i)=>{if(p(i,1,1,e,n),u(i[0]))return i[0].count(o.abortSignal);if(d(i[0])||S(i[0]))return i[0].length;if(f(i[0]))return i[0].length();throw new F(e,A.InvalidParameter,n)})})}export{v as registerFunctions};
