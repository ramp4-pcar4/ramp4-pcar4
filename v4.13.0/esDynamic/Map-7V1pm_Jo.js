import{v as s,bJ as P,x as a,z as c,B as h,p as U,V as g,R as D,i as v,N as b,e6 as z,je as k,s as H,O as A,h as N,H as Q,i_ as V,bV as C,hE as W,bh as _,bn as T,em as K,a0 as X,I as Y,jf as Z,c8 as E,cB as ee,n as te,c6 as $}from"./main-BFDurRCu.js";import{a as F,O as w}from"./Basemap-C_NhFN5u.js";import{t as re}from"./loadAll-DQWsVoX1.js";import{l as G}from"./CollectionFlattener-DyEG1Q6J.js";import{n as se}from"./uuid-Dj9mdEVg.js";import{v as oe}from"./persistable-DgPk2hdg.js";import{l as m}from"./PolygonCollection-Btw6sA7T.js";import{e as ae}from"./editableLayers-DFUBlMJy.js";import"./mat4f32-BdRMyjXW.js";import"./mat4-OOmHNWi7.js";import{l as ie,a as ne,t as le}from"./TablesMixin-BORwbVPt.js";var j;let S=j=class extends h{constructor(e){super(e),this.type="none"}clone(){return new j({type:this.type})}};s([P({none:"none",stayAbove:"stay-above"}),a({json:{write:{isRequired:!0}}})],S.prototype,"type",void 0),S=j=s([c("esri.ground.NavigationConstraint")],S);const pe=Symbol("GroundInstance");var B,x;let p=x=class extends h.JSONSupportMixin(U){static{B=pe}constructor(e){super(e),this[B]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new g;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&v.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},o=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>o(r.item))])}initialize(){this.when().catch(e=>{D(e)||v.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)b(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",z(e,this._get("layers")))}writeLayers(e,t,o,r){const n=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(l=>{if("write"in l){const y={};k(l)().write(y,r)&&n.push(y)}else r?.messages&&r.messages.push(new H("layer:unsupported",`Layers (${l.title}, ${l.id}) of type '${l.declaredClass}' cannot be persisted in the ground`,{layer:l}))})),t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return re(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:o}=await import("./ElevationQuery-BY0HtgLp.js");A(t);const r=new o,n=this.layers.filter(J).toArray();return r.queryAll(n,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:o}=await import("./ElevationQuery-BY0HtgLp.js");A(t);const r=new o,n=this.layers.filter(J).toArray();return r.createSamplerAll(n,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:N(this.surfaceColor),navigationConstraint:N(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new x({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,o){const r=t?.origin||"web-scene",n=t?.portal||null,l=t?.url||null,{populateOperationalLayers:y}=await import("./layersCreator-BUP_XUvO.js");A(o);const u=[];if(e.layers&&Array.isArray(e.layers)){const M={context:{origin:r,url:l,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};u.push(y(this.layers,e.layers,M))}await Promise.allSettled(u)}};function de(e){return e&&"createElevationSampler"in e}function J(e){return e.type==="elevation"||de(e)}s([a({json:{read:!1,write:{isRequired:!0}}})],p.prototype,"layers",null),s([Q("layers")],p.prototype,"writeLayers",null),s([a({readOnly:!0})],p.prototype,"resourceInfo",void 0),s([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:C,read:{reader:V,source:"transparency"},write:{writer:(e,t)=>{t.transparency=W(e)},target:"transparency"}}})],p.prototype,"opacity",void 0),s([a({type:_,json:{type:[C],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],p.prototype,"surfaceColor",void 0),s([a({type:S,json:{write:!0}})],p.prototype,"navigationConstraint",void 0),p=x=s([c("esri.Ground")],p);const L=p;let I=class extends T.ClonableMixin(h){constructor(e){super(e),this.color=null}};s([a({type:_,json:{type:[C],write:!0}})],I.prototype,"color",void 0),I=s([c("esri.effects.FocusAreaOutline")],I);const ye=I;let d=class extends h.JSONSupportMixin(T){constructor(e){super(e),this.id=`focusarea-${se()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new m}readGeometries(e,t,o){Array.isArray(e)?this.geometries=m.fromJSON(e,o):o.hooks?.onAfterLoad?.(()=>this._loadGeometries(K(e,o),o))}async _loadGeometries(e,t){const o=await X(e,{responseType:"json"});this.geometries=m.fromJSON(o.data,t)}};s([a({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),a()],d.prototype,"id",void 0),s([a({type:String,json:{write:!0}})],d.prototype,"title",void 0),s([a({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],d.prototype,"enabled",void 0),s([a({type:ye,json:{write:!0}})],d.prototype,"outline",void 0),s([a({type:m,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new m(e.items.map(t=>t.clone()))}),oe({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],d.prototype,"geometries",void 0),s([Y(["web-scene","portal-item"],"geometries")],d.prototype,"readGeometries",null),d=s([c("esri.effects.FocusArea")],d);const ce=d;let f=class extends h.JSONSupportMixin(T){constructor(e){super(e),this.areas=new g,this.style="bright"}};s([a({type:g.ofType(ce),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new g(e.items.map(t=>t.clone()))})],f.prototype,"areas",void 0),s([a({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],f.prototype,"style",void 0),f=s([c("esri.effects.FocusAreas")],f);const R=f,O=()=>v.getLogger("esri.support.basemapUtils");function ue(){return{}}function he(e){for(const t in e){const o=e[t];b(o),delete e[t]}}function me(e,t){let o;if(typeof e=="string"){const r=e in F,n=!r&&e.includes("/");if(!r&&!n){if(Z())O().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const l=Object.entries(F).filter(([y,u])=>u.classic||u.is3d).map(([y])=>`"${y}"`).sort().join(", ");O().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`)}return null}t&&(o=t[e]),o||(o=r?w.fromId(e):new w({style:{id:e}}),t&&(t[e]=o))}else o=E(w,e);return o?.destroyed&&(O().warn("The provided basemap is already destroyed",{basemap:o}),o=null),o}const q={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function fe(e){let t=null;if(typeof e=="string")if(e in q){const o=q[e];t=new L({resourceInfo:{data:{layers:[o]}}})}else v.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=E(L,e);return t}let i=class extends ie(ne(ee.EventedMixin(te))){constructor(e){super(e),this.allLayers=new G({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.focusAreas=new R,this.allTables=le(this),this.basemap=null,this.editableLayers=new G({getCollections:()=>[this.allLayers],itemFilterFunction:ae}),this.ground=new L,this._basemapCache=ue()}destroy(){he(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=b(this.basemap),b(this.ground),this._set("ground",null)}castBasemap(e){return me(e,this._basemapCache)}castGround(e){return fe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};s([a({readOnly:!0,dependsOn:[]})],i.prototype,"allLayers",void 0),s([a({type:R,nonNullable:!0,json:{write:{overridePolicy:e=>({enabled:e.areas.length>0,ignoreOrigin:!0})}}})],i.prototype,"focusAreas",void 0),s([a({readOnly:!0})],i.prototype,"allTables",void 0),s([a({type:w,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],i.prototype,"basemap",void 0),s([$("basemap")],i.prototype,"castBasemap",null),s([a({readOnly:!0})],i.prototype,"editableLayers",void 0),s([a({type:L,nonNullable:!0})],i.prototype,"ground",void 0),s([$("ground")],i.prototype,"castGround",null),s([a()],i.prototype,"undoRedo",void 0),i=s([c("esri.Map")],i);const ge=i;export{ge as default};
