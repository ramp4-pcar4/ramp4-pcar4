{"version":3,"file":"arcgisLayers-DOUi8sUz.js","sources":["../../node_modules/@arcgis/core/layers/support/arcgisLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{urlToObject as r,getFilename as a}from\"../../core/urlUtils.js\";import{parse as t,parseNonStandardSublayerUrl as s}from\"./arcgisLayerUrl.js\";import{findAssociatedFeatureService as l}from\"./associatedFeatureServiceUtils.js\";import{getLayerModuleType as o,fetchFeatureService as n}from\"./fetchService.js\";import{getPreferredUrl as c,sceneServiceLayerTypeToClassName as i}from\"./layerUtils.js\";import{layerLookupMap as u}from\"./lazyLayerLoader.js\";import{fetchArcGISServiceJSON as y}from\"../../support/requestPresets.js\";const f={FeatureLayer:!0,SceneLayer:!0,VideoLayer:!0};async function p(e){const{properties:r,url:a}=e,t={...r,url:a},s=await v(a,r?.customParameters),{Constructor:l,layerId:o,sourceJSON:n,parsedUrl:c,layers:i,tables:u}=s;if(i.length+u.length===0)return null!=o&&(t.layerId=o),null!=n&&(t.sourceJSON=n),new l(t);const y=new(0,(await import(\"../GroupLayer.js\")).default)({title:c.title});return await w(y,s,t),y}function m(e,r){return e?e.find((({id:e})=>e===r)):null}function d(e,r,a,t,s){const l={...s,layerId:r};return null!=e&&(l.url=e),null!=a&&(l.sourceJSON=a),\"sublayerTitleMode\"in t.prototype&&(l.sublayerTitleMode=\"service-name\"),new t(l)}async function w(e,r,a){const t=r.sublayerConstructorProvider;for(const{id:s,serverUrl:l}of r.layers){const o=m(r.sublayerInfos,s),n=d(l,s,o,(o&&t?.(o))??r.Constructor,a);e.add(n)}if(r.tables.length){const t=await L(\"FeatureLayer\");r.tables.forEach((({id:s,serverUrl:l})=>{const o=d(l,s,m(r.tableInfos,s),t,a);e.tables.add(o)}))}}async function v(r,a){let s=t(r);if(null==s&&(s=await S(r,a)),null==s)throw new e(\"arcgis-layers:url-mismatch\",\"The url '${url}' is not a valid arcgis resource\",{url:r});const{serverType:l,sublayer:n}=s;let u;const p={FeatureServer:\"FeatureLayer\",KnowledgeGraphServer:\"KnowledgeGraphLayer\",StreamServer:\"StreamLayer\",VectorTileServer:\"VectorTileLayer\",VideoServer:\"VideoLayer\"},m=\"FeatureServer\"===l,d=\"SceneServer\"===l,w={parsedUrl:s,Constructor:null,layerId:m||d?n??void 0:void 0,layers:[],tables:[]};switch(l){case\"MapServer\":if(null!=n){const{type:t}=await y(r,{customParameters:a});switch(u=\"FeatureLayer\",t){case\"Catalog Layer\":u=\"CatalogLayer\";break;case\"Catalog Dynamic Group Layer\":throw new e(\"arcgis-layers:unsupported\",`fromUrl() not supported for \"${t}\" layers`)}}else{u=await g(r,a)?\"TileLayer\":\"MapImageLayer\"}break;case\"ImageServer\":{const e=await y(r,{customParameters:a}),{tileInfo:t,cacheType:s}=e;u=t?\"LERC\"!==t?.format?.toUpperCase()||s&&\"elevation\"!==s.toLowerCase()?\"ImageryTileLayer\":\"ElevationLayer\":\"ImageryLayer\";break}case\"SceneServer\":{const e=await y(s.url.path,{customParameters:a});if(u=\"SceneLayer\",e){const r=e?.layers;if(\"Voxel\"===e?.layerType)u=\"VoxelLayer\";else if(r?.length){const e=r[0]?.layerType;null!=e&&null!=i[e]&&(u=i[e])}}break}case\"3DTilesServer\":throw new e(\"arcgis-layers:unsupported\",\"fromUrl() not supported for 3DTiles layers\");case\"FeatureServer\":if(u=\"FeatureLayer\",null!=n){const e=await y(r,{customParameters:a});w.sourceJSON=e,w.preferredUrl=c(),u=o(e.type)}break;default:u=p[l]}if(f[u]&&null==n){const e=await h(r,l,a);m&&(w.preferredUrl=e.preferredUrl,w.sublayerInfos=e.layerInfos,w.tableInfos=e.tableInfos);if(1!==e.layers.length+e.tables.length)w.layers=e.layers,w.tables=e.tables,m&&e.layerInfos?.length&&(w.sublayerConstructorProvider=await P(e.layerInfos));else if(m||d){const r=e.layerInfos?.[0]??e.tableInfos?.[0];if(w.layerId=e.layers[0]?.id??e.tables[0]?.id,w.sourceJSON=r,m){const e=r?.type;u=o(e)}}}return w.Constructor=await L(u),w}async function S(e,t){const l=await y(e,{customParameters:t});let o=null,n=null;const c=l.type;if(\"Feature Layer\"===c||\"Table\"===c?(o=\"FeatureServer\",n=l.id??null):\"indexedVector\"===c?o=\"VectorTileServer\":l.hasOwnProperty(\"mapName\")?o=\"MapServer\":l.hasOwnProperty(\"bandCount\")&&l.hasOwnProperty(\"pixelSizeX\")?o=\"ImageServer\":l.hasOwnProperty(\"maxRecordCount\")&&l.hasOwnProperty(\"allowGeometryUpdates\")?o=\"FeatureServer\":l.hasOwnProperty(\"streamUrls\")?o=\"StreamServer\":b(l)?(o=\"SceneServer\",n=l.id):l.hasOwnProperty(\"layers\")&&b(l.layers?.[0])&&(o=\"SceneServer\"),!o)return null;const i=null!=n?s(e):null;return{title:null!=i&&l.name||a(e),serverType:o,sublayer:n,url:{path:null!=i?i.serviceUrl:r(e).path}}}function b(e){return null!=e&&e.hasOwnProperty(\"store\")&&e.hasOwnProperty(\"id\")&&\"number\"==typeof e.id}async function h(e,r,a){let t,s,l,o=!1;switch(r){case\"FeatureServer\":{const r=await n(e,{customParameters:a});l=c(e,{preferredHost:r.preferredHost}),o=!!r.layersJSON,t=r.layersJSON||r.serviceJSON;break}case\"SceneServer\":{const r=await I(e,a);t=r.serviceInfo,s=r.tableServerUrl;break}default:t=await y(e,{customParameters:a})}const i=t?.layers,u=t?.tables;return{preferredUrl:l,layers:i?.map((e=>({id:e.id}))).reverse()||[],tables:u?.map((e=>({serverUrl:s,id:e.id}))).reverse()||[],layerInfos:o?i:[],tableInfos:o?u:[]}}async function I(e,r){const a=await y(e,{customParameters:r}),t=a.layers?.[0];if(!t)return{serviceInfo:a};try{const{serverUrl:t}=await l(e),s=await y(t,{customParameters:r}).catch((()=>null));return s&&(a.tables=s.tables),{serviceInfo:a,tableServerUrl:t}}catch{return{serviceInfo:a}}}async function L(e){return(0,u[e])()}async function g(e,r){return(await y(e,{customParameters:r})).tileInfo}async function P(e){if(!e.length)return;const r=new Set,a=[];for(const{type:l}of e)r.has(l)||(r.add(l),a.push(L(o(l))));const t=await Promise.all(a),s=new Map;return Array.from(r).forEach(((e,r)=>{s.set(e,t[r])})),e=>s.get(e.type)}export{p as fromUrl};\n"],"names":["f","p","r","a","t","s","v","l","o","n","c","i","u","y","w","m","e","d","L","S","g","h","P","I"],"mappings":"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","x_google_ignoreList":[0]}