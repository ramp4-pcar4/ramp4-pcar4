{"version":3,"file":"executeQueryForSnapping-BsS9M1AV.js","sources":["../../node_modules/@arcgis/core/layers/graphics/data/executeQueryForSnapping.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{clone as e}from\"../../../core/lang.js\";import{signalFromSignalOrOptions as t}from\"../../../core/promiseUtils.js\";import{fromJSON as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as a}from\"../../../geometry/support/normalizeUtils.js\";import{equals as i}from\"../../../geometry/support/spatialReferenceUtils.js\";import{checkProjectionSupport as s,project as n}from\"./projectionSupport.js\";import{getQueryBBoxes as o}from\"./QueryEngine.js\";import{QueryEngineResult as l}from\"./QueryEngineResult.js\";import{normalizeQueryLike as p}from\"./queryUtils.js\";import{validateQuery as m}from\"./queryValidationUtils.js\";import{getSpatialQueryOperator as c}from\"./spatialQuerySupport.js\";async function u(c,u,y){const d=t(y),{point:x,distance:g,returnEdge:R,vertexMode:j}=u;if(!R&&\"none\"===j)return{candidates:[]};let w=e(u.query);w=await c.schedule((()=>p(w,c.definitionExpression,c.spatialReference)),d),w=await c.reschedule((()=>m(w,{availableFields:c.availableFields,fieldsIndex:c.fieldsIndex,geometryType:c.geometryType,spatialReference:c.spatialReference})),d);const h=!i(x.spatialReference,c.spatialReference);h&&await s(x.spatialReference,c.spatialReference);const b=\"number\"==typeof g?g:g.x,Q=\"number\"==typeof g?g:g.y,S={xmin:x.x-b,xmax:x.x+b,ymin:x.y-Q,ymax:x.y+Q,spatialReference:x.spatialReference},U=h?n(S,c.spatialReference):S;if(!U)return{candidates:[]};const q=(await a(r(x),null,{signal:d}))[0],E=(await a(r(U),null,{signal:d}))[0];if(null==q||null==E)return{candidates:[]};const F=new l(await c.reschedule((()=>c.searchFeatures(o(E.toJSON()))),d),w,c);await c.reschedule((()=>c.executeObjectIdsQuery(F)),d),await c.reschedule((()=>c.executeTimeQuery(F)),d),await c.reschedule((()=>c.executeAttributesQuery(F)),d),await c.reschedule((()=>f(c,F,d)),d);const T=q.toJSON(),v=h?n(T,c.spatialReference):T,I=h?Math.max(U.xmax-U.xmin,U.ymax-U.ymin)/2:g;return F.createSnappingResponse({...u,point:v,distance:I},w.returnZ,x.spatialReference)}async function f(e,t,r){const{query:a}=t,{spatialRel:i}=a;if(!t?.items?.length||!a.geometry||!i)return;const s=await c(i,a.geometry,e.geometryType,e.hasZ,e.hasM),n=await e.runSpatialFilter(t.items,(e=>s(e.geometry)),r);t.items=n}export{u as executeQueryForSnapping};\n"],"names":["u","c","y","d","t","x","g","R","j","w","e","p","m","h","i","s","b","Q","S","U","n","q","a","r","E","F","l","o","f","T","v"],"mappings":"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","x_google_ignoreList":[0]}