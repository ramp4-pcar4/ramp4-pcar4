import{e as p,y as d,fM as xt,e1 as wt,dO as vt,k as Q,dB as xe,e6 as Ge,jK as Te,eq as et,r as c,p as $,j5 as W,a9 as I,b4 as $t,mr as At,ms as N,aW as M,he as Oe,bh as _,O as bt,mt as Tt,mu as Mt,kl as Rt,cr as Ft,t as ue,c as Me,dn as _e,iG as tt,iL as rt,fg as pe,aV as Lt,ff as nt,dk as he,jZ as Ct,iF as Dt,lx as ot,dm as st,gk as It,m as Ot,jf as _t,ev as Et,bp as jt,w as Re,bi as Pt,aX as ve,bb as St,f as Nt,j as zt}from"./main-8eb577c9.js";import{_ as fe}from"./preload-helper-388ac9d5.js";import{r as we,b as Wt,x as kt,a as Ee,j as je,c as Pe,R as Se,h as Ne,d as ze,_ as Ut,e as oe,v as Fe,g as Le,f as Gt,i as le,L as ge}from"./georeference-6ce02809.js";import{r as Ht}from"./imageUtils-c2d0d1ae.js";import{r as Vt}from"./earcut-61f7b102.js";import{r as He}from"./deduplicate-58e5df9b.js";import{e as We}from"./mat3f64-221ce671.js";import{e as it}from"./mat4f64-1413b4a7.js";import{c as ke}from"./spatialReferenceEllipsoidUtils-19e2f642.js";var Z;const $e=new WeakMap;let Bt=0,O=Z=class extends xe{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,n){if(e instanceof HTMLImageElement){const o={type:"image-element",src:Ge(e.src,n),crossOrigin:e.crossOrigin};t[r]=o}else if(e instanceof HTMLCanvasElement){const o=e.getContext("2d").getImageData(0,0,e.width,e.height),s={type:"canvas-element",imageData:this._encodeImageData(o)};t[r]=s}else if(e instanceof HTMLVideoElement){const o={type:"video-element",src:Ge(e.src,n),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=o}else if(e instanceof ImageData){const o={type:"image-data",imageData:this._encodeImageData(e)};t[r]=o}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const r=t.substr(t.length-4,4).toLowerCase(),n=t.substr(0,15).toLocaleLowerCase();if(r===".png"||n==="data:image/png;")return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):($e.has(this.data)||$e.set(this.data,++Bt),t($e.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new Z(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return Ht(r,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new Z({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new Z({data:e}):Te(Z,e)}};p([d({type:String,json:{write:xt}})],O.prototype,"url",null),p([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],O.prototype,"data",null),p([wt("data")],O.prototype,"writeData",null),p([vt("data")],O.prototype,"readData",null),p([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],O.prototype,"transparent",null),p([d({json:{write:!0}})],O.prototype,"wrap",void 0),p([d({readOnly:!0})],O.prototype,"contentHash",null),O=Z=p([Q("esri.geometry.support.MeshTexture")],O);const ne=O;var Ce;let C=Ce=class extends xe{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=c(e)?e.get(this):null;if(r)return r;const n=new Ce(this.clonePropertiesWithDeduplication(t));return c(e)&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{color:c(this.color)?this.color.clone():null,colorTexture:c(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:c(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:c(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:c(this.normalTextureTransform)?this.normalTextureTransform:null}}};p([d({type:et,json:{write:!0}})],C.prototype,"color",void 0),p([d({type:ne,json:{write:!0}})],C.prototype,"colorTexture",void 0),p([d({type:ne,json:{write:!0}})],C.prototype,"normalTexture",void 0),p([d({nonNullable:!0,json:{write:!0}})],C.prototype,"alphaMode",void 0),p([d({nonNullable:!0,json:{write:!0}})],C.prototype,"alphaCutoff",void 0),p([d({nonNullable:!0,json:{write:!0}})],C.prototype,"doubleSided",void 0),p([d()],C.prototype,"colorTextureTransform",void 0),p([d()],C.prototype,"normalTextureTransform",void 0),C=Ce=p([Q("esri.geometry.support.MeshMaterial")],C);const Ue=C;var De;let L=De=class extends Ue{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=c(e)?e.get(this):null;if(r)return r;const n=new De(this.clonePropertiesWithDeduplication(t));return c(e)&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:c(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:c(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:c(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:c(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null,occlusionTextureTransform:c(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:c(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:c(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};p([d({type:et,json:{write:!0}})],L.prototype,"emissiveColor",void 0),p([d({type:ne,json:{write:!0}})],L.prototype,"emissiveTexture",void 0),p([d({type:ne,json:{write:!0}})],L.prototype,"occlusionTexture",void 0),p([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],L.prototype,"metallic",void 0),p([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],L.prototype,"roughness",void 0),p([d({type:ne,json:{write:!0}})],L.prototype,"metallicRoughnessTexture",void 0),p([d()],L.prototype,"occlusionTextureTransform",void 0),p([d()],L.prototype,"emissiveTextureTransform",void 0),p([d()],L.prototype,"metallicRoughnessTextureTransform",void 0),L=De=p([Q("esri.geometry.support.MeshMaterialMetallicRoughness")],L);const Zt=L;var ce;const at="esri.geometry.support.MeshVertexAttributes",U=$.getLogger(at);let T=ce=class extends xe{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return X(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},U)}castPosition(e){return e&&e instanceof Float32Array&&U.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),X(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},U)}castUv(e){return X(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},U)}castNormal(e){return X(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},U)}castTangent(e){return X(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},U)}clone(){const e={position:I(this.position),uv:I(this.uv),normal:I(this.normal),tangent:I(this.tangent),color:I(this.color)};return new ce(e)}clonePositional(){const e={position:I(this.position),normal:I(this.normal),tangent:I(this.tangent),uv:this.uv,color:this.color};return new ce(e)}};function Ae(e,t,r,n){const{loggerTag:o,stride:s}=t;return e.length%s!=0?(n.error(o,`Invalid array length, expected a multiple of ${s}`),new r([])):e}function X(e,t,r,n,o){if(!e)return e;if(e instanceof t)return Ae(e,n,t,o);for(const s of r)if(e instanceof s)return Ae(new t(e),n,t,o);if(Array.isArray(e))return Ae(new t(e),n,t,o);{const s=r.map(i=>`'${i.name}'`);return o.error(`Failed to set property, expected one of ${s}, but got ${e.constructor.name}`),new t([])}}function ee(e,t,r){t[r]=Xt(e)}function Xt(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}p([d({json:{write:ee}})],T.prototype,"color",void 0),p([W("color")],T.prototype,"castColor",null),p([d({nonNullable:!0,json:{write:ee}})],T.prototype,"position",void 0),p([W("position")],T.prototype,"castPosition",null),p([d({json:{write:ee}})],T.prototype,"uv",void 0),p([W("uv")],T.prototype,"castUv",null),p([d({json:{write:ee}})],T.prototype,"normal",void 0),p([W("normal")],T.prototype,"castNormal",null),p([d({json:{write:ee}})],T.prototype,"tangent",void 0),p([W("tangent")],T.prototype,"castTangent",null),T=ce=p([Q(at)],T);var re;const lt="esri.geometry.support.MeshComponent",Jt=$.getLogger(lt);let E=re=class extends xe{static from(e){return Te(re,e)}constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return X(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Jt)}castMaterial(e){return Te(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?Zt:Ue,e)}clone(){return new re({faces:I(this.faces),shading:this.shading,material:I(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:I(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new re(r)}};p([d({json:{write:!0}})],E.prototype,"faces",void 0),p([W("faces")],E.prototype,"castFaces",null),p([d({type:Ue,json:{write:!0}})],E.prototype,"material",void 0),p([W("material")],E.prototype,"castMaterial",null),p([d({type:String,json:{write:!0}})],E.prototype,"shading",void 0),p([d({type:Boolean})],E.prototype,"trustSourceNormals",void 0),E=re=p([Q(lt)],E);const K=E;function ct(e,t=!1){return e<=$t?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function Yt(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function qt(e){const t=Qt(e.rings,e.hasZ,me.CCW_IS_HOLE),r=new Array;let n=0,o=0;for(const a of t.polygons){const l=a.count,u=a.index,h=Yt(t.position,3*u,3*l),m=a.holeIndices.map(g=>g-u),f=new Uint32Array(Vt(h,m,3));r.push({position:h,faces:f}),n+=h.length,o+=f.length}const s=Kt(r,n,o),i=Array.isArray(s.position)?He(s.position,3,{originalIndices:s.faces}):He(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(i.buffer),s.faces=i.indices,s}function Kt(e,t,r){if(e.length===1)return e[0];const n=ct(t),o=new Uint32Array(r);let s=0,i=0,a=0;for(const l of e){for(let u=0;u<l.position.length;u++)n[s++]=l.position[u];for(let u=0;u<l.faces.length;u++)o[i++]=l.faces[u]+a;a=s/3}return{position:n,faces:o}}function Qt(e,t,r){const n=e.length,o=new Array(n),s=new Array(n),i=new Array(n);let a=0,l=0,u=0,h=0;for(let g=0;g<n;++g)h+=e[g].length;const m=ct(3*h);let f=0;for(let g=n-1;g>=0;g--){const y=e[g],F=r===me.CCW_IS_HOLE&&er(y);if(F&&n!==1)o[a++]=y;else{let v=y.length;for(let x=0;x<a;++x)v+=o[x].length;const A={index:f,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};A.pathLengths[0]=y.length,y.length>0&&(i[u++]={index:f,count:y.length}),f=F?se(y,y.length-1,-1,m,f,y.length,t):se(y,0,1,m,f,y.length,t);for(let x=0;x<a;++x){const b=o[x];A.holeIndices[x]=f,A.pathLengths[x+1]=b.length,b.length>0&&(i[u++]={index:f,count:b.length}),f=se(b,0,1,m,f,b.length,t)}a=0,A.count>0&&(s[l++]=A)}}for(let g=0;g<a;++g){const y=o[g];y.length>0&&(i[u++]={index:f,count:y.length}),f=se(y,0,1,m,f,y.length,t)}return s.length=l,i.length=u,{position:m,polygons:s,outlines:i}}function se(e,t,r,n,o,s,i){o*=3;for(let a=0;a<s;++a){const l=e[t];n[o++]=l[0],n[o++]=l[1],n[o++]=i?l[2]:0,t+=r}return o/3}function er(e){return!At(e,!1,!1)}var me;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(me||(me={}));const Ie=$.getLogger("esri.geometry.support.meshUtils.centerAt");function tr(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const n=r?.origin??e.origin;c(e.transform)?(r?.geographic!=null&&r.geographic!==e.transform.geographic&&Ie.warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),rr(e.transform,t,n)):we(e.spatialReference,r)?nr(e,t,n):or(e,t,n)}function rr(e,t,r){const n=t.x-r.x,o=t.y-r.y,s=t.hasZ&&r.hasZ?t.z-r.z:0,i=e.origin;e.origin=[i[0]+n,i[1]+o,i[2]+s]}function nr(e,t,r){const n=Wt(e.vertexAttributes,r,{geographic:!0}),{position:o,normal:s,tangent:i}=kt(n,t,{geographic:!0});e.vertexAttributes.position=o,e.vertexAttributes.normal=s,e.vertexAttributes.tangent=i,e.vertexAttributesChanged()}function or(e,t,r){const n=ar,o=ir;if(N(t,o,e.spatialReference)){if(!N(r,n,e.spatialReference)){const s=e.origin;n[0]=s.x,n[1]=s.y,n[2]=s.z,Ie.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}sr(e.vertexAttributes.position,o,n),e.vertexAttributesChanged()}else Ie.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`)}function sr(e,t,r){if(e)for(let n=0;n<e.length;n+=3)for(let o=0;o<3;o++)e[n+o]+=t[o]-r[o]}const ir=M(),ar=M();async function lr(e,t,r){const{loadGLTFMesh:n}=await Oe(fe(()=>import("./loadGLTFMesh-3e99fda1.js"),["./loadGLTFMesh-3e99fda1.js","./main-8eb577c9.js","./preload-helper-388ac9d5.js","./main-7e4e971a.css","./mat3f64-221ce671.js","./BufferView-067dc1c7.js","./vec33-76e2f0a2.js","./DefaultMaterial_COLOR_GAMMA-70078e62.js","./types-e1c0a5bf.js","./mat4f64-1413b4a7.js","./enums-64ab819c.js","./quat-2013e5e2.js","./quatf64-3363c48e.js","./resourceUtils-a8ed8f9e.js","./basicInterfaces-b7051eb1.js","./Indices-56098ffd.js","./georeference-6ce02809.js","./spatialReferenceEllipsoidUtils-19e2f642.js","./imageUtils-c2d0d1ae.js","./earcut-61f7b102.js","./deduplicate-58e5df9b.js"],import.meta.url),r),o=await ut(t,r),s=n(new _({x:0,y:0,z:0,spatialReference:e.spatialReference}),o.url,{resolveFile:cr(o),useTransform:!0,signal:c(r)?r.signal:null});s.then(()=>o.dispose(),()=>o.dispose());const{vertexAttributes:i,components:a}=await s;e.vertexAttributes=i,e.components=a}function cr(e){const t=bt(e.url);return r=>{const n=Tt(r,t,t),o=n?n.replace(/^ *\.\//,""):null;return(o?e.files.get(o):null)??r}}async function ut(e,t){return e instanceof Blob?de.fromBlob(e):typeof e=="string"?new de(e):Array.isArray(e)?ur(e,t):pr(e,t)}async function ur(e,t){const r=new Map;let n=null;const o=await Mt(e.map(async i=>({name:i.name,source:await ut(i instanceof Blob?i:i.source,t)}))),s=[];for(const i of o)i&&(Rt(t)?i.source.dispose():s.push(i));Ft(t);for(const{name:i,source:a}of s)(ue(n)||/\.(gltf|glb)/i.test(i))&&(n=a.url),r.set(i,a.url),a.files&&a.files.forEach((l,u)=>r.set(u,l));if(ue(n))throw new Me("mesh-load-external:missing-files","Missing files to load external mesh source");return new de(n,()=>s.forEach(({source:i})=>i.dispose()),r)}async function pr(e,t){const{default:r}=await Oe(fe(()=>import("./main-8eb577c9.js").then(o=>o.oI),["./main-8eb577c9.js","./preload-helper-388ac9d5.js","./main-7e4e971a.css"],import.meta.url),t),n=typeof e.multipart[0]=="string"?await Promise.all(e.multipart.map(async o=>(await r(o,{responseType:"array-buffer"})).data)):e.multipart;return de.fromBlob(new Blob(n))}let de=class pt{constructor(t,r=()=>{},n=new Map){this.url=t,this.dispose=r,this.files=n}static fromBlob(t){const r=URL.createObjectURL(t);return new pt(r,()=>URL.revokeObjectURL(r))}};function hr(e,t,r){e.vertexAttributes&&e.vertexAttributes.position&&(c(e.transform)?(r?.geographic!=null&&r.geographic!==e.transform.geographic&&$.getLogger("esri.geometry.support.meshUtils.offset").warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),fr(e.transform,t)):we(e.spatialReference,r)?gr(e,t):mr(e,t))}function fr(e,t){const r=e.origin;e.origin=_e(M(),r,t)}function gr(e,t){const r=e.spatialReference,n=e.vertexAttributes.position,o=e.vertexAttributes.normal,s=e.vertexAttributes.tangent,i=new Float64Array(n.length),a=c(o)?new Float32Array(o.length):null,l=c(s)?new Float32Array(s.length):null,u=e.extent.center,h=dr;tt(r,[u.x,u.y,u.z],Ve,ke(r)),rt(Be,Ve),pe(h,t,Be),Ee(n,r,i),c(o)&&c(a)&&je(o,n,i,r,a),c(s)&&c(l)&&Pe(s,n,i,r,l),ht(i,h),Se(i,n,r),c(o)&&c(a)&&Ne(a,n,i,r,o),c(s)&&c(l)&&ze(l,n,i,r,s),e.vertexAttributesChanged()}function mr(e,t){ht(e.vertexAttributes.position,t),e.vertexAttributesChanged()}function ht(e,t){if(e)for(let r=0;r<e.length;r+=3)for(let n=0;n<3;n++)e[r+n]+=t[n]}const dr=M(),Ve=it(),Be=We();function yr(){const{faceDescriptions:e,faceVertexOffsets:t,uvScales:r}=Mr,n=4*e.length,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(2*e.length*3);let l=0,u=0,h=0,m=0;for(let f=0;f<e.length;f++){const g=e[f],y=l/3;for(const v of t)a[m++]=y+v;const F=g.corners;for(let v=0;v<4;v++){const A=F[v];let x=0;i[h++]=.25*r[v][0]+g.uvOrigin[0],i[h++]=g.uvOrigin[1]-.25*r[v][1];for(let b=0;b<3;b++)g.axis[b]!==0?(o[l++]=.5*g.axis[b],s[u++]=g.axis[b]):(o[l++]=.5*A[x++],s[u++]=0)}}return{position:o,normal:s,uv:i,faces:a}}function xr(e,t){const r=e.components[0],n=r.faces,o=Rr[t],s=6*o,i=new Array(6),a=new Array(n.length-6);let l=0,u=0;for(let h=0;h<n.length;h++)h>=s&&h<s+6?i[l++]=n[h]:a[u++]=n[h];if(c(e.vertexAttributes.uv)){const h=new Float32Array(e.vertexAttributes.uv),m=4*o*2,f=[0,1,1,1,1,0,0,0];for(let g=0;g<f.length;g++)h[m+g]=f[g];e.vertexAttributes.uv=h}return e.components=[new K({faces:i,material:r.material}),new K({faces:a})],e}function wr(e=0){const t=Math.round(8*2**e),r=2*t,n=(t-1)*(r+1)+2*r,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*((t-1)*r*2));let l=0,u=0,h=0,m=0;for(let f=0;f<=t;f++){const g=f/t*Math.PI+.5*Math.PI,y=Math.cos(g),F=Math.sin(g);w[2]=F;const v=f===0||f===t,A=v?r-1:r;for(let x=0;x<=A;x++){const b=x/A*2*Math.PI;w[0]=-Math.sin(b)*y,w[1]=Math.cos(b)*y;for(let j=0;j<3;j++)o[l]=.5*w[j],s[l]=w[j],++l;i[u++]=(x+(v?.5:0))/r,i[u++]=f/t,f!==0&&x!==r&&(f!==t&&(a[h++]=m,a[h++]=m+1,a[h++]=m-r),f!==1&&(a[h++]=m,a[h++]=m-r,a[h++]=m-r-1)),m++}}return{position:o,normal:s,uv:i,faces:a}}function vr(e=0){const r=Math.round(16*2**e),n=(5-1)*(r+1)+2*r,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*(4*r));let l=0,u=0,h=0,m=0,f=0;for(let g=0;g<=5;g++){const y=g===0||g===5,F=g<=1||g>=5-1,v=g===2||g===4,A=y?r-1:r;for(let x=0;x<=A;x++){const b=x/A*2*Math.PI,j=y?0:.5;w[0]=j*Math.sin(b),w[1]=j*-Math.cos(b),w[2]=g<=2?.5:-.5;for(let k=0;k<3;k++)o[l++]=w[k],s[u++]=F?k===2?g<=1?1:-1:0:k===2?0:w[k]/j;i[h++]=(x+(y?.5:0))/r,i[h++]=g<=1?1*g/3:g<=3?1*(g-2)/3+1/3:1*(g-4)/3+2/3,v||g===0||x===r||(g!==5&&(a[m++]=f,a[m++]=f+1,a[m++]=f-r),g!==1&&(a[m++]=f,a[m++]=f-r,a[m++]=f-r-1)),f++}}return{position:o,normal:s,uv:i,faces:a}}function $r(e,t){const r=typeof t=="number"?t:t!=null?t.width:1,n=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:r,depth:n};case"north":case"south":return{width:r,height:n};case"east":case"west":return{depth:r,height:n}}}function Ar(e){const t=te.facingAxisOrderSwap[e],r=te.position,n=te.normal,o=new Float64Array(r.length),s=new Float32Array(n.length);let i=0;for(let a=0;a<4;a++){const l=i;for(let u=0;u<3;u++){const h=t[u],m=Math.abs(h)-1,f=h>=0?1:-1;o[i]=r[l+m]*f,s[i]=n[l+m]*f,i++}}return{position:o,normal:s,uv:new Float32Array(te.uv),faces:new Uint32Array(te.faces),isPlane:!0}}const G=1,H=2,V=3,te={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[V,G,H],west:[-V,-G,H],north:[-G,V,H],south:[G,-V,H],up:[G,H,V],down:[G,-H,-V]}};function ie(e,t,r){e.isPlane||br(e),Tr(e,r?.size);const{vertexAttributes:n,transform:o}=Ut(e,t,r);return{vertexAttributes:new T({...n,uv:e.uv}),transform:o,components:[new K({faces:e.faces,material:r&&r.material||null})],spatialReference:t.spatialReference}}function br(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function Tr(e,t){if(t==null)return;const r=typeof t=="number"?[t,t,t]:[t.width!=null?t.width:1,t.depth!=null?t.depth:1,t.height!=null?t.height:1];P[0]=r[0],P[4]=r[1],P[8]=r[2];for(let n=0;n<e.position.length;n+=3){for(let o=0;o<3;o++)w[o]=e.position[n+o];pe(w,w,P);for(let o=0;o<3;o++)e.position[n+o]=w[o]}if(r[0]!==r[1]||r[1]!==r[2]){P[0]=1/r[0],P[4]=1/r[1],P[8]=1/r[2];for(let n=0;n<e.normal.length;n+=3){for(let o=0;o<3;o++)w[o]=e.normal[n+o];pe(w,w,P),Lt(w,w);for(let o=0;o<3;o++)e.normal[n+o]=w[o]}}}const Mr={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Rr={south:0,east:1,north:2,west:3,up:4,down:5},w=M(),P=We(),ft=$.getLogger("esri.geometry.support.meshUtils.rotate");function Fr(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position||t[3]===0)return;const n=e.spatialReference;if(c(e.transform)){r?.geographic!=null&&r.geographic!==e.transform.geographic&&ft.warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const o=r?.origin??e.transform.getOriginPoint(n);Lr(e.transform,t,o)}else{const o=r?.origin??e.origin;we(e.spatialReference,r)?Cr(e,t,o):Dr(e,t,o)}}function Lr(e,t,r){const n=nt(J,r.x,r.y,r.z),o=he(J,n,e.origin);e.applyLocalInverse(o,Ze),e.rotation=Fe(e.rotation,t,oe()),e.applyLocalInverse(o,o),he(o,o,Ze),e.translation=_e(M(),e.translation,o)}function Cr(e,t,r){const n=e.spatialReference,o=ke(n),s=gt;N(r,s,o)||N(e.origin,s,o);const i=e.vertexAttributes.position,a=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,u=new Float64Array(i.length),h=c(a)?new Float32Array(a.length):null,m=c(l)?new Float32Array(l.length):null;tt(o,s,ye,o),rt(Je,ye);const f=Xe;pe(Le(Xe),Le(t),Je),f[3]=t[3],Ee(i,n,u),c(a)&&c(h)&&je(a,i,u,n,h),c(l)&&c(m)&&Pe(l,i,u,n,m),q(u,f,3,s),Se(u,i,n),c(a)&&c(h)&&(q(h,f,3),Ne(h,i,u,n,a)),c(l)&&c(m)&&(q(m,f,4),ze(m,i,u,n,l)),e.vertexAttributesChanged()}function Dr(e,t,r){const n=gt;if(!N(r,n,e.spatialReference)){const o=e.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,ft.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}q(e.vertexAttributes.position,t,3,n),q(e.vertexAttributes.normal,t,3),q(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function q(e,t,r,n=ot){if(!ue(e)){Ct(ye,Gt(t),Le(t));for(let o=0;o<e.length;o+=r){for(let s=0;s<3;s++)J[s]=e[o+s]-n[s];Dt(J,J,ye);for(let s=0;s<3;s++)e[o+s]=J[s]+n[s]}}}const J=M(),Ze=M(),Xe=oe(),ye=it(),Je=We(),gt=M(),mt=$.getLogger("esri.geometry.support.meshUtils.scale");function Ir(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const n=e.spatialReference;if(c(e.transform)){r?.geographic!=null&&r.geographic!==e.transform.geographic&&mt.warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const o=r?.origin??e.transform.getOriginPoint(n);Or(e.transform,t,o)}else{const o=we(e.spatialReference,r),s=r&&r.origin||e.origin;o?_r(e,t,s):Er(e,t,s)}}function Or(e,t,r){const n=nt(Y,r.x,r.y,r.z),o=he(Y,n,e.origin);e.applyLocalInverse(o,Ye);const s=st(M(),e.scale,t);e.scale=s,e.applyLocalInverse(o,o),he(o,o,Ye),e.translation=_e(M(),e.translation,o)}function _r(e,t,r){const n=e.spatialReference,o=ke(n),s=yt;N(r,s,o)||N(e.origin,s,o);const i=e.vertexAttributes.position,a=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,u=new Float64Array(i.length),h=c(a)?new Float32Array(a.length):null,m=c(l)?new Float32Array(l.length):null;Ee(i,n,u),c(a)&&c(h)&&je(a,i,u,n,h),c(l)&&c(m)&&Pe(l,i,u,n,m),dt(u,t,s),Se(u,i,n),c(a)&&c(h)&&Ne(h,i,u,n,a),c(l)&&c(m)&&ze(m,i,u,n,l),e.vertexAttributesChanged()}function Er(e,t,r){const n=yt;if(!N(r,n,e.spatialReference)){const o=e.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,mt.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}dt(e.vertexAttributes.position,t,n),e.vertexAttributesChanged()}function dt(e,t,r=ot){if(e)for(let n=0;n<e.length;n+=3){for(let o=0;o<3;o++)Y[o]=e[n+o]-r[o];st(Y,Y,t);for(let o=0;o<3;o++)e[n+o]=Y[o]+r[o]}}const Y=M(),Ye=M(),yt=M();var D;const z="esri.geometry.Mesh";let R=D=class extends It(Ot.LoadableMixin(_t(Et))){constructor(e){super(e),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new T,this.type="mesh"}initialize(){(ue(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(jt(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(e=>e.clone())}),()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&c(this.external)&&c(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get _boundingInfo(){const e=this.vertexAttributes.position,t=this.spatialReference;if(e.length===0||this.components&&this.components.length===0)return{extent:new Re({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t}),center:new _({x:0,y:0,z:0,spatialReference:t})};const r=c(this.transform)?this.transform.project(e,t):e;let n=1/0,o=1/0,s=1/0,i=-1/0,a=-1/0,l=-1/0,u=0,h=0,m=0;const f=r.length,g=1/(f/3);let y=0;for(;y<f;){const F=r[y++],v=r[y++],A=r[y++];n=Math.min(n,F),o=Math.min(o,v),s=Math.min(s,A),i=Math.max(i,F),a=Math.max(a,v),l=Math.max(l,A),u+=g*F,h+=g*v,m+=g*A}return{extent:new Re({xmin:n,ymin:o,zmin:s,xmax:i,ymax:a,zmax:l,spatialReference:t}),center:new _({x:u,y:h,z:m,spatialReference:t})}}get anchor(){if(c(this.transform))return this.transform.getOriginPoint(this.spatialReference);const e=this._boundingInfo;return new _({x:e.center.x,y:e.center.y,z:e.extent.zmin,spatialReference:this.spatialReference})}get origin(){return c(this.transform)?this.transform.getOriginPoint(this.spatialReference):this._boundingInfo.center}get extent(){return!this.loaded&&c(this.external)&&c(this.external.extent)?this.external.extent.clone():this._boundingInfo.extent}addComponent(e){this.loaded?(this.components||(this.components=[]),this.components.push(K.from(e)),this.notifyChange("components")):$.getLogger(this.declaredClass).error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(e){if(this.loaded){if(this.components){const t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}$.getLogger(this.declaredClass).error("removeComponent()","Provided component is not part of the list of components")}else $.getLogger(this.declaredClass).error("removeComponent()","Mesh must be loaded before applying operations")}rotate(e,t,r,n){return le(be.x,e,B),le(be.y,t,qe),le(be.z,r,Ke),Fe(B,qe,B),Fe(B,Ke,B),Fr(this,B,n),this}offset(e,t,r,n){return this.loaded?(ae[0]=e,ae[1]=t,ae[2]=r,hr(this,ae,n),this):($.getLogger(this.declaredClass).error("offset()","Mesh must be loaded before applying operations"),this)}scale(e,t){return this.loaded?(Ir(this,e,t),this):($.getLogger(this.declaredClass).error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(e,t){return this.loaded?(tr(this,e,t),this):($.getLogger(this.declaredClass).error("centerAt()","Mesh must be loaded before applying operations"),this)}load(e){return c(this.external)&&this.addResolvingPromise(lr(this,this.external.source,e)),Promise.resolve(this)}updateExternalSource(e){this._set("external",e)}clone(){let e=null;if(this.components){const r=new Map,n=new Map;e=this.components.map(o=>o.cloneWithDeduplication(r,n))}const t={components:e,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:c(this.transform)?this.transform.clone():null,external:c(this.external)?{source:this.external.source,extent:c(this.external.extent)?this.external.extent.clone():null}:null};return new D(t)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(e){const t=fe(()=>import("./gltfexport-a3f6761d.js"),["./gltfexport-a3f6761d.js","./main-8eb577c9.js","./preload-helper-388ac9d5.js","./main-7e4e971a.css","./quat-2013e5e2.js","./mat3f64-221ce671.js","./quatf64-3363c48e.js","./georeference-6ce02809.js","./mat4f64-1413b4a7.js","./spatialReferenceEllipsoidUtils-19e2f642.js","./BufferView-067dc1c7.js","./vec33-76e2f0a2.js","./enums-64ab819c.js","./imageutils-f0e5ac1f.js","./resourceUtils-a8ed8f9e.js","./basicInterfaces-b7051eb1.js","./imageUtils-c2d0d1ae.js","./earcut-61f7b102.js","./deduplicate-58e5df9b.js","./Indices-56098ffd.js"],import.meta.url),r=this.load(),n=await Promise.all([t,r]),{toBinaryGLTF:o}=n[0];return o(this,e)}static createBox(e,t){if(!(e instanceof _))return $.getLogger(z).error(".createBox()","expected location to be a Point instance"),null;const r=new D(ie(yr(),e,t));return t&&t.imageFace&&t.imageFace!=="all"?xr(r,t.imageFace):r}static createSphere(e,t){return e instanceof _?new D(ie(wr(t&&t.densificationFactor||0),e,t)):($.getLogger(z).error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(e,t){return e instanceof _?new D(ie(vr(t&&t.densificationFactor||0),e,t)):($.getLogger(z).error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(e,t){if(!(e instanceof _))return $.getLogger(z).error(".createPlane()","expected location to be a Point instance"),null;const r=t?.facing??"up",n=$r(r,t?.size);return new D(ie(Ar(r),e,{...t,size:n}))}static createFromPolygon(e,t){if(!(e instanceof Pt))return $.getLogger(z).error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const r=qt(e);return new D({vertexAttributes:new T({position:r.position}),components:[new K({faces:r.faces,shading:"flat",material:t?.material??null})],spatialReference:e.spatialReference})}static async createFromGLTF(e,t,r){if(!(e instanceof _))throw $.getLogger(z).error(".createfromGLTF()","expected location to be a Point instance"),new Me("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:n}=await Oe(fe(()=>import("./loadGLTFMesh-3e99fda1.js"),["./loadGLTFMesh-3e99fda1.js","./main-8eb577c9.js","./preload-helper-388ac9d5.js","./main-7e4e971a.css","./mat3f64-221ce671.js","./BufferView-067dc1c7.js","./vec33-76e2f0a2.js","./DefaultMaterial_COLOR_GAMMA-70078e62.js","./types-e1c0a5bf.js","./mat4f64-1413b4a7.js","./enums-64ab819c.js","./quat-2013e5e2.js","./quatf64-3363c48e.js","./resourceUtils-a8ed8f9e.js","./basicInterfaces-b7051eb1.js","./Indices-56098ffd.js","./georeference-6ce02809.js","./spatialReferenceEllipsoidUtils-19e2f642.js","./imageUtils-c2d0d1ae.js","./earcut-61f7b102.js","./deduplicate-58e5df9b.js"],import.meta.url),r);return new D(await n(e,t,r))}static createWithExternalSource(e,t,r){const n=r?.extent??null,o=r?.transform?.clone()??new ge;o.origin=[e.x,e.y,e.z??0];const s=e.spatialReference;return new D({external:{source:t,extent:n},transform:o,spatialReference:s})}static createIncomplete(e,t){const r=t?.transform?.clone()??new ge;r.origin=[e.x,e.y,e.z??0];const n=e.spatialReference,o=new D({transform:r,spatialReference:n});return o.addResolvingPromise(Promise.reject(new Me("mesh-incomplete","Mesh resources are not complete"))),o}};p([d({type:[K],json:{write:!0}})],R.prototype,"components",void 0),p([d({type:ge,json:{write:!0}})],R.prototype,"transform",void 0),p([d({constructOnly:!0})],R.prototype,"external",void 0),p([d({readOnly:!0})],R.prototype,"hasExtent",null),p([d({readOnly:!0})],R.prototype,"_boundingInfo",null),p([d({readOnly:!0})],R.prototype,"anchor",null),p([d({readOnly:!0})],R.prototype,"origin",null),p([d({readOnly:!0,json:{read:!1}})],R.prototype,"extent",null),p([d({readOnly:!0,json:{read:!1,write:!0,default:!0}})],R.prototype,"hasZ",void 0),p([d({readOnly:!0,json:{read:!1,write:!0,default:!1}})],R.prototype,"hasM",void 0),p([d({type:T,nonNullable:!0,json:{write:!0}})],R.prototype,"vertexAttributes",void 0),R=D=p([Q(z)],R);const be={x:ve(1,0,0),y:ve(0,1,0),z:ve(0,0,1)},B=oe(),qe=oe(),Ke=oe(),ae=M(),Qe=R;function jr(e,t,r){const n=r.features;r.features=[],delete r.geometryType;const o=St.fromJSON(r);if(o.geometryType="mesh",!r.assetMaps)return o;const s=Wr(t,r.assetMaps),i=o.spatialReference??Nt.WGS84,a=r.globalIdFieldName,{outFields:l}=e,u=c(l)&&l.length>0?Pr(l.includes("*")?null:new Set(l)):()=>({});for(const h of n){const m=Sr(h,a,i,t,s);c(m)&&o.features.push(new zt({geometry:m,attributes:u(h)}))}return o}function Pr(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(const r in t)e.has(r)||delete t[r];return t}}function Sr(e,t,r,n,o){const s=e.attributes[t],i=o.get(s);if(i==null||i.status===S.FAILED||i.url==null)return null;const a=Nr(e,r,n),l=Re.fromJSON(e.geometry);l.spatialReference=r;const u=zr(e.attributes,n,i.projectVertices);return i.status===S.PENDING?Qe.createIncomplete(a,{extent:l,transform:u}):Qe.createWithExternalSource(a,[{name:i.name,source:i.url}],{extent:l,transform:u})}function Nr({attributes:e},t,{transformFieldRoles:r}){return new _({x:e[r.originX],y:e[r.originY],z:e[r.originZ],spatialReference:t})}function zr(e,{transformFieldRoles:t},r){return new ge({translation:[e[t.translationX],-e[t.translationZ],e[t.translationY]],rotation:le([e[t.rotationX],e[t.rotationZ],e[t.rotationY]],e[t.rotationDeg]),scale:[e[t.scaleX],e[t.scaleY],e[t.scaleZ]],geographic:r})}var S;function Wr(e,t){const r=new Map;for(const n of t){const o=n.parentGlobalId;if(o==null)continue;const s=n.assetName,i=n.assetURL,a=n.conversionStatus;let l=r.get(o);if(l==null)switch(l={name:s,status:S.FAILED,url:i,projectVertices:kr(n.flags).projectVertices},r.set(o,l),a){case"COMPLETED":case"SUBMITTED":l.status=S.COMPLETED;break;case"INPROGRESS":l.status=S.PENDING;break;default:l.status=S.FAILED}else console.warn(`Multiple asset parts not expected. Ignoring additional parts. conflicting assetname: ${n.assetName}`)}return r}function kr(e){return{projectVertices:e.includes("PROJECT_VERTICES")}}(function(e){e[e.FAILED=0]="FAILED",e[e.PENDING=1]="PENDING",e[e.COMPLETED=2]="COMPLETED"})(S||(S={}));const qr=Object.freeze(Object.defineProperty({__proto__:null,meshFeatureSetFromJSON:jr},Symbol.toStringTag,{value:"Module"}));export{qr as a,Zt as c,K as g,ne as m,T as p};
