{"version":3,"file":"arcgisLayers-wGDUmqXe.js","sources":["../../node_modules/@arcgis/core/layers/support/arcgisLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{getFilename as r,urlToObject as a}from\"../../core/urlUtils.js\";import{parse as t,parseNonStandardSublayerUrl as s}from\"./arcgisLayerUrl.js\";import{findAssociatedFeatureService as n}from\"./associatedFeatureServiceUtils.js\";import{fetchFeatureService as l}from\"./fetchService.js\";import{sceneServiceLayerTypeToClassName as o}from\"./layerUtils.js\";import{layerLookupMap as i}from\"./lazyLayerLoader.js\";import{fetchArcGISServiceJSON as u}from\"../../support/requestPresets.js\";const c={FeatureLayer:!0,SceneLayer:!0};async function y(e){const r=e.properties?.customParameters,a=await p(e.url,r),t={...e.properties,url:e.url};if(a.layers.length+a.tables.length===0)return null!=a.layerId&&(t.layerId=a.layerId),null!=a.sourceJSON&&(t.sourceJSON=a.sourceJSON),new a.Constructor(t);const s=new(0,(await import(\"../GroupLayer.js\")).default)({title:a.parsedUrl.title});return await m(s,a,t),s}function f(e,r){return e?e.find((e=>e.id===r)):null}async function m(e,r,a){function t(e,r,t,s){const n={...a,layerId:r,sublayerTitleMode:\"service-name\"};return null!=e&&(n.url=e),null!=t&&(n.sourceJSON=t),s(n)}const s=r.sublayerConstructorProvider;for(const{id:n,serverUrl:l}of r.layers){const a=f(r.sublayerInfos,n),o=(a&&s?.(a))??r.Constructor,i=t(l,n,a,(e=>new o(e)));e.add(i)}if(r.tables.length){const a=await h(\"FeatureLayer\");r.tables.forEach((({id:s,serverUrl:n})=>{const l=t(n,s,f(r.tableInfos,s),(e=>new a(e)));e.tables.add(l)}))}}async function p(r,a){let s=t(r);if(null==s&&(s=await d(r,a)),null==s)throw new e(\"arcgis-layers:url-mismatch\",\"The url '${url}' is not a valid arcgis resource\",{url:r});const{serverType:n,sublayer:l}=s;let i;const y={FeatureServer:\"FeatureLayer\",StreamServer:\"StreamLayer\",VectorTileServer:\"VectorTileLayer\"},f=\"FeatureServer\"===n,m=\"SceneServer\"===n,p={parsedUrl:s,Constructor:null,layerId:f||m?l??void 0:void 0,layers:[],tables:[]};switch(n){case\"MapServer\":if(null!=l)i=\"FeatureLayer\";else{i=await b(r,a)?\"TileLayer\":\"MapImageLayer\"}break;case\"ImageServer\":{const e=await u(r,{customParameters:a}),{tileInfo:t,cacheType:s}=e;i=t?\"LERC\"!==t?.format?.toUpperCase()||s&&\"elevation\"!==s.toLowerCase()?\"ImageryTileLayer\":\"ElevationLayer\":\"ImageryLayer\";break}case\"SceneServer\":{const e=await u(s.url.path,{customParameters:a});if(i=\"SceneLayer\",e){const r=e?.layers;if(\"Voxel\"===e?.layerType)i=\"VoxelLayer\";else if(r?.length){const e=r[0]?.layerType;null!=e&&null!=o[e]&&(i=o[e])}}break}case\"3DTilesServer\":throw new e(\"arcgis-layers:unsupported\",\"fromUrl() not supported for 3DTiles layers\");case\"FeatureServer\":if(i=\"FeatureLayer\",null!=l){const e=await u(r,{customParameters:a});p.sourceJSON=e,\"Oriented Imagery Layer\"===e.type&&(i=\"OrientedImageryLayer\")}break;default:i=y[n]}if(c[i]&&null==l){const e=await S(r,n,a);f&&(p.sublayerInfos=e.layerInfos,p.tableInfos=e.tableInfos);if(1!==e.layers.length+e.tables.length)p.layers=e.layers,p.tables=e.tables,f&&e.layerInfos?.length&&(p.sublayerConstructorProvider=await I(e.layerInfos));else if(f||m){const r=e.layerInfos?.[0]??e.tableInfos?.[0];p.layerId=e.layers[0]?.id??e.tables[0]?.id,p.sourceJSON=r,f&&\"Oriented Imagery Layer\"===r?.type&&(i=\"OrientedImageryLayer\")}}return p.Constructor=await h(i),p}async function d(e,t){const n=await u(e,{customParameters:t});let l=null,o=null;const i=n.type;if(\"Feature Layer\"===i||\"Table\"===i?(l=\"FeatureServer\",o=n.id??null):\"indexedVector\"===i?l=\"VectorTileServer\":n.hasOwnProperty(\"mapName\")?l=\"MapServer\":n.hasOwnProperty(\"bandCount\")&&n.hasOwnProperty(\"pixelSizeX\")?l=\"ImageServer\":n.hasOwnProperty(\"maxRecordCount\")&&n.hasOwnProperty(\"allowGeometryUpdates\")?l=\"FeatureServer\":n.hasOwnProperty(\"streamUrls\")?l=\"StreamServer\":v(n)?(l=\"SceneServer\",o=n.id):n.hasOwnProperty(\"layers\")&&v(n.layers?.[0])&&(l=\"SceneServer\"),!l)return null;const c=null!=o?s(e):null;return{title:null!=c&&n.name||r(e),serverType:l,sublayer:o,url:{path:null!=c?c.serviceUrl:a(e).path}}}function v(e){return null!=e&&e.hasOwnProperty(\"store\")&&e.hasOwnProperty(\"id\")&&\"number\"==typeof e.id}async function S(e,r,a){let t,s,n=!1;switch(r){case\"FeatureServer\":{const r=await l(e,{customParameters:a});n=!!r.layersJSON,t=r.layersJSON||r.serviceJSON;break}case\"SceneServer\":{const r=await w(e,a);t=r.serviceInfo,s=r.tableServerUrl;break}default:t=await u(e,{customParameters:a})}const o=t?.layers,i=t?.tables;return{layers:o?.map((e=>({id:e.id}))).reverse()||[],tables:i?.map((e=>({serverUrl:s,id:e.id}))).reverse()||[],layerInfos:n?o:[],tableInfos:n?i:[]}}async function w(e,r){const a=await u(e,{customParameters:r}),t=a.layers?.[0];if(!t)return{serviceInfo:a};try{const{serverUrl:t}=await n(e),s=await u(t,{customParameters:r}).catch((()=>null));return s&&(a.tables=s.tables),{serviceInfo:a,tableServerUrl:t}}catch{return{serviceInfo:a}}}async function h(e){return(0,i[e])()}async function b(e,r){return(await u(e,{customParameters:r})).tileInfo}async function I(e){const r=[],a=[];if(e.forEach((e=>{const{type:t}=e;\"Oriented Imagery Layer\"===t?(r.push(t),a.push(h(\"OrientedImageryLayer\"))):(r.push(t),a.push(h(\"FeatureLayer\")))})),!a.length)return;const t=await Promise.all(a),s=new Map;return r.forEach(((e,r)=>{s.set(e,t[r])})),e=>s.get(e.type)}export{y as fromUrl};\n"],"names":["c","y","e","r","a","p","s","m","f","t","n","l","o","i","h","d","b","u","S","I","v","w"],"mappings":"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","x_google_ignoreList":[0]}