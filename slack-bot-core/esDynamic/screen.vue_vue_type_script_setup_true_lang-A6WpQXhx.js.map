{"version":3,"file":"screen.vue_vue_type_script_setup_true_lang-A6WpQXhx.js","sources":["../../src/fixtures/help/section.vue","../../src/fixtures/help/screen.vue"],"sourcesContent":["<template>\n    <div v-if=\"helpSection.drawn\">\n        <div>\n            <button\n                type=\"button\"\n                class=\"help-section-header flex items-center py-15 px-25 hover:bg-gray-200 cursor-pointer select-none w-full\"\n                @click=\"$emit('expand')\"\n                :content=\"t(helpSection.expanded ? 'help.section.collapse' : 'help.section.expand')\"\n                v-tippy=\"{ placement: 'top-end', hideOnClick: false }\"\n            >\n                <!-- name -->\n                <span class=\"text-lg text-left flex-grow\">{{ helpSection.header }}</span>\n\n                <!-- dropdown icon -->\n                <div class=\"dropdown-icon\" :class=\"{ 'transform -rotate-180': helpSection.expanded }\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n                        <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n                        <path d=\"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z\" />\n                    </svg>\n                </div>\n            </button>\n            <transition name=\"help-item\" mode=\"out-in\">\n                <div\n                    v-show=\"helpSection.expanded\"\n                    v-html=\"helpSection.info\"\n                    class=\"ramp-markdown section-body px-20 pt-5 ml-10 overflow-hidden\"\n                ></div>\n            </transition>\n        </div>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useI18n } from 'vue-i18n';\n\nconst { t } = useI18n();\n\ndefineProps({\n    helpSection: {\n        type: Object,\n        required: true\n    }\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.help-section-header .dropdown-icon {\n    transition: transform 0.3s cubic-bezier(0.35, 0, 0.25, 1);\n}\n.help-item-leave-active,\n.help-item-enter-active {\n    @apply max-h-500;\n    transition: all 0.3s;\n}\n.help-item-enter-active {\n    transition-delay: 0.1s;\n}\n.help-item-leave-to,\n.help-item-enter {\n    @apply max-h-0 opacity-0;\n}\n</style>\n","<template>\n    <panel-screen :panel=\"panel\">\n        <template #header>\n            {{ t('help.title') }}\n        </template>\n        <template #content>\n            <div class=\"h-26 mb-8 mx-8\">\n                <input\n                    type=\"search\"\n                    class=\"rv-help-search-bar border-b w-full text-base py-8 outline-none focus:shadow-outline border-gray-600 h-full min-w-0\"\n                    :placeholder=\"t('help.search')\"\n                    v-model=\"searchTerm\"\n                    :aria-label=\"t('help.search')\"\n                    @input=\"doSearch(searchTerm, helpSections)\"\n                    @keypress.enter.prevent\n                    enterkeyhint=\"done\"\n                />\n            </div>\n            <div v-if=\"noResults\">\n                <p>{{ t('help.noResults') }}</p>\n            </div>\n            <help-section\n                v-for=\"(section, idx) in helpSections\"\n                :helpSection=\"section\"\n                :key=\"idx\"\n                @expand=\"toggleExpanded(section)\"\n            ></help-section>\n        </template>\n    </panel-screen>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, inject, onBeforeMount, onBeforeUnmount, ref, watch } from 'vue';\nimport type { PropType } from 'vue';\n\nimport type { InstanceAPI, PanelInstance } from '@/api';\nimport { useHelpStore } from './store';\nimport HelpSection from './section.vue';\nimport axios from 'redaxios';\nimport { marked } from 'marked';\nimport { useI18n } from 'vue-i18n';\n\nconst iApi = inject<InstanceAPI>('iApi')!;\nconst helpStore = useHelpStore();\nconst { t } = useI18n();\n\ndefineProps({\n    panel: {\n        type: Object as PropType<PanelInstance>,\n        required: true\n    }\n});\n\nconst location = computed<string>(() => helpStore.location);\nconst helpSections = ref<Array<any>>([]);\nconst originalTextArray = ref<Array<any>>([]);\nconst watchers = ref<Array<Function>>([]);\n\nconst noResults = ref<boolean>(false);\nlet numResults: number;\nlet searchTerm: string;\n\n//find search term in info sections without impacting the HTML tags\nfunction findInfo(searchTerm: string, section: any) {\n    const segments: string[] = section.info.split(/(<[^>]*>)/);\n    for (const [i, segment] of segments.entries()) {\n        if (i % 2 === 0) {\n            if (segment.toLowerCase().indexOf(searchTerm.toLowerCase()) > -1) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n// highlight the search term\nfunction highlightSearchTerm(searchTerm: string, idx: number) {\n    const originalText = originalTextArray.value[idx];\n    // split text around <a> and <img> to preserve links\n    const segments: string[] = originalText.split(/(<[^>]*>)/);\n    let highlightedText: string = '';\n    for (const [i, segment] of segments.entries()) {\n        if (i % 2 === 0) {\n            highlightedText += segment.replace(\n                new RegExp(searchTerm, 'gi'),\n                (match: string) => `<mark>${match}</mark>`\n            );\n        } else {\n            highlightedText += segment;\n        }\n    }\n    // text to display set with highlights\n    helpSections.value[idx].info = highlightedText;\n}\n\n// find the help sections which contain the search term\nfunction doSearch(searchTerm: string, sections: any) {\n    numResults = 0;\n    sections.forEach((section: any, index: number) => {\n        //reset the text to original before looking for search term\n        section.info = originalTextArray.value[index];\n        //find the search term in each section\n        section.drawn =\n            findInfo(searchTerm, section) || section.header.toLowerCase().indexOf(searchTerm.toLowerCase()) > -1;\n        numResults = section.drawn ? numResults + 1 : numResults;\n        section.expanded = section.drawn && searchTerm.length > 2;\n        if (section.drawn && searchTerm.length > 2) {\n            highlightSearchTerm(searchTerm, index);\n        }\n    });\n    noResults.value = numResults === 0;\n}\n\nfunction toggleExpanded(section: any) {\n    section.expanded = !section.expanded;\n}\n\nonBeforeMount(() => {\n    // make help request when fixture loads or locale changes\n    watchers.value.push(\n        watch(\n            () => iApi.language,\n            (newLocale: any, oldLocale: any) => {\n                if (newLocale === oldLocale) return;\n                // path to where HELP is hosted is different if RAMP is built as prod library\n                const renderer = new marked.Renderer();\n                const loc = location.value.slice(-1) === '/' ? location.value : `${location.value}/`;\n                // make it easier to use images in markdown by prepending path to href if href is not an external source\n                // this avoids the need for ![](help/images/myimg.png) to just ![](myimg.png). This overrides the default image renderer completely.\n                renderer.image = (href: string, title: string, text: string) => {\n                    if (href.indexOf('http') === -1) {\n                        href = `${loc}images/` + href;\n                    }\n                    return `<img src=\"${href}\" alt=\"${text}\">`;\n                };\n                axios.get(`${loc}${newLocale}.md`).then(r => {\n                    // matches help sections from markdown file where each section begins with one hashbang and a space\n                    // followed by the section header, exactly 2 newlines, then up to but not including a double newline\n                    // note that the {2,} below is used as the double line deparator since each double new line is actually 6\n                    // but we'll also accept more than a double space\n                    const reg = /^#\\s(.*)\\n{2}(?:.+|\\n(?!\\n{2,}))*/gm;\n                    // remove new line character ASCII (13) so that above regex is compatible with all\n                    // operating systems (markdown file varies by OS new line preference)\n                    let helpMd = r.data.replace(new RegExp(String.fromCharCode(13), 'g'), '');\n                    helpSections.value = [];\n                    let section;\n                    while ((section = reg.exec(helpMd))) {\n                        helpSections.value.push({\n                            header: section[1],\n                            // parse markdown on info section, split/splice/join removes the header\n                            // since we can't put info section into its own regex grouping\n                            info: marked(section[0].split('\\n').splice(2).join('\\n'), {\n                                renderer\n                            }),\n                            drawn: true,\n                            expanded: false\n                        });\n                        //copy of the original text to refer to after highlighting\n                        originalTextArray.value.push(\n                            marked(section[0].split('\\n').splice(2).join('\\n'), {\n                                renderer\n                            })\n                        );\n                    }\n                });\n            },\n            { immediate: true }\n        )\n    );\n});\n\nonBeforeUnmount(() => {\n    watchers.value.forEach(unwatch => unwatch());\n});\n</script>\n\n<style lang=\"scss\" scoped></style>\n"],"names":["t","useI18n","iApi","inject","helpStore","useHelpStore","location","computed","helpSections","ref","originalTextArray","watchers","noResults","numResults","searchTerm","findInfo","section","segments","i","segment","highlightSearchTerm","idx","highlightedText","match","doSearch","sections","index","toggleExpanded","onBeforeMount","watch","newLocale","oldLocale","renderer","marked","loc","href","title","text","axios","r","reg","helpMd","onBeforeUnmount","unwatch"],"mappings":";;;;;;;;;;;AAmCM,UAAA,EAAE,GAAAA,MAAMC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACOR,UAAAC,IAAOC,EAAoB,MAAM,GACjCC,IAAYC,KACZ,EAAE,GAAAL,MAAMC,KASRK,IAAWC,EAAiB,MAAMH,EAAU,QAAQ,GACpDI,IAAeC,EAAgB,CAAA,CAAE,GACjCC,IAAoBD,EAAgB,CAAA,CAAE,GACtCE,IAAWF,EAAqB,CAAA,CAAE,GAElCG,IAAYH,EAAa,EAAK;AAChC,QAAAI,GACAC;AAGK,aAAAC,EAASD,GAAoBE,GAAc;AAChD,YAAMC,IAAqBD,EAAQ,KAAK,MAAM,WAAW;AACzD,iBAAW,CAACE,GAAGC,CAAO,KAAKF,EAAS;AAC5B,YAAAC,IAAI,MAAM,KACNC,EAAQ,cAAc,QAAQL,EAAW,YAAa,CAAA,IAAI;AACnD,iBAAA;AAIZ,aAAA;AAAA,IACX;AAGS,aAAAM,EAAoBN,GAAoBO,GAAa;AAGpD,YAAAJ,IAFeP,EAAkB,MAAMW,CAAG,EAER,MAAM,WAAW;AACzD,UAAIC,IAA0B;AAC9B,iBAAW,CAACJ,GAAGC,CAAO,KAAKF,EAAS;AAC5B,QAAAC,IAAI,MAAM,IACVI,KAAmBH,EAAQ;AAAA,UACvB,IAAI,OAAOL,GAAY,IAAI;AAAA,UAC3B,CAACS,MAAkB,SAASA,CAAK;AAAA,QAAA,IAGlBD,KAAAH;AAId,MAAAX,EAAA,MAAMa,CAAG,EAAE,OAAOC;AAAA,IACnC;AAGS,aAAAE,EAASV,GAAoBW,GAAe;AACpC,MAAAZ,IAAA,GACJY,EAAA,QAAQ,CAACT,GAAcU,MAAkB;AAEtC,QAAAV,EAAA,OAAON,EAAkB,MAAMgB,CAAK,GAE5CV,EAAQ,QACJD,EAASD,GAAYE,CAAO,KAAKA,EAAQ,OAAO,YAAc,EAAA,QAAQF,EAAW,YAAA,CAAa,IAAI,IACzFD,IAAAG,EAAQ,QAAQH,IAAa,IAAIA,GAC9CG,EAAQ,WAAWA,EAAQ,SAASF,EAAW,SAAS,GACpDE,EAAQ,SAASF,EAAW,SAAS,KACrCM,EAAoBN,GAAYY,CAAK;AAAA,MACzC,CACH,GACDd,EAAU,QAAQC,MAAe;AAAA,IACrC;AAEA,aAASc,EAAeX,GAAc;AAC1B,MAAAA,EAAA,WAAW,CAACA,EAAQ;AAAA,IAChC;AAEA,WAAAY,EAAc,MAAM;AAEhB,MAAAjB,EAAS,MAAM;AAAA,QACXkB;AAAA,UACI,MAAM3B,EAAK;AAAA,UACX,CAAC4B,GAAgBC,MAAmB;AAChC,gBAAID,MAAcC,EAAW;AAEvB,kBAAAC,IAAW,IAAIC,EAAO,YACtBC,IAAM5B,EAAS,MAAM,MAAM,EAAE,MAAM,MAAMA,EAAS,QAAQ,GAAGA,EAAS,KAAK;AAGjF,YAAA0B,EAAS,QAAQ,CAACG,GAAcC,GAAeC,OACvCF,EAAK,QAAQ,MAAM,MAAM,OAClBA,IAAA,GAAGD,CAAG,YAAYC,IAEtB,aAAaA,CAAI,UAAUE,CAAI,OAEpCC,GAAA,IAAI,GAAGJ,CAAG,GAAGJ,CAAS,KAAK,EAAE,KAAK,CAAKS,MAAA;AAKzC,oBAAMC,IAAM;AAGZ,kBAAIC,IAASF,EAAE,KAAK,QAAQ,IAAI,OAAO,MAAyB,GAAG,GAAG,EAAE;AACxE,cAAA/B,EAAa,QAAQ;AACjB,kBAAAQ;AACJ,qBAAQA,IAAUwB,EAAI,KAAKC,CAAM;AAC7B,gBAAAjC,EAAa,MAAM,KAAK;AAAA,kBACpB,QAAQQ,EAAQ,CAAC;AAAA;AAAA;AAAA,kBAGjB,MAAMiB,EAAOjB,EAAQ,CAAC,EAAE,MAAM;AAAA,CAAI,EAAE,OAAO,CAAC,EAAE,KAAK;AAAA,CAAI,GAAG;AAAA,oBACtD,UAAAgB;AAAA,kBAAA,CACH;AAAA,kBACD,OAAO;AAAA,kBACP,UAAU;AAAA,gBAAA,CACb,GAEDtB,EAAkB,MAAM;AAAA,kBACpBuB,EAAOjB,EAAQ,CAAC,EAAE,MAAM;AAAA,CAAI,EAAE,OAAO,CAAC,EAAE,KAAK;AAAA,CAAI,GAAG;AAAA,oBAChD,UAAAgB;AAAA,kBAAA,CACH;AAAA,gBAAA;AAAA,YAET,CACH;AAAA,UACL;AAAA,UACA,EAAE,WAAW,GAAK;AAAA,QACtB;AAAA,MAAA;AAAA,IACJ,CACH,GAEDU,EAAgB,MAAM;AAClB,MAAA/B,EAAS,MAAM,QAAQ,CAAWgC,MAAAA,EAAS,CAAA;AAAA,IAAA,CAC9C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}