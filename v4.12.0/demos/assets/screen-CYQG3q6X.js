import{dO as C,dP as R,ge as E,dQ as F,dS as y,e3 as G,dU as T,d4 as t,d2 as o,d3 as r,dZ as H,d$ as u,g6 as P,g5 as K,dV as L,e8 as k,e9 as $,e1 as j,a2 as M,e4 as O,e5 as Z,e7 as I,d_ as m,e0 as A,dY as B,e6 as Q,eb as X,d1 as W,gx as Y,dT as J,dW as z,dX as N,ed as V,hQ as ee,hR as te,hS as se,hT as U,hU as q}from"./main-D6UWMbWJ.js";import"./preload-helper-ExcqyqRp.js";const oe={class:"rv-geosearch-bar relative h-26 mx-8 mb-8"},ae=["placeholder","value","aria-label"],ne={class:"absolute inset-y-0 right-8 grid w-10 place-content-center"},re=["aria-label","content"],le=C({__name:"search-bar",setup(S){const{t:l}=R(),d=E(),c=F(),g=y(()=>d.searchVal),h=y(()=>['"',"$","!","*","+","?","^","{","}","(",")","|","[","]"].filter(b=>d.searchVal.includes(b)).join("")),f=b=>{d.setSearchTerm(b),d.setSearchRegex(b)},v=G(500,b=>{f(b)});return(b,e)=>{const i=T("tippy");return t(),o("div",oe,[r("input",{type:"text",class:H(["border-b w-full text-base py-8 outline-none focus:shadow-outline border-gray-600 h-full min-w-0",{"border-yellow-500":h.value}]),placeholder:u(l)("geosearch.searchText"),value:g.value,onInput:e[0]||(e[0]=s=>u(v)(s.target.value)),onKeyup:e[1]||(e[1]=P(s=>{u(c).mobileView&&s.target.blur()},["enter"])),"aria-label":u(l)("geosearch.searchText"),onKeypress:e[2]||(e[2]=P(K(()=>{},["prevent"]),["enter"])),enterkeyhint:"done"},null,42,ae),r("span",ne,[h.value?L((t(),o("button",{key:0,class:"cursor-default","aria-label":u(l)("geosearch.badChars",{chars:h.value}),content:u(l)("geosearch.badChars",{chars:h.value})},e[3]||(e[3]=[k(" âš  ")]),8,re)),[[i]]):$("",!0)])])}}}),ce={class:"rv-geosearch-top-filters sm:flex items-center w-full ml-8 mb-14"},ie={class:"w-fit inline-block sm:w-1/2 h-26 mb-8 sm:mb-0 pr-16 sm:pr-0"},de=["value","aria-label"],ue={value:"",disabled:"",hidden:""},pe={class:"sm:w-1/2 h-26 sm:mx-16 flex"},he=["value","aria-label"],ve={value:"",disabled:"",hidden:""},be=["disabled","content","aria-label"],_e=C({__name:"top-filters",setup(S){const{t:l}=R(),d=j("iApi"),c=E(),g=M([]),h=M([]),f=M([]),v=y(()=>c.queryParams),b=y(()=>d.language),e=p=>c.setProvince(p),i=p=>c.setType(p),s=()=>{e({}),i({})},x=()=>{c.initService(d.language,d.fixture.get("geosearch").config);const p=g.value.find(n=>v.value.province===n.name)?.code,_=h.value.find(n=>v.value.type===n.name)?.code;c.getProvinces.then(n=>{g.value=n,e({province:n.find(w=>w.code===p)?.name,forceReRun:!0})}),c.getTypes.then(n=>{h.value=n,i({type:n.find(w=>w.code===_)?.name,forceReRun:!0})})};return O(()=>{x(),f.value.push(Z(b,x))}),I(()=>{f.value.forEach(p=>p())}),(p,_)=>{const n=T("truncate"),w=T("tippy");return t(),o("div",ce,[r("div",ie,[L((t(),o("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer",value:v.value.province,"aria-label":u(l)("geosearch.filters.province"),onChange:_[0]||(_[0]=a=>e({province:a.target.value}))},[L((t(),o("option",ue,[k(m(u(l)("geosearch.filters.province")),1)])),[[n]]),(t(!0),o(A,null,B(g.value,a=>L((t(),o("option",{key:a.code},[k(m(a.name),1)])),[[n]])),128))],40,de)),[[n]])]),r("div",pe,[L((t(),o("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer max-w-150",value:v.value.type,"aria-label":u(l)("geosearch.filters.type"),onChange:_[1]||(_[1]=a=>i({type:a.target.value}))},[r("option",ve,m(u(l)("geosearch.filters.type")),1),(t(!0),o(A,null,B(h.value,a=>(t(),o("option",{key:a.code},m(a.name),1))),128))],40,he)),[[n]]),L((t(),o("button",{type:"button",class:"text-gray-500 w-1/8 h-24 pl-8 pr-16 sm:pr-8 hover:text-black disabled:cursor-default disabled:text-gray-400",disabled:!v.value.type&&!v.value.province,onClick:s,content:u(l)("geosearch.filters.clear"),"aria-label":u(l)("geosearch.filters.clear")},_[2]||(_[2]=[r("div",{class:"rv-geosearch-icon"},[r("svg",{class:"fill-current w-18 h-18",viewBox:"0 0 23 21"},[r("path",{d:"M 14.7574,20.8284L 17.6036,17.9822L 14.7574,15.1716L 16.1716,13.7574L 19.0178,16.568L 21.8284,13.7574L 23.2426,15.1716L 20.432,17.9822L 23.2426,20.8284L 21.8284,22.2426L 19.0178,19.3964L 16.1716,22.2426L 14.7574,20.8284 Z M 2,2L 19.9888,2.00001L 20,2.00001L 20,2.01122L 20,3.99999L 19.9207,3.99999L 13,10.9207L 13,22.909L 8.99999,18.909L 8.99999,10.906L 2.09405,3.99999L 2,3.99999L 2,2 Z "})])],-1)]),8,be)),[[w,{placement:"bottom"}]])])])}}}),ge={class:"rv-geosearch-bottom-filters"},fe={class:"bg-white"},me={class:"ml-8 cursor-pointer font-normal"},ye=["checked"],xe=C({__name:"bottom-filters",setup(S){const{t:l}=R(),d=j("iApi"),c=E(),g=y(()=>c.resultsVisible),h=G(300,e=>{v(e).then(i=>{f({extent:i,visible:g.value})})}),f=e=>{c.setMapExtent(e)},v=async e=>e.sr.wkid===4326?e:await d.geo.proj.projectGeometry(4326,e),b=e=>{v(d.geo.map.getExtent()).then(i=>{f({extent:i,visible:e})})};return Q(()=>{d.event.on(X.MAP_EXTENTCHANGE,h,"geosearch_map_extent")}),I(()=>{d.event.off("geosearch_map_extent")}),(e,i)=>(t(),o("div",ge,[r("div",fe,[r("label",me,[r("input",{type:"checkbox",class:"border-2 mx-8 border-gray-600 cursor-pointer",checked:g.value,onChange:i[0]||(i[0]=s=>b(s.target.checked)),onKeypress:i[1]||(i[1]=P(K(()=>{},["prevent"]),["enter"]))},null,40,ye),k(m(u(l)("geosearch.visible")),1)])])]))}}),we={},Le={class:"w-full h-6 relative overflow-hidden rounded-full indeterminate mb-14"},$e={class:"h-full progressbar bg-blue-800 rounded-full top-0","aria-valuemin":"0","aria-valuemax":"100"},ke={class:"flex items-center h-full"};function Se(S,l){return t(),o("div",Le,[r("div",$e,[r("span",ke,[Y(S.$slots,"default",{},void 0,!0)])])])}const Te=W(we,[["render",Se],["__scopeId","data-v-64b4e253"]]),Ce={class:"flex flex-col h-full"},Re={key:1,class:"text-red-900 text-xs px-8 mb-10"},Ee={key:2,class:"px-8 mb-10 py-8 flex-grow text-wrap border-y border-gray-600 overflow-y-auto"},Me={class:"relative h-48"},Ve={class:"font-bold text-blue-600"},Pe={key:3,class:"rv-results-list flex-grow mb-5 border-t border-b border-gray-600 overflow-y-auto"},Ae=["onClick"],Be={class:"rv-result-description px-8"},je={class:"flex-1 text-left truncate font-bold leading-tight"},ze=["innerHTML"],Ne={key:0,class:"text-gray-600 text-sm"},Ue={key:1,class:"hidden"},qe={key:2,class:"text-sm font-normal"},De=C({__name:"screen",props:{panel:{type:Object}},setup(S){const{t:l}=R(),d=j("iApi"),c=E(),g=y(()=>c.searchVal.replace(/["!*$+?^{}()|[\]\\]/g,"").trim()),h=y(()=>c.searchResults),f=y(()=>c.loadingResults),v=y(()=>c.failedServices),b=y(()=>c.GSservice.config.fsaUrl),e=async s=>{if(s.flav==="fsa"&&b.value){const p=b.value.replace(ee,s.name),[_,n]=await te(se(p));if(!_){const w=new U("fsazoom",n.features[0].geometry.rings,q.fromConfig(n.spatialReference),!0);d.geo.map.zoomMapTo(w);return}}const x=new U("zoomies",[[[s.bbox[0],s.bbox[1]],[s.bbox[0],s.bbox[3]],[s.bbox[2],s.bbox[3]],[s.bbox[2],s.bbox[1]],[s.bbox[0],s.bbox[1]]]],q.latLongSR(),!0);d.geo.map.zoomMapTo(x)},i=(s,x)=>{const p=s.replace(new RegExp(`${c.searchRegex}`,"gi"),_=>'<span class="font-bold text-blue-600">'+_+"</span>");return x?p+",":p};return(s,x)=>{const p=J("panel-screen"),_=T("truncate"),n=T("focus-item"),w=T("focus-list");return t(),z(p,{panel:S.panel},{header:N(()=>[k(m(u(l)("geosearch.title")),1)]),content:N(()=>[r("div",Ce,[V(le),V(_e),f.value?(t(),z(Te,{key:0,class:"flex-none"})):$("",!0),v.value.length>0&&!f.value?(t(),o("div",Re,m(u(l)("geosearch.serviceError",{services:v.value.join(", ")})),1)):$("",!0),g.value&&h.value.length===0&&!f.value?(t(),o("div",Ee,[r("span",Me,[k(m(u(l)("geosearch.noResults")),1),r("span",Ve,'"'+m(g.value)+'"',1)])])):$("",!0),h.value.length>0?L((t(),o("ul",Pe,[(t(!0),o(A,null,B(h.value,(a,D)=>(t(),o("li",{class:"relative h-56",key:D},[L((t(),o("button",{type:"button",class:"absolute inset-0 h-full w-full hover:bg-gray-300 default-focus-style",onClick:Ge=>e(a),style:{"border-bottom":"1px solid lightgray"},"truncate-trigger":""},[r("div",Be,[L((t(),o("div",je,[r("span",{innerHTML:i(a.name,a.location.province)},null,8,ze),a.location.province?(t(),o("span",Ne,m(a.location.city?" "+a.location.city+", "+a.location.province.abbr:" "+a.location.province.abbr),1)):$("",!0),a.type?(t(),o("span",Ue,"; ")):$("",!0),a.type?(t(),o("span",qe,[x[0]||(x[0]=r("br",null,null,-1)),k(m(a.type),1)])):$("",!0)])),[[_,{externalTrigger:!0,options:{placement:"top-start"}}]])])],8,Ae)),[[n,"show-truncate"]])]))),128))])),[[w]]):$("",!0),V(xe,{class:"mt-auto"})])]),_:1},8,["panel"])}}});export{De as default};
