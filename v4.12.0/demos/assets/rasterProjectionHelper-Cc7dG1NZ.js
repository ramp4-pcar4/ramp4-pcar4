const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BNk7091c.js","./preload-helper-ExcqyqRp.js","./dynamic-import-helper-BheWnx7M.js","./main-D6UWMbWJ.js","./main-DCJluy1C.css","./draw-store-BaFsNOTl.js","./GraphicsLayer-dZfMZHiC.js","./GraphicsCollection-B4inrSzy.js","./Layer-CrpAg4i7.js","./TimeExtent-CVFHym4n.js","./ScaleRangeLayer-CANL8iBb.js","./layerContainerType-C5CzMsLd.js","./jsonUtils-BVTTU8XA.js","./parser-BOplPg1_.js","./mat4f32-DcsiF_Rp.js","./mat4-mplESjCB.js","./common-DQOJ18NT.js","./ElevationInfo-DLPjeENV.js","./lengthUtils-B1iOgQDj.js","./intl-D8pxRaLS.js","./SketchViewModel-BQEEJoEu.js","./UpdatingHandles-CLyw9aof.js","./projection-F5U3p10J.js","./globalCss-geu-g-r4.js","./Queue-Bp8J9hIN.js","./signal-_szBxGG7.js","./Version-DeyywoNs.js","./quantityUtils-B7WFJP6j.js","./vec2-maR1OrZI.js","./vec2f64-DohEyf3f.js","./vec32-DvB22h0L.js","./projectVectorToVector-2U_T6yxL.js","./projectPointToVector-CP3mj71q.js","./geodesicUtils-CINGW30v.js","./Query-VeA4-Qk_.js","./Field-BRKBBmM6.js","./fieldType-B-0DY-YK.js","./vec42-CKs01hkn.js","./vec4f64-o2zAXfmz.js","./plane-DXyNbfXV.js","./mat3f64-q3fE-ZOt.js","./mat4f64-Dk4dwAN8.js","./quatf64-aQ5IuZRd.js","./sphere-MYAntte_.js","./mat3-CruJiiUv.js","./jsxFactory-HPYy2V_L.js","./uuid-Cl5lrJ4c.js","./layerViewUtils-eEg1cHt4.js","./widget-GoJNk-6R.js","./diffUtils-BMpoATJS.js","./ViewingMode-HRfKv6NR.js","./meshVertexSpaceUtils-DurlDegv.js","./MeshLocalVertexSpace-DKI2cxe_.js","./hydratedFeatures-CzW8xS0g.js","./Scheduler-BTF2H21O.js","./geometryEngineBase-8g0RzW7z.js","./_commonjsHelpers-DCkdB7M8.js","./hydrated-C5WzuFt9.js","./mat2d-D9DBP-jx.js","./quat-DOvbuK1U.js","./drapedUtils-gb-eeqgf.js","./utils-BQBvadb7.js","./substitute-CUVC4DC3.js"])))=>i.map(i=>d[i]);
import{_ as _n}from"./preload-helper-ExcqyqRp.js";import{ar as j,bs as O,bR as Tn,ag as on,ap as E,bS as vn,s as dn,bT as T,bU as _,bV as cn,bW as Cn,bX as zn,O as wn}from"./main-D6UWMbWJ.js";import{k as B,K as Ln,O as C,L as On,q as fn}from"./projection-F5U3p10J.js";var Z;function Mn(n,t,i){return!On(n,t,i)}function z(n,t,i){const o=Mn(n,t,i);if(o&&!B())throw new dn("rasterprojectionhelper-project","projection engine is not loaded");return o}(function(n){n[n.None=0]="None",n[n.North=1]="North",n[n.South=2]="South",n[n.Both=3]="Both"})(Z||(Z={}));const un=(n,t,i,o=0)=>{if(i[0]===1)return[0,0];let r=1,e=-1,s=1,l=-1;for(let u=0;u<n.length;u+=2)isNaN(n[u])||(r=r>n[u]?n[u]:r,e=e>n[u]?e:n[u],s=s>n[u+1]?n[u+1]:s,l=l>n[u+1]?l:n[u+1]);const{cols:a,rows:c}=t,f=(e-r)/a/i[0],d=(l-s)/c/i[1],p=2*o;let x=0,m=!1,h=[0,0];for(let u=0;u<a-3;u++){for(let M=0;M<c-3;M++){const g=u*c*2+2*M,y=(n[g]+n[g+4]+n[g+4*c]+n[g+4*c+4])/4,w=(n[g+1]+n[g+5]+n[g+4*c+1]+n[g+4*c+5])/4,R=Math.abs((y-n[g+2*c+2])/f),b=Math.abs((w-n[g+2*c+3])/d);if(R+b>x&&(x=R+b,h=[R,b]),p&&x>p){m=!0;break}}if(m)break}return h},Wn={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},F=32,Y=4,D=Y,U=new Map,Q=new Map,J=500,In=39.37,$n=96;let K=null;async function Un(){K&&B()||(B()||await Ln(),K=await _n(()=>import("./index-BNk7091c.js").then(n=>n.V),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62]),import.meta.url))}function jn(n,t,i){return z(n.spatialReference,t),i?fn(t,n.spatialReference,n):fn(n.spatialReference,t,n)}function Qn(n,t,i,o=null){const r=n.spatialReference;if(!r||!t||r.equals(t))return n;z(r,t,o);const e=i.center,s=new j({xmin:e.x-n.x/2,xmax:e.x+n.x/2,ymin:e.y-n.y/2,ymax:e.y+n.y/2,spatialReference:r}),l=C(s,t,o),a=N(t);return l==null||a!=null&&l.width>=a?q(n,r,t):{x:l.width,y:l.height}}function q(n,t,i){const o=O(t)/O(i);return{x:n.x*o,y:n.y*o}}function nn(n,t,i){const{spatialReference:o}=i;if(!o||!t||o.equals(t))return n;if(o.isGeographic&&t.isGeographic)return q(n,o,t);if(z(o,t),!K)throw new dn("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:r,y:e}=n;const s=(r+e)/2*O(o);let l=1;s>30&&(l=30/s,r*=l,e*=l);const a=256,c=r*a/2,f=e*a/2,{x:d,y:p}=i.center,x=[];for(let S=0;S<=a;S++)x.push([d-c,p-f+S*e]);for(let S=1;S<=a;S++)x.push([d-c+S*r,p+f]);for(let S=1;S<=a;S++)x.push([d+c,p+f-S*e]);for(let S=1;S<a;S++)x.push([d+c-S*r,p-f]);x.push(x[0]);const m=new on({rings:[x],spatialReference:o}),h=C(m,t);if(!h)return q(n,o,t);const u=h.extent,M=N(t);if(u==null||M!=null&&u.width>=M)return q(n,o,t);const g=K.planarArea(h),y=r*e*a*a,w=Math.sqrt(g/y)/l,R={x:u.width/l/a,y:u.height/l/a},b={x:r*w,y:e*w},P=R.x*R.y;return Math.abs(P-b.x*b.y)/P<.1?R:b}function tn(n,t){return(typeof n=="number"?n:(n.x+n.y)/2)*O(t)*$n*In}function Hn(n,t){const{pixelSize:i,extent:o}=n;return tn(nn(i,t,o),t)}function k(n,t=.01){return O(n)?t/O(n):0}function xn(n,t,i=null,o=!0){const r=n.spatialReference;if(r.equals(t))return n;z(r,t,i);const e=C(n,t,i);return o&&e&&Rn([n],[e],r,t),e}function Rn(n,t,i,o){const r=X(i,!0),e=X(o,!0),s=k(i,J),l=k(o,J);if(s&&r!=null&&e!=null)for(let a=0;a<n.length;a++){const c=t[a];if(!c)continue;const{x:f}=n[a],{x:d}=c;d>=e[1]-l&&Math.abs(f-r[0])<s?c.x-=e[1]-e[0]:d<=e[0]+l&&Math.abs(f-r[1])<s&&(c.x+=e[1]-e[0])}}function An(n){const{inSR:t,outSR:i,datumTransformation:o,preferPE:r}=n;if(t.equals(i)){const{points:e}=sn(n,null);return e}return t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator?Bn(n):z(t,i,o)&&r&&(t.isGeographic||W(t)!=null)?hn(n):qn(n)}function qn(n){const{points:t}=sn(n,null),{inSR:i,outSR:o,datumTransformation:r}=n,e=t.map(l=>new E(l[0],l[1],i)),s=C(e,o,r);return r&&Rn(e,s,i,o),s.map(l=>l?[l.x,l.y]:[NaN,NaN])}function hn(n){const{inSR:t,outSR:i,datumTransformation:o}=n,r=W(t),{points:e,mask:s}=sn(n,r);if(!t.isGeographic){const a=t.wkid?T.coordsys(t.wkid):T.fromString(t.isGeographic?_.PE_TYPE_GEOGCS:_.PE_TYPE_PROJCS,t.wkt2||t.wkt);cn.projToGeog(a,e.length,e)}if(o!=null&&o.steps.length){let a;if(i.isGeographic&&(a=e.map(([f])=>f>179.9955?1:f<-179.9955?-1:0)),o.steps.forEach(f=>{const d=f.wkid?T.geogtran(f.wkid):T.fromString(_.PE_TYPE_GEOGTRAN,f.wkt);Cn.geogToGeog(d,e.length,e,null,f.isInverse?_.PE_TRANSFORM_2_TO_1:_.PE_TRANSFORM_1_TO_2)}),a)for(let f=0;f<e.length;f++){const d=a[f],p=e[f][0],x=p>179.9955?1:p<-179.9955?-1:0;d&&x&&d!==x&&(e[f][0]=d>0?p+360:p-360)}}if(!i.isGeographic){const a=W(i,!0),c=a!=null&&a.isEnvelope?[a.bbox[1],a.bbox[3]]:[-90,90];Fn(e,c);const f=i.wkid?T.coordsys(i.wkid):T.fromString(i.isGeographic?_.PE_TYPE_GEOGCS:_.PE_TYPE_PROJCS,i.wkt2||i.wkt);cn.geogToProj(f,e.length,e)}let l=e;if(s&&e.length!==s.length){l=[];for(let a=0,c=0;a<s.length;a++)s[a]?l.push(e[c++]):l.push([NaN,NaN])}return l}function Bn(n){const{cols:t,rows:i,xres:o,yres:r,usePixelCenter:e,inSR:s,outSR:l}=n;let{xmin:a,ymax:c}=n;e&&(a+=o/2,c-=r/2);const f=[],d=[],p=Math.max(t,i);for(let m=0;m<p;m++){const h=a+o*Math.min(t,m),u=c-r*Math.min(i,m),M=C(new E({x:h,y:u,spatialReference:s}),l);m<=t&&f.push(M.x),m<=i&&d.push(M.y)}const x=[];for(let m=0;m<t;m++)for(let h=0;h<i;h++)x.push([f[m],d[h]]);return x}function W(n,t=!1){let i=n.wkid||n.wkt2||n.wkt;if(!i||n.isGeographic)return null;if(i=String(i),U.has(i)){const s=U.get(i);return t?s?.gcs:s?.pcs}const o=n.wkid?T.coordsys(n.wkid):T.fromString(n.isGeographic?_.PE_TYPE_GEOGCS:_.PE_TYPE_PROJCS,n.wkt2||n.wkt),r=mn(o,k(n,1e-4)),e=mn(o,0,!0);return U.set(i,{pcs:r,gcs:e}),t?e:r}function mn(n,t=0,i=!1){const o=zn.generate(n),r=i?n.horizonGcsGenerate():n.horizonPcsGenerate();if(!o||!r?.length)return null;let e=!1,s=r.find(u=>u.getInclusive()===1&&u.getKind()===1);if(!s){if(s=r.find(u=>u.getInclusive()===1&&u.getKind()===0),!s)return null;e=!0}const l=i?0:(o.getNorthPoleLocation()===2?1:0)|(o.getSouthPoleLocation()===2?2:0),a=o.isPannableRectangle(),c=s.getCoord();if(e)return{isEnvelope:e,isPannable:a,vertices:c,coef:null,bbox:[c[0][0]-t,c[0][1]-t,c[1][0]+t,c[1][1]+t],poleLocation:l};let f=0;const d=[];let[p,x]=c[0],[m,h]=c[0];for(let u=0,M=c.length;u<M;u++){f++,f===M&&(f=0);const[g,y]=c[u],[w,R]=c[f];if(R===y)d.push([g,w,y,R,2]);else{const b=(w-g)/(R-y||1e-4),P=g-b*y;y<R?d.push([b,P,y,R,0]):d.push([b,P,R,y,1])}p=p<g?p:g,x=x<y?x:y,m=m>g?m:g,h=h>y?h:y}return{isEnvelope:!1,isPannable:a,vertices:c,coef:d,bbox:[p,x,m,h],poleLocation:l}}function sn(n,t){const i=[],{cols:o,rows:r,xres:e,yres:s,usePixelCenter:l}=n;let{xmin:a,ymax:c}=n;if(l&&(a+=e/2,c-=s/2),t==null){for(let x=0;x<o;x++)for(let m=0;m<r;m++)i.push([a+e*x,c-s*m]);return{points:i}}const f=new Uint8Array(o*r);if(t.isEnvelope){const{bbox:[x,m,h,u]}=t;for(let M=0,g=0;M<o;M++){const y=a+e*M,w=t.isPannable||y>=x&&y<=h;for(let R=0;R<r;R++,g++){const b=c-s*R;w&&b>=m&&b<=u&&(i.push([y,b]),f[g]=1)}}return{points:i,mask:f}}const d=t.coef,p=[];for(let x=0;x<r;x++){const m=c-s*x,h=[],u=[];for(let g=0;g<d.length;g++){const[y,w,R,b,P]=d[g];if(m===R&&R===b)h.push(y),h.push(w),u.push(2),u.push(2);else if(m>=R&&m<=b){const S=y*m+w;h.push(S),u.push(P)}}let M=h;if(h.length>2){let g=u[0]===2?0:u[0],y=h[0];M=[];for(let w=1;w<u.length;w++)u[w]===2&&w!==u.length-1||(u[w]!==g&&(M.push(g===0?Math.min(y,h[w-1]):Math.max(y,h[w-1])),g=u[w],y=h[w]),w===u.length-1&&M.push(u[w]===0?Math.min(y,h[w]):Math.max(y,h[w])));M.sort((w,R)=>w-R)}else h[0]>h[1]&&(M=[h[1],h[0]]);p.push(M)}for(let x=0,m=0;x<o;x++){const h=a+e*x;for(let u=0;u<r;u++,m++){const M=c-s*u,g=p[u];if(g.length===2)h>=g[0]&&h<=g[1]&&(i.push([h,M]),f[m]=1);else if(g.length>2){let y=!1;for(let w=0;w<g.length;w+=2)if(h>=g[w]&&h<=g[w+1]){y=!0;break}y&&(i.push([h,M]),f[m]=1)}}}return{points:i,mask:f}}function Fn(n,t){const[i,o]=t;for(let r=0;r<n.length;r++){const e=n[r][1];(e<i||e>o)&&(n[r]=[NaN,NaN])}}function bn(n,t){const i=N(n[0].spatialReference);if(n.length<2||i==null||(t=t??k(n[0].spatialReference),(n=n.filter(l=>l.width>t)).length===1))return n[0];let{xmin:o,xmax:r,ymin:e,ymax:s}=n[0];for(let l=1;l<n.length;l++){const a=n[l];r=a.xmax+i*l,e=Math.min(e,a.ymin),s=Math.max(s,a.ymax)}return new j({xmin:o,xmax:r,ymin:e,ymax:s,spatialReference:n[0].spatialReference})}function Sn(n,t,i=null,o=!0){const r=n.spatialReference;if(r.equals(t))return n;const e=rn(n),s=N(r,!0),l=N(t);if(e===0||s==null||l==null){const c=en(n,t,i,o);if(s==null&&l!=null&&Math.abs(c.width-l)<k(t)&&B()){const f=W(r);if(f!=null&&f.poleLocation===Z.None&&n.width<(f.bbox[2]-f.bbox[0])/2)return Yn(n,t)||c}return c}const a=n.clone().normalize();if(a.length===1&&n.xmax<s&&n.xmax-s/2>k(r)){const{xmin:c,xmax:f}=n;for(let d=0;d<=e;d++){const p=d===0?c:-s/2,x=d===e?f-s*d:s/2;a[d]=new j({xmin:p,xmax:x,ymin:n.ymin,ymax:n.ymax,spatialReference:r})}}return bn(a.map(c=>en(c,t,i,o)).filter(Tn))}function Zn(n,t,i){if(n.type==="extent"){const{xmin:o,ymin:r,xmax:e,ymax:s,spatialReference:l}=n;n=new on({rings:[[[o,s],[e,s],[e,r],[o,r],[o,s]]],spatialReference:l})}return n.spatialReference.equals(t)?n:(z(n.spatialReference,t,i),C(n,t,i))}function Yn(n,t){const i=N(t);if(i==null)return null;let{xmin:o,ymin:r,xmax:e,ymax:s}=n;const l=n.spatialReference,a=new on({spatialReference:l,rings:[[[o,r],[e,r],[e,s],[o,s],[o,r]]]}),c=C(a,t);if(c.rings.length!==2||!c.rings[0].length||!c.rings[1].length)return null;const{rings:f}=c,d=k(l),p=new j({spatialReference:t});for(let x=0;x<2;x++){o=e=f[x][0][0],r=s=f[x][0][1];for(let m=0;m<f[x].length;m++)o=o>f[x][m][0]?f[x][m][0]:o,e=e<f[x][m][0]?f[x][m][0]:e,r=r>f[x][m][1]?f[x][m][1]:r,s=s<f[x][m][1]?f[x][m][1]:s;if(x===0)p.ymin=r,p.ymax=s,p.xmin=o,p.xmax=e;else if(p.ymin=Math.min(p.ymin,r),p.ymax=Math.max(p.ymax,s),Math.abs(e-i/2)<d)p.xmin=o,p.xmax=p.xmax+i;else{if(!(Math.abs(o+i/2)<d))return null;p.xmax=e+i}}return p}function en(n,t,i=null,o=!0,r=!0){const e=n.spatialReference;if(e.equals(t)||!t)return n;z(e,t,i);const s=C(n,t,i);if(r&&t.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!o||!s)return s;const l=X(e,!0),a=X(t,!0);if(l==null||a==null)return s;const c=k(e,.001),f=k(e,J),d=k(t,.001);if(Math.abs(s.xmin-a[0])<d&&Math.abs(s.xmax-a[1])<d){const p=Math.abs(n.xmin-l[0]),x=Math.abs(l[1]-n.xmax);if(p<c&&x>f){s.xmin=a[0];const m=[];m.push(new E(n.xmax,n.ymin,e)),m.push(new E(n.xmax,(n.ymin+n.ymax)/2,e)),m.push(new E(n.xmax,n.ymax,e));const h=m.map(u=>xn(u,t,i)).filter(u=>!isNaN(u?.x)).map(u=>u.x);s.xmax=Math.max.apply(null,h)}if(x<c&&p>f){s.xmax=a[1];const m=[];m.push(new E(n.xmin,n.ymin,e)),m.push(new E(n.xmin,(n.ymin+n.ymax)/2,e)),m.push(new E(n.xmin,n.ymax,e));const h=m.map(u=>xn(u,t,i)).filter(u=>!isNaN(u?.x)).map(u=>u.x);s.xmin=Math.min.apply(null,h)}}else{const p=k(t,.001);Math.abs(s.xmin-a[0])<p&&(s.xmin=a[0]),Math.abs(s.xmax-a[1])<p&&(s.xmax=a[1])}return s}function N(n,t=!1){if(!n)return null;const i=t?20037508342787e-6:20037508342788905e-9;return n.isWebMercator?2*i:n.wkid&&n.isGeographic?360:2*Wn[n.wkid]||null}function X(n,t=!1){if(n.isGeographic)return[-180,180];const i=N(n,t);return i!=null?[-i/2,i/2]:null}function pn(n,t,i,o){let r=(n-t)/i;return r-Math.floor(r)!=0?r=Math.floor(r):o&&(r-=1),r}function rn(n,t=!1){const i=N(n.spatialReference);if(i==null)return 0;const o=t?0:-(i/2),r=k(n.spatialReference),e=!t&&Math.abs(n.xmax-i/2)<r?i/2:n.xmax,s=!t&&Math.abs(n.xmin+i/2)<r?-i/2:n.xmin;return pn(e,o,i,!0)-pn(s,o,i,!1)}function nt(n){const t=n.storageInfo.origin.x,i=N(n.spatialReference,!0);if(i==null)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const o=i/2,{nativePixelSize:r,storageInfo:e,extent:s}=n,{maximumPyramidLevel:l,blockWidth:a,pyramidScalingFactor:c}=e;let f=r.x;const d=[],p=n.transform!=null&&n.transform.type==="gcs-shift",x=t+(p?0:o),m=p?i-t:o-t;for(let h=0;h<=l;h++){const u=(s.xmax-t)/f/a,M=u-Math.floor(u)==0?u:Math.ceil(u),g=m/f/a,y=g-Math.floor(g)==0?g:Math.ceil(g),w=Math.floor(x/f/a),R=Math.round(x/f)%a,b=(a-Math.round(m/f)%a)%a;d.push({resolutionX:f,blockWidth:a,datasetColumnCount:M,worldColumnCountFromOrigin:y,leftMargin:R,rightPadding:b,originColumnOffset:w}),f*=c}return{originX:t,halfWorldWidth:o,pyramidsInfo:d,hasGCSSShiftTransform:p}}function Jn(n){if(!n||n.isGeographic)return n;const t=String(n.wkid||n.wkt2||n.wkt);let i;return Q.has(t)?i=Q.get(t):(i=(n.wkid?T.coordsys(n.wkid):T.fromString(_.PE_TYPE_PROJCS,n.wkt2||n.wkt)).getGeogcs().getCode(),Q.set(t,i)),new wn({wkid:i})}function tt(n){const t=n.isAdaptive&&n.spacing==null;let i=n.spacing||[F,F],o=H(n),r={cols:o.size[0]+1,rows:o.size[1]+1};const e=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let s=o.outofBoundPointCount===o.offsets.length/2||t&&e?[0,0]:un(o.offsets,r,i,D);const l=(s[0]+s[1])/2,a=n.projectedExtent.spatialReference,c=n.srcBufferExtent.spatialReference;if(t&&(e||l>D)&&(Mn(a,c,n.datumTransformation)&&(a.isGeographic||W(a)),i=[Y,Y],o=H({...n,spacing:i}),r={cols:o.size[0]+1,rows:o.size[1]+1},s=un(o.offsets,r,i,D)),o.error=s,i[0]>1&&(o.coefficients=gn(o.offsets,r,e)),n.includeGCSGrid&&!a.isGeographic&&!a.isWebMercator)if(c.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:i};else{const f=W(a);if(f!=null&&!f.isEnvelope){const d=Jn(a),p=Sn(n.projectedExtent,d),{offsets:x}=H({...n,srcBufferExtent:p,spacing:i}),m=gn(x,r,e);o.gcsGrid={offsets:x,coefficients:m,spacing:i}}}return o}function H(n){const{projectedExtent:t,srcBufferExtent:i,pixelSize:o,datumTransformation:r,rasterTransform:e}=n,s=t.spatialReference,l=i.spatialReference,a=z(s,l),{xmin:c,ymin:f,xmax:d,ymax:p}=t,x=N(l),m=x!=null&&(n.hasWrapAround||e?.type==="gcs-shift"),h=n.spacing||[F,F],u=h[0]*o.x,M=h[1]*o.y,g=h[0]===1,y=Math.ceil((d-c)/u-.1/h[0])+(g?0:1),w=Math.ceil((p-f)/M-.1/h[1])+(g?0:1),R=An({cols:y,rows:w,xmin:c,ymax:p,xres:u,yres:M,inSR:s,outSR:l,datumTransformation:r,preferPE:h[0]<=Y,usePixelCenter:g}),b=[];let P,S=0;const L=g?-1:NaN,{xmin:A,xmax:I,ymax:Pn,width:Gn,height:kn}=i,En=k(l,J),Nn=x!=null&&A>0&&I>x/2;let an=!1;if(a){const v=W(s);an=v!=null&&v.poleLocation>0}for(let v=0;v<y;v++){const V=[];for(let $=0;$<w;$++){let G=R[v*w+$];if(m&&G[0]>I&&G[0]>x/2-En?G[0]-=x:m&&v===0&&G[0]<0&&Nn&&!e&&(G[0]+=x),!G||isNaN(G[0])||isNaN(G[1]))b.push(L),b.push(L),V.push(null),S++;else{if(e){const ln=e.inverseTransform(new E({x:G[0],y:G[1],spatialReference:l}));G=[ln.x,ln.y]}V.push(G),v>0&&m&&P[$]&&G[0]<P[$][0]&&(G[0]+=x,an&&G[0]>I&&G[0]>x&&(G[0]-=x)),b.push((G[0]-A)/Gn),b.push((Pn-G[1])/kn)}}P=V}return{offsets:b,error:null,coefficients:null,outofBoundPointCount:S,spacing:h,size:g?[y,w]:[y-1,w-1]}}function gn(n,t,i){const{cols:o,rows:r}=t,e=new Float32Array((o-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),l=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let a=0;a<o-1;a++){for(let c=0;c<r-1;c++){let f=a*r*2+2*c;const d=n[f],p=n[f+1],x=n[f+2],m=n[f+3];f+=2*r;const h=n[f],u=n[f+1],M=n[f+2],g=n[f+3];let y=0,w=12*(c*(o-1)+a);for(let R=0;R<3;R++)e[w++]=s[y++]*d+s[y++]*x+s[y++]*M;y=0;for(let R=0;R<3;R++)e[w++]=s[y++]*p+s[y++]*m+s[y++]*g;y=0;for(let R=0;R<3;R++)e[w++]=l[y++]*d+l[y++]*h+l[y++]*M;y=0;for(let R=0;R<3;R++)e[w++]=l[y++]*p+l[y++]*u+l[y++]*g}if(i)for(let c=0;c<e.length;c++)isNaN(e[c])&&(e[c]=-1)}return e}function Kn(n,t){const i=n.clone().normalize();return i.length===1?i[0]:bn(i,t)}function et(n){const{spatialReference:t}=n,i=vn(t);if(!i)return n;const[o,r]=i.valid,e=r-o;let s=0;if(n.xmin<o){const l=o-n.xmin;s=Math.ceil(l/e)}else if(n.xmin>r){const l=n.xmin-r;s=-Math.ceil(l/e)}return new j({spatialReference:n.spatialReference,xmin:n.xmin+s*e,ymin:n.ymin,xmax:n.xmax+s*e,ymax:n.ymax})}function it(n,t,i){const{storageInfo:o,pixelSize:r}=t;let e=0,s=!1;const{pyramidResolutions:l}=o,a=o.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,c=(n.x+n.y)/2/a;if(l!=null&&l.length){const m=l[l.length-1],h=(m.x+m.y)/2,u=(r.x+r.y)/2;if(c<=u)e=0;else if(c>=h)e=l.length,s=c/h>8;else{let g,y=u;for(let w=1;w<=l.length;w++){if(g=(l[w-1].x+l[w-1].y)/2,c<=g){c===g?e=w:i==="down"?(e=w-1,s=c/y>8):e=i==="up"||c-y>g-c||c/y>2?w:w-1;break}y=g}}const M=e===0?r:l[e-1];return s&&Math.min(M.x,M.y)*O(t.spatialReference)>19567&&(s=!1),{pyramidLevel:e,pyramidResolution:new E({x:M.x,y:M.y,spatialReference:t.spatialReference}),excessiveReading:s}}const f=Math.log(n.x/r.x)/Math.LN2,d=Math.log(n.y/r.y)/Math.LN2,p=t.storageInfo.maximumPyramidLevel||0;e=i==="down"?Math.floor(Math.min(f,d)):i==="up"?Math.ceil(Math.max(f,d)):Math.round((f+d)/2),e<0?e=0:e>p&&(s=e>p+3,e=p);const x=2**e;return{pyramidLevel:e,pyramidResolution:new E({x:x*t.nativePixelSize.x,y:x*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}function yn(n,t,i=!1){const{pixelSize:o,extent:r}=n,e=jn(r,t,!1),s=Sn(Kn(r,(o.x+o.y)/16),t,e);return i||rn(s)===0?s:en(r,t,e)}function ot(n,t,i){const o=i?.tileSize,r=i?.alignGlobalDatasetWithAGOL,{extent:e,spatialReference:s,pixelSize:l}=n,a=nn(l,t,e);if(a==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const c=(a.x+a.y)/2,f=tn(c,t),d=t.isGeographic?256/o*2958287637958547e-7:256/o*591657527591555e-6;let p=n.dataType==="vector-magdir"||n.dataType==="vector-uv";const x=yn(n,t,!0),m=Math.min(Math.ceil(Math.log(Math.min(n.width,n.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/f)/Math.LN2));if(!p&&r&&(t.isGeographic||t.isWebMercator)){const P=N(t);if(p=rn(x)>0||P!=null&&x.width>P/4,!p&&P!=null){let S=-1;if(m<3)S=2**m*c*o;else if(n.storageInfo){const{maximumPyramidLevel:A=0,pyramidScalingFactor:I=2}=n.storageInfo;S=I**A*c*o}const L=Math.ceil(P/S);p=L===1||L===2&&P/2-x.xmax<S}}let h,u=f;const M=1.001,g=Math.min(2,Math.max(1.414,n.storageInfo?.pyramidScalingFactor||2));if(p){u=d;const P=t.isGeographic?1341104507446289e-21:.29858214164761665,S=tn(P,t),L=t.isGeographic?4326:3857;h=nn({x:P,y:P},s,yn(n,new wn({wkid:L}),!0)),h.x*=u/S,h.y*=u/S}else{h={x:l.x,y:l.y};let P=0;for(;u<d*(M/2)&&P<m;)P++,u*=g,h.x*=g,h.y*=g;Math.max(u,d)/Math.min(u,d)<=M&&(u=d)}const y=[u],w=[{x:h.x,y:h.y}],R=70.5310735,b=Math.min(R,f)/M;for(;u>=b;)u/=g,h.x/=g,h.y/=g,y.push(u),w.push({x:h.x,y:h.y});return{projectedPixelSize:a,scales:y,srcResolutions:w,isCustomTilingScheme:!p}}export{xn as B,Hn as O,Sn as V,Zn as Z,jn as _,tt as a,ot as h,Un as j,it as m,rn as o,nt as r,N as t,et as u,Mn as w,yn as x,Qn as z};
