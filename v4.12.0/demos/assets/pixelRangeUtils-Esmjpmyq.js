const E=9999999e31,L=2e-7,S={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function k(t){return S[t]??[-34028234663852886e22,34028234663852886e22]}function w(t,n){return t==null||n==null?"s32":t<0?t>=-128&&n<128?"s8":t>=-32768&&n<32768?"s16":"s32":n<256?"u8":n<65536?"u16":"u32"}function y(t){return(t?.startsWith("s")||t?.startsWith("u"))??!1}function I(t,n,e,i){let[r,l]=k(e);const s=y(e);return s&&(r-=1e-5,l+=1e-5),s?e.startsWith("u")?U(t,n,i,[r,l]):V(t,n,i,[r,l]):v(t,n,i,[r,l])}function O(t,n){for(let e=0;e<n.length;e++)n[e]&&isNaN(t[e])&&(n[e]=0,t[e]=0)}function U(t,n,e,i){const[r,l]=i;for(let s=0;s<n.length;s++)if(n[s]){const o=t[s];o<r||o>l?n[s]=0:e[s]=o+.5|0}}function V(t,n,e,i){const[r,l]=i;for(let s=0;s<n.length;s++)if(n[s]){const o=t[s];o<r||o>l?n[s]=0:e[s]=o+(o>0?.5:-.5)|0}}function v(t,n,e,i){const[r,l]=i;for(let s=0;s<n.length;s++)if(n[s]){const o=t[s];o<r||o>l?n[s]=0:e[s]=o}}function P(t,n,e){if(t.depthCount&&t.depthCount>1)return;const{pixels:i,statistics:r,pixelType:l}=t,s=i[0].length,o=t.bandMasks??[],g=t.mask??new Uint8Array(s).fill(255),A=l==="f32"||l==="f64",p=k(l);let N=!1;for(let u=0;u<i.length;u++){const a=typeof n=="number"?n:n[u];if(a==null)continue;const d=r?.[u]?.minValue??p[0],m=r?.[u]?.maxValue??p[1];if(d>a+Number.EPSILON||m<a-Number.EPSILON)continue;const h=o[u]||g.slice(),c=i[u],M=e?.customFloatTolerance;if(A&&M!==0){let f=M;f||(f=Math.abs(a)>=E?L*Math.abs(a):l==="f32"?2**-23:Number.EPSILON);for(let b=0;b<c.length;b++)h[b]&&Math.abs(c[b]-a)<f&&(c[b]=0,h[b]=0,g[b]=0,N=!0)}else for(let f=0;f<c.length;f++)h[f]&&c[f]===a&&(c[f]=0,h[f]=0,g[f]=0,N=!0);o[u]=h}if(N){const u=t.bandMasks||t.pixels.length>1?o:null;e?.matchAllNoData?t.mask=u&&u.length>1?x(u):g:(t.bandMasks=u,t.mask=g)}function x(u){if(u.length<2)return u[0];const a=u[0].length,d=new Uint8Array(a).fill(0);for(let m=0;m<u.length;m++){const h=u[m];for(let c=0;c<a;c++)h[c]&&(d[c]=255)}return d}N&&"updateStatistics"in t&&t.updateStatistics()}export{P as a,O as i,w as l,y as o,k as s,I as u};
