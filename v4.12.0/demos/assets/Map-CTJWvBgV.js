const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ElevationQuery-Ce2zplB8.js","./main-D6UWMbWJ.js","./preload-helper-ExcqyqRp.js","./main-DCJluy1C.css","./projection-F5U3p10J.js","./TileKey-DZd6gJy7.js","./layersCreator-DxXWnq8S.js","./loadUtils-DywOwfkm.js","./fetchService-Qa3swvC2.js","./associatedFeatureServiceUtils-DL1VQ_AY.js","./PortalItem-BUPtFYt9.js","./lazyLayerLoader-C4IfnbMv.js","./portalLayers-DdtP6eyi.js","./portalItemUtils-HRSUZPvT.js","./styleUtils-BIJgkUhv.js"])))=>i.map(i=>d[i]);
import{v as i,bl as U,x as l,J as c,D as N,o as G,V as C,bc as z,n as p,d8 as g,dv as E,iQ as H,s as J,U as $,ak as x,z as q,bA as O,iR as Q,iS as V,bz as W,S as k,a6 as K,f7 as X,Q as Y,bI as Z,bH as ee,cp as te,co as P,d7 as re,a5 as se,a_ as M}from"./main-D6UWMbWJ.js";import{a as j,F as f}from"./Basemap-WwZupoib.js";import{_ as w}from"./preload-helper-ExcqyqRp.js";import{t as ae}from"./loadAll-v7n2jQTN.js";import{n as _}from"./CollectionFlattener-_i2fTLMi.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-mplESjCB.js";import{f as oe}from"./Layer-CrpAg4i7.js";var I;let m=I=class extends N{constructor(e){super(e),this.type="none"}clone(){return new I({type:this.type})}};i([U({none:"none",stayAbove:"stay-above"}),l({json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),m=I=i([c("esri.ground.NavigationConstraint")],m);const ne=Symbol("GroundInstance");var R,S;let y=S=class extends N.JSONSupportMixin(G){constructor(e){super(e),this[R]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new C;const t=s=>{s.parent&&s.parent!==this&&"remove"in s.parent&&s.parent.remove(s),s.parent=this,s.type!=="elevation"&&s.type!=="base-elevation"&&p.getLogger(this).error(`Layer '${s.title}, id:${s.id}' of type '${s.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=s=>{s.parent=null};this.addHandles([this.layers.on("after-add",s=>t(s.item)),this.layers.on("after-remove",s=>r(s.item))])}initialize(){this.when().catch(e=>{z(e)||p.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)g(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",E(e,this._get("layers")))}writeLayers(e,t,r,s){const o=[];e&&(s={...s,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const a={};H(n)().write(a,s)&&o.push(a)}else s?.messages&&s.messages.push(new J("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=o}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return ae(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:r}=await w(()=>import("./ElevationQuery-Ce2zplB8.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);$(t);const s=new r,o=this.layers.filter(F).toArray();return s.queryAll(o,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:r}=await w(()=>import("./ElevationQuery-Ce2zplB8.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);$(t);const s=new r,o=this.layers.filter(F).toArray();return s.createSamplerAll(o,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:x(this.surfaceColor),navigationConstraint:x(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new S({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,r){const s=t?.origin||"web-scene",o=t?.portal||null,n=t?.url||null,{populateOperationalLayers:a}=await w(async()=>{const{populateOperationalLayers:v}=await import("./layersCreator-DxXWnq8S.js");return{populateOperationalLayers:v}},__vite__mapDeps([6,1,2,3,7,8,9,10,11,12,13,4,14]),import.meta.url);$(r);const u=[];if(e.layers&&Array.isArray(e.layers)){const v={context:{origin:s,url:n,portal:o,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};u.push(a(this.layers,e.layers,v))}await Promise.allSettled(u)}};function ie(e){return e&&"createElevationSampler"in e}function F(e){return e.type==="elevation"||ie(e)}R=ne,i([l({json:{read:!1,write:{isRequired:!0}}})],y.prototype,"layers",null),i([q("layers")],y.prototype,"writeLayers",null),i([l({readOnly:!0})],y.prototype,"resourceInfo",void 0),i([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:O,read:{reader:Q,source:"transparency"},write:{writer:(e,t)=>{t.transparency=V(e)},target:"transparency"}}})],y.prototype,"opacity",void 0),i([l({type:W,json:{type:[O],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],y.prototype,"surfaceColor",void 0),i([l({type:m,json:{write:!0}})],y.prototype,"navigationConstraint",void 0),y=S=i([c("esri.Ground")],y);const b=y;function le(e){return new _({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const r=[];return"tables"in t&&r.push(t.tables),"layers"in t&&r.push(t.layers),r},itemFilterFunction:t=>{const r=t.parent;return!!r&&"tables"in r&&r.tables.includes(t)}})}function Ae(e){for(const t of e.values())t?.destroy();e.clear()}function T(e,t,r){let s,o;if(e)for(let n=0,a=e.length;n<a;n++){if(s=e.at(n),s?.[t]===r)return s;if(s?.type==="group"&&(o=T(s.layers,t,r),o))return o}}const de=e=>{let t=class extends e{constructor(...r){super(...r),this.layers=new C;const s=a=>{a.parent&&"remove"in a.parent&&a.parent.remove(a)},o=a=>{a.parent=this,this.layerAdded(a),a.type!=="elevation"&&a.type!=="base-elevation"||p.getLogger(this).error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as an operational layer and will therefore be ignored.`)},n=a=>{a.parent=null,this.layerRemoved(a)};this.addHandles([this.layers.on("before-add",a=>{if(a.item===this)return a.preventDefault(),void p.getLogger(this).error("#add()","Cannot add layer to itself.");s(a.item)}),this.layers.on("after-add",a=>o(a.item)),this.layers.on("after-remove",a=>n(a.item))])}destroy(){const r=this.layers.toArray();for(const s of r)s.destroy();this.layers.destroy()}set layers(r){this._set("layers",E(r,this._get("layers")))}add(r,s){const o=this.layers;if(s=o.getNextIndex(s),r instanceof oe){const n=r;n.parent===this?this.reorder(n,s):o.add(n,s)}else k(r)?r.then(n=>{this.destroyed||this.add(n,s)}):p.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,s){const o=this.layers;let n=o.getNextIndex(s);r.slice().forEach(a=>{a.parent!==this?(o.add(a,n),n+=1):this.reorder(a,n)})}findLayerById(r){return T(this.layers,"id",r)}findLayerByUid(r){return T(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,s){return this.layers.reorder(r,s)}layerAdded(r){}layerRemoved(r){}};return i([l()],t.prototype,"layers",null),t=i([c("esri.support.LayersMixin")],t),t},ye=new Set(["feature","subtype-group"]);function A(e,t,r){if(e)for(let s=0,o=e.length;s<o;s++){const n=e.at(s);if(n[t]===r)return n;if(n?.type==="group"){const a=A(n.tables,t,r);if(a)return a}}}const pe=e=>{let t=class extends e{constructor(...r){super(...r),this.tables=new C,this.addHandles([this.tables.on("after-add",s=>{const o=s.item;o.parent&&o.parent!==this&&"tables"in o.parent&&o.parent.tables.remove(o),o.parent=this,ye.has(o.type)||p.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",s=>{s.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const s of r)s.destroy();this.tables.destroy()}set tables(r){this._set("tables",E(r,this._get("tables")))}findTableById(r){return A(this.tables,"id",r)}findTableByUid(r){return A(this.tables,"uid",r)}};return i([l()],t.prototype,"tables",null),t=i([c("esri.support.TablesMixin")],t),t},h=new WeakMap;function D(e){return!e.destroyed&&(h.has(e)||e.addHandles([K(()=>{const t=e.parent;return!(!t||!("type"in t))&&(t.type==="catalog-dynamic-group"||D(t))},t=>h.set(e,t),X),Y(()=>h.delete(e))]),h.get(e))}function ue(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function ce(e){return!(!ue(e)||!Z(e)?.operations?.supportsEditing||"editingEnabled"in e&&!ee(e)||D(e))}const L=()=>p.getLogger("esri.support.basemapUtils");function he(){return{}}function fe(e){for(const t in e){const r=e[t];g(r),delete e[t]}}function me(e,t){let r;if(typeof e=="string"){const s=e in j,o=!s&&e.includes("/");if(!s&&!o){if(te.apiKey)L().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const n=Object.entries(j).filter(([a,u])=>u.classic||u.is3d).map(([a])=>`"${a}"`).sort().join(", ");L().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${n}`)}return null}t&&(r=t[e]),r||(r=s?f.fromId(e):new f({style:{id:e}}),t&&(t[e]=r))}else r=P(f,e);return r?.destroyed&&(L().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}const B={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function ge(e){let t=null;if(typeof e=="string")if(e in B){const r=B[e];t=new b({resourceInfo:{data:{layers:[r]}}})}else p.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=P(b,e);return t}let d=class extends pe(de(re.EventedMixin(se))){constructor(e){super(e),this.allLayers=new _({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=le(this),this.basemap=null,this.editableLayers=new _({getCollections:()=>[this.allLayers],itemFilterFunction:ce}),this.ground=new b,this._basemapCache=he()}destroy(){fe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=g(this.basemap),g(this.ground),this._set("ground",null)}castBasemap(e){return me(e,this._basemapCache)}castGround(e){return ge(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};i([l({readOnly:!0,dependsOn:[]})],d.prototype,"allLayers",void 0),i([l({readOnly:!0})],d.prototype,"allTables",void 0),i([l({type:f,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],d.prototype,"basemap",void 0),i([M("basemap")],d.prototype,"castBasemap",null),i([l({readOnly:!0})],d.prototype,"editableLayers",void 0),i([l({type:b,nonNullable:!0})],d.prototype,"ground",void 0),i([M("ground")],d.prototype,"castGround",null),i([l()],d.prototype,"undoRedo",void 0),d=i([c("esri.Map")],d);const be=d,Ce=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{be as L,Ce as M,de as a,pe as l,Ae as n,le as t};
