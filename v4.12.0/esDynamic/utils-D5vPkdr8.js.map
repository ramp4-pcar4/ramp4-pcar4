{"version":3,"file":"utils-D5vPkdr8.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../../core/handleUtils.js\";import{Milliseconds as e}from\"../../../../../core/time.js\";import{AnimatedSymbolRepeatType as r}from\"../../../../../symbols/cim/enums.js\";import{getRandomValue as i}from\"../grouping.js\";function a(t){return e(t.frameDurations.reduce(((t,e)=>t+e),0))}function n(t){const{width:e,height:r}=t,i=t.frameDurations.reverse(),a=e=>{const r=t.frameDurations.length-1-e;return t.getFrame(r)};return{frameCount:t.frameCount,duration:t.duration,frameDurations:i,getFrame:a,width:e,height:r}}function o(t,r){const{width:i,height:a,getFrame:n}=t,o=r/t.duration,s=t.frameDurations.map((t=>e(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:n,width:i,height:a}}function s(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.shift();return o.unshift(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}function m(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.pop();return o.push(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}class u{constructor(t,e,r,i){this._animation=t,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;e>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case r.None:this._currentFrame-=this._direction;break;case r.Loop:this._currentFrame=0;break;case r.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case r.None:this._currentFrame-=this._direction;break;case r.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case r.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function h(t,h,c,f){let l,{repeatType:d}=h;if(null==d&&(d=r.Loop),!0===h.reverseAnimation&&(t=n(t)),null!=h.duration&&(t=o(t,e(1e3*h.duration))),null!=h.repeatDelay){const i=1e3*h.repeatDelay;d===r.Loop?t=m(t,e(i)):d===r.Oscillate&&(t=s(m(t,e(i/2)),e(i/2)))}if(null!=h.startTimeOffset)l=e(1e3*h.startTimeOffset);else if(null!=h.randomizeStartTime){const r=82749913,n=null!=h.randomizeStartSeed?h.randomizeStartSeed:r,o=i(c,n);l=e(o*a(t))}else l=e(0);return new u(t,l,d,f)}function c(e,r,i,a){const n=null==r.playAnimation||r.playAnimation,o=h(e,r,i,a);let s,m=o.timeToFrame;function u(){s=n?setTimeout((()=>{o.nextFrame(),m=o.timeToFrame,u()}),m):void 0}return u(),t((()=>n&&clearTimeout(s)))}export{u as Player,o as adjustDuration,m as appendDelay,h as createPlayer,a as getDuration,c as play,s as prependDelay,n as reverse};\n"],"names":["a","t","e","n","r","i","o","s","m","u","h","c","f","l","d"],"mappings":"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","x_google_ignoreList":[0]}