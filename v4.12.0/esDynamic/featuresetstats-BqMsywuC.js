import{db as u,da as F,aO as m}from"./main-DnzmeE4U.js";import{a as A,r as w}from"./unitConversion-BXECx7w3.js";import{o as h,w as f,h as d,z as c,J as s,K as S}from"./arcade-Dg73dEoh.js";import{D as l,i as p}from"./WhereClause-nZnXFKnG.js";async function o(t,e,n,a){if(n.length===1){if(u(n[0]))return c(t,n[0],s(n[1],-1));if(d(n[0]))return c(t,n[0].toArray(),s(n[1],-1))}else if(n.length===2){if(u(n[0]))return c(t,n[0],s(n[1],-1));if(d(n[0]))return c(t,n[0].toArray(),s(n[1],-1));if(f(n[0])){const r=await n[0].load(),i=await y(l.create(n[1],{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}),a,e);return g(e,await n[0].calculateStatistic(t,i,s(n[2],1e3),e.abortSignal))}}else if(n.length===3&&f(n[0])){const r=await n[0].load(),i=await y(l.create(n[1],{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}),a,e);return g(e,await n[0].calculateStatistic(t,i,s(n[2],1e3),e.abortSignal))}return c(t,n,-1)}function g(t,e){return e instanceof p?m.fromReaderAsTimeStampOffset(e.toStorageFormat()):e instanceof Date?m.dateJSAndZoneToArcadeDate(e,S(t)):e}async function y(t,e,n){const a=t.getVariables();if(a.length>0){const r={};for(const i of a)r[i]=e.evaluateIdentifier(n,{name:i});t.parameters=r}return t}function v(t){t.mode==="async"&&(t.functions.stdev=function(e,n){return t.standardFunctionAsync(e,n,(a,r,i)=>o("stdev",e,i,t))},t.functions.variance=function(e,n){return t.standardFunctionAsync(e,n,(a,r,i)=>o("variance",e,i,t))},t.functions.average=function(e,n){return t.standardFunctionAsync(e,n,(a,r,i)=>o("mean",e,i,t))},t.functions.mean=function(e,n){return t.standardFunctionAsync(e,n,(a,r,i)=>o("mean",e,i,t))},t.functions.sum=function(e,n){return t.standardFunctionAsync(e,n,(a,r,i)=>o("sum",e,i,t))},t.functions.min=function(e,n){return t.standardFunctionAsync(e,n,(a,r,i)=>o("min",e,i,t))},t.functions.max=function(e,n){return t.standardFunctionAsync(e,n,(a,r,i)=>o("max",e,i,t))},t.functions.count=function(e,n){return t.standardFunctionAsync(e,n,async(a,r,i)=>{if(h(i,1,1,e,n),f(i[0]))return i[0].count(a.abortSignal);if(u(i[0])||F(i[0]))return i[0].length;if(d(i[0]))return i[0].length();throw new A(e,w.InvalidParameter,n)})})}export{v as registerFunctions};
