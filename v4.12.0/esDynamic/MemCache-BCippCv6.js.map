{"version":3,"file":"MemCache-BCippCv6.js","sources":["../../node_modules/@arcgis/core/core/MemCache.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport t from\"./PooledArray.js\";const e=-3,i=e-1;var s;!function(t){t[t.ALL=0]=\"ALL\",t[t.SOME=1]=\"SOME\"}(s||(s={}));class r{constructor(t,e,i,s=0){this.name=t,this._storage=e,this._defaultPriority=s,this.id=o+++\":\",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(t){return this._storage.getSize(this,t)}resetHitRate(){this._hit=this._miss=0}put(t,e,i=this._defaultPriority){this._storage.put(this,t,e,e.cachedMemory,i)}pop(t){const e=this._storage.pop(this,t);return void 0===e?++this._miss:++this._hit,e}get(t){const e=this._storage.get(this,t);return void 0===e?++this._miss:++this._hit,e}peek(t){return this._storage.peek(this,t)}updateSize(t,e){this._storage.updateSize(this,t,e,e.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class h{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new t,this._users=new t}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,e){this._removeFuncs.push([t,e])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace((e=>e[0]!==t))}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,-1),this._checkSize()}getSize(t,e){const i=this._db.get(t.id+e);return i?.size??0}put(t,r,h,o,_){r=t.id+r;const a=this._db.get(r);if(a&&(this._size-=a.size,t.size-=a.size,this._db.delete(r),a.entry!==h&&this._notifyRemove(r,a.entry,a.size,s.ALL)),o>this._maxSize)return void this._notifyRemove(r,h,o,s.ALL);if(void 0===h)return void console.warn(\"Refusing to cache undefined entry \");if(!o||o<0)return console.warn(`Refusing to cache entry with size ${o} for key ${r}`),void this._notifyRemove(r,h,0,s.ALL);const c=1+Math.max(_,i)-e;this._db.set(r,new n(h,o,c)),this._size+=o,t.size+=o,this._checkSize()}updateSize(t,e,i,r){e=t.id+e;const h=this._db.get(e);if(h&&h.entry===i){for(this._size-=h.size,t.size-=h.size;r>this._maxSize;){const t=this._notifyRemove(e,i,r,s.SOME);if(!(null!=t&&t>0))return void this._db.delete(e);r=t}h.size=r,this._size+=r,t.size+=r,this._checkSize()}}pop(t,e){e=t.id+e;const i=this._db.get(e);if(i)return this._size-=i.size,t.size-=i.size,this._db.delete(e),++this._hit,i.entry;++this._miss}get(t,e){e=t.id+e;const i=this._db.get(e);if(void 0!==i)return this._db.delete(e),i.lives=i.lifetime,this._db.set(e,i),++this._hit,i.entry;++this._miss}peek(t,e){const i=this._db.get(t.id+e);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const t={Size:Math.round(this._size/1048576)+\"/\"+Math.round(this._maxSize/1048576)+\"MB\",\"Hit rate\":Math.round(100*this._getHitRate())+\"%\",Entries:this._db.size.toString()},i={},s=new Array;this._db.forEach(((t,e)=>{const r=t.lifetime;s[r]=(s[r]||0)+t.size,this._users.forAll((s=>{const{id:r,name:h}=s;if(e.startsWith(r)){const e=i[h]||0;i[h]=e+t.size}}))}));const r={};this._users.forAll((t=>{const e=t.name;if(\"hitRate\"in t&&\"number\"==typeof t.hitRate&&!isNaN(t.hitRate)&&t.hitRate>0){const s=i[e]||0;i[e]=s,r[e]=Math.round(100*t.hitRate)+\"%\"}else r[e]=\"0%\"}));const h=Object.keys(i);h.sort(((t,e)=>i[e]-i[t])),h.forEach((e=>t[e]=Math.round(i[e]/2**20)+\"MB / \"+r[e]));for(let o=s.length-1;o>=0;--o){const i=s[o];i&&(t[\"Priority \"+(o+e-1)]=Math.round(i/this._size*100)+\"%\")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll((t=>t.resetHitRate()))}clear(t){const e=t.id;this._db.forEach(((t,i)=>{i.startsWith(e)&&(this._size-=t.size,this._db.delete(i),this._notifyRemove(i,t.entry,t.size,s.ALL))})),t.size=0}clearAll(){this._db.forEach(((t,e)=>this._notifyRemove(e,t.entry,t.size,s.ALL))),this._users.forAll((t=>t.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,e,i,s){let r;return this._removeFuncs.some((h=>{if(t.startsWith(h[0])){const t=h[1](e,s,i);return\"number\"==typeof t&&(r=t),!0}return!1})),r}_checkSize(){this._users.forAll((t=>this._checkSizeLimits(t))),this._checkSizeLimits()}_checkSizeLimits(t){const e=t??this;if(e.maxSize<0||e.size<=e.maxSize)return;const i=t?.id;let s=!0;for(;s;){s=!1;for(const[r,h]of this._db)if(0===h.lifetime&&(!i||r.startsWith(i))){if(this._purgeItem(r,h,t),e.size<=.9*e.maxSize)return;s||=this._db.has(r)}}for(const[r,h]of this._db)if((!i||r.startsWith(i))&&(this._purgeItem(r,h,t),e.size<=.9*e.maxSize))return}_purgeItem(t,e,i=this._users.find((e=>t.startsWith(e.id)))){if(this._db.delete(t),e.lives<=1){this._size-=e.size,i&&(i.size-=e.size);const r=this._notifyRemove(t,e.entry,e.size,s.SOME);null!=r&&r>0&&(this._size+=r,i&&(i.size+=r),e.lives=e.lifetime,e.size=r,this._db.set(t,e))}else--e.lives,this._db.set(t,e)}}let o=0;class n{constructor(t,e,i){this.entry=t,this.size=e,this.lifetime=i,this.lives=i}}export{r as MemCache,h as MemCacheStorage,e as MinPriority,i as NoPriority,s as RemoveMode};\n"],"names":["e","i","s","t","h","r","o","_","a","c","n"],"mappings":"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","x_google_ignoreList":[0]}