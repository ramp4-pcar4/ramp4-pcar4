{"version":3,"file":"TextureCompressionWorker-DlrMLd73.js","sources":["../../node_modules/@arcgis/core/libs/basisu/BasisUEncoder.js","../../node_modules/@arcgis/core/libs/dxtEncoder/DXTEncoder.js","../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureCompressionWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as s}from\"../../assets.js\";function i(){return t??=(async()=>{const i=await import(\"../../chunks/basis_encoder.js\"),t=await i.default({locateFile:i=>s(`esri/libs/basisu/${i}`)});return t.initializeBasis(),t})(),t}let t;export{i as getBasisEncoder};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return r??=(async()=>{const e=await import(\"../../chunks/dxt_encoder.js\");return await e.default({locateFile:e=>t(`esri/libs/dxtEncoder/${e}`)})})(),r}let r;export{e as getDXTEncoder};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{getBasisEncoder as e}from\"../../../../libs/basisu/BasisUEncoder.js\";import{TextureFormat as t}from\"../../../../libs/basisu/TextureFormat.js\";import{getDXTEncoder as n}from\"../../../../libs/dxtEncoder/DXTEncoder.js\";import{CompressedTextureFormat as r}from\"../../../webgl/enums.js\";let s,a,l=null,i=null;class o{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}async function c(e){const t=m(e.data,e.flipped);if(e.hasS3TC){i||await f();const n=new Uint8Array(t.length);i?.encode(new Uint8Array(t),e.width,e.height,n);const r=R(n,!0),s=[n.buffer];return{result:new o(r?.internalFormat??null,r?.textureData??null),transferList:s}}if(e.hasETC){l||await u();const n=await h(t,e.width,e.height,e.hasMipmap),r=n?await d(n):null,s=r?.compressedTexture?.levels.map((e=>e.buffer))||[];return{result:new o(r?.internalFormat??null,r?.compressedTexture??null),transferList:s}}return{result:new o(null,null)}}async function u(){l||(l=await(s??=e()))}async function f(){i||(i=await(a??=n()))}async function h(e,t,n,r,s=255,a=0,i=!1,o=!1){if(!l)return null;const c=new l.BasisEncoder;c.setPerceptual(!o),c.setCheckForAlpha(!0),c.setForceAlpha(!1),c.setRenormalize(o),c.setMipGen(r),c.setMipSRGB(!o),c.setCreateKTX2File(!0),c.setKTX2SRGBTransferFunc(!o),c.setQualityLevel(s),c.setCompressionLevel(a);const u=new Uint8Array(e.byteLength);c.setSliceSourceImage(0,new Uint8Array(e),t,n,i);const f=c.encode(u),h=new Uint8Array(u.buffer,0,f),d=new l.KTX2File(new Uint8Array(h));return d.isValid()?(c.delete(),h):(d.close(),d.delete(),c.delete(),null)}async function d(e){if(!l)return new o(null,null);const n=new l.KTX2File(new Uint8Array(e));n.startTranscoding();const[s,a]=n.getHasAlpha()?[t.ETC2_RGBA,r.COMPRESSED_RGBA8_ETC2_EAC]:[t.ETC1_RGB,r.COMPRESSED_RGB8_ETC2],i=n.getLevels(),c=[];for(let t=0;t<i;t++)c.push(new Uint8Array(n.getImageTranscodedSizeInBytes(t,0,0,s))),n.transcodeImage(c[t],t,0,0,s,0,-1,-1);return n.close(),n.delete(),{internalFormat:a,compressedTexture:{type:\"compressed\",levels:c}}}function m(e,t=!1){const n=new OffscreenCanvas(e.width,e.height),r=n.getContext(\"2d\");t&&r.scale(1,-1),r.drawImage(e,0,t?-e.height:0);return r.getImageData(0,0,n.width,n.height).data}const w=31,T=1,p=2,C=3,E=4,y=7,A=21,g=131072;function S(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const _=S(\"DXT1\"),b=S(\"DXT3\"),D=S(\"DXT5\");function R(e,t){const n=new Int32Array(e.buffer,e.byteOffset,w);let s,a;switch(n[A]){case _:s=8,a=r.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case b:s=16,a=r.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case D:s=16,a=r.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let l=1,i=n[E],o=n[C];(3&i||3&o)&&(i=i+3&-4,o=o+3&-4);const c=i,u=o;let f,h;n[p]&g&&!1!==t&&(l=Math.max(1,n[y]));let d=e.byteOffset+n[T]+4;const m=[];for(let r=0;r<l;++r)h=(i+3>>2)*(o+3>>2)*s,f=new Uint8Array(e.buffer,d,h),m.push(f),d+=h,i=Math.max(1,i>>1),o=Math.max(1,o>>1);return{textureData:{type:\"compressed\",levels:m},internalFormat:a,width:c,height:u}}export{o as TextureCompressionWorkerOutput,c as compress,h as compressRGBADataToKTX2,d as createTextureDataKTX2,u as initializeBasisEncoder,f as initializeDXTEncoder};\n"],"names":["i","t","s","e","r","a","l","o","c","m","f","n","R","u","h","d","w","T","p","C","E","y","A","g","S","_","b","D"],"mappings":"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","x_google_ignoreList":[0,1,2]}