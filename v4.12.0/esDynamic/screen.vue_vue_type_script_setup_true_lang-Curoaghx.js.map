{"version":3,"file":"screen.vue_vue_type_script_setup_true_lang-Curoaghx.js","sources":["../../src/fixtures/export/settings-button.vue","../../src/fixtures/export/screen.vue"],"sourcesContent":["<template>\n    <dropdown-menu v-focus-item :position=\"dropdownPlacement\" :tooltip=\"t('export.menu')\" tooltipPlacement=\"top\">\n        <template #header>\n            <div class=\"flex items-center text-gray-400 w-full h-full hover:text-black p-4 sm:p-8\">\n                <svg class=\"fill-current w-24 h-24 m-auto\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n                    <g>\n                        <path d=\"M0,0h24v24H0V0z\" fill=\"none\" />\n                        <path\n                            d=\"M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z\"\n                        />\n                    </g>\n                </svg>\n            </div>\n        </template>\n        <template v-slot:default>\n            <a\n                v-for=\"component in componentSelectedState\"\n                :key=\"component.name\"\n                @click=\"toggleComponent(component)\"\n                href=\"javascript:;\"\n                :class=\"`text-left text-sm sm:text-base ${component.selectable ? 'cursor-pointer' : 'cursor-default'}`\"\n                :aria-label=\"component.name\"\n            >\n                <div class=\"md-icon-small inline\">\n                    <svg\n                        height=\"20\"\n                        width=\"20\"\n                        viewBox=\"0 0 24 24\"\n                        :class=\"`inline mx-8 ${!component.selected ? 'invisible' : ''}`\"\n                    >\n                        <g>\n                            <path d=\"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z\" />\n                        </g>\n                    </svg>\n                    <span\n                        :class=\"`inline ${!component.selectable ? 'text-gray-300' : ''}\n                    `\"\n                        >{{ t(`export.menu.component.${component.name}`) }}</span\n                    >\n                </div>\n            </a>\n        </template>\n    </dropdown-menu>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport { usePanelStore } from '@/stores/panel';\nimport { useExportStore } from './store';\n\nconst { t } = useI18n();\nconst panelStore = usePanelStore();\nconst exportStore = useExportStore();\n\ndefineProps({\n    componentSelectedState: {\n        type: Object,\n        required: true\n    }\n});\n\nconst dropdownPlacement = computed<string>(() => (panelStore.mobileView ? 'top-end' : 'left-end'));\n\nconst toggleComponent = (component: any): void => {\n    if (!component.selectable) {\n        return;\n    }\n    // update the store\n    exportStore.toggleSelected({\n        name: component.name\n    });\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n","<template>\n    <panel-screen :panel=\"panel\" :footer=\"true\">\n        <template #header> {{ t('export.title') }} </template>\n\n        <template #content>\n            <div class=\"overflow-hidden border border-gray-200\" ref=\"componentEl\">\n                <canvas class=\"export-canvas !w-[100%]\"></canvas>\n            </div>\n        </template>\n\n        <template #footer>\n            <div class=\"flex\">\n                <button\n                    type=\"button\"\n                    @click=\"fixture?.export()\"\n                    class=\"bg-green-700 hover:bg-green-800 text-white font-bold py-8 px-4 sm:px-16 mr-8 sm:mr-16\"\n                    :aria-label=\"t('export.download')\"\n                >\n                    {{ t('export.download') }}\n                </button>\n\n                <button type=\"button\" @click=\"make()\" class=\"py-8 px-4 sm:px-16\" :aria-label=\"t('export.refresh')\">\n                    {{ t('export.refresh') }}\n                </button>\n\n                <export-settings\n                    v-if=\"!hasCustomRenderer\"\n                    :componentSelectedState=\"selectedComponents\"\n                    class=\"ml-auto flex px-4 sm:px-8\"\n                ></export-settings>\n            </div>\n        </template>\n    </panel-screen>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, inject, onBeforeMount, onBeforeUnmount, onMounted, ref, useTemplateRef, watch } from 'vue';\nimport type { PropType } from 'vue';\nimport type { InstanceAPI, PanelInstance } from '@/api';\nimport type { ExportAPI } from './api/export';\n\nimport { debounce } from 'throttle-debounce';\n\nimport ExportSettings from './settings-button.vue';\nimport { useExportStore } from './store';\nimport { useI18n } from 'vue-i18n';\n\nconst props = defineProps({\n    panel: {\n        type: Object as PropType<PanelInstance>,\n        required: true\n    }\n});\n\nconst { t } = useI18n();\nconst iApi = inject('iApi') as InstanceAPI;\nconst exportStore = useExportStore();\n\nconst fixture = ref<ExportAPI>();\n\n// we need two resize observers, one for the root element and one for the panel since the panel can resize independently of the root (another panel was closed/opened)\n// changes to the root element impact map boundaries, changes to the panel impact the resolution of the displayed export\nconst rootResizeObserver = ref<ResizeObserver | undefined>(undefined);\nconst panelResizeObserver = ref<ResizeObserver | undefined>(undefined);\nconst watchers = ref<Array<() => void>>([]);\n\nconst el = useTemplateRef('componentEl');\nconst componentSelectedState = computed(() => exportStore.componentSelectedState);\nconst selectedComponents = computed<any>(() => {\n    const state: any = {};\n    if (fixture.value) {\n        Object.keys(componentSelectedState.value).forEach((component: string) => {\n            state[component] = {\n                name: component,\n                selected:\n                    componentSelectedState.value[\n                        component as 'title' | 'map' | 'mapElements' | 'legend' | 'footnote' | 'timestamp'\n                    ] ?? false,\n                selectable: (fixture.value?.config as any)[component]?.selectable ?? true\n            };\n        });\n    }\n    return state;\n});\n\nconst hasCustomRenderer = computed(() => {\n    return !!fixture.value?.customRendererFunc;\n});\n\nconst make = debounce(300, () => {\n    if (!fixture.value || !el.value) {\n        return;\n    }\n\n    const canvasElement = el.value!.querySelector('.export-canvas') as HTMLCanvasElement;\n\n    fixture.value.make(canvasElement, el.value!.clientWidth);\n});\n\nonBeforeMount(() => {\n    (props.panel as any).exportMake = make;\n    // Set up watchers\n    watchers.value.push(\n        // Listen for any changes to the settings, and refresh the image when they do change\n        watch(selectedComponents, () => {\n            make();\n        })\n    );\n});\n\nonMounted(() => {\n    fixture.value = iApi.fixture.get('export') as ExportAPI;\n    rootResizeObserver.value = new ResizeObserver(make);\n    panelResizeObserver.value = new ResizeObserver(make);\n    // observe the root element for resize events, not the component itself\n    rootResizeObserver.value.observe(iApi.$rootEl);\n    panelResizeObserver.value.observe(iApi.$rootEl.querySelector('[data-cy=\"export\"]')!);\n});\n\nonBeforeUnmount(() => {\n    // remove the resize observer\n    rootResizeObserver.value!.disconnect();\n    panelResizeObserver.value!.disconnect();\n    // remove the watchers\n    watchers.value.forEach(unwatch => unwatch());\n});\n</script>\n\n<style lang=\"scss\" scoped></style>\n"],"names":["t","useI18n","panelStore","usePanelStore","exportStore","useExportStore","dropdownPlacement","computed","toggleComponent","component","props","__props","iApi","inject","fixture","ref","rootResizeObserver","panelResizeObserver","watchers","el","useTemplateRef","componentSelectedState","selectedComponents","state","hasCustomRenderer","make","debounce","canvasElement","onBeforeMount","watch","onMounted","onBeforeUnmount","unwatch"],"mappings":";;;;;;;;;;AAmDM,UAAA,EAAE,GAAAA,EAAE,IAAIC,EAAQ,GAChBC,IAAaC,EAAc,GAC3BC,IAAcC,EAAe,GAS7BC,IAAoBC,EAAiB,MAAOL,EAAW,aAAa,YAAY,UAAW,GAE3FM,IAAkB,CAACC,MAAyB;AAC1C,MAACA,EAAU,cAIfL,EAAY,eAAe;AAAA,QACvB,MAAMK,EAAU;AAAA,MAAA,CACnB;AAAA,IACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzBA,UAAMC,IAAQC,GAOR,EAAE,GAAAX,EAAE,IAAIC,EAAQ,GAChBW,IAAOC,EAAO,MAAM,GACpBT,IAAcC,EAAe,GAE7BS,IAAUC,EAAe,GAIzBC,IAAqBD,EAAgC,MAAS,GAC9DE,IAAsBF,EAAgC,MAAS,GAC/DG,IAAWH,EAAuB,EAAE,GAEpCI,IAAKC,EAAe,aAAa,GACjCC,IAAyBd,EAAS,MAAMH,EAAY,sBAAsB,GAC1EkB,IAAqBf,EAAc,MAAM;AAC3C,YAAMgB,IAAa,CAAC;AACpB,aAAIT,EAAQ,SACR,OAAO,KAAKO,EAAuB,KAAK,EAAE,QAAQ,CAACZ,MAAsB;AACrE,QAAAc,EAAMd,CAAS,IAAI;AAAA,UACf,MAAMA;AAAA,UACN,UACIY,EAAuB,MACnBZ,CACJ,KAAK;AAAA,UACT,aAAaK,EAAQ,OAAO,QAAeL,CAAS,GAAG,cAAc;AAAA,QACzE;AAAA,MAAA,CACH,GAEEc;AAAA,IAAA,CACV,GAEKC,IAAoBjB,EAAS,MACxB,CAAC,CAACO,EAAQ,OAAO,kBAC3B,GAEKW,IAAOC,EAAS,KAAK,MAAM;AAC7B,UAAI,CAACZ,EAAQ,SAAS,CAACK,EAAG;AACtB;AAGJ,YAAMQ,IAAgBR,EAAG,MAAO,cAAc,gBAAgB;AAE9D,MAAAL,EAAQ,MAAM,KAAKa,GAAeR,EAAG,MAAO,WAAW;AAAA,IAAA,CAC1D;AAED,WAAAS,EAAc,MAAM;AACf,MAAAlB,EAAM,MAAc,aAAae,GAElCP,EAAS,MAAM;AAAA;AAAA,QAEXW,EAAMP,GAAoB,MAAM;AACvB,UAAAG,EAAA;AAAA,QACR,CAAA;AAAA,MACL;AAAA,IAAA,CACH,GAEDK,EAAU,MAAM;AACZ,MAAAhB,EAAQ,QAAQF,EAAK,QAAQ,IAAI,QAAQ,GACtBI,EAAA,QAAQ,IAAI,eAAeS,CAAI,GAC9BR,EAAA,QAAQ,IAAI,eAAeQ,CAAI,GAEhCT,EAAA,MAAM,QAAQJ,EAAK,OAAO,GAC7CK,EAAoB,MAAM,QAAQL,EAAK,QAAQ,cAAc,oBAAoB,CAAE;AAAA,IAAA,CACtF,GAEDmB,EAAgB,MAAM;AAElB,MAAAf,EAAmB,MAAO,WAAW,GACrCC,EAAoB,MAAO,WAAW,GAEtCC,EAAS,MAAM,QAAQ,CAAWc,MAAAA,EAAA,CAAS;AAAA,IAAA,CAC9C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}