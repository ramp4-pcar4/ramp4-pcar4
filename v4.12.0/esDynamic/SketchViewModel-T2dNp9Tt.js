import{jS as po,$ as Qe,a9 as v,aJ as lo,T as co,U as ho,fa as uo,am as et,x as c,z as h,K as C,bx as tt,G as Mn,bs as yo,aX as de,bP as go,b6 as fo,gh as vo,aU as mo,bE as Pn,a3 as J,c9 as _o,h7 as Eo,a4 as _e,f4 as Ce,V as Ee,n as Rn,dh as bo,fI as wo,eQ as To,d4 as kt,cW as So,a7 as Oo,X as Ct,gO as Go,eC as Mo,cz as An,f3 as Po,cA as Ro,kv as Ao,kw as xo,a6 as xn,d5 as nt,a5 as ko,fT as Lt,u as kn,kx as Co,ft as Lo,ky as Q,cB as Cn,s as Io,h9 as Ln,bD as No,iU as Le,eq as In}from"./main-DnzmeE4U.js";import{h as Do}from"./UpdatingHandles-DBzjq66S.js";import{i as Ho,O as It,Q as Uo,L as Fo,k as Vo,K as jo}from"./projection-m8vi7Cxv.js";import qo from"./GraphicsLayer-GkJJfSu5.js";import{n as zo}from"./ElevationInfo-DkWlof50.js";import{t as Yo,_ as P,a as Zo,b as Bo,c as Wo,n as Nn}from"./globalCss-CFN4F315.js";import{o as Ie,m as Nt}from"./quantityUtils-RaoZoCNH.js";import{e as N,u as Ko,q as Dn,d as ee,j as Oe,p as be,l as $o,B as Xo,_ as Jo,o as Hn,b as Un,E as Fn,L as Qo,m as es}from"./vec2-BnynUbeJ.js";import{n as z,t as it,l as ts,m as ns}from"./vec2f64-CEUyUoff.js";import{s as ot,H as G,p as Vn,R as V,P as U,q as L,o as te,c as st,_ as rt,Z as Dt,v as Ht,j as is,A as os,J as ss,u as rs,I as as}from"./vec32-BuqRmYBM.js";import{e as Ne,a as jn,n as at}from"./projectVectorToVector-D0K_S4MR.js";import{j as pt,q as Ut,b as Ft,N as Vt}from"./geodesicUtils-DV-lFWtb.js";import{g as ps}from"./TimeExtent-gZaEUVeW.js";import{b as ls}from"./Query-CxQYWcUQ.js";import{s as cs,j as hs}from"./vec42-D8CJyqHG.js";import{n as ds}from"./vec4f64-CjUMzAyX.js";import{M as Y,z as us,l as lt,Q as jt,d as qn,k as zn,V as ys,H as Yn,O as Zn,p as gs}from"./plane-B_adY3_o.js";import{I as fs,O as vs,_ as ms,$ as _s,U as Es}from"./sphere-Cj20syUS.js";import{e as De}from"./common-CYWrYyJl.js";function Bn(e){return e?ue:ni}function Wn(e,t){return t?.mode?t.mode:Bn(e).mode}function Kn(e,t){return t??Bn(e)}function qt(e,t){return Wn(e==null||(e.hasZ??!1),t)}function bs(e,t){return Kn(e==null||(e.hasZ??!1),t)}function $n(e){const t=Qn(e);return qt(e.geometry,t)}function Xn(e){const t=Qn(e),n=qt(e.geometry,t),i=t!=null&&n!=="on-the-ground"?xs(t):0,o=t?.featureExpressionInfo;return{mode:n,offset:i,featureExpressionInfo:o}}function ws(e){return ct(Xn(e))}function Ts(e){return ct(e)||Jn(e)}function Jn(e){return e?.featureExpressionInfo?.expression==="0"}function ct(e){if(!e||e.mode==="on-the-ground")return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||t==="0")}function Qn(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function ht(e,t){if(!e?.offset)return 0;const{offset:n,unit:i}=e;if(i==="decimal-degrees")return 0;const o=i!=="unknown"&&i?i:"meters",s=po(t);return s?Qe(n,o,s):0}function Ss(e,t,n){if(!n?.mode)return;const i=e.hasZ?e.z:0,o=ht(n,e.spatialReference);switch(n.mode){case"absolute-height":return i-o;case"on-the-ground":return 0;case"relative-to-ground":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"ground")??0)+o);case"relative-to-scene":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"scene")??0)+o)}}function ei(e,t,n,i=null){return dt(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,i)}function zt(e,t,n,i,o=null){return dt(e,t[0],t[1],t.length>2?t[2]:0,n,i,o)}function dt(e,t,n,i,o,s,a=null){if(s==null)return;const r=a!=null?a.mode:"absolute-height";if(r==="on-the-ground")return 0;const{absoluteZ:l}=ti(t,n,i,o,e,s);return Os(l,t,n,i,o,e,a,r)}function ti(e,t,n,i,o,s){const a=ht(s,i);switch(s.mode){case"absolute-height":return{absoluteZ:n+a,elevation:0};case"on-the-ground":{const r=o.elevationProvider.getElevation(e,t,0,i,"ground")??0;return{absoluteZ:r,elevation:r}}case"relative-to-ground":{const r=o.elevationProvider.getElevation(e,t,n,i,"ground")??0;return{absoluteZ:n+r+a,elevation:r}}case"relative-to-scene":{const r=o.elevationProvider.getElevation(e,t,n,i,"scene")??0;return{absoluteZ:n+r+a,elevation:r}}}}function Os(e,t,n,i,o,s,a,r){const l=ht(a,o);switch(r){case"absolute-height":return e-l;case"relative-to-ground":return e-((s.elevationProvider.getElevation(t,n,i,o,"ground")??0)+l);case"relative-to-scene":return e-((s.elevationProvider.getElevation(t,n,i,o,"scene")??0)+l)}}function Gs(e,t){if(t==null)return!1;const{mode:n}=t;return n!=null&&(e==="scene"&&n==="relative-to-scene"||e==="ground"&&n!=="absolute-height")}function Ms(e,t,n){return n&&n.mode!==t?`${e} only support ${t} elevation mode`:null}function Ps(e,t,n){return n?.mode===t?`${e} do not support ${t} elevation mode`:null}function Rs(e,t){return t?.featureExpressionInfo!=null&&t.featureExpressionInfo.expression!=="0"?`${e} do not support featureExpressionInfo`:null}function As(e,t){t&&e.warn(".elevationInfo=",t)}function xs(e){return(e?.offset??0)*zo(e?.unit)}const ue={mode:"absolute-height",offset:0},ni={mode:"on-the-ground",offset:null};function Yt(e,t){return e[0]*t[1]-e[1]*t[0]}function ks(e,t,n){const i=Oe(n,t)/be(n);return $o(e,n,i)}function Cs(e,t,n,i,o=n){return N(we,i,n),N(ut,t,o),ks(Ge,ut,we),Ko(e,o,Ge)}function Ls(e,t,n,i){N(we,t,n);const o=i/Dn(we);return ee(e,n,we,o)}function Is(e,t){const n=e.start,i=e.end,o=t.start,s=t.end,a=N(we,i,n),r=N(ii,s,o),l=Yt(a,r);if(Math.abs(l)<=Ds)return[];const p=N(ut,n,o),d=Yt(r,p)/l,u=Yt(a,p)/l;if(d>=0){if(u>=0||t.type===O.LINE)return[ee(Ge,n,a,d)]}else if(e.type===O.LINE&&(u>=0||t.type===O.LINE))return[ee(Ge,n,a,d)];return[]}function Ns(e,t,n){const i=[],o=N(we,e.end,e.start),s=N(ii,e.start,t),a=be(o),r=2*Oe(o,s),l=r*r-4*a*(be(s)-n*n);if(l===0){const p=-r/(2*a);(e.type===O.LINE||p>=0)&&i.push(ee(Ge,e.start,o,p))}else if(l>0){const p=Math.sqrt(l),d=(-r+p)/(2*a);(e.type===O.LINE||d>=0)&&i.push(ee(Ge,e.start,o,d));const u=(-r-p)/(2*a);(e.type===O.LINE||u>=0)&&i.push(ee(ut,e.start,o,u))}return i}var O;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})(O||(O={}));const Ds=1e-6,we=z(),ii=z(),ut=z(),Ge=z();function oi(e,t,n,i,o=v()){const s=ot(Hs,e);return s[2]=zt(i,s,t,n)||0,i.renderCoordsHelper.toRenderCoords(s,t,o),o}const Hs=v(),si="z",ri="r",M={redo:ri,undo:si,center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},ai={toggle:"Control"},Us={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},Fs={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:Yo,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},editSourcePoints:{key:"Alt",continuePropagation:!0},undo:si,redo:ri};let Vs=class{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,n=>{n.type==="key-down"&&t(n)})}addToggle(e,t){const n=js.fromDefinition(e,t),i=lo(this._bindings,n.key,()=>[]);return i.push(n),co(()=>ho(i,n))}register(e,t=P.WIDGET){return uo([e.on("key-down",n=>this.dispatch(e.inputManager,n),t),e.on("key-up",n=>this.dispatch(e.inputManager,n),t)])}dispatch(e,t){const n=t.key,i=this._bindings.get(n);if(i)for(const o of i)o.process(e,t)}},js=class Gn{constructor(t,n,i,o,s){this.key=t,this.modifiers=n,this.repeats=i,this.continuePropagation=o,this.callback=s}process(t,n){if(!(n.key!==this.key||"repeat"in n&&n.repeat&&!this.repeats)){for(const i of this.modifiers)if(!t.isModifierKeyDown(i))return;this.continuePropagation||n.stopPropagation(),this.callback(n)}}static fromDefinition(t,n){if(typeof t=="string")return new Gn(t,[],!1,!1,n);const{key:i,modifier:o,repeats:s,continuePropagation:a}=t;return new Gn(i,o?Array.isArray(o)?o:[o]:[],!!s,!!a,n)}};var Te;function Zt(e,t,n){return F(e,t,n)}function F(e=0,t=0,n=0){return et(e,t,n)}function qs(e){return e}function zs(e){return e}function se(e,t,n){return et(e,t,n)}function Me(e){const[t,n,i]=e;return e.length>3?[t,n,i,e[3]]:[t,n,i]}function yt(e){return e[3]=((e.length>3?e[3]:void 0)??Te.NONE)|Te.TARGET,e}function Ys(e){return!!(((e.length>3?e[3]:void 0)??Te.NONE)&Te.TARGET)}function Bt(e,t,{coordinateHelper:n,elevationInfo:i},o){return e?Pe(n.vectorToDehydratedPoint(e,Ws),t,i,o):null}function Pe(e,t,n,i=F()){return i[0]=e.x,i[1]=e.y,i[2]=e.z??0,t==null||(t.type==="2d"?i[2]=0:i[2]=ei(t,e,n,ue)??0),i}function Zs(e,t,n){return n?(jn(n,e[0],e[1],e[2],t),n):Ne(e[0],e[1],e[2],t)}function Wt(e,t,{z:n,m:i},o,s){const{spatialReference:a,elevationInfo:r}=o;let l;n==null&&i==null?l=void 0:t==null||t.type==="2d"?l=n??void 0:l=zt(t,e,a,ue,r)??0;const[p,d]=e;return s?jn(s,p,d,l,a):s=Ne(p,d,l,a),i!=null&&(s.m=i,s.hasM=!0),s}function Bs(e,t,n,i,o=F()){const[s,a]=e;return o[0]=s,o[1]=a,e.length>3&&(o[3]=e[3]??Te.NONE),n?.type!=="3d"?(o[2]=t.value,o):(o[2]=dt(n,s,a,t.value,i,t.elevationInfo,ue)??0,o)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(Te||(Te={}));const Ws=Ne(0,0,0,null);let W=class extends Mn{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],W.prototype,"enabled",void 0),W=c([C("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],W);let S=class extends Mn{constructor(e){super(e),this.lineSnapper=new W,this.parallelLineSnapper=new W,this.rightAngleSnapper=new W,this.rightAngleTriangleSnapper=new W,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new tt([255,127,0]),this.orangeTransparent=new tt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:W,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),c([h({type:W,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),c([h({type:W,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),c([h({type:W,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),c([h({type:tt,nonNullable:!0})],S.prototype,"orange",void 0),c([h({type:tt,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=c([C("esri.views.interactive.snapping.Settings.Defaults")],S);const He=new S;var x;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(x||(x={}));let Ue=class{constructor(e,t){this.isDraped=e,this.domain=t}},pi=class oo extends Ue{constructor(t,n,i=x.ALL){super(n,i),this.intersectionPoint=t}equals(t){return t instanceof oo&&G(this.intersectionPoint,t.intersectionPoint)}},K=class so extends Ue{constructor(t,n,i,o,s=x.ALL,a=!0,r=!0){super(o,s),this.type=t,this.lineStart=n,this.lineEnd=i,this.fadeLeft=a,this.fadeRight=r}equals(t){return t instanceof so&&this.type===t.type&&G(this.lineStart,t.lineStart)&&G(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return Vn(this.lineStart,this.lineEnd)}},li=class ro extends Ue{constructor(t,n,i,o=x.ALL){super(i,o),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof ro&&G(this.lineStart,t.lineStart)&&G(this.lineEnd,t.lineEnd)}},Kt=class ao extends Ue{constructor(t,n,i,o,s=x.ALL){super(o,s),this.previousVertex=t,this.centerVertex=n,this.nextVertex=i}equals(t){return t instanceof ao&&G(this.previousVertex,t.previousVertex)&&G(this.centerVertex,t.centerVertex)&&G(this.nextVertex,t.nextVertex)}};function $t({start:e,end:t,type:n},i,o){const s=[],a=N(Fe,t,e),r=N(ft,e,i),l=be(a),p=2*Oe(a,r),d=p*p-4*l*(be(r)-o*o);if(d===0){const u=-p/(2*l);(n===j.PLANE||u>=0)&&s.push(ee(z(),e,a,u))}else if(d>0){const u=Math.sqrt(d),f=(-p+u)/(2*l);(n===j.PLANE||f>=0)&&s.push(ee(z(),e,a,f));const y=(-p-u)/(2*l);(n===j.PLANE||y>=0)&&s.push(ee(z(),e,a,y))}return s}function ci(e,t){const n=e.start,i=e.end,o=N(Fe,i,n),s=te(mt,-o[1],o[0],0),a=t.start,r=t.end,l=V(Qt,r,a),p=U(l,s),d=te(vi,n[0],n[1],0),u=V(mi,d,a),f=U(u,s),y=De();if(Math.abs(p)<y)return[];const g=L(_i,a,l,f/p);if(t.type===O.RAY){const _=V(en,g,a);if(U(_,l)<-y)return[]}if(e.type===j.HALF_PLANE){const _=Xo(ft,g,n);if(Oe(_,o)<-y)return[]}return[de(g)]}function Ks(e,t){return Xs(gt(tn,t[2],e),t)}function hi(e,t){return gi(gt(tn,0,e),gt(tr,0,t)).map(([n,i])=>it(n,i))}function di(e,t,n){return Xt(e,gt(tn,e[2],t),n)}function ui(e,t,n,i=v()){const o=N(Fe,e,t),s=Dn(o);return ee(i,t,o,s===0?1:n/s),i[2]=e[2],i}function Xt(e,{start:t,end:n,type:i},o=v()){const s=V(vt,e,t),a=V(mt,n,t),r=U(s,a)/U(a,a);return L(o,t,a,i===O.RAY?Math.max(r,0):r)}const $s=(()=>{const e=v(),t=v(),n=v();return({start:i,end:o},{center:s,radius:a,normal:r,slicePlane:l})=>{const p=lt(s,r,er);if(w(jt(p,i),0)&&w(jt(p,o),0)){qn(r,e,t);const u=(g,_)=>(st(n,_,s),Hn(g,U(n,e),U(n,t)),g),f=Ns({start:u(Fe,i),end:u(ft,o),type:O.LINE},ts,a),y=[];for(const[g,_]of f){const T=ot(v(),s);L(T,T,e,g),L(T,T,t,_),l&&!ye(l,T)||y.push(T)}return y}const d=v();return zn(p,i,o,d)?!w(Vn(d,s),a)||l&&!ye(l,d)?[]:[d]:[]}})();function yi({start:e,end:t,type:n},i,o){const s=[],a=st(vt,t,e),r=N(ft,e,i),l=be(a),p=2*Oe(a,r),d=p*p-4*l*(be(r)-o*o);if(d===0){const u=-p/(2*l);(n===O.LINE||u>=0)&&s.push(L(v(),e,a,u))}else if(d>0){const u=Math.sqrt(d),f=(-p+u)/(2*l);(n===O.LINE||f>=0)&&s.push(L(v(),e,a,f));const y=(-p-u)/(2*l);(n===O.LINE||y>=0)&&s.push(L(v(),e,a,y))}return s}function gi(e,t){const n=e.start,i=e.end,o=t.start,s=t.end,a=V(vt,i,n),r=V(mt,s,o),l=V(Qt,o,n),p=rt(vi,a,r);if(!w(U(l,p),0))return[];const d=Dt(p);if(w(d,0))return[];const u=rt(mi,l,r),f=U(u,p)/d,y=L(_i,n,a,f);if(e.type===O.RAY){const g=V(en,y,n);if(U(a,g)<-De())return[]}if(t.type===O.RAY){const g=V(en,y,o);if(U(r,g)<-De())return[]}return[de(y)]}function Xs({start:e,end:t,type:n},i){const o=V(vt,i,e),s=V(mt,t,e),a=rt(Qt,s,o),r=Dt(a)/Dt(s),l=De();if(r<l)switch(n){case O.LINE:return[de(i)];case O.RAY:return U(s,o)<-l?[]:[de(i)]}return[]}function Jt(e,t,n,i){const[o,s]=e,[a,r]=n,l=a-o,p=r-s,d=l*l+p*p,u=Math.sqrt(d);if(u>t+i)return[];if(u<Math.abs(t-i))return[];if(w(u,0)&&w(t,i))return[];const f=(t*t-i*i+d)/(2*u),y=Math.sqrt(t*t-f*f),g=y*p/u,_=y*l/u,[T,E]=Jo(Fe,e,n,f/u);return w(g,_)?[it(T,E)]:[it(T+g,E-_),it(T-g,E+_)]}function gt(e,t,{start:n,end:i,type:o}){return te(e.start,n[0],n[1],t),te(e.end,i[0],i[1],t),e.type=Qs[o],e}function fi(e,t){return w(e[2],t[2])}function w(e,t){return yo(Math.abs(e-t),0,De())}function Js(e,t){return t.filter(n=>ye(e,n))}function ye(e,t){return us(e,t)}var j;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})(j||(j={}));const Qs={[j.PLANE]:O.LINE,[j.HALF_PLANE]:O.RAY},Fe=z(),ft=z(),vt=v(),mt=v(),Qt=v(),vi=v(),mi=v(),_i=v(),en=v(),er=Y(),tn={start:v(),end:v(),type:O.LINE},tr={start:v(),end:v(),type:O.LINE};class Z{intersect(t){return re(this,t)}closestPoints(t){return[this.closestTo(t)]}}class Se extends Z{constructor(t){super(),this.point=t}equals(t){return this===t||B(t)&&G(this.point,t.point)}closestTo(){return Me(this.point)}}class nn extends Z{constructor(t,n,i){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:i}}equals(t){return this===t||ne(t)&&this.lineLike.type===t.lineLike.type&&G(this.start,t.start)&&G(this.end,t.end)}closestTo(t){const n=F();return Xt(t,this.lineLike,n),n}}class on extends nn{constructor(t,n){super(t,n,O.LINE)}}class nr extends nn{constructor(t,n){super(t,n,O.RAY)}}class Ei extends Z{constructor(t){super(),this.constraints=t}equals(t){return this===t||dn(t)&&fo(this.constraints,t.constraints,(n,i)=>n.equals(i))}closestTo(t){let n,i=1/0;for(const o of this.constraints){const s=o.closestTo(t),a=Ht(t,s);a<i&&(i=a,n=s)}return Me(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class sn extends Z{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||oe(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=F();return ui(t,this.center,this.radius,n),n}}class rn extends Z{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||pe(t)&&G(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=F();return ui(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new an(Me(this.center),this.radius,se(0,0,1))}}class an extends Z{constructor(t,n,i,o=void 0){super(),this.center=t,this.radius=n,this.normal=i,this.slicePlane=o}equals(t){return this===t||ge(t)&&G(this.center,t.center)&&G(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:i}=this;Yn(this.getPlane(ir),t,pn);const o=V(pn,pn,n),s=is(o);if(w(s,0))return Me(t);const a=i/Math.sqrt(s),r=F();L(r,n,o,a);const{slicePlane:l}=this;return l&&!ye(l,r)?cn(l,this)?.closestTo(t)??Me(t):r}getPlane(t=Y()){return lt(this.center,this.normal,t)}}const pn=v(),ir=Y();class bi extends Z{constructor(t){super(),this.z=t}equals(t){return this===t||ae(t)&&this.z===t.z}closestTo(t){return se(t[0],t[1],this.z)}getPlane(t=Y()){return te(wi,0,0,this.z),lt(wi,mo,t)}}const wi=v();class ln extends Z{constructor(t,n,i){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:i}}equals(t){return this===t||ie(t)&&this.planeLike.type===t.planeLike.type&&G(this.start,t.start)&&G(this.end,t.end)}closestTo(t){const n=F();return di(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:i}=this.planeLike;return Math.sign(Oe(N(or,i,n),N(sr,t,n)))>0?this.end:this.start}getPlane(t=Y()){const n=ot(Ti,this.end);return n[2]+=1,gs(this.start,this.end,n,t)}getSlicePlane(t=Y()){const{start:n,end:i,type:o}=this.planeLike;if(o===j.PLANE)return;const s=te(Ti,n[0],n[1],0),a=te(Si,i[0],i[1],0),r=st(Si,a,s);return lt(s,r,t),t}}const or=z(),sr=z(),Ti=v(),Si=v();class rr extends ln{constructor(t,n){super(t,n,j.HALF_PLANE)}}class Oi extends ln{constructor(t,n){super(t,n,j.PLANE)}}class ar extends Z{constructor(t,n){super(),this.sphere=vs(t,n)}equals(t){return this===t||le(t)&&ms(this.sphere,t.sphere)}closestTo(t){const n=F();return _s(this.sphere,t,n),n}get center(){return Es(this.sphere)}get radius(){return this.sphere[3]}}class Gi extends Z{constructor(t,n,i){super(),this.start=t,this.end=n,this.getZ=i,this.planeLike={start:t,end:n,type:j.PLANE}}equals(t){return this===t||Et(t)&&G(this.start,t.start)&&G(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return hr(this,t)}addIfOnTheGround(t,n){for(const i of n){const o=this.getZ(i[0],i[1])??0;w(i[2],o)&&(i[2]=o,t.push(i))}}}class Mi extends Z{constructor(t,n,i){super(),this._x=t,this._y=n,this._z=i}equals(t){return this===t||Mr(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,i]){return Zt(this._x??t,this._y??n,this._z??i)}}class Pi extends Z{constructor(t,n,i,o,s){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=i,this._z=o,this._directionDegrees=s}equals(t){return this===t||Gr(t)&&Fn(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,i]){return Hn(Ve,t,n),Fn(Ve,this._origin)||this._applyDirectionAndDistance(Ve),Zt(Ve[0],Ve[1],this._z??i)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)pt(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)lr(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=Ut(pr,this._origin,t,this._spatialReference);pt(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const Ve=[0,0],pr=new Ft;function lr(e,t,n,i,o){let{azimuth:s,distance:a}=Ut(cr,t,i,o);s??=0;let r=a*Math.cos((s-n)*Ho);r=Math.max(0,r),pt(e,t,n,r,o)}const cr=new Ft;function hr(e,t){const n=F();return di(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??xi,n}function re(e,t){if(dn(e)){const n=[];for(const i of e.constraints){const o=i.intersect(t);o&&n.push(o)}return _t(n)}if(dn(t))return re(t,e);if(Et(e))return Ri(e,t);if(Et(t))return Ri(t,e);if(B(e)){const{point:n}=e;if(B(t))return G(n,t.point)?e:void 0;const i=t.closestTo(n);return ss(i,n)?e:void 0}if(ne(e)){if(B(t))return re(t,e);if(ne(t))return $(gi(e.lineLike,t.lineLike));if(ae(t))return dr(e,t);if(ie(t))return $(ci(t.planeLike,e.lineLike));if(oe(t))return $(yi(e.lineLike,t.center,t.radius));if(ge(t))return $($s(e.lineLike,t));if(pe(t))return ur(e,t);if(le(t))return yr(e,t)}else if(ae(e)){if(B(t)||ne(t))return re(t,e);if(ae(t))return gr(e,t);if(ie(t))return fr(e,t);if(oe(t))return vr(e,t);if(ge(t))return _r(e,t);if(pe(t))return mr(e,t);if(le(t))return Er(e,t)}else if(ie(e)){if(B(t)||ne(t)||ae(t))return re(t,e);if(ie(t))return hn(hi(e.planeLike,t.planeLike));if(oe(t))return hn($t(e.planeLike,t.center,t.radius));if(ge(t))return wr(e,t);if(pe(t))return br(e,t);if(le(t))return Tr(e,t)}else if(oe(e)){if(B(t)||ne(t)||ae(t)||ie(t))return re(t,e);if(oe(t))return hn(Jt(e.center,e.radius,t.center,t.radius));if(ge(t))return;if(pe(t))return Sr(e,t);if(le(t))return}else if(ge(e)){if(B(t)||ne(t)||ae(t)||ie(t)||oe(t))return re(t,e);if(ge(t))return;if(pe(t))return t.asCircle(),void 0;if(le(t))return}else if(pe(e)){if(B(t)||ne(t)||ae(t)||ie(t)||oe(t)||ge(t))return re(t,e);if(pe(t))return Or(t,e);if(le(t))return}else if(le(e)){if(B(t)||ne(t)||ae(t)||ie(t)||oe(t)||pe(t))return re(t,e);if(le(t))return}}const dr=(()=>{const e=Y();return(t,n)=>{const{start:i,end:o}=t;if(fi(i,o)&&w(i[2],n.z))return t;const s=F();return zn(n.getPlane(e),i,o,s)?new Se(s):void 0}})();function ur({lineLike:e},{center:t,radius:n}){const i=t[2];return $(yi(e,t,n).filter(o=>w(o[2],i)))}function yr({lineLike:e},{sphere:t}){return $(fs(t,e.start,e.end))}const cn=(()=>{const e=ds(),t=v(),n=v();return(i,o,s)=>{const{normal:a,center:r,radius:l}=o;qn(a,t,n);const p=Zn(i),d=l*U(p,t),u=l*U(p,n);cs(e,r[0],r[1],r[2],1);const f=hs(i,e),y=Math.hypot(d,u),g=w(y,0);if(w(jt(i,r),0)){if(g)return o;if(w(l,0))return!s||ye(s,r)?new Se(Me(r)):void 0;rt(t,p,a),os(t,t);const xt=new Array,Xe=de(r);L(Xe,Xe,t,l),s&&!ye(s,Xe)||xt.push(Xe);const Je=de(r);return L(Je,Je,t,-l),s&&!ye(s,Je)||xt.push(Je),$(xt)}if(g)return;const _=-f/y;if(Math.abs(_)>1||w(_,1))return;const T=Math.atan(d/u),E=vo(_)-T,ke=Math.PI-E,We=new Array,Ke=v();L(Ke,r,t,l*Math.cos(E)),L(Ke,Ke,n,l*Math.sin(E)),We.push(Ke);const $e=v();return L($e,r,t,l*Math.cos(ke)),L($e,$e,n,l*Math.sin(ke)),We.push($e),$(s?Js(s,We):We)}})();function gr(e,t){return w(e.z,t.z)?e:void 0}function fr({z:e},{planeLike:t}){const[n,i]=t.start,[o,s]=t.end,a=se(n,i,e),r=se(o,s,e);return t.type===j.PLANE?new on(a,r):new nr(a,r)}function vr(e,t){const[n,i]=t.center;return new rn(se(n,i,e.z),t.radius)}function mr(e,t){return w(t.center[2],e.z)?t:void 0}const _r=(()=>{const e=Y();return(t,n)=>cn(t.getPlane(e),n,n.slicePlane)})();function Er(e,{center:t,radius:n}){const i=Math.abs(t[2]-e.z);if(i>n&&!w(i,n))return;const o=se(t[0],t[1],e.z),s=Math.sqrt(n**2-i**2);return w(s,0)?void 0:new rn(o,s)}const br=(()=>{const e=Y();return(t,{center:n,radius:i})=>{const o=$t(t.planeLike,n,i),s=n[2];t.getSlicePlane(e);const a=new Array;for(const[r,l]of o){const p=[r,l,s];ye(e,p)&&a.push(p)}return $(a)}})(),wr=(()=>{const e=Y(),t=Y();return(n,i)=>cn(n.getPlane(e),i,n.getSlicePlane(t))})(),Tr=(()=>{const e=Y();return(t,{center:n,radius:i})=>{const o=t.getPlane(e),s=ys(o,n),a=Math.abs(s);if(a>i&&!w(a,i))return;const r=Math.sqrt(i**2-s**2);if(w(r,0)){const d=F();return Yn(o,n,d),new Se(d)}const l=F(),p=de(Zn(o));return L(l,n,p,s),new an(l,r,p,t.getSlicePlane())}})();function Sr(e,t){const n=Un(e.center,t.center);return w(n,0)&&w(e.radius,t.radius)?t:Ai(Jt(e.center,e.radius,t.center,t.radius),t.center[2])}function Or(e,t){if(!fi(e.center,t.center))return;const n=Un(e.center,t.center);return w(n,0)&&w(e.radius,t.radius)?e:Ai(Jt(e.center,e.radius,t.center,t.radius),e.center[2])}function Ri(e,t){const{planeLike:n,getZ:i}=e,o=new Array;if(B(t))e.addIfOnTheGround(o,Ks(n,t.point));else if(ne(t))e.addIfOnTheGround(o,ci(n,t.lineLike));else if(oe(t))for(const[s,a]of $t(n,t.center,t.radius)){const r=i(s,a);r!=null&&o.push(et(s,a,r))}else if(ie(t)||Et(t))for(const[s,a]of hi(n,t.planeLike)){const r=i(s,a)??xi;o.push(et(s,a,r))}return $(o)}function hn(e){return _t(e.map(([t,n])=>{const i=se(t,n,0),o=se(t,n,1);return new on(i,o)}))}function $(e){return _t(e.map(t=>t?new Se(t):void 0))}function Ai(e,t){return $(e.map(([n,i])=>[n,i,t]))}function _t(e){if(e.length!==0)return e.length===1?e[0]??void 0:new Ei(e.filter(go))}function dn(e){return e instanceof Ei}function B(e){return e instanceof Se}function ne(e){return e instanceof nn}function ae(e){return e instanceof bi}function ie(e){return e instanceof ln}function oe(e){return e instanceof sn}function pe(e){return e instanceof rn}function ge(e){return e instanceof an}function le(e){return e instanceof ar}function Et(e){return e instanceof Gi}function Gr(e){return e instanceof Pi}function Mr(e){return e instanceof Mi}const xi=0;var D;function ki(e,t){if(e==null||t==null)return;const n=un(e,t);return n!=null?Ie(n,"radians","geographic"):void 0}(function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"})(D||(D={}));const un=(()=>{const e=v(),t=v();return(n,i)=>(te(e,n.x,n.y,n.z??0),te(t,i.x,i.y,i.z??0),Ci(e,t,n.spatialReference,i.spatialReference))})(),Ci=(()=>{const e=z(),t=v(),n=v();return(i,o,s,a)=>{if(G(i,o))return;const r=Vt(s),l=Vt(a);if(r&&l&&Pn(r,l)&&at(i,s,t,r)&&at(o,a,n,l)){const{azimuth:d}=Ut(xr,t,n,r);return d!=null?Qe(d,"degrees","radians"):void 0}e[0]=o[0]-i[0],e[1]=o[1]-i[1];let p=Qo(ns,e);return e[0]<0&&(p=kr-p),p}})();function Pr(e,t,n,i=D.Absolute){if(t&&n)switch(i){case D.Absolute:return ki(t,n);case D.Relative:return yn(Li(e,t,n),D.Relative);case D.RelativeBilateral:return yn(Li(e,t,n),D.RelativeBilateral)}}function Li(e,t,n){if(!e||!t||!n)return;const i=un(e,t),o=un(t,n);return i!=null&&o!=null?Ie(o-i,"radians","geographic"):void 0}function yn(e,t){if(e!=null)switch(t){case D.Absolute:return Ii(e);case D.Relative:{const n=je(e);let i=Di.normalize(n,0,!0);return i===-180&&(i=180),Ie(i,"degrees","geographic")}case D.RelativeBilateral:{const n=je(e),i=Math.abs(Di.normalize(n,0,!0));return Ie(i,"degrees","geographic")}}}function Ii(e){const t=je(e),n=Cr.normalize(t,0,!0);return Ie(n,"degrees","geographic")}const Rr=(()=>{const e=v();return(t,n,i,o,s,a="geodesic")=>{ot(e,n);const r=je(s);if(a==="geodesic"){const y=Vt(i);if(y&&at(e,i,e,y))return pt(t,e,r,o,y),t[2]=n[2],!!at(t,y,t,i)}const l=Nt(r,"geographic","arithmetic"),p=Qe(l,"degrees","radians"),d=n[0]+o*Math.cos(p),u=n[1]+o*Math.sin(p),f=n[2];return te(t,d,u,f),!0}})();function je(e){if(e!=null)return Nt(Ni(e),e.rotationType,"geographic")}function Ar(e){if(e!=null)return Nt(Ni(e),e.rotationType,"arithmetic")}function Ni(e){return Qe(e.value,e.unit,"degrees")}const xr=new Ft,kr=2*Math.PI,Cr=Zo,Di=new Bo(-180,180);let bt=class extends J{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],bt.prototype,"enabled",void 0),bt=c([C("esri.views.interactive.sketch.SketchLabelOptions")],bt);const wt=bt,Lr=Symbol("grid-placement-graphic");function gn(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function Ir(e,t){return Math.sqrt(gn(e,t))}function Hi(e,t){t.sort((n,i)=>Ht(n.targetPoint,e)-Ht(i.targetPoint,e))}var q;function Nr({point:e,distance:t,returnEdge:n,vertexMode:i,coordinateHelper:{spatialReference:o},filter:s},a,r){return r=r!=null?r.clone():new ls({where:"1=1"}),s&&(r.geometry=s.geometry,r.distance=s.distance,r.spatialRelationship=s.spatialRelationship,r.where=_o(r.where,s.where),r.timeExtent=ps(r.timeExtent,s.timeExtent),r.objectIds=Dr(r.objectIds,s.objectIds)),{point:Ne(e[0],e[1],e[2],o.toJSON()),mode:a,distance:t,returnEdge:n,vertexMode:i,query:r.toJSON()}}function Dr(e,t){return e||t?t?e?Array.from(Eo(new Set(e),new Set(t))):t:e:null}function Hr(e,t,n){return{left:Bt(e.leftVertex.pos,t,n),right:Bt(e.rightVertex.pos,t,n)}}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(q||(q={}));const Ui=Symbol("snapping-toggle");function Fi(e,t=()=>{}){const n=_e(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:i,snappingOptions:o})=>{if(e.removeHandles(Ui),!i||!o)return;const s=P.TOOL,a=[i.on("key-down",r=>{r.key!==ai.toggle||r.repeat||(o.enabledToggled=!0,t())},s),i.on("key-up",r=>{r.key===ai.toggle&&(o.enabledToggled=!1,t())},s),i.on("pointer-move",r=>{const l=r.native.ctrlKey;o.enabledToggled!==l&&(o.enabledToggled=l,t())},s)];e.addHandles(a,Ui)},Ce);e.addHandles(n)}function Ur(e){return Wo(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}let qe=class extends J{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],qe.prototype,"mode",void 0),qe=c([C("esri.views.interactive.sketch.SketchTooltipElevationOptions")],qe);let I=class extends J{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],I.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],I.prototype,"totalLength",void 0),I=c([C("esri.views.interactive.sketch.SketchTooltipVisibleElements")],I);const Vi=I;let H=class extends J{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new qe,this.placement="auto",this.offset=null,this.visibleElements=new Vi,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],H.prototype,"enabled",void 0),c([h()],H.prototype,"forceEnabled",void 0),c([h()],H.prototype,"effectiveEnabled",null),c([h()],H.prototype,"helpMessage",void 0),c([h()],H.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],H.prototype,"inputEnabled",void 0),c([h({type:qe,nonNullable:!0})],H.prototype,"elevation",void 0),c([h()],H.prototype,"placement",void 0),c([h()],H.prototype,"offset",void 0),c([h({type:Vi,nonNullable:!0})],H.prototype,"visibleElements",void 0),c([h()],H.prototype,"visualVariables",void 0),c([h()],H.prototype,"xyMode",void 0),H=c([C("esri.views.interactive.sketch.SketchTooltipOptions")],H);const fn=H;let Re=class extends J{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],Re.prototype,"length",void 0),c([h()],Re.prototype,"verticalLength",void 0),c([h()],Re.prototype,"area",void 0),Re=c([C("esri.views.interactive.sketch.Units")],Re);const Tt=Re;let fe=class extends J{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?D.RelativeBilateral:D.Relative;case"absolute":return D.Absolute}}get displayUnits(){return this._get("displayUnits")??new Tt}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new Tt}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],fe.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],fe.prototype,"relativeDirectionIsBilateral",void 0),c([h()],fe.prototype,"effectiveDirectionMode",null),c([h({type:Tt,nonNullable:!0})],fe.prototype,"displayUnits",null),c([h({type:Tt,nonNullable:!0})],fe.prototype,"inputUnits",null),fe=c([C("esri.views.interactive.sketch.SketchValueOptions")],fe);const St=fe;let ve=class extends J{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Ee}};c([h({constructOnly:!0})],ve.prototype,"layer",void 0),c([h()],ve.prototype,"enabled",void 0),c([h()],ve.prototype,"updating",void 0),c([h()],ve.prototype,"availability",void 0),c([h()],ve.prototype,"sublayerSources",void 0),ve=c([C("esri.views.interactive.snapping.FeatureSnappingLayerSource")],ve);const vn=ve;let A=class extends J{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new Ee,this.distance=He.distance,this.touchSensitivityMultiplier=He.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(ji)&&Rn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Vr),n=this._get("_effectiveFeatureSources")?.filter(ji)??new Ee;for(const r of t){const l=n.find(p=>p.layer===r.layer.parent);if(l)l.sublayerSources.includes(r)||l.sublayerSources.add(r);else if(r.layer.parent){const p=new vn({layer:r.layer.parent});p.sublayerSources.add(r),n.add(p)}}for(const r of n){const l=r.sublayerSources.filter(p=>!t.includes(p));r.sublayerSources.removeMany(l)}n.removeMany(n.filter(r=>r.sublayerSources.length===0));const i=e.filter(Fr),o=this._get("_effectiveFeatureSources")??new Ee,{added:s,removed:a}=bo(o.toArray(),[...i,...n]);return o.removeMany(a),o.addMany(s),o}};c([h()],A.prototype,"enabled",void 0),c([h()],A.prototype,"enabledToggled",void 0),c([h()],A.prototype,"forceDisabled",void 0),c([h()],A.prototype,"selfEnabled",void 0),c([h()],A.prototype,"featureEnabled",void 0),c([h()],A.prototype,"gridEnabled",void 0),c([h()],A.prototype,"attributeRulesEnabled",void 0),c([h({type:Ee.ofType(vn)})],A.prototype,"featureSources",void 0),c([h()],A.prototype,"distance",void 0),c([h()],A.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],A.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],A.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],A.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],A.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],A.prototype,"_effectiveFeatureSources",null),A=c([C("esri.views.interactive.snapping.SnappingOptions")],A);const Ot=A;function ji(e){return e.layer.type==="subtype-group"}function Fr(e){return e.layer.type!=="subtype-group"}function Vr(e){return e.layer.type==="subtype-sublayer"}function jr(e){return e?.type==="graphic"}function qi(e){return e.find(jr)??null}class Ae{constructor(t,n,i,o){this.targetPoint=t,this.constraint=n,this.isDraped=i,this.domain=o}}let mn=class extends Ae{constructor({targetPoint:e,objectId:t,constraint:n,isDraped:i}){super(e,n,i,x.FEATURE),this.objectId=t}},zi=class extends mn{constructor(e){super({...e,isDraped:!0,constraint:new Gi(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new K(q.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Yi=class extends mn{constructor(e){super({...e,constraint:new on(e.edgeStart,e.edgeEnd)})}get hints(){return[new K(q.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ze=class extends Ae{constructor(e,t,n,i){super(e,new Se(e),i,x.ALL),this.first=t,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new pi(this.targetPoint,this.isDraped,this.domain)]}},Zi=class extends Ae{constructor({lineStart:e,lineEnd:t,targetPoint:n,isDraped:i}){super(n,new Oi(e,t),i,x.SELF),this._referenceLineHint=new K(q.REFERENCE_EXTENSION,e,t,i,this.domain)}get hints(){return[this._referenceLineHint,new K(q.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Bi=class extends Ae{constructor({referenceLine:e,lineStart:t,targetPoint:n,isDraped:i}){const o=de(t),{left:s,right:a}=e;st(o,rs(o,o,a),s),super(n,new Oi(t,o),i,x.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new K(q.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new li(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new K(q.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(n=>{G(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),G(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),G(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),G(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},Wi=class extends Ae{constructor({targetPoint:e,constraint:t,previousVertex:n,otherVertex:i,otherVertexType:o,isDraped:s,selfSnappingType:a,objectId:r,domain:l}){super(e,t,s,l??x.SELF),this.previousVertex=n,this.otherVertex=i,this.otherVertexType=o,this.selfSnappingType=a??Ze.None,this.objectId=r??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===Ye.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===Ye.CENTER?this.targetPoint:this.otherVertex;return[new K(q.TARGET,t,n,this.isDraped,this.domain),new K(q.REFERENCE,e,t,this.isDraped,this.domain),new Kt(this.previousVertex,t,n,this.isDraped,this.domain)]}};var Ye,Ze;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(Ye||(Ye={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(Ze||(Ze={}));class Ki extends Ae{constructor({targetPoint:t,point1:n,point2:i,isDraped:o}){super(t,new sn(as(v(),n,i,.5),.5*es(n,i)),o,x.SELF),this._p1=n,this._p2=i}get hints(){return[new K(q.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new K(q.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Kt(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}function $i(e,t,n,i){return i.type==="2d"?(Gt.x=e[0],Gt.y=e[1],Gt.spatialReference=t,i.toScreen(Gt)):(oi(e,t,n,i,Xi),i.state.camera.projectToScreen(Xi,_n),wo(_n[0],_n[1]))}const Gt=Ne(0,0,0,null),Xi=v(),_n=To();let X=class extends kt.EventedMixin(J){constructor(e){super(e),this.options=new Ot,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ce.MAIN}initialize(){this.addHandles([_e(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:i,effectiveGridEnabled:o}=this.options;return{selfEnabled:n,featureEnabled:i,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=So(n=>this._updateEngines(e,t,n))},Ce),_e(()=>this.options,e=>{for(const t of this._engines)t.options=e},Oo)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const i=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!i.has("feature")?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!i.has("self")?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!i.has("grid")?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(const s of o)s.status==="fulfilled"&&s.value?.engine.destroy();else{for(const s of o)s.status==="fulfilled"&&s.value&&i.set(s.value.type,s.value.engine);this._engines=Array.from(i.values())}}async _createSelfSnappingEngine(e){const{SelfSnappingEngine:t}=await import("./SelfSnappingEngine-cGmuW4MT.js");return Ct(e),{type:"self",engine:new t({view:this.view,options:this.options})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:n}=await import("./GridSnappingEngine-DCXaqXz2.js");return Ct(e),{type:"grid",engine:new n({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await import("./FeatureSnappingEngine-aDZtmISS.js");Ct(e);const{view:n,options:i}=this,{spatialReference:o}=n;return{type:"feature",engine:new t({view:n,options:i,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return Yr(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:s}=n,a=It(o,s);if(a==null)return t;const{view:r}=this,{elevationInfo:l,visualizer:p}=n,d=[],u=Pe(a,r,l),f=i.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,f,n)||!bn(i,n.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=yt(f),d.push(...i.hints);for(const y of this._currentOtherActiveCandidates)bn(y,n.drawConstraints)&&(y.targetPoint=yt(f),d.push(...y.hints));return p!=null&&this.addHandles(p.draw(d,{spatialReference:s,elevationInfo:Zr(n),view:r,selfSnappingZ:n.selfSnappingZ}),En),Wt(f,r,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case ce.MAIN:return e;case ce.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ce.MAIN}_removeVisualization(){this.removeHandles(En)}async _snapSinglePoint({point:e,context:t,signal:n}){const{view:i}=this,{elevationInfo:o}=t,s=Pe(e,i,o),a=await this._fetchCandidates(s,x.ALL,t,n);return this._createSnapResult(s,ce.MAIN,a,i,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:i}){const{view:o}=this,{coordinateHelper:s,elevationInfo:a,spatialReference:r}=n;await Uo(t.spatialReference,r);const l=It(t,r),p=Pe(l,o,a),d=await this._fetchCandidates(p,x.FEATURE,n,i);if(d.length>0){const y=await this._fetchCandidates(p,x.SELF,n,i);return this._createSnapResult(p,ce.SCENE,[...d,...y],o,l,n,i)}const u=Pe(e,o,a),f=await this._fetchCandidates(u,x.SELF,n,i);return this._createSnapResult(u,ce.MAIN,f,o,{z:s.hasZ()&&e.hasZ?e.z??0:void 0,m:s.hasM()&&e.hasM?e.m??0:void 0},n,i)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,n,i)))).flat()}_createSnapResult(e,t,n,i,o,s,a){return{get valid(){return!Go(a)},apply:()=>{const{spatialReference:r}=s,{snappedPoint:l,hints:p}=this._processCandidates(e,t,n,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(p,{spatialReference:r,elevationInfo:ue,view:i,selfSnappingZ:s.selfSnappingZ}),En),Wt(l,i,o,s)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Hi(e,n);const o=this._currentMainCandidate;if(o!=null){const s=zr(o,n);if(s>=0){if(!(n[s]instanceof ze))return this._intersectWithOtherCandidates(s,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,i))return this._updateSnappingCandidate(o,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_intersectWithOtherCandidates(e,t,n,i,o){const{coordinateHelper:s}=o,a=t[e],r=[];for(let l=0;l<t.length;++l){if(l===e)continue;const p=t[l],d=a.constraint.intersect(p.constraint);if(d)for(const u of d.closestPoints(a.targetPoint))r.push([new ze(yt(u),a,p,p.isDraped),this._squaredScreenDistance(n,u,s)])}return r.length>0&&(r.sort((l,p)=>l[1]-p[1]),r[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(r[0][0],i,t,o):bn(a,o.drawConstraints)?this._updateSnappingCandidate(a,i,t,o):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const a of n){if(e instanceof ze){if(a.constraint.equals(e.first.constraint)||a.constraint.equals(e.second.constraint))continue}else if(a.constraint.equals(e.constraint))continue;const r=a.constraint.closestTo(o);this._squaredScreenDistance(r,o,i.coordinateHelper)<qr()&&(a.targetPoint=o,this._currentOtherActiveCandidates.push(a),s.push(...a.hints))}return{snappedPoint:o,hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return gn(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return $i(e,t.spatialReference,ue,this.view)}get test(){}};var ce;c([h({constructOnly:!0})],X.prototype,"view",void 0),c([h()],X.prototype,"options",void 0),c([h({readOnly:!0})],X.prototype,"updating",null),c([h()],X.prototype,"_loadTask",void 0),c([h()],X.prototype,"_engines",void 0),c([h()],X.prototype,"_squaredMouseProximityThreshold",null),c([h()],X.prototype,"_squaredTouchProximityThreshold",null),X=c([C("esri.views.interactive.snapping.SnappingManager")],X),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(ce||(ce={}));const En="visualization-handle";function qr(){return He.satisfiesConstraintScreenThreshold*He.satisfiesConstraintScreenThreshold}function bn(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof zi||e instanceof Yi||e instanceof Zi||e instanceof Bi||e instanceof Ki)&&(!(e instanceof Wi)||t.direction==null&&e.selfSnappingType===Ze.LastVertex)}function zr(e,t){return e instanceof ze?wn(t,e.first)>=0&&wn(t,e.second)>=0?0:-1:wn(t,e)}function wn(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}function Yr(e){return e.scenePoint!=null}function Zr({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?ue:t}let xe=class extends J{constructor(e){super(e),this.labels=new wt,this.tooltips=new fn,this.values=new St}};c([h({nonNullable:!0,type:wt})],xe.prototype,"labels",void 0),c([h({nonNullable:!0,type:fn})],xe.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:St})],xe.prototype,"values",void 0),xe=c([C("esri.views.interactive.sketch.SketchOptions")],xe);const Tn=xe;function Sn(e,t,n){if(!t||!e?.map)return;const{map:i}=e,o=i.layers.find(s=>s===t);o||i.add(t,n),o&&n!=null&&i.layers.reorder(o,n)}function Br(e,t){const n=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(i=>{const o=i.layer;return o===n||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(n)})}function Wr(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function Kr(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var On;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(On||(On={}));function Ji(e){switch(e){case b.SUPPORTED:break;case b.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case b.GEOMETRY_MISSING:return"no geometry";case b.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case b.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case b.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var b;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(b||(b={}));function Qi(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return b.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const n=e.elevationInfo;return ct(n)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function $r(e){return Xr(e).result}function Xr(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:b.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:b.GEOMETRY_MISSING};if(ct(e.elevationInfo))return{result:b.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,n=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:b.SUPPORTED,geometry:n}:{result:b.GEOMETRY_TYPE_UNSUPPORTED}}function Jr(e){if(e.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return b.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.SUPPORTED;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(n=>n.type==="object")?b.SYMBOL_TYPE_UNSUPPORTED:$n(e)!=="on-the-ground"&&ws(e)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}let k=class extends kt.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:Mo(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([h()],k.prototype,"activeComponent",void 0),c([h()],k.prototype,"cancelled",void 0),c([h()],k.prototype,"history",void 0),c([h()],k.prototype,"tool",null),c([h()],k.prototype,"type",void 0),c([h()],k.prototype,"canUndo",null),c([h()],k.prototype,"canRedo",null),c([h()],k.prototype,"onEnd",void 0),c([h()],k.prototype,"undo",null),c([h()],k.prototype,"redo",null),c([h()],k.prototype,"toggleTool",void 0),c([h()],k.prototype,"addToSelection",void 0),c([h()],k.prototype,"removeFromSelection",void 0),k=c([C("esri.widgets.Sketch.support.OperationHandle")],k);let Mt=class extends k{};c([h()],Mt.prototype,"activeComponent",void 0),Mt=c([C("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],Mt);let he=class extends k{};c([h()],he.prototype,"activeComponent",void 0),he=c([C("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],he);const eo={defaultZ:0},Be={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let m=class extends kt.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new Do,this._internalGraphicsLayer=new qo({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new An({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Po({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Ro({color:[130,130,130,1],width:2}),this.meshSymbol=new Ao({symbolLayers:new Ee([new xo])}),this.updateGraphics=new Ee,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new An({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Tn,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=eo,this.defaultUpdateOptions=Be,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new Ot}initialize(){this.addHandles([xn(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),xn(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),_e(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},Ce),_e(()=>this.view,e=>{this._defaultSnappingManager=nt(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new X({view:e,options:this.snappingOptions})),e.type==="2d"?import("./editingTools-KBOXuhog.js"):e.type==="3d"&&(import("./editingTools-CWx0-1A2.js").then(t=>t.e),import("./LineCallout.glsl-B1CPwb2z.js").then(t=>t.G)))},Ce),_e(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),Fi(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=nt(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,n=!t&&e&&"tooltip"in e?e.tooltip:null;return n?.visible?n:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...eo,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Be,...e,reshapeOptions:{...Be.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...Be.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=nt(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new X({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:i,map:o}=t;i&&(t.cursor=null),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const n="view-ready";this.removeHandles(n),e&&this.addHandles(ko(()=>e.ready,i=>{this.removeHandles(this._viewHandlesKey),i&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},Ce),n),this._set("view",e)}cancel(){this._moduleLoaderAbortController=Lt(this._moduleLoaderAbortController),this._viewReadyAbortController=Lt(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:n,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:n})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:n,layer:i}=this;if(!n||this.state==="disabled")throw i||this._logMissingLayer(),kn();if(n.activeTool!=null&&(n.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Sn(n,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void n.map.remove(this._internalGraphicsLayer);const s=()=>{if(o===this._operationHandle){const a=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||a==null||i.add(a),this._sketchContinuationFlag=!1,this.emit("create",{graphic:a,state:r?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),r||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(In(this.create(e,t)))}else l==="update"&&a&&this._updatingHandles.addPromise(In(this.update([a])))}};o.on("complete",s),this._operationHandle=o,n.ready&&n.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:n,view:i,state:o}=this;if(!i||o==="disabled")throw n||this._logMissingLayer(),kn();i.activeTool!=null&&(i.activeTool=null);const s=Array.isArray(e)?e:[e];if(e==null||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(r=>r.layer!==n?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):r.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const a=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||a==null||R(a)||(Sn(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const n of e)n.geometry==null||n.geometry.type==="mesh"||Pn(n.geometry.spatialReference,t.spatialReference)||(Fo(n.geometry.spatialReference,t.spatialReference)||Vo()||await jo(),n.geometry=It(n.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(a=>{a.type!=="vector-tile"&&a.type!=="imagery"||o.push(a)});const s=await t.hitTest(e,{exclude:o});return qi(s.results)}const n=[t.map.ground];t.map.allLayers.forEach(o=>{Co(o.type)&&n.push(o)});const i=await t.hitTest(e,{exclude:n});if(i.results.length>0){const o=i.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(o.distance??0)>-Math.min(3*i.ground.distance,t.viewingMode==="global"?Lo(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const n=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!n&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},P.WIDGET)]}async _handleImmediateClick(e){const t=await e.async(()=>this._getFirstHit(Nn(e)));let n=null;if(t!=null){const i=t.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(e.stopPropagation(),n=i):this.view?.type!=="2d"||this._isComponentGraphic(i)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();n==null||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const n=this.view;if(!n)return this._logMissingView(),null;const i={hasZ:n.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,n,i);return o==null?null:(n.tools.add(o),n.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,n){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:o,hasZ:s,geometryToPlace:a,graphicProperties:r,mode:l,preserveAspectRatio:p}=n,d=Wr(l,e),u=Kr(e),f=n?.optionsPerTool?.has(e)?n.optionsPerTool.get(e):{},y=f?.preserveAspectRatio??p??e!=="rectangle",g={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:i,defaultZ:o,forceUniformSize:y,graphicProperties:{...r,attributes:{...r?.attributes}},geometryToPlace:a,geometryType:u,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...f};return t.type==="2d"?this._makeDrawGraphicTool2D(g):this._makeDrawGraphicTool3D(g)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(import("./editingTools-KBOXuhog.js"));return R(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:ea(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(import("./editingTools-CWx0-1A2.js").then(i=>i.e));if(R(t)||this.destroyed)return null;const{elevationInfo:n}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:n,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let n=null;const i=e.forceUniformSize,o=e.centered,s=[t.on("key-down",r=>{if(r.key===M.pan)r.stopPropagation(),r.repeat||(e.enabled=!1);else if(r.key===M.complete)r.stopPropagation(),e.completeCreateOperation();else if(r.key!==M.vertexAdd||r.repeat)r.key===M.undo?(r.stopPropagation(),a.undo()):r.key===M.redo?(r.stopPropagation(),a.redo()):r.key!==M.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||r.repeat?r.key===M.center&&(r.repeat||(e.centered=!o,r.stopPropagation())):(e.forceUniformSize=!i,r.stopPropagation());else{const l=e.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(r.stopPropagation(),e.drawOperation.commitStagedVertex())}},P.WIDGET),t.on("key-up",r=>{r.key===M.pan?e.enabled=!0:r.key!==M.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?r.key===M.center&&(e.centered=o,r.stopPropagation()):(e.forceUniformSize=i,r.stopPropagation())},P.WIDGET),e.on("vertex-add",r=>{switch(n=n==null?"start":"active",r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:n,tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",r=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:r.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",r=>{switch(r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",r=>{this._set("createGraphic",r.graphic),n="complete",r.aborted?a&&a.cancel():a&&a.complete()}),_e(()=>this._getGraphicSymbolFromTool(e.geometryType),r=>{e.graphicSymbol=r})],a=new Mt({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{Q(s),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return a}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:n,view:i}=this;if(!i)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let s=o.tool??Be.tool;for(const a of e)n.remove(a),n.add(a);if(i.type==="3d"){if(e.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(e,o,i,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,i);case"transform":return this._setupGraphicTransform3DOperation(e,o,i)}}switch(s){case"move":return this._setupMove2DOperation(e,o,i);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,s,o,i);case"transform":if(e.length===1){const a=e[0].geometry?.type;a!=="point"&&a!=="multipoint"||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,o,i)}}async _setupMove3DOperation(e,t,n,i,o=!1){const s=await this._requireModule(import("./editingTools-CWx0-1A2.js").then(y=>y.e));if(R(s))return s;const{ManipulatedObject3DGraphic:a,MoveTool3D:r}=s.module,l=new Map,p=()=>{l.forEach(y=>y.destroy()),l.clear()};for(const y of e){const g=new a({view:n,graphic:y}),_=Qi(g);if(_!==b.SUPPORTED)return p(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Ji(_)}).`),null;l.set(y,g)}const d=new r({view:n,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(d),d.objects.addMany(Array.from(l.values())),o||this.updateGraphics.addMany(e);const u=[],f=new he({activeComponent:d,tool:i,type:"update",onEnd:()=>{Q(u),At(n,d),p()},undo:()=>{io(this.view,d),Pt(f,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{Rt(f,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:y=>{this.updateGraphics.push(y);const g=new a({view:n,graphic:y});l.set(y,g),d.objects.push(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{const g=this.updateGraphics.indexOf(y);if(f.history.undo.forEach(T=>T.updates.splice(g,1)),f.history.redo.forEach(T=>T.updates.splice(g,1)),this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void f.complete();const _=l.get(y);_&&(d.objects.remove(_),_.destroy(),l.delete(y))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||i!=="transform")return;const y=this.updateGraphics.at(0),g=await this._setupReshape3DOperation(y,t,n,!0);g&&!R(g)&&(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(g,t))}});return u.push(...this._getHandlesForComponent(f,t),n.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(f,y,t),P.WIDGET),n.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(f,y)},P.WIDGET)),f}_setupGraphicTransform3DOperation(e,t,n,i=!1){if(e.length===1&&Jr(e[0])===b.SUPPORTED){const o=e[0],s=o.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(o,t,n);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,n,i)}return this._setupMove3DOperation(e,t,n,"transform",i)}async _setupPointTransform3DOperation(e,t,n){const i="transform",{enableRotation:o,enableScaling:s,enableZ:a}=t,r=await this._requireModule(import("./editingTools-CWx0-1A2.js").then(g=>g.e));if(R(r))return r;const{TransformTool3D:l,ManipulatedObject3DGraphic:p}=r.module,d=new p({graphic:e,view:n}),u=new l({object:d,view:n,enableRotation:o,enableScaling:s,enableZ:a,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(u),this.updateGraphics.add(e);const f=[],y=new he({activeComponent:u,tool:i,type:"update",onEnd:()=>{Q(f),At(n,u),d.destroy()},undo:()=>{io(this.view,u),Pt(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{Rt(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const _=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);R(_)||this._setUpdateOperationHandle(_,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return f.push(...this._getHandlesForComponent(y,t),n.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,t),P.WIDGET),n.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},P.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,n,i=!1){const o="transform",{enableRotation:s,enableScaling:a,enableZ:r,preserveAspectRatio:l}=t,p=await this._requireModule(import("./editingTools-CWx0-1A2.js").then(E=>E.e));if(R(p))return p;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:u}=p.module,f=this.view?.inputManager?.isModifierKeyDown(M.constraint),y=new d({view:n,graphic:e}),g=new u({object:y,view:n,enableRotation:s,enableScaling:a,enableZ:r,preserveAspectRatio:!!l!=!!f,sketchOptions:this.sketchOptions});n.tools.add(g),i||this.updateGraphics.add(e);const _=[],T=new he({activeComponent:g,tool:o,type:"update",onEnd:()=>{Q(_),At(n,g),y.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async E=>{this.updateGraphics.add(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[E],removed:[],type:"selection-change"},type:"update"}),T.onEnd(),T.destroy();const ke=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);R(ke)||this._setUpdateOperationHandle(ke,t)},removeFromSelection:E=>{this.updateGraphics.remove(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[E],type:"selection-change"},type:"update"}),T.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const E=await this._setupReshape3DOperation(e,t,n,!0);E&&!R(E)&&(T.onEnd(),T.destroy(),this._setUpdateOperationHandle(E,t))}});return _.push(...this._getHandlesForComponent(T,t),n.on("immediate-click",E=>this._getCommonUpdateOperationClickHandlers(T,E,t),P.WIDGET),n.on("key-down",E=>this._getCommonUpdateOperationKeyDownHandlers(T,E),P.WIDGET),n.on("key-down",E=>{E.key!==M.constraint||E.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,E.stopPropagation())},P.WIDGET),n.on("key-up",E=>{E.key===M.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,E.stopPropagation())},P.WIDGET)),T}async _setupMove2DOperation(e,t,n){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,n);if(R(o))return o;const s=new he({activeComponent:o,tool:i,type:"update",onEnd:()=>{this._displayDefaultCursor(),Q(l),Q(r),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const p=this.updateGraphics.toArray();Pt(s,p),s.refreshComponent(),this._emitUndoEvent({graphics:p,tool:i})},redo:()=>{const p=this.updateGraphics.toArray();Rt(s,p),s.refreshComponent(),this._emitRedoEvent({graphics:p,tool:i})},addToSelection:async p=>{await this._updatingHandles.addPromise(this._updateSpatialReference(p)),this.updateGraphics.push(p),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:p=>{const d=this.updateGraphics.indexOf(p);s.history.undo.forEach(f=>f.updates.splice(d,1)),s.history.redo.forEach(f=>f.updates.splice(d,1)),this.updateGraphics.remove(p);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=u:s.complete()}});let a=!1;const r=[n.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(s,p,t),P.WIDGET),n.on("key-down",p=>{this._getCommonUpdateOperationKeyDownHandlers(s,p),p.key!==M.constraint||p.repeat||(a=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},P.WIDGET),n.on("key-up",p=>{p.key===M.constraint&&a&&(a=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},P.WIDGET)],l=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,n,i=!1){const o="reshape",s=await this._requireModule(import("./editingTools-CWx0-1A2.js").then(g=>g.e));if(R(s))return s;const{ManipulatedObject3DGraphic:a,ReshapeTool3D:r}=s.module,l=new a({view:n,graphic:e}),p=$r(l);if(p!==b.SUPPORTED)return l.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Ji(p)}).`),null;const d=t.reshapeOptions,u=new r({view:n,object:l,enableZVertex:t.enableZ&&d?.vertexOperation==="move",enableZShape:t.enableZ&&d?.shapeOperation==="move",enableMoveObject:d?.shapeOperation==="move"||d?.shapeOperation==="move-xy",enableMidpoints:d?.edgeOperation==="split",enableEdgeOffset:d?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(u),i||this.updateGraphics.add(l.graphic);const f=[],y=new he({activeComponent:u,tool:o,type:"update",onEnd:()=>{Q(f),At(n,u),l.destroy()},canUndo:()=>!u.destroyed&&u.canUndo,undo:()=>{u.destroyed||(u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!u.destroyed&&u.canRedo,redo:()=>{u.destroyed||(u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const _=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,"transform",!0);R(_)||this._setUpdateOperationHandle(_,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();const g=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,n,!0);R(g)||this._setUpdateOperationHandle(g,t)}});return f.push(...this._getHandlesForComponent(y,t),n.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,t),P.WIDGET),n.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},P.WIDGET)),y}async _setupTransformOrReshape2DOperation(e,t,n,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,n,i):await this._getReshape(e,n,i);if(R(o))return o;const s=new he({activeComponent:o,type:"update",onEnd:()=>{Q(r),Q(a),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Pt(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{Rt(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async l=>{let p=s.activeComponent;if(p?.type==="reshape"){const d=[...this.updateGraphics,l];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const u=await this._setupTransformOrReshape2DOperation(d,"transform",n,i);if(R(u))return;this._setUpdateOperationHandle(u,n)}else this.updateGraphics.add(l),p.graphics=this.updateGraphics.toArray(),p.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const p=this.updateGraphics.indexOf(l);s.history.undo.forEach(u=>u.updates.splice(p,1)),s.history.redo.forEach(u=>u.updates.splice(p,1)),this.updateGraphics.remove(l);const d=this.updateGraphics.toArray();if(d.length===0)s.complete();else{const u=d[0].geometry;d.length!==1||u==null||u.type!=="point"&&u.type!=="multipoint"?s.activeComponent.graphics=d:s.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),p=l.geometry;if(p!=null&&(s.tool==="reshape"&&(p.type==="point"||p.type==="multipoint")||s.tool==="transform"&&p.type==="extent"))return;let d=null;s.tool==="transform"?d=await this._getReshape([l],n,i):s.tool==="reshape"&&(d=await this._getBox([l],n,i)),R(d)||(s.activeComponent?.destroy(),s.activeComponent=d,s.activeComponent&&(Q(r),r=this._getHandlesForComponent(s,n)))}}),a=[i.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(s,l,n),P.WIDGET),i.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,l),l.key===M.constraint&&!l.repeat&&s){const p=s.activeComponent;p&&p.type==="box"&&(p.preserveAspectRatio=!p.preserveAspectRatio)}},P.WIDGET),i.on("key-up",l=>{if(l.key===M.constraint&&s){const p=s.activeComponent;p&&p.type==="box"&&(p.preserveAspectRatio=!p.preserveAspectRatio)}},P.WIDGET)];let r=this._getHandlesForComponent(s,n);return s}async _getGraphicMover(e,t,n){const{enableMoveAllGraphics:i,highlightOptions:o}=t,s=await this._requireModule(import("./GraphicMover-CiNX1V2i.js").then(a=>a.G));return R(s)?s:new s.module.default({enableMoveAllGraphics:i,highlightsEnabled:!!o?.enabled,indicatorsEnabled:!1,graphics:e,view:n,callbacks:{onGraphicMoveStart:({dx:a,dy:r,graphic:l})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:r,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:a,dy:r,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:r,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:a,dy:r,graphic:l})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:r,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,n){const{enableRotation:i,enableScaling:o,highlightOptions:s,preserveAspectRatio:a}=t,r=await this._requireModule(import("./Box-CcaqKOvu.js"));if(R(r))return r;const l=this.view?.inputManager?.isModifierKeyDown(M.constraint);return new r.module.default({graphics:e,enableRotation:i,enableScaling:o,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!a!=!!l,layer:this._internalGraphicsLayer,view:n,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMove:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMoveStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScale:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotate:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"})}})}async _getReshape(e,t,n){const i=t.reshapeOptions?.edgeOperation==="split",o=t.reshapeOptions?.shapeOperation==="move",s=!!t.highlightOptions?.enabled,a=await this._requireModule(import("./Reshape-BUYuf7aU.js"));return R(a)?a:new a.module.default({enableMidpoints:i,enableMovement:o,graphic:e[0],highlightsEnabled:s,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:n,callbacks:{onReshapeStart:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onReshape:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onReshapeStop:({mover:r,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r,type:l},type:"update"}),onMoveStart:({dx:r,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:p,type:d},type:"update"}),onMove:({dx:r,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:p,type:d},type:"update"}),onMoveStop:({dx:r,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:p,type:d},type:"update"}),onVertexAdd:({added:r,type:l,vertices:p})=>{const d=r.map(u=>Cn(u.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:d,vertices:p,type:l},type:"update"})},onVertexRemove:({removed:r,type:l,vertices:p})=>{const d=r.map(u=>Cn(u.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:d,vertices:p,type:l},type:"update"})}}})}_getHandlesForComponent(e,t){const n=e.activeComponent;if(!n)return[];switch(n.type){case"graphic-mover":return[n.on("graphic-click",({graphic:i,viewEvent:o})=>{o.native?.shiftKey&&(o.stopPropagation(),e.removeFromSelection(i))}),n.on("graphic-move-start",i=>e.addToHistory(me(i.allGraphics)))];case"box":return[n.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),n.on("move-start",i=>e.addToHistory(me(i.graphics))),n.on("rotate-start",i=>e.addToHistory(me(i.graphics))),n.on("scale-start",i=>e.addToHistory(me(i.graphics)))];case"reshape":return[n.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),n.on("move-start",i=>e.addToHistory(me([i.mover]))),n.on("reshape-start",i=>e.addToHistory(me([i.graphic]))),n.on("vertex-add",i=>e.addToHistory(me([i.oldGraphic]))),n.on("vertex-remove",i=>e.addToHistory(me([i.oldGraphic])))];case"move-3d":return[n.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),n.events.on("move-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-start"},type:"update"})}),n.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:i.dx,dy:i.dy,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move"},type:"update"})}),n.events.on("move-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.objects.length>0?i.objects[0].graphic:null,type:"move-stop"},type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[n.events.on("record-undo",({updates:i})=>{e.addToHistory({updates:i})}),n.events.on("translate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-start"},type:"update"})}),n.events.on("translate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-stop"},type:"update"})}),n.events.on("rotate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-start"},type:"update"})}),n.events.on("rotate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate-stop"},type:"update"})}),n.events.on("scale-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-start"},type:"update"})}),n.events.on("scale-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-stop"},type:"update"})}),n.events.on("translate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move"},type:"update"})}),n.events.on("rotate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,angle:i.angle,type:"rotate"},type:"update"})}),n.events.on("scale",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.object.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale"},type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[n.events.on("reshape",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),n.events.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...i,mover:i.object.graphic},type:"update"})}),n.events.on("vertex-add",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),n.events.on("vertex-remove",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),n.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,n){const{graphic:i,viewEvent:o}=n;return o.native?.shiftKey&&i.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const n=this.view?.map;this._disablePopup(t);const i=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),n&&n.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:s,toolEventInfo:null,type:"update"})}};e.on("complete",i)}async _getCommonUpdateOperationClickHandlers(e,t,n){const i=Nn(t),o=await t.async(()=>this._getFirstHit(i));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,n))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,n){const i=!!n.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!i||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const n=t.key;n===M.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):n===M.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):n===M.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&M.delete.includes(n)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,n=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||n.length===1&&n[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=nt(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,n){Rn.getLogger(this).error(new Io(e,t,n))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const n=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:n}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return Ln(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(Lt(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await No(Ln(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",to("view"))}_logMissingLayer(){this._logError(Qr,to("layer"))}};c([h()],m.prototype,"_defaultSnappingManager",void 0),c([h()],m.prototype,"updating",null),c([h({readOnly:!0})],m.prototype,"_updatingHandles",void 0),c([h()],m.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],m.prototype,"activeTool",null),c([h({readOnly:!0})],m.prototype,"activeCreateToolDrawMode",null),c([h()],m.prototype,"activeTooltip",null),c([h({types:Le})],m.prototype,"activeFillSymbol",void 0),c([h()],m.prototype,"activeLineSymbol",void 0),c([h()],m.prototype,"activeVertexSymbol",void 0),c([h()],m.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],m.prototype,"createGraphic",null),c([h()],m.prototype,"defaultCreateOptions",null),c([h()],m.prototype,"defaultUpdateOptions",null),c([h({type:wt,nonNullable:!0})],m.prototype,"labelOptions",null),c([h()],m.prototype,"layer",void 0),c([h({types:Le})],m.prototype,"pointSymbol",void 0),c([h({types:Le})],m.prototype,"polygonSymbol",void 0),c([h({types:Le})],m.prototype,"polylineSymbol",void 0),c([h()],m.prototype,"meshSymbol",void 0),c([h({type:Ot,nonNullable:!0})],m.prototype,"snappingOptions",null),c([h()],m.prototype,"snappingManager",null),c([h({readOnly:!0})],m.prototype,"state",null),c([h({type:fn,nonNullable:!0})],m.prototype,"tooltipOptions",null),c([h({readOnly:!0})],m.prototype,"updateGraphics",void 0),c([h()],m.prototype,"updateOnGraphicClick",void 0),c([h()],m.prototype,"creationMode",void 0),c([h({type:St,nonNullable:!0})],m.prototype,"valueOptions",null),c([h({types:Le})],m.prototype,"vertexSymbol",void 0),c([h({value:null})],m.prototype,"view",null),c([h({constructOnly:!0,type:Tn})],m.prototype,"sketchOptions",void 0),m=c([C("esri.widgets.Sketch.SketchViewModel")],m);const Qr="sketch:missing-property",to=e=>`Property '${e}' is missing on SketchViewModel.`;function ea(e){return e==="polygon"||e==="rectangle"||e==="circle"}function Pt(e,t){no("undo",e.history.undo,e.history.redo,t)}function Rt(e,t){no("redo",e.history.redo,e.history.undo,t)}function no(e,t,n,i){const o=t.pop();if(!o)return;const s=o.updates,a=[];i.forEach((r,l)=>{const p=s[l];p!=null&&("geometry"in p&&p.geometry!=null&&(a.push({geometry:r.geometry}),r.geometry=p.geometry),"symbol"in p&&p.symbol!=null&&(a.push({symbol:r.symbol}),r.symbol=p.symbol),"undo"in p&&(a.push(p),p[e](r)))}),n.push({updates:a})}function io(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function me(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function At(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function R(e){return"requireError"in e&&e.requireError==="aborted"}const ta=m;export{ti as $,Ir as A,ue as B,Br as C,M as D,Hi as E,qs as F,gn as G,Hr as H,Ci as I,Xt as J,O as K,Cs as L,Rr as M,Bt as N,Bi as O,Ze as P,Ls as Q,Ki as R,Ot as S,pi as T,K as U,li as V,Kt as W,Ii as X,yn as Y,D as Z,Xn as _,Ue as a,Pr as a0,dt as a1,je as a2,Us as a3,Ar as a4,Is as a5,Ss as a6,Pe as a7,Wt as a8,Mi as a9,Ys as aA,Bs as aB,q as aC,oi as aD,zt as aE,Wn as aF,Jn as aG,Qi as aH,b as aI,sn as aa,_t as ab,bi as ac,ki as ad,Pi as ae,wt as af,Kn as ag,B as ah,Fi as ai,ei as aj,vn as ak,St as al,On as am,qt as an,As as ao,Ms as ap,Rs as aq,Ps as ar,qi as as,Fs as at,Vs as au,bs as av,ht as aw,Ts as ax,Zs as ay,ni as az,ze as b,F as c,Lr as d,yt as e,Zt as f,zi as g,Yi as h,se as i,Se as j,Nr as k,ta as l,$n as m,mn as n,Tn as o,He as p,Sn as q,Zi as r,zs as s,Ur as t,x as u,Wi as v,Ye as w,rr as x,Gs as y,$i as z};
