{"version":3,"file":"OverlayContainer-Cg_0JxfW.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/OverlayShader.js","../../node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/overlay/OverlayTechnique.js","../../node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as t,a as o}from\"../../../../../../../chunks/tslib.es6.js\";import{location as e,uniform as r,GraphShaderModule as p,VertexInput as s,UniformGroup as i,FragmentOutput as n,input as d,FragmentInput as a}from\"../../GraphShaderModule.js\";import{Float as l,dot as v,Vec3 as c,Vec2 as y,Vec4 as u,texture2D as f,Mat3 as h,Sampler2D as m}from\"../../graph/glsl.js\";class x extends s{}t([e(0,y)],x.prototype,\"pos\",void 0),t([e(1,y)],x.prototype,\"uv\",void 0);class g extends a{}class w extends i{}t([r(h)],w.prototype,\"dvs\",void 0);class S extends i{}t([r(y)],S.prototype,\"perspective\",void 0),t([r(y)],S.prototype,\"texSize\",void 0),t([r(l)],S.prototype,\"wrapAroundShift\",void 0),t([r(l)],S.prototype,\"opacity\",void 0),t([r(m)],S.prototype,\"texture\",void 0);class j extends p{constructor(){super(...arguments),this.type=\"OverlayShader\"}vertex(t){const o=t.uv.divide(this.config.texSize),e=new l(1).add(v(o,this.config.perspective)),r=new c(t.pos.add(new y(this.config.wrapAroundShift,0)),1),p=this.transform.dvs.multiply(r);return{uv:o,glPosition:new u(p.xy.multiply(e),0,e)}}fragment(t){const o=f(this.config.texture,t.uv).multiply(this.config.opacity),e=new n;return e.fragColor=o,e}}t([r(w)],j.prototype,\"transform\",void 0),t([r(S)],j.prototype,\"config\",void 0),t([o(0,d(x))],j.prototype,\"vertex\",null),t([o(0,d(g))],j.prototype,\"fragment\",null);export{j as OverlayShader};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{destroyMaybe as e}from\"../../../../../../../core/maybe.js\";import{Mesh as t}from\"../../../meshing/Mesh.js\";import{simplePipelineState as s}from\"../../utils.js\";import{Technique as r}from\"../Technique.js\";import{TechniqueType as i}from\"../TechniqueType.js\";import{OverlayShader as o}from\"../shaders/OverlayShader.js\";import{CompareFunction as n,StencilOperation as a,DataType as h,PrimitiveType as p}from\"../../../../../../webgl/enums.js\";import{VertexElementDescriptor as u}from\"../../../../../../webgl/VertexElementDescriptor.js\";class m extends r{constructor(){super(...arguments),this.type=i.Overlay,this._mesh=null,this.shaders={overlay:new o}}render(e,t){const{context:r,painter:i}=e,o=this._getMesh(e,t);i.setPipelineState(s);const{isWrapAround:h,wrapAroundShift:p}=t.config,u={...t.config,wrapAroundShift:0},m={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:u},defines:null,optionalAttributes:null,useComputeBuffer:!1};i.setPipelineState({...s,stencil:{write:!1,test:{compare:n.EQUAL,op:{fail:a.KEEP,zFail:a.KEEP,zPass:a.REPLACE},ref:0,mask:255}}}),i.submitDrawMeshUntyped(r,m,o),h&&(u.wrapAroundShift=p,i.submitDrawMeshUntyped(r,m,o))}shutdown(){e(this._mesh)}_getMesh(e,s){const{context:r}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get(\"positions\");if(!e)throw new Error(\"Buffer not found\");e.buffer.setData(s.position)}else{const e=null!=s.index?s.index.length:s.position.length/2;this._mesh=new t(r,{vertex:{positions:{data:s.position,attributes:[new u(\"pos\",2,h.FLOAT,0,8)]},uvs:{data:s.tex,attributes:[new u(\"uv\",2,h.UNSIGNED_SHORT,0,4)]}},index:null!=s.index?{index:{data:s.index}}:void 0,groups:[{index:null!=s.index?\"index\":void 0,primitive:p.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}export{m as OverlayTechnique};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{toRadian as t}from\"../../../../core/libs/gl-matrix-2/math/common.js\";import{identity as e,multiply as r,translate as o,scale as i,rotate as s}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as a}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as l}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as c}from\"../../../../geometry/support/normalizeUtils.js\";import{getInfo as h}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getWorldWidth as m}from\"../../viewpointUtils.js\";import{WGLDrawPhase as d}from\"./enums.js\";import p from\"./WGLContainer.js\";import{OverlayTechnique as f}from\"./shaderGraph/techniques/overlay/OverlayTechnique.js\";class u extends p{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=a(),this._overlayTechnique=new f}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}doRender(t){if(t.drawPhase!==d.MAP||!this.visible)return;super.doRender(t);const e=this._overlayTechnique;for(const r of this.children)r.draw(t,e)}onDetach(){this._overlayTechnique.shutdown()}_updateMatrices(a){const{state:h}=a,{id:m,size:d,pixelRatio:p,resolution:f,rotation:u,viewpoint:v,displayMat3:_}=h;if(this._viewStateId===m)return;const M=t(u),g=p*d[0],y=p*d[1];this._localOrigin=v.targetGeometry.clone();const{x:w,y:x}=this._localOrigin,b=c(w,h.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const j=f*g,O=f*y,R=e(this._dvsMat3);r(R,R,_),o(R,R,n(g/2,y/2)),i(R,R,l(g/j,-y/O,1)),s(R,R,-M),this._viewStateId=m}_updateOverlays(e,r){const{state:o}=e,{rotation:i,spatialReference:s,worldScreenWidth:a,size:n,viewpoint:l}=o,c=this._localOrigin;let d,p=0;const f=h(s);if(f&&s.isWrappable){const e=n[0],r=n[1],c=t(i),h=Math.abs(Math.cos(c)),u=Math.abs(Math.sin(c)),v=Math.round(e*h+r*u),[_,M]=f.valid,g=m(s),{x:y,y:w}=l.targetGeometry,x=[y,w],b=[0,0];o.toScreen(b,x);const j=[0,0];let O;O=v>a?.5*a:.5*v;const R=Math.floor((y+.5*g)/g),q=_+R*g,S=M+R*g,G=[b[0]+O,0];o.toMap(j,G),j[0]>S&&(p=g),G[0]=b[0]-O,o.toMap(j,G),j[0]<q&&(p=-g),d={worldWidth:g,xBounds:[_,M]}}for(const t of r)t.updateDrawCoords(c,p,s,d)}}export{u as default};\n"],"names":["x","s","t","e","y","g","a","w","i","r","h","S","l","m","j","p","o","v","c","u","f","n","d","_","M","b","O","R","q","G"],"mappings":"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","x_google_ignoreList":[0,1,2]}