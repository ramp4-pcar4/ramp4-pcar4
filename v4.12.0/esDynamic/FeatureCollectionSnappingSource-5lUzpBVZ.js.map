{"version":3,"file":"FeatureCollectionSnappingSource-5lUzpBVZ.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/FeatureCollectionSnappingSource.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import{memoize as i}from\"../../../../core/memoize.js\";import{throwIfAborted as r,whenOrAbort as n}from\"../../../../core/promiseUtils.js\";import{watch as o,on as a,initial as s}from\"../../../../core/reactiveUtils.js\";import{sqlAnd as l}from\"../../../../core/sql.js\";import{property as p}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as y}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{elevationContextAffectsAlignment as c}from\"../../../../support/elevationInfoUtils.js\";import{makeSnappingQuery as u}from\"../snappingUtils.js\";import{convertSnappingCandidate as g,makeGetGroundElevation as h}from\"./queryEngineUtils.js\";import{getSnappingCandidateElevationAligner as m}from\"./snappingCandidateElevationAlignment.js\";import{getSnappingCandidateElevationFilter as d}from\"./snappingCandidateElevationFilter.js\";import{getSymbologySnappingCandidatesFetcher as v}from\"./symbologySnappingCandidates.js\";let f=class extends t{get availability(){return 1}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,i=null!=e&&\"3d\"===e.type;if(!i||\"subtype-group\"===t.type)return m();const r=async(i,r)=>(await n(e.whenLayerView(t),r)).elevationAlignPointsInFeatures(i,r);return m(i,{elevationInfo:t.elevationInfo,alignPointsInFeatures:r})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&\"3d\"===e.type&&\"subtype-group\"!==this.layerSource.layer.type;return d(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type?v(this._symbologySnappingSupported,(async(i,n)=>{const o=await e.whenLayerView(t);return r(n),o.queryForSymbologySnapping({candidates:i,spatialReference:e.spatialReference},n)})):v()}get _layerView(){const{view:e}=this;if(null==e)return null;const{layer:t}=this.layerSource;return e.allLayerViews.find((e=>e.layer===t))}get _layerView3D(){const{view:e}=this;return null==e||\"2d\"===e.type?null:this._layerView}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type&&this.addHandles([e.elevationProvider.on(\"elevation-change\",(({context:e})=>{const{elevationInfo:i}=t;c(e,i)&&this._snappingElevationAligner.notifyElevationSourceChange()})),o((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),s),o((()=>null!=this._layerView3D?this._layerView3D.layer?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),s),a((()=>this._layerView3D?.layer),[\"edits\",\"apply-edits\",\"graphic-update\"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=i(h)}refresh(){}async fetchCandidates(e,t){const{layer:i}=this.layerSource,n=i.source;if(!n?.querySnapping)return[];const o=i.createQuery();this._layerView&&\"effectiveDisplayFilter\"in this._layerView&&(o.where=l(o.where,this._layerView.effectiveDisplayFilter?.where));const a=u(e,this.view?.type??\"2d\",o),s=await n.querySnapping(a,{signal:t});r(t);const p=e.coordinateHelper.spatialReference,y=await this._snappingElevationAligner.alignCandidates(s.candidates,p,t);r(t);const c=await this._symbologySnappingFetcher.fetch(y,t);r(t);const h=0===c.length?y:[...y,...c],m=this._snappingElevationFilter.filter(a,h),d=this._memoizedMakeGetGroundElevation(this.view,p);return m.map((e=>g(e,d)))}};e([p({constructOnly:!0})],f.prototype,\"layerSource\",void 0),e([p({constructOnly:!0})],f.prototype,\"view\",void 0),e([p()],f.prototype,\"_snappingElevationAligner\",null),e([p()],f.prototype,\"_snappingElevationFilter\",null),e([p()],f.prototype,\"_symbologySnappingFetcher\",null),e([p()],f.prototype,\"_layerView\",null),e([p()],f.prototype,\"_layerView3D\",null),e([p()],f.prototype,\"_symbologySnappingSupported\",null),f=e([y(\"esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource\")],f);export{f as FeatureCollectionSnappingSource};\n"],"names":["f","t","i","m","r","n","d","v","o","e","c","s","a","h","l","u","p","g","y"],"mappings":";;;;;AAIkoC,IAACA,IAAE,cAAcC,EAAC;AAAA,EAAC,IAAI,eAAc;AAAC,WAAO;AAAA,EAAC;AAAA,EAAC,IAAI,4BAA2B;AAAC,UAAK,EAAC,MAAK,EAAC,IAAE,MAAK,EAAC,OAAM,EAAC,IAAE,KAAK,aAAYC,IAAQ,KAAN,QAAgB,EAAE,SAAT;AAAc,QAAG,CAACA,KAAqB,EAAE,SAApB,gBAAyB,QAAOC,EAAC;AAAG,UAAMC,IAAE,OAAMF,GAAEE,OAAK,MAAMC,EAAE,EAAE,cAAc,CAAC,GAAED,CAAC,GAAG,+BAA+BF,GAAEE,CAAC;AAAE,WAAOD,EAAED,GAAE,EAAC,eAAc,EAAE,eAAc,uBAAsBE,EAAC,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,2BAA0B;AAAC,UAAK,EAAC,MAAK,EAAC,IAAE,MAAK,IAAQ,KAAN,QAAgB,EAAE,SAAT,QAAiC,KAAK,YAAY,MAAM,SAAzC;AAA8C,WAAOE,EAAE,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,4BAA2B;AAAC,UAAK,EAAC,MAAK,EAAC,IAAE,MAAK,EAAC,OAAM,EAAC,IAAE,KAAK;AAAY,WAAa,KAAN,QAAgB,EAAE,SAAT,QAAiC,EAAE,SAApB,kBAAyBC,EAAE,KAAK,6BAA6B,OAAM,GAAEF,MAAI;AAAC,YAAMG,IAAE,MAAM,EAAE,cAAc,CAAC;AAAE,aAAOJ,EAAEC,CAAC,GAAEG,EAAE,0BAA0B,EAAC,YAAW,GAAE,kBAAiB,EAAE,iBAAgB,GAAEH,CAAC;AAAA,IAAC,CAAG,IAACE,EAAC;AAAA,EAAE;AAAA,EAAC,IAAI,aAAY;AAAC,UAAK,EAAC,MAAK,EAAC,IAAE;AAAK,QAAS,KAAN,KAAQ,QAAO;AAAK,UAAK,EAAC,OAAM,EAAC,IAAE,KAAK;AAAY,WAAO,EAAE,cAAc,KAAM,CAAAE,MAAGA,EAAE,UAAQ,CAAC;AAAA,EAAE;AAAA,EAAC,IAAI,eAAc;AAAC,UAAK,EAAC,MAAK,EAAC,IAAE;AAAK,WAAa,KAAN,QAAgB,EAAE,SAAT,OAAc,OAAK,KAAK;AAAA,EAAU;AAAA,EAAC,IAAI,8BAA6B;AAAC,WAAa,KAAK,gBAAX,QAAyB,KAAK,aAAa;AAAA,EAA0B;AAAA,EAAC,aAAY;AAAC,UAAK,EAAC,MAAK,EAAC,IAAE,MAAK,EAAC,OAAM,EAAC,IAAE,KAAK;AAAY,IAAM,KAAN,QAAgB,EAAE,SAAT,QAAiC,EAAE,SAApB,mBAA0B,KAAK,WAAW,CAAC,EAAE,kBAAkB,GAAG,oBAAoB,CAAC,EAAC,SAAQA,EAAC,MAAI;AAAC,YAAK,EAAC,eAAcP,EAAC,IAAE;AAAEQ,MAAAA,EAAED,GAAEP,CAAC,KAAG,KAAK,0BAA0B,4BAA6B;AAAA,IAAA,CAAG,GAACM,EAAG,MAAI,EAAE,eAAgB,MAAI,KAAK,0BAA0B,+BAA+BG,CAAC,GAAEH,EAAG,MAAU,KAAK,gBAAX,OAAwB,KAAK,aAAa,OAAO,WAAS,MAAO,MAAI,KAAK,0BAA0B,sBAAuB,GAAEG,CAAC,GAAEC,EAAG,MAAI,KAAK,cAAc,OAAO,CAAC,SAAQ,eAAc,gBAAgB,GAAG,MAAI,KAAK,0BAA0B,sBAAuB,CAAA,CAAE,CAAC;AAAA,EAAC;AAAA,EAAC,YAAY,GAAE;AAAC,UAAM,CAAC,GAAE,KAAK,OAAK,MAAK,KAAK,WAAS,IAAG,KAAK,kCAAgCV,EAAEW,CAAC;AAAA,EAAC;AAAA,EAAC,UAAS;AAAA,EAAA;AAAA,EAAE,MAAM,gBAAgB,GAAE,GAAE;AAAC,UAAK,EAAC,OAAM,EAAC,IAAE,KAAK,aAAYR,IAAE,EAAE;AAAO,QAAG,CAACA,GAAG,cAAc,QAAM,CAAE;AAAC,UAAMG,IAAE,EAAE,YAAW;AAAG,SAAK,cAAY,4BAA2B,KAAK,eAAaA,EAAE,QAAMM,EAAEN,EAAE,OAAM,KAAK,WAAW,wBAAwB,KAAK;AAAG,UAAMI,IAAEG,EAAE,GAAE,KAAK,MAAM,QAAM,MAAKP,CAAC,GAAEG,IAAE,MAAMN,EAAE,cAAcO,GAAE,EAAC,QAAO,EAAC,CAAC;AAAER,IAAAA,EAAE,CAAC;AAAE,UAAMY,IAAE,EAAE,iBAAiB,kBAAiB,IAAE,MAAM,KAAK,0BAA0B,gBAAgBL,EAAE,YAAWK,GAAE,CAAC;AAAEZ,IAAAA,EAAE,CAAC;AAAE,UAAMM,IAAE,MAAM,KAAK,0BAA0B,MAAM,GAAE,CAAC;AAAEN,IAAAA,EAAE,CAAC;AAAE,UAAMS,IAAMH,EAAE,WAAN,IAAa,IAAE,CAAC,GAAG,GAAE,GAAGA,CAAC,GAAEP,IAAE,KAAK,yBAAyB,OAAOS,GAAEC,CAAC,GAAEP,IAAE,KAAK,gCAAgC,KAAK,MAAKU,CAAC;AAAE,WAAOb,EAAE,IAAK,CAAAM,MAAGQ,EAAER,GAAEH,CAAC,CAAC;AAAA,EAAE;AAAC;AAAEG,EAAE,CAACO,EAAE,EAAC,eAAc,GAAE,CAAC,CAAC,GAAEhB,EAAE,WAAU,eAAc,MAAM,GAAES,EAAE,CAACO,EAAE,EAAC,eAAc,GAAE,CAAC,CAAC,GAAEhB,EAAE,WAAU,QAAO,MAAM,GAAES,EAAE,CAACO,EAAC,CAAE,GAAEhB,EAAE,WAAU,6BAA4B,IAAI,GAAES,EAAE,CAACO,EAAC,CAAE,GAAEhB,EAAE,WAAU,4BAA2B,IAAI,GAAES,EAAE,CAACO,EAAC,CAAE,GAAEhB,EAAE,WAAU,6BAA4B,IAAI,GAAES,EAAE,CAACO,GAAG,GAAEhB,EAAE,WAAU,cAAa,IAAI,GAAES,EAAE,CAACO,EAAC,CAAE,GAAEhB,EAAE,WAAU,gBAAe,IAAI,GAAES,EAAE,CAACO,EAAG,CAAA,GAAEhB,EAAE,WAAU,+BAA8B,IAAI,GAAEA,IAAES,EAAE,CAACS,EAAE,gFAAgF,CAAC,GAAElB,CAAC;","x_google_ignoreList":[0]}