{"version":3,"file":"SceneLayerWorker-DUp3Wg-u.js","sources":["../../node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js","../../node_modules/@arcgis/core/libs/i3s/enums.js","../../node_modules/@arcgis/core/libs/i3s/I3SModule.js","../../node_modules/@arcgis/core/views/3d/layers/I3SMeshWorkerHandle.js","../../node_modules/@arcgis/core/views/3d/layers/i3s/I3SNode.js","../../node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from\"../../../../request.js\";import{binaryIndexOf as t,splitIntoChunks as r}from\"../../../../core/arrayUtils.js\";import o from\"../../../../core/Error.js\";import has from\"../../../../core/has.js\";import{isInt16Array as n,isInt32Array as s}from\"../../../../core/typedArrayUtil.js\";import{invert as a}from\"../../../../core/libs/gl-matrix-2/math/mat4.js\";import{create as i}from\"../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{i as l,t as c,c as u}from\"../../../../chunks/vec32.js\";import{create as f}from\"../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{canProjectWithoutEngine as p}from\"../../../../geometry/projection.js\";import m from\"../../../../geometry/SpatialReference.js\";import{projectVectorToVector as d}from\"../../../../geometry/projection/projectVectorToVector.js\";import{create as y,empty as h,expandPointInPlace as g,intersects as S}from\"../../../../geometry/support/aaBoundingRect.js\";import{a as b}from\"../../../../chunks/sphere.js\";import w from\"../../../../rest/support/Query.js\";import{readBinaryAttribute as I}from\"./I3SBinaryReader.js\";import{computeGlobalTransformation as T}from\"./I3SProjectionUtil.js\";import{createSolidEdgeMaterial as E,createMaterialFromEdges as R}from\"../support/edgeUtils.js\";import{parseColorMixMode as x,ColorMixModeEnum as v}from\"../support/symbolColorUtils.js\";import{Obb as M,compute as j}from\"../../support/orientedBoundingBox.js\";import{spatialReferenceIncompatibleError as C}from\"../../../support/layerViewUtils.js\";function U(e){return e?parseInt(e.slice(e.lastIndexOf(\"/\")+1),10):void 0}function k(e){if(has(\"disable-feature:i3s-draco\")||!e)return!1;for(const t of e)for(const e of t.geometryBuffers)if(\"draco\"===e.compressedAttributes?.encoding)return!0;return!1}function N(e,t,r,o){r.traverse(t,(t=>{const r=t.serviceMbsInIndexSR;return(null!=r&&F(e,r))!==q.OUTSIDE&&(o(t),!0)}))}function D(e,t,r){let o=0,n=0;for(let s=0;s<t.length&&o<e.length;s++)e[o]===t[s]&&(r(s)&&(e[n]=e[o],n++),o++);e.length=n}function W(e,r,o){let n=0,s=0;for(;n<o.length;){t(e,o[n])>=0===r&&(o[s]=o[n],s++),n++}o.length=s}function _(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return O[0]=(e[0]-t.position[0])/t.rotationScale[0],O[1]=(e[1]-t.position[1])/t.rotationScale[4],O[2]=(e[2]-t.position[0])/t.rotationScale[0],O[3]=(e[3]-t.position[1])/t.rotationScale[4],O}const O=y();var q;function F(e,t){const r=t[0],o=t[1],n=t[3],s=e[0]-r,a=r-e[2],i=e[1]-o,l=o-e[3],c=Math.max(s,a,0),u=Math.max(i,l,0),f=c*c+u*u;if(f>n*n)return q.OUTSIDE;if(f>0)return q.INTERSECTS_CENTER_OUTSIDE;return-Math.max(s,a,i,l)>n?q.INSIDE:q.INTERSECTS_CENTER_INSIDE}function L(e,t,r){const o=[],n=r?.missingFields,s=r?.originalFields;for(const a of e){const e=a.toLowerCase();let r=!1;for(const n of t)if(e===n.name.toLowerCase()){o.push(n.name),r=!0,s&&s.push(a);break}!r&&n&&n.push(a)}return o}async function A(e,t,r,n,s,a){if(0===t.length)return[];const i=e.attributeStorageInfo;if(null!=e.associatedLayer)try{return await P(e.associatedLayer,t,r,n,a)}catch(l){if(e.associatedLayer.loaded)throw l}if(i){const l=K(t,r,s);if(null==l)throw new o(\"scenelayer:features-not-loaded\",\"Tried to query attributes for unloaded features\");const c=e.parsedUrl.path;return(await Promise.all(l.map((t=>G(c,i,t.node,t.indices,n,e.apiKey,e.customParameters,a).then((e=>{for(let r=0;r<t.graphics.length;r++){const o=t.graphics[r],n=e[r];if(o.attributes)for(const e in o.attributes)e in n||(n[e]=o.attributes[e]);o.attributes=n}return t.graphics})))))).flat()}throw new o(\"scenelayer:no-attribute-source\",\"This scene layer does not have a source for attributes available\")}function K(e,t,r){const o=new Map,n=[],s=r();for(const a of e){const e=a.attributes[t];for(let t=0;t<s.length;t++){const r=s[t],i=r.featureIds.indexOf(e);if(i>=0){let e=o.get(r.node);e||(e={node:r.node,indices:[],graphics:[]},n.push(e),o.set(r.node,e)),e.indices.push(i),e.graphics.push(a);for(let r=t;r>0;r--)s[r]=s[r-1];s[0]=r;break}}}return n}async function P(e,t,r,o,n){t.sort(((e,t)=>e.attributes[r]-t.attributes[r]));const s=t.map((e=>e.attributes[r])),a=[],i=L(o,e.fields,{originalFields:a}),l=await B(e,s,i,n);for(let c=0;c<t.length;c++){const e=t[c],r=l[c],o={};if(e.attributes)for(const t in e.attributes)o[t]=e.attributes[t];for(let t=0;t<a.length;t++)o[a[t]]=r[i[t]];e.attributes=o}return t}function B(e,t,n,s){const a=e.capabilities.query.maxRecordCount;if(null!=a&&t.length>a){const o=r(t,a);return Promise.all(o.map((t=>B(e,t,n,s)))).then((e=>e.flat()))}const i=new w({objectIds:t,outFields:n,orderByFields:[e.objectIdField]});return e.queryFeatures(i,s).then((e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map((e=>e.attributes));throw new o(\"scenelayer:feature-not-in-associated-layer\",\"Feature not found in associated feature layer\")}))}function G(e,t,r,o,n,s,a,i){return V(e,t,r.resources.attributes,o,n,s,a,i)}async function V(t,r,o,n,s,a,i,l){const c=[];for(const e of r)if(e&&s.includes(e.name)){const r=`${t}/nodes/${o}/attributes/${e.key}/0`;c.push({url:r,storageInfo:e})}const u=await Promise.allSettled(c.map((t=>e(t.url,{responseType:\"array-buffer\",query:{...i,token:a},signal:l?.signal}).then((e=>I(t.storageInfo,e.data)))))),f=[];for(const e of n){const t={};for(let r=0;r<u.length;r++){const o=u[r];if(\"fulfilled\"===o.status){const n=o.value;t[c[r].storageInfo.name]=Q(n,e)}}f.push(t)}return f}!function(e){e[e.OUTSIDE=0]=\"OUTSIDE\",e[e.INTERSECTS_CENTER_OUTSIDE=1]=\"INTERSECTS_CENTER_OUTSIDE\",e[e.INTERSECTS_CENTER_INSIDE=2]=\"INTERSECTS_CENTER_INSIDE\",e[e.INSIDE=3]=\"INSIDE\"}(q||(q={}));const $=-32768,z=-2147483648;function Q(e,t){if(!e)return null;const r=e[t];if(n(e))return r===$?null:r;if(s(e))return r===z?null:r;return r!=r?null:r}function Z(e){const t=e.store,r=t.indexCRS||t.geographicCRS,n=void 0===r?t.indexWKT:void 0;if(n){if(!e.spatialReference)throw new o(\"layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference\",\"Found indexWKT in the scene layer store but no layer spatial reference\",{});if(n!==e.spatialReference.wkt)throw new o(\"layerview:store-spatial-reference-wkt-index-incompatible\",\"The indexWKT of the scene layer store does not match the WKT of the layer spatial reference\",{})}const s=r?new m(U(r)):e.spatialReference;return s.equals(e.spatialReference)?e.spatialReference:s}function H(e){const t=e.store,r=t.vertexCRS||t.projectedCRS,n=void 0===r?t.vertexWKT:void 0;if(n){if(!e.spatialReference)throw new o(\"layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference\",\"Found vertexWKT in the scene layer store but no layer spatial reference\",{});if(n!==e.spatialReference.wkt)throw new o(\"layerview:store-spatial-reference-wkt-vertex-incompatible\",\"The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference\",{})}const s=r?new m(U(r)):e.spatialReference;return s.equals(e.spatialReference)?e.spatialReference:s}function J(e,t,r){if(!p(e,t))throw C(\"scene layer\",e?.wkid,t?.wkid);if(\"local\"===r&&!Y(e,t))throw C(\"scene layer\",e?.wkid,t?.wkid)}function X(e,t,r){if(e.serviceUpdateTimeStamp?.lastUpdate!==t.serviceUpdateTimeStamp?.lastUpdate||!r.isEmpty||e.associatedLayer?.url!==t.associatedLayer?.url)throw new o(\"layerview:recycle-failed\")}function Y(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function ee(e,t,r){const o=Z(e),n=H(e);J(o,t,r),J(n,t,r)}function te(e){return(null==e.geometryType||\"triangles\"===e.geometryType)&&((null==e.topology||\"PerAttributeArray\"===e.topology)&&null!=e.vertexAttributes?.position)}function re(e){if(null==e.store?.defaultGeometrySchema||!te(e.store.defaultGeometrySchema))throw new o(\"scenelayer:unsupported-geometry-schema\",\"The geometry schema of this scene layer is not supported.\",{url:e.parsedUrl.path})}function oe(e,t){ee(e,t.spatialReference,t.viewingMode)}function ne(e){return null!=e.geometryType&&\"points\"===e.geometryType&&((null==e.topology||\"PerAttributeArray\"===e.topology)&&((null==e.encoding||\"\"===e.encoding||\"lepcc-xyz\"===e.encoding)&&null!=e.vertexAttributes?.position))}function se(e){if(null==e.store?.defaultGeometrySchema||!ne(e.store.defaultGeometrySchema))throw new o(\"pointcloud:unsupported-geometry-schema\",\"The geometry schema of this point cloud scene layer is not supported.\",{})}function ae(e,t){J(e.spatialReference,t.spatialReference,t.viewingMode)}function ie(e){return\"simple\"===e.type||\"class-breaks\"===e.type||\"unique-value\"===e.type}function le(e){return\"mesh-3d\"===e.type}function ce(e){if(null==e||!ie(e))return!0;if((\"unique-value\"===e.type||\"class-breaks\"===e.type)&&null==e.defaultSymbol)return!0;const t=e.symbols;if(0===t.length)return!0;for(const r of t){if(!le(r)||0===r.symbolLayers.length)return!0;for(const e of r.symbolLayers.items)if(\"fill\"!==e.type||null==e.material?.color||\"replace\"!==e.material.colorMixMode)return!0}return!1}const ue=E({color:[0,0,0,0],opacity:0});class fe{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function pe(e){const t=new fe;let r=!1,o=!1;for(const n of e.symbolLayers.items)if(\"fill\"===n.type&&n.enabled){const e=n.material,s=n.edges;if(null!=e&&!r){const o=e.color,s=x(e.colorMixMode);t.material=null!=o?{color:[o.r/255,o.g/255,o.b/255],alpha:o.a,colorMixMode:s}:{color:[1,1,1],alpha:1,colorMixMode:v.Multiply},t.castShadows=n.castShadows,r=!0}null==s||o||(t.edgeMaterial=R(s,{}),o=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:v.Multiply}),t}function me(e,t){return(0|e)+(0|t)|0}function de(e,t,r,o,n,s,i){if(!s||0===s.length||null==t||!e.serviceMbsInIndexSR)return null;const f=T(e.serviceMbsInIndexSR,n,\"none\",r,t);a(Ee,f);let p=null;const m=()=>{if(!p)if(p=ge,h(be),null!=e.serviceObbInIndexSR){e.serviceObbInIndexSR.transform(we,r,t,n,i),we.getCorners(p);for(const e of p)c(e,e,Ee),g(be,e)}else{const o=e.serviceMbsInIndexSR;if(!o)return;const s=o[3];d(b(o),r,Ie,t),c(Ie,Ie,Ee),Ie[2]+=n;for(let e=0;e<8;++e){const t=1&e?s:-s,r=2&e?s:-s,o=4&e?s:-s,n=p[e];u(n,[Ie[0]+t,Ie[1]+r,Ie[2]+o]),g(be,n)}}};let y=1/0,w=-1/0;const I=e=>{if(\"replace\"!==e.type)return;const r=e.geometry;if(!r?.hasZ)return;h(Se);const n=r.spatialReference||o,s=r.rings.reduce(((e,r)=>r.reduce(((e,r)=>(l(Ie,r[0],r[1],r[2]),d(Ie,n,Ie,t),c(Ie,Ie,Ee),g(Se,Ie),Math.min(Ie[2],e))),e)),1/0);m(),S(be,Se)&&(y=Math.min(y,s),w=Math.max(w,s))};if(s.forEach((e=>I(e))),y===1/0)return null;const E=(e,t,r)=>{c(Ie,r,f),e[t]=Ie[0],e[t+1]=Ie[1],e[t+2]=Ie[2],t+=24,r[2]=y,c(Ie,r,f),e[t]=Ie[0],e[t+1]=Ie[1],e[t+2]=Ie[2],t+=24,r[2]=w,c(Ie,r,f),e[t]=Ie[0],e[t+1]=Ie[1],e[t+2]=Ie[2]};for(let a=0;a<8;++a)E(Te.data,3*a,p[a]);return j(Te)}function ye(e){return e[3]>=0}function he(e){null!=e&&(e[3]=-1)}const ge=[f(),f(),f(),f(),f(),f(),f(),f()],Se=y(),be=y(),we=new M,Ie=f(),Te={data:new Array(72),size:3,exclusive:!0,stride:3},Ee=i();export{q as MbsIntersectResult,fe as SymbolInfo,me as addWraparound,ae as checkPointCloudLayerCompatibleWithView,se as checkPointCloudLayerValid,X as checkRecyclable,oe as checkSceneLayerCompatibleWithView,re as checkSceneLayerValid,J as checkSpatialReference,ee as checkSpatialReferences,de as computeVisibilityObb,k as containsDraco,U as extractWkid,D as filterInPlace,L as findFieldsCaseInsensitive,N as findIntersectingNodes,Q as getCachedAttributeValue,_ as getClipRect,Z as getIndexCrs,pe as getSymbolInfo,H as getVertexCrs,F as intersectBoundingRectWithMbs,he as invalidateMbs,Y as isSupportedLocalModeProjection,ye as isValidMbs,W as objectIdFilter,V as queryAttributesFromCachedAttributesId,ce as rendererNeedsTextures,ue as transparentEdgeMaterial,A as whenGraphicAttributes};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nvar n,e;!function(n){n[n.None=0]=\"None\",n[n.Int16=1]=\"Int16\",n[n.Int32=2]=\"Int32\"}(n||(n={})),function(n){n[n.Replace=0]=\"Replace\",n[n.Outside=1]=\"Outside\",n[n.Inside=2]=\"Inside\",n[n.Finished=3]=\"Finished\"}(e||(e={}));export{n as IndexType,e as ModificationType};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return n||(n=new Promise((t=>import(\"../../chunks/i3s.js\").then((t=>t.i)).then((({default:e})=>{const n=e({locateFile:i,onRuntimeInitialized:()=>t(n)});delete n.then})))).catch((t=>{throw t}))),n}function i(e){return t(`esri/libs/i3s/${e}`)}let n;export{e as get};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport s from\"../../../core/Logger.js\";import e from\"../../../core/PooledArray.js\";import{create as t}from\"../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{WorkerHandle as o}from\"../../../core/workers/WorkerHandle.js\";import{canProjectWithoutEngine as r}from\"../../../geometry/projection.js\";import{projectVectorToVector as i}from\"../../../geometry/projection/projectVectorToVector.js\";import{ModificationType as h}from\"../../../libs/i3s/enums.js\";class n{constructor(s,e,t,o,r,i){this.layout=s,this.interleavedVertexData=e,this.indices=t,this.hasColors=o,this.hasModifications=r,this.positionData=i}}class p{constructor(s,e,t,o,r,i,h){this.componentOffsets=s,this.featureIds=e,this.anchorIds=t,this.anchors=o,this.transformedGeometry=r,this.globalTrafo=i,this.obb=h}}class a extends o{constructor(s){super(\"SceneLayerWorker\",\"process\",{process:s=>[s.geometryBuffer],project:s=>[s.positions.buffer],transformNormals:s=>[s.normals.buffer]},s,{hasInitialize:!0})}setModifications(s,e,t,o){const r={context:s,modifications:f(e,t,o),isGeodetic:o.isGeographic};this.broadcast(r,\"setModifications\")}setLegacySchema(s,e){const t=JSON.stringify(e);return this.broadcast({context:s,jsonSchema:t},\"setLegacySchema\")}destroyContext(s){return this.broadcast(s,\"destroyContext\")}project(s,e){return this.invokeMethod(\"project\",s,e)}transformNormals(s,e){return this.invokeMethod(\"transformNormals\",s,e)}}const u=new e({deallocator:null}),c=t();function f(e,t,o){u.clear();let n=1/0,p=1/0,a=-1/0,f=-1/0,l=!1;for(const d of t){const e=\"clip\"===d.type?h.Inside:\"mask\"===d.type?h.Outside:h.Replace,t=d.geometry;let m=s=>s;if(t.spatialReference){if(!r(t.spatialReference,o)){s.getLogger(\"esri.views.3d.layers.I3SMeshWorkerHandle\").warn(\"Can't project modification polygon into layer spatial reference, ignoring modification\");continue}m=s=>(i(s,t.spatialReference,c,o),c)}else t.hasZ||(c[2]=0,m=s=>(c[0]=s[0],c[1]=s[1],c));l=l||e===h.Outside,u.push(e),u.push(t.rings.length);for(const s of t.rings){u.push(s.length);for(const e of s){const s=m(e);u.push(s[0]),u.push(s[1]),u.push(s[2]),n=Math.min(n,s[0]),p=Math.min(p,s[1]),a=Math.max(a,s[0]),f=Math.max(f,s[1])}}}if(null!=e)if(l){const s=1e-4;u.push(h.Inside),u.push(2),u.push(4),u.push(n-s),u.push(p-s),u.push(0),u.push(a+s),u.push(p-s),u.push(0),u.push(a+s),u.push(f+s),u.push(0),u.push(n-s),u.push(f+s),u.push(0),u.push(4),u.push(e[0]),u.push(e[1]),u.push(0),u.push(e[2]),u.push(e[1]),u.push(0),u.push(e[2]),u.push(e[3]),u.push(0),u.push(e[0]),u.push(e[3]),u.push(0)}else u.push(h.Outside),u.push(1),u.push(4),u.push(e[0]),u.push(e[1]),u.push(0),u.push(e[2]),u.push(e[1]),u.push(0),u.push(e[2]),u.push(e[3]),u.push(0),u.push(e[0]),u.push(e[3]),u.push(0);u.push(h.Finished);const m=new Float64Array(u.length);for(let s=0;s<u.length;++s)m[s]=u.at(s);return m}export{a as I3SMeshWorkerHandle,p as TransformedData,n as TransformedGeometry,f as toWasmModification};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{fromValues as e}from\"../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{f as i}from\"../../../../chunks/sphere.js\";import{invalidateMbs as n}from\"./I3SUtil.js\";import{ElevationRange as t}from\"../../support/ElevationRange.js\";class s extends t{constructor(e,n){super(NaN,NaN),this.id=e,this.serviceMbsInIndexSR=n,this.serviceMbsInRenderSR=i(0,0,0,-1)}invalidateServiceBVsInRenderSR(){n(this.serviceMbsInRenderSR),this.serviceObbInRenderSR?.invalidate()}shareServiceBVsInRenderSRWith(e){this.serviceObbInRenderSR=e.serviceObbInRenderSR,this.serviceMbsInRenderSR=e.serviceMbsInRenderSR}}var o,r,a,d,c;!function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.Culled=1]=\"Culled\",e[e.NotChecked=2]=\"NotChecked\"}(o||(o={})),function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.PotentiallyModified=1]=\"PotentiallyModified\",e[e.Culled=2]=\"Culled\",e[e.Unknown=3]=\"Unknown\",e[e.NotChecked=4]=\"NotChecked\"}(r||(r={}));class h extends s{constructor(i,n,t,s,o,d,c,h,l,u){super(i,t),this.index=n,this.childCount=s,this.level=o,this.resources=d,this.version=c,this.lodMetric=h,this.maxError=l,this.numFeatures=u,this.failed=!1,this.cacheState=a.Unknown,this.vertexCount=0,this.memory=0,this.childrenLoaded=0,this.hasModifications=!1,this.imModificationImpact=r.NotChecked,this.elevationAgnosticBoundingVolume=e(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR(),this.elevationAgnosticBoundingVolume[3]=-1}}!function(e){e[e.Unknown=0]=\"Unknown\",e[e.Uncached=1]=\"Uncached\",e[e.Cached=2]=\"Cached\"}(a||(a={})),function(e){e[e.None=0]=\"None\",e[e.MaxScreenThreshold=1]=\"MaxScreenThreshold\",e[e.ScreenSpaceRelative=2]=\"ScreenSpaceRelative\",e[e.RemovedFeatureDiameter=3]=\"RemovedFeatureDiameter\",e[e.DistanceRangeFromDefaultCamera=4]=\"DistanceRangeFromDefaultCamera\"}(d||(d={})),function(e){e[e.Hole=0]=\"Hole\",e[e.Leaf=1]=\"Leaf\"}(c||(c={}));class l{constructor(e,i,n,t){this.nodeHasLOD=e,this.isChosen=i,this.lodLevel=n,this.version=t}}export{a as CacheState,d as LodMetric,h as Node,s as NodeBase,o as NodeFilterImpact,r as NodeIMModificationImpact,c as NodeState,l as NodeTraversalState};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{hasScaling as e}from\"../../../core/mathUtils.js\";import r from\"../../../geometry/SpatialReference.js\";import t from\"../../../geometry/support/MeshGeoreferencedVertexSpace.js\";import o from\"../../../geometry/support/MeshLocalVertexSpace.js\";import{b as n,n as s}from\"../../../chunks/vec3.js\";import{IndexType as i}from\"../../../libs/i3s/enums.js\";import{get as a}from\"../../../libs/i3s/I3SModule.js\";import{TransformedGeometry as f,TransformedData as c}from\"./I3SMeshWorkerHandle.js\";import{NodeIMModificationImpact as l}from\"./i3s/I3SNode.js\";async function u(e){E=await M();const r=[e.geometryBuffer];return{result:A(E,e,r),transferList:r}}async function m(e){E=await M();const r=[e.geometryBuffer],{geometryBuffer:t}=e,o=t.byteLength,n=E._malloc(o),s=new Uint8Array(E.HEAPU8.buffer,n,o);s.set(new Uint8Array(t));const i=E.dracoDecompressPointCloudData(n,s.byteLength);if(E._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,f=i.positions.slice();return a&&r.push(a.buffer),r.push(f.buffer),{result:{positions:f,featureIds:a},transferList:r}}async function y(e){await M(),S(e);const r={buffer:e.buffer};return{result:r,transferList:[r.buffer]}}async function p(e){await M(),j(e)}async function d(e){E=await M(),E.setLegacySchema(e.context,e.jsonSchema)}async function h(e){const{localMatrix:n,origin:s,positions:i,vertexSpace:a}=e,f=r.fromJSON(e.inSpatialReference),c=r.fromJSON(e.outSpatialReference);let l;const[{projectBuffer:u},{initializeProjection:m}]=await Promise.all([import(\"../../../geometry/projection/projectBuffer.js\"),import(\"../../../geometry/projection.js\")]);await m(f,c);const y=[0,0,0];if(!u(s,f,0,y,c,0))throw new Error(\"Failed to project\");if(\"georeferenced\"===a.type&&null==a.origin){if(l=new Float64Array(i.length),!u(i,f,0,l,c,0,l.length/3))throw new Error(\"Failed to project\")}else{const e=\"georeferenced\"===a.type?t.fromJSON(a):o.fromJSON(a),{projectMeshVertexPositions:r}=await import(\"../../../geometry/support/meshUtils/projectMeshVertexPositions.js\"),s=r({vertexAttributes:{position:i},transform:n?{localMatrix:n}:void 0,vertexSpace:e,spatialReference:f},c);if(!s)throw new Error(\"Failed to project\");l=s}const p=l.length,[d,h,b]=y;for(let r=0;r<p;r+=3)l[r]-=d,l[r+1]-=h,l[r+2]-=b;return{result:{projected:l,original:i,projectedOrigin:y},transferList:[l.buffer,i.buffer]}}async function b({normalMatrix:r,normals:t}){const o=new Float32Array(t.length);return n(o,t,r),e(r)&&s(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}}function g(e){x(e)}let w,E;function j(e){if(!E)return;const r=e.modifications,t=E._malloc(8*r.length),o=new Float64Array(E.HEAPU8.buffer,t,r.length);for(let n=0;n<r.length;++n)o[n]=r[n];E.setModifications(e.context,t,r.length,e.isGeodetic),E._free(t)}function A(e,r,t){const{context:o,globalTrafo:n,mbs:s,obbData:a,elevationOffset:l,geometryBuffer:u,geometryDescriptor:m,indexToVertexProjector:y,vertexToRenderProjector:p}=r,d=e._malloc(u.byteLength),h=33,b=e._malloc(h*Float64Array.BYTES_PER_ELEMENT),g=new Uint8Array(e.HEAPU8.buffer,d,u.byteLength);g.set(new Uint8Array(u));const w=new Float64Array(e.HEAPU8.buffer,b,h);_(w,[NaN,NaN,NaN]);let E=w.byteOffset+3*w.BYTES_PER_ELEMENT,j=new Float64Array(w.buffer,E);_(j,n),E+=16*w.BYTES_PER_ELEMENT,j=new Float64Array(w.buffer,E),_(j,s),E+=4*w.BYTES_PER_ELEMENT,a&&(j=new Float64Array(w.buffer,E),_(j,a));const A=m,L={isDraco:!1,isLegacy:!1,color:r.layouts.some((e=>e.some((e=>\"color\"===e.name)))),normal:r.needNormals&&r.layouts.some((e=>e.some((e=>\"normalCompressed\"===e.name)))),uv0:r.layouts.some((e=>e.some((e=>\"uv0\"===e.name)))),uvRegion:r.layouts.some((e=>e.some((e=>\"uvRegion\"===e.name)))),featureIndex:A.featureIndex},S=e.process(o,!!r.obbData,d,g.byteLength,A,L,b,l,y,p,r.normalReferenceFrame);if(e._free(b),e._free(d),S.error.length>0)throw new Error(`i3s.wasm: ${S.error}`);if(S.discarded)return null;const x=S.componentOffsets.length>0?S.componentOffsets.slice():null,P=S.featureIds.length>0?S.featureIds.slice():null,M=S.anchorIds.length>0?Array.from(S.anchorIds):null,N=S.anchors.length>0?Array.from(S.anchors):null,U=S.interleavedVertedData.slice().buffer,I=S.indicesType===i.Int16?new Uint16Array(S.indices.buffer,S.indices.byteOffset,S.indices.byteLength/2).slice():new Uint32Array(S.indices.buffer,S.indices.byteOffset,S.indices.byteLength/4).slice(),F=S.positions.slice(),{buffer:T,byteOffset:B,byteLength:O}=S.positionIndices,R=S.positionIndicesType===i.Int16?new Uint16Array(T,B,O/2).slice():new Uint32Array(T,B,O/4).slice(),v=new f(r.layouts[0],U,I,S.hasColors,S.hasModifications,{data:F,indices:R});return P&&t.push(P.buffer),x&&t.push(x.buffer),t.push(U),t.push(I.buffer),t.push(F.buffer),t.push(R.buffer),new c(x,P,M,N,v,n,S.obb)}function L(e){return 0===e?l.Unmodified:1===e?l.PotentiallyModified:2===e?l.Culled:l.Unknown}function S(e){if(!E)return;const{context:r,buffer:t}=e,o=E._malloc(t.byteLength),n=t.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(E.HEAPU8.buffer,o,n),i=new Float64Array(t);s.set(i),E.filterOBBs(r,o,n),i.set(s),E._free(o)}function x(e){E&&0===E.destroy(e)&&(E=null)}function _(e,r){for(let t=0;t<r.length;++t)e[t]=r[t]}async function P(){E||await M()}async function M(){return E||(E=await(w??=a())),E}const N={transform:(e,r)=>E&&A(E,e,r),destroy:x};export{g as destroyContext,m as dracoDecompressPointCloudData,y as filterObbsForModifications,S as filterObbsForModificationsSync,P as initialize,L as interpretObbModificationResults,u as process,h as project,d as setLegacySchema,p as setModifications,j as setModificationsSync,N as test,b as transformNormals};\n"],"names":["y","q","V","t","r","o","n","s","a","i","l","c","e","u","I","f","Q","$","z","E","M","p$1","h","d","A","m","S","p","j","b","g","x","w","L","P","N","U","F","T","B","O","R","v"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}