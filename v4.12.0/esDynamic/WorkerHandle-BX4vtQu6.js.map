{"version":3,"file":"WorkerHandle-BX4vtQu6.js","sources":["../../node_modules/@arcgis/core/core/workers/WorkerHandle.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{remove as e}from\"../arrayUtils.js\";import{makeHandle as t}from\"../handleUtils.js\";import s from\"../Logger.js\";import{throwIfAborted as r}from\"../promiseUtils.js\";import{open as i}from\"./workers.js\";class h{constructor(e,t,r,h,o={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=i(e,{...o,schedule:h}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,o.hasInitialize&&this.broadcast({},\"initialize\");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>s.getLogger(\"esri.core.workers.WorkerHandle\").error(`Failed to initialize ${e} worker: ${t}`)))}on(s,r){const i={removed:!1,eventName:s,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),t((()=>{i.removed=!0,e(this._listeners,i),this._thread&&null!=i.threadHandle&&i.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,s){if(this._thread){const r=this._transferLists[e],i=r?r(t):[];return this._thread.invoke(e,t,{transferList:i,signal:s})}return this._promise?this._promise.then((()=>(r(s),this.invokeMethod(e,t,s)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}export{h as WorkerHandle};\n"],"names":["r","h","o","i","e","t","s"],"mappings":";;QAI6M,MAAO;AAAA,EAAC,YAAY,GAAE,GAAEA,GAAEC,GAAEC,IAAE,CAAA,GAAG;AAAC,SAAK,cAAY,GAAE,KAAK,iBAAeF,GAAE,KAAK,aAAW,CAAA,GAAG,KAAK,WAASG,EAAE,GAAE,EAAC,GAAGD,GAAE,UAASD,EAAC,CAAC,EAAE,KAAM,CAAAG,MAAG;AAAC,UAAY,KAAK,YAAd,QAAsB;AAAC,aAAK,UAAQA,GAAE,KAAK,WAAS,MAAKF,EAAE,iBAAe,KAAK,UAAU,CAAE,GAAC,YAAY;AAAE,mBAAUE,KAAK,KAAK,WAAW,MAAK,iBAAiBA,CAAC;AAAA,MAAC,MAAM,CAAAA,EAAE,MAAO;AAAA,IAAA,CAAG,GAAC,KAAK,SAAS,MAAO,CAAAC,MAAGC,EAAE,UAAU,gCAAgC,EAAE,MAAM,wBAAwB,CAAC,YAAYD,CAAC,EAAE,CAAC;AAAA,EAAE;AAAA,EAAC,GAAGC,GAAEN,GAAE;AAAC,UAAMG,IAAE,EAAC,SAAQ,IAAG,WAAUG,GAAE,UAASN,GAAE,cAAa,KAAI;AAAE,WAAO,KAAK,WAAW,KAAKG,CAAC,GAAE,KAAK,iBAAiBA,CAAC,GAAEE,EAAG,MAAI;AAAC,MAAAF,EAAE,UAAQ,IAAGC,EAAE,KAAK,YAAWD,CAAC,GAAE,KAAK,WAAeA,EAAE,gBAAR,QAAsBA,EAAE,aAAa,OAAQ;AAAA,IAAA,CAAG;AAAA,EAAA;AAAA,EAAC,UAAS;AAAC,SAAK,YAAU,KAAK,QAAQ,MAAO,GAAC,KAAK,UAAQ,OAAM,KAAK,WAAS,MAAK,KAAK,WAAW,SAAO,GAAE,KAAK,iBAAe,CAAE;AAAA,EAAA;AAAA,EAAC,OAAO,GAAE,GAAE;AAAC,WAAO,KAAK,aAAa,KAAK,aAAY,GAAE,CAAC;AAAA,EAAC;AAAA,EAAC,aAAa,GAAE,GAAE,GAAE;AAAC,QAAG,KAAK,SAAQ;AAAC,YAAMH,IAAE,KAAK,eAAe,CAAC,GAAEG,IAAEH,IAAEA,EAAE,CAAC,IAAE,CAAA;AAAG,aAAO,KAAK,QAAQ,OAAO,GAAE,GAAE,EAAC,cAAaG,GAAE,QAAO,EAAC,CAAC;AAAA,IAAC;AAAC,WAAO,KAAK,WAAS,KAAK,SAAS,KAAM,OAAKH,EAAE,CAAC,GAAE,KAAK,aAAa,GAAE,GAAE,CAAC,EAAI,IAAC,QAAQ,OAAO,IAAI;AAAA,EAAC;AAAA,EAAC,UAAU,GAAE,GAAE;AAAC,WAAO,KAAK,UAAQ,QAAQ,IAAI,KAAK,QAAQ,UAAU,GAAE,CAAC,CAAC,EAAE,KAAM,MAAI;AAAA,IAAE,CAAA,IAAG,KAAK,WAAS,KAAK,SAAS,KAAM,MAAI,KAAK,UAAU,GAAE,CAAC,CAAC,IAAG,QAAQ,OAAQ;AAAA,EAAA;AAAA,EAAC,IAAI,UAAS;AAAC,WAAO,KAAK;AAAA,EAAQ;AAAA,EAAC,iBAAiB,GAAE;AAAC,SAAK,WAAS,KAAK,QAAQ,GAAG,EAAE,WAAU,EAAE,QAAQ,EAAE,KAAM,OAAG;AAAC,QAAE,YAAU,EAAE,eAAa;AAAA,IAAE,CAAC;AAAA,EAAE;AAAC;","x_google_ignoreList":[0]}