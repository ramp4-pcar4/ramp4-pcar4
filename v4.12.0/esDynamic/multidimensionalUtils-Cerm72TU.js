import{y as A}from"./Field-Cj6Pz3TI.js";import{x as N,z as S,fw as D,K as B,G,ai as J,bP as K}from"./main-DnzmeE4U.js";var U;let w=U=class extends G{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new U({variableName:this.variableName,dimensionName:this.dimensionName,values:J(this.values),isSlice:this.isSlice})}};N([S({type:String,json:{write:!0}})],w.prototype,"variableName",void 0),N([S({type:String,json:{write:!0}})],w.prototype,"dimensionName",void 0),N([S({type:D.array(D.oneOf([D.native(Number),D.array(D.native(Number))])),json:{write:!0}})],w.prototype,"values",void 0),N([S({type:Boolean,json:{write:!0}})],w.prototype,"isSlice",void 0),w=U=N([B("esri.layers.support.DimensionalDefinition")],w);const M=w,V="Raster.",v="Raster.Dim.",T=".Max",b={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},R=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function x(e,n){return new A({name:e,alias:n,domain:null,editable:!1,length:50,type:"string"})}function C(e,n){return new A({name:e,alias:n,domain:null,editable:!1,type:"double"})}function Q(e,n){return new A({name:e,alias:n,domain:null,editable:!1,type:"date"})}function H(e){return x(b.servicePixelValue,e??"Service Pixel Value")}function X(e){return x(b.rawServicePixelValue,e??"Raw Service Pixel Value")}function _(){return x(b.itemPixelValue,"Item Pixel Value")}function ee(e){return x(`${b.servicePixelValue}.${e}`,e)}function ne(e){return C(`${b.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function te(){return C(`${b.direction}`,"Direction (\xB0)")}function ae(e){return e.fields.filter(n=>n.type!=="oid"&&n.name.toLowerCase()!=="value").map(n=>{const a=n.clone();return a.name=`${V}${n.name}`,a})}function ie(e){const n=new Set,a=new Set,s=new Map;return e.variables.forEach(({dimensions:i})=>{i.forEach(t=>{if(t.recurring)s.set(t.name,t.unit);else{const r=t.unit?.trim()==="ISO8601"?n:a;r.add(t.name),t.hasRanges&&r.add(`${t.name}${T}`)}})}),[x(b.variable,"Variable"),...[...n].map(i=>Q(`${v}${i}`,k(i))),...[...a].map(i=>C(`${v}${i}`,k(i))),...[...s].map(([i,t])=>C(`${v}${i}`,se(i,t)))]}function se(e,n){return n=n?.toLowerCase(),n&&R.has(n)?R.get(n):k(e)}function k(e){const n=e.endsWith(T),a=n?e.slice(0,-4):e,s=a==="StdTime"?"Standard Time":a==="StdZ"?"Standard Z":a;return n?`${s} Max`:s}function I(e,n){return n?new Date(e):e}function re(e,n,a){a?.length&&(n[b.variable]=a[0].variableName,a.forEach(({dimensionName:s,values:i})=>{if(s&&i?.length){const t=`${v}${s}`,r=e.find(({name:u})=>u===t);if(!r)return;const l=r.type==="date",m=i[0];if(Array.isArray(m)){if(n[`${v}${s}`]=I(m[0],l),m[1]!=null){const u=`${v}${s}${T}`;if(e.some(({name:o})=>o===u)){const o=I(m[1],l);n[u]=o}}}else n[`${v}${s}`]=I(m,l)}}))}function le(e,n){if(n.pixelType.startsWith("f")&&e.forEach(({format:a,fieldName:s})=>{a&&s&&/^raster\.(item|service)pixelvalue/i.test(s)&&(a.places=2)}),n.multidimensionalInfo){const a=n.multidimensionalInfo.variables.flatMap(({dimensions:s})=>s);e.forEach(({format:s,fieldName:i})=>{if(s&&i?.startsWith(v)){const t=i.slice(v.length),r=`${t}${T}`;a.find(({name:l})=>l===t||l===r)?.values?.every(l=>Number.isInteger(l))&&(s.places=0)}})}}function Y(e,n,a){const s=n.shift();if(a.length===0){const t=[];a.push({sliceId:-1,multidimensionalDefinition:t})}const i=a.length;for(let t=0;t<i;t++){const r=a.shift().multidimensionalDefinition;s.values?.forEach(l=>{a.push({sliceId:-1,multidimensionalDefinition:[...r,{variableName:e,dimensionName:s.name,values:[l]}]})})}n.length&&Y(e,n,a)}function ue(e,n){const a=[];let s=0;return(n?e.variables.filter(i=>i.name.toLowerCase()===n.toLowerCase()):[...e.variables].sort((i,t)=>i.name>t.name?1:-1)).forEach(i=>{const t=[],r=[...i.dimensions].sort((l,m)=>l.name>m.name?-1:1);Y(i.name,r,t),t.forEach(l=>{a.push({...l,sliceId:s++})})}),a}function oe(e,n,a){let s=e;if(n&&(n=[...n].sort((i,t)=>i.dimensionName<t.dimensionName?-1:1)).forEach(({dimensionName:i,values:t,isSlice:r})=>{t.length&&(s=s.filter(l=>{const m=l.multidimensionalDefinition.find(o=>o.dimensionName===i);if(m==null)return!1;const u=m.values[0];return typeof u=="number"?typeof t[0]=="number"?t.includes(u):t.some(o=>o[0]<=u&&o[1]>=u):typeof t[0]=="number"?t.some(o=>u[0]<=o&&u[1]>=o):r?t.some(o=>o[0]===u[0]&&o[0]===u[1]):t.some(o=>o[0]>=u[0]&&o[0]<=u[1]||o[1]>=u[0]&&o[1]<=u[1]||o[0]<u[0]&&o[1]>u[1])}))}),s.length&&a?.start!=null&&a.end!=null){const i=a.start.getTime(),t=a.end.getTime(),r=s[0].multidimensionalDefinition.findIndex(l=>l.dimensionName==="StdTime");r>-1&&(s=s.filter(l=>{const m=l.multidimensionalDefinition[r].values[0];return i<=m&&t>=m}))}return s.map(i=>i.sliceId)}function P(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function me(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function E(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function O(e,n,a){if(!n?.subsetDefinitions?.length)return e;let s;if(a){const{variables:r}=n;if(r.length&&!r.includes(a))return null;const l=n.subsetDefinitions.find(m=>m.dimensionName===e.name&&m.variableName===a);if(!l?.values?.length)return e;s=E(l.values)}else s=n.dimensions.find(({name:r})=>r===e.name)?.extent;const i=s;if(!i?.length)return e;const t=e.values.filter(r=>P(r,i));return{...e,extent:[...i],values:t}}function $(e,n,a){if(!n?.subsetDefinitions?.length)return!1;const{variables:s}=n;if(s.length&&e.some(({variableName:i})=>i&&!s.includes(i)))return!0;for(let i=0;i<e.length;i++){const t=e[i],r=n.subsetDefinitions.find(l=>(t.variableName===""||l.variableName===t.variableName)&&l.dimensionName===t.dimensionName);if(r?.values.length){const l=E(r.values);if(!t.isSlice&&t.values.length===2&&!Array.isArray(t.values[0])&&t.values[0]!==t.values[1]&&a){if(!me(t.values,l))return!0}else if(t.values.some(m=>!P(m,l)))return!0}}return!1}function ce(e,n){if(e==null)return{isOutside:!1};const{geometry:a,timeExtent:s,multidimensionalDefinition:i}=n;let t=null;if(s!=null&&(t=de(e,s),t==null))return{isOutside:!0};const{areaOfInterest:r}=e;if(r&&a){const l=a.type==="point"?a:a.type==="extent"?a.center:a.type==="polygon"?a.centroid:null;if(l&&!r.contains(l))return{isOutside:!0}}return i!=null&&i.length&&$(i,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:a,timeExtent:t,multidimensionalDefinition:i}}}function de(e,n){const a=e.dimensions.find(({name:r})=>r==="StdTime");if(a==null||n.start==null&&n.end==null)return n;n=n.clone();const{start:s,end:i}=n.toJSON(),t=s===i?[s]:s!=null&&i!=null?[s,i]:[s??i];return t.length===2&&a?.extent.length&&(t[0]=Math.max(t[0],a.extent[0]),t[1]=Math.min(t[1],a.extent[1]??a.extent[0]),t[1]<t[0])||$([new M({variableName:"",dimensionName:"StdTime",isSlice:t.length===1,values:t})],e,!0)?null:(n.start=new Date(t[0]),n.end=new Date(t[1]??t[0]),n)}function fe(e){const{rasterInfo:n,multidimensionalSubset:a}=e,{multidimensionalInfo:s}=n;if(s==null)return null;let i=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:F(n,{multidimensionalSubset:a});if(!i?.length)return null;if(i.some(r=>!r.dimensionName)){const{variableName:r}=i[0],l=F(n,{multidimensionalSubset:a,variableName:r});l?.forEach(m=>{const u=i?.find(({dimensionName:o})=>o===m.dimensionName);u?.values?.length&&(m.values=u.values,m.isSlice=u.isSlice)}),i=l}const{timeExtent:t}=e;if(i!=null&&t!=null&&(t.start!=null||t.end!=null)){i=i.map(h=>h.clone());const r=s.variables.find(({name:h})=>h===i[0].variableName)?.dimensions?.find(({name:h})=>h==="StdTime"),l=i.find(({dimensionName:h})=>h==="StdTime");if(!r||!l)return null;const{start:m,end:u}=t,o=m==null?null:m.getTime(),g=u==null?null:u.getTime(),c=o??g,f=g??o;if(r.values!=null){const h=r.values.filter(d=>{if(Array.isArray(d)){if(c===f)return d[0]<=c&&d[1]>=c;const y=d[0]<=c&&d[1]>c||d[0]<f&&d[1]>=f,p=d[0]>=c&&d[1]<=f||d[0]<c&&d[1]>f;return y||p}return c===f?d===c:d>=c&&d<=f});if(h.length){const d=h.sort((y,p)=>{const W=Array.isArray(y)?y[0]:y,q=Array.isArray(y)?y[1]:y,z=Array.isArray(p)?p[0]:p,Z=Array.isArray(p)?p[1]:p;return c===f?W-z:Math.abs(q-f)-Math.abs(Z-f)})[0];l.values=[d]}else i=null}else if(r.hasRegularIntervals&&r.extent){const[h,d]=r.extent;c>d||f<h?i=null:l.values=c===f?[c]:[Math.max(h,c),Math.min(d,f)]}}return i!=null&&$(i,a)?null:i}function L(e,n={}){const{multidimensionalInfo:a,keyProperties:s}=e;if(a==null)return null;const{variableName:i,multidimensionalSubset:t,multidimensionalDefinition:r}=n,l=r!=null?r[0]?.variableName:null,m=i||l||s?.DefaultVariable;let{variables:u}=a;return t?.variables?.length&&(u=u.filter(({name:o})=>t.variables.includes(o))),m?u.find(({name:o})=>o===m)??u[0]:u[0]}function F(e,n={}){const a=L(e,n);if(!a)return null;const s=[],{dimensions:i,name:t}=a;if(i.length===0)return[new M({variableName:t,dimensionName:"",values:[],isSlice:!0})];for(let r=0;r<i.length;r++){const l=O(i[r],n.multidimensionalSubset,t);if(!l)return null;const{values:m,extent:u}=l;let o=m?.[0]??u?.[0];l.name.toLowerCase()==="stdz"&&!l.hasRanges&&u&&Math.abs(u[1])<=Math.abs(u[0])&&(o=m?.length?m[m.length-1]:u[1]),s.push(new M({variableName:t,dimensionName:l.name,values:[o],isSlice:!n.useRangeForRangedDimensionInfo||!!l.hasRanges}))}return s}function he(e){return!!e?.length&&e.some(n=>{if(n.values==null)return!0;const a=n.values.length;return a===0||a>1||!n.isSlice&&Array.isArray(n.values[0])})}function ve(e,n){if(n==null||e==null)return null;let a=n.variables.map(s=>({...s}));return e?.variables?.length&&(a=a.filter(({name:s})=>e.variables.includes(s)),a.forEach(s=>{s.dimensions=s.dimensions.map(i=>O(i,e,s.name)).filter(K)})),a}function ge(e,n){const{values:a}=n;if(a?.length){const l=Array.isArray(a[0]),m=Array.isArray(e);return l!==m?-1:l&&m?a.findIndex(u=>u[0]===e[0]&&u[1]===e[1]):a.indexOf(e)}const{extent:s}=n;if(Array.isArray(e)||!s||e<s[0]||e>s[1])return-1;const i=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-s[0])/i);const t=s[0];let r=-1;switch(n.intervalUnit?.toLowerCase()||"days"){case"seconds":r=Math.round((e-t)/1e3/i);break;case"minutes":r=Math.round((e-t)/6e4/i);break;case"hours":r=Math.round((e-t)/36e5/i);break;case"days":r=Math.round((e-t)/864e5/i);break;case"months":{const l=new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear(),m=new Date(t).getUTCMonth(),u=new Date(e).getUTCMonth();r=l===0?u-m:u+11-m+12*(l-1)}break;case"years":r=Math.round((new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear())/i);break;case"decades":r=Math.round((new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear())/10/i)}return r}function j(e){let n=e.values?.length;if(n)return n;const{extent:a,unit:s}=e,i=e.interval||1,t=a?a[1]-a[0]:0;if(s!=="ISO8601")return Math.round(t/i);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":n=Math.round(t/1e3/i);break;case"minutes":n=Math.round(t/6e4/i);break;case"hours":n=Math.round(t/36e5/i);break;case"days":n=Math.round(t/864e5/i);break;case"months":if(a){const r=new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear(),l=new Date(a[0]).getUTCMonth(),m=new Date(a[1]).getUTCMonth();n=r===0?m-l+1:m+11-l+12*(r-1)+1}else n=0;break;case"years":n=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/i):0;break;case"decades":n=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/10/i):0;break;default:n=0}return n}function be(e){if(e.extent?.length!==2||!e.interval)return[];const{extent:[n,a],interval:s}=e;if(e.unit==="ISO8601"){const t=e.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(t)?ye(n,a,s,t):[]}const i=Math.round((a-n)/s);return Array.from({length:i},(t,r)=>r===i-1?a:n+r*s)}function ye(e,n,a,s){const i=[];let t=e;const r=new Date(e);for(;t<=n;)switch(i.push(t),s){case"decades":r.setUTCFullYear(r.getUTCFullYear()+10*a),t=r.getTime();break;case"years":r.setUTCFullYear(r.getUTCFullYear()+a),t=r.getTime();break;case"months":r.setUTCMonth(r.getUTCMonth()+a),t=r.getTime();break;case"days":t+=864e5*a;break;case"hours":t+=36e5*a;break;case"minutes":t+=6e4*a;break;case"seconds":t+=1e3*a}return i.length===1?i[1]=n:i[i.length-1]=n,i}function pe(e,n){let a=0;const s=e[0].variableName,i=[...n.variables].sort((t,r)=>t.name>r.name?1:-1);for(let t=0;t<i.length;t++){const r=i[t],l=[...r.dimensions].sort((o,g)=>o.name>g.name?-1:1);if(r.name!==s){a+=l.map(o=>j(o)).reduce((o,g)=>o*g);continue}const m=l.map(o=>j(o)),u=l.length;for(let o=0;o<u;o++){const g=e.find(f=>f.dimensionName===l[o].name);if(g==null)return null;const c=ge(g.values[0],l[o]);if(c===-1)return null;m.shift(),a+=o===u-1?c:c*m.reduce((f,h)=>f*h)}break}return a}function we(e){return Math.round(24*(e-25569)*3600*1e3)}export{te as $,be as D,pe as N,re as V,H as a,ie as b,X as c,ne as d,ce as e,ee as f,fe as g,ve as h,F as i,le as j,v as k,he as l,_ as m,V as n,$ as o,M as p,ue as q,oe as r,L as s,b as t,ae as v,we as w};
