import{ap as q,bq as O,bP as Ee,ae as Q,an as E,bQ as Te,s as xe,bR as T,bS as v,bT as he,bU as ve,bV as Ce,Q as me}from"./main-DnzmeE4U.js";import{k as B,K as _e,O as _,L as ze,q as pe}from"./projection-m8vi7Cxv.js";var Z;function $(e,t,i){return!ze(e,t,i)}function z(e,t,i){const o=$(e,t,i);if(o&&!B())throw new xe("rasterprojectionhelper-project","projection engine is not loaded");return o}(function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"})(Z||(Z={}));const ge=(e,t,i,o=0)=>{if(i[0]===1)return[0,0];let a=1,n=-1,s=1,c=-1;for(let f=0;f<e.length;f+=2)isNaN(e[f])||(a=a>e[f]?e[f]:a,n=n>e[f]?n:e[f],s=s>e[f+1]?e[f+1]:s,c=c>e[f+1]?c:e[f+1]);const{cols:l,rows:r}=t,u=(n-a)/l/i[0],d=(c-s)/r/i[1],g=2*o;let x=0,m=!1,h=[0,0];for(let f=0;f<l-3;f++){for(let M=0;M<r-3;M++){const p=f*r*2+2*M,y=(e[p]+e[p+4]+e[p+4*r]+e[p+4*r+4])/4,w=(e[p+1]+e[p+5]+e[p+4*r+1]+e[p+4*r+5])/4,R=Math.abs((y-e[p+2*r+2])/u),b=Math.abs((w-e[p+2*r+3])/d);if(R+b>x&&(x=R+b,h=[R,b]),g&&x>g){m=!0;break}}if(m)break}return h},Le={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},F=32,Y=4,H=Y,ee=new Map,te=new Map,J=500,Oe=39.37,We=96;let V=null;async function Ie(){V&&B()||(B()||await _e(),V=await import("./index-CVKk0WAC.js").then(e=>e.V))}function ye(e,t,i){return z(e.spatialReference,t),i?pe(t,e.spatialReference,e):pe(e.spatialReference,t,e)}function je(e,t,i,o=null){const a=e.spatialReference;if(!a||!t||a.equals(t))return e;z(a,t,o);const n=i.center,s=new q({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:a}),c=_(s,t,o),l=N(t);return c==null||l!=null&&c.width>=l?X(e,a,t):{x:c.width,y:c.height}}function X(e,t,i){const o=O(t)/O(i);return{x:e.x*o,y:e.y*o}}function ne(e,t,i){const{spatialReference:o}=i;if(!o||!t||o.equals(t))return e;if(o.isGeographic&&t.isGeographic)return X(e,o,t);if(z(o,t),!V)throw new xe("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:a,y:n}=e;const s=(a+n)/2*O(o);let c=1;s>30&&(c=30/s,a*=c,n*=c);const l=256,r=a*l/2,u=n*l/2,{x:d,y:g}=i.center,x=[];for(let S=0;S<=l;S++)x.push([d-r,g-u+S*n]);for(let S=1;S<=l;S++)x.push([d-r+S*a,g+u]);for(let S=1;S<=l;S++)x.push([d+r,g+u-S*n]);for(let S=1;S<l;S++)x.push([d+r-S*a,g-u]);x.push(x[0]);const m=new Q({rings:[x],spatialReference:o}),h=_(m,t);if(!h)return X(e,o,t);const f=h.extent,M=N(t);if(f==null||M!=null&&f.width>=M)return X(e,o,t);const p=V.planarArea(h),y=a*n*l*l,w=Math.sqrt(p/y)/c,R={x:f.width/c/l,y:f.height/c/l},b={x:a*w,y:n*w},P=R.x*R.y;return Math.abs(P-b.x*b.y)/P<.1?R:b}function ie(e,t){return(typeof e=="number"?e:(e.x+e.y)/2)*O(t)*We*Oe}function qe(e,t){const{pixelSize:i,extent:o}=e;return ie(ne(i,t,o),t)}function k(e,t=.01){return O(e)?t/O(e):0}function oe(e,t,i=null,o=!0){const a=e.spatialReference;if(a.equals(t))return e;z(a,t,i);const n=_(e,t,i);return o&&n&&de([e],[n],a,t),n}function de(e,t,i,o){const a=K(i,!0),n=K(o,!0),s=k(i,J),c=k(o,J);if(s&&a!=null&&n!=null)for(let l=0;l<e.length;l++){const r=t[l];if(!r)continue;const{x:u}=e[l],{x:d}=r;d>=n[1]-c&&Math.abs(u-a[0])<s?r.x-=n[1]-n[0]:d<=n[0]+c&&Math.abs(u-a[1])<s&&(r.x+=n[1]-n[0])}}function Ae(e){const{inSR:t,outSR:i,datumTransformation:o,preferPE:a}=e;if(t.equals(i)){const{points:n}=se(e,null);return n}return t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator?Ye(e):z(t,i,o)&&a&&(t.isGeographic||W(t)!=null)?Fe(e):Be(e)}function Be(e){const{points:t}=se(e,null),{inSR:i,outSR:o,datumTransformation:a}=e,n=t.map(c=>new E(c[0],c[1],i)),s=_(n,o,a);return a&&de(n,s,i,o),s.map(c=>c?[c.x,c.y]:[NaN,NaN])}function Fe(e){const{inSR:t,outSR:i,datumTransformation:o}=e,a=W(t),{points:n,mask:s}=se(e,a);if(!t.isGeographic){const l=t.wkid?T.coordsys(t.wkid):T.fromString(t.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,t.wkt2||t.wkt);he.projToGeog(l,n.length,n)}if(o!=null&&o.steps.length){let l;if(i.isGeographic&&(l=n.map(([r])=>r>179.9955?1:r<-179.9955?-1:0)),o.steps.forEach(r=>{const u=r.wkid?T.geogtran(r.wkid):T.fromString(v.PE_TYPE_GEOGTRAN,r.wkt);ve.geogToGeog(u,n.length,n,null,r.isInverse?v.PE_TRANSFORM_2_TO_1:v.PE_TRANSFORM_1_TO_2)}),l)for(let r=0;r<n.length;r++){const u=l[r],d=n[r][0],g=d>179.9955?1:d<-179.9955?-1:0;u&&g&&u!==g&&(n[r][0]=u>0?d+360:d-360)}}if(!i.isGeographic){const l=W(i,!0),r=l!=null&&l.isEnvelope?[l.bbox[1],l.bbox[3]]:[-90,90];Je(n,r);const u=i.wkid?T.coordsys(i.wkid):T.fromString(i.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,i.wkt2||i.wkt);he.geogToProj(u,n.length,n)}let c=n;if(s&&n.length!==s.length){c=[];for(let l=0,r=0;l<s.length;l++)s[l]?c.push(n[r++]):c.push([NaN,NaN])}return c}function Ye(e){const{cols:t,rows:i,xres:o,yres:a,usePixelCenter:n,inSR:s,outSR:c}=e;let{xmin:l,ymax:r}=e;n&&(l+=o/2,r-=a/2);const u=[],d=[],g=Math.max(t,i);for(let m=0;m<g;m++){const h=l+o*Math.min(t,m),f=r-a*Math.min(i,m),M=_(new E({x:h,y:f,spatialReference:s}),c);m<=t&&u.push(M.x),m<=i&&d.push(M.y)}const x=[];for(let m=0;m<t;m++)for(let h=0;h<i;h++)x.push([u[m],d[h]]);return x}function W(e,t=!1){let i=e.wkid||e.wkt2||e.wkt;if(!i||e.isGeographic)return null;if(i=String(i),ee.has(i)){const s=ee.get(i);return t?s?.gcs:s?.pcs}const o=e.wkid?T.coordsys(e.wkid):T.fromString(e.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,e.wkt2||e.wkt),a=we(o,k(e,1e-4)),n=we(o,0,!0);return ee.set(i,{pcs:a,gcs:n}),t?n:a}function we(e,t=0,i=!1){const o=Ce.generate(e),a=i?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!o||!a?.length)return null;let n=!1,s=a.find(f=>f.getInclusive()===1&&f.getKind()===1);if(!s){if(s=a.find(f=>f.getInclusive()===1&&f.getKind()===0),!s)return null;n=!0}const c=i?0:(o.getNorthPoleLocation()===2?1:0)|(o.getSouthPoleLocation()===2?2:0),l=o.isPannableRectangle(),r=s.getCoord();if(n)return{isEnvelope:n,isPannable:l,vertices:r,coef:null,bbox:[r[0][0]-t,r[0][1]-t,r[1][0]+t,r[1][1]+t],poleLocation:c};let u=0;const d=[];let[g,x]=r[0],[m,h]=r[0];for(let f=0,M=r.length;f<M;f++){u++,u===M&&(u=0);const[p,y]=r[f],[w,R]=r[u];if(R===y)d.push([p,w,y,R,2]);else{const b=(w-p)/(R-y||1e-4),P=p-b*y;y<R?d.push([b,P,y,R,0]):d.push([b,P,R,y,1])}g=g<p?g:p,x=x<y?x:y,m=m>p?m:p,h=h>y?h:y}return{isEnvelope:!1,isPannable:l,vertices:r,coef:d,bbox:[g,x,m,h],poleLocation:c}}function se(e,t){const i=[],{cols:o,rows:a,xres:n,yres:s,usePixelCenter:c}=e;let{xmin:l,ymax:r}=e;if(c&&(l+=n/2,r-=s/2),t==null){for(let x=0;x<o;x++)for(let m=0;m<a;m++)i.push([l+n*x,r-s*m]);return{points:i}}const u=new Uint8Array(o*a);if(t.isEnvelope){const{bbox:[x,m,h,f]}=t;for(let M=0,p=0;M<o;M++){const y=l+n*M,w=t.isPannable||y>=x&&y<=h;for(let R=0;R<a;R++,p++){const b=r-s*R;w&&b>=m&&b<=f&&(i.push([y,b]),u[p]=1)}}return{points:i,mask:u}}const d=t.coef,g=[];for(let x=0;x<a;x++){const m=r-s*x,h=[],f=[];for(let p=0;p<d.length;p++){const[y,w,R,b,P]=d[p];if(m===R&&R===b)h.push(y),h.push(w),f.push(2),f.push(2);else if(m>=R&&m<=b){const S=y*m+w;h.push(S),f.push(P)}}let M=h;if(h.length>2){let p=f[0]===2?0:f[0],y=h[0];M=[];for(let w=1;w<f.length;w++)f[w]===2&&w!==f.length-1||(f[w]!==p&&(M.push(p===0?Math.min(y,h[w-1]):Math.max(y,h[w-1])),p=f[w],y=h[w]),w===f.length-1&&M.push(f[w]===0?Math.min(y,h[w]):Math.max(y,h[w])));M.sort((w,R)=>w-R)}else h[0]>h[1]&&(M=[h[1],h[0]]);g.push(M)}for(let x=0,m=0;x<o;x++){const h=l+n*x;for(let f=0;f<a;f++,m++){const M=r-s*f,p=g[f];if(p.length===2)h>=p[0]&&h<=p[1]&&(i.push([h,M]),u[m]=1);else if(p.length>2){let y=!1;for(let w=0;w<p.length;w+=2)if(h>=p[w]&&h<=p[w+1]){y=!0;break}y&&(i.push([h,M]),u[m]=1)}}}return{points:i,mask:u}}function Je(e,t){const[i,o]=t;for(let a=0;a<e.length;a++){const n=e[a][1];(n<i||n>o)&&(e[a]=[NaN,NaN])}}function Me(e,t){const i=N(e[0].spatialReference);if(e.length<2||i==null||(t=t??k(e[0].spatialReference),(e=e.filter(c=>c.width>t)).length===1))return e[0];let{xmin:o,xmax:a,ymin:n,ymax:s}=e[0];for(let c=1;c<e.length;c++){const l=e[c];a=l.xmax+i*c,n=Math.min(n,l.ymin),s=Math.max(s,l.ymax)}return new q({xmin:o,xmax:a,ymin:n,ymax:s,spatialReference:e[0].spatialReference})}function ae(e,t,i=null,o=!0){const a=e.spatialReference;if(a.equals(t))return e;const n=U(e),s=N(a,!0),c=N(t);if(n===0||s==null||c==null){const r=re(e,t,i,o);if(s==null&&c!=null&&Math.abs(r.width-c)<k(t)&&B()){const u=W(a);if(u!=null&&u.poleLocation===Z.None&&e.width<(u.bbox[2]-u.bbox[0])/2)return Xe(e,t)||r}return r}const l=e.clone().normalize();if(l.length===1&&e.xmax<s&&e.xmax-s/2>k(a)){const{xmin:r,xmax:u}=e;for(let d=0;d<=n;d++){const g=d===0?r:-s/2,x=d===n?u-s*d:s/2;l[d]=new q({xmin:g,xmax:x,ymin:e.ymin,ymax:e.ymax,spatialReference:a})}}return Me(l.map(r=>re(r,t,i,o)).filter(Ee))}function Ve(e,t,i){if(e.type==="extent"){const{xmin:o,ymin:a,xmax:n,ymax:s,spatialReference:c}=e;e=new Q({rings:[[[o,s],[n,s],[n,a],[o,a],[o,s]]],spatialReference:c})}return e.spatialReference.equals(t)?e:(z(e.spatialReference,t,i),_(e,t,i))}function Xe(e,t){const i=N(t);if(i==null)return null;let{xmin:o,ymin:a,xmax:n,ymax:s}=e;const c=e.spatialReference,l=new Q({spatialReference:c,rings:[[[o,a],[n,a],[n,s],[o,s],[o,a]]]}),r=_(l,t);if(r.rings.length!==2||!r.rings[0].length||!r.rings[1].length)return null;const{rings:u}=r,d=k(c),g=new q({spatialReference:t});for(let x=0;x<2;x++){o=n=u[x][0][0],a=s=u[x][0][1];for(let m=0;m<u[x].length;m++)o=o>u[x][m][0]?u[x][m][0]:o,n=n<u[x][m][0]?u[x][m][0]:n,a=a>u[x][m][1]?u[x][m][1]:a,s=s<u[x][m][1]?u[x][m][1]:s;if(x===0)g.ymin=a,g.ymax=s,g.xmin=o,g.xmax=n;else if(g.ymin=Math.min(g.ymin,a),g.ymax=Math.max(g.ymax,s),Math.abs(n-i/2)<d)g.xmin=o,g.xmax=g.xmax+i;else{if(!(Math.abs(o+i/2)<d))return null;g.xmax=n+i}}return g}function re(e,t,i=null,o=!0,a=!0){const n=e.spatialReference;if(n.equals(t)||!t)return e;z(n,t,i);const s=_(e,t,i);if(a&&t.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!o||!s)return s;const c=K(n,!0),l=K(t,!0);if(c==null||l==null)return s;const r=k(n,.001),u=k(n,J),d=k(t,.001);if(Math.abs(s.xmin-l[0])<d&&Math.abs(s.xmax-l[1])<d){const g=Math.abs(e.xmin-c[0]),x=Math.abs(c[1]-e.xmax);if(g<r&&x>u){s.xmin=l[0];const m=[];m.push(new E(e.xmax,e.ymin,n)),m.push(new E(e.xmax,(e.ymin+e.ymax)/2,n)),m.push(new E(e.xmax,e.ymax,n));const h=m.map(f=>oe(f,t,i)).filter(f=>!isNaN(f?.x)).map(f=>f.x);s.xmax=Math.max.apply(null,h)}if(x<r&&g>u){s.xmax=l[1];const m=[];m.push(new E(e.xmin,e.ymin,n)),m.push(new E(e.xmin,(e.ymin+e.ymax)/2,n)),m.push(new E(e.xmin,e.ymax,n));const h=m.map(f=>oe(f,t,i)).filter(f=>!isNaN(f?.x)).map(f=>f.x);s.xmin=Math.min.apply(null,h)}}else{const g=k(t,.001);Math.abs(s.xmin-l[0])<g&&(s.xmin=l[0]),Math.abs(s.xmax-l[1])<g&&(s.xmax=l[1])}return s}function N(e,t=!1){if(!e)return null;const i=t?20037508342787e-6:20037508342788905e-9;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*Le[e.wkid]||null}function K(e,t=!1){if(e.isGeographic)return[-180,180];const i=N(e,t);return i!=null?[-i/2,i/2]:null}function Re(e,t,i,o){let a=(e-t)/i;return a-Math.floor(a)!=0?a=Math.floor(a):o&&(a-=1),a}function U(e,t=!1){const i=N(e.spatialReference);if(i==null)return 0;const o=t?0:-(i/2),a=k(e.spatialReference),n=!t&&Math.abs(e.xmax-i/2)<a?i/2:e.xmax,s=!t&&Math.abs(e.xmin+i/2)<a?-i/2:e.xmin;return Re(n,o,i,!0)-Re(s,o,i,!1)}function Ke(e){const t=e.storageInfo.origin.x,i=N(e.spatialReference,!0);if(i==null)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const o=i/2,{nativePixelSize:a,storageInfo:n,extent:s}=e,{maximumPyramidLevel:c,blockWidth:l,pyramidScalingFactor:r}=n;let u=a.x;const d=[],g=e.transform!=null&&e.transform.type==="gcs-shift",x=t+(g?0:o),m=g?i-t:o-t;for(let h=0;h<=c;h++){const f=(s.xmax-t)/u/l,M=f-Math.floor(f)==0?f:Math.ceil(f),p=m/u/l,y=p-Math.floor(p)==0?p:Math.ceil(p),w=Math.floor(x/u/l),R=Math.round(x/u)%l,b=(l-Math.round(m/u)%l)%l;d.push({resolutionX:u,blockWidth:l,datasetColumnCount:M,worldColumnCountFromOrigin:y,leftMargin:R,rightPadding:b,originColumnOffset:w}),u*=r}return{originX:t,halfWorldWidth:o,pyramidsInfo:d,hasGCSSShiftTransform:g}}function Ue(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt2||e.wkt);let i;return te.has(t)?i=te.get(t):(i=(e.wkid?T.coordsys(e.wkid):T.fromString(v.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),te.set(t,i)),new me({wkid:i})}function De(e){const t=e.isAdaptive&&e.spacing==null;let i=e.spacing||[F,F],o=le(e),a={cols:o.size[0]+1,rows:o.size[1]+1};const n=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let s=o.outofBoundPointCount===o.offsets.length/2||t&&n?[0,0]:ge(o.offsets,a,i,H);const c=(s[0]+s[1])/2,l=e.projectedExtent.spatialReference,r=e.srcBufferExtent.spatialReference;if(t&&(n||c>H)&&($(l,r,e.datumTransformation)&&(l.isGeographic||W(l)),i=[Y,Y],o=le({...e,spacing:i}),a={cols:o.size[0]+1,rows:o.size[1]+1},s=ge(o.offsets,a,i,H)),o.error=s,i[0]>1&&(o.coefficients=be(o.offsets,a,n)),e.includeGCSGrid&&!l.isGeographic&&!l.isWebMercator)if(r.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:i};else{const u=W(l);if(u!=null&&!u.isEnvelope){const d=Ue(l),g=ae(e.projectedExtent,d),{offsets:x}=le({...e,srcBufferExtent:g,spacing:i}),m=be(x,a,n);o.gcsGrid={offsets:x,coefficients:m,spacing:i}}}return o}function le(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:o,datumTransformation:a,rasterTransform:n}=e,s=t.spatialReference,c=i.spatialReference,l=z(s,c),{xmin:r,ymin:u,xmax:d,ymax:g}=t,x=N(c),m=x!=null&&(e.hasWrapAround||n?.type==="gcs-shift"),h=e.spacing||[F,F],f=h[0]*o.x,M=h[1]*o.y,p=h[0]===1,y=Math.ceil((d-r)/f-.1/h[0])+(p?0:1),w=Math.ceil((g-u)/M-.1/h[1])+(p?0:1),R=Ae({cols:y,rows:w,xmin:r,ymax:g,xres:f,yres:M,inSR:s,outSR:c,datumTransformation:a,preferPE:h[0]<=Y,usePixelCenter:p}),b=[];let P,S=0;const L=p?-1:NaN,{xmin:A,xmax:I,ymax:Se,width:Pe,height:Ge}=i,ke=k(c,J),Ne=x!=null&&A>0&&I>x/2;let fe=!1;if(l){const C=W(s);fe=C!=null&&C.poleLocation>0}for(let C=0;C<y;C++){const D=[];for(let j=0;j<w;j++){let G=R[C*w+j];if(m&&G[0]>I&&G[0]>x/2-ke?G[0]-=x:m&&C===0&&G[0]<0&&Ne&&!n&&(G[0]+=x),!G||isNaN(G[0])||isNaN(G[1]))b.push(L),b.push(L),D.push(null),S++;else{if(n){const ue=n.inverseTransform(new E({x:G[0],y:G[1],spatialReference:c}));G=[ue.x,ue.y]}D.push(G),C>0&&m&&P[j]&&G[0]<P[j][0]&&(G[0]+=x,fe&&G[0]>I&&G[0]>x&&(G[0]-=x)),b.push((G[0]-A)/Pe),b.push((Se-G[1])/Ge)}}P=D}return{offsets:b,error:null,coefficients:null,outofBoundPointCount:S,spacing:h,size:p?[y,w]:[y-1,w-1]}}function be(e,t,i){const{cols:o,rows:a}=t,n=new Float32Array((o-1)*(a-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),c=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<o-1;l++){for(let r=0;r<a-1;r++){let u=l*a*2+2*r;const d=e[u],g=e[u+1],x=e[u+2],m=e[u+3];u+=2*a;const h=e[u],f=e[u+1],M=e[u+2],p=e[u+3];let y=0,w=12*(r*(o-1)+l);for(let R=0;R<3;R++)n[w++]=s[y++]*d+s[y++]*x+s[y++]*M;y=0;for(let R=0;R<3;R++)n[w++]=s[y++]*g+s[y++]*m+s[y++]*p;y=0;for(let R=0;R<3;R++)n[w++]=c[y++]*d+c[y++]*h+c[y++]*M;y=0;for(let R=0;R<3;R++)n[w++]=c[y++]*g+c[y++]*f+c[y++]*p}if(i)for(let r=0;r<n.length;r++)isNaN(n[r])&&(n[r]=-1)}return n}function Qe(e,t){const i=e.clone().normalize();return i.length===1?i[0]:Me(i,t)}function Ze(e){const{spatialReference:t}=e,i=Te(t);if(!i)return e;const[o,a]=i.valid,n=a-o;let s=0;if(e.xmin<o){const c=o-e.xmin;s=Math.ceil(c/n)}else if(e.xmin>a){const c=e.xmin-a;s=-Math.ceil(c/n)}return new q({spatialReference:e.spatialReference,xmin:e.xmin+s*n,ymin:e.ymin,xmax:e.xmax+s*n,ymax:e.ymax})}function $e(e,t,i){const{storageInfo:o,pixelSize:a}=t;let n=0,s=!1;const{pyramidResolutions:c}=o,l=o.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,r=(e.x+e.y)/2/l;if(c!=null&&c.length){const m=c[c.length-1],h=(m.x+m.y)/2,f=(a.x+a.y)/2;if(r<=f)n=0;else if(r>=h)n=c.length,s=r/h>8;else{let p,y=f;for(let w=1;w<=c.length;w++){if(p=(c[w-1].x+c[w-1].y)/2,r<=p){r===p?n=w:i==="down"?(n=w-1,s=r/y>8):n=i==="up"||r-y>p-r||r/y>2?w:w-1;break}y=p}}const M=n===0?a:c[n-1];return s&&Math.min(M.x,M.y)*O(t.spatialReference)>19567&&(s=!1),{pyramidLevel:n,pyramidResolution:new E({x:M.x,y:M.y,spatialReference:t.spatialReference}),excessiveReading:s}}const u=Math.log(e.x/a.x)/Math.LN2,d=Math.log(e.y/a.y)/Math.LN2,g=t.storageInfo.maximumPyramidLevel||0;n=i==="down"?Math.floor(Math.min(u,d)):i==="up"?Math.ceil(Math.max(u,d)):Math.round((u+d)/2),n<0?n=0:n>g&&(s=n>g+3,n=g);const x=2**n;return{pyramidLevel:n,pyramidResolution:new E({x:x*t.nativePixelSize.x,y:x*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}function ce(e,t,i=!1){const{pixelSize:o,extent:a}=e,n=ye(a,t,!1),s=ae(Qe(a,(o.x+o.y)/16),t,n);return i||U(s)===0?s:re(a,t,n)}function He(e,t,i){const o=i?.tileSize,a=i?.alignGlobalDatasetWithAGOL,{extent:n,spatialReference:s,pixelSize:c}=e,l=ne(c,t,n);if(l==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const r=(l.x+l.y)/2,u=ie(r,t),d=t.isGeographic?256/o*2958287637958547e-7:256/o*591657527591555e-6;let g=e.dataType==="vector-magdir"||e.dataType==="vector-uv";const x=ce(e,t,!0),m=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/u)/Math.LN2));if(!g&&a&&(t.isGeographic||t.isWebMercator)){const P=N(t);if(g=U(x)>0||P!=null&&x.width>P/4,!g&&P!=null){let S=-1;if(m<3)S=2**m*r*o;else if(e.storageInfo){const{maximumPyramidLevel:A=0,pyramidScalingFactor:I=2}=e.storageInfo;S=I**A*r*o}const L=Math.ceil(P/S);g=L===1||L===2&&P/2-x.xmax<S}}let h,f=u;const M=1.001,p=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(g){f=d;const P=t.isGeographic?1341104507446289e-21:.29858214164761665,S=ie(P,t),L=t.isGeographic?4326:3857;h=ne({x:P,y:P},s,ce(e,new me({wkid:L}),!0)),h.x*=f/S,h.y*=f/S}else{h={x:c.x,y:c.y};let P=0;for(;f<d*(M/2)&&P<m;)P++,f*=p,h.x*=p,h.y*=p;Math.max(f,d)/Math.min(f,d)<=M&&(f=d)}const y=[f],w=[{x:h.x,y:h.y}],R=70.5310735,b=Math.min(R,u)/M;for(;f>=b;)f/=p,h.x/=p,h.y/=p,y.push(f),w.push({x:h.x,y:h.y});return{projectedPixelSize:l,scales:y,srcResolutions:w,isCustomTilingScheme:!g}}export{oe as B,qe as O,ae as V,Ve as Z,ye as _,De as a,He as h,Ie as j,$e as m,U as o,Ke as r,N as t,Ze as u,$ as w,ce as x,je as z};
