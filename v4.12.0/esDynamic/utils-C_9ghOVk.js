import{bx as c,bo as u,cY as E,b7 as R,i as h,eF as m,eG as A,eH as C,eI as M,bn as N}from"./main-DnzmeE4U.js";import{i as O}from"./jsonUtils-DzmXEA9_.js";import{C as w}from"./cimSymbolUtils-BuFg2oLA.js";import{e as D}from"./LRUCache-BLmkvs7b.js";const g="picture-fill",k="simple-fill",H="simple-line",x="simple-marker",I="text",J="cim",L=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),d=new D(1e3);function F(e){const o=e.style;let r=null;if(e)switch(e.type){case x:o!=="cross"&&o!=="x"&&(r=e.color);break;case k:o&&o!=="solid"?o!=="none"&&(r={type:"pattern",x:0,y:0,src:E(`esri/symbols/patterns/${o}.png`),width:5,height:5}):r=e.color;break;case g:r={type:"pattern",src:e.url,width:u(e.width)*e.xscale,height:u(e.height)*e.yscale,x:u(e.xoffset),y:u(e.yoffset)};break;case I:r=e.color;break;case J:r=w(e)}return r}function G(e,o){const r=e+"-"+o;return d.get(r)!==void 0?Promise.resolve(d.get(r)):R(e,{responseType:"image"}).then(t=>{const n=t.data,s=n.naturalWidth,i=n.naturalHeight,a=document.createElement("canvas");a.width=s,a.height=i;const l=a.getContext("2d");l.fillStyle=o,l.fillRect(0,0,s,i),l.globalCompositeOperation="destination-in",l.drawImage(n,0,0);const f=a.toDataURL();return d.put(r,f),f})}function b(e){if(!e)return null;let o=null;switch(e.type){case k:case g:case x:o=b(e.outline);break;case H:{const r=u(e.width);e.style!=null&&e.style!=="none"&&r!==0&&(o={color:e.color,style:z(e.style),width:r,cap:e.cap,join:e.join==="miter"?u(e.miterLimit):e.join},o.dashArray=j(o).join(",")||"none");break}default:o=null}return o}function j(e){if(!e?.style)return[];const{dashArray:o,style:r,width:t}=e;if(typeof o=="string"&&o!=="none")return o.split(",").map(i=>Number(i));const n=t??0,s=L.has(r)?L.get(r).map(i=>i*n):[];if(e.cap!=="butt")for(const[i,a]of s.entries())s[i]=i%2==1?a+n:Math.max(a-n,1);return s}const z=(()=>{const e={};return o=>{if(e[o])return e[o];const r=o.replaceAll("-","");return e[o]=r,r}})(),P=new c([128,128,128]),T=new c("white");function U(e){const o=e.symbolLayers?.at(-1);if(o&&"outline"in o)return o?.outline?.size}function W(e){return e?h(e)?U(e)??0:N(b(e)?.width):0}function Y(e){if(e==null||!("symbolLayers"in e)||e.symbolLayers==null)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(o=>o.type==="object");case"line-3d":return e.symbolLayers.some(o=>o.type==="path");case"polygon-3d":return e.symbolLayers.some(o=>o.type==="object"||o.type==="extrude");default:return!1}}function $(e){return e.resource?.href??""}function q(e,o){if(!e)return null;let r=null;return h(e)?r=B(e):m(e)&&(r=e.type==="cim"?w(e):e.color?new c(e.color):null),r?y(r,o):null}function B(e){const o=e.symbolLayers;if(!o)return null;let r=null;return o.forEach(t=>{t.type==="object"&&t.resource?.href||(r=t.type==="water"?t.color:t.material?t.material.color:null)}),r?new c(r):null}function y(e,o){if(o==null||e==null)return e;const r=e.toRgba();return r[3]=r[3]*o,new c(r)}function K(e,o,r){const t=e.symbolLayers;if(!t)return;const n=s=>y(o=o??s??(r!=null?T:null),r);t.forEach(s=>{if(s.type!=="object"||!s.resource?.href||o)if(s.type==="water")s.color=n(s.color);else{const i=s.material!=null?s.material.color:null,a=n(i);s.material==null?s.material=new A({color:a}):s.material.color=a,r!=null&&"outline"in s&&s.outline?.color!=null&&(s.outline.color=y(s.outline.color,r))}})}function Q(e,o,r){(o=o??e.color)&&(e.color=y(o,r)),r!=null&&"outline"in e&&e.outline?.color&&(e.outline.color=y(e.outline.color,r))}function V(e,o,r){e&&(o||r!=null)&&(o&&(o=new c(o)),h(e)?K(e,o,r):m(e)&&Q(e,o,r))}async function X(e,o){const r=e.symbolLayers;r&&await C(r,async t=>Z(t,o))}async function Z(e,o){switch(e.type){case"extrude":ee(e,o);break;case"icon":case"line":case"text":_(e,o);break;case"path":re(e,o);break;case"object":await oe(e,o)}}function _(e,o){const r=v(o);r!=null&&(e.size=r)}function v(e){for(const o of e)if(typeof o=="number")return o;return null}function ee(e,o){e.size=typeof o[2]=="number"?o[2]:0}async function oe(e,o){const{resourceSize:r,symbolSize:t}=await te(e),n=S(o,r,t);e.width=p(o[0],t[0],r[0],n),e.depth=p(o[1],t[1],r[1],n),e.height=p(o[2],t[2],r[2],n)}function re(e,o){const r=S(o,M,[e.width,void 0,e.height]);e.width=p(o[0],e.width,1,r),e.height=p(o[2],e.height,1,r)}function S(e,o,r){for(let t=0;t<3;t++){const n=e[t];switch(n){case"symbol-value":{const s=r[t];return s!=null?s/o[t]:1}case"proportional":break;default:if(n&&o[t])return n/o[t]}}return 1}async function te(e){const{computeObjectLayerResourceSize:o}=await import("./symbolLayerUtils-CPlRnYsF.js"),r=await o(e,10),{width:t,height:n,depth:s}=e,i=[t,s,n];let a=1;for(let l=0;l<3;l++){const f=i[l];if(f!=null){a=f/r[l];break}}for(let l=0;l<3;l++)i[l]==null&&(i[l]=r[l]*a);return{resourceSize:r,symbolSize:i}}function p(e,o,r,t){switch(e){case"proportional":return r*t;case"symbol-value":return o??r;default:return e}}function ne(e,o){const r=v(o);if(r!=null)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}async function se(e,o){if(e&&o)return h(e)?X(e,o):void(m(e)&&ne(e,o))}function ie(e,o,r){if(e&&o!=null)if(h(e)){const t=e.symbolLayers;t&&t.forEach(n=>{if(n.type==="object")switch(r){case"tilt":n.tilt=(n.tilt??0)+o;break;case"roll":n.roll=(n.roll??0)+o;break;default:n.heading=(n.heading??0)+o}n.type==="icon"&&(n.angle+=o)})}else m(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle+=o))}function le(e){if(!e)return null;const o=e.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return O(o)}function ae(e){return e!=null&&e.type==="polygon-3d"&&e.symbolLayers.some(o=>o.type==="extrude")}export{se as D,ie as J,le as M,ae as N,Y as a,P as b,V as c,G as f,j as g,q as h,W as m,$ as p,F as u,z as w,b as y};
