import{x as r,z as a,an as F,K as k,ae as Q,$ as uo,gx as go,eT as yo,O as mo,gz as fo,eS as vo,a0 as _o,ft as wo,Q as Mt,h$ as M,ac as bo,a9 as C,am as Mi,aW as xo,bQ as To,d4 as Oe,eC as Mo,ad as Me,b6 as Et,U as Eo,bp as Ei,aV as Co,l5 as So,T as $e,aX as Vo,bE as hn,bs as Ft,V as _e,a3 as se,L as Po,bP as oe,fI as Nt,dC as Ci,fT as Si,l as je,jS as ko,jT as Oo,a4 as L,eq as Le,fp as Lo,f4 as Ct,d5 as we,ai as Vi,eQ as Ro,c5 as Pi,d2 as un,dq as pe,kJ as Io,kK as Do,kL as Ao,j6 as Ut,aY as gn,s as zo,cW as yn,eU as Go,ao as Ho,l6 as mn,eh as fn,ci as vn,l7 as Bo,bq as Fo,l8 as _n,l9 as No,eY as Uo,ca as Zo,i6 as Wo,i7 as $o,bD as ki,f6 as jo,la as wn,lb as bn,lc as qo,ld as Xo,ew as Ko,f5 as xn,c as Yo,hG as Zt,n as St,fa as Oi,a5 as Jo,le as Qo,lf as er,lg as Li,lh as Wt,li as Ri,lj as tr,cK as ir,cL as nr,lk as Vt,ll as sr,cR as or,lm as rr,ln as ar,dO as lr,dP as cr,e1 as pr,e2 as dr,a as hr,e5 as Tn,e6 as ur,dG as Mn,lo as gr,c$ as yr,g4 as mr,d1 as fr,f3 as $t,cA as En,cz as vr,ah as qe,F as _r,ff as wr}from"./main-DnzmeE4U.js";import{u as Ii}from"./draw-store-C1_quxsr.js";import br from"./GraphicsLayer-GkJJfSu5.js";import"./intl-DLmy-Li5.js";import{a5 as xr,K as Cn,a6 as jt,a7 as Di,c as dt,a8 as Tr,a9 as Sn,a1 as Mr,aa as Er,a2 as ht,Z as ut,ab as Vn,ac as Cr,M as Sr,x as Vr,ad as Pn,ae as Pr,j as kr,B as Or,af as kn,ag as Lr,ah as Rr,ai as Ir,aj as On,o as Ln,S as Rn,ak as Dr,D as qt,C as In,al as Ar,l as Dn,am as Pt}from"./SketchViewModel-T2dNp9Tt.js";import{O as Ee,n as u,c as Re,e as Ie,a as zr,h as Gr,i as An}from"./jsxFactory-C5LxVioS.js";import{o as Xe,d as zn,f as Hr,e as Ai,g as Br}from"./globalCss-CFN4F315.js";import{o as Xt}from"./layerViewUtils-Bk5QNiAa.js";import{a as Fr,e as Gn,b as Nr}from"./widget-BgluoE6k.js";import{y as Ur}from"./diffUtils-BSe9IE26.js";import{h as Zr}from"./UpdatingHandles-DBzjq66S.js";import{l as Hn}from"./ViewingMode-CyR_b1T8.js";import{_ as Wr,m as Bn,r as $r,T as jr,e as Fn,v as qr,j as Xr,I as Kr,k as Nn}from"./vec2-BnynUbeJ.js";import{n as Ke,t as Kt,o as Yr}from"./vec2f64-CEUyUoff.js";import{o as Ye,I as zi,p as Un,s as gt,J as Gi,K as Zn,_ as yt,A as mt,g as Hi,P as Yt,y as Wn,u as ft,c as $n,Q as jn}from"./vec32-BuqRmYBM.js";import{_ as Jr,a as Qr,L as ea}from"./vec42-D8CJyqHG.js";import{n as ta,r as Bi,u as ia}from"./vec4f64-CjUMzAyX.js";import{O as Jt}from"./projection-m8vi7Cxv.js";import{c as na}from"./meshVertexSpaceUtils-BwEbYR8F.js";import{k as sa,x as Qt}from"./hydratedFeatures-BDT5zTGB.js";import{M as qn,b as oa,l as ra,V as kt,f as Xn,h as Fi,z as aa,H as la,O as Ni,k as ca}from"./plane-B_adY3_o.js";import{f as Ui,a as pa,o as da}from"./quantityUtils-RaoZoCNH.js";import{e as Zi,n as ei}from"./projectVectorToVector-D0K_S4MR.js";import{j as ha,N as ua}from"./geodesicUtils-DV-lFWtb.js";import{g as Kn,F as Yn}from"./Scheduler-Br-2v2ys.js";import{G as x}from"./geometryEngineBase-DueYg7ux.js";import{hydratedAdapter as V}from"./hydrated-Bae3cp-4.js";import{u as ga}from"./mat2d-BQA-1WB-.js";import{R as ya,L as ma}from"./quat-D8L_R4I0.js";import{e as Jn}from"./quatf64-C16JxGFv.js";import{o as fa,r as va}from"./drapedUtils-7RfmdK5D.js";import{e as Qn}from"./utils-C0LvbFCo.js";import{s as es}from"./substitute-TfjvVaWd.js";var Wi;let De=Wi=class extends Q{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,this.rings.length!==0||!e)return;const i=uo(this.radius,this.radiusUnit,"meters"),n=e.spatialReference;let s,o="geographic";if(n.isWebMercator?o="webMercator":((n.wkid&&go[n.wkid])!=null||(n.wkt2||n.wkt)&&yo(n.wkt2||n.wkt))&&(o="projected"),this.geodesic){let l;switch(o){case"webMercator":l=mo(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":l=e}s=this._createGeodesicCircle(l,i,t),o==="webMercator"&&(s=fo(s))}else{let l;o==="webMercator"||o==="projected"?l=i/vo(e.spatialReference):o==="geographic"&&(l=_o(i,"meters",wo(e.spatialReference).radius)),s=this._createPlanarCircle(e,l,t)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:n,geodesic:s}=this;return new Wi({center:e?.clone(),numberOfPoints:t,radius:i,radiusUnit:n,geodesic:s})}_createGeodesicCircle(e,t,i){const n=[],s=[e.x,e.y];for(let o=0;o<360;o+=360/i){const l=this.hasZ?[0,0,e.z??0]:[0,0];ha(l,s,o,t,Mt.WGS84),n.push(l)}return n.push(n[0]),new Q({rings:[n]})}_createPlanarCircle(e,t,i){const n=[],s=2*Math.PI/i;for(let o=0;o<i;++o){const l=s*o,c=[e.x+Math.cos(-l)*t,e.y+Math.sin(-l)*t];this.hasZ&&c.push(e.z??0),n.push(c)}return n.push(n[0]),new Q({spatialReference:e.spatialReference,rings:[n]})}};r([a({type:F})],De.prototype,"center",void 0),r([a()],De.prototype,"geodesic",void 0),r([a()],De.prototype,"numberOfPoints",void 0),r([a()],De.prototype,"radius",void 0),r([a()],De.prototype,"radiusUnit",void 0),De=Wi=r([k("esri.geometry.Circle")],De);const _a=De;function P(e){const t=Array.isArray(e)?e[0].spatialReference:e.spatialReference;return t?bo(Mt,t):Mt.WGS84}function wa(e){return x.extendedSpatialReferenceInfo(e)}function ba(e,t){return M(e),x.clip(V,P(e),e,t)}function xa(e,t){return M(e),x.cut(V,P(e),e,t)}function Ta(e,t){return M(e),M(t),x.contains(V,P(e),e,t)}function Ma(e,t){return M(e),M(t),x.crosses(V,P(e),e,t)}function ts(e,t,i){return M(e),M(t),x.distance(V,P(e),e,t,i)}function Ea(e,t){return M(e),M(t),x.equals(V,P(e),e,t)}function Ca(e,t){return M(e),M(t),x.intersects(V,P(e),e,t)}function Sa(e,t){return M(e),M(t),x.touches(V,P(e),e,t)}function Va(e,t){return M(e),M(t),x.within(V,P(e),e,t)}function Pa(e,t){return M(e),M(t),x.disjoint(V,P(e),e,t)}function ka(e,t){return M(e),M(t),x.overlaps(V,P(e),e,t)}function Oa(e,t,i){return M(e),M(t),x.relate(V,P(e),e,t,i)}function La(e){return M(e),x.isSimple(V,P(e),e)}function is(e){return M(e),x.simplify(V,P(e),e)}function Ra(e,t=!1){return x.convexHull(V,P(e),e,t)}function Ia(e,t){return M(t),x.difference(V,P(e),e,t)}function Da(e,t){return M(t),x.symmetricDifference(V,P(e),e,t)}function Aa(e,t){return M(t),x.intersect(V,P(e),e,t)}function za(e){return x.union(V,P(e),e)}function Ga(e,t,i,n,s,o){return x.offset(V,P(e),e,t,i,n,s,o)}function Ha(e,t,i,n=!1){return x.buffer(V,P(e),e,t,i,n)}function Ba(e,t,i,n,s,o){return x.geodesicBuffer(V,P(e),e,t,i,n,s,o)}function Fa(e,t,i=!0){return M(e),x.nearestCoordinate(V,P(e),e,t,i)}function Na(e,t){return M(e),x.nearestVertex(V,P(e),e,t)}function Ua(e,t,i,n){return M(e),x.nearestVertices(V,P(e),e,t,i,n)}function $i(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent?.center??null:null}function Za(e,t,i){if(e==null)throw new vt;const n=e.spatialReference;if((i=i??$i(e))==null)throw new vt;const s=e.constructor.fromJSON(x.rotate(e,t,i));return s.spatialReference=n,s}function Wa(e,t){if(e==null)throw new vt;const i=e.spatialReference;if((t=t??$i(e))==null)throw new vt;const n=e.constructor.fromJSON(x.flipHorizontal(e,t));return n.spatialReference=i,n}function $a(e,t){if(e==null)throw new vt;const i=e.spatialReference;if((t=t??$i(e))==null)throw new vt;const n=e.constructor.fromJSON(x.flipVertical(e,t));return n.spatialReference=i,n}function ja(e,t,i,n){return M(e),x.generalize(V,P(e),e,t,i,n)}function qa(e,t,i){return M(e),x.densify(V,P(e),e,t,i)}function Xa(e,t,i,n=0){return M(e),x.geodesicDensify(V,P(e),e,t,i,n)}function Ka(e,t){return M(e),x.planarArea(V,P(e),e,t)}function Ya(e,t){return M(e),x.planarLength(V,P(e),e,t)}function ns(e,t,i){return M(e),x.geodesicArea(V,P(e),e,t,i)}function ss(e,t,i){return M(e),x.geodesicLength(V,P(e),e,t,i)}function Ja(e,t){return x.intersectLinesToPoints(V,P(e),e,t)}function Qa(e,t){x.changeDefaultSpatialReferenceTolerance(e,t)}function el(e){x.clearDefaultSpatialReferenceTolerance(e)}let vt=class extends Error{constructor(){super("Illegal Argument Exception")}};const tl=Object.freeze(Object.defineProperty({__proto__:null,buffer:Ha,changeDefaultSpatialReferenceTolerance:Qa,clearDefaultSpatialReferenceTolerance:el,clip:ba,contains:Ta,convexHull:Ra,crosses:Ma,cut:xa,densify:qa,difference:Ia,disjoint:Pa,distance:ts,equals:Ea,extendedSpatialReferenceInfo:wa,flipHorizontal:Wa,flipVertical:$a,generalize:ja,geodesicArea:ns,geodesicBuffer:Ba,geodesicDensify:Xa,geodesicLength:ss,intersect:Aa,intersectLinesToPoints:Ja,intersects:Ca,isSimple:La,nearestCoordinate:Fa,nearestVertex:Na,nearestVertices:Ua,offset:Ga,overlaps:ka,planarArea:Ka,planarLength:Ya,relate:Oa,rotate:Za,simplify:is,symmetricDifference:Da,touches:Sa,union:za,within:Va},Symbol.toStringTag,{value:"Module"}));var z;(function(e){e[e.Z=0]="Z",e[e.M=1]="M"})(z||(z={}));let il=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(Ke())}pointToVector(e){return this._tag(Kt(e.x,e.y))}arrayToVector(e){return this._tag(Kt(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return Wr(n,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}distance(e,t){return Bn(e,t)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag(Yr(e))}copy(e,t){return $r(t,e)}fromXYZ(e){return this._tag(Kt(e[0],e[1]))}toXYZ(e,t=C()){return Ye(t,e[0],e[1],0)}pointToXYZ(e,t=C()){return Ye(t,e.x,e.y,0)}equals(e,t){return jr(e,t)}_tag(e){return e}},os=class{constructor(e,t){this._valueType=e,this.spatialReference=t}createVector(){return this._tag(C())}pointToVector(e){return this._tag(Mi(e.x,e.y,this._valueType===z.Z?e.z:e.m))}arrayToVector(e){return this._tag(Mi(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===z.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=this._valueType===z.Z?e[2]:void 0,t.m=this._valueType===z.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=this._valueType===z.Z?e[2]:void 0,t.m=this._valueType===z.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(!e)return;t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const i=this._valueType===z.Z,n=this._valueType===z.M;return t.x=e[0],t.y=e[1],t.z=i?e[2]:void 0,t.m=n?e[2]:void 0,t.hasZ=i,t.hasM=n,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return zi(n,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,this._valueType===z.Z&&(e[2]+=n)}distance(e,t){return this._valueType===z.Z?Un(e,t):Bn(e,t)}getZ(e,t=void 0){return this._valueType===z.Z?e[2]:t}hasZ(){return this._valueType===z.Z}getM(e,t=void 0){return this._valueType===z.M?e[2]:t}hasM(){return this._valueType===z.M}clone(e){return this._tag(xo(e))}copy(e,t){return gt(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Mi(e[0],e[1],this._valueType===z.Z?e.length>2?e[2]:t:i))}toXYZ(e,t=C()){return Ye(t,e[0],e[1],this._valueType===z.Z?e[2]:0)}pointToXYZ(e,t=C()){return Ye(t,e.x,e.y,this._valueType===z.Z?e.z??0:0)}equals(e,t){return Gi(e,t)}_tag(e){return e}},nl=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(ta())}pointToVector(e){return this._tag(Bi(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag(Bi(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new F){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return Jr(n,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,e[2]+=n}distance(e,t){return Un(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag(ia(e))}copy(e,t){return Qr(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Bi(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e,t=C()){return Ye(t,e[0],e[1],e[2])}pointToXYZ(e,t=C()){return Ye(t,e.x,e.y,e.z??0)}equals(e,t){return ea(e,t)}_tag(e){return e}};function ji(e,t,i){return e&&t?new nl(i):t?new os(z.M,i):e?new os(z.Z,i):new il(i)}function sl(e,t){if(!t.supported)return;let i=1/0,n=-1/0;const s=t.upperBoundX-t.lowerBoundX;e.forEach(l=>{let c=l.pos[0];for(;c<t.lowerBoundX;)c+=s;for(;c>t.upperBoundX;)c-=s;i=Math.min(i,c),n=Math.max(n,c),l.pos[0]=c});const o=n-i;s-o<o&&e.forEach(l=>{l.pos[0]<0&&(l.pos[0]+=s)})}function ol(e,t){const i=To(e);return t===Hn.Global&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}let Ot=class{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}},Ce=class{constructor(e,t,i){this.component=e,this.leftVertex=t,this.rightVertex=i,this.type="edge",t.rightEdge=this,i.leftEdge=this}},ti=class{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||sl(this.vertices,ol(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(this.vertices.length===0)return;const i=this.vertices[0];let n=null,s=e,o=t;do n=s,n.index=o++,s=n.rightEdge?n.rightEdge.rightVertex:null;while(s!=null&&s!==i);n.leftEdge&&n!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(n),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&this.vertices[0].leftEdge!==null}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(this.vertices.length===0)return;const t=this.vertices[0];let i=t;do e(i,i.index),i=i.rightEdge!=null?i.rightEdge.rightVertex:null;while(i!==t&&i!=null)}},ii=class to extends Oe{constructor(t,i){super(),this.type=t,this.coordinateHelper=i,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:Mo(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const t of this.components)for(const i of t.vertices)yield i}notifyChanges(t){this._dirty=!0,this.emit("change",t)}_toPoint(){return this.components.length===0||this.components[0].vertices.length===0?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const t=[],i=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[];let o=n.vertices.find(c=>c.leftEdge==null);const l=o;do s.push(i(o.pos)),o=o.rightEdge?o.rightEdge.rightVertex:null;while(o&&o!==l);t.push(s)}return new Me({paths:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const t=[],i=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[],o=n.vertices[0];let l=o;const c=l;do s.push(i(l.pos)),l=l.rightEdge!=null?l.rightEdge.rightVertex:null;while(l&&l!==c);n.isClosed()&&s.push(i(o.pos)),t.push(s)}return new Q({rings:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(t,i){const n=t.spatialReference,s=ji(t.hasZ,t.hasM,n),o=new to(t.type,s);switch(t.type){case"polygon":rl(o,t,i);break;case"polyline":al(o,t,i);break;case"point":rs(o,t,i);break;case"mesh":rs(o,t.origin,i),o._geometry=t,o._dirty=!1}return o}};function rl(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=t.rings;for(let l=0;l<o.length;++l){const c=o[l],p=new ti(n,i);p.index=l;const d=c.length>2&&Et(c[0],c[c.length-1]),h=d?c.length-1:c.length;for(let m=0;m<h;++m){const f=s.arrayToVector(c[m]),S=new Ot(p);p.vertices.push(S),S.pos=f,S.index=m}const g=p.vertices.length-1;for(let m=0;m<g;++m){const f=p.vertices[m],S=p.vertices[m+1],_=new Ce(p,f,S);p.edges.push(_)}if(d){const m=new Ce(p,p.vertices[p.vertices.length-1],p.vertices[0]);p.edges.push(m)}e.components.push(p)}}function al(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=t.paths;for(let l=0;l<o.length;++l){const c=o[l],p=new ti(n,i);p.index=l;const d=c.length;for(let g=0;g<d;++g){const m=s.arrayToVector(c[g]),f=new Ot(p);p.vertices.push(f),f.pos=m,f.index=g}const h=p.vertices.length-1;for(let g=0;g<h;++g){const m=p.vertices[g],f=p.vertices[g+1],S=new Ce(p,m,f);p.edges.push(S)}e.components.push(p)}}function rs(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=new ti(n,i);o.index=0;const l=new Ot(o);l.index=0,l.pos=s.pointToVector(t),o.vertices.push(l),e.components.push(o)}function Lt(e){return e.type==="mesh"}var Y;(function(e){e[e.NEW_STEP=0]="NEW_STEP",e[e.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"})(Y||(Y={}));let ll=class{constructor(e,t,i){this._editGeometry=e,this._component=t,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";this._addedVertex==null&&(e="apply",this._addedVertex=new Ot(this._component));const t=this._component.getLastVertex();if(t==null)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let i=null;t.rightEdge&&(this._originalEdge=t.rightEdge,i=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._left==null&&(this._left=new Ce(this._component,t,this._addedVertex)),this._component.edges.push(this._left),t.rightEdge=this._left,this._originalEdge!=null&&i!=null&&(this._right==null&&(this._right=new Ce(this._component,this._addedVertex,i)),this._component.edges.push(this._right),i.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,t.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){this._addedVertex!=null&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),this._left!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),this._right!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),this._originalEdge!=null&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),this._left!=null?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},as=class io{constructor(t,i,n){this._editGeometry=t,this._vertices=i,this.operation=n,this._undone=!1}_notifyChanges(t){this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:this._vertices})}apply(){this._vertices.forEach(t=>this.operation.apply(t)),this._notifyChanges(this._undone?"redo":"apply")}undo(){this._vertices.forEach(t=>this.operation.undo(t)),this._undone=!0,this._notifyChanges("undo")}canAccumulate(t){if(this._undone||t._vertices.length!==this._vertices.length)return!1;for(let i=0;i<t._vertices.length;++i)if(t._vertices[i]!==this._vertices[i])return!1;return this.operation.canAccumulate(t.operation)}accumulate(t){return!!(t instanceof io&&this.canAccumulate(t))&&(this._vertices.forEach(i=>this.operation.accumulate(i,t.operation)),this.operation.accumulateParams(t.operation),this._notifyChanges("apply"),!0)}};var re;(function(e){e[e.CUMULATIVE=0]="CUMULATIVE",e[e.REPLACE=1]="REPLACE"})(re||(re={}));let cl=class{constructor(e,t,i=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let e="redo";if(this.removedVertices==null){const t=this.removedVertices=[];this._vertices.forEach(i=>{const n=this._removeVertex(i);n!=null&&t.push(n)}),e="apply"}else this.removedVertices.forEach(t=>{this._removeVertex(t.removedVertex)});this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach(e=>{this._undoRemoveVertex(e)}),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},n=e.leftEdge,s=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),n&&(t.edges.splice(t.edges.indexOf(n),1),n.leftVertex.rightEdge=null),s&&(t.edges.splice(t.edges.indexOf(s),1),s.rightVertex.leftEdge=null),e.index===0&&s&&this._vertices.length>0&&t.swapVertices(t.vertices.indexOf(s.rightVertex),0),n&&s&&(i.createdEdge=new Ce(t,n.leftVertex,s.rightVertex),t.edges.push(i.createdEdge)),s&&t.updateVertexIndex(s.rightVertex,s.rightVertex.index-1),i}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,n=t.leftEdge,s=t.rightEdge;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),n&&(i.edges.push(n),n.leftVertex.rightEdge=n),s&&(i.edges.push(s),s.rightVertex.leftEdge=s),i.updateVertexIndex(t,t.index)}},pl=class{constructor(e,t,i){this._editGeometry=e,this._edge=t,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const t=this._edge,i=t.component,n=t.leftVertex,s=t.rightVertex;i.edges.splice(i.edges.indexOf(t),1),this.createdVertex==null&&(e="apply",this.createdVertex=new Ot(t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),this._left==null&&(this._left=new Ce(i,n,this.createdVertex)),this._left.leftVertex.leftEdge?i.edges.push(this._left):i.edges.unshift(this._left),n.rightEdge=this._left,this._right==null&&(this._right=new Ce(i,this.createdVertex,s)),i.edges.push(this._right),s.leftEdge=this._right,i.updateVertexIndex(this.createdVertex,n.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(this.createdVertex==null||this._left==null||this._right==null)return null;const e=this._edge,t=e.component,i=this.createdVertex.leftEdge,n=this.createdVertex.rightEdge,s=i?.leftVertex,o=n?.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),s&&(s.rightEdge=e),o&&(o.leftEdge=e),s&&t.updateVertexIndex(s,s.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},dl=class no{constructor(t,i,n){this._editGeometry=t,this._vertex=i,this._pos=n}apply(){const t=this._originalPosition==null;t&&(this._originalPosition=this._vertex.pos),this._apply(t?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(t){return t instanceof no&&t._vertex===this._vertex&&(this._pos=t._pos,this._apply("apply"),!0)}_apply(t){this._vertex.pos=this._pos,this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:[this._vertex]})}},hl=class{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(this._createdEdge==null){e="apply";const t=this._component.getFirstVertex(),i=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||t==null||i==null)return;this._createdEdge=new Ce(this._component,i,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){this._createdEdge!=null&&(Eo(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},ls=class so{constructor(t,i,n,s){this._editGeometry=t,this.dx=i,this.dy=n,this.dz=s,this._firstTime=!0}apply(){const t=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(t,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(t){const i=this._editGeometry.geometry;return t instanceof so&&t._editGeometry.geometry===i&&(this._apply("apply",t.dx,t.dy,t.dz),this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz,!0)}_apply(t,i,n,s){const o=this._editGeometry.geometry;o.offset(i,n,s);const l=this._editGeometry.components[0].getFirstVertex();if(!l)return;const c=this._editGeometry.coordinateHelper;l.pos=c.pointToVector(o.origin),this._editGeometry.notifyChanges({operation:t,updatedVertices:[l]})}},cs=class oo{constructor(t,i,n,s){this._helper=t,this.dx=i,this.dy=n,this.dz=s}_move(t,i,n,s){this._helper.addDelta(t.pos,i,n,s)}apply(t){this._move(t,this.dx,this.dy,this.dz)}undo(t){this._move(t,-this.dx,-this.dy,-this.dz)}canAccumulate(t){return t instanceof oo}accumulate(t,i){this._move(t,i.dx,i.dy,i.dz)}accumulateParams(t){this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz}},ps=class dn{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(t,i,n,s=0,o=Rt.IMMEDIATE){this._helper=t,this._planeType=i,this._edge=n,this.distance=s,this._plane=qn(),this._offsetPlane=qn(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,o===Rt.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const t=this._toXYZ(this._edge.leftVertex.pos),i=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),n=this._toXYZ(this._edge.rightVertex.pos),s=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=Zn(C(),t,n),i?(this._left=this._computeNeighbor(t,i,this._edgeDirection),this._right=this._computeNeighbor(n,s,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(n,s,this._edgeDirection),this._left=this._computeNeighbor(t,i,this._edgeDirection,this._right))}_toXYZ(t){return t!=null?this._helper.toXYZ(t):null}_pointToXYZ(t){return this._toXYZ(this._helper.pointToVector(t))}_computeNeighbor(t,i,n,s){const o=C();if(i){Zn(o,t,i);const l=!this._passesBisectingAngleThreshold(o,n);return{start:t,end:i,direction:l?this._bisectVectorsPerpendicular(n,o):o,isOriginalDirection:!l}}return this._helper.hasZ()?s&&(yt(o,n,s.direction),yt(o,o,n),mt(o,o),Math.sign(o[1])!==Math.sign(n[0])&&Hi(o,o,-1)):Ye(o,-n[1],n[0],0),{start:t,end:i,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(t,i){const n=Math.abs(oa(i,t));return n>=ds&&n<=Math.PI-ds}_bisectVectorsPerpendicular(t,i){const n=Yt(t,i)<0?t:Wn(C(),t),s=Math.abs(Yt(n,i));if(!(s<hs||s>1-hs))return this._bisectDirection(n,i);const o=yt(C(),n,[0,0,1]);return mt(o,o)}_bisectDirection(t,i){const n=ft(C(),t,i);return mt(n,n)}_initializePlane(){const t=this._computeNormalDirection(this._left),i=this._computeNormalDirection(this._right);Yt(t,i)<0&&Wn(i,i),ra(this._left.start,this._bisectDirection(t,i),this._plane)}_computeNormalDirection(t){const i=yt(C(),t.direction,this._edgeDirection);mt(i,i);const n=yt(C(),this._edgeDirection,i);return this._planeType===ni.XY&&(n[2]=0),mt(n,n)}_initializeDistanceConstraints(){this._left.end==null||this.requiresSplitEdgeLeft||this._updateDistanceConstraint(kt(this._plane,this._left.end)),this._right.end==null||this.requiresSplitEdgeRight||this._updateDistanceConstraint(kt(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(t){t<=0&&(this._minDistance=Math.max(this._minDistance,t)),t>=0&&(this._maxDistance=Math.min(this._maxDistance,t))}_updateIntersectDistanceConstraint(t){const i=Ni(t),n=this._edgeDirection,s=ft(C(),this._left.start,this._left.direction),o=ft(C(),this._right.start,this._right.direction),l=this._pointInBasis2D(Ke(),i,n,this._left.start),c=this._pointInBasis2D(Ke(),i,n,s),p=this._pointInBasis2D(Ke(),i,n,this._right.start),d=this._pointInBasis2D(Ke(),i,n,o),[h]=xr({start:c,end:l,type:Cn.LINE},{start:d,end:p,type:Cn.LINE});if(!h)return;const g=Fn(Ke(),l,c);qr(g,g);const m=Fn(Ke(),h,c),f=Xr(g,m),S=ft(C(),s,Hi(C(),this._left.direction,-f)),_=kt(t,S);this._updateDistanceConstraint(_)}_pointInBasis2D(t,i,n,s){return t[0]=Xn(i,s),t[1]=Xn(n,s),t}_offset(t,i){Number.isFinite(this._minDistance)&&(i=Math.max(this._minDistance,i)),Number.isFinite(this._maxDistance)&&(i=Math.min(this._maxDistance,i)),Fi(this._offsetPlane,this._plane),this._offsetPlane[3]-=i;const n=(o,l,c)=>l!=null&&ca(this._offsetPlane,o,ft(C(),o,l),c),s=C();(t===this._edge.leftVertex?n(this._left.start,this._left.direction,s):n(this._right.start,this._right.direction,s))&&this._helper.copy(this._helper.fromXYZ(s,void 0,this._helper.getM(t.pos)),t.pos)}selectArrowFromStartPoint(t){this._selectedArrow=aa(this.plane,this._pointToXYZ(t))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(t){return kt(this.plane,this._pointToXYZ(t))}clampedStartAndEnd(t){const i=this._helper.toXYZ(this._helper.pointToVector(t)),n=la(this._plane,i,C()),s=kt(this._plane,i),o=Ei(s,this._minDistance,this._maxDistance);return zi(i,n,i,o/s),{start:n,end:i}}apply(t){this._offset(t,this.distance)}undo(t){this._offset(t,0)}canAccumulate(t){return t instanceof dn&&this._edge.leftVertex.index===t._edge.leftVertex.index&&this._edge.rightVertex.index===t._edge.rightVertex.index&&this._edge.component===t._edge.component&&this._maybeEqualsVec3(this._left.direction,t._left.direction)&&this._maybeEqualsVec3(this._right.direction,t._right.direction)&&Gi(Ni(this._plane),Ni(t._plane))}accumulate(t,i){const n=this._plane[3]-i._plane[3]+i.distance;this._offset(t,n)}accumulateParams(t){const i=t.distance-t._plane[3];this.distance=i+this._plane[3]}clone(){const t=new dn(this._helper,this._planeType,this._edge,this.distance,Rt.DEFERRED);return Fi(t._plane,this._plane),Fi(t._offsetPlane,this._offsetPlane),t._maxDistance=this._maxDistance,t._minDistance=this._minDistance,t._left=this._cloneNeighbor(this._left),t._right=this._cloneNeighbor(this._right),t._edgeDirection=gt(C(),this._edgeDirection),t}_maybeEqualsVec3(t,i){return t==null&&i==null||t!=null&&i!=null&&Gi(t,i)}_cloneNeighbor({start:t,end:i,direction:n,isOriginalDirection:s}){return{start:gt(C(),t),end:i!=null?gt(C(),i):null,direction:gt(C(),n),isOriginalDirection:s}}};const ds=Co(15),hs=.001;var ni,Rt;(function(e){e[e.XYZ=0]="XYZ",e[e.XY=1]="XY"})(ni||(ni={})),function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(Rt||(Rt={}));let us=class ro{constructor(t,i,n=re.CUMULATIVE){this.origin=t,this.angle=i,this._accumulationType=n}_rotate(t,i){Kr(t.pos,t.pos,this.origin,i)}apply(t){this._rotate(t,this.angle)}undo(t){this._rotate(t,-this.angle)}canAccumulate(t){return t instanceof ro&&Et(this.origin,t.origin)}accumulate(t,i){const n=i._accumulationType===re.REPLACE;this._rotate(t,n?i.angle-this.angle:i.angle)}accumulateParams(t){const i=t._accumulationType===re.REPLACE;this.angle=i?t.angle:this.angle+t.angle}},gs=class ao{constructor(t,i,n,s,o=re.CUMULATIVE){this.origin=t,this.axis1=i,this.factor1=n,this.factor2=s,this._accumulationType=o,this.axis2=Kt(i[1],-i[0])}_scale(t,i,n){Nn(t.pos,t.pos,this.origin,this.axis1,i),Nn(t.pos,t.pos,this.origin,this.axis2,n)}apply(t){this._scale(t,this.factor1,this.factor2)}undo(t){this._scale(t,1/this.factor1,1/this.factor2)}canAccumulate(t){return t instanceof ao&&Et(this.origin,t.origin)&&Et(this.axis1,t.axis1)}accumulate(t,i){i._accumulationType===re.REPLACE?this._scale(t,i.factor1/this.factor1,i.factor2/this.factor2):this._scale(t,i.factor1,i.factor2)}accumulateParams(t){const i=t._accumulationType===re.REPLACE;this.factor1=i?t.factor1:this.factor1*t.factor1,this.factor2=i?t.factor2:this.factor2*t.factor2}},ul=class lo{constructor(t,i){this._editGeometry=t,this._newPositions=i}apply(){const t=this._originalPositions==null?"apply":"redo";if(!this._originalPositions){const i=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map(n=>i.clone(n.pos))}this._apply(t,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(t){return t instanceof lo&&(this._newPositions=t._newPositions,this._apply("apply",this._newPositions),!0)}_apply(t,i){const n=this._editGeometry.coordinateHelper,s=this._editGeometry.allVertices;for(let o=0;o<s.length;o++)n.copy(i[o],s[o].pos);this._editGeometry.components.forEach(o=>o.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:s})}};var ys;const gl=Symbol();let yl=class{constructor(e){this._operations=[],this._closed=!1,this[ys]=!0,e&&(this._operations=e,this._closed=!0)}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}};ys=gl;let si=class co extends Oe{constructor(t,i){super(),this.data=t,this.viewingMode=i,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",n=>{n.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:n.addedVertices,operation:n.operation}),n.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:n.removedVertices,operation:n.operation}),n.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:n.updatedVertices,operation:n.operation})})}destroy(){this._listener.remove()}splitEdge(t,i){return this._apply(new pl(this.data,t,i))}updateVertices(t,i,n=Y.ACCUMULATE_STEPS){return this._apply(new as(this.data,t,i),n)}move(t,i,n,s=Y.ACCUMULATE_STEPS){return Lt(this.data)?this._apply(new ls(this.data,t,i,n),s):this.moveVertices(this.data.allVertices,t,i,n,s)}moveVertices(t,i,n,s,o=Y.ACCUMULATE_STEPS){return Lt(this.data)?this._apply(new ls(this.data,i,n,s),o):this.updateVertices(t,new cs(this.data.coordinateHelper,i,n,s),o)}scale(t,i,n,s,o=Y.ACCUMULATE_STEPS,l=re.CUMULATIVE){return this.scaleVertices(this.data.allVertices,t,i,n,s,o,l)}scaleVertices(t,i,n,s,o,l=Y.ACCUMULATE_STEPS,c=re.CUMULATIVE){return this.updateVertices(t,new gs(i,n,s,o,c),l)}rotate(t,i,n=Y.ACCUMULATE_STEPS,s=re.CUMULATIVE){return this.rotateVertices(this.data.allVertices,t,i,n,s)}rotateVertices(t,i,n,s=Y.ACCUMULATE_STEPS,o=re.CUMULATIVE){return this.updateVertices(t,new us(i,n,o),s)}removeVertices(t){return this._apply(new cl(this.data,t,this._minNumVerticesPerType))}appendVertex(t){return this.data.components.length===0?null:this._apply(new ll(this.data,this.data.components[0],t))}setVertexPosition(t,i){return this._apply(new dl(this.data,t,i))}offsetEdge(t,i,n,s=Y.ACCUMULATE_STEPS){return this.updateVertices([i.leftVertex,i.rightVertex],new ps(this.data.coordinateHelper,t,i,n),s)}trySetGeometry(t,i=Y.ACCUMULATE_STEPS){const{data:n}=this,{coordinateHelper:s}=n;if(n.type!==t.type||!n.spatialReference.equals(t.spatialReference)||s.hasZ()!==t.hasZ||s.hasM()!==t.hasM||!So(n.geometry,t)||Lt(n))return;const o=Array.from(ii.fromGeometry(t,this.viewingMode).iterateVertices(),l=>l.pos);return this.setVertexPositions(o,i)}setVertexPositions(t,i=Y.ACCUMULATE_STEPS){return this._apply(new ul(this.data,t),i)}createResetState(){if(Lt(this.data))return this._createResetStateMesh();const t=this.data.geometry.clone();return $e(()=>this.trySetGeometry(t))}closeComponent(t){return this.data.components.includes(t)?this._apply(new hl(this.data,t)):null}canRemoveVertex(t){return t.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const t=new yl;return this._apply(t),$e(()=>t.close())}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();return t.undo(),this._redoStack.push(t),t}return null}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();return t.apply(),this._undoStack.push(t),t}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(t,i=Y.ACCUMULATE_STEPS){return i!==Y.NEW_STEP&&this.lastOperation!=null&&this.lastOperation.accumulate(t)||(t.apply(),this._undoStack.push(t),this._redoStack=[]),t}_createResetStateMesh(){if(!Lt(this.data))return $e();const t=this.data.geometry,{vertexSpace:i}=t;if(i.origin){const s=Vo(i.origin);return $e(()=>{t.vertexSpace.origin=s})}const n=t.vertexAttributes.clonePositional();return $e(()=>{t.vertexAttributes=n,t.vertexAttributesChanged()})}static fromGeometry(t,i){return new co(ii.fromGeometry(t,i),i)}};function It(e,t){return e===t||e!=null&&t!=null&&hn(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function qi(e,t,i){return e===t||e!=null&&t!=null&&hn(e.spatialReference,t.spatialReference)&&Ft(e.x,t.x,i)&&Ft(e.y,t.y,i)&&Ft(e.z??0,t.z??0,i)&&Ft(e.m??0,t.m??0,i)}var Je;(function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"})(Je||(Je={}));let ml=class{constructor(){this._isToolEditable=!0,this._manipulators=new _e,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=Je.WhenToolEditable){this.addMany([e],t)}addMany(e,t=Je.WhenToolEditable){for(const i of e){const n={manipulator:i,visibilityPredicate:t,attached:!1};this._manipulators.add(n),this._attached&&this._updateManipulatorAttachment(n)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const i=this._manipulators.splice(t,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,i=>{t(i)})}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:s,attached:o})=>{if(!o||!s.interactive)return;const l=s.intersectionDistance(e,t);l!=null&&l<n&&(n=l,i=s)}),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===Je.Always||(this._isToolEditable?e.visibilityPredicate===Je.WhenToolEditable:e.visibilityPredicate===Je.WhenToolNotEditable)}},U=class extends se{constructor(e){super(e),this.manipulators=new ml,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[Xe.MANAGER,!0],[Xe.USER,!0]]),this._creationFinishedResolver=Po()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(Xe.USER)}set editable(e){this.setEditableFlag(Xe.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===Xe.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:i})=>{i.dragging&&(t=!0,i.events.emit("drag",{action:"end",start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(Xe.USER)&&this.getEditableFlag(Xe.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};r([a({constructOnly:!0})],U.prototype,"view",void 0),r([a({readOnly:!0})],U.prototype,"active",null),r([a({value:!0})],U.prototype,"visible",null),r([a({value:!0})],U.prototype,"editable",null),r([a({readOnly:!0})],U.prototype,"manipulators",void 0),r([a({readOnly:!0})],U.prototype,"updating",null),r([a()],U.prototype,"cursor",null),r([a({readOnly:!0})],U.prototype,"automaticManipulatorSelection",void 0),r([a()],U.prototype,"hasFocusedManipulators",null),r([a()],U.prototype,"hasGrabbedManipulators",void 0),r([a()],U.prototype,"hasHoveredManipulators",void 0),r([a()],U.prototype,"firstGrabbedManipulator",void 0),r([a({readOnly:!0})],U.prototype,"created",void 0),r([a({readOnly:!0})],U.prototype,"removeIncompleteOnCancel",void 0),U=r([k("esri.views.interactive.InteractiveToolBase")],U);function fl(e,t){let i=null,n=null;return s=>{if(s.action==="cancel")return void(n!=null&&(n.execute({action:"cancel"}),i=null,n=null));const o={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};s.action==="start"&&i==null&&(i=new ri,n=new ri,t(e,i,n,s.pointerType,o)),i?.execute(o),s.action==="end"&&i!=null&&(i=null,n=null)}}function oi(e,t){return e.events.on("drag",fl(e,t))}function vl(e,t){const i=[e.x,e.y,e.z??0],n=t,s=[Math.cos(n),Math.sin(n)],o=Math.sqrt(s[0]*s[0]+s[1]*s[1]);if(o===0)return null;s[0]/=o,s[1]/=o;const l=c=>{const p=(c.x-i[0])*s[0]+(c.y-i[1])*s[1];c.x=i[0]+p*s[0],c.y=i[1]+p*s[1]};return c=>(l(c.mapStart),l(c.mapEnd),{...c,axis:s})}function ms(e){let t=null;return i=>{if(i.action==="start"&&(t=_l(e,i.mapStart.spatialReference)),t==null)return null;const n=i.mapEnd.x-i.mapStart.x,s=i.mapEnd.y-i.mapStart.y,o=(i.mapEnd.z??0)-(i.mapStart.z??0);return t.move(n,s,o,i.action),{...i,translationX:n,translationY:s,translationZ:o}}}function fs(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():Jt(e,t)}function _l(e,t){const i=e.operations;if(!i)return null;const n=i.data.geometry,s=sa(t);if(n.spatialReference.equals(s))return Xi(e,i,()=>{});if(n.type!=="mesh"){const o=fs(n,s);if(o==null)return null;const l=n.spatialReference;return Xi(e,si.fromGeometry(o,i.viewingMode),()=>{const c=Jt(n,l);i.trySetGeometry(c)})}if(na(n)){const o=fs(n.origin,s);if(!o)return null;const l=n.spatialReference,c=si.fromGeometry(o,i.viewingMode);return Xi(e,i,()=>{const p=Jt(c.data.geometry,l),d=p.x-n.origin.x,h=p.y-n.origin.y,g=(p.z??0)-(n.origin.z??0);i.move(d,h,g)})}return null}function Xi(e,t,i){let n=0,s=0,o=0;return{move:(l,c,p,d)=>{d==="start"&&(n=0,s=0,o=0);const h=l-n,g=c-s,m=p-o;t.move(h,g,m),n+=h,s+=g,o+=m,i(),d==="end"&&e.endInteraction?.()}}}function wl(e,t=null,i){let n=null;const s=t==null||e.spatialReference?.equals(t)?l=>l:l=>l!=null?Jt(l,t):l,o={exclude:[],...i};return l=>{if(l.action==="start"&&(n=s(e.toMap(l.screenStart,o))),n==null)return null;const c=s(e.toMap(l.screenEnd,o));return c!=null?{...l,mapStart:n,mapEnd:c}:null}}function bl(e){const t=e.map(i=>ms(i)).filter(oe);return i=>{const n=i.mapEnd.x-i.mapStart.x,s=i.mapEnd.y-i.mapStart.y,o=i.mapEnd.z-i.mapStart.z;return t.forEach(l=>l(i)),{...i,translationX:n,translationY:s,translationZ:o}}}function vs(e){const t=e.operations?.createResetState();return i=>(t?.remove(),i)}function xl(e){const t=e.map(i=>vs(i)).filter(i=>i!=null);return i=>(t.forEach(n=>n(i)),i)}function Tl(){let e=0,t=0,i=0;return n=>{n.action==="start"&&(e=n.mapStart.x,t=n.mapStart.y,i=n.mapStart.z);const s=n.mapEnd.x-e,o=n.mapEnd.y-t,l=n.mapEnd.z-i;return e=n.mapEnd.x,t=n.mapEnd.y,i=n.mapEnd.z,{...n,mapDeltaX:s,mapDeltaY:o,mapDeltaZ:l,mapDeltaSpatialReference:n.mapStart.spatialReference}}}function Ml(){let e=0,t=0;return i=>{i.action==="start"&&(e=i.screenStart.x,t=i.screenStart.y);const n=i.screenEnd.x-e,s=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:n,screenDeltaY:s}}}function El(e,t){let i=null,n=0,s=0;return o=>{if(o.action==="start"&&(i=e.toScreen?.(t),i!=null&&(i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(n=o.screenStart.x-i.x,s=o.screenStart.y-i.y))),i==null)return null;const l=Ei(o.screenEnd.x-n,0,e.width),c=Ei(o.screenEnd.y-s,0,e.height),p=Nt(l,c);return o.screenStart=i,o.screenEnd=p,o}}const Cl=()=>{};let ri=class po{constructor(){this.execute=Cl}next(t,i=new po){return t!=null&&(this.execute=n=>{const s=t(n);s!=null&&i.execute(s)}),i}};function _s(e,t,i=[]){if(e.type==="2d")return s=>s;let n=null;return s=>{s.action==="start"&&(n=e.toMap(s.screenStart,{exclude:i}),n!=null&&(n.z=jt(n,e,t)));const o=e.toMap(s.screenEnd,{exclude:i});o!=null&&(o.z=jt(o,e,t));const l=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...s,scenePoints:l}}}function ws(e,t,i){const n=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,s=Qt(e);return s.z=n,s.hasZ=!0,s.z=jt(s,t,i),s}function Sl(e,t){if(e.type==="2d")return n=>n;let i=null;return n=>{n.action==="start"&&(i=ws(n.mapStart,e,t));const s=ws(n.mapEnd,e,t),o=i!=null&&s!=null?{sceneStart:i,sceneEnd:s}:null;return{...n,scenePoints:o}}}let ai=class{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}},Qe=class extends se{constructor(e){super(e),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=Ci(async(t,i,n,s)=>{const o=this._frameTask;if(o==null)return;const l=await o.schedule(()=>i.snap({...t,context:n,signal:s}),s);l.valid&&await o.schedule(()=>{this.stagedPoint=l.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=i.update({...this._snapPoints,context:n}))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e=this.view.type==="3d"?this.view?.resourceController?.scheduler:null;this._frameTask=e!=null?e.registerTask(Kn.SNAPPING):Yn}destroy(){this._abortController=Si(this._abortController),this._frameTask=je(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:s}=e,o=t.update({point:n,scenePoint:s,context:i});return this.stagedPoint=o,o}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,this._abortController==null&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=Si(this._abortController),this._snapPoints=null}};r([a({constructOnly:!0})],Qe.prototype,"view",void 0),r([a()],Qe.prototype,"stagedPoint",null),r([a()],Qe.prototype,"constrainResult",void 0),r([a()],Qe.prototype,"_stagedPoint",void 0),Qe=r([k("esri.views.interactive.snapping.SnappingOperation")],Qe);function Ki(e){let t,i,n=[],s=!1;function o(...l){return s&&t===this&&Vl(l,n)||(i=e.apply(this,l),t=this,n=l,s=!0),i}return o}function Vl(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}const bs="click";let Pl=class{constructor({consumesClicks:e,grabbableForEvent:t}){this.events=new Oe,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=t}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};function kl(e,t,i,n,s,o){let l="geodesic",c=ua(i);const p=dt();return Di(e,t,n,p),p[2]=0,c&&ei(p,i,p,c)||(l="euclidean",c=i),{mode:l,view:t,elevationInfo:n,hasZ:s,directionMode:o,spatialReference:e.spatialReference,measurementSR:c,origin:p}}function Ol(e,t,i){if(t==null||e==null)return;const n=Oo(i.measurementSR);if(n==null)return;const s=li(e,i);if(s==null)return;const o=Ui(t,n);return new Er(s,o)}function Ll(e,t,i,n){if(i==null||e==null)return;const s=li(e,n);if(s==null)return;const o=ht(i),l=10,c=d=>{if(d==null)return;const h=dt(),g=da(d,"degrees","geographic");return Sr(h,s,n.measurementSR,l,g,n.mode)?new Vr(s,h):void 0},p=()=>{if(t!=null&&e!=null)return ht(Pn(t,e))};switch(n.directionMode){case ut.Absolute:return c(o);case ut.Relative:{const d=p();return d==null?void 0:c(d+o)}case ut.RelativeBilateral:{const d=p();return d==null?void 0:Vn([c(d+o),c(d-o)])}}}function xs(e,t){const i=ci(e,t);return i!=null?new Cr(i):void 0}function Ts(e,t,i){const{context:n,longitude:s,latitude:o,direction:l,distance:c,elevation:p}=i;if(s!=null||o!=null||c!=null||p!=null||l!=null){if(s!=null||o!=null){const d=ht(s),h=ht(o),g=ci(p,n);return new Sn(d,h,g)}return Rl(e,t,i)}}function Rl(e,t,{context:i,direction:n,distance:s,elevation:o}){if(t==null)return xs(o,i);const{view:l,elevationInfo:c,measurementSR:p}=i,d=Di(t,l,c);if(!p||!ei(d,t.spatialReference,Es,p))return;const[h,g]=Es,m=s!=null?Ui(s,"meters"):void 0,f=ht(n),S=ci(o,i),_=A=>{const B=new Pr([h,g],p,m,S,A);return m==null||A==null||S==null&&i.hasZ?B:new kr(B.closestTo(d))};if(f==null)return _(void 0);const K=()=>{if(e!=null&&t!=null)return ht(Pn(e,t))};switch(i.directionMode){case ut.Absolute:return _(f);case ut.Relative:{const A=K();return A==null?void 0:_(A+f)}case ut.RelativeBilateral:{const A=K();return A==null?void 0:Vn([_(A+f),_(A-f)])}}}function Il(e){return e.context.mode==="geodesic"?Ts(null,null,e):Ms(e)}function Dl(e,t,i){const{context:n,x:s,y:o,distance:l,direction:c,elevation:p}=i;return n.mode==="geodesic"?Ts(t,e,i):s!=null||o!=null?Ms(i):Al([Ol(e,l,n),Ll(e,t,c,n),xs(p,n)])}function Ms({x:e,y:t,elevation:i,context:n}){pi.x=e?.value??0,pi.y=t?.value??0,pi.spatialReference=n.spatialReference;const s=li(pi,n,Hl);return new Sn(e!=null&&s!=null?s[0]:void 0,t!=null&&s!=null?s[1]:void 0,ci(i,n))}function Al(e){let t;for(const i of e)i&&(t=t?.intersect(i)??i);return t}function li(e,t,i=dt()){const{view:n,elevationInfo:s,measurementSR:o,origin:l,mode:c}=t;if(Di(e,n,s,i),ei(i,e.spatialReference,i,o))return c!=="geodesic"&&$n(i,i,l),i}function zl(e,t,i,n){const{view:s,measurementSR:o,spatialReference:l,origin:c,mode:p}=i;if(p==="geodesic"?gt(Dt,e):ft(Dt,e,c),ei(Dt,o,Dt,l))return Tr(Dt,s,t,i,n)}function ci(e,t){return Gl(e,t)?.value??void 0}function Gl(e,{view:t,origin:i,elevationInfo:n,hasZ:s,measurementSR:o}){if(e==null||!s)return;const l=ko(o);if(l==null)return;const[c,p]=i,d=Ui(e,l),h=t?.type==="3d"?Mr(t,c,p,d,o,n):d;return h!=null?pa(h,l):void 0}const Es=dt(),Hl=dt(),Dt=dt(),pi=Zi(0,0,0,Mt.WGS84);function Cs({predicate:e=()=>!0,snappingManager:t,snappingContext:i,updatingHandles:n,useZ:s=!0}){const o=new ri;if(t==null)return{snappingStep:[Ps,o],cancelSnapping:Ps};let l,c=null,p=null,d=null;const h=()=>{c=Si(c),t.doneSnapping(),p?.frameTask.remove(),p=null,l=je(l),d=null},g=Bl(t,s,o);let m=null,f=null,S=null;return{snappingStep:[_=>{if(!e(_))return _;const{action:K}=_;if(K==="start"){const{info:A}=_,B=Fl(t.view);if(p=Nl(i,_,B),p.context.selfSnappingZ=null,!s&&A!=null){const ue=Zl(i.coordinateHelper,A.handle.component);ue!=null&&(p.context.selfSnappingZ={value:ue,elevationInfo:i.elevationInfo??Or})}}if(p!=null){const{context:A,originalScenePos:B,originalPos:ue}=p,{mapEnd:Fe,mapStart:Ne,scenePoints:ee}=_,Pe=Ss(ue,Yi(Fe,Ne)),lt=Yi(Ne,ue),y={..._,action:"update"},T=p.context,v=Ul(B,ee),R=t.update({point:Pe,scenePoint:v,context:A});if(S=R,Vs(Fe,R,lt,s),m=Pe,f=v,K!=="end"){const{frameTask:Z}=p;c==null&&(c=new AbortController),d=ce=>{n.addPromise(Le(g({frameTask:Z,event:y,context:T,point:Pe,scenePoint:v,delta:lt,getLastState:()=>({point:m,scenePoint:f,updatePoint:ce.forceUpdate?null:S})},c.signal)))},d({forceUpdate:!1}),l==null&&(l=L(()=>t.options.effectiveEnabled,()=>d?.({forceUpdate:!0})))}}return K==="end"&&h(),_},o],cancelSnapping:_=>(h(),_)}}function Bl(e,t,i){return Ci(async({frameTask:n,point:s,scenePoint:o,context:l,event:c,delta:p,getLastState:d},h)=>{const g=await n.schedule(()=>e.snap({point:s,scenePoint:o,context:l,signal:h}),h);if(g.valid){let m=await n.schedule(()=>g.apply(),h);const f=d();f.point!=null&&s!==f.point&&(m=e.update({point:f.point,scenePoint:f.scenePoint,context:l})),f.updatePoint!=null&&It(m,f.updatePoint)||(Vs(c.mapEnd,m,p,t),i.execute(c))}})}function Fl(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(Kn.SNAPPING):Yn}function Nl(e,t,i){return{context:new ai({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin!=null?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:i}}function Ss(e,[t,i,n]){const s=Qt(e);return s.x+=t,s.y+=i,s.hasZ&&(s.z+=n),s}function Ul(e,t){return e==null||t==null?null:Ss(e,Yi(t.sceneEnd,t.sceneStart))}function Yi(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function Vs(e,t,[i,n,s],o){e.x=t.x+i,e.y=t.y+n,o&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}function Zl(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const s of i){const o=e.getZ(s.pos);if(n!=null&&o!=null&&Math.abs(o-n)>1e-6)return null;n==null&&(n=o)}return n}function Ps(e){return e}const Wl="crosshair",$l="progress",ks=Symbol(),Os=Symbol();let b=class extends Oe.EventedMixin(se){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Fr,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Zr,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Ki(Il),this._getPolylineOrPolygonConstraint=Ki(Dl),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new kn,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo==null&&(this.elevationInfo=Lr(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,i=t.spatialReference,n="viewingMode"in t.state?t.state.viewingMode:Hn.Local,s=e==="segment"||e==="multipoint"?"polyline":e;this.coordinateHelper=ji(this.hasZ,this.hasM,i),this._editGeometryOperations=new si(new ii(s,this.coordinateHelper),n),this._snappingOperation=new Qe({view:t}),this.addHandles([L(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:c,constraint:p},d)=>{const{snappingOptions:h}=this;if(h&&(h.forceDisabled=p!=null&&Rr(p)),d!=null&&c===d.stagedPoint&&p!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(c??this._screenToMap(this._stagedScreenPoint))},{equals:(c,p)=>c.stagedPoint===p.stagedPoint&&Lo(c.constraint,p.constraint)}),L(()=>this.view.viewpoint,(c,p)=>{c&&p&&Ur(c,p)&&this._onKeyboardBasedChange()})]),this._activeComponent=new ti(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;o!=null&&(o.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(L(()=>this.labelOptions.enabled,c=>{o.visible=c},Ct))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],c=>{const p=c.vertices.map(f=>({componentIndex:0,vertexIndex:f.index,coordinates:this.coordinateHelper.vectorToArray(f.pos)})),d=p.map(f=>f.coordinates),h=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;It(h,this.firstVertex)||(this.firstVertex=h);const g=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;It(g,this.lastVertex)||(this.lastVertex=g);const m=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(It(m,this.secondToLastVertex)||(this.secondToLastVertex=m),this._processCursor(this.cursorVertex),c.type){case"vertex-add":this.emit(c.type,{...c,added:d,vertices:p});break;case"vertex-update":this.emit(c.type,{...c,updated:d,vertices:p});break;case"vertex-remove":this.emit(c.type,{...c,removed:d,vertices:p})}}));const l=this._manipulator=new Pl({consumesClicks:!1,grabbableForEvent:c=>this.drawingMode!=="click"||c.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(l),l.grabbable=e!=="point"&&e!=="multipoint",this.addHandles([l.events.on("immediate-click",c=>this._onImmediateClick(c)),l.events.on("immediate-double-click",c=>this._onImmediateDoubleClick(c)),L(()=>this.drawingMode,()=>{this.removeHandles(ks),this.addHandles(this._createManipulatorDragPipeline(l),ks)},Ct),L(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:c})=>{l.cursor=c},Ct)]),Ir(this,()=>{const c=this.view.inputManager.latestPointerType??"mouse",p=this._getSnappingContext(c);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,p);this._updatingHandles.addPromise(Le(d))}})}destroy(){we(this.segmentLabels),we(this._snappingOperation),this._editGeometryOperations=we(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??bs)}get effectiveCursor(){return this.loading?$l:this._hideDefaultCursor?null:this.cursor||Wl}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:i,geometryType:n}=this;return n==="polygon"&&qi(e,i)||qi(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:i}=this,n=e.slice();return t!=null&&n.push(i.pointToArray(t)),n}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){const t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:i,numCommittedVertices:n}=this,s=i==="multipoint"&&n===0||i==="polyline"&&n<2||i==="polygon"&&n<3;i!=="segment"&&i!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!s,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((o,l)=>({componentIndex:0,vertexIndex:l,coordinates:o})),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){const t=Vi(this.cursorVertex),i=Vi(e),n=i&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(i)??i),s=this._snapToClosingVertex(n),o=this._applyConstraints(s);qi(t,o)||(this._set("cursorVertex",o),this.segmentLabels?.set("stagedVertex",o!=null?this.coordinateHelper.pointToVector(o):null),o==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return oi(e,(t,i,n,s)=>{const o=s==="touch"&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:l,cancelSnapping:c}=Cs({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new ai({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:s,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next(p=>(o&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),p)).next(c),i.next(this._screenToMapDragEventStep()).next(p=>(p.action==="start"&&(this._processCursor(p.mapStart),(this.geometryType==="segment"||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),p)).next(_s(this.view,this.elevationInfo)).next(...l).next(p=>(o&&(this._processCursor(p.mapEnd),p.action==="end"&&this.commitStagedVertex()),p)).next(p=>(p.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),p))})}_createManipulatorDragPipelineFreehand(e){return oi(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(n.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this._processCursor(n.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return n})})}_createManipulatorDragPipelineHybrid(e){return oi(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Os),this._processCursor(n.mapStart),this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this._processCursor(n.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(Os),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return n})})}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:i,numCommittedVertices:n}=this;return e?t!=null||i==="segment"&&n>0:(i==="segment"||i==="polygon")&&n>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:e,coordinateHelper:t,drawSurface:i,elevationDrawSurface:n,snapToSceneEnabled:s}=this;if(n==null)return i;if(!this.hasZ)return n.defaultZ=null,n;const o=this.elevationInfo?.mode;let l=this.defaultZ,c=e||o==="absolute-height";return s!=null&&(c=s),o==="on-the-ground"&&(c=!1),this._drawAtFixedElevation&&(l=(e?this.constraintZ:null)??t.getZ(this._activeComponent.vertices[0].pos),c=!1),c?i:(n.defaultZ=l,n)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode==="click"&&e.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType==="mouse"&&e.button===2||this._manipulator.dragging))try{const{drawingMode:t,geometryType:i}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const n=this._screenToMap(e.screenPoint);if(n==null||n==null||t==="freehand"&&i!=="point"&&i!=="multipoint")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(n),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!=="mouse"&&this._processCursor(null),(t==="freehand"&&this.geometryType!=="multipoint"||i==="point"||i==="segment"&&this.numCommittedVertices===2||i==="segment"&&t==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=Nt(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){const i=this._snappingOperation,n=this._screenToMap(e),s=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(n==null)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const o=this.snappingManager;if(o==null)return this._processCursor(n),void i.abort();const l=this._getSnappingContext(t);this._updatingHandles.addPromise(Le(i.snap({point:n,scenePoint:s},o,l)))}_applyConstraints(e){const{_constraint:t,constraints:i}=this;if(!e||!i||!t)return e;const{context:n}=i,s=li(e,n),o=s?t.closestTo(s):void 0;if(!o)return e;const l=zl(o,e,n),c=this.view.type==="2d"||n.elevationInfo.mode!=="absolute-height";return l!=null&&c&&this.constraintZ!=null&&this.hasZ&&(l.z=this.constraintZ),l}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action==="start"&&(e=this._screenToMap(t.screenStart)),e==null)return null;const i=this._screenToMap(t.screenEnd);return i!=null?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return i!=null&&jl(i,t,25)}_getSnappingContext(e){const t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new ai({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t!=null?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function jl(e,t,i){const n=e.x-t.x,s=e.y-t.y;return n*n+s*s<=i}r([a()],b.prototype,"_hideDefaultCursor",void 0),r([a()],b.prototype,"_stagedPointerId",void 0),r([a()],b.prototype,"_isDragging",null),r([a()],b.prototype,"_snappingOperation",void 0),r([a()],b.prototype,"_snappingEnabled",null),r([a({constructOnly:!0})],b.prototype,"graphic",void 0),r([a()],b.prototype,"constraintsEnabled",void 0),r([a()],b.prototype,"constraints",void 0),r([a()],b.prototype,"_constraint",null),r([a()],b.prototype,"constraintZ",void 0),r([a()],b.prototype,"defaultZ",void 0),r([a()],b.prototype,"isDraped",void 0),r([a({value:bs})],b.prototype,"drawingMode",null),r([a({constructOnly:!0})],b.prototype,"elevationDrawSurface",void 0),r([a({constructOnly:!0})],b.prototype,"elevationInfo",void 0),r([a({constructOnly:!0,type:kn})],b.prototype,"labelOptions",void 0),r([a({constructOnly:!0})],b.prototype,"geometryType",void 0),r([a({constructOnly:!0})],b.prototype,"hasM",void 0),r([a({constructOnly:!0})],b.prototype,"hasZ",void 0),r([a()],b.prototype,"cursor",void 0),r([a()],b.prototype,"effectiveCursor",null),r([a()],b.prototype,"loading",void 0),r([a({constructOnly:!0})],b.prototype,"manipulators",void 0),r([a({constructOnly:!0})],b.prototype,"drawSurface",void 0),r([a({constructOnly:!0})],b.prototype,"segmentLabels",void 0),r([a({constructOnly:!0})],b.prototype,"snappingManager",void 0),r([a({constructOnly:!0})],b.prototype,"snappingVisualizer",void 0),r([a()],b.prototype,"snapToSceneEnabled",void 0),r([a({readOnly:!0})],b.prototype,"cursorVertex",null),r([a({readOnly:!0})],b.prototype,"visualizationCursorVertex",null),r([a()],b.prototype,"committableVertex",null),r([a()],b.prototype,"firstVertex",void 0),r([a()],b.prototype,"lastVertex",void 0),r([a()],b.prototype,"secondToLastVertex",void 0),r([a()],b.prototype,"updating",null),r([a({constructOnly:!0})],b.prototype,"view",void 0),b=r([k("esri.views.draw.DrawOperation")],b);let ql=class{constructor(e,t,i,n=null){this._elevationInfo=e,this.defaultZ=t,this._view=i,this._excludeGraphics=n}screenToMap(e){const{defaultZ:t,_view:i}=this,n=i.sceneIntersectionHelper.intersectElevationFromScreen(Ro(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return t==null&&n!=null&&(n.z=void 0),n}mapToScreen(e){const t=Zi(e.x,e.y,On(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){const{defaultZ:t}=this;return t!=null&&e.z!==t&&((e=Qt(e)).z=t),e}},Xl=class{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return t!=null&&(t.z=jt(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return this.elevationInfo!=null&&(t=Zi(e.x,e.y,On(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}},Kl=class{constructor(e,t=!1,i=0){this.view=e,this.hasZ=t,this.defaultZ=i,this.mapToScreen=n=>e.toScreen(n),this.screenToMap=t?n=>{const s=e.toMap(n);return s.z=i,s}:n=>e.toMap(n)}constrainZ(e){const{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=Qt(e)).z=t),e}},Ji=class ho{screenToMap(t){const{x:i,y:n}=t;return new F({x:i,y:n,spatialReference:ho.spatialReference})}mapToScreen(t){return Nt(t.x,t.y)}constrainZ(t){return t}};Ji.spatialReference=new Mt;function di(e,t,i=null){return i!=null?[e,t,i]:[e,t]}function I(e,t,i=null){return i!=null?{x:e,y:t,z:i}:{x:e,y:t}}let Ls=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(t=>this.mapToLocal(t)).filter(oe)}get doUnnormalization(){return!1}};class Rs extends Ls{constructor(t,i,n=null){super(i),this._defaultZ=n,this.transform=zn(),this.transformInv=zn(),this.transform=Hr(t),ga(this.transformInv,this.transform)}makeMapPoint(t,i){return di(t,i,this._defaultZ)}mapToLocal(t){return I(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return di(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}}let Yl=class extends Ls{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=C(),this.tangentFrameUpWS=C(),this.tangentFrameRightWS=C(),this.tangentFrameForwardWS=C(),this.localFrameRightWS=C(),this.localFrameUpWS=C(),this.worldToLocalTransform=Jn(),this.localToWorldTransform=Jn(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Pi.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Pi.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Pi.Z,this.tangentFrameForwardWS);const n=C();Hi(n,this.tangentFrameForwardWS,Yt(i,this.tangentFrameForwardWS)),$n(this.localFrameRightWS,i,n),mt(this.localFrameRightWS,this.localFrameRightWS),yt(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),ya(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),ma(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,t){return di(e,t,this.defaultZ)}mapToLocal(e){const t=C();this.view.renderCoordsHelper.toRenderCoords(new F({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),jn(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new F({spatialReference:this.view.spatialReference}));return i!=null?I(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=C();this.view.renderCoordsHelper.toRenderCoords(new F({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),jn(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new F({spatialReference:this.view.spatialReference}));return i!=null?di(i.x,i.y,this.defaultZ):null}};function Jl(e,t){if(e.type==="2d")return new Rs(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type==="3d"){const i=t.length>2?new F({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new F({x:t[0],y:t[1],spatialReference:e.spatialReference});return new Yl(e,i)}return null}const Is={absolute:"absolute-direction",relative:"relative-direction"},Ql={hide:"hide",hideChildren:"hide-children"};function hi(e){return e?.listMode??void 0}function ec(e){return e!=null&&"minScale"in e&&e.minScale!=null?e.minScale:void 0}function tc(e){return e!=null&&"maxScale"in e&&e.maxScale!=null?e.maxScale:void 0}function ic(e){if(!e)return"inherited";const t=sc(zs(e)?e.layer:e);return t!=null?t?"independent":"inherited":"visibilityMode"in e&&e.visibilityMode!=null?e.visibilityMode:"independent"}function Ds(e){if(e&&(!("type"in e)||e.type!=="wmts"))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function Qi(e){return hi(e)!==Ql.hide}function nc(e,t){if(!e||t==null||isNaN(t))return!1;const i=ec(e),n=tc(e),s=i!=null&&!isNaN(i)&&i>0&&t>i,o=n!=null&&!isNaN(n)&&n>0&&t<n;return s||o}function As(e){const t=e?.layer;return t&&"layers"in t?t.layers:null}function zs(e){return e!=null&&"layer"in e&&e.layer!=null}function sc(e){const t=oc(e);return t!=null&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}function oc(e){return e&&"capabilities"in e&&e.capabilities!=null&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}let j=class extends un.IdentifiableMixin(Ee){constructor(e,t){super(e,t),this._legend=null,this.className=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([L(()=>this._canCreateLegend,()=>this._createLegend(),pe),L(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),pe)])}destroy(){this._legend=we(this._legend)}get _canCreateLegend(){const{content:e,listItem:t}=this;if(!t)return!1;const i="legend";return e===i||e!=null&&!!Array.isArray(e)&&e.includes(i)}get _legendOptions(){const{listItem:e,_legendLayerInfo:t}=this,i=e?.view;return t&&i?{view:i,layerInfos:[t]}:{}}get _legendLayerInfo(){const e=this.listItem?.layer;if(!e||e.type==="subtype-sublayer")return null;const t=zs(e)?e:null,i=e?.parent,n=i!=null&&"type"in i&&i.type==="map-image"?t?.source:null,s="";return n&&i?{layer:i,title:s,sublayerIds:[n.mapLayerId]}:{layer:e,title:s}}get disabled(){const{listItem:e,_legend:t,content:i}=this;return!e||!(Array.isArray(i)&&i.length>1)&&!!t&&(!t.activeLayerInfos?.length||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){return this._get("title")||(this._getFirstWidget()?.label??"")}set title(e){this._override("title",e)}render(){return u("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i,open:n}=this;return e&&!i&&n?e==="legend"&&t?u("div",{key:"legend-widget"},t.render()):typeof e=="string"?u("div",{innerHTML:e,key:e}):Gn(e)?u("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?u("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:t}=this;return t?Array.isArray(e)?e.map(i=>this._renderContent(i)):this._renderContent(e):null}async _createLegend(){if(we(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:e}=await import("./Legend-C1YLx_LO.js"),t=new e(this._legendOptions);this._legend=t}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return e==="legend"?this._legend:Gn(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(t=>this._getWidget(t)).find(t=>t):this._getWidget(e)}};r([a()],j.prototype,"_legend",void 0),r([a()],j.prototype,"_canCreateLegend",null),r([a()],j.prototype,"_legendOptions",null),r([a()],j.prototype,"_legendLayerInfo",null),r([a()],j.prototype,"className",void 0),r([a()],j.prototype,"content",void 0),r([a()],j.prototype,"disabled",null),r([a()],j.prototype,"flowEnabled",void 0),r([a()],j.prototype,"icon",null),r([a()],j.prototype,"image",void 0),r([a()],j.prototype,"listItem",void 0),r([a()],j.prototype,"open",void 0),r([a()],j.prototype,"title",null),r([a()],j.prototype,"visible",void 0),j=r([k("esri.widgets.LayerList.ListItemPanel")],j);const Gs=j;var At;const rc=_e.ofType({key:"type",defaultKeyValue:"button",base:Io,typeMap:{button:Do,toggle:Ao}}),Hs=_e.ofType(rc),en="layer",ui="child-list-mode",ac="hide";let O=At=class extends un.IdentifiableMixin(se){constructor(e){super(e),this.actionsSections=new Hs,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(_e.ofType(At)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.panel=null,this.parent=null,this.view=null}initialize(){if(this.addHandles([L(()=>[this.layer,this.layer?.listMode,this.listModeDisabled],()=>this._watchLayerProperties(this.layer),pe),L(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),pe),L(()=>this.view,e=>this._updateChildrenView(e),pe),L(()=>this.panel,e=>this._setListItemOnPanel(e),pe)]),typeof this.listItemCreatedFunction=="function"){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e))&&!e.spatialReferenceSupported}get layerView(){const{layer:e,view:t}=this;if(!e||!t||e.type==="sublayer")return null;const i=e.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(n=>n.layer===i)??null}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new Gs(e):null}get sortable(){return this.layer?.type!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){const e=Ut(this,"layer.layer");return(!e||e&&Ut(this,"layer.layer.loaded"))&&Ut(this,"layer.title")||Ut(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){const{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&e.publishingInfo?.status==="publishing")}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:n}=this;return!n&&!t&&(e?e.updating:i?.loadStatus==="loading"||!1)}get visible(){return!!this.layer?.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!nc(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return ic(this.layer)}clone(){return new At({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){this.children?.forEach(t=>t.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(i=>i.view=e)}_createChildren(e){const{listModeDisabled:t,children:i}=this,n=e.filter(s=>!i.some(o=>o.layer===s));i.addMany(this._createChildItems(n,t))}_destroyChildren(e){const{children:t}=this,i=t.filter(n=>!!n.layer&&!e.includes(n.layer));t.destroyMany(i)}_sortChildren(e){this.children.sort((t,i)=>e.indexOf(i.layer)-e.indexOf(t.layer))}_destroyAllChildren(){this.removeHandles(ui),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(ui),this.listModeDisabled||this.addHandles(e.toArray().map(t=>L(()=>t.listMode,()=>this._compileChildren(e))),ui)}_compileChildren(e){const t=this.listModeDisabled?e:e?.filter(i=>hi(i)!==ac);e?.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",()=>this._compileChildren(e)),en)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map(i=>t||Qi(i)?new At({layer:i,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(oe)}_watchLayerProperties(e){if(this.removeHandles(en),this.removeHandles(ui),!e)return;if((!this.listModeDisabled&&hi(e))==="hide-children")return void this.children.destroyAll();const t=Ds(e);t&&this.addHandles(L(()=>e[t],i=>{e.hasOwnProperty(t)&&this._initializeChildLayers(i)},pe),en)}};r([a({type:Hs})],O.prototype,"actionsSections",void 0),r([a()],O.prototype,"actionsOpen",void 0),r([a()],O.prototype,"checkPublishStatusEnabled",void 0),r([a({type:_e.ofType(O)})],O.prototype,"children",void 0),r([a()],O.prototype,"childrenSortable",void 0),r([a({readOnly:!0})],O.prototype,"connectionStatus",null),r([a({readOnly:!0})],O.prototype,"error",null),r([a()],O.prototype,"hidden",void 0),r([a({readOnly:!0})],O.prototype,"incompatible",null),r([a()],O.prototype,"layer",void 0),r([a({readOnly:!0})],O.prototype,"layerView",null),r([a()],O.prototype,"listItemCreatedFunction",void 0),r([a({nonNullable:!0})],O.prototype,"listModeDisabled",void 0),r([a()],O.prototype,"open",void 0),r([a({type:Gs})],O.prototype,"panel",void 0),r([gn("panel")],O.prototype,"castPanel",null),r([a()],O.prototype,"parent",void 0),r([a({value:!0})],O.prototype,"sortable",null),r([a()],O.prototype,"title",null),r([a({readOnly:!0})],O.prototype,"publishing",null),r([a({readOnly:!0})],O.prototype,"updating",null),r([a()],O.prototype,"view",void 0),r([a()],O.prototype,"visible",null),r([a({readOnly:!0})],O.prototype,"visibleAtCurrentScale",null),r([a({readOnly:!0})],O.prototype,"visibleAtCurrentTimeExtent",null),r([a({readOnly:!0})],O.prototype,"visibilityMode",null),O=At=r([k("esri.widgets.LayerList.ListItem")],O);const tn=O;let de=class extends se{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};r([a({type:Boolean,nonNullable:!0})],de.prototype,"colorSelection",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"dynamicScaleToggle",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"gridEnabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"numericInputs",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"gridSnapEnabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"lineIntervalInput",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"outOfScaleWarning",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"placementButtons",void 0),r([a({type:Boolean,nonNullable:!0})],de.prototype,"rotateWithMapToggle",void 0),de=r([k("esri.widgets.support.GridControls.VisibleElements")],de);const nn=de;let he=class extends se{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new nn({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};r([a({type:Boolean,nonNullable:!0})],he.prototype,"enabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],he.prototype,"featureEnabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],he.prototype,"gridEnabledToggle",void 0),r([a({type:Boolean,nonNullable:!0})],he.prototype,"header",void 0),r([a({type:Boolean,nonNullable:!0})],he.prototype,"layerList",void 0),r([a({type:Boolean,nonNullable:!0})],he.prototype,"gridControls",void 0),r([a({type:nn,nonNullable:!0})],he.prototype,"gridControlsElements",void 0),r([a({type:Boolean,nonNullable:!0})],he.prototype,"layerListToggleLayersButton",void 0),r([a({type:Boolean,nonNullable:!0})],he.prototype,"selfEnabledToggle",void 0),he=r([k("esri.widgets.support.SnappingControls.VisibleElements")],he);const gi=he,sn=()=>Re({icon:()=>import("./index-Buwx-j9b.js").then(e=>e.i),label:()=>import("./index-Hni9f9UA.js"),switch:()=>import("./index-8PAcNuSr.js"),tooltip:()=>import("./index-D4Uosrk4.js")}),zt="esri-labeled-switch",Gt={label:`${zt}__label`,labelContent:`${zt}__label-content`,iconInfo:`${zt}__icon_info`,iconWarning:`${zt}__icon_warning`,tooltip:`${zt}__tooltip`};function et({checked:e,disabled:t,hint:i,key:n,label:s,onChange:o,hintIcon:l,hintKind:c}){return u("calcite-label",{class:Gt.label,disabled:t,key:n,layout:"inline-space-between",scale:"s"},i?u("div",{class:Gt.labelContent,key:"label-content"},u("div",null,s),u("calcite-icon",{class:c!=="warning"?Gt.iconInfo:Gt.iconWarning,icon:l??"information",id:n,scale:"s",tabIndex:0}),u("calcite-tooltip",{class:Gt.tooltip,overlayPositioning:"fixed",referenceElement:n},i)):s,u("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:p=>o(p.currentTarget.checked)}))}let tt=class extends se{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};r([a({type:Boolean,nonNullable:!0})],tt.prototype,"directionModePicker",void 0),r([a({type:Boolean,nonNullable:!0})],tt.prototype,"header",void 0),r([a({type:Boolean,nonNullable:!0})],tt.prototype,"labelsToggle",void 0),r([a({type:Boolean,nonNullable:!0})],tt.prototype,"tooltipsToggle",void 0),tt=r([k("esri.widgets.support.SketchTooltipControls.VisibleElements")],tt);const on=tt,Ht="esri-sketch-tooltip-controls",yi={base:Ht,block:`${Ht}__block`,blockContent:`${Ht}__block-content`,hintIcon:`${Ht}__hint-icon`,radioButtonLabelWrapper:`${Ht}__radio-button-label-wrapper`};let Ae=class extends Ee{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new on,this.sketchOptions=new Ln,this.viewType=void 0,this._onTooltipsEnabledChange=i=>{this.sketchOptions.tooltips.enabled=i},this._onLabelsEnabledChange=i=>{this.sketchOptions.labels.enabled=i},this._onDirectionModeChange=i=>{this.sketchOptions.values.directionMode=i.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([Re({block:()=>import("./index-J94OCPzp.js"),label:()=>import("./index-Hni9f9UA.js"),icon:()=>import("./index-Buwx-j9b.js").then(e=>e.i),"radio-button":()=>import("./index-DjLe4PDK.js"),"radio-button-group":()=>import("./index-GmJqqGd6.js")}),sn()])}render(){const{label:e,visibleElements:t}=this,i=this._renderContent();return u("div",{"aria-label":e,class:this.classes(yi.base,Ai.widget)},i?u("calcite-block",{class:yi.block,heading:t.header?this.label:"",key:"content-block",label:this.label,open:!0},u("div",{class:yi.blockContent,key:"content"},i)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){const{visibleElements:e,viewType:t}=this,i=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&t!=="2d"?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(oe);return i.length===0?null:i}_renderTooltipsToggle(){const{messages:e,sketchOptions:t}=this;return u(et,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,sketchOptions:t}=this;return u(et,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:e,sketchOptions:t}=this,{directionMode:i}=t.values;return u("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,u("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:i,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",i,e.directionModeRelative),this._renderDirectionModeOption("absolute",i,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,i){return u("calcite-label",{key:e,layout:"inline",scale:"s"},u("calcite-radio-button",{checked:e===t,scale:"s",value:e}),u("div",{class:yi.radioButtonLabelWrapper,key:"label-wrapper"},u("calcite-icon",{icon:Is[e],scale:"s"}),i))}};r([a()],Ae.prototype,"label",null),r([a({type:on,nonNullable:!0})],Ae.prototype,"visibleElements",void 0),r([a(),Ie("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],Ae.prototype,"messages",void 0),r([a({nonNullable:!0,type:Ln})],Ae.prototype,"sketchOptions",void 0),r([a({type:String})],Ae.prototype,"viewType",void 0),Ae=r([k("esri.widgets.support.SketchTooltipControls")],Ae);const lc=Ae,ge={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},cc="hide",Bs=_e.ofType(tn);let be=class extends Oe.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new Bs,this.view=null}initialize(){this.addHandles([L(()=>this.view?.ready===!0,()=>this._viewHandles(),pe),L(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),L(()=>Qn(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],ge.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,n){const s=e?.layer;if(!s||s.type==="subtype-sublayer"||s.type==="sublayer")return;const o=this.view?.map?.layers,l=t?As(t):o,c=i?As(i):o;if(!l||!c)return;const{operationalItems:p}=this,d=t?.children||p,h=i?.children||p,g=c.length-n;e.parent=i||null,d.remove(e),l.remove(s),h.includes(e)||h.add(e,g),c.includes(s)||c.add(s,g),this._compileList()}_createLayerViewHandles(e){this.removeHandles(ge.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),ge.layerViews)}_createMapLayerHandles(e){this.removeHandles(ge.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),ge.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:n,listModeDisabled:s}=this;return new tn({checkPublishStatusEnabled:n,listModeDisabled:s,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>hi(t)!==cc):void 0}_watchLayersListMode(e){this.removeHandles(ge.layerListMode),e&&!this.listModeDisabled&&this.addHandles(L(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),ge.layerListMode)}_compileList(){const e=this.view?.map?.layers,t=Qn(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:n})=>n==="link-chart"):e;this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.some(n=>n.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach(n=>{n&&e&&e.includes(n.layer)||i.push(n)}),t.destroyMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,n)=>{const s=e.indexOf(i.layer),o=e.indexOf(n.layer);return s>o?-1:s<o?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([ge.mapLayers,ge.layerViews,ge.viewLayers]),e?.ready?this.addHandles([L(()=>this.view?.map?.allLayers,t=>this._createMapLayerHandles(t),pe),L(()=>this.view?.allLayerViews,t=>this._createLayerViewHandles(t),pe)],ge.viewLayers):this._removeAllItems()}};r([a()],be.prototype,"checkPublishStatusEnabled",void 0),r([a()],be.prototype,"listItemCreatedFunction",void 0),r([a({nonNullable:!0})],be.prototype,"listModeDisabled",void 0),r([a({type:Bs})],be.prototype,"operationalItems",void 0),r([a({readOnly:!0})],be.prototype,"state",null),r([a()],be.prototype,"totalItems",null),r([a()],be.prototype,"view",void 0),be=r([k("esri.widgets.LayerList.LayerListViewModel")],be);const pc=be,rn=e=>dc(e)||hc(e),dc=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},hc=e=>{const t=Ds(e);if(t!=null&&e.hasOwnProperty(t)&&e[t]!=null){for(const i of e[t])if(rn(i))return!0}return!1},mi=(e,t)=>t!=null&&e!=null&&(t.test(e.title)?"self":!!e.children.some(i=>mi(i,t)!==!1)&&"children");var an;let Se=an=class extends tn{constructor(e){super(e),this.children=new _e,this.parent=null}get enabled(){const{children:e}=this;if(e.length===0)return this.featureSource!=null&&this.featureSource.enabled?"enabled":"disabled";let t=!1,i=!1;for(const n of e){if(n.enabled==="indeterminate")return n.enabled;if(n.enabled==="enabled"?t=!0:n.enabled==="disabled"&&(i=!0),i&&t)return"indeterminate"}return i?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>[e.layer?.id,...e.childLayerIds])}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find(i=>i.layer===e)}_initializeChildLayers(e){if(!e)return;const t=e.filter(rn);super._initializeChildLayers(t)}_createChildItems(e){return e.map(t=>Qi(t)?new an({layer:t,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(oe).reverse()}};r([a()],Se.prototype,"enabled",null),r([a()],Se.prototype,"children",void 0),r([a()],Se.prototype,"childLayerIds",null),r([a()],Se.prototype,"featureSource",null),r([a({constructOnly:!0})],Se.prototype,"getFeatureSnappingSources",void 0),r([a()],Se.prototype,"parent",void 0),Se=an=r([k("esri.widgets.support.SnappingControls.SnappingListItem")],Se);let it=class extends pc{constructor(){super(...arguments),this.featureSnappingSources=new _e}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>!e.children?.length)}_compileList(){const e=this.view?.map?.layers;if(!e)return;const t=e.filter(rn);this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createListItem(e){return new Se({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};r([a()],it.prototype,"featureSnappingSources",void 0),r([a()],it.prototype,"operationalItems",void 0),r([a()],it.prototype,"operationalItemsFlat",null),r([a()],it.prototype,"selectableItems",null),it=r([k("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],it);let xe=class extends se{constructor(e){super(e),this.layerListViewModel=new it,this.snappingOptions=new Rn,this.view=null}initialize(){this.addHandles([L(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},pe),L(()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources}),({viewModel:e,sources:t})=>{e.featureSnappingSources=t},pe)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>e.enabled==="enabled")}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>!e.enabled)}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter(e=>e.enabled==="enabled").length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach(i=>t?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{const i=t?.id;e?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i)})}enableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)Qi(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){const t=this.layerListViewModel.operationalItemsFlat.find(n=>n.layer?.id===e)?.layer;if(!t)throw new zo("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if(t.type==="group")return;const i=new Dr({layer:t});return this.snappingOptions.featureSources.add(i),i}};r([a()],xe.prototype,"allLayersEnabled",null),r([a()],xe.prototype,"allLayersDisabled",null),r([a({constructOnly:!0})],xe.prototype,"layerListViewModel",void 0),r([a()],xe.prototype,"layersEnabledCount",null),r([a({type:Rn,nonNullable:!0})],xe.prototype,"snappingOptions",void 0),r([a()],xe.prototype,"state",null),r([a()],xe.prototype,"view",void 0),xe=r([k("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],xe);const uc=xe,ye="esri-snapping-controls",me={base:ye,container:`${ye}__container`,item:`${ye}__item`,toggleBlock:`${ye}__toggle-block`,layerListBlock:`${ye}__layer-list-block`,layerList:`${ye}__layer-list`,layerListFilter:`${ye}__layer-list__filter`,layerListButton:`${ye}__layer-list__button`,layerListItem:`${ye}__layer-list__item`,layerListGroup:`${ye}__layer-list__group`,nestedContainer:`${ye}__nested-container`};let N=class extends Ee{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new gi,this._enableSnappingSwitchChange=o=>{this.snappingOptions.enabled=o},this._featureEnabledSwitchChange=o=>{this.snappingOptions.featureEnabled=o},this._gridEnabledSwitchChange=o=>{this.snappingOptions.gridEnabled=o,o&&this._startLoadGrid()},this._selfEnabledSwitchChange=o=>{this.snappingOptions.selfEnabled=o},this._onToggleLayersButtonClick=o=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),zr(o.target)};const{snappingOptions:i,view:n,viewModel:s}=e;this.viewModel=s??(this._defaultViewModel=new uc({snappingOptions:i,view:n}))}normalizeCtorArgs(e){const{snappingOptions:t,view:i,viewModel:n,...s}=e;return s}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=we(this._defaultViewModel))}loadDependencies(){return Promise.all([Re({block:()=>import("./index-J94OCPzp.js"),button:()=>import("./index-BUYNV2Id.js"),input:()=>import("./index-DBbiKKfA.js"),list:()=>import("./index-CWPudE9o.js"),"list-item":()=>import("./index-CDdEHo-w.js"),checkbox:()=>import("./index-CGKRKPuM.js"),loader:()=>import("./index-Cezzb5s0.js")}),sn()])}initialize(){this.addHandles(L(()=>this.view?.type==="2d"&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=we(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return u("div",{"aria-label":e,class:this.classes(me.base,Ai.widget)},u("div",{class:me.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),this.view?.type==="2d"&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:t}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&t?.type==="2d"?this._renderGridEnabledToggle():null].filter(oe),n=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?u("div",{class:me.nestedContainer},i):null].filter(oe);return n.length===0?null:u("calcite-block",{class:me.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",label:this.label,open:!0},n)}_renderEnabledToggle(){return u(et,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return u(et,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return u(et,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return u(et,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,i=t.layerListViewModel.operationalItems.length>9?u("calcite-input",{class:me.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:l}})=>{this._layerListFilter=l===""?null:new RegExp(l,"i")}}):null,n=this._secondaryElementsDisabled,s=this.layerListOpen&&!n,o=t.layerListViewModel.operationalItems?.find(l=>!!l.children.length);return u("calcite-block",{class:me.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,heading:e.snappingLayers,key:"list-block",open:s,onCalciteBlockToggle:l=>this.layerListOpen=l.currentTarget.open},i,this._renderToggleLayersButton(),u("calcite-list",{class:me.layerList,displayMode:o?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){const{view:e,visibleElements:t,snappingManager:i,snappingOptions:n,_openAndReady:s}=this,{gridEnabled:o,enabled:l}=n;(s||e?.type==="2d"&&e.grid)&&this._startLoadGrid();const c=this._gridLoadTask?.value,p=c&&e?.type==="2d"&&u(c,{snappingManager:i,snappingOptions:n,view:e,visibleElements:t.gridControlsElements});return u("calcite-block",{class:me.layerListBlock,collapsible:!0,disabled:!o||!l,heading:this.messages.gridOptionsHeading,key:"grid-block",open:s,onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},p??u("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}async _startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&this.view?.type==="2d"&&(this._gridLoadTask=yn(async()=>(await import("./GridControls-CEUIsZ2n.js")).default))}_renderLayerListItemCollection(e){const t=this._layerListFilter;return e.map(i=>{switch(t?mi(i,t):null){case"children":{const n=i.children.filter(s=>mi(s,t)!==!1);return this._renderLayerListItemGroup(i,n)}case"self":case null:return this._renderLayerListItemOrGroup(i);case!1:return mi(i.parent,t)==="self"?this._renderLayerListItemOrGroup(i):null}}).toArray().filter(oe)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return u("calcite-button",{appearance:"transparent",class:me.layerListButton,label:i,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},i)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,i=e.title||t,n=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],e.enabled!=="enabled")};return u("calcite-list-item",{class:me.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:i,onCalciteListItemSelect:s=>{s.stopPropagation(),n()}},u("calcite-checkbox",{checked:e.enabled==="enabled",slot:"actions-start",onCalciteCheckboxChange:n}))}_renderLayerListItemGroup(e,t){const{messages:i}=this,{children:n,title:s}=e,o=s||i.untitledLayer,l=s&&s!==""?s:Go(),c=!!t?.length,p=t??n,d=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,e.enabled!=="enabled")},h=p?.find(g=>!!g.children.length);return u("calcite-list-item",{class:me.layerListGroup,key:l,label:o,open:c,onCalciteListItemSelect:g=>{g.stopPropagation(),d()}},u("calcite-checkbox",{checked:e.enabled==="enabled",indeterminate:e.enabled==="indeterminate",slot:"actions-start",onCalciteCheckboxChange:d}),u("calcite-list",{displayMode:h?"nested":"flat",label:i?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(p)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};r([a()],N.prototype,"_defaultViewModel",void 0),r([a()],N.prototype,"_layerListFilter",void 0),r([a()],N.prototype,"_gridLoadTask",void 0),r([a()],N.prototype,"_openAndReady",null),r([a()],N.prototype,"label",null),r([a({type:Boolean,nonNullable:!0})],N.prototype,"layerListOpen",void 0),r([a({type:Boolean,nonNullable:!0})],N.prototype,"gridOptionsOpen",void 0),r([a(),Ie("esri/widgets/support/SnappingControls/t9n/SnappingControls")],N.prototype,"messages",void 0),r([a(),Ie("esri/t9n/common")],N.prototype,"messagesCommon",void 0),r([a()],N.prototype,"snappingOptions",null),r([a()],N.prototype,"snappingManager",void 0),r([a()],N.prototype,"view",null),r([a()],N.prototype,"viewModel",null),r([a({type:gi,nonNullable:!0})],N.prototype,"visibleElements",void 0),r([a()],N.prototype,"_enabledToggleDisabled",null),r([a()],N.prototype,"_secondaryElementsDisabled",null),N=r([k("esri.widgets.support.SnappingControls")],N);const gc=N;let ae=class extends se{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1}};r([a({type:Boolean,nonNullable:!0})],ae.prototype,"point",void 0),r([a({type:Boolean,nonNullable:!0})],ae.prototype,"polyline",void 0),r([a({type:Boolean,nonNullable:!0})],ae.prototype,"polygon",void 0),r([a({type:Boolean,nonNullable:!0})],ae.prototype,"rectangle",void 0),r([a({type:Boolean,nonNullable:!0})],ae.prototype,"circle",void 0),r([a({type:Boolean,nonNullable:!0})],ae.prototype,"multipoint",void 0),r([a({type:Boolean,nonNullable:!0})],ae.prototype,"mesh",void 0),r([a({type:Boolean,nonNullable:!0})],ae.prototype,"freehandPolyline",void 0),r([a({type:Boolean,nonNullable:!0})],ae.prototype,"freehandPolygon",void 0),ae=r([k("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],ae);let nt=class extends se{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};r([a({nonNullable:!0})],nt.prototype,"rectangle-selection",void 0),r([a({nonNullable:!0})],nt.prototype,"lasso-selection",void 0),r([a({nonNullable:!0})],nt.prototype,"custom-selection",void 0),nt=r([k("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],nt);let q=class extends se{constructor(e){super(e),this.createTools=new ae,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new nt,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new gi,this.tooltipsToggle=!0,this.undoRedoMenu=!0}};r([a({type:ae,nonNullable:!0})],q.prototype,"createTools",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"directionModePicker",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"duplicateButton",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"deleteButton",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"selectionCountLabel",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"labelsToggle",void 0),r([a({type:nt,nonNullable:!0})],q.prototype,"selectionTools",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"settingsMenu",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"snappingControls",void 0),r([a({type:gi,nonNullable:!0})],q.prototype,"snappingControlsElements",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"tooltipsToggle",void 0),r([a({type:Boolean,nonNullable:!0})],q.prototype,"undoRedoMenu",void 0),q=r([k("esri.widgets.Sketch.VisibleElements")],q);const X={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},Fs={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function Ns(e,t){return e.vnodeSelector===t?[e]:e.children?.flatMap(i=>Ns(i,t))??[]}const ln=e=>{let t=class extends e{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(i){const n=this._get("measurementManager");i!==n&&(n&&n.managedElements.remove(this),this._set("measurementManager",i),i?.managedElements.add(this))}set budgetedLength(i){this.budgetedLength!==i&&(this._set("budgetedLength",i),this.scheduleRender())}get actionChildren(){return this.children?.flatMap(i=>Ns(i,"calcite-action"))??[]}get activeChildElement(){const i=this.actionChildren.find(n=>n.properties?.active===!0);return i?(this._set("lastActiveKey",i.properties?.key),i):this.lastActiveKey?this.actionChildren.find(n=>n.properties?.key===this.lastActiveKey):void 0}_handleClick(i){i?.dataset&&"dataset"in i&&i.dataset.actionKey&&(this.lastActiveKey=i.dataset.actionKey)}};return r([a()],t.prototype,"priority",void 0),r([a()],t.prototype,"measurementManager",null),r([a()],t.prototype,"budgetedLength",null),r([a()],t.prototype,"actionChildren",null),r([a()],t.prototype,"activeChildElement",null),r([a()],t.prototype,"scale",void 0),r([a()],t.prototype,"slot",void 0),r([a()],t.prototype,"lastActiveKey",void 0),r([a()],t.prototype,"layout",void 0),t=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],t),t},Us=Symbol("on-resize-handle-key");let st=class extends ln(Ee){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return[this.layout==="horizontal"?this._measuredWidth:this._measuredHeight]}render(){return u("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles(Gr(this._measuredElement,()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0}),Us)},afterRemoved:()=>this.removeHandles(Us)},this.children)}};r([a()],st.prototype,"_measuredWidth",void 0),r([a()],st.prototype,"_measuredHeight",void 0),r([a()],st.prototype,"lengthOptions",null),r([a()],st.prototype,"_measuredElement",void 0),st=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],st);const yc=st;let ze=class extends ln(Ee){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return Re({action:()=>import("./index-CytjfAQD.js"),"action-group":()=>import("./index-KqP5VmvP.js").then(e=>e.i),"action-menu":()=>import("./index-VtdpGf3k.js").then(e=>e.i)})}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?X.groupSeparator+X.action[t]*Math.min(e.length,2):X.groupSeparator+X.action[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:i,allowCollapse:n,priority:s}=this,o=[i];if(e.length<=2||!n||s<1)return o;for(let l=1;l<e.length-1;l++)o.push(i+X.action[t]*l);return o}render(){if(!this.actionChildren.length)return u(An,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:i,layout:n,slot:s,scale:o}=this,l=Math.floor(e/X.action[o]),c=[],p=[];if(l>=t.length)c.push(...t);else{const d=i??c.at(0);if(c.push(...t.slice(0,l-1)),p.push(...t.slice(l-1)),d&&p.includes(d)){const[h]=p.splice(p.indexOf(d),1),g=c.pop();c.push(h),g&&p.unshift(g)}}return u("calcite-action-group",{key:"overflow-button-group",layout:n,onclick:d=>this._handleClick(d.target),slot:s},c.map(d=>this._renderManagedAction(d)),p.length>0?u("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},u("calcite-action",{icon:Fs.overflow,key:"split-button-dropdown-trigger",scale:o,slot:"trigger",text:this.messagesCommon.more}),p.map(d=>this._renderManagedAction(d))):void 0)}_renderManagedAction(e){return u("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};ze.vnodeSelector="calcite-action-group",r([a()],ze.prototype,"allowCollapse",void 0),r([a()],ze.prototype,"minimumLength",null),r([a(),Ie("esri/t9n/common")],ze.prototype,"messagesCommon",void 0),r([a()],ze.prototype,"lengthOptions",null),ze=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],ze);const mc=ze;let Ge=class extends se{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new _e,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((e,t)=>t.priority-e.priority)}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:i}=this;let n=0;for(const s of i){const o=s.lengthOptions[0];e.set(s,o),n+=o}for(const s of i)for(;n<t;){const o=e.get(s);if(!o)break;const l=s.lengthOptions.find(p=>p>o);if(!l)break;const c=n-o+l;if(c>t)break;e.set(s,l),n=c}for(const[s,o]of e)s.budgetedLength=o}_measure(){const e=this.measuredElement;this.availableLength=e?this.layout==="horizontal"?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};r([a()],Ge.prototype,"measuredElement",void 0),r([a()],Ge.prototype,"managedElements",void 0),r([a()],Ge.prototype,"_sortedElements",null),r([a()],Ge.prototype,"availableLength",void 0),r([a()],Ge.prototype,"layout",void 0),Ge=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],Ge);const fc=Ge,vc={base:"esri-split-button",splitButtonBase:"esri-split-button--split-part"};let ot=class extends ln(Ee){constructor(e){super(e),this.messagesCommon=null}loadDependencies(){return Re({action:()=>import("./index-CytjfAQD.js"),"action-group":()=>import("./index-KqP5VmvP.js").then(e=>e.i),"action-menu":()=>import("./index-VtdpGf3k.js").then(e=>e.i)})}get minimumLength(){const e=this.actionChildren;return e.length?e.length===1?X.action[this.scale]+X.groupSeparator:X.action[this.scale]+X.splitButtonPart[this.layout][this.scale]+X.groupSeparator:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:i,scale:n,priority:s}=this;if(e.length<2||s<0)return[t];const o=X.groupSeparator+X.action[n]*e.length;return[X.groupSeparator+X.action[n]+X.splitButtonPart[i][n],o]}render(){if(!this.actionChildren.length)return u(An,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:i,layout:n,slot:s}=this,o=e.length<2||i>t;return u("calcite-action-group",{key:"split-button-group",layout:n,onclick:l=>this._handleClick(l.target),slot:s},o?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:i,scale:n,messagesCommon:s}=this,o=e??i.at(0);if(!o)return;const l=i.filter(c=>c!==o);return[this._renderManagedAction(o),u("calcite-action-menu",{key:"split-button-dropdown",label:s.more,overlayPositioning:"fixed",placement:t==="horizontal"?"bottom-end":"right-end"},u("calcite-action",{class:`${vc.splitButtonBase}--${t}--${this.scale}`,compact:t==="horizontal",icon:Fs.splitButton[t],key:"split-button-dropdown-trigger",scale:n,slot:"trigger",text:s.more}),l?.map(c=>this._renderManagedAction(c)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){return u("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};ot.vnodeSelector="calcite-action-group",r([a()],ot.prototype,"minimumLength",null),r([a()],ot.prototype,"lengthOptions",null),r([a(),Ie("esri/t9n/common")],ot.prototype,"messagesCommon",void 0),ot=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],ot);const fe="esri-responsive-toolbar",ve={rulerBase:`${fe}__ruler`,rulerBarHorizontal:`${fe}__ruler--bar`,rulerBarVertical:`${fe}__ruler--bar--vertical`,rulerPadVertical:`${fe}__ruler--pad--vertical`,rulerPadHorizontal:`${fe}__ruler--pad--horizontal`,bar:`${fe}__bar`,barHorizontal:`${fe}__bar--horizontal`,barVertical:`${fe}__bar--vertical`,pad:`${fe}__pad`,padVertical:`${fe}__pad--vertical`,padHorizontal:`${fe}__pad--horizontal`};let He=class extends Ee{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new fc,this._managedWidgets=new Map}loadDependencies(){return Re({"action-bar":()=>import("./index-f5siJR3U.js"),"action-pad":()=>import("./index-DK_RfN06.js")})}destroy(){this._measurementManager=we(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}render(){const{layout:e,scale:t,barStyle:i}=this,n={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},s=i==="docked"?e==="vertical"?ve.rulerBarVertical:ve.rulerBarHorizontal:e==="horizontal"?ve.rulerPadHorizontal:ve.rulerPadVertical;return u("div",null,u("div",{afterCreate:o=>{this._measurementManager?.connect(o)},class:this.classes(ve.rulerBase,s)}),i==="docked"?u("calcite-action-bar",{...n,classes:{[ve.barHorizontal]:this.layout==="horizontal",[ve.barVertical]:this.layout==="vertical",[ve.bar]:!0},overflowActionsDisabled:!0},this._renderChildren()):u("calcite-action-pad",{...n,class:this.classes(ve.pad,e==="horizontal"?ve.padHorizontal:ve.padVertical)},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter(n=>n.properties?.key!==void 0&&"group-kind"in n.properties),t=new Set,i=e.map(n=>{const s=n.properties,o=s.key;t.add(o);const l=this.barStyle==="docked"?s.slot??void 0:void 0,c=s.priority??0,p=s["group-kind"]??"overflow-group",d=s["allow-collapse"]??!0,h=this._managedWidgets.get(o);if(h)return h.children=n.children,h.priority=c,"allowCollapse"in h&&(h.allowCollapse=d),h.slot=l,h.layout=this.layout,h.scale=this.scale,h.measurementManager=this._measurementManager,h;const g={scale:this.scale,priority:c,measurementManager:this._measurementManager,children:n.children,slot:l,layout:this.layout};switch(p){case"split-button":{const m=new ot({...g});return this._managedWidgets.set(o,m),m}case"overflow-group":{const m=new mc({...g,allowCollapse:d});return this._managedWidgets.set(o,m),m}case"measured-content":{const m=new yc({...g});return this._managedWidgets.set(o,m),m}}}).filter(oe);return Array.from(this._managedWidgets.keys()).filter(n=>!t.has(n)).forEach(n=>{this._managedWidgets.get(n)?.destroy(),this._managedWidgets.delete(n)}),this._measurementManager?.allocate(),i.map(n=>n.render())}};r([a()],He.prototype,"scale",void 0),r([a({value:"horizontal"})],He.prototype,"layout",null),r([a()],He.prototype,"barStyle",void 0),r([a()],He.prototype,"_measurementManager",void 0),r([a()],He.prototype,"_managedWidgets",void 0),He=r([k("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],He);const Zs=He;function rt(e,t){const i=new F({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function _c(e,t){return new Ho({points:e,spatialReference:t})}function wc(e,t,i){const n=new Me({paths:e,spatialReference:t});return i&&mn(n),n}function Bt(e,t,i,n=!0){const s=Vi(e);s.forEach(l=>{const c=l[0],p=l[l.length-1];Et(c,p)&&l.length!==1||l.push(l[0])});let o=new Q({rings:s,spatialReference:t});return o.rings.forEach(l=>{fn(l)||l.reverse()}),i&&mn(o),n&&o.isSelfIntersecting&&vn(t)&&(o=is(o)),o}function Ws(e,t,i){const n=t.mapToLocalMultiple(e),s=[],o={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y},c=Math.round(l.x-o.x),p=Math.round(l.y-o.y),d=Math.max(Math.abs(c),Math.abs(p));if(i){const h={x:o.x+d,y:o.y+d},g={x:o.x-d,y:o.y-d};s.push(I(h.x,g.y),I(g.x,g.y),I(g.x,h.y),I(h.x,h.y))}else{const h={x:c>0?o.x+d:o.x-d,y:p>0?o.y+d:o.y-d};s.push(I(o.x,o.y),I(h.x,o.y),I(h.x,h.y),I(o.x,h.y))}return js(Bt([s.map(h=>t.localToMap(h)).filter(oe)],t.spatialReference,t.doUnnormalization,!0),s,t)}function $s(e,t,i){let n=t.mapToLocalMultiple(e);if(n.length===1){const c=n[0];n=[I(c.x-48,c.y+48),I(c.x+48,c.y-48),I(c.x+48,c.y-48),I(c.x-48,c.y+48)]}const s=[],o={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y};if(i){const c=Math.round(l.x-o.x),p=Math.round(l.y-o.y);s.push(I(o.x-c,o.y-p),I(l.x,o.y-p),I(l.x,l.y),I(o.x-c,l.y))}else s.push(I(o.x,o.y),I(l.x,o.y),I(l.x,l.y),I(o.x,l.y));return js(Bt([s.map(c=>t.localToMap(c)).filter(oe)],t.spatialReference,t.doUnnormalization,!0),s,t)}function js(e,t,i){const n=fi(t[3],t[2],i),s=fi(t[1],t[2],i),o=fi(t[0],t[1],i),l=fi(t[0],t[3],i);return{geometry:e,midpoints:n!=null&&s!=null&&o!=null&&l!=null?{top:n,right:s,bottom:o,left:l}:null}}function fi(e,t,i){_t[0]=e.x,_t[1]=e.y,_t[2]=0,wt[0]=t.x,wt[1]=t.y,wt[2]=0,zi(_t,_t,wt,.5),vi.x=_t[0],vi.y=wt[1],vi.z=wt[2];const n=i.localToMap(vi);return n!=null?rt(n,i.spatialReference):null}const vi=I(0,0,0),_t=C(),wt=C();function qs(e,t,i,n){const s=t.mapToLocalMultiple(e);let o=null,l=null;if(i)o=s[0],l=s[1];else{const S=s[0],_=s[1],K=Math.round(_.x-S.x),A=Math.round(_.y-S.y),B=Math.max(Math.abs(K),Math.abs(A));o=I(K>0?S.x+B/2:S.x-B/2,A>0?S.y+B/2:S.y-B/2),l=I(Math.abs(K)>Math.abs(A)?o.x-B/2:o.x,Math.abs(K)>Math.abs(A)?o.y:o.y-B/2)}const c=t.localToMap(o),p=t.localToMap(l);if(c==null||p==null)return null;t.doUnnormalization&&Bo([[c,p]],t.spatialReference);const d=rt(c,t.spatialReference),h=rt(p,t.spatialReference),g=Fo(t.spatialReference);let m=0;if(vn(t.spatialReference))m=g*ts(d,h,null);else{const S=o.x-l.x,_=o.y-l.y;m=g*Math.sqrt(S*S+_*_)*(n||1)}const f=new _a({center:d,radius:m,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:Bt(f.rings,f.spatialReference,!1),center:d,edge:h}}function Xs(e,t,i){const n=t.mapToLocalMultiple(e),s=n[0],o=n[1],l=Math.round(o.x-s.x),c=Math.round(o.y-s.y),p=I(i?s.x:s.x+l/2,i?s.y:s.y+c/2),d=i?l:l/2,h=i?c:c/2,g=60,m=[],f=2*Math.PI/g;function S(ee){const Pe=Math.cos(ee),lt=Math.sin(ee);return I(d*Pe+p.x,h*lt+p.y)}for(let ee=0;ee<g;ee++)m.push(S(ee*f));m.push(m[0]);const{spatialReference:_,doUnnormalization:K}=t,A=Bt([m.map(ee=>t.localToMap(ee)).filter(oe)],_,K,!1),B=t.localToMap(S(Math.PI/2)),ue=t.localToMap(S(0)),Fe=t.localToMap(S(-Math.PI/2)),Ne=t.localToMap(S(Math.PI));return{geometry:A,midpoints:B!=null&&ue!=null&&Fe!=null&&Ne!=null?{top:rt(B,_),right:rt(ue,_),bottom:rt(Fe,_),left:rt(Ne,_)}:null}}let J=class extends se{constructor(e){super(e),this.coordinates=void 0,this.strokeDash=[],this.strokeWidth=1,this.strokeColor=[0,0,0,1],this.strokeDashColor=[255,255,255,1],this.fillColor=[0,0,0,0],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){const e=this.strokeColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _strokeBackgroundStyle(){const e=this.strokeDashColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _fillStyle(){const e=this.fillColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _renderCoordinates(){const e=[];if(!this.coordinates)return{coordinates:e,rect:_n};const t=No(Uo(Zo(_n),this.coordinates),2*this.strokeWidth);t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]+.5),t[3]=Math.ceil(t[3]+.5);for(const i of this.coordinates)e.push([Math.floor(i[0]-t[0])+.5,Math.floor(i[1]-t[1])+.5]);return e.reverse(),{coordinates:e,rect:t}}render(){const{coordinates:e,rect:t}=this._renderCoordinates,i=Wo(t),n=$o(t);return u("div",{classes:{"esri-outline-overlay-item":!0},styles:{left:t[0]+"px",top:t[1]+"px",width:i+"px",height:n+"px",visibility:this.visible?"visible":"hidden"}},u("svg",{height:n,styles:{display:"block"},width:i},u("polygon",{fill:this._fillStyle,points:e.map(([s,o])=>`${s},${o}`).join(" "),stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),u("polygon",{fill:"transparent",points:e.map(([s,o])=>`${s},${o}`).join(" "),stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.length?this.strokeDash.join(" "):void 0,"stroke-width":this.strokeWidth})))}renderCanvas(){}};r([a()],J.prototype,"coordinates",void 0),r([a()],J.prototype,"strokeDash",void 0),r([a()],J.prototype,"strokeWidth",void 0),r([a()],J.prototype,"strokeColor",void 0),r([a()],J.prototype,"strokeDashColor",void 0),r([a()],J.prototype,"fillColor",void 0),r([a()],J.prototype,"visible",void 0),r([a()],J.prototype,"isDecoration",void 0),r([a({readOnly:!0})],J.prototype,"_strokeStyle",null),r([a({readOnly:!0})],J.prototype,"_strokeBackgroundStyle",null),r([a({readOnly:!0})],J.prototype,"_fillStyle",null),r([a({readOnly:!0})],J.prototype,"_renderCoordinates",null),J=r([k("esri.views.overlay.OutlineOverlayItem")],J);const bc=J;let le=class extends Oe.EventedMixin(U){constructor(e){super(e),this._overlayItem=void 0,this.geometryType=null,this.mode=null,this.type="draw-screen"}initialize(){this.drawOperation=this._makeDrawOperation();const e=t=>this.drawOperation.on(t,i=>{this._updateVisuals(),this.emit(t,i)});this.addHandles([e("vertex-add"),e("vertex-remove"),e("vertex-update"),e("cursor-update"),e("complete")]),this.finishToolCreation()}destroy(){this.drawOperation=we(this.drawOperation),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centeredToggled(e){this._set("centeredToggled",e),this._updateVisuals()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set uniformSizeToggled(e){this._set("uniformSizeToggled",e),this._updateVisuals()}get updating(){return this.drawOperation?.updating??!1}get cursor(){return this.geometryType==="point"?"default":"crosshair"}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}undo(){this.drawOperation.undo()}reset(){}_makeDrawOperation(){const{view:e}=this;return new b({view:e,manipulators:this.manipulators,geometryType:xc(this.geometryType),drawingMode:this.mode,hasZ:!1,defaultZ:0,snapToSceneEnabled:!1,drawSurface:new Ji,hasM:!1,snappingManager:null,snappingVisualizer:null,graphic:null,cursor:this.cursor})}get coordinates(){const{drawOperation:e}=this;if(!e?.geometryIncludingUncommittedVertices.length)return[];const{coordinateHelper:t}=e,i=e.committableVertex,n=e.committedVertices.slice();i!=null&&n.push(t.pointToArray(i));const s=n.length;switch(this.geometryType){case"circle":case"rectangle":{const o=new Rs(Br,Ji.spatialReference),l=this.geometryType==="circle"?qs:Ws,c=this.geometryType==="circle"?Xs:$s;if(s===1&&e.isCompleted){const p=n[0],d=o.makeMapPoint(p[0]+Tc,p[1]);return l([p,d],o,!0)?.geometry.rings[0]??[]}if(s===2){const p=this.geometryType!=="rectangle",d=this.centeredToggled!==p,h=this.geometryType!=="rectangle";return(this.uniformSizeToggled!==h?l(n,o,d)?.geometry.rings[0]:c(n,o,d)?.geometry.rings[0])??[]}return[]}}return n}_updateVisuals(){if(!this._overlayItem){const e=new bc({strokeDash:[5],strokeDashColor:[255,255,255,255]});this.view.overlay?.addItem(e),this.addHandles($e(()=>{this.view.overlay?.removeItem(e),e?.destroy(),this._overlayItem=void 0})),this._overlayItem=e}this._overlayItem.coordinates=this.coordinates}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}};function xc(e){switch(e){case"polygon":case"point":return e;case"circle":case"rectangle":return"segment"}}r([a({value:!1})],le.prototype,"centeredToggled",null),r([a()],le.prototype,"drawOperation",void 0),r([a({value:!0})],le.prototype,"enabled",null),r([a({value:!1})],le.prototype,"uniformSizeToggled",null),r([a({constructOnly:!0})],le.prototype,"geometryType",void 0),r([a({constructOnly:!0})],le.prototype,"mode",void 0),r([a({readOnly:!0})],le.prototype,"type",void 0),r([a({readOnly:!0})],le.prototype,"updating",null),r([a({constructOnly:!0,nonNullable:!0})],le.prototype,"view",void 0),r([a()],le.prototype,"cursor",null),le=r([k("esri.views.draw.DrawScreenTool")],le);const Tc=48;async function Mc(){return import("./geometryEngineJSON-CGn_tfx8.js").then(e=>e.g)}async function Ec(){return Mc().then(({contains:e,intersects:t,overlaps:i,simplify:n})=>({contains:e,intersects:t,overlaps:i,simplify:n}))}async function Cc(e){const{currentSelection:t,selector:i,signal:n,sources:s,view:o}=e;if(!s?.length)return{added:[],removed:[]};const{layers:l,layerViews:c,graphicsLayers:p}=kc(s),d=(await ki(Promise.all([Vc(i,l,o,n),Pc(i,c,o,n),Sc(i,p,o)]),n)).flat();if(!t)return{added:d,removed:[]};const h=t.toArray(),g=d.filter(f=>!Ys(h,f)),m=h.filter(f=>!Ys(d,f));return t.removeMany(m),t.addMany(g),{added:g,removed:m}}const Sc=async(e,t,i)=>Ic({candidates:t.flatMap(n=>n.graphics.toArray())??[],selector:e,view:i}),Vc=async(e,t,i,n)=>{const s=await Le(Lc({selector:e,signal:n,layers:t,view:i}));return s?Ks(s):[]},Pc=async(e,t,i,n)=>{const s=await Le(Oc({selector:e,signal:n,layerViews:t,view:i}));return s?Ks(s):[]};function Ks(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i];n.status==="fulfilled"&&t.push(...n.value)}return t}function kc(e){const t=[],i=[],n=[];return e.forEach(s=>{jo(s)?t.push(s):(wn(s)||bn(s))&&s.layers?.length?t.push(...s.layers.toArray()):qo(s)&&s.sublayers?.length?n.push(...s.sublayers.toArray()):Xo(s)?n.push(s):Xt(s)&&i.push(s)}),{layers:t,layerViews:i,graphicsLayers:n}}function Ys(e,t){if(e.includes(t))return!0;const i=t.getObjectId(),n=i!=null,{layer:s,uid:o}=t;return n?e.some(l=>{if(s===l.layer)return i===l.getObjectId()}):e.some(l=>{if(s===l.layer)return o===l.uid})}async function Oc(e){const{layerViews:t,selector:i,signal:n,view:s}=e;return ki(Promise.allSettled(t.map(async o=>{const l=o.createQuery(),{geometry:c}=Js(i,o.layer,s);return l.outFields=["*"],l.geometry=c,l.returnGeometry=!0,l.outSpatialReference=s.spatialReference,o.queryFeatures(l,{signal:n}).then(({features:p})=>p)})),n)}async function Lc(e){const{layers:t,selector:i,signal:n,view:s}=e;return ki(Promise.allSettled(t.map(async o=>o.queryFeatures(Rc(o.createQuery(),i,o,s),{signal:n}).then(({features:l})=>l))),n)}function Js(e,t,i){const n="renderer"in t?fa({renderer:t.renderer}):0,s=e.type==="point"?va(e,n,i):e,o="displayField"in t?t.displayField:null,l=Ko({displayField:o,fields:t.fields}),c=[t.objectIdField];if(l!=null&&t.fieldsIndex.has(l)&&c.push(l),"globalIdField"in t&&t.globalIdField!=null&&t.fieldsIndex.has(t.globalIdField)&&c.push(t.fieldsIndex.get(t.globalIdField).name),xn(t)&&t.subtypeField!=null&&t.fieldsIndex.has(t.subtypeField)&&c.push(t.fieldsIndex.get(t.subtypeField).name),"utilityNetworks"in i.map&&i.map.utilityNetworks?.length&&(xn(t)||t.type==="feature")){const p=t.fieldsIndex.get("assetgroup"),d=t.fieldsIndex.get("assettype");p?.name&&c.push(p.name),d?.name&&c.push(d.name)}return{geometry:s,outFields:c}}function Rc(e,t,i,n){const{outFields:s,geometry:o}=Js(t,i,n);return e.outFields=s,e.geometry=o,e.returnGeometry=!0,e.outSpatialReference=n.spatialReference,e}async function Ic(e){const{selector:t,candidates:i,view:n}=e;if(!i?.length||!t)return[];const{spatialReference:s}=n,o=t,l=await Ec();return i.filter(c=>c.geometry&&c.geometry.type!=="mesh"&&l.intersects(s,o,c.geometry))}const Dc=100;let at=class extends Oe.EventedAccessor{constructor(e){super(e),this._processTask=null,this.options=null,this.selection=new _e,this.sources=null,this._process=Ci(async(t,i)=>{const{callback:n,selector:s,completed:o}=t,l=yn(async c=>{const{options:p,sources:d,selection:h,view:g}=this;if(!(!d?.length&&!g?.selectionManager.sources.length)&&g){if(s&&d!=null){const m=await Cc({currentSelection:h,selector:s,signal:c,sources:d,view:g});o&&p?.persistSelection!==!1&&g.selectionManager?.updateSelection({current:h.toArray(),...m})}n&&n()}else h.removeAll()});return Yo(i,()=>l.abort()),this._processTask=l,l.promise},Dc)}initialize(){this._setup()}cancel(){this.removeAllHandles(),this._processTask?.abort()}async _setup(){const{view:e}=this;if(await e.whenReady(),this.destroyed)return;const t=this.options,i=t?.createTool??"rectangle",n=t?.mode??(i==="polygon"?"click":"hybrid"),s=Symbol();this._tool=new le({view:e,mode:n,geometryType:i}),t?.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>Le(this._process({selector:this._selectionArea}))),s),this.addHandles([e.on("key-down",o=>{if(!o.repeat)switch(o.key){case qt.constraint:this._tool.uniformSizeToggled=!0,o.stopPropagation();break;case qt.center:this._tool.centeredToggled=!0,o.stopPropagation()}}),e.on("key-up",o=>{switch(o.key){case qt.constraint:this._tool.uniformSizeToggled=!1,o.stopPropagation();break;case qt.center:this._tool.centeredToggled=!1,o.stopPropagation()}}),this._tool.on("complete",async o=>{this.removeHandles(s);const l=()=>{this.removeAllHandles(),this.emit("complete",{aborted:o.aborted,selection:this.selection.toArray()})};o.aborted?(this.cancel(),this.selection.removeAll(),l()):await this._process({selector:this._selectionArea,callback:l,completed:!0})})],s),this.addHandles($e(()=>e.tools.remove(this._tool))),e.addAndActivateTool(this._tool)}get _selectionArea(){const e=Nt(),t=this._tool.coordinates,i=this.view.spatialReference,n=o=>{e.x=o[0],e.y=o[1];const{x:l,y:c}=this.view.toMap(e);return[l,c]};if(t.length===0)return;if(t.length===1||t.every(([o,l])=>o===t[0][0]&&l===t[0][1])){const[o,l]=n(t[0]);return new F({x:o,y:l,spatialReference:i})}const s=t.map(n);if(s.length!==0)return fn(s)||s.reverse(),new Q({spatialReference:i,rings:[s]})}};r([a()],at.prototype,"options",void 0),r([a({readOnly:!0})],at.prototype,"selection",void 0),r([a()],at.prototype,"sources",void 0),r([a({constructOnly:!0})],at.prototype,"view",void 0),at=r([k("esri.widgets.support.Selector2D.SelectionOperation")],at);const Ac=at;let Te=class extends Oe.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.layerViewPreferenceEnabled=!0,this.sources=null}initialize(){this.addHandles([L(()=>this._sources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this._operationHandlesGroup=je(this._operationHandlesGroup)}get _sources(){const{layerViewPreferenceEnabled:e,sources:t,view:i}=this;return i&&t?.length?t.flatMap(n=>{if(Xt(n))return n;if(wn(n)||bn(n)){const o=n.layers||[],l=o.map(c=>{const p=In(i,c)||void 0;return e&&Xt(p)?p:c});return l.length?l.toArray():o.length?o.toArray():n}if(!e)return n;const s=In(i,n)||void 0;return Xt(s)?s:n}):[]}get layers(){return Zt(St.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){Zt(St.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){const{_sources:e,view:t}=this,i=!e?.length&&!t?.selectionManager.sources.length;return this.activeOperation?"active":t?.ready&&!i?"ready":"disabled"}cancel(){this.state==="active"&&(this.activeOperation?.cancel(),this._set("activeOperation",null))}activate(e){const{_sources:t,state:i,view:n}=this,s=!t?.length&&!n?.selectionManager.sources.length;if(i==="disabled"||s||!this.view)return;i==="active"&&this.cancel();const o=new Ac({view:this.view,sources:t,options:e});return this._operationHandlesGroup=Oi([o.selection.on("change",l=>this.emit("selection-change",l)),o.once("complete",l=>this._onOperationComplete(l))]),this._set("activeOperation",o),o}_onOperationComplete(e){this._operationHandlesGroup=je(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e)}};r([a()],Te.prototype,"_sources",null),r([a({readOnly:!0})],Te.prototype,"activeOperation",void 0),r([a()],Te.prototype,"layers",null),r([a()],Te.prototype,"layerViewPreferenceEnabled",void 0),r([a()],Te.prototype,"sources",void 0),r([a({readOnly:!0})],Te.prototype,"state",null),r([a()],Te.prototype,"view",void 0),Te=r([k("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],Te);const zc=Te,Qs={lassoTool:!0,rectangleTool:!0},cn="esri-selection-toolbar",pn={base:cn,container:`${cn}__container`,toolButton:`${cn}__tool-button`};let H=class extends Ee{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.defaultLassoToolOptions={createTool:"polygon",mode:"freehand"},this.defaultRectangleToolOptions={createTool:"rectangle"},this.messages=null,this.toolConfigs=[],this.viewModel=new zc,this.visibleElements={...Qs},this.scale="s",this.layout="horizontal",this._viewModelHandlesGroup=Oi([this.viewModel.on("complete",i=>{this._set("activeToolInfo",null),this.emit("complete",i)})])}destroy(){this._viewModelHandlesGroup=je(this._viewModelHandlesGroup)}loadDependencies(){return Re({action:()=>import("./index-CytjfAQD.js")})}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return Zt(St.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){Zt(St.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...Qs,...e}}get state(){return this.viewModel.state}get visibleToolCount(){const{view:e,toolConfigs:t,visibleElements:i}=this;return(t?.length??0)+(e?.type==="2d"?(i.lassoTool?1:0)+(i.rectangleTool?1:0):0)}activate(e){if(this.cancel(),this.state!=="disabled")switch(e){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return u("div",{"aria-label":this.label,class:this.classes(pn.base,Ai.widget)},u("div",{class:pn.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){if(this.view?.type==="2d")return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){if(this.toolConfigs?.length)return this.toolConfigs.map(({toolName:e,icon:t,toolKey:i})=>this._renderToolWithTooltip(e,i,t))}_renderLassoTool(){const{messages:e,visibleElements:t}=this;if(!t.lassoTool)return;const i=e.selectByLasso;return this._renderToolWithTooltip("lasso","lasso","lasso-select",i)}_renderRectangleTool(){const{messages:e,visibleElements:t}=this;if(!t.rectangleTool)return;const i=e.selectByRectangle;return this._renderToolWithTooltip("rectangle","rectangle","cursor-marquee",i)}_renderToolWithTooltip(e,t,i,n=e){const s=`${this.id}-tool-${t}`;return u("calcite-action",{active:this.activeToolInfo?.toolName===e,bind:this,class:pn.toolButton,disabled:this.state==="disabled",icon:i||"selection",id:s,key:s,onclick:()=>this._toggleTool(e),scale:this.scale,text:n,title:n})}_activateTool(e){const t=this._getToolOptions(e);if(!t)return;const i=this.viewModel.activate(t);i&&this._set("activeToolInfo",{toolName:e,operation:i})}_toggleTool(e){if(this.activeToolInfo){const t=this.activeToolInfo.toolName;if(this.cancel(),t===e)return}this._activateTool(e)}_getToolOptions(e){return e==="lasso"?this.defaultLassoToolOptions:e==="rectangle"?this.defaultRectangleToolOptions:this.toolConfigs.find(t=>t.toolName===e)}};r([a({readOnly:!0})],H.prototype,"activeToolInfo",void 0),r([a()],H.prototype,"defaultLassoToolOptions",void 0),r([a()],H.prototype,"defaultRectangleToolOptions",void 0),r([a()],H.prototype,"label",null),r([a()],H.prototype,"layers",null),r([a()],H.prototype,"layerViewPreferenceEnabled",null),r([a(),Ie("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],H.prototype,"messages",void 0),r([a()],H.prototype,"sources",null),r([a()],H.prototype,"toolConfigs",void 0),r([a()],H.prototype,"view",null),r([a()],H.prototype,"viewModel",void 0),r([a()],H.prototype,"visibleElements",void 0),r([gn("visibleElements")],H.prototype,"castVisibleElements",null),r([a()],H.prototype,"scale",void 0),r([a()],H.prototype,"state",null),r([a()],H.prototype,"layout",void 0),r([a()],H.prototype,"visibleToolCount",null),H=r([k("esri.widgets.support.SelectionToolbar")],H);const Gc=H,Be="esri-sketch",Ve={base:Be,vertical:`${Be}--vertical`,docked:`${Be}-bar`,floating:`${Be}-pad`,chipHorizontal:`${Be}__selection-count-chip--horizontal`,chipVertical:`${Be}__selection-count-chip--vertical`,chipVerticalSmall:`${Be}__selection-count-chip--vertical--s`,popoverWrapper:`${Be}__popover-wrapper`},Hc={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3-d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let E=class extends Ee{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new q,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new Dn({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,i=new Gc({view:t?.type==="2d"?t:null,sources:e?[e]:null,scale:this.scale});this.addHandles([L(()=>this.viewModel,n=>{this._viewModelHandlesGroup=je(this._viewModelHandlesGroup),n&&(this._viewModelHandlesGroup=Oi([n.on("create",()=>this.scheduleRender()),n.on("update",()=>this.scheduleRender()),n.on("delete",s=>this.emit("delete",s)),n.on("undo",()=>this.scheduleRender()),n.on("redo",()=>this.scheduleRender()),L(()=>n.layer,s=>{this._selectionToolbar&&(this._selectionToolbar.sources=s?[s]:null)}),L(()=>n.view,s=>{this._selectionToolbar&&(this._selectionToolbar.view=s?.type==="2d"?s:null)}),L(()=>n.state,()=>this.notifyChange("state"))]))},Ct),Jo(()=>i.activeToolInfo,()=>this.viewModel.cancel()),i.on("complete",n=>this._onSelectionOperationComplete(n)),L(()=>{const{selectionTools:n}=this.visibleElements;return{lassoTool:!!n?.["lasso-selection"],rectangleTool:!!n?.["rectangle-selection"]}},n=>{Object.assign(i.visibleElements,n)},Ct)]),this._selectionToolbar=i}loadDependencies(){return Re({action:()=>import("./index-CytjfAQD.js"),chip:()=>import("./index-BxtEfqZ2.js"),popover:()=>import("./index-B-rP10qG.js").then(e=>e.i)})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=je(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeToolInfo;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:i,activeCreateToolDrawMode:n}=this.viewModel;return i==="polygon"&&n==="freehand"&&t?.includes("freehandPolygon")?"freehandPolygon":i==="polyline"&&n==="freehand"&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&we(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:i}=this,n=e?.filter(s=>!!i.createTools?.[s]);return t?.type==="3d"?n?.filter(s=>s!=="multipoint"):n}create(e,t,i){const n=i?.createOptions??t;return this._activeCustomToolOptions=i,Le(this.viewModel.create(e,n))}update(e,t){return Le(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:i}=this,n=this.customActions?.filter(s=>s.position==="selection-toolbar");return u("div",null,u("div",{classes:{[Ve.base]:!0,[Ve.floating]:e==="floating",[Ve.docked]:e==="docked",[Ve.vertical]:t==="vertical"}},u(Zs,{barStyle:e,layout:t,scale:i},this._renderSelectionSetItemGroupInline(),u("div",{"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??Pt.Low},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),n?.map(s=>this._renderToolbarItem(s))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:i,viewModel:n,visibleElements:s}=this;if(!this._calcitePopoverReferenceElement)return;const o={directionModePicker:s.directionModePicker,labelsToggle:s.labelsToggle,tooltipsToggle:s.tooltipsToggle},l=this.layout==="horizontal"?this._relativeLocation==="top"?"bottom-end":"top-end":"right-end";return u("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:l,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:c=>this._remeasurePopoverSizes(c.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},u("div",{class:Ve.popoverWrapper},Object.values(o).includes(!0)?u(lc,{sketchOptions:n.sketchOptions,viewType:i?.type,visibleElements:new on(o)}):void 0,s.snappingControls&&i&&t?u(gc,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:i,visibleElements:s.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if(this.contextualToolLocation!=="separate")return;const e=this._renderSelectionSetItemGroup();return e?.length?u(Zs,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return this.contextualToolLocation==="separate"?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return u("div",{"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??Pt.Medium,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],t=[];this.customActions?.forEach(n=>{n.position==="settings-before"?t.push(n):n.position==="settings-after"&&e.push(n)});const i=[...t.map(n=>this._renderToolbarItem(n)),this._renderSettingsMenuButton(),...e.map(n=>this._renderToolbarItem(n))].filter(oe);if(i.length)return u("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??Pt.Max,slot:"actions-end"},i)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e=this.contextualToolLocation==="inline-end"?"actions-end":void 0,t=this.customActions?.filter(s=>s.position==="before-selection-set"),i=this.customActions?.filter(s=>s.position==="after-selection-set"),n=this.groupCollapsePriorities?.get("selectionSet")??Pt.High;return[u("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:n,slot:e},this._renderFeatureCountChip()),u("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:n,slot:e},t?.map(s=>this._renderToolbarItem(s)),this._renderDuplicateButton(),this._renderDeleteButton(),i?.map(s=>this._renderToolbarItem(s)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:t==="ready"})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap(i=>this._renderBuiltInCreateToolItem(i))??[],t=this.customToolOptions?.flatMap(i=>this._renderCustomToolItem(i))??[];return u("div",{"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??Pt.High},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:Hc[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:i,id:n,updateGraphics:{length:s}}=this,o=es(t.selectedCount,{count:s}),l=i==="s"?99:999,c=s>l?es(t.selectedCountTruncated,{truncated:l}):s,p=i==="s"&&e==="vertical",d=p?`${n}-selection-chip-small`:`${n}-selection-chip`;return[p?u("span",{classes:{[Ve.chipVertical]:!0,[Ve.chipVerticalSmall]:this.scale==="s"},id:d,tabIndex:0,title:o},c):u("calcite-chip",{appearance:"outline",class:e==="horizontal"?Ve.chipHorizontal:Ve.chipVertical,id:d,kind:"brand",label:o,scale:i==="l"?"m":"s",tabIndex:0,title:e==="vertical"?o:void 0},e==="vertical"?c:o)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:i,disabled:n,onclick:s,active:o,flipRTL:l,afterCreate:c,afterUpdate:p,afterRemoved:d}){const h=`${this.id}-${e}`;return[u("calcite-action",{active:o,afterCreate:c,afterRemoved:d,afterUpdate:p,bind:this,"data-testid":e,disabled:n||this.state==="disabled",icon:i,iconFlipRtl:l??!1,id:h,key:e,onclick:s,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,i=this?.view?.container?.getBoundingClientRect(),n=t?.style;if(!(t&&i&&n&&this.view?.container?.contains(t)))return;const s=this._calcitePopoverReferenceElement;if(!s)return;const{bottom:o,top:l}=s.getBoundingClientRect();if(this.layout==="horizontal"){const p=o<i.height/2;p!==(this._relativeLocation==="top")&&(this._relativeLocation=p?"top":"bottom"),p?(n?.setProperty("--sketch-view-height-offset",o-i.top+"px"),n?.setProperty("--sketch-view-margin-offset","30px")):(n?.setProperty("--sketch-view-height-offset",i.bottom-l+"px"),n?.setProperty("--sketch-view-margin-offset","15px"))}else this.layout==="vertical"&&(n.setProperty("--sketch-view-height-offset","15px"),n.setProperty("--sketch-view-margin-offset","15px"));const c=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;n.setProperty("--sketch-popover-header-offset",`${c}px`)}catch(t){St.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",t)}}_activateCreateTool(e,t,i){const n=this._activeCustomToolOptions;if(i||n){if(i?.toolKey===n?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,i)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;t!=="transform"&&t!=="reshape"||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const n=t.tool,s=i.length>1&&n==="reshape"?"transform":n;this.update(i,{...t,tool:s})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};r([a()],E.prototype,"_activeCustomToolOptions",void 0),r([a()],E.prototype,"activeTool",null),r([a({readOnly:!0})],E.prototype,"activeTooltip",null),r([a({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return e.filter(i=>t.has(i))}})],E.prototype,"availableCreateTools",void 0),r([a({readOnly:!0})],E.prototype,"createGraphic",null),r([a()],E.prototype,"creationMode",null),r([a()],E.prototype,"customToolOptions",void 0),r([a()],E.prototype,"customActions",void 0),r([a()],E.prototype,"defaultCreateOptions",null),r([a()],E.prototype,"defaultUpdateOptions",null),r([a()],E.prototype,"icon",null),r([a()],E.prototype,"label",null),r([a()],E.prototype,"labelOptions",null),r([a()],E.prototype,"layer",null),r([a({type:["horizontal","vertical"],value:"horizontal"})],E.prototype,"layout",null),r([a({value:"m"})],E.prototype,"scale",null),r([a()],E.prototype,"toolbarKind",void 0),r([a()],E.prototype,"contextualToolLocation",void 0),r([a()],E.prototype,"groupCollapsePriorities",void 0),r([a(),Ie("esri/widgets/Sketch/t9n/Sketch")],E.prototype,"messages",void 0),r([a(),Ie("esri/t9n/common")],E.prototype,"messagesCommon",void 0),r([a()],E.prototype,"snappingOptions",null),r([a()],E.prototype,"state",null),r([a()],E.prototype,"tooltipOptions",null),r([a({readOnly:!0})],E.prototype,"updateGraphics",null),r([a({type:Ar,nonNullable:!0})],E.prototype,"valueOptions",null),r([a()],E.prototype,"view",null),r([a({type:Dn}),Nr(["create","update","undo","redo"])],E.prototype,"viewModel",null),r([a({type:q,nonNullable:!0})],E.prototype,"visibleElements",void 0),r([a()],E.prototype,"_effectiveAvailableCreateTools",null),r([a()],E.prototype,"_defaultViewModel",void 0),r([a()],E.prototype,"_calcitePopoverReferenceElement",void 0),r([a()],E.prototype,"_relativeLocation",void 0),r([a()],E.prototype,"_popoverOpen",void 0),E=r([k("esri.widgets.Sketch")],E);const Bc=E,Fc=(e,t,i)=>{const n=e[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((s,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==i?". Note that variables only represent file names one level deep.":""))))})},Nc=(e,t)=>(i,n)=>Zc(i,e,n);class Uc extends er{constructor(t,i,n){super(t,i,n),this._watchedViewModelProperties=new Map,this._watchedVisibleElementsProperties={},this._isBindingViewModel={value:!0},Object.defineProperty(this.exports,"viewModel",{value:Li.makeGetterProxy(t,this._watchedViewModelProperties,this._isBindingViewModel)}),Object.defineProperty(this.exports,"visibleElements",{value:this._makeVisibleElementsBinder()})}hostConnected(){super.hostConnected(),this._isBindingViewModel.value=!1,this.component.manager.loadedCalled&&Wt(this.component)}async hostLoad(){if(this._watchedProperties.delete("viewModel"),await super.hostLoad(),this.component.manager.destroyed)return;this._watchMetaProperties(),this.onLifecycle(()=>this.reactiveUtils.watch(()=>this._instance.viewModel,n=>{this.component.viewModel=n},{initial:!0}));const t=this._instance.viewModel;typeof t=="object"&&(Li.watchComponentUpdates(this,t,this._watchedViewModelProperties),Li.watchAccessorUpdates(this,t,this._watchedViewModelProperties));const i=Object.entries(this._watchedVisibleElementsProperties);i.length>0&&this.onLifecycle(()=>i.map(([n,s])=>{let o=this._instance.visibleElements??{},l;for(const d of s.slice(0,-1))if(typeof o[d]=="object"&&o[d]!==null)o=o[d];else{l=!!o[d];break}l===void 0&&(l=!!(o[s.slice(-1)[0]]??!0)),n.startsWith("hide");const c=n.startsWith("hide")||n.startsWith("show")?n.startsWith("hide"):l,p=this.component;return typeof p[n]=="boolean"?this._updateWidgetVisibleElement(s,p[n],c):p[n]=!1,Ri(this.component,n,d=>this._updateWidgetVisibleElement(s,d,c))}))}_updateWidgetVisibleElement(t,i,n){let s=this._instance.visibleElements??{};for(const l of t.slice(0,-1))(typeof s[l]!="object"||s[l]===null)&&(s[l]={}),s=s[l];const o=!!(n?!i:i);s[t.at(-1)]=o}hostLoaded(){const{el:t}=this.component;t.childElem??=document.createElement("div"),this._instance.container=t.childElem;let i=!1;const n=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>this._instance.view??this._instance.viewModel?.view,set:s=>{!("view"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.view=s:this._instance.view=s,!("map"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.map=s.map:this._instance.map=s.map,this._watchViewDestroy(),s&&!i&&(i=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),n&&(this._instance.view=n),this.component.el.isConnected&&(Wt(this.component),this._watchViewDestroy())}hostDisconnected(){typeof this.component.el.childElem=="object"&&this.component.el.view?.ui?.remove(this.component.el.childElem)}hostDestroy(){super.hostDestroy(),this._watchViewDestroyHandle?.remove()}_watchMetaProperties(){Ri(this.component,"position",t=>{this.component.el.childElem!=null&&typeof t=="string"&&Wt(this.component)}),Ri(this.component,"referenceElement",()=>Wt(this.component))}_makeVisibleElementsBinder(){return new Proxy({},{has:(t,i)=>typeof i=="string"||Reflect.has(t,i),get:(t,i)=>{if(typeof i=="symbol"||i in Promise.prototype)return Reflect.get(t,i);const n=[i],s=this._makeRecursiveProxy(n);return tr(this.component,o=>{const l=o;this.component[l]=!1,this._watchedVisibleElementsProperties[l]=n},s)}})}_makeRecursiveProxy(t){const i=new Proxy({},{get:(n,s)=>{const o=Reflect.get(n,s);return typeof s=="symbol"||s in Promise.prototype?o:(t.push(s),i)}});return i}_watchViewDestroy(){this._watchViewDestroyHandle?.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when(()=>this.component.el.view?.destroyed===!0,()=>void this.component.destroy().catch(console.error),{sync:!0})}}const Zc=Qo(Uc),Wc=ir`@layer{arcgis-sketch{display:block}}`,$c=Nc(Bc);class jc extends nr{constructor(){super(),this.widget=$c(this,{editConstructorProperties:this._editConstructorProperties}),this.viewModel=this.widget.viewModel,this.activeTool=this.widget.activeTool,this.autoDestroyDisabled=!1,this.availableCreateTools=this.widget.availableCreateTools,this.createGraphic=this.widget.createGraphic,this.creationMode=this.widget.creationMode,this.defaultCreateOptions=this.widget.defaultCreateOptions,this.defaultGraphicsLayerDisabled=!1,this.defaultUpdateOptions=this.widget.defaultUpdateOptions,this.hideCreateToolsCircle=this.widget.visibleElements.createTools.circle,this.hideCreateToolsPoint=this.widget.visibleElements.createTools.point,this.hideCreateToolsPolygon=this.widget.visibleElements.createTools.polygon,this.hideCreateToolsPolyline=this.widget.visibleElements.createTools.polyline,this.hideCreateToolsRectangle=this.widget.visibleElements.createTools.rectangle,this.hideDuplicateButton=this.widget.visibleElements.duplicateButton,this.hideDeleteButton=this.widget.visibleElements.deleteButton,this.hideSelectionCountLabel=this.widget.visibleElements.selectionCountLabel,this.hideLabelsToggle=this.widget.visibleElements.labelsToggle,this.hideSelectionToolsLassoSelection=this.widget.visibleElements.selectionTools["lasso-selection"],this.hideSelectionToolsRectangleSelection=this.widget.visibleElements.selectionTools["rectangle-selection"],this.hideSettingsMenu=this.widget.visibleElements.settingsMenu,this.hideSnappingControls=this.widget.visibleElements.snappingControls,this.hideSnappingControlsElementsEnabledToggle=this.widget.visibleElements.snappingControlsElements.enabledToggle,this.hideSnappingControlsElementsFeatureEnabledToggle=this.widget.visibleElements.snappingControlsElements.featureEnabledToggle,this.hideSnappingControlsElementsLayerList=this.widget.visibleElements.snappingControlsElements.layerList,this.hideSnappingControlsElementsSelfEnabledToggle=this.widget.visibleElements.snappingControlsElements.selfEnabledToggle,this.hideTooltipsToggle=this.widget.visibleElements.tooltipsToggle,this.hideUndoRedoMenu=this.widget.visibleElements.undoRedoMenu,this.icon=this.widget.icon,this.label=this.widget.label,this.labelOptions=this.widget.labelOptions,this.layer=this.widget.layer,this.layout=this.widget.layout,this.pointSymbol=this.viewModel.pointSymbol,this.polygonSymbol=this.viewModel.polygonSymbol,this.polylineSymbol=this.viewModel.polylineSymbol,this.position="bottom-left",this.scale=this.widget.scale,this.toolbarKind=this.widget.toolbarKind,this.showSnappingControlsElementsHeader=this.widget.visibleElements.snappingControlsElements.header,this.snappingOptions=this.widget.snappingOptions,this.state=this.widget.state,this.tooltipOptions=this.widget.tooltipOptions,this.updateGraphics=this.widget.updateGraphics,this.arcgisCreate=Vt(()=>this.widget,"create"),this.arcgisDelete=Vt(()=>this.widget,"delete"),this.arcgisPropertyChange=sr()("state"),this.arcgisReady=or(),this.arcgisRedo=Vt(()=>this.widget,"redo"),this.arcgisUndo=Vt(()=>this.widget,"undo"),this.arcgisUpdate=Vt(()=>this.widget,"update"),this.listen("arcgisReady",this._arcgisReadyHandler)}static{this.properties={activeTool:3,autoDestroyDisabled:5,availableCreateTools:0,createGraphic:0,creationMode:1,defaultCreateOptions:0,defaultGraphicsLayerDisabled:5,defaultUpdateOptions:0,hideCreateToolsCircle:5,hideCreateToolsPoint:5,hideCreateToolsPolygon:5,hideCreateToolsPolyline:5,hideCreateToolsRectangle:5,hideDuplicateButton:5,hideDeleteButton:5,hideSelectionCountLabel:5,hideLabelsToggle:5,hideSelectionToolsLassoSelection:5,hideSelectionToolsRectangleSelection:5,hideSettingsMenu:5,hideSnappingControls:5,hideSnappingControlsElementsEnabledToggle:5,hideSnappingControlsElementsFeatureEnabledToggle:5,hideSnappingControlsElementsLayerList:5,hideSnappingControlsElementsSelfEnabledToggle:5,hideTooltipsToggle:5,hideUndoRedoMenu:5,icon:1,label:1,labelOptions:0,layer:0,layout:1,pointSymbol:0,polygonSymbol:0,polylineSymbol:0,position:1,referenceElement:1,scale:1,toolbarKind:1,showSnappingControlsElementsHeader:5,snappingOptions:0,state:3,tooltipOptions:0,updateGraphics:0}}static{this.shadowRootOptions=rr}static{this.styles=Wc}async cancel(){this.widget?.cancel()}async complete(){this.widget?.complete()}async create(t,i){await this.widget?.create(t,i)}async delete(){this.widget?.delete()}async destroy(){await this.manager.destroy()}async duplicate(){this.widget?.duplicate()}async redo(){this.widget?.redo()}async triggerUpdate(t,i){this.widget?.update(t,i)}async undo(){this.widget?.undo()}_arcgisReadyHandler(){this.defaultGraphicsLayerDisabled||this.el.view?.map.add(this.widget.layer)}async _editConstructorProperties(t){return this.defaultGraphicsLayerDisabled||(t.layer??=new br({title:"Sketch Layer"})),t}}ar("arcgis-sketch",jc);const _i="RampDrawGraphicsLayer",qc=lr({__name:"draw",setup(e){const{t}=cr(),i=y=>t(y?`draw.${y}`:"draw.unknown"),n=pr("iApi"),s=Ii();let o=null;const l=dr("sketchEl");let c=null,p=null,d=null,h=null,g=!1,m=null,f=[];const S=hr([]),_=y=>{if(h&&(p?.remove(h),h=null),!y)return;let T;switch(y.geometry?.type){case"point":case"multipoint":T=new vr({color:[255,255,0,.8],size:16,outline:{color:[255,165,0,1],width:3}});break;case"polyline":T=new En({color:[255,255,0,.8],width:6});break;default:T=new $t({color:[255,255,0,.3],outline:{color:[255,165,0,1],width:3}})}h=new qe({geometry:y.geometry,symbol:T}),p?.add(h)};Tn(()=>s.selectedGraphicId,(y,T)=>{if(!(!o||!p)){if(!y)o.cancel(),_();else if(y!==T){const v=p.graphics.toArray().find(R=>R.attributes&&R.attributes.id===y);v&&(o.triggerUpdate([v]),_(v))}}});const K=async()=>{if(!p||!o||s.activeTool!=="edit")return;await n.geo.map.viewPromise;const y=n.geo.map.esriView,T={x:y.width/2,y:y.height/2},v={x:T.x,y:T.y,width:20,height:20},R=(await y.hitTest(v)).results.filter(Z=>!("graphic"in Z)||Z.graphic.layer!==p?!1:!!Z.graphic.attributes?.id);R.length>0?(d=R[0].graphic,o.triggerUpdate([d]),d.attributes?.id&&s.selectGraphic(d.attributes.id),n.updateAlert(t("draw.graphic.selected",{type:i(d.attributes?.type)}))):(o.cancel(),d=null,s.clearSelection())},A=async()=>{if(!o||!s.activeTool)return;await n.geo.map.viewPromise;const y=n.geo.map.esriView,T={x:Math.floor(y.width/2),y:Math.floor(y.height/2)},v=y.toMap(T),R=y.extent,Z=R.width,ce=R.height,ke=Math.min(Z,ce)/10;let te;switch(s.activeTool){case"point":te=new qe({geometry:new F({x:v.x,y:v.y,spatialReference:y.spatialReference}),symbol:o.pointSymbol});break;case"polyline":te=new qe({geometry:new Me({paths:[[[v.x-ke/2,v.y],[v.x+ke/2,v.y]]],spatialReference:y.spatialReference}),symbol:o.polylineSymbol});break;case"polygon":case"rectangle":const w=ke/2;te=new qe({geometry:new Q({rings:[[[v.x-w,v.y-w],[v.x+w,v.y-w],[v.x+w,v.y+w],[v.x-w,v.y+w],[v.x-w,v.y-w]]],spatialReference:y.spatialReference}),symbol:o.polygonSymbol||new $t({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})});break;case"circle":const D=ke/2,ct=36,bt=[];for(let Ue=0;Ue<=ct;Ue++){const pt=Ue/ct*2*Math.PI,W=v.x+D*Math.cos(pt),G=v.y+D*Math.sin(pt);bt.push([W,G])}te=new qe({geometry:new Q({rings:[bt],spatialReference:y.spatialReference}),symbol:o.polygonSymbol||new $t({color:[255,0,255,.3],outline:{color:[255,0,255,1],width:1}})});break;default:console.warn("Unknown tool type:",s.activeTool);return}if(te){const w=`graphic-${Date.now()}`;te.attributes={id:w,type:s.activeTool},p?.add(te),s.addGraphic({id:w,type:s.activeTool,geometry:te.geometry,attributes:te.attributes}),s.activeTool!=="point"&&(s.clearSelection(),s.setActiveTool(null),o.cancel()),n.updateAlert(t("draw.graphic.created",{type:i(s.activeTool)}))}},B=y=>{const T=n.geo.map.esriView?.container;if(!(!document.activeElement||!T?.contains(document.activeElement)))switch(y.key){case"Enter":if(y.preventDefault(),s.activeTool&&s.activeTool!=="edit")if((s.activeTool==="polyline"||s.activeTool==="polygon")&&(g||f.length===0)){const R=n.geo.map.esriView,Z={x:Math.floor(R.width/2),y:Math.floor(R.height/2)},ce=R.toMap(Z);g?(f.push([ce.x,ce.y]),s.activeTool==="polyline"?m.geometry=new Me({paths:[f],spatialReference:R.spatialReference}):m.geometry=new Q({rings:[f],spatialReference:R.spatialReference}),n.updateAlert(t("draw.multiPoint.pointAdded",{type:i(s.activeTool),count:f.length}))):(g=!0,f=[[ce.x,ce.y]],s.activeTool==="polyline"?m=new qe({geometry:new Me({paths:[f],spatialReference:R.spatialReference}),symbol:o?.polylineSymbol||new En({color:[0,0,255,1],width:2})}):m=new qe({geometry:new Q({rings:[f],spatialReference:R.spatialReference}),symbol:o?.polygonSymbol||new $t({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})}),m.attributes={id:`temp-graphic-${Date.now()}`,type:s.activeTool},p?.add(m),n.updateAlert(t("draw.multiPoint.started",{type:i(s.activeTool),count:1})))}else A();else K();break;case"Delete":case"Backspace":const v=n.geo.map.esriView;g&&f.length>1?(y.preventDefault(),f.pop(),s.activeTool==="polyline"?m.geometry=new Me({paths:[f],spatialReference:v.spatialReference}):m.geometry=new Q({rings:[f],spatialReference:v.spatialReference}),m.set("geometry",m?.geometry),n.updateAlert(t("draw.multiPoint.pointRemoved",{type:i(s.activeTool??void 0),count:f.length}))):g&&f.length===1?(y.preventDefault(),m&&p?.remove(m),m=null,f=[],g=!1,n.updateAlert(t("draw.multiPoint.canceled"))):d&&(y.preventDefault(),o?.delete(),p?.remove(d),typeof s.removeGraphic=="function"&&s.removeGraphic(d.attributes.id),d=null,_(void 0),n.updateAlert(t("draw.graphic.deleted")));break;case"Escape":s.setActiveTool(null),o?.cancel(),d=null,_(void 0),s.clearSelection(),n.updateAlert(t("draw.tool.canceled"));break}},ue=y=>{const T=n.geo.map.esriView.container;if(!document.activeElement||!T?.contains(document.activeElement)||!d||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(y.key))return;y.preventDefault(),y.stopPropagation();const v=10,R=y.shiftKey,Z=y.altKey,ce=n.geo.map.esriView;let ke=0,te=0;y.key==="ArrowLeft"&&(ke=-v),y.key==="ArrowRight"&&(ke=v),y.key==="ArrowUp"&&(te=-v),y.key==="ArrowDown"&&(te=v);const w=d.geometry;let D;if(w.type==="point")D={x:w.x,y:w.y};else{const G=w.extent;D={x:(G.xmin+G.xmax)/2,y:(G.ymin+G.ymax)/2}}const ct=ce.toScreen(new F({x:D.x,y:D.y,spatialReference:ce.spatialReference}));ct.x+=ke,ct.y+=te;const bt=ce.toMap(ct),Ue=bt.x-D.x,pt=bt.y-D.y;let W;if(w.type==="point")!R&&!Z?W=new F({x:w.x+Ue,y:w.y+pt,spatialReference:w.spatialReference}):R?(W=w.clone(),n.updateAlert(t("draw.point.resize.unsupported"))):Z&&(W=w.clone(),n.updateAlert(t("draw.point.rotate.unsupported")));else if(w.type==="polyline"){if(!R&&!Z){const G=w.paths.map($=>$.map(([ie,ne])=>[ie+Ue,ne+pt]));W=new Me({paths:G,spatialReference:w.spatialReference})}else if(R){const G=w,$=y.key==="ArrowUp"||y.key==="ArrowRight"?1.05:.95,ie=G.paths.map(ne=>ne.map(([Ze,We])=>[D.x+(Ze-D.x)*$,D.y+(We-D.y)*$]));W=new Me({paths:ie,spatialReference:w.spatialReference})}else if(Z){const G=w,$=y.key==="ArrowLeft"?-.05:y.key==="ArrowRight"?.05:0;if($!==0){const ie=Math.cos($),ne=Math.sin($),Ze=G.paths.map(We=>We.map(([wi,bi])=>{const xt=wi-D.x,Tt=bi-D.y,xi=xt*ie-Tt*ne,Ti=xt*ne+Tt*ie;return[D.x+xi,D.y+Ti]}));W=new Me({paths:Ze,spatialReference:w.spatialReference})}else W=w.clone()}}else if(w.type==="polygon"){if(!R&&!Z){const G=w.rings.map($=>$.map(([ie,ne])=>[ie+Ue,ne+pt]));W=new Q({rings:G,spatialReference:w.spatialReference})}else if(R){const G=w,$=y.key==="ArrowUp"||y.key==="ArrowRight"?1.05:.95,ie=G.rings.map(ne=>ne.map(([Ze,We])=>[D.x+(Ze-D.x)*$,D.y+(We-D.y)*$]));W=new Q({rings:ie,spatialReference:w.spatialReference})}else if(Z){const G=w,$=y.key==="ArrowLeft"?-.05:y.key==="ArrowRight"?.05:0;if($!==0){const ie=Math.cos($),ne=Math.sin($),Ze=G.rings.map(We=>We.map(([wi,bi])=>{const xt=wi-D.x,Tt=bi-D.y,xi=xt*ie-Tt*ne,Ti=xt*ne+Tt*ie;return[D.x+xi,D.y+Ti]}));W=new Q({rings:Ze,spatialReference:w.spatialReference})}else W=w.clone()}}if(W){d.geometry=W,d.set("geometry",W),_(d),d.attributes?.id&&s.updateGraphicGeometry(d.attributes.id,W);const G=R?"resized":Z?"rotated":"moved";n.updateAlert(t(`draw.graphic.${G}`))}},Fe=async y=>{const T=(await n.geo.map.esriView.hitTest(y)).results.find(v=>"graphic"in v&&v.graphic.layer===p&&!!v.graphic.attributes?.id);T&&s.activeTool==="edit"?o?.triggerUpdate([T.graphic]):(o?.cancel(),d=null,s.clearSelection(),_())},Ne=async()=>{await n.geo.map.viewPromise,n.geo.layer.getLayer(_i)?p=n.geo.layer.getLayer(_i).esriLayer:(p=n.geo.layer.createLayer({id:_i,layerType:mr.GRAPHIC,cosmetic:!0,system:!0,url:""}),await n.geo.map.addLayer(p)),p?.esriLayer&&(p=p.esriLayer),Object.assign(l.value,{view:n.geo.map.esriView,layer:p,availableCreateTools:["point","multipoint","polyline","polygon","rectangle","circle"],updateOnGraphicClick:!0,visibleElements:{createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{enable:!0},settingsMenu:!1},defaultUpdateOptions:{highlightOptions:{enabled:!1}}}),n.geo.map.esriView.ui.add(l.value,"bottom-right"),l.value?.addEventListener("arcgisCreate",y=>Pe(y.detail)),l.value?.addEventListener("arcgisUpdate",y=>lt(y.detail)),c={remove:()=>l.value?.removeEventListener("arcgisCreate",y=>Pe(y.detail))},o=l.value,n.geo.map.esriView.on("click",Fe),document.addEventListener("keydown",B),document.addEventListener("keydown",ue,{capture:!0})},ee=()=>{o&&(n.geo.map.esriView&&n.geo.map.esriView.ui.remove(o),c&&c.remove(),o.destroy()),document.removeEventListener("keydown",B),document.removeEventListener("keydown",ue,{capture:!0}),g=!1,m=null,f=[],o=null,p=null},Pe=y=>{if(y.state==="complete"){const T=y.graphic,v=`graphic-${Date.now()}`;T.attributes=T.attributes||{},T.attributes.id=v,s.addGraphic({id:v,type:y.tool,geometry:T.geometry,attributes:T.attributes}),y.tool!=="point"&&s.setActiveTool(null)}},lt=y=>{const T=y.graphics[0];if(T)if(y.state==="start"){if(s.activeTool!=="edit"){o.cancel();return}d=T,T.attributes?.id&&(s.selectGraphic(T.attributes.id),n.updateAlert(t("draw.graphic.selected",{type:i(T.attributes?.type)})))}else y.state==="active"?_(T):y.state==="complete"&&T.attributes?.id&&(s.updateGraphicGeometry(T.attributes.id,T.geometry),n.updateAlert(t("draw.graphic.updated")))};return ur(()=>{Ne(),S.push(n.event.on(Mn.MAP_DESTROYED,()=>{ee()}))}),Tn(()=>s.activeTool,y=>{o.cancel(),_(),m=null,f=[],g=!1,y&&y!="edit"&&o.create(y)}),gr(()=>{ee(),S.forEach(y=>n.event.off(y))}),(y,T)=>(fr(),yr("arcgis-sketch",{ref_key:"sketchEl",ref:l,style:{display:"none"}},null,512))}}),eo=[{type:"point"},{type:"polyline"},{type:"polygon"},{type:"circle"},{type:"rectangle"}];class Xc extends _r{store;constructor(t,i){super(t,i),this.store=Ii(this.$vApp.$pinia)}_parseConfig(t){if(!t){this.store.setSupportedTypes(eo);return}if(t.types!==void 0){const i=(t.types===null?[]:t.types).filter(n=>n.enabled!==!1);this.store.setSupportedTypes(i)}else this.store.setSupportedTypes(eo);t.defaultTool&&this.store.setActiveTool(t.defaultTool)}get graphicsLayerId(){return _i}}const Kc={en:{"draw.multiPoint.started":"{type} drawing started with 1 point","draw.multiPoint.pointAdded":"Point added {count} points total","draw.multiPoint.pointRemoved":"Point removed {count} points remaining","draw.multiPoint.canceled":"Drawing canceled","draw.multiPoint.completed":"{type} completed with {count} points","draw.multiPoint.notEnoughPoints":"Not enough points for {type} minimum {min} required","draw.graphic.created":"{type} created","draw.graphic.selected":"{type} selected","draw.graphic.deselected":"Graphic deselected","draw.graphic.deleted":"Graphic deleted","draw.graphic.updated":"Graphic updated","draw.graphic.none":"No graphic found","draw.tool.canceled":"Drawing tool canceled","draw.point.resize.unsupported":"Resizing not supported for point graphics","draw.point.rotate.unsupported":"Rotation not supported for point graphics","draw.move.up":"Moved up","draw.move.down":"Moved down","draw.move.left":"Moved left","draw.move.right":"Moved right","draw.resize.increase":"Increased size","draw.resize.decrease":"Decreased size","draw.rotate.clockwise":"Rotated clockwise","draw.rotate.counterclockwise":"Rotated counter-clockwise","draw.button.point":"Draw point","draw.button.polyline":"Draw line","draw.button.polygon":"Draw polygon","draw.button.rectangle":"Draw rectangle","draw.button.circle":"Draw circle","draw.point.tooltip":"Draw point","draw.polyline.tooltip":"Draw polyline","draw.polygon.tooltip":"Draw polygon","draw.circle.tooltip":"Draw circle","draw.rectangle.tooltip":"Draw rectangle","draw.edit.tooltip":"Edit Mode","draw.graphic.moved":"Graphic moved","draw.shape":"shape","draw.point":"point","draw.multipoint":"multipoint","draw.polyline":"polyline","draw.polygon":"polygon","draw.rectangle":"rectangle","draw.circle":"circle","draw.unknown":"unknown"},fr:{"draw.multiPoint.started":"Dessin de {type} commenc\xE9 avec 1 point","draw.multiPoint.pointAdded":"Point ajout\xE9","draw.multiPoint.pointRemoved":"Point supprim\xE9","draw.multiPoint.canceled":"Dessin annul\xE9","draw.multiPoint.completed":"{type} termin\xE9 avec {count} points","draw.multiPoint.notEnoughPoints":"Pas assez de points pour {type}","draw.graphic.created":"{type} cr\xE9\xE9","draw.graphic.selected":"{type} s\xE9lectionn\xE9","draw.graphic.deselected":"Graphique d\xE9s\xE9lectionn\xE9","draw.graphic.deleted":"Graphique supprim\xE9","draw.graphic.updated":"Graphique mis \xE0 jour","draw.graphic.none":"Aucun graphique trouv\xE9","draw.tool.canceled":"Outil de dessin annul\xE9","draw.point.resize.unsupported":"Le redimensionnement n'est pas pris en charge pour les points","draw.point.rotate.unsupported":"La rotation n'est pas prise en charge pour les points","draw.move.up":"D\xE9plac\xE9 vers le haut","draw.move.down":"D\xE9plac\xE9 vers le bas","draw.move.left":"D\xE9plac\xE9 vers la gauche","draw.move.right":"D\xE9plac\xE9 vers la droite","draw.resize.increase":"Taille augment\xE9e","draw.resize.decrease":"Taille r\xE9duite","draw.rotate.clockwise":"Rotation dans le sens horaire","draw.rotate.counterclockwise":"Rotation dans le sens antihoraire","draw.button.point":"Dessiner un point","draw.button.polyline":"Dessiner une ligne","draw.button.polygon":"Dessiner un polygone","draw.button.rectangle":"Dessiner un rectangle","draw.button.circle":"Dessiner un cercle","draw.point.tooltip":"Dessiner un point","draw.polyline.tooltip":"Dessiner une polyligne","draw.polygon.tooltip":"Dessiner un polygone","draw.circle.tooltip":"Dessiner un cercle","draw.rectangle.tooltip":"Dessiner un rectangle","draw.edit.tooltip":"Mode \xE9dition","draw.graphic.moved":"Graphique d\xE9plac\xE9","draw.shape":"forme","draw.point":"indiquer","draw.multipoint":"multipoint","draw.polyline":"polyligne","draw.polygon":"polygone","draw.rectangle":"rectangle","draw.circle":"cercle","draw.unknown":"inconnue"}};class Yc extends Xc{async init(){const{el:t}=this.mount(qc,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(t.childNodes[0]),Object.entries(Kc).forEach(i=>this.$iApi.$i18n.mergeLocaleMessage(...i)),this._parseConfig(this.config),Ii(this.$vApp.$pinia).supportedTypes.forEach(i=>{const n=`${i.type}-icon`;this.$iApi.component(n,wr(Fc(Object.assign({"./icons/circle-icon.vue":()=>import("./circle-icon-DrE2wWqh.js"),"./icons/edit-icon.vue":()=>import("./edit-icon-C_tqZ1EG.js"),"./icons/point-icon.vue":()=>import("./point-icon-BSJft8AI.js"),"./icons/polygon-icon.vue":()=>import("./polygon-icon-BrXtjiJl.js"),"./icons/polyline-icon.vue":()=>import("./polyline-icon-CqjafPK0.js"),"./icons/rectangle-icon.vue":()=>import("./rectangle-icon-D8mTZj4O.js")}),`./icons/${i.type}-icon.vue`,3)))})}async added(){this.$iApi.event.on(Mn.MAP_CREATED,()=>{this.init()})}}const Jc=Object.freeze(Object.defineProperty({__proto__:null,default:Yc},Symbol.toStringTag,{value:"Module"}));export{vs as A,vl as B,ns as C,Ml as D,si as E,Jl as F,Xl as G,ql as H,Tl as I,xl as J,Cs as K,qs as L,El as M,ni as N,ps as O,ss as P,_s as Q,wc as R,bl as S,Ws as T,Sl as U,tl as V,Jc as W,kl as Z,ji as a,sn as b,$s as c,It as d,ai as e,_c as f,as as g,cs as h,us as i,Bt as j,gs as k,Is as l,b as m,U as n,et as o,Kl as p,oi as q,nn as r,wl as s,Ki as t,Y as u,Xs as v,ri as w,re as x,ii as y,ms as z};
