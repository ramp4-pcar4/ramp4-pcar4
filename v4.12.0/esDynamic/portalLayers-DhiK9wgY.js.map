{"version":3,"file":"portalLayers-DhiK9wgY.js","sources":["../../node_modules/@arcgis/core/portal/support/portalLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{findAssociatedFeatureService as a}from\"../../layers/support/associatedFeatureServiceUtils.js\";import{getLayerModuleType as r}from\"../../layers/support/fetchService.js\";import{LayerLoadContext as t}from\"../../layers/support/LayerLoadContext.js\";import{sceneServiceLayerTypeToClassName as s}from\"../../layers/support/layerUtils.js\";import{layerLookupMap as n}from\"../../layers/support/lazyLayerLoader.js\";import c from\"../PortalItem.js\";import{getFirstLayerOrTable as o,getNumLayersAndTables as i,preprocessFSItemData as u,getLayerOrTable as l,layerTypeToLayerModuleType as m,populateSceneServiceItemData as y}from\"./loadUtils.js\";import{hasTypeKeyword as f}from\"./portalItemUtils.js\";async function p(e){let{portalItem:a}=e;!a||a instanceof c||(a=new c(a));const r=await d(a);return new(0,r.constructor)({portalItem:a,...r.properties})}async function d(e){await e.load();const a=new t;return w(await L(e,a))}async function L(a,r){switch(a.type){case\"3DTiles Service\":return a.typeKeywords.includes(\"3DObject\")?C():T();case\"CSV\":return G();case\"Feature Collection\":return v(a);case\"Feature Service\":return S(a,r);case\"Feed\":return D();case\"GeoJson\":return j();case\"Group Layer\":return O();case\"Image Service\":return I(a,r);case\"KML\":return P();case\"Knowledge Graph Layer\":return F();case\"Map Service\":return N(a,r);case\"Media Layer\":return V();case\"Scene Service\":return h(a,r);case\"Stream Service\":return M();case\"Vector Tile Service\":return g();case\"WCS\":return b();case\"WFS\":return K();case\"WMS\":return W();case\"WMTS\":return U();default:throw new e(\"portal:unknown-item-type\",\"Unknown item type '${type}'\",{type:a.type})}}async function w(e){const a=e.className,r=n[a];return{constructor:await r(),properties:e.properties}}async function N(e,a){return await x(e,a)?{className:\"TileLayer\"}:{className:\"MapImageLayer\"}}async function S(e,a){const r=await J(e,a);if(\"object\"==typeof r){const{sourceJSON:e,className:a}=r,t={sourceJSON:e};return null!=r.id&&(t.layerId=r.id),{className:a||\"FeatureLayer\",properties:t}}return{className:\"GroupLayer\"}}async function h(e,r){const t=await J(e,r,(async()=>{try{if(!e.url)return[];const{serverUrl:t}=await a(e.url,{sceneLayerItem:e}),s=await r.fetchServiceMetadata(t);return s?.tables??[]}catch{return[]}}));if(\"object\"==typeof t){const a={};let n;if(null!=t.id?(a.layerId=t.id,n=`${e.url}/layers/${t.id}`):n=e.url,e.typeKeywords?.length)for(const r of Object.keys(s))if(e.typeKeywords.includes(r))return{className:s[r]};const c=await r.fetchServiceMetadata(n,{customParameters:await r.fetchCustomParameters(e,(e=>o(e)?.customParameters))});return{className:s[c?.layerType]||\"SceneLayer\",properties:a}}if(!1===t){const a=await r.fetchServiceMetadata(e.url);if(\"Voxel\"===a?.layerType)return{className:\"VoxelLayer\"}}return{className:\"GroupLayer\"}}async function v(e){await e.load();const a=f(e,\"Map Notes\"),r=f(e,\"Markup\");if(a||r)return{className:\"MapNotesLayer\"};if(f(e,\"Route Layer\"))return{className:\"RouteLayer\"};const t=await e.fetchData();return 1===i(t)?{className:\"FeatureLayer\"}:{className:\"GroupLayer\"}}async function I(e,a){await e.load();const r=e.typeKeywords?.map((e=>e.toLowerCase()))??[];if(r.includes(\"elevation 3d layer\"))return{className:\"ElevationLayer\"};if(r.includes(\"tiled imagery\"))return{className:\"ImageryTileLayer\"};const t=await a.fetchItemData(e),s=t?.layerType;if(\"ArcGISTiledImageServiceLayer\"===s)return{className:\"ImageryTileLayer\"};if(\"ArcGISImageServiceLayer\"===s)return{className:\"ImageryLayer\"};const n=await a.fetchServiceMetadata(e.url,{customParameters:await a.fetchCustomParameters(e)}),c=n.cacheType?.toLowerCase(),o=n.capabilities?.toLowerCase().includes(\"tilesonly\"),i=n.tileInfo?.format?.toLowerCase()??\"\",u=null==c&&[\"jpg\",\"jpeg\",\"png\",\"png8\",\"png24\",\"png32\",\"mixed\"].includes(i);return\"map\"===c||u||o?{className:\"ImageryTileLayer\"}:{className:\"ImageryLayer\"}}function M(){return{className:\"StreamLayer\"}}function g(){return{className:\"VectorTileLayer\"}}function j(){return{className:\"GeoJSONLayer\"}}function T(){return{className:\"IntegratedMesh3DTilesLayer\"}}function C(){return{className:\"UnsupportedLayer\"}}function G(){return{className:\"CSVLayer\"}}function P(){return{className:\"KMLLayer\"}}function F(){return{className:\"KnowledgeGraphLayer\"}}function b(){return{className:\"WCSLayer\"}}function K(){return{className:\"WFSLayer\"}}function W(){return{className:\"WMSLayer\"}}function U(){return{className:\"WMTSLayer\"}}function D(){return{className:\"StreamLayer\"}}function O(){return{className:\"GroupLayer\"}}function V(){return{className:\"MediaLayer\"}}async function x(e,a){const{tileInfo:r}=await a.fetchServiceMetadata(e.url,{customParameters:await a.fetchCustomParameters(e)});return r}async function J(e,a,t){const{url:s,type:n}=e,c=\"Feature Service\"===n;if(!s)return{};if(/\\/\\d+$/.test(s)){if(c){const t=await a.fetchServiceMetadata(s,{customParameters:await a.fetchCustomParameters(e,(e=>o(e)?.customParameters))});return{id:t.id,className:r(t.type),sourceJSON:t}}return{}}await e.load();let f=await a.fetchItemData(e);if(c){const e=await u(f,s,a),r=k(e);if(\"object\"==typeof r){const a=l(e,r.id);r.className=m(a?.layerType)}return r}\"Scene Service\"===n&&(f=await y(e,f,a));if(i(f)>0)return k(f);const p=await a.fetchServiceMetadata(s);return t&&(p.tables=await t()),k(p)}function k(e){return 1===i(e)&&{id:o(e)?.id}}export{p as fromItem,L as selectLayerClassPath};\n"],"names":["p","c","d","e","t","w","L","a","r","C","T","G","v","S","D","j","O","I","P","F","N","V","h","M","g","b","K","W","U","n","x","J","s","o","f","i","u","k","l","m","y"],"mappings":"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","x_google_ignoreList":[0]}