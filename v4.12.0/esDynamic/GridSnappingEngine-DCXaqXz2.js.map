{"version":3,"file":"GridSnappingEngine-DCXaqXz2.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/GridSnappingEngine.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import r from\"../../../core/Logger.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{convertUnit as n}from\"../../../core/unitUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{L as a}from\"../../../chunks/vec32.js\";import{isLoadedOrLoadFor as p,project as l}from\"../../../geometry/projection.js\";import{getClosestDenormalizedXToReference as c}from\"../../../geometry/support/normalizeUtils.js\";import{getResolutionForScale as u}from\"../../../geometry/support/scaleUtils.js\";import{minimumPixelsPerStrideForDisplayWhenScalingOff as d}from\"../../2d/grid/constants.js\";import{getScaleFactor as g,measureMetersPerUnitAtReferencePoint as f}from\"../../2d/grid/gridUtils.js\";import{create as h,createWritable as m}from\"../sketch/normalizedPoint.js\";import{gridPlacementGraphicSymbol as S}from\"./snappingUtils.js\";import{IntersectionSnappingCandidate as y}from\"./candidates/IntersectionSnappingCandidate.js\";import{LineSnappingCandidate as v}from\"./candidates/LineSnappingCandidate.js\";let w=class extends t{constructor(e){super(e),this.options=null}destroy(){this._set(\"options\",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:i(this.view.rotation??0)}get gridRotation(){return i(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:e,grid:t}=this;if(!t||!e||!p(t.center.spatialReference,e))return null;try{const r=l(t.center,e),i=e.isWrappable&&null!=this.view?.center?c(r.x,this.view.center.x,e):r.x;return h(i,r.y,r.z)}catch(i){return r.getLogger(this).errorOnce(\"Grid Snapping - Failed to project grid center.\",i),null}}get offsetScaleFactor(){const{pixelsPerStride:e,grid:t}=this;if(!t||!e)return 1;const{majorLineInterval:r,dynamicScaling:i}=t;return r<1?null:g(r,e,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:e}=this;return e?n(e.spacing,e.units,\"meters\"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:e}=this;return null==e?null:e*u(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:e}=this.view;return this.gridCenter?f(this.gridCenter[0],this.gridCenter[1],e):null}get pixelsPerStride(){const{gridMetersPerStride:e,viewMetersPerPixel:t}=this;return t&&e?e/t:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(e,t,r){const{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||r.feature?.attributes&&S in r.feature.attributes)return[];const o=r.coordinateHelper.arrayToPoint(e),s=i.distance*(\"touch\"===r.pointer?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(o,s)}fetchCandidatesSync(e,t){const r=[],{grid:i,effectiveViewRotation:n,gridRotation:o,gridCenter:s,viewMetersPerPixel:a,viewMetersPerSRUnit:c,offsetScaleFactor:u,spatialReference:g,gridMetersPerStride:f,pixelsPerStride:m}=this;if(!(i&&a&&c&&s&&g&&u&&f&&m))return r;if(!i.dynamicScaling&&m<d)return r;if(!p(e.spatialReference,g))return r;const S=l(e,g),w=h(S.x,S.y,S.z),x=P(w,-o,s,-n),C=f/c*u,U=j(x,C,s),{shouldSnapX:b,shouldSnapY:L}=R(U,x,t,a,c);if(!b&&!L)return[];const z=h((b?U:x)[0],(L?U:x)[1]),E=P(z,o,s,n),F=P(U,o,s,n);if(L){const e=M(U,x,C,\"y\"),t=P(e,o,s,n);r.push(new v({lineStart:F,lineEnd:t,targetPoint:E,isDraped:!1}))}if(b){const e=M(U,x,C,\"x\"),t=P(e,o,s,n);r.push(new v({lineStart:F,lineEnd:t,targetPoint:E,isDraped:!1}))}return b&&L&&r.push(new y(E,r[0],r[1],!1)),r}};e([o({constructOnly:!0})],w.prototype,\"view\",void 0),e([o()],w.prototype,\"options\",void 0),e([o()],w.prototype,\"grid\",null),e([o()],w.prototype,\"effectiveViewRotation\",null),e([o()],w.prototype,\"gridRotation\",null),e([o()],w.prototype,\"gridCenter\",null),e([o()],w.prototype,\"offsetScaleFactor\",null),e([o()],w.prototype,\"spatialReference\",null),e([o()],w.prototype,\"gridMetersPerStride\",null),e([o()],w.prototype,\"viewMetersPerPixel\",null),e([o()],w.prototype,\"viewMetersPerSRUnit\",null),e([o()],w.prototype,\"pixelsPerStride\",null),e([o()],w.prototype,\"updating\",null),w=e([s(\"esri.views.interactive.snapping.GridSnappingEngine\")],w);const P=(e,t,r,i)=>{const n=m(e[0],e[1],e[2]);return a(n,a(n,n,r,t),r,i)},j=(e,t,r)=>{const i=(e[0]-r[0])/t,n=(e[1]-r[1])/t,o=Math.trunc(i),s=Math.trunc(n),a=Math.round(i%1),p=Math.round(n%1),l=r[0]+(o+a)*t,c=r[1]+(s+p)*t;return h(l,c)},R=(e,t,r,i,n)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};const o=(e[0]-t[0])/i,s=(e[1]-t[1])/i;return{shouldSnapX:Math.abs(o*n)<r,shouldSnapY:Math.abs(s*n)<r}},M=(e,t,r,i)=>{if(\"y\"===i){const i=t[0]>e[0]?1:-1;return h(e[0]+r*i,e[1])}const n=t[1]>e[1]?1:-1;return h(e[0],e[1]+r*n)};export{w as GridSnappingEngine};\n"],"names":["w","t","i","p","r","l","c","h","g","n","u","f","S","o","s","a","m","d","x","P","C","U","j","b","L","R","z","E","F","e","M","v","y"],"mappings":"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","x_google_ignoreList":[0]}