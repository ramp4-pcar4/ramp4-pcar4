import{ah as Z,eC as _,n as W,bx as D}from"./main-DnzmeE4U.js";import{m as $}from"./lengthUtils-wU9RRIqK.js";var S,m;function R(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function y(e){return e!=null&&!isNaN(e)&&isFinite(e)}function M(e){return e.valueExpression?S.Expression:e.field&&typeof e.field=="string"?S.Field:S.Unknown}function j(e,a){const i=a||M(e),n=e.valueUnit||"unknown";return i===S.Unknown?m.Constant:e.stops?m.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?m.ClampedLinear:n==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?m.Proportional:m.Additive:m.Identity:m.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(S||(S={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(m||(m={}));const N=()=>W.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),z=e=>N().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),g=()=>N().error("Use of arcade expressions requires an arcade context"),U=new Z,w=Math.PI,T=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function I(e,a,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(c=>c.type==="color"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void z("ColorVariable");const t=typeof a=="number",r=t?null:a,s=r?.attributes;let o=t?a:null;const l=n.field,{ipData:d,hasExpression:v}=n.cache;let u=n.cache.compiledFunc;if(!l&&!v){const c=n.stops;return c&&c[0]&&c[0].color}if(typeof o!="number")if(v){if(i?.arcade==null)return void g();const c={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},f=i.arcade.arcadeUtils,h=f.getViewInfo(c),x=f.createExecContext(r,h,i.timeZone);if(!u){const k=f.createSyntaxTree(n.valueExpression);u=f.createFunction(k),n.cache.compiledFunc=u}o=f.executeFunction(u,x)}else s&&(o=s[l]);const p=n.normalizationField,b=s!=null&&p!=null?parseFloat(s[p]):void 0;if(o!=null&&(!p||t||!isNaN(b)&&b!==0)){isNaN(b)||t||(o/=b);const c=E(o,d);if(c){const f=c[0],h=c[1],x=f===h?n.stops[f].color:D.blendColors(n.stops[f].color,n.stops[h].color,c[2],i?.color);return new D(x)}}}function q(e,a,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(c=>c.type==="opacity"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void z("OpacityVariable");const t=typeof a=="number",r=t?null:a,s=r?.attributes;let o=t?a:null;const l=n.field,{ipData:d,hasExpression:v}=n.cache;let u=n.cache.compiledFunc;if(!l&&!v){const c=n.stops;return c&&c[0]&&c[0].opacity}if(typeof o!="number")if(v){if(i?.arcade==null)return void g();const c={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},f=i.arcade.arcadeUtils,h=f.getViewInfo(c),x=f.createExecContext(r,h,i.timeZone);if(!u){const k=f.createSyntaxTree(n.valueExpression);u=f.createFunction(k),n.cache.compiledFunc=u}o=f.executeFunction(u,x)}else s&&(o=s[l]);const p=n.normalizationField,b=s!=null&&p!=null?parseFloat(s[p]):void 0;if(o!=null&&(!p||t||!isNaN(b)&&b!==0)){isNaN(b)||t||(o/=b);const c=E(o,d);if(c){const f=c[0],h=c[1];if(f===h)return n.stops[f].opacity;{const x=n.stops[f].opacity;return x+(n.stops[h].opacity-x)*c[2]}}}}function C(e,a,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(b=>b.type==="rotation"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void z("RotationVariable");const t=n.axis||"heading",r=t==="heading"&&n.rotationType==="arithmetic"?90:0,s=t==="heading"&&n.rotationType==="arithmetic"?-1:1,o=typeof a=="number"?null:a,l=o?.attributes,d=n.field,{hasExpression:v}=n.cache;let u=n.cache.compiledFunc,p=0;if(!d&&!v)return p;if(v){if(i?.arcade==null)return void g();const b={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},c=i.arcade.arcadeUtils,f=c.getViewInfo(b),h=c.createExecContext(o,f,i.timeZone);if(!u){const x=c.createSyntaxTree(n.valueExpression);u=c.createFunction(x),n.cache.compiledFunc=u}p=c.executeFunction(u,h)}else l&&(p=l[d]||0);return p=typeof p!="number"||isNaN(p)?null:r+s*p,p}function B(e,a,i){const n=typeof a=="number",t=n?null:a,r=t?.attributes;let s=n?a:null;const{isScaleDriven:o}=e.cache;let l=e.cache.compiledFunc;if(o){const v=i?.scale,u=i?.view;s=v==null||u==="3d"?G(e):v}else if(!n)switch(e.inputValueType){case S.Expression:{if(i?.arcade==null)return void g();const v={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},u=i.arcade.arcadeUtils,p=u.getViewInfo(v),b=u.createExecContext(t,p,i.timeZone);if(!l){const c=u.createSyntaxTree(e.valueExpression);l=u.createFunction(c),e.cache.compiledFunc=l}s=u.executeFunction(l,b);break}case S.Field:r&&(s=r[e.field]);break;case S.Unknown:s=null}if(!y(s))return null;if(n||!e.normalizationField)return s;const d=r?parseFloat(r[e.normalizationField]):null;return y(d)&&d!==0?s/d:null}function G(e){let a=null,i=null;const n=e.stops;return n?(a=n[0].value,i=n[n.length-1].value):(a=e.minDataValue||0,i=e.maxDataValue||0),(a+i)/2}function F(e,a,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(r=>r.type==="size"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void z("SizeVariable");const t=O(B(n,a,i),n,a,i,n.cache.ipData);return t==null||isNaN(t)?0:t}function V(e,a,i){return e==null?null:R(e)?F(e,a,i):y(e)?e:null}function A(e,a,i){return y(i)&&e>i?i:y(a)&&e<a?a:e}function H(e,a,i,n){return e+((V(a.minSize,i,n)||a.minDataValue)??0)}function J(e,a,i){const n=e.stops;let t=n?.length&&n[0].size;return t==null&&(t=e.minSize),V(t,a,i)}function K(e,a,i,n){const t=(e-a.minDataValue)/(a.maxDataValue-a.minDataValue),r=V(a.minSize,i,n),s=V(a.maxSize,i,n),o=n?.shape;if(e<=a.minDataValue)return r;if(e>=a.maxDataValue)return s;if(r==null||s==null)return null;if(a.scaleBy==="area"&&o){const l=o==="circle",d=l?w*(r/2)**2:r*r,v=d+t*((l?w*(s/2)**2:s*s)-d);return l?2*Math.sqrt(v/w):Math.sqrt(v)}return r+t*(s-r)}function Q(e,a,i,n){const t=n?.shape,r=e/a.minDataValue,s=V(a.minSize,i,n),o=V(a.maxSize,i,n);let l=null;return l=t==="circle"?2*Math.sqrt(r*(s/2)**2):t==="square"||t==="diamond"||t==="image"?Math.sqrt(r*s**2):r*s,A(l,s,o)}function X(e,a,i,n,t){const[r,s,o]=E(e,t);if(r===s)return V(a.stops?.[r].size,i,n);{const l=V(a.stops?.[r].size,i,n);return l+(V(a.stops?.[s].size,i,n)-l)*o}}function Y(e,a,i,n){const t=(n?.resolution??1)*$[a.valueUnit],r=V(a.minSize,i,n),s=V(a.maxSize,i,n),{valueRepresentation:o}=a;let l=null;return l=o==="area"?2*Math.sqrt(e/w)/t:o==="radius"||o==="distance"?2*e/t:e/t,A(l,r,s)}function O(e,a,i,n,t){switch(a.transformationType){case m.Additive:return H(e,a,i,n);case m.Constant:return J(a,i,n);case m.ClampedLinear:return K(e,a,i,n);case m.Proportional:return Q(e,a,i,n);case m.Stops:return X(e,a,i,n,t);case m.RealWorldSize:return Y(e,a,i,n);case m.Identity:return e;case m.Unknown:return null}}function ee(e,a,i){const{isScaleDriven:n}=e.cache;if(!(n&&i==="3d"||a))return null;const t={scale:a,view:i};let r=V(e.minSize,U,t),s=V(e.maxSize,U,t);if(r!=null||s!=null){if(r>s){const o=s;s=r,r=o}return{minSize:r,maxSize:s}}}function P(e,a,i){if(!e.visualVariables)return;const n=[],t=[],r=[],s=[],o=[];for(const l of e.visualVariables)switch(l.type){case"color":t.push(l);break;case"opacity":r.push(l);break;case"rotation":o.push(l);break;case"size":s.push(l)}return t.forEach(l=>{const d=I(l,a,i);n.push({variable:l,value:d})}),r.forEach(l=>{const d=q(l,a,i);n.push({variable:l,value:d})}),o.forEach(l=>{const d=C(l,a,i);n.push({variable:l,value:d})}),s.forEach(l=>{const d=F(l,a,i);n.push({variable:l,value:d})}),n.filter(l=>l.value!=null)}function E(e,a){if(!a)return;let i=0,n=a.length-1;return a.some((t,r)=>e<t?(n=r,!0):(i=r,!1)),[i,n,(e-a[i])/(a[n]-a[i])]}function L(e,a,i){const n=["proportional","proportional","proportional"];for(const t of e){const r=t.useSymbolValue?"symbol-value":F(t,a,i);switch(t.axis){case"width":n[0]=r;break;case"depth":n[1]=r;break;case"height":n[2]=r;break;case"width-and-depth":n[0]=r,n[1]=r;break;case"all":case void 0:case null:n[0]=r,n[1]=r,n[2]=r;break;default:_(t.axis)}}return n}const ne=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:L,getColor:I,getOpacity:q,getRotationAngle:C,getSize:F,getSizeForValue:O,getSizeFromNumberOrVariable:V,getSizeRangeAtScale:ee,getVisualVariableValues:P,viewScaleRE:T},Symbol.toStringTag,{value:"Module"}));export{P as R,L as T,j as a,ne as b,R as e,C as h,m as i,M as t,T as v};
