{"version":3,"file":"symbologySnappingCandidates-D5HOEomL.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationAlignment.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationFilter.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/symbologySnappingCandidates.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{getOrCreateMapValue as t}from\"../../../../core/MapUtils.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{getMetersPerVerticalUnitForSR as n}from\"../../../../core/unitUtils.js\";import{getMetersPerUnit as o}from\"../../../../symbols/support/unitConversionUtils.js\";function i(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:s}=t;return new c(e,s)}return new a}class a{async alignCandidates(e,t,s){return e}notifyElevationSourceChange(){}}const r=1024;class c{constructor(t,s){this._elevationInfo=t,this._alignPointsInFeatures=s,this._alignmentsCache=new e(r),this._cacheVersion=0}async alignCandidates(e,t,s){const n=this._elevationInfo;return null==n||\"absolute-height\"!==n.mode||n.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,s):(l(e,t,n),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,n,o){const i=new Map;for(const s of e)t(i,s.objectId,d).push(s);const[a,r,c]=this._prepareQuery(i,n),h=await this._alignPointsInFeatures(a,o);s(o);if(c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,n,o);this._applyCacheAndResponse(a,h,r);const{drapedObjectIds:u,failedObjectIds:l}=h,p=[];for(const t of e){const{objectId:e}=t;u.has(e)&&\"edge\"===t.type&&(t.draped=!0),l.has(e)||p.push(t)}return p}_prepareQuery(e,t){const s=[],n=[];for(const[o,i]of e){const e=[];for(const t of i)this._addToQueriesOrCachedResult(o,t.target,e,n),\"edge\"===t.type&&(this._addToQueriesOrCachedResult(o,t.start,e,n),this._addToQueriesOrCachedResult(o,t.end,e,n));0!==e.length&&s.push({objectId:o,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:s},n,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,s,n){const o=u(e,t),i=this._alignmentsCache.get(o);null==i?s.push(t):n.push(new h(t,i))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:s,failedObjectIds:n},o){for(const r of o)r.apply();let i=0;const a=this._alignmentsCache;for(const{objectId:r,points:c}of e.pointsInFeatures){if(n.has(r)){i+=c.length;continue}const e=!s.has(r);for(const s of c){const n=u(r,s),o=t[i++];s.z=o,e&&a.put(n,o,1)}}}}class h{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function u(e,{x:t,y:s,z:n,spatialReference:o}){return`${e}-${t}-${s}-${n??0}}-wkid:${o?.wkid}`}function l(e,t,s){const{offset:i,unit:a}=s;if(null==i)return;const r=n(t),c=i*(o(a??\"meters\")/r);for(const n of e)switch(n.type){case\"edge\":n.start.z+=c,n.end.z+=c;continue;case\"vertex\":n.target.z+=c;continue}}function d(){return[]}export{i as getSnappingCandidateElevationAligner};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";class t{filter(t,n){return n}notifyElevationSourceChange(){}}class n{filter(t,n){const{point:r,distance:c}=t,{z:i}=r;if(!(null!=i))return n;if(0===n.length)return n;const o=s(c),u=this._updateCandidatesTo3D(n,r,o).filter(e);return u.sort(a),u}_updateCandidatesTo3D(t,n,e){for(const r of t)switch(r.type){case\"edge\":c(r,n,e);continue;case\"vertex\":o(r,n,e);continue}return t}}function e(t){return t.distance<=1}function r(e=!1){return e?new n:new t}function c(t,n,{x:e,y:r,z:c}){const{start:o,end:s,target:a}=t;t.draped||i(a,n,o,s);const u=(n.x-a.x)/e,d=(n.y-a.y)/r,f=(n.z-a.z)/c;t.distance=Math.sqrt(u*u+d*d+f*f)}function i(t,n,e,r){const c=r.x-e.x,i=r.y-e.y,o=r.z-e.z,s=c*c+i*i+o*o,a=(n.x-e.x)*c+(n.y-e.y)*i+o*(n.z-e.z),u=Math.min(1,Math.max(0,a/s)),d=e.x+c*u,f=e.y+i*u,x=e.z+o*u;t.x=d,t.y=f,t.z=x}function o(t,n,{x:e,y:r,z:c}){const{target:i}=t,o=(n.x-i.x)/e,s=(n.y-i.y)/r,a=(n.z-i.z)/c,u=Math.sqrt(o*o+s*s+a*a);t.distance=u}function s(t){return\"number\"==typeof t?{x:t,y:t,z:t}:t}function a(t,n){return t.distance-n.distance}export{r as getSnappingCandidateElevationFilter};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{clone as t}from\"../../../../core/lang.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{numericHash as o}from\"../../../../core/string.js\";function n(t=!1,e){return t?new i(e):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}const r=1024;class i{constructor(t){this._getSymbologyCandidates=t,this._candidatesCache=new e(r),this._cacheVersion=0}async fetch(e,o){if(0===e.length)return[];const n=[],c=[],r=this._candidatesCache;for(const s of e){const e=a(s),o=r.get(e);if(o)for(const s of o)c.push(t(s));else n.push(s),r.put(e,[],1)}if(0===n.length)return c;const i=this._cacheVersion,{candidates:h,sourceCandidateIndices:d}=await this._getSymbologyCandidates(n,o);s(o);if(i!==this._cacheVersion)return this.fetch(e,o);const f=[],{length:g}=h;for(let s=0;s<g;++s){const e=h[s],o=a(n[d[s]]),c=r.get(o);c.push(e),r.put(o,c,c.length),f.push(t(e))}return c.concat(f)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function a(t){switch(t.type){case\"vertex\":{const{objectId:e,target:s}=t,n=`${e}-vertex-${s.x}-${s.y}-${s.z??0}`;return o(n).toString()}case\"edge\":{const{objectId:e,start:s,end:n}=t,c=`${e}-edge-${s.x}-${s.y}-${s.z??0}-to-${n.x}-${n.y}-${n.z??0}`;return o(c).toString()}default:return\"\"}}export{n as getSymbologySnappingCandidatesFetcher};\n"],"names":["i","e","t","s","c","a","a$2","r","c$2","n","l","o","d","h","u","p","n$1","f","x","g"],"mappings":"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","x_google_ignoreList":[0,1,2]}