const L=9999999e31,S=2e-7,y={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function p(t){return y[t]??[-34028234663852886e22,34028234663852886e22]}function U(t,s){return t==null||s==null?"s32":t<0?t>=-128&&s<128?"s8":t>=-32768&&s<32768?"s16":"s32":s<256?"u8":s<65536?"u16":"u32"}function A(t){return(t?.startsWith("s")||t?.startsWith("u"))??!1}function V(t,s,n,i){let[a,u]=p(n);const e=A(n);return e&&(a-=1e-5,u+=1e-5),e?n.startsWith("u")?w(t,s,i,[a,u]):I(t,s,i,[a,u]):O(t,s,i,[a,u])}function v(t,s){for(let n=0;n<s.length;n++)s[n]&&isNaN(t[n])&&(s[n]=0,t[n]=0)}function w(t,s,n,i){const[a,u]=i;for(let e=0;e<s.length;e++)if(s[e]){const o=t[e];o<a||o>u?s[e]=0:n[e]=o+.5|0}}function I(t,s,n,i){const[a,u]=i;for(let e=0;e<s.length;e++)if(s[e]){const o=t[e];o<a||o>u?s[e]=0:n[e]=o+(o>0?.5:-.5)|0}}function O(t,s,n,i){const[a,u]=i;for(let e=0;e<s.length;e++)if(s[e]){const o=t[e];o<a||o>u?s[e]=0:n[e]=o}}function P(t,s,n){if(t.depthCount&&t.depthCount>1)return;const{pixels:i,statistics:a,pixelType:u}=t,e=i[0].length,o=t.bandMasks??[],g=t.mask??new Uint8Array(e).fill(255),x=u==="f32"||u==="f64",M=p(u);let d=!1;for(let l=0;l<i.length;l++){const f=typeof s=="number"?s:s[l];if(f==null)continue;const N=a?.[l]?.minValue??M[0],b=a?.[l]?.maxValue??M[1];if(N>f+Number.EPSILON||b<f-Number.EPSILON)continue;const h=o[l]||g.slice(),r=i[l],k=n?.customFloatTolerance;if(x&&k!==0){let c=k;c||(c=Math.abs(f)>=L?S*Math.abs(f):u==="f32"?2**-23:Number.EPSILON);for(let m=0;m<r.length;m++)h[m]&&Math.abs(r[m]-f)<c&&(r[m]=0,h[m]=0,g[m]=0,d=!0)}else for(let c=0;c<r.length;c++)h[c]&&r[c]===f&&(r[c]=0,h[c]=0,g[c]=0,d=!0);o[l]=h}if(d){const l=t.bandMasks||t.pixels.length>1?o:null;n?.matchAllNoData?t.mask=l&&l.length>1?E(l):g:(t.bandMasks=l,t.mask=g)}function E(l){if(l.length<2)return l[0];const f=l[0].length,N=new Uint8Array(f).fill(0);for(let b=0;b<l.length;b++){const h=l[b];for(let r=0;r<f;r++)h[r]&&(N[r]=255)}return N}d&&"updateStatistics"in t&&t.updateStatistics()}export{P as a,v as i,U as l,A as o,p as s,V as u};
