import{F as f,ac as p,o as m,X as k,ad as M,ae as z,j as C,h as v,A as U,w as F,af as q,ag as E,ah as X,ai as Z,d as J,aj as G,J as b,ak as Q,al as Y,am as _,an as B,c as R,K as x}from"./arcade-Dg73dEoh.js";import{a as o,r as s}from"./unitConversion-BXECx7w3.js";import{o as O}from"./TimeOnly-C3SOkmg2.js";import{l as H}from"./portalUtils-SFTmSBN_.js";import{a as c}from"./operatorsWorkerConnection-DkxyJ5dM.js";import{bd as $,b7 as K,dd as w,aj as y,db as P,ap as L,ad as T,an as I,ae as j,ao as tt,C as V}from"./main-DnzmeE4U.js";async function W(i,n,r){if(!$?.findCredential(i.restUrl))return null;if(i.loadStatus==="loaded"&&n===""&&i.user?.sourceJSON&&r===!1)return i.user.sourceJSON;const u={responseType:"json",query:{f:"json"}};if(r&&(u.query.returnUserLicenseTypeExtensions=!0),n===""){const t=await K(i.restUrl+"/community/self",u);if(t.data){const e=t.data;if(e?.username)return e}return null}const l=await K(i.restUrl+"/community/users/"+n,u);if(l.data){const t=l.data;return t.error?null:t}return null}function g(i){if(i==null)return i;switch(typeof i){case"string":case"number":return i;default:throw new o(null,s.InvalidParameter,null)}}function nt(i){i.mode==="async"&&(i.functions.disjoint=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=f(t),p(t,n,r),t[0]===null||t[1]===null||c("disjoint",[t[0].toJSON(),t[1].toJSON()])))},i.functions.intersects=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=f(t),p(t,n,r),t[0]!==null&&t[1]!==null&&c("intersects",[t[0].toJSON(),t[1].toJSON()])))},i.functions.touches=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=f(t),p(t,n,r),t[0]!==null&&t[1]!==null&&c("touches",[t[0].toJSON(),t[1].toJSON()])))},i.functions.crosses=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=f(t),p(t,n,r),t[0]!==null&&t[1]!==null&&c("crosses",[t[0].toJSON(),t[1].toJSON()])))},i.functions.within=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=f(t),p(t,n,r),t[0]!==null&&t[1]!==null&&c("within",[t[0].toJSON(),t[1].toJSON()])))},i.functions.contains=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=f(t),p(t,n,r),t[0]!==null&&t[1]!==null&&c("contains",[t[0].toJSON(),t[1].toJSON()])))},i.functions.overlaps=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=f(t),p(t,n,r),t[0]!==null&&t[1]!==null&&c("overlaps",[t[0].toJSON(),t[1].toJSON()])))},i.functions.equals=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(m(t,2,2,n,r),t[0]===t[1]||(t[0]instanceof w&&t[1]instanceof w?c("equals",[t[0].toJSON(),t[1].toJSON()]):(k(t[0])&&k(t[1])||!!(M(t[0])&&M(t[1])||z(t[0])&&z(t[1])))&&t[0].equals(t[1]))))},i.functions.relate=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>{if(t=f(t),m(t,3,3,n,r),t[0]instanceof w&&t[1]instanceof w)return c("relate",[t[0].toJSON(),t[1].toJSON(),C(t[2])]);if(t[0]instanceof w&&t[1]===null||t[1]instanceof w&&t[0]===null||t[0]===null&&t[1]===null)return!1;throw new o(n,s.InvalidParameter,r)})},i.functions.intersection=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>(t=f(t),p(t,n,r),t[0]===null||t[1]===null?null:y(await c("intersection",[t[0].toJSON(),t[1].toJSON()]))))},i.functions.union=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if((t=f(t)).length===0)throw new o(n,s.WrongNumberOfParameters,r);const e=[];if(t.length===1)if(P(t[0])){for(const a of f(t[0]))if(a!==null){if(!(a instanceof w))throw new o(n,s.InvalidParameter,r);e.push(a.toJSON())}}else{if(!v(t[0])){if(t[0]instanceof w)return U(O(t[0]),n.spatialReference);if(t[0]===null)return null;throw new o(n,s.InvalidParameter,r)}for(const a of f(t[0].toArray()))if(a!==null){if(!(a instanceof w))throw new o(n,s.InvalidParameter,r);e.push(a.toJSON())}}else for(const a of t)if(a!==null){if(!(a instanceof w))throw new o(n,s.InvalidParameter,r);e.push(a.toJSON())}return e.length===0?null:y(await c("union",[e]))})},i.functions.difference=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>(t=f(t),p(t,n,r),t[0]===null?null:t[1]===null?O(t[0]):y(await c("difference",[t[0].toJSON(),t[1].toJSON()]))))},i.functions.symmetricdifference=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>(t=f(t),p(t,n,r),t[0]===null&&t[1]===null?null:t[0]===null?O(t[1]):t[1]===null?O(t[0]):y(await c("symmetricDifference",[t[0].toJSON(),t[1].toJSON()]))))},i.functions.clip=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,2,n,r),!(t[1]instanceof L)&&t[1]!==null)throw new o(n,s.InvalidParameter,r);if(t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);return t[1]===null?null:y(await c("clip",[t[0].toJSON(),t[1].toJSON()]))})},i.functions.cut=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,2,n,r),!(t[1]instanceof T)&&t[1]!==null)throw new o(n,s.InvalidParameter,r);if(t[0]===null)return[];if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);return t[1]===null?[O(t[0])]:(await c("cut",[t[0].toJSON(),t[1].toJSON()])).map(e=>y(e))})},i.functions.area=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(m(t,1,2,n,r),t=f(t),F(t[0])){const a=await t[0].sumArea(g(t[1]),!1,n.abortSignal);if(n.abortSignal.aborted)throw new o(n,s.Cancelled,r);return a}let e=t[0];if((P(e)||v(e))&&(e=q(t[0],n.spatialReference)),e===null)return 0;if(!(e instanceof w))throw new o(n,s.InvalidParameter,r);return c("area",[e.toJSON(),g(t[1])])})},i.functions.areageodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(m(t,1,2,n,r),t=f(t),F(t[0])){const a=await t[0].sumArea(g(t[1]),!0,n.abortSignal);if(n.abortSignal.aborted)throw new o(n,s.Cancelled,r);return a}let e=t[0];if((P(t[0])||v(t[0]))&&(e=q(t[0],n.spatialReference)),e===null)return 0;if(!(e instanceof w))throw new o(n,s.InvalidParameter,r);return c("geodeticArea",[e.toJSON(),g(t[1])])})},i.functions.length=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(m(t,1,2,n,r),t=f(t),F(t[0])){const a=await t[0].sumLength(g(t[1]),!1,n.abortSignal);if(n.abortSignal.aborted)throw new o(n,s.Cancelled,r);return a}let e=t[0];if((P(t[0])||v(t[0]))&&(e=E(t[0],n.spatialReference)),e===null)return 0;if(!(e instanceof w))throw new o(n,s.InvalidParameter,r);return c("length",[e.toJSON(),g(t[1])])})},i.functions.length3d=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(m(t,1,2,n,r),(t=f(t))[0]===null)return 0;let e=t[0];if((P(t[0])||v(t[0]))&&(e=E(t[0],n.spatialReference)),e===null)return 0;if(!(e instanceof w))throw new o(n,s.InvalidParameter,r);if(e.hasZ===!0){const{convertFromSpatialReferenceUnit:a,toLengthUnit:h}=await import("./unitConversion-BXECx7w3.js").then(N=>N.e),d=X(e);return a(e.spatialReference,h(t[1]),d)}return c("length",[e.toJSON(),g(t[1])])})},i.functions.lengthgeodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(m(t,1,2,n,r),t=f(t),F(t[0])){const a=await t[0].sumLength(g(t[1]),!0,n.abortSignal);if(n.abortSignal.aborted)throw new o(n,s.Cancelled,r);return a}let e=t[0];if((P(t[0])||v(t[0]))&&(e=E(t[0],n.spatialReference)),e===null)return 0;if(!(e instanceof w))throw new o(n,s.InvalidParameter,r);return c("geodeticLength",[e.toJSON(),g(t[1])])})},i.functions.distance=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{t=f(t),m(t,2,3,n,r);let e=t[0];if((P(t[0])||v(t[0]))&&(e=Z(t[0],n.spatialReference)),!(e instanceof w))throw new o(n,s.InvalidParameter,r);let a=t[1];if((P(t[1])||v(t[1]))&&(a=Z(t[1],n.spatialReference)),!(a instanceof w))throw new o(n,s.InvalidParameter,r);return c("distance",[e.toJSON(),a.toJSON(),g(t[2])])})},i.functions.distancegeodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{t=f(t),m(t,2,3,n,r);const e=t[0];if(!(e instanceof I))throw new o(n,s.InvalidParameter,r);const a=t[1];if(!(a instanceof I))throw new o(n,s.InvalidParameter,r);const h=new T({paths:[],spatialReference:e.spatialReference});return h.addPath([e,a]),c("geodeticLength",[h.toJSON(),g(t[2])])})},i.functions.densify=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);const e=J(t[1]);if(isNaN(e))throw new o(n,s.InvalidParameter,r);if(e<=0)throw new o(n,s.InvalidParameter,r);switch(t[0].type){case"polygon":case"polyline":case"extent":return y(await c("densify",[t[0].toJSON(),e,g(t[2])]));default:return t[0]}})},i.functions.densifygeodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);const e=J(t[1]);if(isNaN(e))throw new o(n,s.InvalidParameter,r);if(e<=0)throw new o(n,s.InvalidParameter,r);switch(t[0].type){case"polygon":case"polyline":case"extent":return y(await c("geodeticDensify",[t[0].toJSON(),e,g(t[2])]));default:return t[0]}})},i.functions.generalize=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,4,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);const e=J(t[1]);if(isNaN(e))throw new o(n,s.InvalidParameter,r);const a=G(b(t[2],!0));return y(await c("generalize",[t[0].toJSON(),e,g(t[3]),{removeDegenerateParts:a}]))})},i.functions.buffer=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);const e=J(t[1]);if(isNaN(e))throw new o(n,s.InvalidParameter,r);return e===0?O(t[0]):y(await c("buffer",[t[0].toJSON(),e,g(t[2])]))})},i.functions.buffergeodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);const e=J(t[1]);if(isNaN(e))throw new o(n,s.InvalidParameter,r);return e===0?O(t[0]):y(await c("geodesicBuffer",[t[0].toJSON(),e,g(t[2])]))})},i.functions.offset=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,6,n,r),t[0]===null)return null;if(!(t[0]instanceof j||t[0]instanceof T))throw new o(n,s.InvalidParameter,r);const e=J(t[1]);if(isNaN(e))throw new o(n,s.InvalidParameter,r);const a=C(t[3]??"round").toLowerCase();let h;switch(a){case"round":case"bevel":case"miter":case"square":h=a;break;default:h="round"}const d=J(b(t[4],10));if(isNaN(d))throw new o(n,s.InvalidParameter,r);const N=J(b(t[5],0));if(isNaN(N))throw new o(n,s.InvalidParameter,r);return y(await c("offset",[t[0].toJSON(),e,g(t[2]),{joins:h,miterLimit:d,flattenError:N}]))})},i.functions.rotate=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);const e=t[0]instanceof L?j.fromExtent(t[0]):t[0],a=J(t[1]);if(isNaN(a))throw new o(n,s.InvalidParameter,r);const h=b(t[2],null);if(h===null){const d=e.type==="point"?e:e.extent?.center;return y(await c("rotate",[e.toJSON(),a,d?.x,d?.y]))}if(h instanceof I)return y(await c("rotate",[e.toJSON(),a,h.x,h.y]));throw new o(n,s.InvalidParameter,r)})},i.functions.centroid=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,1,2,n,r),t[0]===null)return null;const e=C(t[1]??"geometric").toLowerCase();if(e!=="geometric"&&e!=="labelpoint")throw new o(n,s.InvalidParameter,r);let a=t[0];if((P(t[0])||v(t[0]))&&(a=e==="geometric"?Z(t[0],n.spatialReference):q(t[0],n.spatialReference),a===null))return null;if(!(a instanceof w))throw new o(n,s.InvalidParameter,r);return y(e==="geometric"?await c("centroid",[a.toJSON()]):await c("labelPoint",[a.toJSON()]))})},i.functions.measuretocoordinate=function(n,r){return i.standardFunctionAsync(n,r,Q)},i.functions.pointtocoordinate=function(n,r){return i.standardFunctionAsync(n,r,Y)},i.functions.distancetocoordinate=function(n,r){return i.standardFunctionAsync(n,r,_)},i.functions.multiparttosinglepart=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);if(t[0]instanceof I)return[U(O(t[0]),n.spatialReference)];if(t[0]instanceof L)return[U(O(t[0]),n.spatialReference)];const e=y(await c("simplify",[t[0].toJSON()]));if(e instanceof j){const a=[],h=[];for(let d=0;d<e.rings.length;d++)if(e.isClockwise(e.rings[d])){const N=y({rings:[e.rings[d]],hasZ:e.hasZ===!0,hasM:e.hasM===!0,spatialReference:e.spatialReference.toJSON()});a.push(N)}else h.push({ring:e.rings[d],pt:e.getPoint(d,0)});for(let d=0;d<h.length;d++)for(let N=0;N<a.length;N++)if(a[N].contains(h[d].pt)){a[N].addRing(h[d].ring);break}return a}if(e instanceof T){const a=[];for(let h=0;h<e.paths.length;h++){const d=y({paths:[e.paths[h]],hasZ:e.hasZ===!0,hasM:e.hasM===!0,spatialReference:e.spatialReference.toJSON()});a.push(d)}return a}if(t[0]instanceof tt){const a=[],h=U(O(t[0]),n.spatialReference);for(let d=0;d<h.points.length;d++)a.push(h.getPoint(d));return a}return null})},i.functions.issimple=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>{if(t=f(t),m(t,1,1,n,r),t[0]===null)return!0;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);return c("isSimple",[t[0].toJSON()])})},i.functions.simplify=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);return y(await c("simplify",[t[0].toJSON()]))})},i.functions.convexhull=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,s.InvalidParameter,r);return y(await c("convexHull",[t[0].toJSON()]))})},i.functions.getuser=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{m(t,0,2,n,r);let e=b(t[1],""),a=e===!0;if(e=e===!0||e===!1?"":C(e),t.length===0||t[0]instanceof B){let d;d=n.services?.portal?n.services.portal:V.getDefault(),t.length>0&&(d=H(t[0],d));const N=await W(d,e,a);if(N){const A=JSON.parse(JSON.stringify(N));for(const S of["lastLogin","created","modified"])A[S]!==void 0&&A[S]!==null&&(A[S]=new Date(A[S]));return R.convertObjectToArcadeDictionary(A,x(n))}return null}let h=null;if(F(t[0])&&(h=t[0]),h){if(a=!1,e)return null;await h.load();const d=await h.getOwningSystemUrl();if(!d){if(!e){const S=await h.getIdentityUser();return S?R.convertObjectToArcadeDictionary({username:S},x(n)):null}return null}let N;N=n.services?.portal?n.services.portal:V.getDefault(),N=H(new B(d),N);const A=await W(N,e,a);if(A){const S=JSON.parse(JSON.stringify(A));for(const D of["lastLogin","created","modified"])S[D]!==void 0&&S[D]!==null&&(S[D]=new Date(S[D]));return R.convertObjectToArcadeDictionary(S,x(n))}return null}throw new o(n,s.InvalidParameter,r)})},i.functions.nearestcoordinate=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,2,n,r),!(t[0]instanceof w||t[0]===null))throw new o(n,s.InvalidParameter,r);if(!(t[1]instanceof I||t[1]===null))throw new o(n,s.InvalidParameter,r);if(t[0]===null||t[1]===null)return null;const e=t[0]instanceof L?j.fromExtent(t[0]):t[0],a=await c("getNearestCoordinate",[e.toJSON(),t[1].toJSON(),{calculateLeftRightSide:!0}]);return a===null?null:R.convertObjectToArcadeDictionary({coordinate:y(a.coordinate),distance:a.distance,sideOfLine:a.distance===0?"straddle":a.rightSide?"right":"left"},x(n),!1,!0)})},i.functions.nearestvertex=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=f(t),m(t,2,2,n,r),!(t[0]instanceof w||t[0]===null))throw new o(n,s.InvalidParameter,r);if(!(t[1]instanceof I||t[1]===null))throw new o(n,s.InvalidParameter,r);if(t[0]===null||t[1]===null)return null;const e=t[0]instanceof L?j.fromExtent(t[0]):t[0],a=await c("getNearestVertex",[e.toJSON(),t[1].toJSON()]);return a===null?null:R.convertObjectToArcadeDictionary({coordinate:y(a.coordinate),distance:a.distance,sideOfLine:a.distance===0?"straddle":a.rightSide?"right":"left"},x(n),!1,!0)})})}export{nt as registerFunctions};
