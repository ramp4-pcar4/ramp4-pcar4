import{x as o,z as s,K as c,G as C,an as ee,ad as te,a3 as re,Q,C as D,da as b,db as N,cn as ne,dc as F,dd as K,O as oe,ec as ae,gz as se}from"./main-DnzmeE4U.js";import{o as _,an as ie,j as A,ar as pe,J as le,c as J,K as ce,X as M,ae as ue,ad as de,as as fe,U as B}from"./arcade-Dg73dEoh.js";import{a as f,r as h}from"./unitConversion-BXECx7w3.js";import{l as he}from"./portalUtils-SFTmSBN_.js";import{k as ye,K as me,O as ge}from"./projection-m8vi7Cxv.js";import we from"./PortalItem-CJetnHeq.js";import{m as ve,n as Ge}from"./project-CdmvlsYz.js";let R=class extends C{constructor(e){super(e),this.properties=null}};o([s({json:{write:!0}})],R.prototype,"properties",void 0),R=o([c("esri.rest.knowledgeGraph.GraphObject")],R);const T=R;let w=class extends T{constructor(e){super(e),this.typeName=null,this.id=null}};o([s({type:String,json:{write:!0}})],w.prototype,"typeName",void 0),o([s({type:String,json:{write:!0}})],w.prototype,"id",void 0),w=o([c("esri.rest.knowledgeGraph.GraphNamedObject")],w);const U=w;let k=class extends U{constructor(e){super(e),this.layoutGeometry=null}};o([s({type:ee,json:{write:!0}})],k.prototype,"layoutGeometry",void 0),k=o([c("esri.rest.knowledgeGraph.Entity")],k);const V=k;let y=class extends U{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};o([s({type:String,json:{write:!0}})],y.prototype,"originId",void 0),o([s({type:String,json:{write:!0}})],y.prototype,"destinationId",void 0),o([s({type:te,json:{write:!0}})],y.prototype,"layoutGeometry",void 0),y=o([c("esri.rest.knowledgeGraph.Relationship")],y);const $=y;let W=class extends T{constructor(e){super(e)}};W=o([c("esri.rest.knowledgeGraph.ObjectValue")],W);const E=W;let j=class extends C{constructor(e){super(e),this.path=[]}};o([s({type:[T],json:{write:!0}})],j.prototype,"path",void 0),j=o([c("esri.rest.knowledgeGraph.Path")],j);const X=j;let P=class extends re{constructor(e){super(e),this.openCypherQuery=""}};o([s()],P.prototype,"openCypherQuery",void 0),P=o([c("esri.rest.knowledgeGraph.GraphQuery")],P);const Se=P;let u=class extends Se{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};o([s()],u.prototype,"bindParameters",void 0),o([s()],u.prototype,"bindGeometryQuantizationParameters",void 0),o([s()],u.prototype,"outputQuantizationParameters",void 0),o([s({type:Q})],u.prototype,"outputSpatialReference",void 0),o([s()],u.prototype,"provenanceBehavior",void 0),u=o([c("esri.rest.knowledgeGraph.GraphQueryStreaming")],u);const H=u;let m=null;async function xe(e){const t=ne.geometryServiceUrl??"";if(!t){ye()||await me();for(const r of e)r.container[r.indexer]=ge(r.container[r.indexer],Q.WGS84);return}const n=e.map(r=>r.container[r.indexer]),i=new ve({geometries:n,outSpatialReference:Q.WGS84}),l=await Ge(t,i);for(let r=0;r<l.length;r++){const a=e[r];a.container[a.indexer]=l[r]}}async function L(e,t){const n=new we({portal:e,id:t});return await n.load(),m===null&&(m=await import("./streamLayerUtils-C6RxjeRB.js").then(i=>i.k)),await m.fetchKnowledgeGraph(n.url)}function z(e,t,n,i,l){if(e===null)return null;if(b(e)||F(e))return e;if(M(e)||M(e))return e.toJSDate();if(ue(e))return e.toStorageFormat();if(de(e))return e.toStorageString();if(fe(e)){const r={};for(const a of e.keys())r[a]=z(e.field(a),t,n,i,l),r[a]instanceof K&&l.push({container:r,indexer:a});return r}if(N(e)){const r=e.map(a=>z(a,t,n,i,l));for(let a=0;a<r.length;a++)r[a]instanceof K&&l.push({container:r,indexer:a});return r}return B(e)?e.spatialReference.isWGS84?e:e.spatialReference.isWebMercator&&t?oe(e):e:void 0}function be(e,t){if(!e)return e;if(e.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return se(e);if(e.spatialReference.equals(t.spatialReference))return e;throw new f(t,h.WrongSpatialReference,null)}function O(e,t){if(!e)return null;const n={};for(const i in e)n[i]=v(e[i],t);return n}function v(e,t){return e===null?null:N(e)?e.map(n=>v(n,t)):e instanceof V?{graphTypeName:e.typeName,id:e.id,graphType:"entity",properties:O(e.properties,t)}:e instanceof E?{graphType:"object",properties:O(e.properties,t)}:e instanceof $?{graphTypeName:e.typeName,id:e.id,graphType:"relationship",originId:e.originId??null,destinationId:e.destinationId??null,properties:O(e.properties,t)}:e instanceof X?{graphType:"path",path:e.path?e.path.map(n=>v(n,t)):null}:B(e)?be(e,t):b(e)||F(e)||ae(e)?e:null}function Re(e){e.mode==="async"&&(e.functions.knowledgegraphbyportalitem=function(t,n){return e.standardFunctionAsync(t,n,(i,l,r)=>{if(_(r,2,2,t,n),r[0]===null)throw new f(t,h.PortalRequired,n);if(r[0]instanceof ie){const G=A(r[1]);let g;return g=t.services?.portal?t.services.portal:D.getDefault(),L(he(r[0],g),G)}if(b(r[0])===!1)throw new f(t,h.InvalidParameter,n);const a=A(r[0]);return L(t.services?.portal??D.getDefault(),a)})},e.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),e.functions.querygraph=function(t,n){return e.standardFunctionAsync(t,n,async(i,l,r)=>{_(r,2,4,t,n);const a=r[0];if(!pe(a))throw new f(t,h.InvalidParameter,n);const G=r[1];if(!b(G))throw new f(t,h.InvalidParameter,n);m===null&&(m=await import("./streamLayerUtils-C6RxjeRB.js").then(p=>p.k));let g=null;const S=le(r[2],null);if(!(S instanceof J||S===null))throw new f(t,h.InvalidParameter,n);if(S){let p=[];g=z(S,!0,!1,t,p),p=p.filter(d=>!d.container[d.indexer].spatialReference.isWGS84),p.length>0&&await xe(p)}const q=new H({openCypherQuery:G,bindParameters:g});(a?.serviceDefinition?.currentVersion??11.3)>11.2&&(q.outputSpatialReference=t.spatialReference);const Y=(await m.executeQueryStreaming(a,q)).resultRowsStream.getReader(),I=[];try{for(;;){const{done:p,value:d}=await Y.read();if(p)break;if(N(d))for(const x of d)I.push(v(x,t));else{const x=[];for(const Z of d)x.push(v(d[Z],t));I.push(x)}}}catch(p){throw p}return J.convertJsonToArcade(I,ce(t),!1,!0)})},e.signatures.push({name:"querygraph",min:2,max:4}))}const ke=Object.freeze(Object.defineProperty({__proto__:null,registerFunctions:Re},Symbol.toStringTag,{value:"Module"}));export{X as a,H as b,V as c,ke as k,$ as p,E as t};
