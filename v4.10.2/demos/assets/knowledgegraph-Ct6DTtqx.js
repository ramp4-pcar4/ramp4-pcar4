const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-CBWKFPRe.js","./main-B5_XOOwi.js","./preload-helper-ExcqyqRp.js","./main-wZMPJMua.css","./Relationship-gA-dZFoU.js"])))=>i.map(i=>d[i]);
import{_ as E}from"./preload-helper-ExcqyqRp.js";import{b as x,K as F,D as I,cK as P,a2 as N,cL as J}from"./main-B5_XOOwi.js";import{t as Q,N as T}from"./arcadeUtils-CAt7iUut.js";import{i as W,a as l,r as u,d as b,P as w,$ as V,Y as j,E as v,B as L,z as G,k as D,t as M,g as B,T as C,Z as K,_ as O}from"./languageUtils-DTWctFgX.js";import{l as z}from"./portalUtils-Q7kcwg7B.js";import{_ as U,W as Y,K as Z}from"./projection-DwpqUf7U.js";import H from"./PortalItem-CktkXSu9.js";import{p as X,n as $}from"./project-D1JlHXr3.js";import{s as tt,m as nt,t as rt,p as et,c as it}from"./Relationship-gA-dZFoU.js";import"./TimeOnly-sZc6VCBg.js";import"./UnknownTimeZone-D-YXmXYN.js";import"./ImmutableArray-BPVd6ESQ.js";import"./featureConversionUtils-Cis_UHTR.js";import"./OptimizedFeature-CIptWNVu.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-BNj5OlWf.js";import"./number-CSzzveSU.js";import"./shared-CDtG7bIM.js";import"./Field-q5OmBPu1.js";import"./fieldType-DlCBsK54.js";import"./uuid-Cl5lrJ4c.js";import"./Query-De_HsvnG.js";import"./TimeExtent-ClRYiBYy.js";import"./projectBuffer-D86redIv.js";import"./utils-DSGzLx6N.js";import"./utils-WXIwzruR.js";let f=null;async function at(t){const n=F.geometryServiceUrl??"";if(!n){U()||await Y();for(const r of t)r.container[r.indexer]=Z(r.container[r.indexer],I.WGS84);return}const e=t.map(r=>r.container[r.indexer]),a=new X({geometries:e,outSpatialReference:I.WGS84}),s=await $(n,a);for(let r=0;r<s.length;r++){const i=t[r];i.container[i.indexer]=s[r]}}async function k(t,n){const e=new H({portal:t,id:n});return await e.load(),f===null&&(f=await E(()=>import("./knowledgeGraphService-CBWKFPRe.js").then(a=>a.k),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),await f.fetchKnowledgeGraph(e.url)}function R(t,n,e,a,s){if(t===null)return null;if(w(t)||G(t))return t;if(D(t)||D(t))return t.toJSDate();if(M(t))return t.toStorageFormat();if(B(t))return t.toStorageString();if(C(t)){const r={};for(const i of t.keys())r[i]=R(t.field(i),n,e,a,s),r[i]instanceof P&&s.push({container:r,indexer:i});return r}if(v(t)){const r=t.map(i=>R(i,n,e,a,s));for(let i=0;i<r.length;i++)r[i]instanceof P&&s.push({container:r,indexer:i});return r}return K(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&n?N(t):t:void 0}function ot(t,n){if(!t)return t;if(t.spatialReference.isWGS84&&n.spatialReference.isWebMercator)return J(t);if(t.spatialReference.equals(n.spatialReference))return t;throw new l(n,u.WrongSpatialReference,null)}function S(t,n){if(!t)return null;const e={};for(const a in t)e[a]=m(t[a],n);return e}function m(t,n){return t===null?null:v(t)?t.map(e=>m(e,n)):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:S(t.properties,n)}:t instanceof rt?{graphType:"object",properties:S(t.properties,n)}:t instanceof et?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:S(t.properties,n)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(e=>m(e,n)):null}:K(t)?ot(t,n):w(t)||G(t)||O(t)?t:null}function Kt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(n,e){return t.standardFunctionAsync(n,e,(a,s,r)=>{if(W(r,2,2,n,e),r[0]===null)throw new l(n,u.PortalRequired,e);if(r[0]instanceof Q){const d=b(r[1]);let c;return c=n.services?.portal?n.services.portal:x.getDefault(),k(z(r[0],c),d)}if(w(r[0])===!1)throw new l(n,u.InvalidParameter,e);const i=b(r[0]);return k(n.services?.portal??x.getDefault(),i)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(n,e){return t.standardFunctionAsync(n,e,async(a,s,r)=>{W(r,2,4,n,e);const i=r[0];if(!V(i))throw new l(n,u.InvalidParameter,e);const d=r[1];if(!w(d))throw new l(n,u.InvalidParameter,e);f===null&&(f=await E(()=>import("./knowledgeGraphService-CBWKFPRe.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4]),import.meta.url));let c=null;const h=j(r[2],null);if(!(h instanceof T||h===null))throw new l(n,u.InvalidParameter,e);if(h){let o=[];c=R(h,!0,!1,n,o),o=o.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),o.length>0&&await at(o)}const _=new tt({openCypherQuery:d,bindParameters:c});(i?.serviceDefinition?.currentVersion??11.3)>11.2&&(_.outputSpatialReference=n.spatialReference);const q=(await f.executeQueryStreaming(i,_)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:o,value:p}=await q.read();if(o)break;if(v(p))for(const g of p)y.push(m(g,n));else{const g=[];for(const A of p)g.push(m(p[A],n));y.push(g)}}}catch(o){throw o}return T.convertJsonToArcade(y,L(n),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Kt as registerFunctions};
