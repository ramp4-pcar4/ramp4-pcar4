{"version":3,"file":"mapCollectionUtils-DB-YOmiV.js","sources":["../../node_modules/@arcgis/core/core/mapCollectionUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"./asyncUtils.js\";import t from\"./Collection.js\";import{removeIfHandle as o,destroyHandle as s}from\"./handleUtils.js\";import{isAborted as r,createAbortError as n,ignoreAbortErrors as i}from\"./promiseUtils.js\";import{on as a}from\"./reactiveUtils.js\";function c(e,o,s){const r=s?.createCollection?.()??new t,n=!!s?.recycleItems?new d:null,i=(e,t=0)=>{if(!e?.length)return;const o=r.splice(t,e.length);n?n.processRemoved(e):o.forEach(m)},c=(e,t=0)=>{if(!e?.length)return;const s=[];for(const r of e){const e=n?.use(r);if(e)s.push(e);else{const e=o(r);n?.register(r,e),s.push(e)}}r.addMany(s,t)},l=a(e,\"after-splice\",({added:e,start:t,removed:o})=>{i(o,t),c(e,t)},{sync:!0,onListenerRemove:e=>i(e.items),onListenerAdd:e=>c(e.items)});return r.addHandles(l),r}class d{constructor(){this._originalToMapped=new Map,this._removedItemCandidates=new Set,this._garbageCollectionQueued=!1}processRemoved(e){if(!e?.length)return;const{_removedItemCandidates:t}=this;for(const o of e)this._getItem(o)?.markRemoved()&&(t.add(o),this._queueGarbageCollection())}use(e){const t=this._getItem(e);return t&&(t.removed=!1),t?.item}register(e,t){this._originalToMapped.set(e,new l(t))}_getItem(e){return this._originalToMapped.get(e)}_queueGarbageCollection(){this._garbageCollectionQueued||(this._garbageCollectionQueued=!0,queueMicrotask(()=>this._garbageCollectCandidates()))}_garbageCollectCandidates(){this._garbageCollectionQueued=!1;const{_removedItemCandidates:e}=this,t=Array.from(e);e.clear(),t.forEach(e=>this._garbageCollectIfRemoved(e))}_garbageCollectIfRemoved(e){const{_originalToMapped:t}=this,o=this._getItem(e);o?.removed&&(m(o.item),t.delete(e))}}class l{constructor(e){this.item=e,this.removed=!1}markRemoved(){return this.removed=!0,!0}}function m(e){\"object\"==typeof e&&e&&(\"destroy\"in e&&\"function\"==typeof e.destroy?e.destroy():o(e))}function u(o,a,d){const l=new t,u=c(o,t=>e(async e=>{const o=await a(t,e);if(r(e))throw m(o),n();return o}),d),f=()=>null,g=async e=>{const t=await e.promise,o=u.indexOf(e);o<0||l.splice(o,1,t)};l.addMany(u.items.map(f));for(const e of u)i(g(e));const h=u.on(\"after-splice\",({added:e,start:t,deleteCount:o})=>{const s=l.splice(t,o);for(const r of s)m(r);if(e?.length){l.addMany(e.map(f),t);for(const t of e)i(g(t))}});return l.addHandles([s(u),h]),l}export{c as mapCollection,u as mapCollectionAsync};\n"],"names":["c","e","o","r","t","n","d","i","s","l","a","u","f","g","h"],"mappings":"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","x_google_ignoreList":[0]}