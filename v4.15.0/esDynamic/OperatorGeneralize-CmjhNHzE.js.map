{"version":3,"file":"OperatorGeneralize-CmjhNHzE.js","sources":["../../node_modules/@arcgis/core/chunks/OperatorGeneralize.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__addDisposableResource as t,__disposeResources as e}from\"tslib\";import{G as s}from\"./SimpleGeometryCursor.js\";import{a as i,c as r,e as n,G as a,f as h,h as m,t as l}from\"./Geometry.js\";import{a as o,P as c,L as u}from\"./MultiPathImpl.js\";import{P as _}from\"./Envelope.js\";import{h as g,P as p,c as k}from\"./Point2D.js\";import{O as f}from\"./OperatorDensify.js\";class P{getOperatorType(){return 10204}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,i){return new y(t,e,s,i)}execute(t,e,s,r){t||i(\"null param is not allowed.\");return new y(null,e,s,r).generalize(t)}}class y extends s{constructor(t,e,s,i){super(),this.m_pline=null,this.m_point=new _,this.m_stack=[],this.m_resultstack=[],this.m_callCount=0,this.m_progressTracker=i,this.m_geoms=t,this.m_maxDeviation=e,this.m_bRemoveDegenerateParts=s}tock(){return!0}getRank(){return 1}next(){const t=this.m_geoms.next();return null===t?null:(r(t),this.generalize(t))}getGeometryID(){return this.m_geoms.getGeometryID()}generalize(s){const i=s.getGeometryType();if(n(i))return s;if(i===a.enumEnvelope){const t=new o({vd:s.getDescription()});return t.addEnvelope(s,!1),this.generalize(t)}if(h(i)){const t=new c({vd:s.getDescription()});return t.addSegment(s,!0),this.generalize(t)}if(m(i)||l(\"\"),s.isEmpty()||this.m_maxDeviation<=0)return s;const r=(new f).execute(s,0,.05*this.m_maxDeviation,0,this.m_progressTracker);s.hasNonLinearSegments()&&(this.m_maxDeviation*=.95);const _=r,p=s.createInstance();if(p.getGeometryType()===a.enumPolygon){p.setFillRule(s.getFillRule())}this.m_xy=_.getAttributeStreamRef(0);{const s={stack:[],error:void 0,hasError:!1};try{const e=new u;this.m_pline=e,t(s,g(()=>{this.m_pline=null},!1),!1);for(let t=0,s=_.getPathCount();t<s;t++)this.generalizePath(_.getImpl(),t,p.getImpl())}catch(k){s.error=k,s.hasError=!0}finally{e(s)}}return this.m_resultstack.length=0,this.m_stack.length=0,p}generalizePath(t,e,s){if(t.getPathSize(e)<2)return;this.m_resultstack.length=0,this.m_stack.length=0;const i=t.getPathStart(e),r=t.getPathEnd(e)-1,n=t.isClosedPath(e),a=t.isClosedPathInXYPlane(e);let h=0,m=-1;this.m_stack.push(n?i:r),this.m_stack.push(i);let l=!1,o=!1;for(!this.m_bRemoveDegenerateParts&&a&&(l=!0,o=!0);this.m_stack.length>1;){const e=this.m_stack.at(-1);this.m_stack.pop();const s=this.m_stack.at(-1);let i=t.getXY(e);this.m_pline.setStartXY(i),i=t.getXY(s),this.m_pline.setEndXY(i);const n=[Number.NaN];let a=this.findGreatestDistance(e,s,r,n);a>=0&&(l?l=!1:(o&&n[0]>h&&(h=n[0],m=a),n[0]<=this.m_maxDeviation&&(a=-1))),a>=0?(this.m_stack.push(a),this.m_stack.push(e)):this.m_resultstack.push(e)}n||this.m_resultstack.push(this.m_stack[0]);const c=this.m_resultstack.length;if(c===t.getPathSize(e)&&c===this.m_stack.length)s.addPath(t,e,!0);else if(this.m_resultstack.length>0){if(this.m_bRemoveDegenerateParts&&this.m_resultstack.length<=2){if(n||1===this.m_resultstack.length)return;if(p.distance(t.getXY(this.m_resultstack[0]),t.getXY(this.m_resultstack[1]))<=this.m_maxDeviation)return}if(o&&m>=0&&h<=this.m_maxDeviation){const t=this.m_resultstack.at(-1)>m;this.m_resultstack.push(m),t&&(this.m_resultstack[this.m_resultstack.length-2]=k(this.m_resultstack[this.m_resultstack.length-1],this.m_resultstack[this.m_resultstack.length-1]=this.m_resultstack[this.m_resultstack.length-2]))}for(let e=0,i=this.m_resultstack.length;e<i;e++)t.getPointByVal(this.m_resultstack[e],this.m_point),0===e?s.startPathPoint(this.m_point):s.lineToPoint(this.m_point);if(n){for(let t=this.m_resultstack.length;t<3;t++)s.lineToPoint(this.m_point);s.closePathWithLine()}}}findGreatestDistance(t,e,s,i){let r=e-1;e<=t&&(r=s);let n=-1,a=0;const h=new p;for(let m=t+1;m<=r;m++){this.m_xy.queryPoint2D(2*m,h);const t=h.x,e=h.y,s=this.m_pline.getClosestCoordinate(h,!1);h.assign(this.m_pline.getCoord2D(s)),h.x-=t,h.y-=e;const i=h.length();i>a&&(n=m,a=i),this.m_callCount++}return i[0]=a,n}}export{P as O};\n"],"names":["P","s","i","y","r","_","n","a","t","o","h","c","m","l","f","p","e","u","g","k"],"mappings":"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","x_google_ignoreList":[0]}