{"version":3,"file":"index-59Dnculh.js","sources":["../../src/fixtures/keyboardnav/lang/lang.csv?raw","../../src/fixtures/keyboardnav/keyboardnav.vue","../../src/fixtures/keyboardnav/api/keyboardnav.ts","../../src/fixtures/keyboardnav/index.ts"],"sourcesContent":["export default \"key,enValue,enValid,frValue,frValid\\nkeyboardnav.activeNamespace,Namespace Active: {name},1,Espace de noms actif : {name},0\\nkeyboardnav.helpTitle,Keyboard Shortcuts,1,Raccourcis clavier,0\\nkeyboardnav.keysTitle,Keys for {name},1,Raccourcis pour {name},0\\nkeyboardnav.helpDescription,Press <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">S</span> to start fixture shortcuts then type the fixture key (for example <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">D</span>) followed by an action key like <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">L</span>. Use <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">Escape</span> to clear the chain or <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">Backspace</span> to undo the last key.,1,Appuyez sur <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">S</span> pour démarrer les raccourcis de module puis saisissez la touche du module (par exemple <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">D</span>) suivie d'une touche d'action comme <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">L</span>. Utilisez <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">Échap</span> pour effacer la chaîne ou <span class=\\\"font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\\\">Retour</span> pour enlever la dernière touche.,0\\nkeyboardnav.noShortcuts,No shortcuts available.,1,Aucun raccourci disponible.,0\\nkeyboardnav.mainShortcuts.title,Global controls,1,Contrôles globaux,0\\nkeyboardnav.mainShortcuts.numbers,Focus on an open panel (1 being leftmost),1,Concentrer sur un panneau ouvert (1 étant le plus à gauche),0\\nkeyboardnav.mainShortcuts.escape,Clear the chain or close the focused panel,1,Effacer la chaîne ou fermer le panneau actif,0\\nkeyboardnav.mainShortcuts.start,Start or reset fixture shortcuts,1,Démarrer ou réinitialiser les raccourcis de module,0\\nkeyboardnav.mainShortcuts.backspace,Remove the last key in the chain,1,Retirer la dernière touche de la chaîne,0\\nkeyboardnav.chain.help,Toggle shortcut guide,1,Afficher ou masquer le guide des raccourcis,0\\n\"","<template>\n    <div\n        v-if=\"helpVisible\"\n        class=\"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity pointer-events-auto\"\n        tabindex=\"-1\"\n        @click=\"handleOverlayClick\"\n    >\n        <div\n            ref=\"dialogRef\"\n            class=\"relative w-[640px] max-h-[80vh] overflow-y-auto rounded-xl bg-white py-8 px-10 shadow-xl\"\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-live=\"polite\"\n        >\n            <button\n                type=\"button\"\n                class=\"absolute right-8 top-8 text-gray-500 hover:text-black focus:text-black p-4\"\n                :aria-label=\"t('panels.controls.close')\"\n                @click=\"closeHelp\"\n            >\n                <svg class=\"fill-current w-16 h-16\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 352 512\">\n                    <path\n                        d=\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\"\n                    />\n                </svg>\n            </button>\n            <div class=\"border-b border-gray-200 bg-white px-4 py-20 sm:px-24\">\n                <h3 class=\"text-base font-semibold text-gray-900\">{{ t('keyboardnav.helpTitle') }}</h3>\n                <div v-html=\"t('keyboardnav.helpDescription')\" class=\"mt-6 text-sm text-gray-500\"></div>\n            </div>\n            <ul\n                role=\"list\"\n                class=\"m-0 max-w-[calc(var(--container-lg)-(--spacing(8)))] list-none divide-y divide-zinc-900/5 p-0 dark:divide-white/5\"\n            >\n                <li class=\"pl-24 mb-8 py-16\">\n                    <div class=\"flex items-center gap-x-12\">\n                        <span class=\"font-mono text-md text-zinc-600\">\n                            {{ t('keyboardnav.mainShortcuts.title') }}\n                        </span>\n                    </div>\n\n                    <div class=\"space-y-4 p-16 pl-24\">\n                        <div class=\"flex items-center gap-x-12\">\n                            <span\n                                class=\"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\"\n                            >\n                                1-5\n                            </span>\n                            <span class=\"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600\"></span>\n                            <span class=\"font-mono text-md text-zinc-600\">\n                                {{ t('keyboardnav.mainShortcuts.numbers') }}\n                            </span>\n                        </div>\n                        <div class=\"flex items-center gap-x-12\">\n                            <span\n                                class=\"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\"\n                            >\n                                ESC\n                            </span>\n                            <span class=\"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600\"></span>\n                            <span class=\"font-mono text-md text-zinc-600\">\n                                {{ t('keyboardnav.mainShortcuts.escape') }}\n                            </span>\n                        </div>\n                        <div class=\"flex items-center gap-x-12\">\n                            <span\n                                class=\"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\"\n                            >\n                                S\n                            </span>\n                            <span class=\"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600\"></span>\n                            <span class=\"font-mono text-md text-zinc-600\">\n                                {{ t('keyboardnav.mainShortcuts.start') }}\n                            </span>\n                        </div>\n                        <div class=\"flex items-center gap-x-12\">\n                            <span\n                                class=\"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\"\n                            >\n                                Backspace\n                            </span>\n                            <span class=\"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600\"></span>\n                            <span class=\"font-mono text-md text-zinc-600\">\n                                {{ t('keyboardnav.mainShortcuts.backspace') }}\n                            </span>\n                        </div>\n                    </div>\n                </li>\n                <li v-if=\"namespaceEntries.length === 0\" class=\"pl-24 mb-8 py-16 border-b\">\n                    <p class=\"font-mono text-md text-zinc-600\">\n                        {{ t('keyboardnav.noShortcuts') }}\n                    </p>\n                </li>\n                <li v-for=\"entry in namespaceEntries\" :key=\"entry.id\" class=\"pl-24 mb-8 py-16 border-b\">\n                    <div\n                        class=\"flex items-center gap-x-12\"\n                        :class=\"{ 'opacity-60': activeNamespace && activeNamespace !== entry.id }\"\n                    >\n                        <div class=\"flex items-center gap-x-4\">\n                            <span\n                                class=\"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\"\n                                >S</span\n                            >\n                            <span\n                                class=\"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\"\n                                >{{ entry.id }}</span\n                            >\n                        </div>\n                        <span class=\"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600\"></span>\n                        <span class=\"font-mono text-md text-zinc-600\">\n                            {{ t(`keyboardnav.ns.${entry.id}`) }}\n                        </span>\n                    </div>\n\n                    <div v-if=\"entry.keys.length\" class=\"space-y-4 p-16 pl-24\">\n                        <div v-for=\"item in entry.keys\" :key=\"item.key\" class=\"flex items-center gap-x-12\">\n                            <div class=\"flex items-center gap-x-4\">\n                                <span\n                                    class=\"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400\"\n                                    >{{ item.key }}</span\n                                >\n                            </div>\n                            <span class=\"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600\"></span>\n                            <span class=\"font-mono text-md text-zinc-600\">\n                                {{ t(`keyboardnav.key.${entry.id}.${item.key}`) }}\n                            </span>\n                        </div>\n                    </div>\n                </li>\n            </ul>\n        </div>\n    </div>\n</template>\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia';\nimport { useKeyboardnavStore } from './store/keyboardnav-store';\nimport { computed, useTemplateRef, watch, nextTick, inject, ref } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport type { InstanceAPI } from '@/api';\n\nconst store = useKeyboardnavStore();\nconst { activeNamespace, namespaces, helpVisible } = storeToRefs(store);\nconst { t } = useI18n();\n\nconst namespaceEntries = computed(() =>\n    Object.entries(namespaces.value).map(([id, options]) => ({\n        id,\n        keys: options?.keys ?? []\n    }))\n);\n\nconst dialogRef = useTemplateRef('dialogRef');\nconst iApi = inject('iApi') as InstanceAPI | undefined;\nconst previouslyFocused = ref<HTMLElement | null>(null);\n\nconst FOCUSABLE_SELECTOR =\n    'button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])';\n\nfunction ensureElementFocusable(el: HTMLElement | null): HTMLElement | null {\n    if (!el) return null;\n    if (el.tabIndex < 0) {\n        el.setAttribute('tabindex', '-1');\n    }\n    return el;\n}\n\nfunction focusFirstElement(): void {\n    const dialogEl = dialogRef.value;\n    if (!dialogEl) return;\n\n    const firstFocusable = dialogEl.querySelector<HTMLElement>(FOCUSABLE_SELECTOR);\n    const target = ensureElementFocusable(firstFocusable ?? dialogEl);\n    target?.focus({ preventScroll: true });\n}\n\nfunction getMapFocusTarget(): HTMLElement | null {\n    const container = (iApi?.geo?.map?.esriView?.container as HTMLElement | null) ?? document.getElementById('esriMap');\n    if (!container) return null;\n\n    const candidate =\n        container.querySelector<HTMLElement>('.esri-view-surface') ??\n        container.querySelector<HTMLElement>(FOCUSABLE_SELECTOR);\n\n    return candidate ?? container;\n}\n\nfunction focusMapElement(): void {\n    const mapTarget = getMapFocusTarget();\n    const fallback =\n        previouslyFocused.value && document.contains(previouslyFocused.value) ? previouslyFocused.value : null;\n    const target = ensureElementFocusable(mapTarget ?? fallback);\n    target?.focus({ preventScroll: true });\n    previouslyFocused.value = null;\n}\n\nfunction closeHelp() {\n    store.setHelpVisible(false);\n    store.resetChain({ suppressHandler: true });\n}\n\nfunction handleOverlayClick(e: MouseEvent) {\n    // If the click is directly on the overlay (dark background) and not on the dialog\n    if (e.target === e.currentTarget) {\n        closeHelp();\n    }\n}\n\nwatch(helpVisible, async val => {\n    if (val) {\n        previouslyFocused.value = document.activeElement instanceof HTMLElement ? document.activeElement : null;\n        await nextTick();\n        if (helpVisible.value) {\n            focusFirstElement();\n        }\n    } else {\n        await nextTick();\n        if (!helpVisible.value) {\n            focusMapElement();\n        }\n    }\n});\n</script>\n\n<style lang=\"scss\">\n.key {\n    @apply contents font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg ring-1 ring-inset;\n\n    &.indigo {\n        @apply ring-indigo-300 bg-indigo-400/10 text-indigo-500 dark:ring-indigo-400/30 dark:bg-indigo-400/10 dark:text-indigo-400;\n    }\n\n    &.zinc {\n        @apply ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400;\n    }\n}\n</style>\n","import { FixtureInstance } from '@/api';\nimport { useKeyboardnavStore } from '../store/keyboardnav-store';\nimport type { NamespaceRegistration } from '../store/keyboardnav-store';\nimport type { KeyboardnavChainAction } from '../types';\nimport { ROOT_KEY, HELP_NAMESPACE } from '../constants';\n\n/**\n * @internal\n */\nexport class KeyboardnavAPI extends FixtureInstance {\n    private keyboardnavStore = useKeyboardnavStore(this.$vApp.$pinia);\n    private _isInput(target: EventTarget | null): boolean {\n        if (!target || !(target instanceof HTMLElement)) return false;\n        return !!target.closest('input, textarea, [contenteditable=\"true\"]');\n    }\n\n    /**\n     * Register a namespace letter and its keyboard options.\n     *\n     * @param namespace requested namespace letter.\n     * @param options registration object describing keys and handlers.\n     * @returns final namespace letter used for registration.\n     */\n    register(namespace: string, options: NamespaceRegistration): string {\n        const ns = namespace.toUpperCase();\n        const finalNs = this.keyboardnavStore.register(ns, options);\n        const key = `keyboardnav.ns.${finalNs}`;\n        Object.entries(options.name).forEach(([lang, val]) => {\n            (<any>this.$iApi.$i18n).mergeLocaleMessage(lang, { [key]: val });\n        });\n        options.keys.forEach(k => {\n            const kKey = `keyboardnav.key.${finalNs}.${k.key}`;\n            Object.entries(k.description).forEach(([lang, val]) => {\n                (<any>this.$iApi.$i18n).mergeLocaleMessage(lang, { [kKey]: val });\n            });\n        });\n        return finalNs;\n    }\n\n    /**\n     * Removes a namespace registration and associated handlers.\n     */\n    unregister(namespace: string): void {\n        this.keyboardnavStore.unregister(namespace.toUpperCase());\n    }\n\n    /**\n     * Returns the navigation chain to the active namespace so another action can be\n     * selected without restarting the shortcut sequence.\n     */\n    reset(): KeyboardnavChainAction {\n        const store = this.keyboardnavStore;\n        const nsKey = store.activeNamespace ?? store.keyChain[1];\n        if (!nsKey) {\n            store.resetChain({ suppressHandler: true });\n            return 'reset';\n        }\n        store.setChain([ROOT_KEY, nsKey]);\n        store.setLastAction(undefined);\n        store.setChainState('awaitAction');\n        store.activeNamespace = nsKey;\n        return 'reset';\n    }\n\n    /**\n     * Clears the active navigation chain and returns the system to the idle state.\n     */\n    clear(event?: KeyboardEvent): KeyboardnavChainAction {\n        this.keyboardnavStore.resetChain({ event, suppressHandler: true });\n        return 'clear';\n    }\n\n    /** @internal */\n    added(): void {\n        const root = this.$iApi.$rootEl as HTMLElement | null;\n        root?.addEventListener('keydown', this._handleKeyDown);\n        root?.addEventListener('blur', this._handleBlur);\n    }\n\n    /** @internal */\n    removed(): void {\n        const root = this.$iApi.$rootEl as HTMLElement | null;\n        root?.removeEventListener('keydown', this._handleKeyDown);\n        root?.removeEventListener('blur', this._handleBlur);\n    }\n\n    private _handleKeyDown = (event: Event): void => {\n        if (!(event instanceof KeyboardEvent)) return;\n        const e = event;\n        if (this._isInput(e.target)) return;\n\n        const store = this.keyboardnavStore;\n        const chain = store.keyChain;\n        const hasModifier = e.altKey || e.ctrlKey || e.metaKey;\n\n        if (!e.shiftKey && !hasModifier) {\n            if (!chain.length && /^[1-5]$/.test(e.key)) {\n                const idx = parseInt(e.key, 10) - 1;\n                const panel = this.$iApi.panel.visible[idx];\n                if (panel) {\n                    e.preventDefault();\n                    this.$iApi.panel.focus(panel);\n                }\n                return;\n            }\n        }\n\n        const rawKey = e.key;\n        const key = rawKey.length === 1 ? rawKey.toUpperCase() : rawKey;\n\n        if (!hasModifier && key === 'Escape' && store.helpVisible) {\n            e.preventDefault();\n            store.setHelpVisible(false);\n            store.resetChain({ suppressHandler: true });\n            return;\n        }\n\n        if (!e.shiftKey && !hasModifier && key === ROOT_KEY) {\n            e.preventDefault();\n            const suppressHandler = store.chainState === 'complete';\n            store.resetChain({ suppressHandler });\n            store.setChain([ROOT_KEY]);\n            store.setLastAction(undefined);\n            store.setChainState('awaitNamespace');\n            return;\n        }\n\n        if (store.chainState === 'idle') {\n            if (key === 'Escape' && !e.shiftKey && !hasModifier) {\n                const target = e.target as HTMLElement;\n                const container = target.closest('[data-cy]') as HTMLElement | null;\n                if (container && this.$iApi.$rootEl?.querySelector('.panel-container')?.contains(container)) {\n                    e.preventDefault();\n                    const id = container.getAttribute('data-cy');\n                    if (id) {\n                        this.$iApi.panel.close(id);\n                    }\n                }\n            }\n            return;\n        }\n\n        if (key === 'Escape') {\n            e.preventDefault();\n            store.resetChain({ event: e });\n            return;\n        }\n\n        if (key === 'Backspace') {\n            if (!chain.length) return;\n            e.preventDefault();\n            const previousState = store.chainState;\n            store.setLastAction(undefined);\n            store.popChain();\n\n            if (!store.keyChain.length) {\n                store.resetChain({ suppressHandler: true });\n                return;\n            }\n\n            if (store.keyChain.length === 1) {\n                store.setChainState('awaitNamespace');\n                store.deactivate(e);\n                return;\n            }\n\n            if (store.keyChain.length === 2) {\n                store.setChainState('awaitAction');\n                const namespaceKey = store.keyChain[1];\n                if (previousState === 'complete' && namespaceKey) {\n                    store.activate(namespaceKey, e, { suppressHandler: false });\n                }\n                return;\n            }\n\n            return;\n        }\n\n        if (e.shiftKey || hasModifier) {\n            return;\n        }\n\n        if (store.chainState === 'awaitNamespace') {\n            const namespaces = Object.keys(store.namespaces);\n\n            if (key === 'H') {\n                e.preventDefault();\n                store.appendKey('H');\n                store.setLastAction({ namespace: HELP_NAMESPACE, key: 'H' });\n                store.finalizeChain({ event: e });\n                store.setHelpVisible(!store.helpVisible);\n                return;\n            }\n\n            if (namespaces.includes(key)) {\n                e.preventDefault();\n                store.appendKey(key);\n                store.setLastAction(undefined);\n                store.activate(key, e);\n                store.setChainState('awaitAction');\n                return;\n            }\n\n            return;\n        }\n\n        if (store.chainState === 'awaitAction') {\n            const namespaceKey = store.activeNamespace ?? (chain[1] || '');\n            const namespace = store.namespaces[namespaceKey];\n            if (!namespace) {\n                store.resetChain({ suppressHandler: true });\n                return;\n            }\n\n            const validKeys = namespace.keys.map(item => item.key.toUpperCase());\n            if (!validKeys.includes(key)) {\n                return;\n            }\n\n            e.preventDefault();\n            store.appendKey(key);\n            const action = store.trigger(key, e);\n            if (action?.chainAction) {\n                return;\n            }\n            if (action) {\n                store.setLastAction(action);\n            }\n            store.finalizeChain({ event: e });\n            return;\n        }\n    };\n\n    private _handleBlur = (): void => {\n        this.keyboardnavStore.resetChain();\n        this.keyboardnavStore.setHelpVisible(false);\n    };\n}\n","import messages from './lang/lang.csv?raw';\nimport KeyboardnavV from './keyboardnav.vue';\nimport { KeyboardnavAPI } from './api/keyboardnav';\nimport { useKeyboardnavStore } from './store/keyboardnav-store';\n\nclass KeyboardnavFixture extends KeyboardnavAPI {\n    added(): void {\n        // merge translations\n        Object.entries(messages).forEach(value => (<any>this.$iApi.$i18n).mergeLocaleMessage(...value));\n\n        const { destroy, el } = this.mount(KeyboardnavV, {\n            app: this.$element\n        });\n        const innerShell = this.$vApp.$el.getElementsByClassName('inner-shell')[0];\n        innerShell.appendChild(el.childNodes[0]);\n\n        super.added();\n\n        this.removed = () => {\n            super.removed();\n            destroy();\n            useKeyboardnavStore(this.$vApp.$pinia).$reset();\n        };\n    }\n}\n\nexport default KeyboardnavFixture;\n"],"names":["messages","FOCUSABLE_SELECTOR","store","useKeyboardnavStore","activeNamespace","namespaces","helpVisible","storeToRefs","t","useI18n","namespaceEntries","computed","id","options","dialogRef","useTemplateRef","iApi","inject","previouslyFocused","ref","ensureElementFocusable","el","focusFirstElement","dialogEl","firstFocusable","getMapFocusTarget","container","focusMapElement","mapTarget","fallback","closeHelp","handleOverlayClick","e","watch","val","nextTick","KeyboardnavAPI","FixtureInstance","target","namespace","ns","finalNs","key","lang","k","kKey","nsKey","ROOT_KEY","event","root","chain","hasModifier","idx","panel","rawKey","suppressHandler","previousState","namespaceKey","HELP_NAMESPACE","item","action","KeyboardnavFixture","value","destroy","KeyboardnavV"],"mappings":"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"}