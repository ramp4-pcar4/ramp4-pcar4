import{fy as G,ar as x,fR as ie,e8 as s,e9 as t,ea as g,fU as $,fJ as J,fI as Y,iG as me,fL as Q,fM as O,e7 as ne,ij as X,fC as L,fK as N,fD as A,iq as ye,fW as ue,fz as W,lt as re,fP as ee,fQ as V,fT as te,fG as w,fE as Z,fS as le,kP as fe,jm as oe,m3 as je,ly as ge,iA as Ie,m4 as ze,fq as ae,fV as de,fH as he,fF as Ce}from"./main-pOgmbpmS.js";import{T as He}from"./toggle-switch-control-DkzRBlGo.js";const De={key:0,class:"relative"},qe={key:0,class:"relative"},Oe=["innerHTML"],$e=["src"],Se={key:1,class:"w-32 h-32"},Be={class:"symbologyIcon"},Ne=["innerHTML"],Ae=["src"],Fe={class:"badge z-50 rounded-full text-white absolute h-10 w-10 p-8 inline-flex items-center justify-center"},Pe={key:0,class:"px-5"},Ge={key:1,class:"inline-flex justify-center items-center relative"},Ue=G({__name:"symbology-stack",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0}},setup(p){const j=p,l=x([]);return ie(()=>{l.value=j.layer.legend}),(d,f)=>p.result.loaded?(t(),s("div",De,[g("div",{class:Q(p.result.items.length===0?"opacity-50":"")},[l.value.length>1?(t(),s("div",qe,[(t(!0),s(J,null,Y(l.value.slice(0,3).reverse(),(h,m)=>(t(),s("div",{class:Q(["absolute",[m==0?"symbol-0":m==1?"left-3":"left-6"]]),style:me({"z-index":3-m}),key:m},[l.value[m].svgcode?(t(),s("span",{key:0,class:"symbologyIcon w-28 h-28",innerHTML:l.value[m].svgcode},null,8,Oe)):l.value[m].imgUrl?(t(),s("img",{key:1,class:"symbologyIcon w-28 h-28",src:l.value[m].imgUrl},null,8,$e)):$("",!0)],6))),128))])):l.value.length>0?(t(),s("div",Se,[g("div",Be,[l.value[0].svgcode?(t(),s("span",{key:0,innerHTML:l.value[0].svgcode},null,8,Ne)):l.value[0].imgUrl?(t(),s("img",{key:1,class:"symbologyIcon w-full h-full",src:l.value[0].imgUrl},null,8,Ae)):$("",!0)])])):$("",!0)],2),g("div",Fe,[p.result.loaded?(t(),s("div",Pe,O(p.result.items.length),1)):$("",!0)])])):(t(),s("div",Ge,f[0]||(f[0]=[g("div",{class:"symbologyIcon h-32 w-32"},[g("div",{class:"relative animate-spin spinner h-24 w-24"})],-1)])))}}),Re=ne(Ue,[["__scopeId","data-v-496d788d"]]),Qe=["content"],Ve={class:"symbologyLayerName truncate"},We=G({__name:"symbology-item",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0},selected:{type:Boolean,required:!0}},setup(p){const j=X(),l=L(()=>j.properties),d=p,f=()=>{const h=d.layer;return h&&l.value[h.id]&&l.value[h.id].name?l.value[h.id].name:h?.name??""};return(h,m)=>{const H=N("tippy");return A((t(),s("button",{class:Q(["flex flex-grow justify-start items-center px-7 py-10 default-focus-style symbologyStackButton truncate",p.selected?"detailsButtonSelected":"px-11"]),onClick:m[0]||(m[0]=ye(()=>{},["stop"])),content:f()},[ue(Re,{class:"symbStack w-32 h-32 mr-10",layer:p.layer,result:p.result},null,8,["layer","result"]),g("div",Ve,O(f()),1)],10,Qe)),[[H,{placement:"right",sticky:!0}]])}}}),Ze=["content"],Je=G({__name:"symbology-list",props:{results:{type:Object,required:!0},selected:{type:String,required:!0}},emits:["selection-changed"],setup(p,{emit:j}){const{t:l}=W(),d=re(),f=x(),h=()=>{f.value._tippy.hide()},m=u=>{u.key==="Tab"&&f.value?.matches(":focus")&&f.value._tippy.show()},H=j,z=p,e=x(""),o=x([]),r=x(!1),i=x(!1),y=u=>d.getLayerByUid(u),v=u=>{e.value=u,H("selection-changed",u),r.value=!1},b=()=>{i.value||setTimeout(()=>{r.value=i.value},500),i.value=!0},S=()=>{r.value=i.value=!1},D=()=>{i.value||(r.value=!0),i.value=!0},q=()=>{r.value=i.value=!1};return ee(()=>{o.value.push(V(z,()=>{e.value=z.selected}))}),ie(()=>{f.value?.addEventListener("blur",h),f.value?.addEventListener("keyup",m)}),te(()=>{o.value.forEach(u=>u()),f.value?.removeEventListener("blur",h),f.value?.removeEventListener("keyup",m)}),(u,M)=>{const _=N("focus-item"),F=N("focus-list"),I=N("tippy");return A((t(),s("div",{class:Q(["symbology-list absolute overflow-hidden z-50 p-0 w-48 bg-white text-sm inline-flex flex-col",{"symbology-list-expanded":r.value}]),onMouseover:b,onMouseleave:S,onFocus:D,onBlur:ye(q,["self"]),content:w(l)("details.layers.results.list.tooltip"),ref_key:"el",ref:f},[(t(!0),s(J,null,Y(z.results,(B,a)=>(t(),s("div",{class:"flex justify-start relative",key:a},[A((t(),Z(We,{key:B.uid,layer:y(B.uid),result:B,selected:B.uid===e.value,onClick:c=>v(B.uid)},null,8,["layer","result","selected","onClick"])),[[_]])]))),128))],42,Ze)),[[F],[I,{trigger:"manual",placement:"top-start",touch:!1}]])}}}),Ke={class:"inline font-bold"},Ye=["innerHTML"],Xe=G({__name:"esri-default",props:{fixtureFields:{type:Object,required:!1},fields:{type:Object,required:!0},identifyData:{type:Object,required:!0}},setup(p){const{t:j}=W(),l=le("iApi"),d=p,f=(e,o,r,i)=>{const y=e.find(v=>v[o].toLowerCase()===r.toLowerCase());y&&delete i[y.name]},h=()=>{const e=Object.assign({},d.identifyData.data);f(d.fields,"type","geometry",e),l.ui.exposeOids||f(d.fields,"type","oid",e),l.ui.exposeMeasurements||(f(d.fields,"name","shape_length",e),f(d.fields,"name","shape_area",e));const o={};d.fields.forEach(i=>{const y=d.fixtureFields?.find(v=>i.name===v.field);o[i.name]={name:y?.alias||i.alias||i.name,type:i.type,visible:y?.visible??!0}});const r={};Object.keys(e).forEach(i=>{const y=o[i];if(y&&y.visible){const v=e[i];r[i]={value:typeof v=="number"?l.ui.formatNumber(v):v,alias:y.name,type:y.type}}});for(const[i]of Object.entries(r))l.ui.isPlainText(r[i].value)&&(r[i].value=l.ui.escapeHtml(r[i].value));return r},m=(e,o,r)=>{switch(r){case"date":return z(e);default:return H(e,o)}},H=(e,o)=>{if(!e)return e;if(e.trim().match(/\.(jpeg|jpg|gif|png)$/)||e.trim().match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i))return`<img src="${e}" alt="${j("details.item.alert.defaultAltText",{alias:o})}" />`;const r="underline text-blue-700 break-all",i=document.createElement("div");return i.innerHTML=e.trim(),i.firstElementChild?.tagName=="A"?(i.firstElementChild.className=r,i.innerHTML):fe(e,{className:r,target:"_blank",validate:{url:y=>/^https?:\/\//.test(y)}})},z=e=>{const o=parseInt(e);return isNaN(o)?e:new Date(o).toISOString().split("T")[0]};return(e,o)=>(t(),s("div",null,[(t(!0),s(J,null,Y(h(),(r,i,y)=>(t(),s("div",{class:"p-5 pl-3 flex justify-end flex-wrap even:bg-gray-300",key:y},[g("span",Ke,O(r.alias),1),o[0]||(o[0]=g("span",{class:"flex-auto"},null,-1)),g("span",{class:"inline ml-8",innerHTML:m(r.value,r.alias,r.type)},null,8,Ye)]))),128))]))}}),et=["innerHTML"],tt={key:1},lt=G({__name:"html-default",props:{identifyData:{type:Object,required:!0}},setup(p){const{t:j}=W();return(l,d)=>p.identifyData?(t(),s("div",{key:0,class:"whitespace-pre-wrap break-words h-full overflow-auto",innerHTML:p.identifyData.data.data??p.identifyData.data},null,8,et)):(t(),s("div",tt,O(w(j)("details.layers.results.empty")),1))}}),at={class:"relative flex flex-grow truncate"},st={key:0,class:"flex flex-grow items-center truncate"},it={class:"flex p-8 items-center"},nt=["innerHTML"],ut={key:1,class:"symbologyIcon p-6"},rt=["content","innerHTML","tabindex"],ot={key:1,class:"flex p-6 flex-grow"},dt={key:2,class:"zoomButton text-center p-3"},vt=["content","aria-label"],ct={key:0,class:"m-auto animate-spin spinner h-20 w-20"},pt={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"green",class:"m-auto w-20 h-20"},mt={key:2,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"red",class:"m-auto w-20 h-20"},yt=["innerHTML"],be=G({__name:"result-item",props:{uid:{type:String,required:!0},data:{type:Object,required:!0},open:{type:Boolean,required:!1},inList:{type:Boolean,required:!1}},setup(p){const j=re(),l=p,d=le("iApi"),f=x([]),h=X(),{t:m}=W(),H=x(!1),z=x(""),e=x("none"),o=x(),r=()=>j.getLayerByUid(l.uid),i=L(()=>h.properties),y=L(()=>h.defaultTemplates),v=L(()=>r()?.supportsFeatures??!1),b=L(()=>r()?.mapLayer??!1),S=L(()=>{const a=r();let c=a&&l.data.loaded?a.nameValue(l.data.data):d.$i18n.t("details.items.title");return d.ui.isPlainText(c)&&(c=d.ui.escapeHtml(c)),c}),D=a=>{if(typeof a=="string"){const c="underline text-blue-700 break-all",C=document.createElement("div");return C.innerHTML=a.trim(),C.firstElementChild?.tagName=="A"?(C.firstElementChild.className=c,C.innerHTML):fe(a,{className:c,target:"_blank",validate:{url:E=>/^https?:\/\//.test(E)}})}return a},q=()=>{I("none"),l.data.loaded?u():l.data.load().then(()=>{u()})},u=()=>{if(z.value="",!(l.data&&l.data.loaded))return;const a=r();if(a===void 0){console.warn(`could not find layer for uid ${l.uid} during icon lookup`);return}if(a.supportsFeatures){const c=a.oidField;a.getIcon(l.data.data[c]).then(C=>{z.value=C})}},M=L(()=>{const a=r(),c=a&&i.value[a.id]&&i.value[a.id].template;if(c){if(typeof ge(c)!="string")return c;oe(()=>d.notify.show(je.WARNING,d.$i18n.t("details.template.notFound",{layer:c})))}return y.value&&y.value[l.data.format]?y.value[l.data.format]:v.value?Xe:lt}),_=L(()=>v.value?r()?.fields||[]:[]),F=L(()=>{const a=r();if(a&&i.value[a.id]&&i.value[a.id].fields)return i.value[a.id].fields}),I=a=>{a==="zoomed"||a==="error"?setTimeout(()=>{e.value=a,o.value?._tippy.show(),setTimeout(()=>{o.value?._tippy.hide(),e.value="none"},3e3)},300):e.value=a},B=()=>{if(e.value!=="none")return;I("zooming");const a=r();if(a===void 0||!a.isLoaded){console.warn(`Could not find layer for uid ${l.uid} during zoom geometry lookup`),I("error");return}if(!l.data.loaded){console.warn("Details zoomToFeature call on item that is still loading. Should be impossible, alert the devs."),I("error");return}const c=l.data.data[a.oidField],C=()=>{const E={getGeom:!0};a.getGraphic(c,E).then(T=>{T.geometry.invalid()?(console.error(`Could not find graphic for objectid ${c}`),I("error")):(d.geo.map.zoomMapTo(T.geometry),I("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom")))}).catch(()=>{I("error")})};a.layerType===Ie.FEATURE&&a.geomType!==ze.POINT?a.getGraphicExtent(c).then(E=>{d.geo.map.zoomMapTo(E),I("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom"))}).catch(()=>{C()}):C()};return ee(()=>{f.value.push(V(l,()=>{q()},{deep:!1,immediate:!0}))}),te(()=>{f.value.forEach(a=>a())}),(a,c)=>{const C=N("truncate"),E=N("tippy");return t(),s(J,null,[g("div",at,[v.value?(t(),s("div",st,[g("div",it,[p.data.loaded&&z.value?(t(),s("span",{key:0,class:"flex-none symbologyIcon",innerHTML:z.value},null,8,nt)):(t(),s("div",ut,c[3]||(c[3]=[g("div",{class:"animate-spin spinner h-20 w-20"},null,-1)])))]),p.data.loaded?A((t(),s("span",{key:0,class:"pl-3 text-left flex-grow itemName",content:S.value,innerHTML:D(S.value),onTouchstart:c[0]||(c[0]=T=>H.value=!0),onTouchend:c[1]||(c[1]=T=>H.value=!1),tabindex:p.inList?-1:0},null,40,rt)),[[C,{options:{placement:"top-start",offset:()=>H.value?[0,25]:[0,0]}}]]):(t(),s("div",ot,O(w(m)("details.loading")),1)),p.data.loaded?(t(),s("span",dt,[b.value?A((t(),s("button",{key:0,type:"button",content:w(m)(`details.item.zoom${e.value==="none"?"":`.${e.value}`}`),"aria-label":w(m)(`grid.cells.zoom${e.value==="none"?"":`.${e.value}`}`),ref_key:"zoomButton",ref:o,onClick:c[2]||(c[2]=T=>{T.stopPropagation(),B()}),class:"text-gray-600 w-24 h-24 p-2 flex justify-center items-center"},[e.value==="zooming"?(t(),s("div",ct)):e.value==="zoomed"?(t(),s("svg",pt,c[4]||(c[4]=[g("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1)]))):e.value==="error"?(t(),s("svg",mt,c[5]||(c[5]=[g("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(t(),s("span",{key:3,innerHTML:w(d).ui.getZoomIcon()},null,8,yt))],8,vt)),[[E,{placement:"bottom"}]]):$("",!0)])):$("",!0)])):$("",!0)]),p.open?(t(),Z(ge(M.value),{key:0,identifyData:p.data,fields:_.value,fixtureFields:F.value,class:"p-8"},null,8,["identifyData","fields","fixtureFields"])):$("",!0)],64)}}}),ft={key:0,class:"layerName w-full flex-grow p-5 pb-8 font-bold truncate",tabIndex:"0"},gt={key:1,class:"p-8 mb-8 bg-gray-100 flex justify-between"},ht={for:"toggle"},bt={key:2,class:"flex flex-col justify-between p-8 mb-8 bg-gray-100"},xt={class:"flex"},kt=["aria-label"],wt=["content","aria-label","disabled"],Tt={class:"px-3 text-center flex-grow"},Lt=["content","aria-label","disabled"],_t={key:3},Mt={key:0},Et=["content"],jt=["onClick"],It={key:1,class:"text-center"},zt={key:4,class:"p-5"},Ct=G({__name:"result-list",props:{uid:{type:String,required:!0},results:{type:Object,required:!0}},emits:["item-selected"],setup(p,{emit:j}){const l=x(),d=()=>{l.value._tippy.hide()},f=n=>{n.key==="Tab"&&l.value?.matches(":focus")&&l.value._tippy.show()},h=le("iApi"),m=X(),H=re(),z=j,e=p,{t:o}=W(),r=x(!1),i=x(h.fixture.get("details")),y=x(!0),v=x(!1),b=x(0),S=x(20),D=x([]),q=x([]),u=L(()=>m.activeGreedy),M=L(()=>m.properties),_=L(()=>b.value+S.value),F=()=>H.getLayerByUid(e.uid),I=()=>e.results.find(n=>n.uid===e.uid),B=L(()=>I()?.loaded??!1),a=L(()=>I()?.requestTime),c=L(()=>r.value&&(!v.value&&T().length>1||v.value&&T().length>S.value)),C=L(()=>{const n=F();return n&&M.value[n.id]&&M.value[n.id].name?M.value[n.id].name:n?.name??""}),E=L(()=>e.uid),T=()=>{const n=I();return n?n.items:[]},U=L(()=>T()[b.value]),ve=L(()=>{if(i.value.hasHilighter()){const n=F();if(n)return n.mapLayer&&n.supportsFeatures}return!1}),xe=n=>{y.value=n,m.hilightToggle=n,P()},ke=()=>{const n=F();b.value=b.value??0,y.value=m.hilightToggle??y.value,v.value=!1,r.value=!!n,P()},ce=n=>{v.value?(b.value+=n*S.value,P()):b.value+=n},P=async(n=!1)=>{if(y.value&&ve.value){if(n){const R=I();R&&await R.loading}const k=T();if(B.value&&k.length>0){if(v.value)i.value.hilightDetailsItems(k.slice(b.value,_.value),e.uid);else{const R=k[b.value];R&&i.value.hilightDetailsItems([R],e.uid)}return}}i.value.removeDetailsHilight()},we=()=>{v.value=!0,b.value=Math.floor(b.value/S.value)*S.value,P()},Te=()=>{i.value.removeDetailsHilight(),q.value.forEach(n=>n()),D.value.forEach(n=>h.event.off(n))},Le=()=>{i.value.removeDetailsHilight()},_e=n=>{const k=b.value;b.value=n,v.value=!1,k===n&&P(),z("item-selected")};return ie(()=>{D.value.push(h.event.on(ae.LAYER_REMOVE,n=>{const k=h.panel.get("details");e.uid===n.uid&&k&&k.close()})),D.value.push(h.event.on(ae.PANEL_CLOSED,n=>{n.id==="details"&&Te()})),D.value.push(h.event.on(ae.PANEL_MINIMIZED,n=>{n.id==="details"&&Le()})),D.value.push(h.event.on(ae.MAP_BASEMAPCHANGE,n=>{y.value&&n.schemaChanged&&P()})),l.value?.addEventListener("blur",d),l.value?.addEventListener("keyup",f)}),ee(()=>{q.value.push(V(U,()=>{v.value||(ke(),U.value===void 0&&i.value.removeDetailsHilight())},{deep:!1,immediate:!0})),q.value.push(V(E,()=>{const n=e.uid;if(v.value&&n){const k=I();k&&k.loading.then(()=>{e.uid===n&&v.value&&P()})}},{deep:!1,immediate:!0})),q.value.push(V(a,()=>{b.value=0,v.value&&P(!0)})),q.value.push(V(()=>e.uid,()=>{b.value=0}))}),te(()=>{l.value?.removeEventListener("blur",d),l.value?.removeEventListener("keyup",f)}),(n,k)=>{const R=N("truncate"),se=N("tippy"),Me=N("focus-item"),Ee=N("focus-list");return B.value&&u.value===0?(t(),s("div",{key:0,class:"detailsContent relative flex flex-col flex-grow pl-5",style:me(p.results.length>1?{"margin-left":"42px"}:"")},[r.value?A((t(),s("h1",ft,[de(O(C.value),1)])),[[R,{options:{placement:"top-start"}}]]):$("",!0),ve.value?(t(),s("div",gt,[g("label",ht,O(w(o)("details.togglehilight.title")),1),ue(He,{config:{value:y.value,disabled:!1},onToggled:xe},null,8,["config"])])):$("",!0),c.value?(t(),s("div",bt,[g("div",xt,[v.value?$("",!0):(t(),s("button",{key:0,type:"button",class:"px-8 font-bold hover:bg-gray-200 focus:bg-gray-200","aria-label":w(o)("details.item.see.list"),onClick:k[0]||(k[0]=K=>we())},O(w(o)("details.item.see.list")),9,kt)),g("div",{class:Q(["flex ml-auto bg-gray-200 py-8 items-center",{"w-full":v.value}])},[A((t(),s("button",{type:"button",content:w(o)(v.value?"details.items.previous":"details.item.previous.item"),onClick:k[1]||(k[1]=K=>ce(-1)),class:"mx-2 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":w(o)(v.value?"details.items.previous":"details.item.previous.item"),disabled:b.value===0},k[3]||(k[3]=[g("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[g("g",null,[g("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,wt)),[[se,{placement:"top"}]]),g("span",Tt,O(v.value?w(o)("details.items.range",[b.value+1,Math.min(_.value,T().length),T().length]):w(o)("details.item.count",[b.value+1,T().length])),1),A((t(),s("button",{type:"button",content:w(o)(v.value?"details.items.next":"details.item.next.item"),onClick:k[2]||(k[2]=K=>ce(1)),class:"mx-2 rotate-180 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":w(o)(v.value?"details.items.next":"details.item.next.item"),disabled:!v.value&&b.value===T().length-1||v.value&&_.value>=T().length},k[4]||(k[4]=[g("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[g("g",null,[g("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,Lt)),[[se,{placement:"top"}]])],2)])])):$("",!0),r.value?(t(),s("div",_t,[T().length>0?(t(),s("div",Mt,[v.value?A((t(),s("div",{key:0,class:"flex flex-col",content:w(o)("details.layers.results.list.tooltip"),ref_key:"el",ref:l},[(t(!0),s(J,null,Y(T().slice(b.value,_.value),(K,pe)=>A((t(),s("button",{class:"flex flex-grow truncate default-focus-style hover:bg-gray-200",key:pe,onClick:$t=>_e(b.value+pe)},[ue(be,{data:K,uid:p.uid,open:!1,"in-list":!0},null,8,["data","uid"])],8,jt)),[[Me,"show-truncate"]])),128))],8,Et)),[[Ee],[se,{trigger:"manual",placement:"top-start",touch:!1}]]):(t(),Z(be,{key:1,data:U.value,uid:p.uid,open:!0,"in-list":!1},null,8,["data","uid"]))])):(t(),s("div",It,O(w(o)("details.layers.results.empty.currentLayer")),1))])):(t(),s("div",zt,O(w(o)("details.item.no.data")),1))],4)):(t(),s("div",{key:1,class:Q(["flex justify-center py-10 items-center",p.results.length>1?"ml-42":""])},[k[5]||(k[5]=g("span",{class:"animate-spin spinner h-20 w-20 px-5 mr-8"},null,-1)),de(" "+O(w(o)("details.item.loading")),1)],2))}}}),Ht=ne(Ct,[["__scopeId","data-v-60b1b8a2"]]),Dt={class:"relative h-full"},qt=G({__name:"details-screen",props:{panel:{type:Object}},setup(p){const{t:j}=W(),l=le("iApi"),d=X(),f=x([]),h=x([]),m=x([]),H=x(!1),z=x(null),e=x(""),o=L(()=>d.activeGreedy),r=L(()=>d.payload),i=L(()=>d.properties),y=u=>{e.value=u},v=u=>m.value.find(M=>M.uid===u),b=u=>{u!==void 0&&(d.activeGreedy=u.length===0?0:u[0].requestTime,m.value=u,S(u))},S=u=>{if(e.value){const M=v(e.value);M?M.loading.then(()=>{M.requestTime===o.value&&(M.items.length>0?q(!1):D(u))}):D(u)}else D(u)},D=(u,M)=>{let _;if(M)_=M;else{const a=d.properties,c=u.map(E=>[a[E.layerId]?.priority??50,E.layerId]),C=new Set(c.map(E=>E[0]));_=[],C.forEach(E=>{const T=c.filter(U=>U[0]===E).map(U=>U[1]);_.push([E,T])}),_.sort((E,T)=>T[0]-E[0])}if(_.length===0){r.value.length?q(!0):oe().then(()=>{q(!0)});return}const F=_[_.length-1][1],I=u.filter(a=>F.includes(a.layerId)).map(a=>a.loading.then(()=>a.items.length>0?Promise.resolve(a):Promise.reject())),B=u.length===0?0:u[0].requestTime;Promise.any(I).then(a=>{a.requestTime===o.value&&(e.value=a.uid,q(!1))}).catch(()=>{B===o.value&&(_.pop(),D(u,_))})},q=u=>{d.activeGreedy=0,H.value=u};return ee(()=>{h.value.push(V(r,u=>{b(u)},{deep:!1,immediate:!0}))}),te(()=>{f.value.forEach(u=>l.event.off(u)),h.value.forEach(u=>u())}),(u,M)=>{const _=Ce("panel-screen");return t(),Z(_,{panel:p.panel},{header:he(()=>[de(O(w(d).origin==="toggleEvent"?w(j)("details.layers.title.gridOrigin"):w(j)("details.layers.title.identifyOrigin")),1)]),content:he(()=>[g("div",Dt,[m.value.length>1?(t(),Z(Je,{key:0,results:m.value,detailsProperties:i.value,selected:e.value,onSelectionChanged:y},null,8,["results","detailsProperties","selected"])):$("",!0),g("div",{class:"detailsContentSection overflow-y-auto h-full",ref_key:"detailsPanel",ref:z},[H.value?(t(),s("div",{key:1,class:Q(["text-center",{"ml-42":m.value.length>1}])},O(m.value.length>=1?w(j)("details.layers.results.empty"):w(j)("details.layers.results.empty.noLayers")),3)):(t(),Z(Ht,{key:0,uid:e.value,results:m.value,onItemSelected:M[0]||(M[0]=()=>oe(()=>z.value?.scrollTo({top:0})))},null,8,["uid","results"]))],512)])]),_:1},8,["panel"])}}}),Ot=ne(qt,[["__scopeId","data-v-e4b92b97"]]);export{Ot as default};
