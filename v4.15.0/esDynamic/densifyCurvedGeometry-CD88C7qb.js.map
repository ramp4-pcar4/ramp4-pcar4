{"version":3,"file":"densifyCurvedGeometry-CD88C7qb.js","sources":["../../node_modules/@arcgis/core/geometry/support/curves/densifyCurvedGeometry.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{interpolateCubicBezier as t}from\"./bezierCurveUtils.js\";import{deriveCircleFromCircularArc as s}from\"./circularArcUtils.js\";import{isCurvedGeometry as i,getCurves as n,getEndpoint as e,isCoordinate as r,isBezierCurve as a,isCircularArc as h,isEllipticArc4 as c,isEllipticArc7 as o,cloneCurve as u}from\"./curveUtils.js\";import{deriveCircleFromEllipticArc4 as p}from\"./ellipticArc4Utils.js\";import{deriveEllipse as l,interpolateEllipse as d}from\"./ellipticArc7Utils.js\";import{interpolateSegment as m,pointToSegmentDistance2 as S,distance2 as E}from\"./mathUtils.js\";const v={maxSegmentLength:1/0,maxDeviation:1/0,maxSegmentsPerCurve:12e3,minSegmentsPerCurve:1},f=1e-6,g=[0,0];function M(t){return{maxSegmentLength:t.maxSegmentLength??v.maxSegmentLength,maxDeviation:t.maxDeviation??v.maxDeviation,maxSegmentsPerCurve:t.maxSegmentsPerCurve??v.maxSegmentsPerCurve,minSegmentsPerCurve:Math.max(t.minSegmentsPerCurve??v.minSegmentsPerCurve,1)}}class P{constructor(t,s){this.curveStart=t,this.curveEnd=s,this.tStart=0,this.tEnd=0,this.tEndStack=[],this.arcEndStack=[]}get stackSize(){return this.tEndStack.length}initialize(t,s){this.tStart=0,this.arcStart=t,this.tEndStack.push(1),this.arcEndStack.push(s)}splitAt(t){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(t),this.arcEndStack.push(this.interpolate(t))}splitInHalf(){return this.splitAt((this.tStart+this.tEnd)/2)}pop(){this.tEnd=this.tEndStack.pop(),this.arcEnd=this.arcEndStack.pop()}next(){this.tStart=this.tEnd,this.arcStart=this.arcEnd}densify(t,{maxDeviation:s,maxSegmentLength:i,maxSegmentsPerCurve:n,minSegmentsPerCurve:e}){const r=i*i,a=s*s,h=1/n,c=this.interpolate(0),o=this.interpolate(1);E(this.curveStart,c)>f&&t.push(c),this.initialize(c,o);const u=1/e;for(let p=e-1;p>0;p--){const t=p*u;this.pop(),this.splitAt(t)}for(;this.stackSize>0;)this.pop(),this.tStart===this.tEnd||this.tEnd-this.tStart<h||(0===r||!isFinite(r)||E(this.arcStart,this.arcEnd)<r)&&(0===a||!isFinite(a)||this.getDeviation2()<a)?(t.push(this.arcEnd),this.next()):this.splitInHalf();return E(this.curveEnd,o)>f&&t.push([...this.curveEnd]),t}}class x extends P{constructor(t,s){const[i,n,e]=s.b;super(t,i),this._controlPointsStack=[],this._curveControlPoints=[n,e],this._arcControlPoints=[n,e],this._controlPointsStack.push(this._arcControlPoints)}splitAt(t){const{arcStart:s,arcEnd:i,tStart:n,tEnd:e}=this,[r,a]=this._arcControlPoints,h=(t-n)/(e-n),c=m([],s,r,h),o=m(g,r,a,h),u=m([],a,i,h),p=m([],c,o,h),l=m([],o,u,h),d=m([],p,l,h);this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this._controlPointsStack.push([l,u]),this.tEndStack.push(t),this.arcEndStack.push(d),this._arcControlPoints[0]=c,this._arcControlPoints[1]=p,this._controlPointsStack.push(this._arcControlPoints)}pop(){super.pop(),this._arcControlPoints=this._controlPointsStack.pop()}interpolate(s){const{curveStart:i,curveEnd:n}=this,[e,r]=this._curveControlPoints;return t(i,e,r,n,s)}getDeviation2(){const{arcStart:t,arcEnd:s}=this,[i,n]=this._arcControlPoints;return Math.max(S(i,t,s),S(n,t,s))}}class k extends P{constructor(t,s){const[i]=s.a;super(t,i),this._derivedEllipse=l(t,s)}pop(){super.pop(),this._tMid=(this.tStart+this.tEnd)/2,this._arcMid=this.interpolate(this._tMid)}splitInHalf(){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(this._tMid),this.arcEndStack.push(this._arcMid)}interpolate(t){return d(this._derivedEllipse,t)}getDeviation2(){return S(this._arcMid,this.arcStart,this.arcEnd)}}function C(t,s,i,{cx:n,cy:e,radius:r,thetaStart:a,thetaEnd:h,isInvalid:c},{maxDeviation:o,maxSegmentLength:u,maxSegmentsPerCurve:p,minSegmentsPerCurve:l}){if(c)return t.push([...i]),t;const d=2*r,m=[n+r*Math.cos(a),e+r*Math.sin(a)],S=[n+r*Math.cos(h),e+r*Math.sin(h)];E(s,m)>f&&t.push(m);const v=Math.abs(h-a),g=u<d?2*Math.asin(u/d):v,M=o<=r?2*Math.acos(1-o/r):v,P=Math.min(g,M),x=Math.min(p,Math.max(l,Math.ceil(Math.abs(v/P)))),k=1/x;for(let E=1;E<x;E++){const s=E*k,i=a*(1-s)+h*s;t.push([n+r*Math.cos(i),e+r*Math.sin(i)])}return t.push(S),E(i,S)>f&&t.push([...i]),t}function _(t,s,i,n){return new x(s,i).densify(t,n)}function Z(t,i,n,e){const r=s(i,n),[a]=n.c;return C(t,i,a,r,e)}function A(t,s,i,n){const e=p(s,i),[r]=i.a;return C(t,s,r,e,n)}function D(t,s,i,n){const[e,r,a,h,c,o,u]=i.a;return 0===o||0===u?(t.push([...e]),t):new k(s,i).densify(t,n)}function R(t,s,i,n){return r(i)?(t.push([...i]),t):a(i)?_(t,s,i,n):h(i)?Z(t,s,i,n):c(i)?A(t,s,i,n):D(t,s,i,n)}function y(t,s){if(!i(t))return t;const r=M(s),a=n(t),h=[];for(const i of a){const t=[];for(let s=0;s<i.length-1;s++){const n=s+1,a=[...e(i[s])];0===s&&t.push(a);R(t,a,i[n],r)}h.push(t)}return\"curvePaths\"in t?{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},paths:h,spatialReference:t.spatialReference}:{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},rings:h,spatialReference:t.spatialReference}}function j(t,s,p){if(!i(t))return t;const l=new Set(s),d=M(p),m=n(t),S=[];let E=!1;for(const i of m){const t=[];for(let s=0;s<i.length-1;s++){const n=s+1,p=[...e(i[s])];0===s&&t.push(p);const m=i[n];r(m)?t.push([...m]):a(m)&&!l.has(\"esriGeometryBezier3Curve\")?_(t,p,m,d):h(m)&&!l.has(\"esriGeometryCircularArc\")?Z(t,p,m,d):c(m)&&!l.has(\"esriGeometryEllipticArc\")?A(t,p,m,d):o(m)&&!l.has(\"esriGeometryEllipticArc\")?D(t,p,m,d):(t.push(u(m)),E=!0)}S.push(t)}return\"curvePaths\"in t?{...void 0!==t.hasZ?{hasZ:t.hasZ}:{},...void 0!==t.hasM?{hasM:t.hasM}:{},spatialReference:t.spatialReference,...E?{curvePaths:S}:{paths:S}}:{hasZ:t.hasZ,hasM:t.hasM,spatialReference:t.spatialReference,...E?{curveRings:S}:{rings:S}}}export{y as densifyCurvedGeometry,j as selectiveDensifyCurvedGeometry};\n"],"names":["g","M","P","t","s","n","e","r","a","h","o","E","u","x","m","l","d","i","S","k","C","c","p","v","_","Z","A","D","R","y"],"mappings":"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","x_google_ignoreList":[0]}