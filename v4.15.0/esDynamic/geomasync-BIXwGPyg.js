import{e as p,D as F,h as X,z as Y,O as _,I as $,R as tt,k as nt,t as Z}from"./arcade-BfSjh4Mb.js";import{J as d,l as k,o as h,w as z,m as H,g as W,t as O,E as T,B as R,F as q,U as C,M,N as E,S as P,T as rt,z as b,p as x,c as D}from"./Dictionary-CseTEM8p.js";import{n as o}from"./enum-BsF4Zles.js";import{o as J}from"./TimeOnly-BFAmO81K.js";import{l as B}from"./portalUtils-D9m6Ziij.js";import{a as f}from"./operatorsWorkerConnection-DIOUtEyj.js";import{k as et,H as V,eV as w,bQ as y,eW as v,ch as L,aG as U,cl as I,aH as A,dU as G,cW as it,M as Q}from"./main-pOgmbpmS.js";async function K(i,n,r){if(!et?.findCredential(i.restUrl))return null;if(i.loadStatus==="loaded"&&n===""&&i.user?.sourceJSON&&r===!1)return i.user.sourceJSON;const u={responseType:"json",query:{f:"json"}};if(r&&(u.query.returnUserLicenseTypeExtensions=!0),n===""){const t=await V(i.restUrl+"/community/self",u);if(t.data){const e=t.data;if(e?.username)return e}return null}const l=await V(i.restUrl+"/community/users/"+n,u);if(l.data){const t=l.data;return t.error?null:t}return null}function N(i){if(i==null)return i;switch(typeof i){case"string":case"number":return i;default:throw new o(null,"InvalidParameter",null)}}function at(i){i.mode==="async"&&(i.functions.disjoint=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=d(t),p(t,n,r),t[0]===null||t[1]===null||f("disjoint",[t[0].toJSON(),t[1].toJSON()])))},i.functions.intersects=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=d(t),p(t,n,r),t[0]!==null&&t[1]!==null&&f("intersects",[t[0].toJSON(),t[1].toJSON()])))},i.functions.touches=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=d(t),p(t,n,r),t[0]!==null&&t[1]!==null&&f("touches",[t[0].toJSON(),t[1].toJSON()])))},i.functions.crosses=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=d(t),p(t,n,r),t[0]!==null&&t[1]!==null&&f("crosses",[t[0].toJSON(),t[1].toJSON()])))},i.functions.within=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=d(t),p(t,n,r),t[0]!==null&&t[1]!==null&&f("within",[t[0].toJSON(),t[1].toJSON()])))},i.functions.contains=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=d(t),p(t,n,r),t[0]!==null&&t[1]!==null&&f("contains",[t[0].toJSON(),t[1].toJSON()])))},i.functions.overlaps=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(t=d(t),p(t,n,r),t[0]!==null&&t[1]!==null&&f("overlaps",[t[0].toJSON(),t[1].toJSON()])))},i.functions.equals=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>(h(t,2,2,n,r),t[0]===t[1]||(t[0]instanceof w&&t[1]instanceof w?f("equals",[t[0].toJSON(),t[1].toJSON()]):(k(t[0])&&k(t[1])||!!(z(t[0])&&z(t[1])||H(t[0])&&H(t[1])))&&t[0].equals(t[1]))))},i.functions.relate=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>{if(t=d(t),h(t,3,3,n,r),t[0]instanceof w&&t[1]instanceof w)return f("relate",[t[0].toJSON(),t[1].toJSON(),W(t[2])]);if(t[0]instanceof w&&t[1]===null||t[1]instanceof w&&t[0]===null||t[0]===null&&t[1]===null)return!1;throw new o(n,"InvalidParameter",r)})},i.functions.intersection=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>(t=d(t),p(t,n,r),t[0]===null||t[1]===null?null:y(await f("intersection",[t[0].toJSON(),t[1].toJSON()]))))},i.functions.union=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if((t=d(t)).length===0)throw new o(n,"WrongNumberOfParameters",r);const e=[];if(t.length===1)if(v(t[0])){for(const a of d(t[0]))if(a!==null){if(!(a instanceof w))throw new o(n,"InvalidParameter",r);e.push(a.toJSON())}}else{if(!O(t[0])){if(t[0]instanceof w)return T(J(t[0]),n.spatialReference);if(t[0]===null)return null;throw new o(n,"InvalidParameter",r)}for(const a of d(t[0].toArray()))if(a!==null){if(!(a instanceof w))throw new o(n,"InvalidParameter",r);e.push(a.toJSON())}}else for(const a of t)if(a!==null){if(!(a instanceof w))throw new o(n,"InvalidParameter",r);e.push(a.toJSON())}return e.length===0?null:y(await f("union",[e]))})},i.functions.difference=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>(t=d(t),p(t,n,r),t[0]===null?null:t[1]===null?J(t[0]):y(await f("difference",[t[0].toJSON(),t[1].toJSON()]))))},i.functions.symmetricdifference=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>(t=d(t),p(t,n,r),t[0]===null&&t[1]===null?null:t[0]===null?J(t[1]):t[1]===null?J(t[0]):y(await f("symmetricDifference",[t[0].toJSON(),t[1].toJSON()]))))},i.functions.clip=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,2,2,n,r),!(t[1]instanceof L)&&t[1]!==null)throw new o(n,"InvalidParameter",r);if(t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);return t[1]===null?null:y(await f("clip",[t[0].toJSON(),t[1].toJSON()]))})},i.functions.cut=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,2,2,n,r),!(t[1]instanceof U)&&t[1]!==null)throw new o(n,"InvalidParameter",r);if(t[0]===null)return[];if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);return t[1]===null?[J(t[0])]:(await f("cut",[t[0].toJSON(),t[1].toJSON()])).map(e=>y(e))})},i.functions.area=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(h(t,1,2,n,r),t=d(t),R(t[0])){const a=await t[0].sumArea(N(t[1]),null,n.abortSignal);if(n.abortSignal.aborted)throw new o(n,"Cancelled",r);return a}let e=t[0];if((v(e)||O(e))&&(e=q(t[0],n.spatialReference)),e===null)return 0;if(!(e instanceof w))throw new o(n,"InvalidParameter",r);return f("area",[e.toJSON(),N(t[1])])})},i.functions.areageodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{h(t,1,3,n,r);let e=(t=d(t))[0];(v(e)||O(e))&&(e=q(e,n.spatialReference));const a=N(t[1]),s=F(t[2]);if(R(e)){const c=await e.sumArea(a,s,n.abortSignal);if(n.abortSignal.aborted)throw new o(n,"Cancelled",r);return c}if(e==null)return 0;if(!C(e))throw new o(n,"InvalidParameter",r);return f("geodeticArea",[e.toJSON(),a,s])})},i.functions.length=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(h(t,1,2,n,r),t=d(t),R(t[0])){const a=await t[0].sumLength(N(t[1]),null,n.abortSignal);if(n.abortSignal.aborted)throw new o(n,"Cancelled",r);return a}let e=t[0];if((v(t[0])||O(t[0]))&&(e=M(t[0],n.spatialReference)),e===null)return 0;if(!(e instanceof w))throw new o(n,"InvalidParameter",r);return f("length",[e.toJSON(),N(t[1])])})},i.functions.length3d=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(h(t,1,2,n,r),(t=d(t))[0]===null)return 0;let e=t[0];if((v(t[0])||O(t[0]))&&(e=M(t[0],n.spatialReference)),e===null)return 0;if(!(e instanceof w))throw new o(n,"InvalidParameter",r);if(e.hasZ===!0){const{convertFromSpatialReferenceUnit:a,toLengthUnit:s}=await import("./unitConversion-BXlQtk5W.js"),c=X(e);return a(e.spatialReference,s(t[1]),c)}return f("length",[e.toJSON(),N(t[1])])})},i.functions.lengthgeodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{h(t,1,3,n,r);let e=(t=d(t))[0];(v(t[0])||O(t[0]))&&(e=M(t[0],n.spatialReference));const a=N(t[1]),s=F(t[2]);if(R(e)){const c=await e.sumLength(a,s,n.abortSignal);if(n.abortSignal.aborted)throw new o(n,"Cancelled",r);return c}if(e===null)return 0;if(!C(e))throw new o(n,"InvalidParameter",r);return f("geodeticLength",[e.toJSON(),a,s])})},i.functions.distance=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{t=d(t),h(t,2,3,n,r);let e=t[0];if((v(t[0])||O(t[0]))&&(e=E(t[0],n.spatialReference)),!(e instanceof w))throw new o(n,"InvalidParameter",r);let a=t[1];if((v(t[1])||O(t[1]))&&(a=E(t[1],n.spatialReference)),!(a instanceof w))throw new o(n,"InvalidParameter",r);return f("distance",[e.toJSON(),a.toJSON(),N(t[2])])})},i.functions.distancegeodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{t=d(t),h(t,2,4,n,r);const e=t[0];if(!(e instanceof I))throw new o(n,"InvalidParameter",r);const a=t[1];if(!(a instanceof I))throw new o(n,"InvalidParameter",r);const s=new U({paths:[],spatialReference:e.spatialReference});return s.addPath([e,a]),f("geodeticLength",[s.toJSON(),N(t[2]),F(t[3])])})},i.functions.densify=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);const e=P(t[1]);if(isNaN(e))throw new o(n,"InvalidParameter",r);if(e<=0)throw new o(n,"InvalidParameter",r);switch(t[0].type){case"polygon":case"polyline":case"extent":return y(await f("densify",[t[0].toJSON(),e,N(t[2])]));default:return t[0]}})},i.functions.densifygeodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{t=d(t),h(t,2,4,n,r);const e=t[0];if(e==null)return null;if(!C(e))throw new o(n,"InvalidParameter",r);const a=P(t[1]);if(isNaN(a))throw new o(n,"InvalidParameter",r);if(a<=0)throw new o(n,"InvalidParameter",r);const s=N(t[2]),c=F(t[3]);switch(e.type){case"polygon":case"polyline":case"extent":return y(await f("geodeticDensify",[e.toJSON(),a,s,c]));default:return e}})},i.functions.generalize=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,2,4,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);const e=P(t[1]);if(isNaN(e))throw new o(n,"InvalidParameter",r);const a=rt(b(t[2],!0));return y(await f("generalize",[t[0].toJSON(),e,N(t[3]),{removeDegenerateParts:a}]))})},i.functions.buffer=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);const e=P(t[1]);if(isNaN(e))throw new o(n,"InvalidParameter",r);return e===0?J(t[0]):y(await f("buffer",[t[0].toJSON(),e,N(t[2])]))})},i.functions.buffergeodetic=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{t=d(t),h(t,2,4,n,r);const e=t[0];if(e==null)return null;if(!C(e))throw new o(n,"InvalidParameter",r);const a=P(t[1]);if(isNaN(a))throw new o(n,"InvalidParameter",r);if(a===0)return J(e);const s=N(t[2]),c=F(t[3]);return y(await f("geodesicBuffer",[e.toJSON(),a,s,c]))})},i.functions.offset=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{t=d(t),h(t,2,6,n,r);const e=t[0];if(e===null)return null;if(!(e instanceof A||e instanceof U))throw new o(n,"InvalidParameter",r);const a=P(t[1]);if(isNaN(a))throw new o(n,"InvalidParameter",r);const s=t[2],c=Y(t[3]),m=P(b(t[4],10));if(isNaN(m))throw new o(n,"InvalidParameter",r);const g=P(b(t[5],0));if(isNaN(g))throw new o(n,"InvalidParameter",r);return y(await f("offset",[e.toJSON(),a,N(s),c,m,g]))})},i.functions.rotate=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,2,3,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);const e=t[0]instanceof L?A.fromExtent(t[0]):t[0],a=P(t[1]);if(isNaN(a))throw new o(n,"InvalidParameter",r);const s=b(t[2],null);if(s===null){const c=e.type==="point"?e:e.extent?.center;return y(await f("rotate",[e.toJSON(),a,c?.x,c?.y]))}if(s instanceof I)return y(await f("rotate",[e.toJSON(),a,s.x,s.y]));throw new o(n,"InvalidParameter",r)})},i.functions.centroid=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,1,2,n,r),t[0]===null)return null;const e=_(t[1]);let a=t[0];if((v(t[0])||O(t[0]))&&(a=e==="geometric"?E(t[0],n.spatialReference):q(t[0],n.spatialReference),a===null))return null;if(!(a instanceof w))throw new o(n,"InvalidParameter",r);return y(e==="geometric"?await f("centroid",[a.toJSON()]):await f("labelPoint",[a.toJSON()]))})},i.functions.measuretocoordinate=function(n,r){return i.standardFunctionAsync(n,r,$)},i.functions.pointtocoordinate=function(n,r){return i.standardFunctionAsync(n,r,tt)},i.functions.distancetocoordinate=function(n,r){return i.standardFunctionAsync(n,r,nt)},i.functions.multiparttosinglepart=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);if(t[0]instanceof I)return[T(J(t[0]),n.spatialReference)];if(t[0]instanceof L)return[T(J(t[0]),n.spatialReference)];const e=y(await f("simplify",[t[0].toJSON()]));if(e instanceof A){const a=[],s=[];for(let c=0;c<e.rings.length;c++)if(e.isClockwise(e.rings[c])){const m=y({rings:[e.rings[c]],hasZ:e.hasZ===!0,hasM:e.hasM===!0,spatialReference:e.spatialReference.toJSON()});a.push(m)}else s.push({ring:e.rings[c],pt:e.getPoint(c,0)});for(let c=0;c<s.length;c++)for(let m=0;m<a.length;m++)if(a[m].contains(s[c].pt)){a[m].addRing(s[c].ring);break}return a}if(e instanceof U){const a=[];for(let s=0;s<e.paths.length;s++){const c=y({paths:[e.paths[s]],hasZ:e.hasZ===!0,hasM:e.hasM===!0,spatialReference:e.spatialReference.toJSON()});a.push(c)}return a}if(t[0]instanceof G){const a=[],s=T(J(t[0]),n.spatialReference);for(let c=0;c<s.points.length;c++)a.push(s.getPoint(c));return a}return null})},i.functions.isselfintersecting=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{h(t,1,1,u,l);let e=(t=d(t))[0];if((v(t[0])||O(t[0]))&&(e=M(t[0],u.spatialReference)),e instanceof G){const a=e.points;for(let s=0;s<a.length;s++)for(let c=s+1;c<a.length;c++)if(it(a[s],a[c]))return!0;return!1}return(e instanceof U||e instanceof A)&&await f("isSelfIntersecting",[e.toJSON()])})},i.functions.issimple=function(n,r){return i.standardFunctionAsync(n,r,(u,l,t)=>{if(t=d(t),h(t,1,1,n,r),t[0]===null)return!0;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);return f("isSimple",[t[0].toJSON()])})},i.functions.simplify=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);return y(await f("simplify",[t[0].toJSON()]))})},i.functions.convexhull=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,1,1,n,r),t[0]===null)return null;if(!(t[0]instanceof w))throw new o(n,"InvalidParameter",r);return y(await f("convexHull",[t[0].toJSON()]))})},i.functions.getuser=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{h(t,0,2,n,r);let e=b(t[1],""),a=e===!0;if(e=e===!0||e===!1?"":W(e),t.length===0||t[0]instanceof Z){let c;c=n.services?.portal?n.services.portal:Q.getDefault(),t.length>0&&(c=B(t[0],c));const m=await K(c,e,a);if(m){const g=JSON.parse(JSON.stringify(m));for(const S of["lastLogin","created","modified"])g[S]!==void 0&&g[S]!==null&&(g[S]=new Date(g[S]));return x.convertObjectToArcadeDictionary(g,D(n))}return null}let s=null;if(R(t[0])&&(s=t[0]),s){if(a=!1,e)return null;await s.load();const c=await s.getOwningSystemUrl();if(!c){if(!e){const S=await s.getIdentityUser();return S?x.convertObjectToArcadeDictionary({username:S},D(n)):null}return null}let m;m=n.services?.portal?n.services.portal:Q.getDefault(),m=B(new Z(c),m);const g=await K(m,e,a);if(g){const S=JSON.parse(JSON.stringify(g));for(const j of["lastLogin","created","modified"])S[j]!==void 0&&S[j]!==null&&(S[j]=new Date(S[j]));return x.convertObjectToArcadeDictionary(S,D(n))}return null}throw new o(n,"InvalidParameter",r)})},i.functions.nearestcoordinate=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,2,2,n,r),!(t[0]instanceof w||t[0]===null))throw new o(n,"InvalidParameter",r);if(!(t[1]instanceof I||t[1]===null))throw new o(n,"InvalidParameter",r);if(t[0]===null||t[1]===null)return null;const e=t[0]instanceof L?A.fromExtent(t[0]):t[0],a=await f("getNearestCoordinate",[e.toJSON(),t[1].toJSON(),{calculateLeftRightSide:!0}]);return a===null?null:x.convertObjectToArcadeDictionary({coordinate:y(a.coordinate),distance:a.distance,sideOfLine:a.distance===0?"straddle":a.isRightSide?"right":"left"},D(n),!1,!0)})},i.functions.nearestvertex=function(n,r){return i.standardFunctionAsync(n,r,async(u,l,t)=>{if(t=d(t),h(t,2,2,n,r),!(t[0]instanceof w||t[0]===null))throw new o(n,"InvalidParameter",r);if(!(t[1]instanceof I||t[1]===null))throw new o(n,"InvalidParameter",r);if(t[0]===null||t[1]===null)return null;const e=t[0]instanceof L?A.fromExtent(t[0]):t[0],a=await f("getNearestVertex",[e.toJSON(),t[1].toJSON()]);return a===null?null:x.convertObjectToArcadeDictionary({coordinate:y(a.coordinate),distance:a.distance,sideOfLine:a.distance===0?"straddle":a.isRightSide?"right":"left"},D(n),!1,!0)})})}export{at as registerFunctions};
