import{m as p,i as X,r as Y}from"./TimeOnly-BFAmO81K.js";import{K as N,t as c,p as k,B as $,A as q,i as H,V as L,l as I,w as G,m as S,G as W,D as ee}from"./Dictionary-CseTEM8p.js";import{n as l}from"./enum-BsF4Zles.js";import{bQ as T,cl as F,fY as O,eV as z,eU as te,d$ as re,eT as ne,eX as se}from"./main-pOgmbpmS.js";import{l as ie}from"./featureConversionUtils-safiWyiN.js";import{Z as ae}from"./FieldsIndex-CGBGd8H6.js";function C(e,r,n=null){const t=P(e,!0);if(t.hasm!==void 0&&(t.hasM=t.hasm,delete t.hasm),t.hasz!==void 0&&(t.hasZ=t.hasz,delete t.hasz),t.spatialreference!==void 0&&(t.spatialReference=t.spatialreference,delete t.spatialreference),t.spatialReference||(t.spatialReference=r),t.curverings!==void 0){const s=D(t.curverings,t.hasZ,t.hasM,B);if(s==null)return null;t.curveRings=s.arrays,delete t.curverings,delete t.rings,t.hasZ=s.hasZ,t.hasM=s.hasM}else if(t.rings!==void 0){const s=D(t.rings,t.hasZ,t.hasM,f);if(s==null)return null;t.rings=s.arrays,t.hasZ=s.hasZ,t.hasM=s.hasM}if(t.curvepaths!==void 0){const s=D(t.curvepaths,t.hasZ,t.hasM,B);if(s==null)return null;t.curvePaths=s.arrays,delete t.curvepaths,delete t.paths,t.hasZ=s.hasZ,t.hasM=s.hasM}else if(t.paths!==void 0){const s=D(t.paths,t.hasZ,t.hasM,f);if(s==null)return null;t.paths=s.arrays,t.hasZ=s.hasZ,t.hasM=s.hasM}if(t.points!==void 0){const s=ge(t.points,t.hasZ,t.hasM);if(s==null)return null;t.points=s.array,t.hasZ=s.hasZ,t.hasM=s.hasM}const i=T(t);if(n!=null&&i?.type!==n)throw new l(null,"InvalidParameter",null);return i}function P(e,r=!1){const n={};for(const t of e.keys()){const i=r?t.toLowerCase():t,s=e.attributes[t];n[i]=N(s)?P(s):s}return n}const w=Symbol("NoValue");function g(e){return Array.isArray(e)&&e.length>0?e[0]:c(e)&&e.length()>0?e.get(0):w}function le(e){const r=g(g(e));return r===w||Array.isArray(r)||c(r)||r instanceof F?e:[e]}const x=0;function R(e){return O(e,x)??x}function U(e){return typeof e=="number"&&!Number.isNaN(e)}const A=null;function J(e){return O(e,A)??A}function V(e){return typeof e=="number"&&!Number.isNaN(e)||e===null}function v(e){return!(e.length<2)&&typeof e[0]=="number"&&!Number.isNaN(e[0])&&typeof e[1]=="number"&&!Number.isNaN(e[1])}function b(e){return v(e)?e.length>2?e.slice(0,2):e:null}function oe(e){return v(e)?U(e[2])?e.length>3?e.slice(0,3):e:[e[0],e[1],R(e[2])]:null}function ue(e){return v(e)?e.length>=3&&!V(e[2])?[e[0],e[1],J(e[2])]:e.length>3?e.slice(0,3):e:null}function ce(e){return v(e)?U(e[2])&&V(e[3])?e.length>4?e.slice(0,4):e:[e[0],e[1],R(e[2]),J(e[3])]:null}function _(e){return[e.x,e.y]}function fe(e){return[e.x,e.y,e.z??x]}function he(e){return[e.x,e.y,e.m??A]}function de(e){return[e.x,e.y,e.z??x,e.m??A]}function ye(e,r,n){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==2)throw new l(null,"InvalidParameter",null);const t=f(e[0],r,n);if(t==null)return null;const i=f(e[1],_,b);return i==null?null:{c:[t,i]}}function me(e,r,n){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==4&&e.length!==7)throw new l(null,"InvalidParameter",null);const t=f(e[0],r,n);if(t==null)return null;const i=f(e[1],_,b);if(i==null)return null;const s=e[2];if(s!==0&&s!==1)throw new l(null,"InvalidParameter",null);const a=e[3];if(a!==0&&a!==1)throw new l(null,"InvalidParameter",null);if(e.length===4)return{a:[t,i,s,a]};const u=e[4];if(typeof u!="number")throw new l(null,"InvalidParameter",null);if(Number.isNaN(u))return null;const y=e[5];if(typeof y!="number")throw new l(null,"InvalidParameter",null);if(Number.isNaN(y))return null;const h=e[6];if(typeof h!="number")throw new l(null,"InvalidParameter",null);return Number.isNaN(h)?null:{a:[t,i,s,a,u,y,h]}}function pe(e,r,n){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==3)throw new l(null,"InvalidParameter",null);const t=f(e[0],r,n);if(t==null)return null;const i=f(e[1],_,b);if(i==null)return null;const s=f(e[2],_,b);return s==null?null:{b:[t,i,s]}}function j(e,r){return e?r?ce:oe:r?ue:b}function E(e,r){return e?r?de:fe:r?he:_}function f(e,r,n){return Array.isArray(e)?n(e):e instanceof F?r(e):c(e)?n(e.toArray()):null}function B(e,r,n){return Array.isArray(e)?n(e):N(e)?e.hasField("c")?ye(e.field("c"),r,n):e.hasField("a")?me(e.field("a"),r,n):e.hasField("b")?pe(e.field("b"),r,n):null:e instanceof F?r(e):c(e)?n(e.toArray()):null}function M(e,r,n,t){const i=[];if(Array.isArray(e))for(const s of e){const a=r(s,n,t);a!=null&&i.push(a)}else if(c(e))for(let s=0;s<e.length();s++){const a=r(e.get(s),n,t);a!=null&&i.push(a)}return i}function m(e,r,n){return Array.isArray(e)?e.length>=r:c(e)?e.length()>=r:e instanceof F&&e[n]}function K(e,r,n){return e===void 0&&r===void 0?{hasZ:m(n,3,"hasZ"),hasM:m(n,4,"hasM")}:e===void 0?r===!0?{hasZ:m(n,4,"hasZ"),hasM:!0}:{hasZ:m(n,3,"hasZ"),hasM:!1}:r===void 0?e===!0?{hasZ:!0,hasM:m(n,4,"hasM")}:{hasZ:!1,hasM:m(n,3,"hasM")}:{hasZ:e===!0,hasM:r===!0}}function ge(e,r,n){const t=g(e);if(t===w)return null;const{hasZ:i,hasM:s}=K(r,n,t);return{array:M(e,f,E(i,s),j(i,s)),hasZ:i,hasM:s}}function D(e,r,n,t){const i=g(g(e=le(e)));if(i===w)return null;const{hasZ:s,hasM:a}=K(r,n,i),u=E(s,a),y=j(s,a),h=[];if(Array.isArray(e))for(let d=0;d<e.length;d++)h.push(M(e[d],t,u,y));else if(c(e))for(let d=0;d<e.length();d++)h.push(M(e.get(d),t,u,y));return{arrays:h,hasZ:s,hasM:a}}function Q(e){switch(e.type){case"small-integer":case"esriFieldTypeSmallInteger":case"integer":case"esriFieldTypeInteger":case"single":case"esriFieldTypeSingle":case"double":case"esriFieldTypeDouble":case"big-integer":case"esriFieldTypeBigInteger":case"long":case"esriFieldTypeLong":case"oid":case"esriFieldTypeOID":return{name:e.name,type:"number"};case"global-id":case"esriFieldTypeGlobalID":case"guid":case"esriFieldTypeGUID":case"string":case"esriFieldTypeString":return{name:e.name,type:"text"};case"date":case"esriFieldTypeDate":case"timestamp-offset":case"esriFieldTypeTimestampOffset":return{name:e.name,type:"date"};case"date-only":case"esriFieldTypeDateOnly":return{name:e.name,type:"dateOnly"};case"time-only":case"esriFieldTypeTimeOnly":return{name:e.name,type:"time"};default:return null}}function Z(e,r,n){if(e==null)return null;switch(r){case"time-only":return G(e)?e:Y.fromReader(e.toString());case"date-only":return S(e)?e:X.fromReader(e.toString());case"timestamp-offset":return I(e)?e:p.fromReaderAsTimeStampOffset(e.toString());case"date":return I(e)?e:se(e)?p.dateJSAndZoneToArcadeDate(e,n):p.epochToArcadeDate(e,n);case"geometry":return null;default:return e}}class o{constructor(){this.arcadeDeclaredClass="esri.arcade.Feature",this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._fieldTypesFixed=!0,this.fieldsIndex=null,this.contextTimeZone=null,this.immutable=!0,this._fieldsToFixDataTypes=null,this.immutable=!0}static createFromGraphic(r,n){const t=new o;return t.contextTimeZone=n??null,t._geometry=r.geometry!=null?r.geometry:null,r.attributes===void 0||r.attributes===null?t.attributes={}:t.attributes=r.attributes,r._sourceLayer?(t._layer=r._sourceLayer,t._fieldTypesFixed=!1):r._layer?(t._layer=r._layer,t._fieldTypesFixed=!1):r.layer&&"fields"in r.layer?(t._layer=r.layer,t._fieldTypesFixed=!1):r.sourceLayer&&"fields"in r.sourceLayer&&(t._layer=r.sourceLayer,t._fieldTypesFixed=!1),t._layer&&!t._fieldTypesFixed&&(t.fieldsIndex=this.hydrateFieldsIndex(t._layer)),t}static createFromArcadeFeature(r){if(r instanceof o){const t=new o;return t._fieldTypesFixed=r._fieldTypesFixed,t.attributes=r.attributes,t._geometry=r._geometry,t._optimizedGeomDefinition=r._optimizedGeomDefinition,r._layer&&(t._layer=r._layer),t.fieldsIndex=r.fieldsIndex,t.contextTimeZone=r.contextTimeZone,t}const n={};for(const t of r.keys())n[t]=r.field(t);return o.createFromGraphicLikeObject(r.geometry(),n,r.fullSchema(),r.contextTimeZone)}static createFromOptimisedFeature(r,n,t){const i=new o;return i._geometry=r.geometry?{geometry:r.geometry}:null,i._optimizedGeomDefinition=t,i.attributes=r.attributes||{},i._layer=n,i._fieldTypesFixed=!1,i}static createFromArcadeDictionary(r,n){const t=new o;return t.attributes=r.field("attributes"),t.attributes!==null&&t.attributes instanceof k?(t.attributes=t.attributes.attributes,t.attributes===null&&(t.attributes={})):t.attributes={},t._geometry=r.field("geometry"),t._geometry!==null&&(t._geometry instanceof k?t._geometry=C(t._geometry,n):t._geometry instanceof z||(t._geometry=null)),t}static createFromGraphicLikeObject(r,n,t=null,i){const s=new o;return s.contextTimeZone=i??null,n===null&&(n={}),s.attributes=n,s._geometry=r??null,s._layer=t,s._layer&&(s._fieldTypesFixed=!1,s.fieldsIndex=this.hydrateFieldsIndex(s._layer)),s}static hydrateFieldsIndex(r){return r===null?null:$(r)?r.getFieldsIndex():r.fieldsIndex?r.fieldsIndex:ae.fromLayerJSON({datesInUnknownTimezone:r.datesInUnknownTimezone,fields:r.fields,timeInfo:r.timeInfo,editFieldsInfo:r.editFieldsInfo,dateFieldsTimeReference:r.dateFieldsTimeReference??{timeZone:"UTC",respectsDaylightSaving:!1}})}repurposeFromGraphicLikeObject(r,n,t=null){n===null&&(n={}),this.attributes=n,this._geometry=r??null,this._layer=t,this._layer?this._fieldTypesFixed=!1:this._fieldTypesFixed=!0}castToText(r=!1){this._fieldTypesFixed===!1&&this._fixFieldTypes();const n=q(this.attributes,{useNumbersForDates:r});return'{"geometry":'+(this.geometry()===null?"null":H(this.geometry()))+',"attributes":'+n+"}"}_fixFieldTypes(){if(this._fieldsToFixDataTypes&&this._fieldsToFixDataTypes?.length>0)return this._fixAllFields(this._fieldsToFixDataTypes),void(this._fieldTypesFixed=!0);const r=[],n=this._layer.fields;for(let t=0;t<(n?.length??0);t++){const i=n[t],{name:s,type:a}=i;switch(a){case"date":case"esriFieldTypeDate":r.push({field:s,dataType:"date"});break;case"date-only":case"esriFieldTypeDateOnly":r.push({field:s,dataType:"date-only"});break;case"time-only":case"esriFieldTypeTimeOnly":r.push({field:s,dataType:"time-only"});break;case"timestamp-offset":case"esriFieldTypeTimestampOffset":r.push({field:s,dataType:"timestamp-offset"});break;case"geometry":case"esriFieldTypeGeometry":r.push({field:s,dataType:"geometry"})}}this._fieldsToFixDataTypes=r,r.length>0&&this._fixAllFields(r),this._fieldTypesFixed=!0}isUnknownDateTimeField(r){return this.fieldsIndex?.getTimeZone(r)==="unknown"}_fixAllFields(r){this.attributes={...this.attributes};const n=this.contextTimeZone??"system";for(let t=0;t<r.length;t++){const i=r[t].field,s=r[t].dataType;let a=this.attributes[i];if(a===void 0){for(const u in this.attributes)if(u.toLowerCase()===i.toLowerCase()){a=this.attributes[u],this.attributes[u]=Z(a,s,this.isUnknownDateTimeField(u)?"unknown":n);break}}else a!==null&&(this.attributes[i]=Z(a,s,this.isUnknownDateTimeField(i)?"unknown":n))}}geometry(){return this._geometry===null||this._geometry instanceof z||(this._optimizedGeomDefinition?(this._geometry=T(ie(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM)),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=T(this._geometry)),this._geometry}field(r){this._fieldTypesFixed||this._fixFieldTypes();const n=this.attributes[r];if(n!==void 0)return n;const t=r.toLowerCase();for(const i in this.attributes)if(i.toLowerCase()===t)return this.attributes[i];if(this._hasFieldDefinition(t))return null;throw new l(null,"FieldNotFound",null,{key:r})}_hasFieldDefinition(r){if(this._layer===null)return!1;for(let n=0;n<this._layer.fields.length;n++)if(this._layer.fields[n].name.toLowerCase()===r)return!0;return!1}setField(r,n){if(this.immutable)throw new l(null,"Immutable",null);if(n instanceof Date&&(n=this.isUnknownDateTimeField(r)?p.unknownDateJSToArcadeDate(n):p.dateJSToArcadeDate(n)),L(n)===!1)throw new l(null,"TypeNotAllowedInFeature",null);const t=r.toLowerCase();if(this.attributes[r]===void 0){for(const i in this.attributes)if(i.toLowerCase()===t)return void(this.attributes[i]=n);this.attributes[r]=n}else this.attributes[r]=n}hasField(r){const n=r.toLowerCase();if(this.attributes[r]!==void 0)return!0;for(const t in this.attributes)if(t.toLowerCase()===n)return!0;return!!this._hasFieldDefinition(n)}keys(){let r=[];const n={};for(const t in this.attributes)r.push(t),n[t.toLowerCase()]=1;if(this._layer!==null)for(let t=0;t<this._layer.fields.length;t++){const i=this._layer.fields[t];n[i.name.toLowerCase()]!==1&&r.push(i.name)}return r=r.sort(),r}isEmpty(){for(const r in this.attributes)return!1;return!(this._layer!=null&&this._layer.fields.length>0)&&this.geometry()==null}static parseAttributesFromDictionary(r){const n={};for(const t in r.attributes){const i=r.attributes[t];if(!L(i))throw new l(null,"InvalidParameter",null);n[t]=i}return n}static fromJson(r,n){let t=null;r.geometry!==null&&r.geometry!==void 0&&(t=T(r.geometry));const i={};if(r.attributes!==null&&r.attributes!==void 0)for(const s in r.attributes){const a=r.attributes[s];if(a===null)i[s]=a;else{if(!(te(a)||re(a)||ne(a)||I(a)||G(a)||S(a)))throw new l(null,"InvalidParameter",null);i[s]=a}}return o.createFromGraphicLikeObject(t,i,null,n??null)}fullSchema(){return this._layer}gdbVersion(){if(this._layer===null)return"";const r=this._layer.gdbVersion;return r===void 0?"":r===""&&this._layer.capabilities?.isVersioned?"SDE.DEFAULT":r}castAsJson(r){const n={attributes:{},geometry:r?.keepGeometryType===!0?this.geometry():this.geometry()?.toJSON()??null};for(const t in this.attributes){const i=this.attributes[t];i!==void 0&&(n.attributes[t]=W(i,r))}return n}async castAsJsonAsync(r=null,n){return this.castAsJson(n)}}ee(o);const be=Object.freeze(Object.defineProperty({__proto__:null,Feature:o,convertAttributeToArcadeValue:Z,getArcadeVariableForField:Q},Symbol.toStringTag,{value:"Module"}));export{Q as D,be as F,o as I,C as a,Z as w};
