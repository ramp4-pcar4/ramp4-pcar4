{"version":3,"file":"FlowWorker-nlAWmcNV.js","sources":["../../node_modules/@arcgis/core/views/3d/support/flow/FlowQuery3D.js","../../node_modules/@arcgis/core/views/3d/support/flow/loadUtils.js","../../node_modules/@arcgis/core/views/3d/support/flow/FlowWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{Cyclical as t}from\"../../../../core/Cyclical.js\";import{height as e,fromExtent as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{getInfo as i}from\"../../../../geometry/support/spatialReferenceUtils.js\";class o{constructor(t,e,n,i,o){this.extent=t,this.timeExtent=e,this.size=n,this.pixelRatio=i,this.time=o}get flowExtentInfo(){return{modelSize:this.size,valid:i(this.extent.spatialReference)?.valid,extent:n(this.extent)}}insideMapExtent(t,e){return r(this.flowExtentInfo,t,e)}modelToMapSpace(t,e,n){return l(this.flowExtentInfo,t,e,n)}}function r(t,e,n){const{extent:i,valid:o}=t,[r,l,s,a]=i;return!(n<l||n>a)&&(null!=o&&r>s?e>=s||e<=r:e>=r&&e<=s)}function l(n,i,o,r){const{extent:l,modelSize:s,valid:u}=n,[c,f,x]=l,m=a(c,x,u);let p=i/s[0]*m+c;if(null!=u&&r){p=new t(u[0],u[1]).normalize(p)}return[p,(s[1]-o)/s[1]*e(l)+f]}function s(t,e,n){return null!=n&&Math.abs(t-n.valid[0])<n.dx&&Math.abs(e-n.valid[1])<n.dx}function a(t,e,n){if(null!=n&&t>e){const[i,o]=n;return o-t+(e-i)}return e-t}export{o as FlowQuery3D,r as insideMapExtent,s as isFullExtent,l as modelToMapSpace,a as wrappedWidth};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{containsXY as t,width as n,height as e,create as r}from\"../../../../geometry/support/aaBoundingRect.js\";import{createFlowFieldFromData as l}from\"../../../2d/engine/flow/dataUtils.js\";import{getFeatureTileId as o}from\"../../layers/support/FeatureTileDescriptor.js\";import{modelToMapSpace as i,insideMapExtent as u,isFullExtent as s}from\"./FlowQuery3D.js\";function f(t){return t?4:3}function a(t){return t[0].vertices instanceof Float32Array}class c{constructor(t,n,e,r,l,o){this.data=t,this.mask=n,this.width=e,this.height=r,this.lij=l,this.extent=o}}function h(t){return o(t.lij[0],t.lij[1],t.lij[2])}function m(t,n){let[e,l,o,i]=[null,null,null,null];for(const r of t){const t=r.extent;e=p(t[0],e),l=p(t[1],l),o=d(t[2],o),i=d(t[3],i)}if(null==e||null==l||null==o||null==i)return null;if(s(e,o,n)){const n=[...t].toSorted((t,n)=>t.extent[0]-n.extent[0]);let r=n[0].extent[2],l=0,i=0,u=0;for(let t=1;t<n.length;t++){const[e,o,s]=n[t].extent;if(r<e&&(u++,l=r,i=e,u>1))break;r=Math.max(r,s)}1===u&&(e=i,o=l)}return r([e,l,o,i])}function d(t,n){return null==n?t:Math.max(t,n)}function p(t,n){return null==n?t:Math.min(t,n)}function x(r,o,s){const[f,a]=s.modelSize;let c=null;const h=new Map;o.forEach(t=>{h.set(t.lij,l(r,t))});const m=(n,e,r)=>t(n.extent,e,r);return(t,l)=>{const d=Math.round(t),p=Math.round(l);if(!r.wrapAround&&(d<0||d>=f||p<0||p>=a))return[0,0];const[x,j]=i(s,t,l,!0);if(!u(s,x,j))return[0,0];if(null==c||!m(c,x,j)){c=null;for(const[t,n]of o)if(m(n,x,j)){c=n;break}}if(null==c?.data)return[0,0];const g=h.get(c.lij);if(null==g)return[0,0];const{width:w,height:M,extent:y}=c;return g((x-y[0])/n(y)*w,M-(j-y[1])/e(y)*M)}}export{c as FlowDataTile,m as boundingRectOfTiles,x as createFlowFieldFromDataTiled,a as isFlowPathBuffer,h as tileToKey,f as valuesPerFlowVertex};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as t}from\"tslib\";import\"../../../../core/Logger.js\";import\"../../../../core/has.js\";import\"../../../../core/RandomLCG.js\";import\"../../../../core/Error.js\";import{subclass as e}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{createFlowFieldFromData as s,traceFlowPaths as r}from\"../../../2d/engine/flow/dataUtils.js\";import{createFlowFieldFromDataTiled as o,valuesPerFlowVertex as a}from\"./loadUtils.js\";let i=class{constructor(){this._tileData=new Map}async generateStreamlines(t){const{flowData:e,flowExtentInfo:r,needsMagnitude:o,simulationSettings:a,startPositions:i}=t,n=l(s(a,e),a,r.modelSize,o,i);return{result:{streamlines:n},transferList:n?.map(t=>t.vertices.buffer)}}async generateTiledStreamlines(t){const{flowDataTiles:e,flowExtentInfo:s,needsMagnitude:r,reset:a,simulationSettings:i,startPositions:n}=t;this._updateTileData(e,a);const c=l(o(i,this._tileData,s),i,s.modelSize,r,n);return{result:{streamlines:c},transferList:c?.map(t=>t.vertices.buffer)??[]}}_updateTileData(t,e){e&&this._tileData.forEach((e,s)=>{null==t.get(s)&&this._tileData.delete(s)}),t.forEach((t,e)=>{\"delete\"===t.type?this._tileData.delete(e):\"on-worker\"!==t.type&&\"waiting\"!==t.type&&this._tileData.set(e,t.data)})}};i=t([e(\"esri.views.3d.support.flow.FlowWorker\")],i);const n=i;function l(t,e,s,o,i){if(null==t)return;const n=r(e,t,s[0],s[1],{positions:i}),l=[],c=a(o);for(const{vertices:r,stage:a}of n){const t=new Float32Array(r.length*c);for(let e=0;e<r.length;e++)t[e*c]=r[e].x,t[e*c+1]=r[e].y,t[e*c+2]=r[e].t,o&&(t[e*c+3]=r[e].speed);l.push({vertices:t,stage:a,hasMagnitude:o})}return l}export{n as default};\n"],"names":["r","t","e","n","i","o","l","s","a","u","c","f","x","m","p","h","d","j","w","M","y"],"mappings":"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","x_google_ignoreList":[0,1,2]}