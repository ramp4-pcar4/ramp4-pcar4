import{az as S,cY as U,d3 as j,gv as E,ks as h}from"./main-pOgmbpmS.js";import{b as I,Q as L,r as z,a as B,f as b,E as W,h as A}from"./HUDMaterial.glsl-CLkLU-T0.js";import{i as C,y as D}from"./memoryEstimations-BqgYRRhe.js";import{n as R}from"./mat4-BBA0NsiW.js";import{r as N,g as _,u as k,A as J,s as d}from"./vec32-DlcWpOx5.js";import{z as Q}from"./vec42-CyE6Fzqy.js";import{n as Y}from"./vec4f64-DD-nkcCV.js";import{b as q,v}from"./sphere-BqGvU9xz.js";import"./glsl-CfY1Aoj6.js";import"./vec2f64-CkowXrDb.js";import"./ShaderBuilder-B9Qsz-VF.js";import{i as F,m as H,v as K,J as X,_ as Z}from"./DefaultMaterial-DK0peuQK.js";import"./OutputColorHighlightOID.glsl-CzaQ5Ix1.js";import"./lengthUtils-stH6eFuO.js";class w{get ray(){return this._ray}get distanceInRenderSpace(){return this.distance==null?null:(_(p,this.ray.direction,this.distance),N(p))}withinDistance(e){return!!G(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!G(this)&&(_(p,this.ray.direction,this.distance),k(e,this.ray.origin,p),!0)}getTransformedNormal(e){return d(l,this.normal),l[3]=0,Q(l,l,this.transformation),d(e,l),J(e,e)}constructor(e){this.intersector=4,this.normal=S(),this.transformation=U(),this._ray=q(),this.init(e)}init(e){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=4,v(e,this._ray)}set(e,r,t,i,n,a,o){this.intersector=e,this.distance=t,d(this.normal,i??j),R(this.transformation,n??E),this.target=r,this.drapedLayerOrder=a,this.renderPriority=o}copy(e){v(e.ray,this._ray),this.intersector=e.intersector,this.distance=e.distance,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.renderPriority=e.renderPriority,d(this.normal,e.normal),R(this.transformation,e.transformation)}}function G(s){return s?.distance!=null}const p=S(),l=Y();class ${constructor(e){this.layerViewUid=e}}class ee extends ${constructor(e,r){super(e),this.graphicUid=r}}class te extends ee{constructor(e,r,t,i,n){super(e,r),this.layerViewUid=e,this.graphicUid=r,this.triangleNr=t,this.baseBoundingSphere=i,this.numLodLevels=n}}class re{constructor(e,r,t,i){this.material=e,this.buffer=r,this.numVertices=t,this.boundingInfo=i,this.bufferWriter=e.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+D}get renderGeometry(){return this}intersect(e,r,t,i,n,a,o,u){const c=this.bufferWriter,m=this.buffer;c.intersect(m,this.material.parameters,null,e,t,i,(f,g,P)=>x(f,g,P,e,r,a,o,n,u))}}class O{constructor(e){this.engineGeometry=e;const r=this.material,t=this.engineGeometry,i=t.attributes,n=t.boundingInfo,a=r.createBufferWriter(),o=a.layout,u=a.elementCount(i),c=o.createBuffer(u);a.write(null,null,i,null,c,0),this.renderGeometry=new re(r,c.buffer,u,n)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,r)=>e+C(r.data,r.indices),0)}intersect(e,r,t,i,n,a,o,u){const c=this.engineGeometry;this.material.intersect(c,e.transform.transform,e,t,i,(m,f,g)=>x(m,f,g,e,r,a,o,n,u))}}function x(s,e,r,t,i,n,a,o,u){if(s<0||i&&!i(t.rayBegin,t.rayEnd,s))return;const c=new te(n.layerViewUid,n.graphicUid(o),r,a,u);if((t.results.min.distance==null||s<t.results.min.distance)&&t.results.min.set(3,c,s,e,t.transform.transform),(t.results.max.distance==null||s>t.results.max.distance)&&t.results.max.set(3,c,s,e,t.transform.transform),t.options.store===2){const m=new w(t.results.min.ray);m.set(3,c,s,e,t.transform.transform),t.results.all.push(m)}}let T=class{constructor(s,e=null){this.geometry=s,this.textures=e}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}};class V{constructor(e,r,t){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=t;const i=h(this.components.map(n=>n.geometry));this.numVertices=i.reduce((n,a)=>n+a.numVertices,0)}}class M{constructor(e){this.levels=e,this.levels.sort((r,t)=>r.minScreenSpaceRadius===t.minScreenSpaceRadius?r.numVertices-t.numVertices:r.minScreenSpaceRadius-t.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){const e=[];return this.levels.forEach(r=>r.components.forEach(t=>e.push(t.geometry.material))),h(e)}getTextures(){const e=new Array;return this.levels.forEach(r=>r.components.forEach(t=>{t.textures!=null&&e.push(...t.textures)})),h(e)}getGeometries(){const e=new Array;return this.levels.forEach(r=>r.components.forEach(t=>{e.push(t.geometry)})),h(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>e!=null)}computeUsedMemory(){const e=this.getGeometries(),r=this.getTextures(),t=e.reduce((i,n)=>i+n.computeUsedMemory(),0);return r.reduce((i,n)=>i+n.usedMemory,0)+t}}function se(s){switch(s){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function ie(s,e){const r=(t,i,n=!1)=>new M(t.map(a=>{const o=i(a.tesselation);return n&&I(o),new V([new T(new O(o))],a.minScreenSpaceRadius)}));switch(s){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],t=>A(e,.5,t));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>W(e,1));case"cone":return r(y,t=>b(e,1,.5,t,!1),!0);case"inverted-cone":return r(y,t=>b(e,1,.5,t,!0),!0);case"cylinder":return r(y,t=>B(e,1,.5,t,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>z(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>L(e,1),!0);default:return}}const y=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}],ne=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"})),ae=Object.freeze(Object.defineProperty({__proto__:null,build:H,getRadius:K},Symbol.toStringTag,{value:"Module"})),oe=Object.freeze(Object.defineProperty({__proto__:null,build:X},Symbol.toStringTag,{value:"Module"})),ce=Object.freeze(Object.defineProperty({__proto__:null,build:Z},Symbol.toStringTag,{value:"Module"}));export{oe as D,ce as R,se as S,V as a,ne as b,M as c,ae as d,w as f,ie as l,T as m,O as o};
