import{aJ as B,d5 as T,kc as O,bZ as Q,f8 as S,dq as k,bJ as q,bA as A}from"./main-pOgmbpmS.js";import{e as Z}from"./utils-Cri6ie95.js";import{n as j,v as K}from"./jsxFactory-CFfRsm5M.js";import"./intl-BSTGyBMu.js";import{c as v,s as L,l as W}from"./messages-DIIGODWw.js";import{x as D}from"./utils-dFbb1tu-.js";import{c as G}from"./typeUtils-DqfxYaWO.js";function H({level:t,class:e,...n},o){const l=b(t);return j(`h${l}`,{...n,"aria-level":String(l),class:K(Z.heading,e),role:"heading"},o)}function b(t){return B(Math.ceil(t),1,6)}function z(t,e=1){return b(t+e)}const X=/^-?(\d+)(\.(\d+))?$/i;function Y(t,e){return t-e}function P(t,e){let n,o;return n=Number(t.toFixed(e)),n<t?o=n+1/10**e:(o=n,n-=1/10**e),n=Number(n.toFixed(e)),o=Number(o.toFixed(e)),[n,o]}function J(t,e,n,o,l){const r=y(t,e,n,o),i=r.previous==null||r.previous<=l,a=r.next==null||r.next<=l;return i&&a||r.previous+r.next<=2*l}function g(t){const e=String(t),n=e.match(X);if(n?.[1])return{integer:n[1].split("").length,fractional:n[3]?n[3].split("").length:0};if(e.toLowerCase().includes("e")){const o=e.split("e"),l=o[0],r=o[1];if(l&&r){const i=Number(l);let a=Number(r);const u=a>0;u||(a=Math.abs(a));const s=g(i);return u?(s.integer+=a,a>s.fractional?s.fractional=0:s.fractional-=a):(s.fractional+=a,a>s.integer?s.integer=1:s.integer-=a),s}}return{integer:0,fractional:0}}function y(t,e,n,o){const l={previous:null,next:null};if(n!=null){const r=t-n,i=e-n-r;l.previous=Math.floor(Math.abs(100*i/r))}if(o!=null){const r=o-t,i=o-e-r;l.next=Math.floor(Math.abs(100*i/r))}return l}function $(t,e={}){const n=t.slice(),{tolerance:o=2,strictBounds:l=!1,indexes:r=n.map((i,a)=>a)}=e;r.sort(Y);for(let i=0;i<r.length;i++){const a=r[i],u=n[a],s=a===0?null:n[a-1],c=a===n.length-1?null:n[a+1],f=g(u).fractional;if(f){let m,p=0,d=!1;for(;p<=f&&!d;){const w=P(u,p);m=l&&i===0?w[1]:w[0],d=J(u,m,s,c,o),p++}d&&(n[a]=m)}}return n}const _={maximumFractionDigits:20};function tt(t){return v(t,_)}const C="<",I=">";function F(t,e,n,o){let l="";e===0?l=`${C} `:e===n&&(l=`${I} `);const r=x(t,o);return r==null?"":l+r}function et(t){const{format:e,fieldFormat:n}=t||{};return n?.type==="number"||!!e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)}function x(t,e){if(t==null)return t;const{fieldType:n,format:o,fieldFormat:l,timeZoneOptions:r}=e||{};if(h(n))return D(t,{fieldType:n,format:o?.dateFormat,fieldFormat:l?.type==="date-time"?l:void 0,timeZoneOptions:r});if(typeof t=="string"&&et(e)){const a=Number(t);isNaN(a)||(t=a)}if(typeof t=="string")return t;const i=l?.type==="number"?L(l):o?W(o):void 0;return i?v(t,i):tt(t)}const nt=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function N(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const e=t.visualVariables.find(i=>i.type==="color");if(!e)return null;let n=null,o=null;if(e.stops){if(e.stops.length===1)return e.stops[0].color;n=e.stops[0].value,o=e.stops[e.stops.length-1].value}const l=n!=null&&o!=null?n+(o-n)/2:0,{getColor:r}=await import("./visualVariableUtils-BCkM_1mb.js").then(i=>i.v);return r(e,l)??null}async function ot(t,e){const n=t.trailCap,o=t.trailWidth||1,l=e||await N(t)||t.color;return new T({cap:n,color:l,width:o})}function lt(t,e){if(!e)return null;if("featureReduction"in t)switch(t.featureReduction?.type){case"cluster":case"binning":{const n=t.featureReduction.fields.find(({name:o})=>o.toLowerCase()===e.toLowerCase());return n&&"getField"in t?t.getField(n.onStatisticField):null}}return"getField"in t?t.getField?.(e):null}function rt(t,e){const n="popupTemplate"in t?t.popupTemplate?.fieldInfos:null;if(n?.length&&e)return n.find(o=>o.fieldName?.toLowerCase()===e.toLowerCase())}function V(t){let e=0,n=0;return t.stops?(e=t.stops?.at(0)?.value??e,n=t.stops?.at(-1)?.value??n):"minDataValue"in t&&"maxDataValue"in t&&(e=t.minDataValue??e,n=t.maxDataValue??n),n-e>2*k.days?"short-date":"short-date-short-time"}function h(t){return["date","date-only","time-only","timestamp-offset"].includes(t||"")}function U(t){return S(t)&&!("featureReduction"in t&&t.featureReduction)}function at(t,e,n){const o=R(t,e.field,n);return o?(h(o.fieldType)&&(U(t)?o.fieldFormat??=new O({dateStyle:"short",timeStyle:V(e)==="short-date-short-time"?"short":null}):o.format??=new Q({dateFormat:V(e)})),o):null}function R(t,e,n){const o=lt(t,e),l=o?.name;if(!l)return null;const r=o?.type,i=U(t);return{fieldType:r,format:i?null:rt(t,l)?.format,fieldFormat:i?t.getFieldConfiguration(l)?.fieldFormat:null,timeZoneOptions:h(r)?{layerTimeZone:"preferredTimeZone"in t?t.preferredTimeZone:null,viewTimeZone:n,datesInUnknownTimezone:"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone}:null}}function it(t,e){if("authoringInfo"in t)return t.authoringInfo?.visualVariables?.find(({theme:n})=>n===e)}function st(t,e){let n=t??"";return e!=null&&e&&(n=n?"("+n+") AND ("+e+")":e),n}const ut=new A([64,64,64]);function M(t,e){const n=[],o=t.length-1;return t.length===5?n.push(0,2,4):n.push(0,o),t.map((l,r)=>n.includes(r)?F(l,r,o,e):null)}async function ct(t,e,n){let o=!1,l=[],r=[];if(t.stops){const s=t.stops;l=s.map(c=>c.value),o=s.some(c=>!!c.label),o&&(r=s.map(c=>c.label))}const i=l[0],a=l[l.length-1];if(i==null&&a==null)return null;const u=o?null:M(l,n);return(await Promise.all(l.map(async(s,c)=>{const f=t.type==="opacity"?await At(s,t,e):(await import("./visualVariableUtils-BCkM_1mb.js").then(p=>p.v)).getColor(t,s),m=o?r[c]:u?.[c]??"";return f==null?null:{value:s,color:f,label:m}}))).filter(q).reverse()}async function At(t,e,n){const o=new A(n??ut),l=(await import("./visualVariableUtils-BCkM_1mb.js").then(r=>r.v)).getOpacity(e,t);return l!=null&&(o.a=l),o}function ft(t){let e=!1,n=[],o=[];n=t.map(a=>a.value),e=t.some(a=>!!a.label),e&&(o=t.map(a=>a.label??""));const l=n[0],r=n[n.length-1];if(l==null&&r==null)return null;const i=e?null:M(n);return n.map((a,u)=>({value:a,color:E(a,t),label:e?o[u]:i?.[u]??""})).reverse()}function E(t,e){const{startIndex:n,endIndex:o,weight:l}=mt(t,e);if(n===o)return e[n].color;const r=A.blendColors(e[n].color,e[o].color,l);return new A(r)}function mt(t,e){let n=0,o=e.length-1;return e.some((l,r)=>t<l.value?(o=r,!0):(n=r,!1)),{startIndex:n,endIndex:o,weight:(t-e[n].value)/(e[o].value-e[n].value)}}function pt(t,e){let n=[];if(t&&t.type==="multipart")t.colorRamps.reverse().forEach((o,l)=>{l===0?n.push({value:e.max,color:new A(o.toColor),label:"high"}):n.push({value:null,color:new A(o.toColor),label:""}),l===t.colorRamps.length-1?n.push({value:e.min,color:new A(o.fromColor),label:"low"}):n.push({value:null,color:new A(o.fromColor),label:""})});else{let o,l;t&&t.type==="algorithmic"?(o=t.fromColor,l=t.toColor):(o=[0,0,0,1],l=[255,255,255,1]),n=[{value:e.max,color:new A(l),label:"high"},{value:e.min,color:new A(o),label:"low"}]}return n}function dt(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(o=>o.color?.a>0);let n=e.length-1;if(e&&e[0]){const o=e[n];o&&o.ratio!==1&&(e.push(new G({ratio:1,color:o.color})),n++)}return e.map((o,l)=>{let r="";return l===0?r=t.legendOptions?.minLabel||"low":l===n&&(r=t.legendOptions?.maxLabel||"high"),{color:o.color,label:r,ratio:o.ratio}}).reverse()}export{it as C,at as V,C as a,ft as b,st as c,x as d,pt as e,I as f,N as g,nt as h,g as i,R as j,H as k,y as l,F as m,z as n,dt as r,E as s,ct as t,$ as u,ot as w};
