import{fy as H,fz as N,fS as R,fC as q,fF as Q,fE as x,fU as L,e9 as r,fG as O,fH as U,ea as C,fL as E,e7 as D,e8 as b,lZ as ae,ar as k,fQ as ne,fR as X,fT as Y,fD as T,fK as P,iN as oe,i5 as Z,jm as J,l_ as ie,l$ as se,fM as le,fA as re,hh as W,fP as pe,m0 as F,m1 as ue,fW as V,fJ as I,fI as S,ly as ee,m2 as de,F as ce,fq as fe}from"./main-pOgmbpmS.js";import{k as me}from"./keyboard-O-FN7ZtD.js";class G{id;options;componentId;constructor(a){const p={options:{},...a};({id:this.id,options:this.options,componentId:this.componentId}=p)}}const ve=["innerHTML"],j=H({__name:"default-button",props:{panelId:{type:String,required:!0},minimize:{type:Boolean,default:!1},overflow:{type:Boolean}},setup(v){const{t:a}=N(),p=R("iApi"),n=v,c=q(()=>p.panel.get(n.panelId)?.button),s=()=>{n.minimize?p.panel.toggleMinimize(n.panelId):p.panel.toggle(n.panelId)};return(e,y)=>{const u=Q("appbar-button");return c.value?(r(),x(u,{key:0,onClickFunction:s,tooltip:O(a)(c.value.tooltip),"button-id":v.panelId},{default:U(()=>[C("div",{class:E(["default fill-current w-24 h-24 ml-8 sm:ml-20",{"ml-20":v.overflow}]),innerHTML:c.value.icon},null,10,ve)]),_:1},8,["tooltip","button-id"])):L("",!0)}}}),he={},be={class:"border-b p-0 self-center w-2/3"};function ge(v,a){return r(),b("span",be)}const te=D(he,[["render",ge],["__scopeId","data-v-5d32b715"]]);var ye={name:"maxSize",enabled:!0,phase:"main",requiresIfExists:["offset","preventOverflow","flip"],fn:function(v){var a=v.state,p=v.name,n=v.options,c=ae(a,n),s=a.modifiersData.preventOverflow||{x:0,y:0},e=s.x,y=s.y,u=a.rects.popper,d=u.width,h=u.height,z=a.placement.split("-"),$=z[0],_=$==="left"?"left":"right",A=$==="top"?"top":"bottom";a.modifiersData[p]={width:d-c[_]-e,height:h-c[A]-y}}};const $e=["content","aria-label"],we=H({__name:"more-button",props:{position:{type:String,default:"right-end"},popperOptions:{type:Object,default(){return{}}},numItems:{type:Number,default:1},renderWatch:{type:Number,default:0}},emits:["updateParent"],setup(v,{expose:a,emit:p}){const{t:n}=N(),c=R("iApi"),s=v,e=p;function y(){e("updateParent")}const u=k(!1),d=k(0),h=k(),z=k(),$=k();function _(){y(),J(()=>{A(),u.value=!u.value})}ne(()=>s.renderWatch,()=>{_()});const A=()=>{u.value=!u.value;const l=c.$vApp.$el.querySelector(".inner-shell"),f={name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:m}){const{width:g}=m.modifiersData.maxSize;m.styles.popper={...m.styles.popper,maxWidth:`${g}px`,maxHeight:`${l.offsetHeight-45}px`};const o=Math.min(s.numItems<=0?0:55+44*(s.numItems-1),l.offsetHeight-45);m.styles.popper.height=`${o}px`,$?.value?.offsetHeight&&($.value.style.height=`${o}px`),m.styles.popper.overflowY="auto",m.styles.popper.overflowX="hidden"}};z.value&&$.value&&(d.value++,ie(z.value,$.value,{placement:s.position||"right-end",modifiers:[{...ye,options:{boundary:l}},f,{name:"offset",options:{offset:[0,5]}},{name:"preventOverflow",enabled:!0,options:{boundary:l}}],...s.popperOptions})),d.value===1&&_()};return X(()=>{window.addEventListener("click",l=>{l.target instanceof HTMLElement&&!h.value?.contains(l.target)&&(u.value=!1)},{capture:!0})}),Y(()=>{window.removeEventListener("click",l=>{l.target instanceof HTMLElement&&!h.value?.contains(l.target)&&(u.value=!1)},{capture:!0})}),a({rerender:_}),(l,f)=>{const m=P("focus-item"),g=P("tippy");return r(),b("div",{class:"appbar-item relative inset-x-0 w-full text-center",ref_key:"el",ref:h},[T((r(),b("button",{type:"button",class:"text-gray-400 w-full h-48 focus:outline-none hover:text-white",onClick:f[0]||(f[0]=o=>A()),content:O(n)("appbar.more"),"aria-label":O(n)("appbar.more"),ref_key:"dropdownTrigger",ref:z},f[1]||(f[1]=[C("svg",{class:"fill-current w-24 h-24 m-auto",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[C("path",{d:"M0 0h24v24H0z",fill:"none"}),C("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})],-1)]),8,$e)),[[m],[g,{placement:"right-end"}]]),T(C("div",{id:"dropdown",class:"dropdown shadow-md border border-gray:200 absolute w-64 flex flex-col bg-white rounded",ref_key:"dropdown",ref:$},[oe(l.$slots,"default",{},void 0,!0)],512),[[Z,u.value]])],512)}}}),xe=D(we,[["__scopeId","data-v-87bcc276"]]),ke={key:0,class:"number absolute top-1 right-2 text-white w-18 rounded-full"},Ie=H({__name:"appbar-button",setup(v){const a=se(),{t:p}=N(),n=R("iApi"),c=q(()=>a.notificationNumber),s=()=>{n.panel.toggle("notifications")};return(e,y)=>{const u=Q("appbar-button",!0);return r(),x(u,{onClickFunction:s,tooltip:O(p)("notifications.title"),class:"notification-button","button-id":"notificationsButton"},{default:U(()=>[y[0]||(y[0]=C("svg",{class:"fill-current w-24 h-24 mx-8 sm:mx-20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[C("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})],-1)),c.value&&c.value>0?(r(),b("span",ke,le(c.value),1)):L("",!0)]),_:1},8,["tooltip"])}}}),Ee=D(Ie,[["__scopeId","data-v-9d3c6152"]]),_e=["content"],ze=H({__name:"appbar",setup(v){const a=re(),p=W(),n=k(0),c=k(0),s=q(()=>p.visible),e=q(()=>p.temporary),{t:y}=N(),u=k(!1),d=k({}),h=k(),z=()=>{J(()=>{F()?.proxy?.$forceUpdate()})},$=()=>{h.value._tippy.hide()},_=l=>{me(l,h.value)&&h.value._tippy.show()},A=()=>{const l=h.value;let f;const m=[...l.children];let g=m[m.length-2].getBoundingClientRect().top;a.mobileView||(g=l.getBoundingClientRect().bottom-38);const o=l.querySelector("#dropdown");for(let i=m.length-4;i>=0;i--){const M=m[i].getBoundingClientRect().bottom;if(g&&o&&(M>g||u.value&&M+56>g))m[i].classList.forEach(B=>{B.includes("identifier")&&(f=B.slice(11))}),f&&(d.value[f]=!0,f.includes("divider")||n.value++,c.value++),u.value||(u.value=!0);else if(M!==0)break}const w=l.querySelector("#more");let t=w.getBoundingClientRect().bottom;if(f=void 0,u.value&&g&&w&&o&&t!==0&&(t<=g-56||o.childElementCount==1&&t<=g)){let i=o.childElementCount,M=0;for(;t<=g-56||i==1;){const B=o.children[M];if(B&&(B.classList.forEach(K=>{K.includes("identifier")&&(f=K.slice(11))}),f&&(d.value[f]=!1,f.includes("divider")||n.value--),t+=48,i-=1,M+=1),i===0){u.value=!1;break}}}Object.keys(d.value).forEach(i=>{l.querySelector(`.identifier-${i}`)||(delete d.value[i],i.includes("divider")||(n.value=Math.max(0,n.value-1)),c.value++)})};return X(()=>{h.value?.addEventListener("blur",$),h.value?.addEventListener("keyup",_)}),pe(()=>{const l=F();window.addEventListener("resize",()=>l?.proxy?.$forceUpdate())}),Y(()=>{const l=F();window.removeEventListener("resize",()=>l?.proxy?.$forceUpdate()),h.value?.removeEventListener("blur",$),h.value?.removeEventListener("keyup",_)}),ue(async()=>{setTimeout(()=>A(),0)}),(l,f)=>{const m=P("focus-list"),g=P("tippy");return T((r(),b("div",{class:"absolute top-0 left-0 bottom-28 flex flex-col w-40 pointer-events-auto appbar z-50 sm:z-20 bg-black-75 sm:w-64 sm:bottom-38",content:O(y)("panels.controls.items"),ref_key:"el",ref:h},[(r(!0),b(I,null,S(s.value,(o,w)=>(r(),b(I,null,[(r(!0),b(I,null,S(o,(t,i)=>(r(),b(I,null,[typeof t=="string"&&d.value[`${t}-${i}`]!==!0?(r(),x(j,{key:`${t}-${i}-default`,panelId:t,class:E(["appbar-item h-48",`identifier-${t}-${i}`])},null,8,["panelId","class"])):d.value[`${t.id}-${i}`]!==!0?(r(),x(ee(t.componentId),{key:`${t.id}-${i}-custom`,options:t.options,class:E(["appbar-item h-48",`identifier-${t.id}-${i}`]),buttonId:t.id},null,8,["options","buttonId","class"])):L("",!0)],64))),256)),d.value[`divider-${w}`]!==!0?(r(),x(te,{class:E(["appbar-item",`identifier-divider-${w}`]),key:`${o}-${w}-default`},null,8,["class"])):L("",!0)],64))),256)),(r(!0),b(I,null,S(e.value?.filter(o=>d.value[`${o}-temp`]!==!0),o=>(r(),x(j,{panelId:o,minimize:!0,key:`${o}-temp`,class:E([`identifier-${o}-temp`,"appbar-item h-48"])},null,8,["panelId","class"]))),128)),T(V(xe,{id:"more",numItems:n.value,renderWatch:c.value,onUpdateParent:z},{default:U(()=>[(r(!0),b(I,null,S(s.value,(o,w)=>(r(),b(I,{key:w},[(r(!0),b(I,null,S(o,(t,i)=>(r(),b(I,null,[typeof t=="string"&&d.value[`${t}-${i}`]?(r(),x(j,{key:`${t}-${i}-default`,panelId:t,class:E(["text-black hover:bg-gray my-4 h-36",`identifier-${t}-${i}`]),overflow:""},null,8,["panelId","class"])):d.value[`${t.id}-${i}`]?(r(),x(ee(t.componentId),{key:`${t.id}-${i}-custom`,options:t.options,buttonId:t.id,class:E(["appbar-item h-48",`identifier-${t.id}-${i}`])},null,8,["options","buttonId","class"])):L("",!0)],64))),256)),d.value[`divider-${w}`]?(r(),x(te,{key:0,class:E(["border-black my-4",`identifier-divider-${w}`])},null,8,["class"])):L("",!0)],64))),128)),(r(!0),b(I,null,S(e.value?.filter(o=>d.value[`${o}-temp`]),o=>(r(),x(j,{panelId:o,minimize:!0,key:`${o}-temp`,class:E([`identifier-${o}-temp`,"text-black hover:bg-gray my-4 h-36"]),overflow:""},null,8,["panelId","class"]))),128))]),_:1},8,["numItems","renderWatch"]),[[Z,u.value]]),V(Ee,{class:"appbar-item bottom-48 h-48 sm:display-none"}),V(de,{class:"absolute bottom-0 h-40 sm:display-none w-full text-center",position:"right-start"})],8,_e)),[[m],[g,{trigger:"manual",touch:!1,placement:"top-end",popperOptions:{placement:"top",modifiers:[{name:"preventOverflow",options:{altAxis:!0}},{name:"flip",options:{fallbackPlacements:["top"]}}]}}]])}}});class Ce extends ce{get config(){return super.config}_parseConfig(a){if(!a)return;const p=W(this.$vApp.$pinia);let n;Array.isArray(a.items[0])?n=a.items:n=[a.items];const c=[];n.forEach(s=>{c.push(s.map(e=>typeof e=="string"?e:new G(e)))}),p.items=c.flat().reduce((s,e)=>(s[e instanceof G?e.id:e]=e,s),{}),p.order=c.map(s=>s.map(e=>e instanceof G?e.id:e)),this._validateItems()}_validateItems(){const a=W(this.$vApp.$pinia);a.order.flat().forEach(p=>{typeof a.items[p]!="string"&&[p].some(n=>{this.$iApi.fixture.exists(n)&&!a.items[p]&&(a.items[p].componentId=`${n}-appbar-button`)})})}}const Ae={en:{"appbar.navigation":"Navigation","appbar.more":"More","navigation.export":"Export","navigation.map.export":"Export Map"},fr:{"appbar.navigation":"Navigation","appbar.more":"Plus","navigation.export":"Exporter","navigation.map.export":"Exporter la Carte"}};class Me extends Ce{initialized(){}async added(){Object.entries(Ae).forEach(e=>this.$iApi.$i18n.mergeLocaleMessage(...e));const{destroy:a,el:p}=this.mount(ze,{app:this.$element}),n=this.$vApp.$el.getElementsByClassName("inner-shell")[0];n.insertBefore(p.childNodes[0],n.querySelector(".panel-stack")),this._parseConfig(this.config);const c=this.$vApp.$watch(()=>this.config,e=>this._parseConfig(e)),s=[];s.push(this.$iApi.event.on(fe.COMPONENT,()=>{this._parseConfig(this.config)})),this.removed=()=>{const e=W(this.$vApp.$pinia);c(),s.forEach(d=>this.$iApi.event.off(d));const y={...e.items},u=[...e.temporary];Object.keys(y).forEach(d=>e.removeButton(d)),u.forEach(d=>e.removeButton(d)),a(),e.$reset()}}}export{Me as default};
