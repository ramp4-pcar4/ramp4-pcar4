{"version":3,"file":"projectionUtils-C25mVWfq.js","sources":["../../node_modules/@arcgis/core/geometry/support/heightModelInfoUtils.js","../../node_modules/@arcgis/core/views/support/projectionUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport\"../../core/has.js\";import e from\"../../core/Error.js\";import t from\"../HeightModelInfo.js\";import{parse as n}from\"../../layers/support/arcgisLayerUrl.js\";function i(n,i){if(!n)return null;if(!o(n))return new e(\"webscene:unsupported-height-model-info\",\"The vertical coordinate system of the scene is not supported\",{heightModelInfo:n});const a=n.heightUnit,r=t.deriveUnitFromSR(n,i).heightUnit;return a!==r?new e(\"webscene:incompatible-height-unit\",`The vertical units of the scene (${a}) must match the horizontal units of the scene (${r})`,{verticalUnit:a,horizontalUnit:r}):null}function a(n,i,a){const o=c(n),l=i,h=r(o,l,a);if(o){const i=t.deriveUnitFromSR(o,n.spatialReference).heightUnit;if(!a&&i!==o.heightUnit){const t=new e(\"layerview:unmatched-height-unit\",`The vertical units of the layer must match the horizontal units (${i})`,{horizontalUnit:i});return new e(\"layerview:unsupported-height-model-info\",\"The vertical coordinate system of the layer is not supported\",{heightModelInfo:o,error:t})}}if(!s(n)||4===h)return new e(\"layerview:unsupported-height-model-info\",\"The vertical coordinate system of the layer is not supported\",{heightModelInfo:o});switch(h){case 1:{const t=o?.heightUnit||\"unknown\",n=l?.heightUnit||\"unknown\",i=new e(\"layerview:incompatible-height-unit\",`The vertical units of the layer (${t}) must match the vertical units of the scene (${n})`,{layerUnit:t,sceneUnit:n});return new e(\"layerview:incompatible-height-model-info\",\"The vertical coordinate system of the layer is incompatible with the scene\",{layerHeightModelInfo:o,sceneHeightModelInfo:l,error:i})}case 2:{const t=o?.heightModel||\"unknown\",n=l?.heightModel||\"unknown\",i=new e(\"layerview:incompatible-height-model\",`The height model of the layer (${t}) must match the height model of the scene (${n})`,{layerHeightModel:t,sceneHeightModel:n});return new e(\"layerview:incompatible-height-model-info\",\"The vertical coordinate system of the layer is incompatible with the scene\",{layerHeightModelInfo:o,sceneHeightModelInfo:l,error:i})}case 3:{const t=o?.vertCRS||\"unknown\",n=l?.vertCRS||\"unknown\",i=new e(\"layerview:incompatible-vertical-datum\",`The vertical datum of the layer (${t}) must match the vertical datum of the scene (${n})`,{layerDatum:t,sceneDatum:n});return new e(\"layerview:incompatible-height-model-info\",\"The vertical coordinate system of the layer is incompatible with the scene\",{layerHeightModelInfo:o,sceneHeightModelInfo:l,error:i})}}return null}function r(e,t,n){if(!o(e)||!o(t))return 4;if(null==e||null==t)return 0;if(!n&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case\"gravity-related-height\":return 0;case\"ellipsoidal\":return e.vertCRS===t.vertCRS?0:3;default:return 4}}function o(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function s(e){return\"heightModelInfo\"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!u(e)}function c(e){if(\"integrated-mesh-3dtiles\"===e.type||\"gaussian-splat\"===e.type)return null;const i=e.url?n(e.url):void 0,a=e.spatialReference?.vcsWkid;return!(null==a&&null!=i&&\"ImageServer\"===i.serverType)&&l(e)&&e.heightModelInfo?e.heightModelInfo:u(e)?t.deriveUnitFromSR(f,e.spatialReference):null}function l(e){return\"heightModelInfo\"in e}function h(e){if(\"unknown\"===e.type||!(\"capabilities\"in e))return!1;switch(e.type){case\"catalog\":case\"catalog-footprint\":case\"csv\":case\"feature\":case\"geojson\":case\"subtype-group\":case\"ogc-feature\":case\"oriented-imagery\":case\"wfs\":case\"knowledge-graph-sublayer\":return!0;default:return!1}}function u(e){return h(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):d(e)}function g(e){return null!=e.layers||d(e)||h(e)||l(e)}function d(e){switch(e.type){case\"building-scene\":case\"elevation\":case\"integrated-mesh\":case\"integrated-mesh-3dtiles\":case\"point-cloud\":case\"scene\":case\"voxel\":return!0;case\"base-dynamic\":case\"base-elevation\":case\"base-tile\":case\"bing-maps\":case\"catalog\":case\"catalog-footprint\":case\"catalog-dynamic-group\":case\"csv\":case\"dimension\":case\"gaussian-splat\":case\"geojson\":case\"feature\":case\"subtype-group\":case\"geo-rss\":case\"graphics\":case\"group\":case\"imagery\":case\"imagery-tile\":case\"kml\":case\"knowledge-graph\":case\"link-chart\":case\"knowledge-graph-sublayer\":case\"line-of-sight\":case\"map-image\":case\"map-notes\":case\"media\":case\"ogc-feature\":case\"open-street-map\":case\"oriented-imagery\":case\"parquet\":case\"route\":case\"stream\":case\"tile\":case\"unknown\":case\"unsupported\":case\"vector-tile\":case\"video\":case\"viewshed\":case\"wcs\":case\"web-tile\":case\"wfs\":case\"wms\":case\"wmts\":case null:return!1}return!1}const f=new t({heightModel:\"gravity-related-height\"});export{c as deriveHeightModelInfoFromLayer,r as isCompatible,a as rejectLayerError,g as supportsHeightModelInfo,i as validateWebSceneError};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{throwIfAborted as t}from\"../../core/promiseUtils.js\";import{isLoaded as e,canProjectWithoutEngine as r,project as n,load as o,projectWithZConversion as i}from\"../../geometry/projectionUtils.js\";let a,c=null;async function l(e){c||(c=import(\"../../portal/support/geometryServiceUtils.js\").then(t=>a=t)),await c,t(e)}async function s(t,i,c,p){if(!t)return null;const u=t.spatialReference;return e()||r(u,i)?n(t,i):a?a.projectGeometry(t,i,c,p):(await Promise.race([l(p),o(p)]),s(t,i,c,p))}async function p(t,e){try{return t?.spatialReference?await i(t,e):null}catch{return null}}export{s as projectWithEngineOrService,p as projectWithZConversionSilent};\n"],"names":["a","n","i","o","c","l","h","r","t","e","s","u","f","d","g","p"],"mappings":"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","x_google_ignoreList":[0,1]}