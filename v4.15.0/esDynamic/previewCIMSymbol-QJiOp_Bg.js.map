{"version":3,"file":"previewCIMSymbol-QJiOp_Bg.js","sources":["../../node_modules/@arcgis/core/symbols/support/previewCIMSymbol.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{pt2px as e,px2pt as t}from\"../../core/screenUtils.js\";import{CIMSymbolHelper as i}from\"../cim/CIMSymbolHelper.js\";import{CIMSymbolRasterizer as o}from\"../cim/CIMSymbolRasterizer.js\";import{OverrideHelper as l}from\"../cim/OverrideHelper.js\";import{mapCIMSymbolToGeometryType as r}from\"../cim/utils.js\";import{renderSymbol as n}from\"./renderUtils.js\";const a=new o(null),s=t(22),m=t(120),h=t(50),c=1;async function y(e,t,i){const o=t?.size;let l=null!=o&&\"object\"==typeof o&&\"width\"in o?o.width:o,r=null!=o&&\"object\"==typeof o&&\"height\"in o?o.height:o;if(!l||!r)if(\"esriGeometryPolygon\"===i)l=r=t.maxSize?Math.min(t.maxSize,s):s;else{const o=await g(e,t,i);o&&(l=o.width,r=o.height),\"esriGeometryPolyline\"===i&&(l=t.maxSize?Math.min(t.maxSize,h):h),l=null!=l&&isFinite(l)?Math.min(l,m):s,r=null!=r&&isFinite(r)?Math.max(Math.min(r,m),c):s}return\"legend\"===t.style&&\"esriGeometryPolyline\"===i&&(l=h),{width:l,height:r}}async function g(e,t={},o){const n=t.cimOptions||t;o??=n.geometryType||r(e?.data?.symbol);const{feature:s,fieldMap:m,viewParams:h}=n,c=await l.resolveSymbolOverrides(e.data,s,null,m,o,null,h);if(!c)return null;(e=e.clone()).data={type:\"CIMSymbolReference\",symbol:c},e.data.primitiveOverrides=void 0;const y=[];return i.fetchResources(c,a.resourceManager,y),i.fetchFonts(c,a.resourceManager,y),y.length>0&&await Promise.all(y),i.getEnvelope(c,null,a.resourceManager)}async function u(i,o={}){const{node:l,opacity:s,symbolConfig:m}=o,h=null!=m&&\"object\"==typeof m&&\"isSquareFill\"in m&&m.isSquareFill,c=o.cimOptions||o,g=c.geometryType||r(i?.data?.symbol),u=await y(i,o,g),{feature:d,fieldMap:f}=c,p=o?.geometry||h||\"esriGeometryPolygon\"!==g?\"preview\":\"legend\";let w=u;const b=u;if(o?.geometry&&(\"esriGeometryPolygon\"===g||\"esriGeometryPolyline\"===g)){const i=200;if(e(u.width)<i||e(u.height)<i){const e=u.width>u.height?t(i)*u.height/u.width:t(i);w={width:u.width>u.height?t(i):t(i)*u.width/u.height,height:e}}}const M=await a.rasterizeCIMSymbolAsync(i,d,w,p,f,g,null,c.viewParams,c.allowScalingUp,o?.geometry?.toJSON());if(!M)return null;const{width:S,height:v}=M,j=document.createElement(\"canvas\");j.width=S,j.height=v;j.getContext(\"2d\").putImageData(M,0,0);const P=e(b.width),x=e(b.height),z=new Image(P,x);z.src=j.toDataURL(),z.ariaLabel=o.ariaLabel??null,z.alt=o.ariaLabel??\"\",null!=s&&(z.style.opacity=`${s}`);let C=z;if(o.cssEffectFilter){const e={shape:{type:\"image\",x:0,y:0,width:P,height:x,src:z.src},fill:null,stroke:null,offset:[0,0]};C=n([[e]],[P,x],o)}return l&&C&&l.appendChild(C),C}export{g as getCIMSymbolPreviewSize,u as previewCIMSymbol};\n"],"names":["a","o","s","t","m","h","c","y","e","i","l","r","g","n","u","d","f","p","w","b","M","S","v","j","P","x","z","C"],"mappings":"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","x_google_ignoreList":[0]}