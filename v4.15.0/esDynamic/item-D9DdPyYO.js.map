{"version":3,"file":"item-D9DdPyYO.js","sources":["../../src/fixtures/legend/components/checkbox.vue","../../src/fixtures/legend/components/legend-options.vue","../../src/fixtures/legend/components/symbology-stack.vue","../../src/fixtures/legend/components/item.vue"],"sourcesContent":["<template>\n    <div class=\"relative\" @mouseover.stop>\n        <!-- TODO: see if getting this to use v-model works; children wouldnt update properly on initial try -->\n        <input\n            :type=\"isRadio ? 'radio' : 'checkbox'\"\n            :aria-label=\"t(checked ? `legend.visibility.hide${label}` : `legend.visibility.show${label}`)\"\n            @click.stop=\"toggleVisibility()\"\n            :checked=\"checked && initialChecked\"\n            @keypress.enter.prevent\n            @keyup.enter.stop=\"toggleVisibility()\"\n            :class=\"[\n                disabled\n                    ? 'text-gray-400 border-gray-300'\n                    : 'text-black cursor-pointer border-gray-500 hover:border-black'\n            ]\"\n            class=\"mx-5 h-15 w-15\"\n            tabindex=\"-1\"\n            :disabled=\"disabled\"\n            :content=\"t(checked ? `legend.visibility.hide${label}` : `legend.visibility.show${label}`)\"\n            v-tippy=\"{ placement: 'top-end', hideOnClick: false }\"\n        />\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport type { LegendSymbology } from '@/geo/api';\nimport { onMounted, ref } from 'vue';\nimport type { PropType } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport { LayerItem } from '../store/layer-item';\nimport { LegendItem } from '../store/legend-item';\n\nconst { t } = useI18n();\n\nconst props = defineProps({\n    value: {\n        type: Object as PropType<LegendItem | LegendSymbology>,\n        required: true\n    },\n    legendItem: {\n        type: Object as PropType<LegendItem | LayerItem>,\n        required: true\n    },\n    checked: { type: Boolean },\n    label: { type: String },\n    isRadio: { type: Boolean },\n    disabled: { type: Boolean }\n});\n\n/**\n * What this is wasn't documented when it was written.\n * Appears to be some kind of initialization mismatch check?\n * The checkbox will never appear as \"checked\" if this var is false.\n * When we mount, it gets set to false if the legend item this checkbox belongs to has a different visibility\n * value than the checkbox's \"checked\" value (via props).\n * If the checkbox gets toggled by the user, this flag gets set to true. I guess because things are now forced\n * to be in-synch.\n *\n * TODO It would also appear that if this mis-matched state happens,\n *      our aria-label and content attributes will be telling big lies?\n *\n * Given that every usage of this Checkbox template initilzes with a variant of:\n *    :checked=\"item.visibility\"\n * does this value even matter? I'm not seeing how it could ever be false when mounting happens.\n */\nconst initialChecked = ref(props.legendItem.visibility);\n\nonMounted(() => {\n    props.legendItem.checkVisibilityRules();\n    initialChecked.value = props.legendItem.visibility === props.checked;\n});\n\n/**\n * Toggle this visibility of the value object linked with this checkbox\n */\nconst toggleVisibility = (): void => {\n    if (props.value instanceof LegendItem) {\n        // Checkbox is sitting in a normal legend block. Toggle its visibility\n        props.legendItem.toggleVisibility();\n    } else if (props.legendItem instanceof LayerItem) {\n        // Checkbox is sitting in a symbol block, and is the child of a layer item\n        props.legendItem.clickSymbology(props.value.uid);\n\n        initialChecked.value = true;\n    }\n};\n</script>\n\n<style lang=\"scss\"></style>\n","<template>\n    <div @click.stop @mouseover.stop class=\"options display-block cursor-auto\">\n        <dropdown-menu\n            class=\"flex-shrink-0\"\n            position=\"bottom-end\"\n            :tooltip=\"t('legend.layer.options')\"\n            tooltipPlacement=\"left\"\n            tooltipPlacementAlt=\"left\"\n            ref=\"dropdown\"\n            :key=\"legendOptionKey\"\n        >\n            <template #header>\n                <div class=\"flex p-4 justify-center items-center\">\n                    <svg class=\"inline-block fill-current w-18 h-18 mx-4\" viewBox=\"0 0 23 21\">\n                        <path\n                            d=\"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z\"\n                        />\n                    </svg>\n                </div>\n            </template>\n            <!-- metadata -->\n            <a\n                href=\"javascript:;\"\n                class=\"flex leading-snug items-center text-left w-auto\"\n                :class=\"{\n                    disabled: !legendItem!.layerControlAvailable(LayerControl.Metadata) || !getFixtureExists('metadata')\n                }\"\n                @click=\"toggleMetadata\"\n                role=\"button\"\n                :aria-label=\"t('legend.layer.controls.metadata')\"\n            >\n                <svg class=\"setting-svg\" viewBox=\"0 0 23 21\">\n                    <path\n                        d=\"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z\"\n                    />\n                </svg>\n                {{ t('legend.layer.controls.metadata') }}\n            </a>\n            <!-- settings -->\n            <a\n                href=\"javascript:;\"\n                class=\"flex leading-snug items-center text-left w-auto\"\n                :class=\"{\n                    disabled: !legendItem!.layerControlAvailable(LayerControl.Settings) || !getFixtureExists('settings')\n                }\"\n                @click=\"toggleSettings\"\n                role=\"button\"\n                :aria-label=\"t('legend.layer.controls.settings')\"\n            >\n                <svg class=\"setting-svg\" viewBox=\"0 0 23 21\">\n                    <g>\n                        <path\n                            d=\"M 3,17L 3,19L 9,19L 9,17L 3,17 Z M 3,5L 3,7L 13,7L 13,5L 3,5 Z M 13,21L 13,19L 21,19L 21,17L 13,17L 13,15L 11,15L 11,21L 13,21 Z M 7,9L 7,11L 3,11L 3,13L 7,13L 7,15L 9,15L 9,9L 7,9 Z M 21,13L 21,11L 11,11L 11,13L 21,13 Z M 15,9L 17,9L 17,7L 21,7L 21,5L 17,5L 17,3L 15,3L 15,9 Z \"\n                        />\n                    </g>\n                </svg>\n                {{ t('legend.layer.controls.settings') }}\n            </a>\n            <!-- datatable -->\n            <a\n                href=\"javascript:;\"\n                class=\"flex leading-snug items-center text-left w-auto\"\n                :class=\"{\n                    disabled: !legendItem!.layerControlAvailable(LayerControl.Datatable) || !getFixtureExists('grid')\n                }\"\n                @click=\"toggleGrid\"\n                role=\"button\"\n                :aria-label=\"t('legend.layer.controls.datatable')\"\n            >\n                <svg class=\"setting-svg\" viewBox=\"0 0 23 21\">\n                    <path\n                        d=\"M 4.00002,3L 20,3C 21.1046,3 22,3.89543 22,5L 22,20C 22,21.1046 21.1046,22 20,22L 4.00001,22C 2.89544,22 2.00001,21.1046 2.00001,20L 2.00002,5C 2.00002,3.89543 2.89545,3 4.00002,3 Z M 4.00002,7L 4.00001,10L 8,10L 8,7.00001L 4.00002,7 Z M 10,7.00001L 9.99999,10L 14,10L 14,7.00001L 10,7.00001 Z M 20,10L 20,7L 16,7.00001L 16,10L 20,10 Z M 4.00002,12L 4.00002,15L 8,15L 8,12L 4.00002,12 Z M 4.00001,20L 8,20L 8,17L 4.00002,17L 4.00001,20 Z M 9.99999,12L 9.99999,15L 14,15L 14,12L 9.99999,12 Z M 9.99999,20L 14,20L 14,17L 9.99999,17L 9.99999,20 Z M 20,20L 20,17L 16,17L 16,20L 20,20 Z M 20,12L 16,12L 16,15L 20,15L 20,12 Z \"\n                    />\n                </svg>\n                {{ t('legend.layer.controls.datatable') }}\n            </a>\n            <!-- symbology stack -->\n            <a\n                href=\"javascript:;\"\n                class=\"flex leading-snug items-center text-left w-auto\"\n                :class=\"{\n                    disabled: !legendItem!.layerControlAvailable(LayerControl.Symbology)\n                }\"\n                @click=\"toggleSymbology\"\n                role=\"button\"\n                :aria-label=\"t('legend.layer.controls.symbology')\"\n            >\n                <svg class=\"setting-svg\" viewBox=\"0 0 23 21\">\n                    <path\n                        d=\"M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z\"\n                    />\n                </svg>\n                {{ t('legend.layer.controls.symbology') }}\n            </a>\n            <!-- boundary zoom -->\n            <a\n                href=\"javascript:;\"\n                class=\"flex leading-snug items-center text-left w-auto\"\n                :class=\"{\n                    disabled: !legendItem!.layerControlAvailable(LayerControl.BoundaryZoom)\n                }\"\n                @click=\"zoomToLayerBoundary\"\n                role=\"button\"\n                :aria-label=\"t('legend.layer.controls.boundaryzoom')\"\n            >\n                <svg class=\"setting-svg\" viewBox=\"0 0 24 24\">\n                    <path\n                        d=\"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"\n                    />\n                    <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n                    <path d=\"M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z\" />\n                </svg>\n                {{ t('legend.layer.controls.boundaryzoom') }}\n            </a>\n            <!-- remove -->\n            <a\n                href=\"javascript:;\"\n                class=\"flex leading-snug items-center text-left w-auto\"\n                :class=\"{\n                    disabled: !legendItem!.layerControlAvailable(LayerControl.Remove)\n                }\"\n                @click=\"removeLayer\"\n                role=\"button\"\n                :aria-label=\"t('legend.layer.controls.remove')\"\n            >\n                <svg class=\"setting-svg\" viewBox=\"0 0 23 21\">\n                    <path d=\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"></path>\n                </svg>\n                {{ t('legend.layer.controls.remove') }}\n            </a>\n            <!-- reload -->\n            <a\n                href=\"javascript:;\"\n                class=\"flex leading-snug items-center text-left w-auto\"\n                :key=\"+reloadableLayer\"\n                :class=\"{ disabled: !reloadableLayer }\"\n                :content=\"reloadableLayer ? null : t('legend.layer.controls.reloadDisabled')\"\n                @mouseover.stop=\"hover($event.currentTarget!)\"\n                @mouseout=\"\n                    //@ts-expect-error TODO: explain why this is needed or remove\n                    mobileMode ? null : $event.currentTarget?._tippy?.hide(), (hovered = false)\n                \"\n                v-tippy=\"{\n                    placement: 'top-start',\n                    trigger: 'manual focus',\n                    aria: 'describedby'\n                }\"\n                @click=\"e => reloadLayer(e as PointerEvent)\"\n                role=\"button\"\n                :aria-label=\"t('legend.layer.controls.reload')\"\n            >\n                <svg class=\"setting-svg\" viewBox=\"0 0 24 24\">\n                    <path\n                        d=\"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z\"\n                    ></path>\n                </svg>\n                {{ t('legend.layer.controls.reload') }}\n            </a>\n        </dropdown-menu>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { GlobalEvents, InstanceAPI } from '@/api';\nimport { LayerControl } from '@/geo/api';\nimport { computed, inject, ref, toRaw } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport { LayerItem } from '../store/layer-item';\nimport { usePanelStore } from '@/stores/panel';\n\nconst { t } = useI18n();\nconst iApi = inject('iApi') as InstanceAPI;\nconst dropdown = ref();\nconst hovered = ref(false);\nconst panelStore = usePanelStore();\nconst mobileMode = ref(panelStore.mobileView);\nconst emit = defineEmits(['focusItem']);\nconst legendOptionKey = ref(0);\n\nconst props = defineProps({\n    legendItem: LayerItem\n});\n\n/**\n * Display symbology stack for the layer.\n */\nconst toggleSymbology = (): void => {\n    if (props.legendItem!.layerControlAvailable(LayerControl.Symbology)) {\n        props.legendItem!.toggleSymbology();\n    }\n};\n\n/**\n * Toggles data table panel to open/close for the LegendItem.\n */\nconst toggleGrid = () => {\n    if (props.legendItem!.layerControlAvailable(LayerControl.Datatable) && getFixtureExists('grid')) {\n        iApi.event.emit(GlobalEvents.GRID_TOGGLE, props.legendItem!.layer);\n    }\n};\n\n/**\n * Toggles settings panel to open/close type for the LegendItem.\n */\nconst toggleSettings = () => {\n    if (props.legendItem!.layerControlAvailable(LayerControl.Settings) && getFixtureExists('settings')) {\n        iApi.event.emit(GlobalEvents.SETTINGS_TOGGLE, props.legendItem!.layer);\n    }\n};\n\n/**\n * Toggles metadata panel to open/close for the LegendItem.\n */\nconst toggleMetadata = () => {\n    if (props.legendItem!.layerControlAvailable(LayerControl.Metadata) && getFixtureExists('metadata')) {\n        const metaConfig =\n            props.legendItem?.layer?.config.metadata || props.legendItem?.layer?.parentLayer?.config?.metadata || {};\n        const name = metaConfig?.name || props.legendItem?.layer?.name || '';\n        const catalogueUrl =\n            props.legendItem?.layer?.config?.catalogueUrl ||\n            (props.legendItem?.layer?.layerType === 'sublayer' &&\n                props.legendItem?.layer?.parentLayer?.config?.catalogueUrl) ||\n            undefined;\n\n        if (metaConfig.url) {\n            // Check the file extension to see if this is an XML file. Defaults to HTML.\n            const parseUrl = metaConfig.url.split('.');\n            const metadataExtension = parseUrl[parseUrl.length - 1];\n            const metadataType = metadataExtension === 'xml' || metadataExtension === 'md' ? metadataExtension : 'html';\n\n            // TODO: toggle metadata panel through API/store call\n            iApi.event.emit(GlobalEvents.METADATA_TOGGLE, {\n                type: metadataType,\n                layerName: name,\n                url: metaConfig.url,\n                catalogueUrl: catalogueUrl,\n                layer: props.legendItem!.layer,\n                xmlType: metaConfig.xmlType,\n                treatXmlAsMarkdown: metaConfig.treatXmlAsMarkdown\n            });\n        } else {\n            console.warn('Layer does not have a metadata url defined');\n        }\n    }\n};\n\n/**\n * Zoom to the boundary of layer\n */\nconst zoomToLayerBoundary = () => {\n    if (props.legendItem!.layerControlAvailable(LayerControl.BoundaryZoom)) {\n        props.legendItem?.layer?.zoomToLayerBoundary();\n    }\n};\n\n/**\n * Removes layer from map.\n */\nconst removeLayer = () => {\n    if (props.legendItem!.layerControlAvailable(LayerControl.Remove)) {\n        iApi.geo.map.removeLayer(props.legendItem!.layerUid!);\n    }\n};\n\n/**\n * Reloads a layer on the map.\n *\n * @param {PointerEvent} e the PointerEvent corresponding to the reload button being clicked/pressed\n */\nconst reloadLayer = (e: PointerEvent) => {\n    if (reloadableLayer.value) {\n        toRaw(props.legendItem!.layer!)\n            .reload()\n            .then(() => {\n                legendOptionKey.value += 1;\n                if (e.pointerType !== 'mouse') {\n                    emit('focusItem');\n                }\n            });\n    }\n};\n\n/**\n * Determine if the layer can be reloaded\n */\nconst reloadableLayer = computed((): boolean => {\n    return (\n        props.legendItem!.layerControlAvailable(LayerControl.Reload) &&\n        props.legendItem instanceof LayerItem &&\n        toRaw(props.legendItem!.layer)?.canReload\n    );\n});\n\nconst hover = (t: EventTarget) => {\n    hovered.value = true;\n    setTimeout(() => {\n        if (hovered.value) {\n            if (!mobileMode.value) {\n                //@ts-expect-error TODO: explain why this is needed or remove\n                t._tippy?.show();\n            }\n        }\n    }, 300);\n};\n\n/**\n * Indicates if the fixture with the given name has been added\n */\nconst getFixtureExists = (fixtureName: string): boolean => {\n    try {\n        return iApi.fixture.exists(fixtureName);\n    } catch {\n        return false;\n    }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.disabled {\n    @apply text-neutral-500 cursor-default;\n}\n.setting-svg {\n    margin-bottom: 5px;\n    display: inline-block;\n    fill: currentColor;\n    width: 18px;\n    height: 18px;\n    margin-right: 10px;\n}\n</style>\n","<template>\n    <div v-if=\"!visible\">\n        <!-- Multiple icons to display -->\n        <div v-if=\"stack.length > 1\" class=\"relative left-3\">\n            <!-- the :class line calculates margin-left for each of the 3 symbols, and gives a margin-top to symbols that arent the first -->\n            <div\n                class=\"absolute\"\n                :class=\"[idx == 0 ? 'symbol-0' : idx == 1 ? 'left-3 symbol-1' : 'left-6 symbol-2']\"\n                :style=\"{ 'z-index': 3 - idx }\"\n                v-for=\"(item, idx) in stack.slice(0, 3).reverse()\"\n                :key=\"idx\"\n            >\n                <span v-if=\"stack[idx].svgcode\" class=\"symbologyIcon w-28 h-28\" v-html=\"stack[idx].svgcode\"></span>\n                <img v-else-if=\"stack[idx].imgUrl\" class=\"symbologyIcon w-28 h-28\" :src=\"stack[idx].imgUrl\" />\n            </div>\n        </div>\n\n        <!-- Only one icon to display. -->\n        <div v-else-if=\"stack.length > 0\" class=\"symbologyIcon w-32 h-32\">\n            <span v-if=\"stack[0].svgcode\" v-html=\"stack[0].svgcode\"></span>\n            <img v-else-if=\"stack[0].imgUrl\" class=\"symbologyIcon w-full h-full\" :src=\"stack[0].imgUrl\" />\n        </div>\n    </div>\n\n    <!-- If the symbology stack is already open, display an X in the place of the stack. -->\n    <div v-else class=\"h-32 w-32 inline-flex justify-center items-center\">\n        <svg class=\"fill-current w-16 h-16\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 352 512\">\n            <path\n                d=\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\"\n            />\n        </svg>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\n// this generates the icon / icon stack that sits in the layer item. I.e. the thing you can click to expand the symbology under the layer item.\n// it does not generate the symbology entries that appear when expanded.\n\nimport type { LegendSymbology } from '@/geo/api';\nimport { toRaw, onMounted, type PropType, ref } from 'vue';\nimport type { LayerItem } from '../store/layer-item';\n\nconst props = defineProps({\n    visible: { type: Boolean, required: true },\n    legendItem: { type: Object as PropType<LayerItem>, required: true }\n});\n\nconst stack = ref<Array<LegendSymbology>>([]); // ref instead of reactive to maintain reactivity after promise\n\nonMounted(() => {\n    // wait for the layer item to load\n    props.legendItem.loadPromise.then(() => {\n        if (props.legendItem.layerUid !== undefined) {\n            // retrieve the symbology stack\n            // waits on all symbols in the stack to finish loading before displaying.\n            Promise.all(toRaw(props.legendItem.symbologyStack).map((l: any) => l.drawPromise)).then(() => {\n                stack.value = toRaw(props.legendItem).symbologyStack;\n            });\n        }\n    });\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.symbol-0 {\n    :hover > & {\n        transform: rotate(-10deg);\n        transform-origin: bottom center;\n    }\n}\n.symbol-2 {\n    :hover > & {\n        transform: rotate(10deg);\n        transform-origin: bottom center;\n    }\n}\n.ramp-styles.animation-enabled .symbol-0 {\n    transition-duration: 0.2s;\n}\n.ramp-styles.animation-enabled .symbol-2 {\n    transition-duration: 0.2s;\n}\n</style>\n","<template>\n    <div :key=\"`${legendItem.uid}`\" v-if=\"!legendItem.hidden\" ref=\"el\">\n        <div class=\"relative\">\n            <div\n                class=\"flex items-center hover:bg-gray-200 default-focus-style !p-5\"\n                :class=\"[\n                    legendItem.type === LegendType.Item\n                        ? 'loaded-item'\n                        : legendItem.type === LegendType.Error\n                          ? 'non-loaded-item bg-red-200'\n                          : 'non-loaded-item',\n                    (isGroup && controlAvailable(LegendControl.Expand)) ||\n                    (!isGroup &&\n                        legendItem instanceof LayerItem &&\n                        controlAvailable(LayerControl.Datatable) &&\n                        getDatagridExists() &&\n                        legendItem.type === LegendType.Item)\n                        ? 'cursor-pointer'\n                        : 'cursor-default',\n                    allowMultilineItems ? 'multilined' : 'singlelined'\n                ]\"\n                @mouseover.stop=\"hover($event.currentTarget!)\"\n                @mouseout=\"\n                    //@ts-expect-error TODO: explain why this is needed or remove\n                    mobileMode ? null : $event.currentTarget?._tippy?.hide(), (hovered = false)\n                \"\n                @click=\"\n                    () => {\n                        if (\n                            !isGroup &&\n                            legendItem instanceof LayerItem &&\n                            controlAvailable(LayerControl.Datatable) &&\n                            getDatagridExists() &&\n                            legendItem.type === LegendType.Item\n                        ) {\n                            toggleGrid();\n                        } else if (isGroup) {\n                            toggleExpand();\n                        }\n                    }\n                \"\n                v-focus-item=\"'show-truncate'\"\n                :content=\"\n                    isGroup && controlAvailable(LegendControl.Expand)\n                        ? t(legendItem.expanded ? 'legend.group.collapse' : 'legend.group.expand')\n                        : legendItem instanceof LayerItem &&\n                            legendItem.type === LegendType.Item &&\n                            controlAvailable(LayerControl.Datatable) &&\n                            getDatagridExists()\n                          ? t('legend.layer.data')\n                          : ''\n                \"\n                v-tippy=\"{\n                    placement: 'top-start',\n                    trigger: 'manual focus',\n                    aria: 'describedby'\n                }\"\n                truncate-trigger\n                ref=\"legendFocusItem\"\n            >\n                <!-- smiley face. very important that we migrate this -->\n                <div class=\"flex p-5 mr-[13px]\" v-if=\"legendItem.type !== LegendType.Item\">\n                    <svg\n                        v-if=\"legendItem.type === LegendType.Placeholder\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        viewBox=\"0 0 24 24\"\n                        fill=\"black\"\n                        width=\"24px\"\n                        height=\"24px\"\n                    >\n                        <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n                        <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n                        <circle cx=\"15.5\" cy=\"9.5\" r=\"1.5\" />\n                        <circle cx=\"8.5\" cy=\"9.5\" r=\"1.5\" />\n                        <circle cx=\"15.5\" cy=\"9.5\" r=\"1.5\" />\n                        <circle cx=\"8.5\" cy=\"9.5\" r=\"1.5\" />\n                        <path\n                            d=\"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-2.5c2.33 0 4.32-1.45 5.12-3.5h-1.67c-.69 1.19-1.97 2-3.45 2s-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5z\"\n                        />\n                    </svg>\n                    <!-- sad face for layer error -->\n                    <svg\n                        v-else\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        viewBox=\"0 0 24 24\"\n                        fill=\"black\"\n                        width=\"24px\"\n                        height=\"24px\"\n                    >\n                        <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n                        <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n                        <circle cx=\"15.5\" cy=\"9.5\" r=\"1.5\" />\n                        <circle cx=\"8.5\" cy=\"9.5\" r=\"1.5\" />\n                        <circle cx=\"15.5\" cy=\"9.5\" r=\"1.5\" />\n                        <circle cx=\"8.5\" cy=\"9.5\" r=\"1.5\" />\n                        <path\n                            d=\"M 20,12C 20,7.6 16.4,4 12,4C 7.6,4 4,7.6 4,12C 4,16.4 7.6,20 12,20C 16.4,20 20,16.4 20,12 Z M 22,12C 22,17.5 17.5,22 12,22C 6.5,22 2,17.5 2,12C 2,6.5 6.5,2.00001 12,2.00001C 17.5,2.00001 22,6.5 22,12 Z M 15.5,8C 16.3,8 17,8.7 17,9.5C 17,10.3 16.3,11 15.5,11C 14.7,11 14,10.3 14,9.5C 14,8.7 14.7,8 15.5,8 Z M 10,9.5C 10,10.3 9.3,11 8.5,11C 7.7,11 7,10.3 7,9.5C 7,8.7 7.7,8 8.5,8C 9.3,8 10,8.7 10,9.5 Z M 12,14C 13.7524,14 15.2943,14.7212 16.1871,15.8129L 14.7697,17.2302C 14.3175,16.5078 13.2477,16 12,16C 10.7523,16 9.68254,16.5078 9.23024,17.2302L 7.81291,15.8129C 8.7057,14.7212 10.2476,14 12,14 Z\"\n                        ></path>\n                    </svg>\n                </div>\n\n                <!-- symbology stack toggle-->\n                <div\n                    class=\"relative w-32 h-32 mr-15\"\n                    v-if=\"\n                        legendItem.type === LegendType.Item &&\n                        legendItem instanceof LayerItem &&\n                        legendItem.layer.legend.length > 0\n                    \"\n                    @mouseover.stop\n                >\n                    <button\n                        type=\"button\"\n                        @click.stop=\"toggleSymbology\"\n                        :class=\"[controlAvailable(LayerControl.Symbology) ? 'cursor-pointer' : 'cursor-default']\"\n                        :disabled=\"!controlAvailable(LayerControl.Symbology)\"\n                        :content=\"\n                            legendItem instanceof LayerItem && legendItem.symbologyExpanded\n                                ? t('legend.symbology.hide')\n                                : t('legend.symbology.expand')\n                        \"\n                        :aria-label=\"\n                            legendItem instanceof LayerItem && legendItem.symbologyExpanded\n                                ? t('legend.symbology.hide')\n                                : t('legend.symbology.expand')\n                        \"\n                        v-tippy=\"{\n                            placement: 'top-start'\n                        }\"\n                    >\n                        <symbology-stack\n                            v-if=\"!legendItem.coverIcon\"\n                            :class=\"{\n                                'pointer-events-none': !controlAvailable(LayerControl.Symbology)\n                            }\"\n                            class=\"w-32 h-32\"\n                            :visible=\"legendItem instanceof LayerItem && legendItem.symbologyExpanded\"\n                            :legendItem=\"legendItem\"\n                        />\n                        <img\n                            v-else\n                            :class=\"{\n                                'pointer-events-none': !controlAvailable(LayerControl.Symbology)\n                            }\"\n                            class=\"w-32 h-32 hover:scale-105\"\n                            :src=\"legendItem.coverIcon\"\n                            alt=\"Cover icon not found :(\"\n                        />\n                    </button>\n                </div>\n\n                <!-- dropdown icon -->\n                <div\n                    v-if=\"isGroup && controlAvailable(LegendControl.Expand)\"\n                    class=\"expand-toggle p-8 pointer-events-none\"\n                    :class=\"{ 'rotate-180': legendItem.expanded }\"\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\">\n                        <path d=\"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z\" />\n                    </svg>\n                </div>\n\n                <!-- name or info section-->\n                <div\n                    v-if=\"legendItem instanceof LayerItem && allowMultilineItems\"\n                    class=\"flex-1 pointer-events-none m-5\"\n                    :class=\"`line-clamp-${maxLines}`\"\n                    v-truncate=\"{\n                        externalTrigger: true,\n                        noTruncateClass: true\n                    }\"\n                >\n                    <span class=\"h-auto break-words text-ellipsis\">{{\n                        legendItem.name ?? (!legendItem?.layer?.name ? legendItem.layerId : legendItem.layer?.name)\n                    }}</span>\n                </div>\n                <!-- Version if multiline legend items is turned off -->\n                <div\n                    v-else-if=\"legendItem instanceof LayerItem\"\n                    class=\"flex-1 pointer-events-none p-5\"\n                    v-truncate=\"{ externalTrigger: true }\"\n                >\n                    <span>{{\n                        legendItem.name ??\n                        (!legendItem.layer || legendItem?.layer?.name === ''\n                            ? legendItem.layerId\n                            : legendItem.layer?.name)\n                    }}</span>\n                </div>\n                <div v-else-if=\"legendItem instanceof SectionItem\" class=\"flex-1\">\n                    <h3 class=\"text-lg font-bold\" v-if=\"legendItem.infoType === InfoType.Title && legendItem.content\">\n                        {{ legendItem.content }}\n                    </h3>\n                    <h3 v-else-if=\"legendItem.infoType === InfoType.Title\">\n                        {{ legendItem.name }}\n                    </h3>\n                    <p v-else-if=\"legendItem.infoType === InfoType.Text\">\n                        {{ legendItem.content }}\n                    </p>\n                    <img\n                        v-else-if=\"legendItem.infoType === InfoType.Image\"\n                        :src=\"legendItem.content\"\n                        alt=\"InfoType image not found :(\"\n                    />\n                    <div\n                        v-else-if=\"legendItem.infoType === InfoType.Markdown\"\n                        class=\"ramp-markdown\"\n                        v-html=\"markdownToHtml(legendItem.content)\"\n                    ></div>\n                    <component v-else :is=\"`${legendItem.uid}-info-section`\"></component>\n                </div>\n\n                <!-- reload for error'd items -->\n                <div class=\"relative\" v-if=\"legendItem.type === LegendType.Error && reloadableLayer\">\n                    <button\n                        type=\"button\"\n                        class=\"text-gray-500 hover:text-black\"\n                        :content=\"t('legend.layer.controls.reload')\"\n                        v-tippy=\"{\n                            placement: 'top-start'\n                        }\"\n                        @mouseover.stop\n                        @click.stop=\"reloadLayer\"\n                        :aria-label=\"t('legend.layer.controls.reload')\"\n                    >\n                        <div class=\"flex p-8\">\n                            <svg class=\"inline-block fill-current w-18 h-18\" viewBox=\"0 0 24 24\">\n                                <path\n                                    d=\"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z\"\n                                ></path>\n                            </svg>\n                        </div>\n                    </button>\n                </div>\n\n                <!-- options dropdown menu -->\n                <legend-options\n                    v-if=\"\n                        (legendItem.type === LegendType.Item ||\n                            (legendItem.type === LegendType.Placeholder && allowMultilineItems)) &&\n                        legendItem instanceof LayerItem\n                    \"\n                    :class=\"{\n                        invisible: legendItem.type === LegendType.Placeholder\n                    }\"\n                    :legendItem=\"legendItem\"\n                    @focus-item=\"() => $emit('focusItem', legendFocusItem as HTMLElement)\"\n                />\n\n                <!-- Button only appears for loading or errored LayerItems -->\n                <!-- Morphs depending on state. Cancel for loading, Remove for Errored -->\n                <div v-if=\"legendItem.type !== LegendType.Item && legendItem instanceof LayerItem\" class=\"relative\">\n                    <button\n                        type=\"button\"\n                        class=\"text-gray-500 hover:text-black\"\n                        :content=\"\n                            legendItem.type === LegendType.Error\n                                ? t('legend.layer.controls.remove')\n                                : t('legend.layer.controls.cancel')\n                        \"\n                        v-tippy=\"{\n                            placement: 'top-start'\n                        }\"\n                        @mouseover.stop\n                        @click.stop=\"cancelOrRemoveLayer\"\n                        :aria-label=\"\n                            legendItem.type === LegendType.Error\n                                ? t('legend.layer.controls.remove')\n                                : t('legend.layer.controls.cancel')\n                        \"\n                    >\n                        <div class=\"flex p-5\">\n                            <svg\n                                v-if=\"legendItem.type === LegendType.Placeholder\"\n                                class=\"fill-current w-18 h-18\"\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                viewBox=\"0 0 352 512\"\n                            >\n                                <path\n                                    d=\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\"\n                                />\n                            </svg>\n                            <svg v-else class=\"inline-block fill-current w-18 h-18 mr-1\" viewBox=\"0 1 23 22\">\n                                <path\n                                    d=\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"\n                                ></path>\n                            </svg>\n                        </div>\n                    </button>\n                </div>\n\n                <!-- offscale icon -->\n                <div\n                    class=\"relative p-4 cursor-default\"\n                    :content=\"t('legend.layer.offscale')\"\n                    v-tippy=\"{\n                        placement: 'top-start'\n                    }\"\n                    @mouseover.stop\n                    @click.stop\n                    v-if=\"\n                        legendItem.type === LegendType.Item &&\n                        legendItem instanceof LayerItem &&\n                        legendItem.layerOffscale\n                    \"\n                    focus-icon\n                >\n                    <svg class=\"inline-block fill-gray-400 w-18 h-18\" viewBox=\"0 0 24 24\">\n                        <path\n                            d=\"M19.81 14.99l1.19-.92-1.43-1.43-1.19.92 1.43 1.43zm-.45-4.72L21 9l-9-7-2.91 2.27 7.87 7.88 2.4-1.88zM3.27 1L2 2.27l4.22 4.22L3 9l1.63 1.27L12 16l2.1-1.63 1.43 1.43L12 18.54l-7.37-5.73L3 14.07l9 7 4.95-3.85L20.73 21 22 19.73 3.27 1z\"\n                        ></path>\n                    </svg>\n                </div>\n\n                <!-- data only icon -->\n                <div\n                    class=\"relative p-4 cursor-default\"\n                    :content=\"t('legend.layer.data.only')\"\n                    v-tippy=\"{\n                        placement: 'top-end'\n                    }\"\n                    @mouseover.stop\n                    @click.stop\n                    v-if=\"\n                        legendItem.type === LegendType.Item &&\n                        legendItem instanceof LayerItem &&\n                        !legendItem.layer?.mapLayer\n                    \"\n                    focus-icon\n                >\n                    <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        height=\"18\"\n                        viewBox=\"0 -960 960 960\"\n                        width=\"18\"\n                        class=\"inline-block fill-gray-400\"\n                    >\n                        <path\n                            d=\"m776.109-63.565-73.435-69.196q-51.302 32.573-106.091 59.145-54.788 26.572-116.255 26.572-88.94 0-167.803-33.893-78.862-33.894-138.052-93.239-59.19-59.346-93.19-138.205-34-78.86-34-167.619 0-64.607 19.12-125.521Q85.521-666.435 120-719.674l-50.848-50.848 68.761-68.761L844.87-132.326l-68.761 68.76Zm-345.392-92.653v-72.5l-52.25-52.086v-50.009l-219.01-218.752q-3 17.015-5 34.031-2 17.015-2 35.136 0 124.449 78.826 214.674 78.826 90.224 199.434 109.506Zm410.392-85.412-76.739-77.74q21.288-37.275 32.35-77.847 11.062-40.572 11.062-84.059 0-95.003-56.304-169.853-56.304-74.849-145.391-108.893v.522l-174.413 76.087v31.348L241.87-842.109q52.483-34.989 113.387-52.918 60.903-17.93 125.159-17.93 89.709 0 168.127 33.869 78.418 33.868 137.435 93.28 59.016 59.413 92.997 137.683 33.982 78.269 33.982 167.993 0 64.203-18.43 125.111-18.429 60.907-53.418 113.391Z\"\n                        />\n                    </svg>\n                </div>\n\n                <!-- zoom button for offscale layers -->\n                <div\n                    class=\"relative top-1\"\n                    v-if=\"\n                        legendItem.type === LegendType.Item &&\n                        legendItem instanceof LayerItem &&\n                        legendItem.layerOffscale\n                    \"\n                >\n                    <button\n                        type=\"button\"\n                        class=\"p-4\"\n                        :content=\"t('legend.layer.zoomToVisible')\"\n                        v-tippy=\"{\n                            placement: 'top-start'\n                        }\"\n                        @mouseover.stop\n                        @click.stop=\"(legendItem as LayerItem).layer.zoomToVisibleScale()\"\n                    >\n                        <svg\n                            class=\"m-auto\"\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            height=\"18\"\n                            viewBox=\"0 0 24 24\"\n                            width=\"18\"\n                        >\n                            <path\n                                d=\"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"\n                            ></path>\n                            <path d=\"M0 0h24v24H0V0z\" fill=\"none\"></path>\n                            <path d=\"M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z\"></path>\n                        </svg>\n                    </button>\n                </div>\n\n                <!-- visibility -->\n                <checkbox\n                    v-else-if=\"legendItem.type === LegendType.Item && controlAvailable(LegendControl.Visibility)\"\n                    :checked=\"legendItem.visibility\"\n                    :value=\"legendItem as LegendItem\"\n                    :isRadio=\"legendItem.parent && legendItem.parent.exclusive\"\n                    :legendItem=\"legendItem\"\n                    :disabled=\"\n                        legendItem instanceof LayerItem && !legendItem.layerControlAvailable(LayerControl.Visibility)\n                    \"\n                    :label=\"isGroup ? 'Group' : 'Layer'\"\n                />\n            </div>\n            <div\n                v-if=\"\n                    legendItem.type === LegendType.Placeholder ||\n                    (legendItem instanceof LayerItem && legendItem.layerRedrawing && legendItem.visibility)\n                \"\n                class=\"h-3 w-full absolute bottom-0\"\n            >\n                <div class=\"progress-line\"></div>\n            </div>\n        </div>\n        <!-- Symbology Stack Section -->\n        <div\n            v-if=\"legendItem instanceof LayerItem && legendItem.symbologyExpanded\"\n            v-focus-item\n            class=\"symbology-stack default-focus-style\"\n        >\n            <div v-if=\"symbologyStack.length > 0\">\n                <p v-if=\"legendItem instanceof LayerItem && legendItem.description\" class=\"m-5\">\n                    {{ legendItem.description }}\n                </p>\n                <!-- display each symbol -->\n                <div class=\"m-5\" v-for=\"item in symbologyStack\" :key=\"item.uid\">\n                    <!-- for WMS layers and image render styles -->\n                    <div\n                        v-if=\"\n                            (item.imgUrl && legendItem.symbologyRenderStyle === 'images') ||\n                            (!item.imgUrl && layerType === 'ogc-wms')\n                        \"\n                        class=\"items-center grid-cols-1\"\n                    >\n                        <div v-if=\"item.imgUrl\" class=\"symbologyIcon w-full p-5\">\n                            <img class=\"max-w-full\" :src=\"item.imgUrl\" />\n                        </div>\n                        <div\n                            v-else-if=\"item.imgHeight\"\n                            class=\"symbologyIcon w-full p-5\"\n                            v-html=\"getLegendGraphic(item)\"\n                        ></div>\n                        <div v-if=\"item.label\" class=\"flex-1 p-5 bg-black-75 text-white\" v-truncate>\n                            <span>{{ item.label }}</span>\n                            <checkbox\n                                v-if=\"\n                                    (!item.imgUrl && symbologyStack.length > 1) ||\n                                    (item.imgUrl && item.definitionClause)\n                                \"\n                                class=\"float-right\"\n                                :value=\"item\"\n                                :legendItem=\"legendItem\"\n                                :checked=\"item.visibility\"\n                                :disabled=\"!controlAvailable(LayerControl.Visibility)\"\n                                label=\"Symbol\"\n                            />\n                        </div>\n                    </div>\n                    <!-- for non-WMS layers -->\n                    <div v-else class=\"flex items-center\">\n                        <div v-if=\"item.imgUrl\" class=\"symbologyIcon\">\n                            <img class=\"w-32 h-32\" :src=\"item.imgUrl\" />\n                        </div>\n                        <div v-else-if=\"item.svgcode\" class=\"symbologyIcon\">\n                            <span v-html=\"item.svgcode\"></span>\n                        </div>\n                        <div class=\"flex-1 ml-15\" v-truncate>\n                            {{ item.label }}\n                        </div>\n                        <checkbox\n                            v-if=\"\n                                modifiableLayer &&\n                                legendItem.layer.supportsFeatures &&\n                                ((!item.imgUrl && symbologyStack.length > 1) || (item.imgUrl && item.definitionClause))\n                            \"\n                            :value=\"item\"\n                            :legendItem=\"legendItem\"\n                            :checked=\"item.visibility\"\n                            :disabled=\"!controlAvailable(LayerControl.Visibility)\"\n                            label=\"Symbol\"\n                        />\n                    </div>\n                </div>\n            </div>\n            <div v-if=\"!symbologyStackLoaded\">\n                <!-- display loading text if the stack hasn't loaded yet -->\n                <div class=\"flex p-5 ml-48\" v-truncate>\n                    <div class=\"relative animate-spin spinner h-20 w-20 mr-10 pt-2\" v-if=\"isAnimationEnabled\"></div>\n                    <div class=\"flex-1 text-gray-500\" v-truncate>\n                        <span>{{ t('legend.symbology.loading') }}</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <!-- Display children of the group -->\n        <div class=\"legend-group border-l-2 ml-4 pl-4\" v-if=\"legendItem.expanded\">\n            <item\n                v-for=\"item in legendItem.children\"\n                :legendItem=\"item\"\n                :key=\"item.uid\"\n                @focus-item=\"(focusItem: HTMLElement) => $emit('focusItem', focusItem)\"\n            />\n        </div>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { GlobalEvents, InstanceAPI } from '@/api';\nimport type { LegendSymbology, RampLayerConfig } from '@/geo/api';\nimport { InitiationState, LayerControl } from '@/geo/api';\nimport { useLayerStore } from '@/stores/layer';\nimport to from 'await-to-js';\nimport { marked } from 'marked';\nimport type { PropType } from 'vue';\nimport { computed, inject, ref, toRaw, useTemplateRef, watch } from 'vue';\nimport { LayerItem } from '../store/layer-item';\nimport { LegendControl, LegendType } from '../store/legend-item';\nimport { InfoType, SectionItem } from '../store/section-item';\nimport Checkbox from './checkbox.vue';\nimport LegendOptions from './legend-options.vue';\nimport { usePanelStore } from '@/stores/panel';\nimport { useI18n } from 'vue-i18n';\nimport { useLegendStore } from '../store';\n\n// eslint doesn't recognize <symbology-stack> usage\n// eslint-disable-next-line\nimport SymbologyStack from './symbology-stack.vue';\n\nimport type { LegendAPI } from '../api/legend';\nimport type { LegendItem } from '../store/legend-item';\n\nconst layerStore = useLayerStore();\nconst panelStore = usePanelStore();\nconst { t } = useI18n();\nconst iApi = inject('iApi') as InstanceAPI;\nconst el = ref();\n\nconst props = defineProps({\n    legendItem: {\n        type: Object as PropType<LegendItem | LayerItem | SectionItem>,\n        required: true\n    }\n});\n\nconst legendStore = useLegendStore();\nconst allowMultilineItems = legendStore.multilineItems;\nconst maxLines = (props.legendItem instanceof LayerItem && props.legendItem.maxLines) ?? legendStore.maxLines;\n\nconst mobileMode = ref(panelStore.mobileView);\nconst layerConfigs = computed(() => layerStore.layerConfigs);\nconst symbologyStack = ref<Array<LegendSymbology>>([]); // ref instead of reactive to maintain reactivity after promise\nconst symbologyStackLoaded = ref<boolean>(false);\nconst hovered = ref(false);\nconst legendFocusItem = useTemplateRef('legendFocusItem');\n\n/**\n * Get the type of layer\n */\nconst layerType = computed((): string | undefined => {\n    return props.legendItem instanceof LayerItem ? toRaw(props.legendItem!.layer)?.layerType : '';\n});\n\n/**\n * Determine if the layer is modifiable\n */\nconst modifiableLayer = computed((): boolean => {\n    return props.legendItem instanceof LayerItem && toRaw(props.legendItem!.layer)?.canModifyLayer;\n});\n\n/**\n * Determine if the layer is reloadable\n */\nconst reloadableLayer = computed((): boolean => {\n    if (props.legendItem instanceof LayerItem) {\n        const rawLayer = toRaw(props.legendItem.layer);\n        if (rawLayer) {\n            return rawLayer.canReload;\n        } else {\n            // funny logic: if layer doesn't exist, it hasn't been registered and\n            // linked yet. Main scenario is MIL children who don't get created\n            // until after parent loads.\n            // Non-reloadability is typically due to file stuff via wizard or\n            // using rawData + no caching config. Their RAMP layer will register\n            // prior to failpoints.\n            // So return true, else child-bound entries won't be able to reload\n            return true;\n        }\n    } else {\n        return false;\n    }\n});\n\n/**\n * Get animation enabled status\n */\nconst isAnimationEnabled = computed((): boolean => {\n    return iApi.animate;\n});\n\n/**\n * Get if this item is a group (has at least one child)\n */\nconst isGroup = computed((): boolean => {\n    return (\n        props.legendItem.children.length > 0 ||\n        // TODO: Determine why Vue reactivity isn't picking updates to the children property of the parent.\n        // isGroup is being called on the parent before the children are mapped in legend.ts. After they're mapped, isGroup isn't called again.\n        (props.legendItem instanceof LayerItem && toRaw(props.legendItem!.layer)?.sublayers.length > 0)\n    );\n});\n\n/**\n * Designate between layer controls and legend controls\n */\nconst controlAvailable = (control: LegendControl | LayerControl): boolean | undefined => {\n    if (control === LegendControl.Expand || control === LegendControl.Visibility)\n        return props.legendItem.controlAvailable(control as LegendControl);\n    else return (props.legendItem as LayerItem).layerControlAvailable(control as LayerControl);\n};\n\nconst markdownToHtml = (md: string) => {\n    return marked(md);\n};\n\nconst toggleExpand = () => {\n    if (props.legendItem.children.length === 0 || !controlAvailable(LegendControl.Expand)) {\n        return;\n    }\n    props.legendItem.toggleExpanded();\n    iApi.updateAlert(t(`legend.alert.group${props.legendItem.expanded ? 'Expanded' : 'Collapsed'}`));\n};\n/**\n * Display symbology stack for the layer.\n */\nconst toggleSymbology = (): void => {\n    if (controlAvailable(LayerControl.Symbology)) {\n        const expanded = (props.legendItem as LayerItem).toggleSymbology();\n        iApi.updateAlert(t(`legend.alert.symbology${expanded ? 'Expanded' : 'Collapsed'}`));\n    }\n};\n\n/**\n * Toggles data table panel to open/close for the LegendItem.\n */\nconst toggleGrid = (): void => {\n    if (controlAvailable(LayerControl.Datatable) && getDatagridExists()) {\n        iApi.event.emit(GlobalEvents.GRID_TOGGLE, (props.legendItem as LayerItem).layer);\n    }\n};\n\n/**\n * Returns a span containing the resized legend graphic.\n */\nconst getLegendGraphic = (item: any): string | undefined => {\n    const span = document.createElement('span');\n    span.innerHTML = item.svgcode;\n    const svg = span.firstElementChild;\n    // The legend graphic will display either in its original size, or resized to fit the width of the legend item.\n    svg?.classList.add('max-w-full');\n    svg?.classList.add('h-full');\n    svg?.setAttribute('height', item.imgHeight);\n    svg?.setAttribute('width', item.imgWidth);\n    return span.outerHTML;\n};\n\n/**\n * Indicates if the data grid fixture has been added\n */\nconst getDatagridExists = (): boolean => {\n    try {\n        return iApi.fixture.exists('grid');\n    } catch {\n        return false;\n    }\n};\n\n/**\n * Reloads a layer on the map.\n * Layer is in an error'd state for that UI to be available.\n */\nconst reloadLayer = () => {\n    props.legendItem.reload();\n    // want the animation to play for half a second because a reload can fail \"instantly\", making it look like nothing happened to the user\n    setTimeout(() => {\n        const layerItemProp = props.legendItem as LayerItem;\n        let recreateFromConfig = true;\n\n        if (layerItemProp.layer) {\n            // layer exists, reload it\n            toRaw(layerItemProp.layer).reload();\n            recreateFromConfig = false;\n        } else if (layerItemProp.isSublayer && layerItemProp.parentLayerId) {\n            // see if parent exists, if so, reload it.\n            const testParent = iApi.geo.layer.getLayer(layerItemProp.parentLayerId);\n            if (testParent) {\n                toRaw(testParent).reload();\n                recreateFromConfig = false;\n            }\n        }\n\n        if (recreateFromConfig) {\n            // were unable to find any layers. Attempt to re-create layer with layer config\n\n            const targetId = layerItemProp.isSublayer ? layerItemProp.parentLayerId : layerItemProp.layerId;\n\n            const layerConfig = layerConfigs.value.find(lc => lc.id === targetId);\n            if (layerConfig !== undefined) {\n                recreateLayer(layerConfig as RampLayerConfig);\n            }\n        }\n\n        // just to silence console about unhandled rejections.\n        props.legendItem.loadPromise.catch(() => {});\n    }, 400);\n};\n\n/**\n * Attempt to recreate and instantiate layer from config.\n * Used when an initial layer failed to attach itself to the legend item\n */\nconst recreateLayer = async (layerConfig: RampLayerConfig) => {\n    try {\n        // check if the layer exists in store.\n        // if so, attempt to reload.\n        const checkLayer = iApi.geo.layer.getLayer(layerConfig.id);\n        if (checkLayer) {\n            const [reloadErr] = await to(toRaw(checkLayer).reload());\n            if (reloadErr) {\n                throw new Error();\n            } else {\n                return checkLayer;\n            }\n        } else {\n            // try to re-create new layer based on layerConfig\n            // same code to how layers are initialized when layer config array changes, expose this as layer API method?\n\n            // TODO low priority investigation: now that layers get registered right away,\n            // can this ELSE block even get hit anymore? I think we'll always find checkLayer.\n            // if layer got removed, legend block should have vanished.\n            const layer = iApi.geo.layer.createLayer(layerConfig);\n\n            await iApi.geo.map.addLayer(layer).catch(() => {\n                throw new Error();\n            });\n\n            return layer;\n        }\n    } catch {\n        return;\n    }\n};\n\n/**\n * Dual use method, leveraged for layers not in a loaded, active state.\n * For a loading layer, will \"Cancel\" it. This puts it in the error state but keeps it registered.\n * For an errored layer, will \"Remove\" it. Layer deleted from legend, map, and unregistered.\n */\nconst cancelOrRemoveLayer = () => {\n    const layerItem: LayerItem = toRaw(props.legendItem as LayerItem); // so that typescript doesn't yell in the whole method\n    let safetyCount = 0;\n\n    if (layerItem.type === LegendType.Error) {\n        // layer in error state, remove layer permanently\n        // layer could appear later, so we need to keep checking if its there.\n        // It will typically be in the store (now happens soon as its added),\n        // but the ESRI layer may appear later if things get wacky.\n        // given we can also cancel prior to initiation finishing, we consider\n        // layers in that state.\n\n        props.legendItem.toggleHidden(true); // temporarily hide item until we can remove it\n\n        const removalWatcher = setInterval(() => {\n            // test: we can find the Ramp layer AND ...\n            //           the Esri layer exists OR layer is not on the path to have an Esri layer\n            //       OR if it's been 5 minutes, stop and try ur best (1200 * 250 === five mins)\n\n            const rampL = layerItem.layer;\n\n            if (\n                (rampL &&\n                    (rampL.layerExists ||\n                        rampL.initiationState === InitiationState.NEW ||\n                        rampL.initiationState === InitiationState.TERMINATING ||\n                        rampL.initiationState === InitiationState.TERMINATED)) ||\n                safetyCount > 1200\n            ) {\n                // stop the interval\n                clearInterval(removalWatcher);\n\n                if (rampL) {\n                    // remove from the map, which will de-register and remove anything from the map\n                    iApi.geo.map.removeLayer(rampL);\n                }\n\n                // remove layer config from store\n                layerStore.removeLayerConfig(layerItem.layerId);\n\n                // remove layer item from legend\n                iApi.fixture.get<LegendAPI>('legend')?.removeLayerItem(layerItem.layerId);\n            }\n\n            safetyCount++;\n        }, 250);\n    } else {\n        // layer in loading state, \"cancel\" layer\n        // this puts it in error state. user can then reload or remove\n\n        props.legendItem.error();\n\n        // if a sublayer or parent layer was cancelled, cancel the parent layer and all other sublayers.\n        // need to keep polling for the parent layer since some sublayers may not be in the config (stuff that came from a group)\n\n        // This should find stuff real quick now that layers are immediately registered. But keeping the watcher to handle\n        // any weird scenarios (e.g. RampMapAPI.addLayer had critical failure)\n        // The interval is at a faster rate to account for any rapid cancel & reload clicks. setInterval always waits the interval\n        // before first check.\n        const cancelWatcher = setInterval(() => {\n            const parentmostId = layerItem.parentLayerId || layerItem.layerId;\n            const parentLayer = iApi.geo.layer.getLayer(parentmostId);\n\n            if (parentLayer) {\n                clearInterval(cancelWatcher);\n\n                // cancel the ramp layer\n                parentLayer.cancelLoad();\n\n                // cancel any blocks tied to the layer or sublayers.\n\n                const affectedBlocks = iApi.fixture.get<LegendAPI>('legend')?.getLayerBoundItems(parentLayer) || [];\n\n                affectedBlocks.forEach(block => block.error());\n            }\n\n            if (safetyCount > 1200) {\n                // 1 minute\n                clearInterval(cancelWatcher);\n            }\n\n            safetyCount++;\n        }, 50);\n    }\n};\n\nconst loadSymbologyStack = () => {\n    // load the symbology only when the layer is loaded\n    props.legendItem.loadPromise\n        .then(() => {\n            symbologyStack.value = [];\n            // Wait for symbology to load\n            if (!(props.legendItem as LayerItem).layer) {\n                // This should never happen because the layer is loaded before the legend item component is mounted\n                console.warn('Attempted to mount legend item component with undefined layer');\n                return;\n            }\n            Promise.all(\n                toRaw((props.legendItem as LayerItem).symbologyStack.map((item: LegendSymbology) => item.drawPromise))\n            ).then(() => {\n                symbologyStack.value = (props.legendItem as LayerItem).symbologyStack;\n\n                // Mark the symbology stack as loaded.\n                symbologyStackLoaded.value = true;\n            });\n        })\n        .catch(() => {});\n};\n\n/**\n * Helper function needed to delay tooltips using the _tippy?.show() workaround\n */\nconst hover = (t: EventTarget) => {\n    hovered.value = true;\n    setTimeout(() => {\n        if (hovered.value) {\n            if (!mobileMode.value) {\n                //@ts-expect-error TODO: explain why this is needed or remove\n                t._tippy?.show();\n            }\n        }\n    }, 300);\n};\n\nif (props.legendItem instanceof LayerItem) {\n    loadSymbologyStack();\n    watch(\n        () => (props.legendItem as LayerItem).symbologyStack,\n        () => {\n            loadSymbologyStack();\n        }\n    );\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.legend-group {\n    transition: max-height 0.7s ease-in;\n}\n.expand-toggle {\n    transition: transform 0.3s cubic-bezier(0.35, 0, 0.25, 1);\n}\n.rotate-180 {\n    transform: rotate(-180deg);\n}\n\n@media (hover) {\n    .loaded-item.singlelined {\n        @apply min-h-[39px];\n        .options {\n            @apply hidden;\n        }\n    }\n    .loaded-item.multilined {\n        @apply min-h-[39px];\n        .options {\n            @apply block;\n        }\n    }\n    .loaded-item:hover {\n        .options {\n            @apply block;\n        }\n    }\n}\n.loaded-item:focus-within {\n    .options {\n        @apply block;\n    }\n}\n\n.non-loaded-item {\n    @apply px-5 py-5 pb-10 pr-0 align-middle;\n}\n.disabled {\n    @apply text-gray-400 cursor-default;\n}\n\n// Overriding Tailwind's line-clamp classes,\n// which occasionally fail or disappear for no reason\n\n// NOTE: The multiline legend items use the CSS line-clamp\n// property. If padding is used, it will start showing the\n// clamped/hidden text using the padding space, which can lead\n// to fragments of the clamped text showing up. In these cases,\n// refactor to use margin.\n\n.line-clamp-1 {\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: 1;\n}\n\n.line-clamp-2 {\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: 2;\n}\n\n.line-clamp-3 {\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: 3;\n}\n\n.line-clamp-4 {\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: 4;\n}\n\n.line-clamp-5 {\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: 5;\n}\n\n.line-clamp-6 {\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: 6;\n}\n</style>\n"],"names":["t","useI18n","props","__props","initialChecked","ref","onMounted","toggleVisibility","LegendItem","LayerItem","iApi","inject","dropdown","hovered","panelStore","usePanelStore","mobileMode","emit","__emit","legendOptionKey","toggleSymbology","LayerControl","toggleGrid","getFixtureExists","GlobalEvents","toggleSettings","toggleMetadata","metaConfig","name","catalogueUrl","parseUrl","metadataExtension","metadataType","zoomToLayerBoundary","removeLayer","reloadLayer","e","reloadableLayer","toRaw","computed","hover","fixtureName","stack","l","layerStore","useLayerStore","el","legendStore","useLegendStore","allowMultilineItems","maxLines","layerConfigs","symbologyStack","symbologyStackLoaded","legendFocusItem","useTemplateRef","layerType","modifiableLayer","rawLayer","isAnimationEnabled","isGroup","controlAvailable","control","LegendControl","markdownToHtml","md","marked","toggleExpand","expanded","getDatagridExists","getLegendGraphic","item","span","svg","layerItemProp","recreateFromConfig","testParent","targetId","layerConfig","lc","recreateLayer","checkLayer","reloadErr","to","layer","cancelOrRemoveLayer","layerItem","safetyCount","LegendType","removalWatcher","rampL","InitiationState","cancelWatcher","parentmostId","parentLayer","block","loadSymbologyStack","watch"],"mappings":"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"}