import{ch as D,c3 as O,cl as F}from"./main-pOgmbpmS.js";import{c as v}from"./PixelBlock-DKNwVpro.js";function G(t,x){if(t.spatialReference.equals(x))return t;const e=O(t.spatialReference),n=O(x);if(e===n)return t;const a=e/n;return{x:t.x*a,y:t.y*a}}async function H(t,x,e){if(e.type==="extent")return Q(t,x,e);const{width:n,height:a}=t,i=new Uint8Array(n*a);return(await import("./intersectsOperator-D7U4Ib7c.js").then(h=>h.i)).execute(x,e)?e.type==="polyline"?_(t,x,e):(await import("./containsOperator-mjOuKzO8.js").then(h=>h.c)).execute(e,x)?t:J(t,x,e):new v({pixelType:t.pixelType,width:n,height:a,mask:i,maskIsAlpha:!1,pixels:[...t.pixels]})}function J(t,x,e){if(!t)return t;const{width:n,height:a}=t,i=j({geometry:e,size:[n,a],srcExtent:x,srcMask:t.mask});return new v({pixelType:t.pixelType,width:n,height:a,mask:i,maskIsAlpha:!1,pixels:[...t.pixels]})}function j(t){const{geometry:x,size:e,srcExtent:n,srcMask:a}=t,[i,h]=e;let r;const l=n.width/i,y=n.height/h,{xmin:s,ymax:o}=n;if(x.type==="extent"){const c=(x.xmin-s)/l,m=(x.xmax-s)/l,p=(o-x.ymax)/y,f=(o-x.ymin)/y;r=[[[c,p],[c,f],[m,f],[m,p],[c,p]]]}else r=x.rings.map(c=>c.map(([m,p])=>[(m-s)/l,(o-p)/y]));return N(r,e,a)}function N(t,x,e){const[n,a]=x,i=new OffscreenCanvas(n,a).getContext("2d");i.fillStyle="#f00",i.beginPath(),t.forEach(s=>{i.moveTo(s[0][0],s[0][1]);for(let o=0;o<s.length;o++)i.lineTo(s[o][0],s[o][1]);i.closePath()}),i.fill();const h=i.getImageData(0,0,n,a).data,r=n*a,l=new Uint8Array(r);let y=!1;for(let s=0;s<r;s++)e&&!e[s]||(h[4*s+3]>127?l[s]=255:y=!0);return y||e?l:void 0}function Q(t,x,e){const{width:n,height:a}=t,i=new Uint8Array(n*a),h=x.width/n,r=x.height/a;if(e.width/h<.5||e.height/r<.5)return new v({pixelType:t.pixelType,width:n,height:a,mask:i,pixels:[...t.pixels]});const{xmin:l,xmax:y,ymin:s,ymax:o}=x,{xmin:c,xmax:m,ymin:p,ymax:f}=e,M=Math.max(l,c),A=Math.min(y,m),R=Math.max(s,p),S=Math.min(o,f),C=.5*h,T=.5*r;if(A-M<C||S-R<T||A<l+C||M>y-C||R>o-T||S<s+T)return new v({pixelType:t.pixelType,width:n,height:a,mask:i,pixels:[...t.pixels]});const U=Math.max(0,(M-l)/h),E=Math.min(n,Math.max(0,(A-l)/h)),z=Math.max(0,(o-S)/r),g=Math.min(a,Math.max(0,(o-R)/r)),u=Math.round(U),w=Math.round(E)-1,d=Math.round(z),I=Math.round(g)-1;if(u===w&&U%1>.5&&E%1<.5||d===I&&z%1>.5&&g%1<.5)return new v({pixelType:t.pixelType,width:n,height:a,mask:i,pixels:[...t.pixels]});if(u===0&&d===0&&w===n&&I===a)return t;const P=t.mask;for(let k=d;k<=I;k++)for(let b=u;b<=w;b++){const q=k*n+b;i[q]=P?P[q]:255}return new v({pixelType:t.pixelType,width:n,height:a,mask:i,pixels:[...t.pixels]})}function _(t,x,e){const{width:n,height:a}=t,i=new Uint8Array(n*a),h=x.width/n,r=x.height/a,{xmin:l,ymax:y}=x,{paths:s}=e,o=t.mask;for(let c=0;c<s.length;c++){const m=s[c];for(let p=0;p<m.length-1;p++){const[f,M]=m[p],[A,R]=m[p+1],S=Math.min(M,R),C=Math.max(M,R),T=Math.max(0,Math.floor((y-C)/r)),U=Math.min(a-1,Math.floor((y-S)/r));if(!(U<T))if(T===U){const E=Math.min(f,A),z=Math.max(f,A),g=Math.max(0,Math.floor((E-l)/h)),u=Math.min(n-1,Math.floor((z-l)/h));if(u<g)continue;const w=T*n;for(let d=w+g;d<=w+u;d++)i[d]=o?o[d]:255}else{const E=(f-l)/h,z=(A-f)/(R-M)/h,g=r*z;for(let u=T;u<=U;u++){const w=z*(y-u*r-M)+E,d=Math.max(0,Math.floor(g>0?w-g:w)),I=Math.min(n-1,Math.floor(g>0?w:w-g));if(I<d)continue;const P=u*n;for(let k=P+d;k<=P+I;k++)i[k]=o?o[k]:255}}}}return new v({pixelType:t.pixelType,width:n,height:a,mask:i,pixels:[...t.pixels]})}function $(t,x){const{extent:e}=B(t,x,new F({x:t.pixelSize.x,y:t.pixelSize.y,spatialReference:t.spatialReference})),{extent:n}=t.extent;if(e.xmax=Math.min(e.xmax,n.xmax),e.ymax=Math.min(e.ymax,n.ymax),e.xmin<e.xmax&&e.ymin<e.ymax){const{x:a,y:i}=t.pixelSize,h=Math.round(e.width/a),r=Math.round(e.height/i);t.extent=e,t.width=h,t.height=r}}function B(t,x,e,n=!0){const{spatialReference:a}=t,{x:i,y:h}=G(e,a);let r,l,y;const s=x.type==="extent"?x:x.extent;let{xmin:o,xmax:c,ymax:m,ymin:p}=s;const{xmin:f,ymax:M}=t.extent;return n?(o=f+(o>f?i*Math.round((o-f)/i):0),m=M-(m<M?h*Math.round((M-m)/h):0),c=f+(c>f?i*Math.round((c-f)/i):0),p=M-(p<M?h*Math.round((M-p)/h):0),r=new D({xmin:o,ymax:m,xmax:c,ymin:p,spatialReference:a}),l=Math.round(r.width/i),y=Math.round(r.height/h)):(l=Math.floor((c-o)/i+.8),y=Math.floor((m-p)/h+.8),o=f+(o>f?i*Math.floor((o-f)/i+.1):0),m=M-(m<M?h*Math.floor((M-m)/h+.1):0),c=o+l*i,p=m-y*h,r=new D({xmin:o,ymax:m,xmax:c,ymin:p,spatialReference:a})),{extent:r,width:l,height:y}}export{j as h,$ as l,B as p,H as r};
