import{bh as kt,bs as ii,cp as nt,k as a,o as c,A as x,aC as ni,v as Eo,eN as So,bv as C,aT as si,cG as Ln,B as st,b1 as Ce,aH as Y,id as oi,bd as Gn,de as Rt,dc as Ol,aA as g,aD as J,V as Dn,f2 as Mo,gL as Il,gN as Ll,jL as Gl,cq as Po,s as zn,cr as Dl,jM as Vt,bC as At,a1 as Gi,gV as zl,jN as Ul,a0 as Hl,cI as Nl,jO as Fl,a2 as Zl,fJ as Bl,cD as Un,bQ as ri,bD as Co,jP as ko,f as Hn,cZ as Ot,h3 as Yl,cg as Nn,jQ as Xl,bq as ai,bg as Fn,cv as ot,fu as Wl,e_ as Zn,d6 as Ro,jR as Bn,ao as ql,eW as Vo,b as jl,jS as $l,l as li,eT as ci,eM as Ao,D as Kl,eX as Ql,iM as Oo,jT as Jl,jU as ec,jV as tc,jW as Io,aE as D,bP as bt,f1 as wt,C as ce,cR as Yn,aF as ic,az as Xn,jX as Lo,eU as Wn,cL as qn,jY as nc,eH as sc,cb as oc,eC as rc,fv as ac,jZ as lc,aM as cc,ca as hc,ay as Go,e$ as uc,bF as Do,aP as pc,eI as zo,j_ as dc,eO as jn,aJ as Uo,eg as $n,dA as Ho,fr as fc,be as It,j$ as gc,k0 as No,iJ as mc,dg as Fo,fI as Zo,eS as Bo,df as yc}from"./main-Dv0FawL-.js";import{e as q,y as _c,d as Ue,p as Lt,j as rt,B as vc,_ as Yo,q as xc,o as He,b as Di,E as Xo,L as bc,m as Wo,r as wc,T as Tc,v as Kn,I as Ec,k as zi,f as Sc,M as Mc,u as Qn,l as qo}from"./vec2-tHZ6OaOy.js";import{n as L,r as at,a as Pc,_ as Cc,e as kc,s as Rc}from"./vec2f64-CeODonrJ.js";import{U as Vc,w as Ac}from"./enums-CpSG_SL3.js";import{e as Jn,n as Oc,a as ye}from"./projectVectorToVector-BnqC4YH-.js";import{m as Ic,x as Lc,j as Ui,a as Gc,b as Dc,E as jo,p as $o,u as zc,l as Uc}from"./elevationInfoUtils-rJAem2qX.js";import{H as z,p as lt,g as ct,P as Z,c as Ee,A as ht,_ as ke,Q as Ko,I as Tt,o as U,R as he,q as H,s as se,Z as es,v as Hc,j as Qo,J as Gt,u as ue,y as ts,K as Jo,w as er,r as hi}from"./vec32-BQh4ekea.js";import{h as tr}from"./UpdatingHandles-D1FZwHl0.js";import is from"./GraphicsLayer-DnJYfBIf.js";import{j as ui,q as Hi,b as Ni,N as Fi,y as ir,v as Nc,R as Fc}from"./geodesicUtils-BlXKkc7v.js";import{simplify as Zc,distance as Bc,geodesicArea as Yc,geodesicLength as nr}from"./geometryEngine-DtU-T4gC.js";import{u as Xc}from"./Tile-DWLCSvfV.js";import{u as sr,O as Wc,P as or,_ as rr,J as qc,Q as Et,T as jc}from"./MapView-CrMD8fFU.js";import{R as $c,L as Kc}from"./quat-Ce6gmKEA.js";import{e as ar}from"./quatf64-C16JxGFv.js";import{o as Re,m as lr,f as Zi,a as pe,w as Qc,g as Jc,b as Ne,p as eh,D as th,x as ih,y as nh,F as sh,$ as oh,d as rh,h as ah,B as lh,M as ch,j as hh,i as Fe,c as uh,e as Dt,k as Ze,U as ns,l as Bi,n as ph,s as dh}from"./ReactiveSet--kL-oP6P.js";import{s as fh,j as gh,_ as mh,a as yh,L as _h}from"./vec42-D8CJyqHG.js";import{n as cr,r as ss,u as vh}from"./vec4f64-hf2nxvhQ.js";import{i as xh}from"./projectBuffer-keAXlkbN.js";import{M as oe,z as hr,l as pi,Q as os,d as ur,k as rs,V as zt,H as as,O as Ut,p as pr,D as bh,J as wh,b as Th,f as dr,h as ls,t as di}from"./plane-ccCiLCgq.js";import{I as Eh,O as Sh,_ as Mh,$ as Ph,U as Ch}from"./sphere-C7aIPEb1.js";import{e as fi}from"./common-CYWrYyJl.js";import{a as fr,n as cs}from"./Cyclical-DQGBMbT5.js";import"./MeshTransform-tgMVchtl.js";import{a as kh}from"./meshVertexSpaceUtils-DuD29fe0.js";import{B as gi,n as v,e as hs,q as _e,l as Rh,d as us,u as Vh,t as Ah}from"./themeUtils-7gDl9Mlp.js";import{n as Oh}from"./uuid-Dj9mdEVg.js";import{e as Ih}from"./earcut-XDcq3zAf.js";import{v as Lh}from"./triangle-_7Ezvr2d.js";import{w as Gh,a as Dh}from"./spatialReferenceEllipsoidUtils-BXaBgBLa.js";import{d as zh}from"./diffUtils-CkT4754r.js";import{l as mi}from"./ViewingMode-CyR_b1T8.js";import{K as Ht,J as Uh,N as gr}from"./projection-DmpruZ6B.js";import"./MeshLocalVertexSpace-D8Jbm-C-.js";import{n as Hh}from"./compilerUtils-BPRaTdzq.js";import{g as mr,F as yr}from"./Scheduler-CCs4huAZ.js";import"./Query-LHTbNS2H.js";import{h as Nh}from"./ElevationInfo-NUIDpku8.js";import{I as _r}from"./cimSymbolUtils-B3kF0jE_.js";import{c as Fh}from"./projectPointToVector-B2SbSYpS.js";import{i as Zh}from"./drapedUtils-C1hJlrh5.js";import{R as vr}from"./colorUtils-CMcPs4xJ.js";import{W as yi,K as Yi,Z as Xi}from"./boundedPlane-MEoUUTpl.js";function _i(t,e){return t===e||t!=null&&e!=null&&kt(t.spatialReference,e.spatialReference)&&t.x===e.x&&t.y===e.y&&t.z===e.z&&t.m===e.m}function ps(t,e,i){return t===e||t!=null&&e!=null&&kt(t.spatialReference,e.spatialReference)&&ii(t.x,e.x,i)&&ii(t.y,e.y,i)&&ii(t.z??0,e.z??0,i)&&ii(t.m??0,e.m??0,i)}function Bh(t){return"declaredClass"in t}function xr(t,e){if(!t)return null;let i;return Bh(t)?t.clone():(i=Jn(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0),i)}var br;function wr(t,e,i){return j(t,e,i)}function j(t=0,e=0,i=0){return nt(t,e,i)}function ut(t,e,i){return nt(t,e,i)}function Nt(t){const[e,i,n]=t;return t.length>3?[e,i,n,t[3]]:[e,i,n]}function ds(t,e,i,n=j()){return n[0]=t.x,n[1]=t.y,n[2]=t.z??0,e==null||(e.type==="2d"?n[2]=0:n[2]=Ic(e,t,i,Ui)??0),n}function Yh(t,e,{z:i,m:n},s,o){const{spatialReference:r,elevationInfo:l}=s;let h;i==null&&n==null?h=void 0:e==null||e.type==="2d"?h=i??void 0:h=Lc(e,t,r,Ui,l)??0;const[u,p]=t;return o?Oc(o,u,p,h,r):o=Jn(u,p,h,r),n!=null&&(o.m=n,o.hasM=!0),o}(function(t){t[t.NONE=0]="NONE",t[t.TARGET=1]="TARGET"})(br||(br={}));let Se=class extends Eo{constructor(){super(...arguments),this.enabled=!0}};a([c({type:Boolean})],Se.prototype,"enabled",void 0),Se=a([x("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Se);let V=class extends Eo{constructor(t){super(t),this.lineSnapper=new Se,this.parallelLineSnapper=new Se,this.rightAngleSnapper=new Se,this.rightAngleTriangleSnapper=new Se,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new ni([255,127,0]),this.orangeTransparent=new ni([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};a([c({type:Se,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"lineSnapper",void 0),a([c({type:Se,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"parallelLineSnapper",void 0),a([c({type:Se,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"rightAngleSnapper",void 0),a([c({type:Se,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"rightAngleTriangleSnapper",void 0),a([c({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],V.prototype,"shortLineThreshold",void 0),a([c({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],V.prototype,"distance",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"pointThreshold",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"intersectionParallelLineThreshold",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"parallelLineThreshold",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],V.prototype,"verticalLineThresholdMeters",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"touchSensitivityMultiplier",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"pointOnLineThreshold",void 0),a([c({type:ni,nonNullable:!0})],V.prototype,"orange",void 0),a([c({type:ni,nonNullable:!0})],V.prototype,"orangeTransparent",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"lineHintWidthReference",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"lineHintWidthTarget",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],V.prototype,"lineHintFadedExtensions",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"parallelLineHintWidth",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],V.prototype,"parallelLineHintLength",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],V.prototype,"parallelLineHintOffset",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],V.prototype,"rightAngleHintSize",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],V.prototype,"rightAngleHintOutlineSize",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],V.prototype,"satisfiesConstraintScreenThreshold",void 0),V=a([x("esri.views.interactive.snapping.Settings.Defaults")],V);const fs=new V;var Ft;(function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"})(Ft||(Ft={}));let vi=class{constructor(t,e){this.isDraped=t,this.domain=e}},Xh=class _l extends vi{constructor(e,i,n=Ft.ALL){super(i,n),this.intersectionPoint=e}equals(e){return e instanceof _l&&z(this.intersectionPoint,e.intersectionPoint)}},Wh=class vl extends vi{constructor(e,i,n,s,o=Ft.ALL,r=!0,l=!0){super(s,o),this.type=e,this.lineStart=i,this.lineEnd=n,this.fadeLeft=r,this.fadeRight=l}equals(e){return e instanceof vl&&this.type===e.type&&z(this.lineStart,e.lineStart)&&z(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return lt(this.lineStart,this.lineEnd)}},qh=class xl extends vi{constructor(e,i,n,s=Ft.ALL){super(n,s),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof xl&&z(this.lineStart,e.lineStart)&&z(this.lineEnd,e.lineEnd)}},jh=class bl extends vi{constructor(e,i,n){super(i,n),this.point=e}equals(e){return e instanceof bl&&z(this.point,e.point)}},$h=class wl extends vi{constructor(e,i,n,s,o=Ft.ALL){super(s,o),this.previousVertex=e,this.centerVertex=i,this.nextVertex=n}equals(e){return e instanceof wl&&z(this.previousVertex,e.previousVertex)&&z(this.centerVertex,e.centerVertex)&&z(this.nextVertex,e.nextVertex)}},Kh=class{draw(t,e){const i=Qh(t),n=this.sortUniqueHints(i),s=[];for(const o of n)o instanceof Xh&&s.push(this.visualizeIntersectionPoint(o,e)),o instanceof Wh&&s.push(this.visualizeLine(o,e)),o instanceof qh&&s.push(this.visualizeParallelSign(o,e)),o instanceof $h&&s.push(this.visualizeRightAngleQuad(o,e)),o instanceof jh&&s.push(this.visualizePoint(o,e));return So(s)}sortUniqueHints(t){return t}};function Qh(t){const e=[];for(const i of t){let n=!0;for(const s of e)if(i.equals(s)){n=!1;break}n&&e.push(i)}return e}let Jh=class extends Kh{constructor(t){super(),this._graphicsLayer=t,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(t,e){return this._visualizeSnappingIndicator(new C({x:t.intersectionPoint[0],y:t.intersectionPoint[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("intersectionPoint",e.view.effectiveTheme.accentColor))}visualizePoint(t,e){return this._visualizeSnappingIndicator(new C({x:t.point[0],y:t.point[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("point",e.view.effectiveTheme.accentColor))}visualizeLine(t,e){return this._visualizeSnappingIndicator(new si({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:Ln(st,e.spatialReference)}),this._getOrCreateSymbol("line",e.view.effectiveTheme.accentColor))}visualizeParallelSign(t,e){return this._visualizeSnappingIndicator(new si({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:Ln(st,e.spatialReference)}),this._getOrCreateSymbol("parallelSign",e.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(t,e){const i=L(),n=L(),s=g();q(i,t.centerVertex,t.previousVertex),q(n,t.nextVertex,t.previousVertex),_c(s,i,n);const o=`rightAngleQuad${s[2]<0?45:225}`;return this._visualizeSnappingIndicator(new si({paths:[[[...t.previousVertex],[...t.centerVertex],[...t.nextVertex]]],spatialReference:Ln(st,e.spatialReference)}),this._getOrCreateSymbol(o,e.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(t,e){const i=new Ce({geometry:t,symbol:e});return this._graphicsLayer.add(i),Y(()=>{this._graphicsLayer.remove(i)})}_getOrCreateSymbol(t,e){const i=this._symbolPairingsByType;return i.get(t)?.color!==e&&i.set(t,{color:e,symbol:eu(t,e)}),i.get(t).symbol}};function eu(t,e){const i=[...e.toRgb(),255*e.a];switch(t){case"point":return new Rt({outline:{width:.5,color:[0,0,0,1]},size:10,color:e});case"intersectionPoint":return new Rt({outline:new Ol({width:1.5,color:e}),size:15,color:[0,0,0,0]});case"line":return new oi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:Vc.Butt,joinStyle:Ac.Round,miterLimit:10,width:Gn(fs.lineHintWidthTarget),color:i}]}}});case"parallelSign":return new oi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const n=t==="rightAngleQuad45"?45:225;return new oi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:Gn(fs.rightAngleHintSize),rotation:n,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Gn(fs.rightAngleHintOutlineSize),color:i},{type:"CIMSolidFill",enable:!0,color:[...e.toRgb(),255*e.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}const tu=new oi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),iu=new Rt({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),nu=new Rt({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var de;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(de||(de={}));var Ve;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(Ve||(Ve={}));const Wi={[Ve.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[Ve.UndoInvalidError]:"There are no items to Undo",[Ve.RedoInvalidError]:"There are no items to Redo",[Ve.ApplyInvalidError]:"Cannot apply an item that is already applied"};let xi=class extends Error{constructor(){super(Wi[Ve.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},gs=class extends Error{constructor(){super(Wi[Ve.UndoInvalidError]),this.type="undo-redo-undo-error"}},Tr=class extends Error{constructor(){super(Wi[Ve.RedoInvalidError]),this.type="undo-redo-redo-error"}},su=class extends Error{constructor(){super(Wi[Ve.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var Be;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(Be||(Be={}));let qi=class extends J{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=de.NeverApplied}get canUndo(){return this.status===de.Applied}get canRedo(){return this.status===de.Undone}async executeUndoRedoOperation(t){switch(t){case Be.Apply:if(this.status!==de.NeverApplied)throw new su;return await this.apply(),void(this.status=de.Applied);case Be.Undo:if(this.status!==de.Applied)throw new gs;return await this.undo(),void(this.status=de.Undone);case Be.Redo:if(this.status!==de.Undone)throw new gs;return await this.redo(),void(this.status=de.Applied)}}};a([c()],qi.prototype,"name",void 0),a([c()],qi.prototype,"tag",void 0),qi=a([x("esri.undoredo.UndoableOperation")],qi);let Ae=class extends J{constructor(){super(...arguments),this._stack=new Dn,this._stackPosition=-1,this._updatingHandles=new tr}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new gs;if(this.updating)throw new xi;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(Be.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Tr;if(this.updating)throw new xi;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new Tr;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(Be.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new xi;await this._updatingHandles.addPromise((async()=>{t.status===de.NeverApplied&&await t.executeUndoRedoOperation(Be.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new xi;await this._updatingHandles.addPromise((async()=>{t.status===de.NeverApplied&&await t.executeUndoRedoOperation(Be.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await Mo(()=>!this.updating);const i=new Dn;for(let n=0;n<this._stack.length;n++){const s=this._stack.getItemAt(n);s&&(s.tag===t?(s.destroy(),n===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new xi;await Mo(()=>!this.updating),this._drainStack()}};a([c()],Ae.prototype,"_stack",void 0),a([c()],Ae.prototype,"_stackPosition",void 0),a([c()],Ae.prototype,"updating",null),a([c({readOnly:!0})],Ae.prototype,"canUndo",null),a([c({readOnly:!0})],Ae.prototype,"hasUndo",null),a([c({readOnly:!0})],Ae.prototype,"canRedo",null),a([c({readOnly:!0})],Ae.prototype,"hasRedo",null),Ae=a([x("esri.UndoRedo")],Ae);function ms(){return Ll()}function ou(){return Il()}function bi(t,e){const i=[];t=(t=(t=t.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("\u2032","'")).replaceAll("\u2033",'"');const n=lu(e);return Gl.dmsToGeog(n,1,[t],i)?new C(i[0][0],i[0][1],st.WGS84):null}function ru(t){return t&&ms()?Vt(t)??bi(`0\xB0 0' 0" N | ${t}`)?.longitude??bi(`0 | ${t}`)?.longitude??null:null}function au(t){return t&&ms()?Vt(t)??bi(`${t} | 0\xB0 0' 0" E`)?.latitude??bi(`${t} | 0`)?.latitude??null:null}function lu(t){let e=null;if(t||(t=st.WGS84),t.wkid){if(e=Po.geogcs(t.wkid),!e)throw new zn("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!t.wkt2&&!t.wkt)throw new zn("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(e=Po.fromString(Dl.PE_TYPE_GEOGCS,t.wkt2||t.wkt),!e)throw new zn("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return e}let cu=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var ys;let pt=ys=class extends At{constructor(t){super(t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=t?.hasZ??!1,this.rings.length!==0||!t)return;const i=Gi(this.radius,this.radiusUnit,"meters"),n=t.spatialReference;let s,o="geographic";if(n.isWebMercator?o="webMercator":((n.wkid&&zl[n.wkid])!=null||(n.wkt2||n.wkt)&&Ul(n.wkt2||n.wkt))&&(o="projected"),this.geodesic){let r;switch(o){case"webMercator":r=Hl(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":r=t}s=this._createGeodesicCircle(r,i,e),o==="webMercator"&&(s=Nl(s))}else{let r;o==="webMercator"||o==="projected"?r=i/Fl(t.spatialReference):o==="geographic"&&(r=Zl(i,"meters",Bl(t.spatialReference).radius)),s=this._createPlanarCircle(t,r,e)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:i,radiusUnit:n,geodesic:s}=this;return new ys({center:t?.clone(),numberOfPoints:e,radius:i,radiusUnit:n,geodesic:s})}_createGeodesicCircle(t,e,i){let n=0;const s=[];for(;n<360;){const o=[0,0],r=[t.x,t.y];ui(o,r,n,e,st.WGS84),this.hasZ&&o.push(t.z),s.push(o),n+=360/i}return s.push(s[0]),new At({rings:[s]})}_createPlanarCircle(t,e,i){const n=[],s=2*Math.PI/i;for(let o=0;o<i;++o){const r=s*o,l=[t.x+Math.cos(-r)*e,t.y+Math.sin(-r)*e];this.hasZ&&l.push(t.z),n.push(l)}return n.push(n[0]),new At({spatialReference:t.spatialReference,rings:[n]})}};a([c({type:C})],pt.prototype,"center",void 0),a([c()],pt.prototype,"geodesic",void 0),a([c()],pt.prototype,"numberOfPoints",void 0),a([c()],pt.prototype,"radius",void 0),a([c()],pt.prototype,"radiusUnit",void 0),pt=ys=a([x("esri.geometry.Circle")],pt);const hu=pt;function ji(t,e,i=null){return i!=null?[t,e,i]:[t,e]}function k(t,e,i=null){return i!=null?{x:t,y:e,z:i}:{x:t,y:e}}let Er=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map(e=>this.mapToLocal(e)).filter(ri)}get doUnnormalization(){return!1}},uu=class extends Er{constructor(t,e,i=null){super(e),this._defaultZ=i,this.transform=sr(),this.transformInv=sr(),this.transform=Wc(t),Xc(this.transformInv,this.transform)}makeMapPoint(t,e){return ji(t,e,this._defaultZ)}mapToLocal(t){return k(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return ji(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},pu=class extends Er{constructor(t,e){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=g(),this.tangentFrameUpWS=g(),this.tangentFrameRightWS=g(),this.tangentFrameForwardWS=g(),this.localFrameRightWS=g(),this.localFrameUpWS=g(),this.worldToLocalTransform=ar(),this.localToWorldTransform=ar(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=e,this.defaultZ=e.hasZ?e.z:null;const i=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Un.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Un.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Un.Z,this.tangentFrameForwardWS);const n=g();ct(n,this.tangentFrameForwardWS,Z(i,this.tangentFrameForwardWS)),Ee(this.localFrameRightWS,i,n),ht(this.localFrameRightWS,this.localFrameRightWS),ke(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),$c(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Kc(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(t,e){return ji(t,e,this.defaultZ)}mapToLocal(t){const e=g();this.view.renderCoordsHelper.toRenderCoords(new C({x:t[0],y:t[1],spatialReference:this.spatialReference}),e),Ko(e,e,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(e,new C({spatialReference:this.view.spatialReference}));return i!=null?k(i.x/this.scale,i.y/this.scale):null}localToMap(t){const e=g();this.view.renderCoordsHelper.toRenderCoords(new C({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),e),Ko(e,e,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(e,new C({spatialReference:this.view.spatialReference}));return i!=null?ji(i.x,i.y,this.defaultZ):null}};function du(t,e){if(t.type==="2d")return new uu(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if(t.type==="3d"){const i=e.length>2?new C({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new C({x:e[0],y:e[1],spatialReference:t.spatialReference});return new pu(t,i)}return null}function St(t,e){const i=new C({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function fu(t,e){return new Co({points:t,spatialReference:e})}function Sr(t,e,i){const n=new si({paths:t,spatialReference:e});return i&&ko(n),n}function wi(t,e,i,n=!0){const s=Hn(t);s.forEach(r=>{const l=r[0],h=r[r.length-1];Ot(l,h)&&r.length!==1||r.push(r[0])});let o=new At({rings:s,spatialReference:e});return o.rings.forEach(r=>{Yl(r)||r.reverse()}),i&&ko(o),n&&o.isSelfIntersecting&&Nn(e)&&(o=Zc(o)),o}function Mr(t,e,i){const n=e.mapToLocalMultiple(t),s=[],o={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y},l=Math.round(r.x-o.x),h=Math.round(r.y-o.y),u=Math.max(Math.abs(l),Math.abs(h));if(i){const p={x:o.x+u,y:o.y+u},d={x:o.x-u,y:o.y-u};s.push(k(p.x,d.y),k(d.x,d.y),k(d.x,p.y),k(p.x,p.y))}else{const p={x:l>0?o.x+u:o.x-u,y:h>0?o.y+u:o.y-u};s.push(k(o.x,o.y),k(p.x,o.y),k(p.x,p.y),k(o.x,p.y))}return Pr(wi([s.map(p=>e.localToMap(p)).filter(ri)],e.spatialReference,e.doUnnormalization,!0),s,e)}function gu(t,e,i){let n=e.mapToLocalMultiple(t);if(n.length===1){const l=n[0];n=[k(l.x-48,l.y+48),k(l.x+48,l.y-48),k(l.x+48,l.y-48),k(l.x-48,l.y+48)]}const s=[],o={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y};if(i){const l=Math.round(r.x-o.x),h=Math.round(r.y-o.y);s.push(k(o.x-l,o.y-h),k(r.x,o.y-h),k(r.x,r.y),k(o.x-l,r.y))}else s.push(k(o.x,o.y),k(r.x,o.y),k(r.x,r.y),k(o.x,r.y));return Pr(wi([s.map(l=>e.localToMap(l)).filter(ri)],e.spatialReference,e.doUnnormalization,!0),s,e)}function Pr(t,e,i){const n=$i(e[3],e[2],i),s=$i(e[1],e[2],i),o=$i(e[0],e[1],i),r=$i(e[0],e[3],i);return{geometry:t,midpoints:n!=null&&s!=null&&o!=null&&r!=null?{top:n,right:s,bottom:o,left:r}:null}}function $i(t,e,i){Zt[0]=t.x,Zt[1]=t.y,Zt[2]=0,Bt[0]=e.x,Bt[1]=e.y,Bt[2]=0,Tt(Zt,Zt,Bt,.5),Ki.x=Zt[0],Ki.y=Bt[1],Ki.z=Bt[2];const n=i.localToMap(Ki);return n!=null?St(n,i.spatialReference):null}const Ki=k(0,0,0),Zt=g(),Bt=g();function Cr(t,e,i,n){const s=e.mapToLocalMultiple(t);let o=null,r=null;if(i)o=s[0],r=s[1];else{const _=s[0],y=s[1],w=Math.round(y.x-_.x),b=Math.round(y.y-_.y),S=Math.max(Math.abs(w),Math.abs(b));o=k(w>0?_.x+S/2:_.x-S/2,b>0?_.y+S/2:_.y-S/2),r=k(Math.abs(w)>Math.abs(b)?o.x-S/2:o.x,Math.abs(w)>Math.abs(b)?o.y:o.y-S/2)}const l=e.localToMap(o),h=e.localToMap(r);if(l==null||h==null)return null;e.doUnnormalization&&Xl([[l,h]],e.spatialReference);const u=St(l,e.spatialReference),p=St(h,e.spatialReference),d=ai(e.spatialReference);let m=0;if(Nn(e.spatialReference))m=d*Bc(u,p,null);else{const _=o.x-r.x,y=o.y-r.y;m=d*Math.sqrt(_*_+y*y)*1}const f=new hu({center:u,radius:m,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:wi(f.rings,f.spatialReference,!1),center:u,edge:p}}function mu(t,e,i){const n=e.mapToLocalMultiple(t),s=n[0],o=n[1],r=Math.round(o.x-s.x),l=Math.round(o.y-s.y),h=k(i?s.x:s.x+r/2,i?s.y:s.y+l/2),u=i?r:r/2,p=i?l:l/2,d=60,m=[],f=2*Math.PI/d;function _(W){const me=Math.cos(W),le=Math.sin(W);return k(u*me+h.x,p*le+h.y)}for(let W=0;W<d;W++)m.push(_(W*f));m.push(m[0]);const{spatialReference:y,doUnnormalization:w}=e,b=wi([m.map(W=>e.localToMap(W)).filter(ri)],y,w,!1),S=e.localToMap(_(Math.PI/2)),I=e.localToMap(_(0)),K=e.localToMap(_(-Math.PI/2)),te=e.localToMap(_(Math.PI));return{geometry:b,midpoints:S!=null&&I!=null&&K!=null&&te!=null?{top:St(S,y),right:St(I,y),bottom:St(K,y),left:St(te,y)}:null}}function _s(t,e){switch(t){case"point":case"multipoint":return yu();case"polyline":return _u(e);case"polygon":return vu(e);default:return}}function yu(t){return"point"}function _u(t){return(t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function vu(t){const e=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function xu(t,e){const i=t?.geometry;if(!t||i?.type!=="mesh"||!e)return;const{renderCoordsHelper:n,elevationProvider:s}=e,{camera:o}=e.state,{extent:r}=i,{center:l,spatialReference:h}=r,u=ai(h),p=Fn(h),d=ai(n.spatialReference),m=r.width*u,f=r.height*p,_=(r.zmax??0)*p,y=_-(r.zmin??0)*p,w=Math.max(m,f,y)/d,{x:b,y:S}=l,I=l.z??0;U(Qi,b,S,I),n.toRenderCoords(Qi,h,Qi);const K=w/o.computeScreenPixelSizeAt(Qi);if(K>o.width*wu)return"meshTooClose";if(K<bu)return"meshTooFar";const te=Gc(t),{absoluteZ:W}=Dc(b,S,_,h,e,te);return W<(s.getElevation(b,S,I,h,"ground")??0)*p+y*Tu?"meshUnderground":"mesh"}const bu=20,wu=1,Tu=.1,Qi=g();function vs(t,e){return t[0]*e[1]-t[1]*e[0]}function Eu(t,e){const i=t.start,n=t.end,s=e.start,o=e.end,r=q(kr,n,i),l=q(Rr,o,s),h=vs(r,l);if(Math.abs(h)<=Mu)return[];const u=q(Vr,i,s),p=vs(l,u)/h,d=vs(r,u)/h;if(p>=0){if(d>=0||e.type===A.LINE)return[Ue(Ji,i,r,p)]}else if(t.type===A.LINE&&(d>=0||e.type===A.LINE))return[Ue(Ji,i,r,p)];return[]}function Su(t,e,i){const n=[],s=q(kr,t.end,t.start),o=q(Rr,t.start,e),r=Lt(s),l=2*rt(s,o),h=l*l-4*r*(Lt(o)-i*i);if(h===0){const u=-l/(2*r);(t.type===A.LINE||u>=0)&&n.push(Ue(Ji,t.start,s,u))}else if(h>0){const u=Math.sqrt(h),p=(-l+u)/(2*r);(t.type===A.LINE||p>=0)&&n.push(Ue(Ji,t.start,s,p));const d=(-l-u)/(2*r);(t.type===A.LINE||d>=0)&&n.push(Ue(Vr,t.start,s,d))}return n}var A;(function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"})(A||(A={}));const Mu=1e-6,kr=L(),Rr=L(),Vr=L(),Ji=L();function xs({start:t,end:e,type:i},n,s){const o=[],r=q(Ti,e,t),l=q(tn,t,n),h=Lt(r),u=2*rt(r,l),p=u*u-4*h*(Lt(l)-s*s);if(p===0){const d=-u/(2*h);(i===ve.PLANE||d>=0)&&o.push(Ue(L(),t,r,d))}else if(p>0){const d=Math.sqrt(p),m=(-u+d)/(2*h);(i===ve.PLANE||m>=0)&&o.push(Ue(L(),t,r,m));const f=(-u-d)/(2*h);(i===ve.PLANE||f>=0)&&o.push(Ue(L(),t,r,f))}return o}function Ar(t,e){const i=t.start,n=t.end,s=q(Ti,n,i),o=U(sn,-s[1],s[0],0),r=e.start,l=e.end,h=he(ws,l,r),u=Z(h,o),p=U(Hr,i[0],i[1],0),d=he(Nr,p,r),m=Z(d,o),f=fi();if(Math.abs(u)<f)return[];const _=H(Fr,r,h,m/u);if(e.type===A.RAY){const y=he(Ts,_,r);if(Z(y,h)<-f)return[]}if(t.type===ve.HALF_PLANE){const y=vc(tn,_,i);if(rt(y,s)<-f)return[]}return[ot(_)]}function Pu(t,e){return ku(en(Es,e[2],t),e)}function Or(t,e){return zr(en(Es,0,t),en(Ou,0,e)).map(([i,n])=>at(i,n))}function Ir(t,e,i){return Gr(t,en(Es,t[2],e),i)}function Lr(t,e,i,n=g()){const s=q(Ti,t,e),o=xc(s);return Ue(n,e,s,o===0?1:i/o),n[2]=t[2],n}function Gr(t,{start:e,end:i,type:n},s=g()){const o=he(nn,t,e),r=he(sn,i,e),l=Z(o,r)/Z(r,r);return H(s,e,r,n===A.RAY?Math.max(l,0):l)}const Cu=(()=>{const t=g(),e=g(),i=g();return({start:n,end:s},{center:o,radius:r,normal:l,slicePlane:h})=>{const u=pi(o,l,Au);if(R(os(u,n),0)&&R(os(u,s),0)){ur(l,t,e);const d=(_,y)=>(Ee(i,y,o),He(_,Z(i,t),Z(i,e)),_),m=Su({start:d(Ti,n),end:d(tn,s),type:A.LINE},Pc,r),f=[];for(const[_,y]of m){const w=se(g(),o);H(w,w,t,_),H(w,w,e,y),h&&!dt(h,w)||f.push(w)}return f}const p=g();return rs(u,n,s,p)?!R(lt(p,o),r)||h&&!dt(h,p)?[]:[p]:[]}})();function Dr({start:t,end:e,type:i},n,s){const o=[],r=Ee(nn,e,t),l=q(tn,t,n),h=Lt(r),u=2*rt(r,l),p=u*u-4*h*(Lt(l)-s*s);if(p===0){const d=-u/(2*h);(i===A.LINE||d>=0)&&o.push(H(g(),t,r,d))}else if(p>0){const d=Math.sqrt(p),m=(-u+d)/(2*h);(i===A.LINE||m>=0)&&o.push(H(g(),t,r,m));const f=(-u-d)/(2*h);(i===A.LINE||f>=0)&&o.push(H(g(),t,r,f))}return o}function zr(t,e){const i=t.start,n=t.end,s=e.start,o=e.end,r=he(nn,n,i),l=he(sn,o,s),h=he(ws,s,i),u=ke(Hr,r,l);if(!R(Z(h,u),0))return[];const p=es(u);if(R(p,0))return[];const d=ke(Nr,h,l),m=Z(d,u)/p,f=H(Fr,i,r,m);if(t.type===A.RAY){const _=he(Ts,f,i);if(Z(r,_)<-fi())return[]}if(e.type===A.RAY){const _=he(Ts,f,s);if(Z(l,_)<-fi())return[]}return[ot(f)]}function ku({start:t,end:e,type:i},n){const s=he(nn,n,t),o=he(sn,e,t),r=ke(ws,o,s),l=es(r)/es(o),h=fi();if(l<h)switch(i){case A.LINE:return[ot(n)];case A.RAY:return Z(o,s)<-h?[]:[ot(n)]}return[]}function bs(t,e,i,n){const[s,o]=t,[r,l]=i,h=r-s,u=l-o,p=h*h+u*u,d=Math.sqrt(p);if(d>e+n)return[];if(d<Math.abs(e-n))return[];if(R(d,0)&&R(e,n))return[];const m=(e*e-n*n+p)/(2*d),f=Math.sqrt(e*e-m*m),_=f*u/d,y=f*h/d,[w,b]=Yo(Ti,t,i,m/d);return R(_,y)?[at(w,b)]:[at(w+_,b-y),at(w-_,b+y)]}function en(t,e,{start:i,end:n,type:s}){return U(t.start,i[0],i[1],e),U(t.end,n[0],n[1],e),t.type=Vu[s],t}function Ur(t,e){return R(t[2],e[2])}function R(t,e){return ii(Math.abs(t-e),0,fi())}function Ru(t,e){return e.filter(i=>dt(t,i))}function dt(t,e){return hr(t,e)}var ve;(function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"})(ve||(ve={}));const Vu={[ve.PLANE]:A.LINE,[ve.HALF_PLANE]:A.RAY},Ti=L(),tn=L(),nn=g(),sn=g(),ws=g(),Hr=g(),Nr=g(),Fr=g(),Ts=g(),Au=oe(),Es={start:g(),end:g(),type:A.LINE},Ou={start:g(),end:g(),type:A.LINE};class xe{intersect(e){return Ye(this,e)}closestPoints(e){return[this.closestTo(e)]}}class Yt extends xe{constructor(e){super(),this.point=e}equals(e){return this===e||be(e)&&z(this.point,e.point)}closestTo(){return Nt(this.point)}}class Ss extends xe{constructor(e,i,n){super(),this.start=e,this.end=i,this.lineLike={start:e,end:i,type:n}}equals(e){return this===e||Oe(e)&&this.lineLike.type===e.lineLike.type&&z(this.start,e.start)&&z(this.end,e.end)}closestTo(e){const i=j();return Gr(e,this.lineLike,i),i}}class Zr extends Ss{constructor(e,i){super(e,i,A.LINE)}}class Iu extends Ss{constructor(e,i){super(e,i,A.RAY)}}class Br extends xe{constructor(e){super(),this.constraints=e}equals(e){return this===e||As(e)&&Ot(this.constraints,e.constraints,(i,n)=>i.equals(n))}closestTo(e){let i,n=1/0;for(const s of this.constraints){const o=s.closestTo(e),r=Hc(e,o);r<n&&(n=r,i=o)}return Nt(i??e)}closestPoints(e){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(e))}}class Yr extends xe{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||Le(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=j();return Lr(e,this.center,this.radius,i),i}}class Ms extends xe{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||We(e)&&z(this.center,e.center)&&this.radius===e.radius}closestTo(e){const i=j();return Lr(e,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new Ps(Nt(this.center),this.radius,ut(0,0,1))}}class Ps extends xe{constructor(e,i,n,s=void 0){super(),this.center=e,this.radius=i,this.normal=n,this.slicePlane=s}equals(e){return this===e||ft(e)&&z(this.center,e.center)&&z(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:i,radius:n}=this;as(this.getPlane(Lu),e,Cs);const s=he(Cs,Cs,i),o=Qo(s);if(R(o,0))return Nt(e);const r=n/Math.sqrt(o),l=j();H(l,i,s,r);const{slicePlane:h}=this;return h&&!dt(h,l)?Rs(h,this)?.closestTo(e)??Nt(e):l}getPlane(e=oe()){return pi(this.center,this.normal,e)}}const Cs=g(),Lu=oe();class Xr extends xe{constructor(e){super(),this.z=e}equals(e){return this===e||Xe(e)&&this.z===e.z}closestTo(e){return ut(e[0],e[1],this.z)}getPlane(e=oe()){return U(Wr,0,0,this.z),pi(Wr,Zn,e)}}const Wr=g();class qr extends xe{constructor(e,i,n){super(),this.start=e,this.end=i,this.planeLike={start:e,end:i,type:n}}equals(e){return this===e||Ie(e)&&this.planeLike.type===e.planeLike.type&&z(this.start,e.start)&&z(this.end,e.end)}closestTo(e){const i=j();return Ir(e,this.planeLike,i),i}closestEndTo(e){const{start:i,end:n}=this.planeLike;return Math.sign(rt(q(Gu,n,i),q(Du,e,i)))>0?this.end:this.start}getPlane(e=oe()){const i=se(jr,this.end);return i[2]+=1,pr(this.start,this.end,i,e)}getSlicePlane(e=oe()){const{start:i,end:n,type:s}=this.planeLike;if(s===ve.PLANE)return;const o=U(jr,i[0],i[1],0),r=U($r,n[0],n[1],0),l=Ee($r,r,o);return pi(o,l,e),e}}const Gu=L(),Du=L(),jr=g(),$r=g();class zu extends qr{constructor(e,i){super(e,i,ve.HALF_PLANE)}}class Uu extends xe{constructor(e,i){super(),this.sphere=Sh(e,i)}equals(e){return this===e||qe(e)&&Mh(this.sphere,e.sphere)}closestTo(e){const i=j();return Ph(this.sphere,e,i),i}get center(){return Ch(this.sphere)}get radius(){return this.sphere[3]}}class Hu extends xe{constructor(e,i,n){super(),this.start=e,this.end=i,this.getZ=n,this.planeLike={start:e,end:i,type:ve.PLANE}}equals(e){return this===e||on(e)&&z(this.start,e.start)&&z(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return Bu(this,e)}addIfOnTheGround(e,i){for(const n of i){const s=this.getZ(n[0],n[1])??0;R(n[2],s)&&(n[2]=s,e.push(n))}}}class ks extends xe{constructor(e,i,n){super(),this._x=e,this._y=i,this._z=n}equals(e){return this===e||rp(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,i,n]){return wr(this._x??e,this._y??i,this._z??n)}}class Kr extends xe{constructor(e,i,n,s,o){super(),this._origin=e,this._spatialReference=i,this._distanceMeters=n,this._z=s,this._directionDegrees=o}equals(e){return this===e||op(e)&&Xo(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,i,n]){return He(Ei,e,i),Xo(Ei,this._origin)||this._applyDirectionAndDistance(Ei),wr(Ei[0],Ei[1],this._z??n)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)ui(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Fu(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=Hi(Nu,this._origin,e,this._spatialReference);ui(e,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const Ei=[0,0],Nu=new Ni;function Fu(t,e,i,n,s){let{azimuth:o,distance:r}=Hi(Zu,e,n,s);o??=0;let l=r*Math.cos((o-i)*xh);l=Math.max(0,l),ui(t,e,i,l,s)}const Zu=new Ni;function Bu(t,e){const i=j();return Ir(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??ea,i}function Ye(t,e){if(As(t)){const i=[];for(const n of t.constraints){const s=n.intersect(e);s&&i.push(s)}return Si(i)}if(As(e))return Ye(e,t);if(on(t))return Qr(t,e);if(on(e))return Qr(e,t);if(be(t)){const{point:i}=t;if(be(e))return z(i,e.point)?t:void 0;const n=e.closestTo(i);return Gt(n,i)?t:void 0}if(Oe(t)){if(be(e))return Ye(e,t);if(Oe(e))return Me(zr(t.lineLike,e.lineLike));if(Xe(e))return Yu(t,e);if(Ie(e))return Me(Ar(e.planeLike,t.lineLike));if(Le(e))return Me(Dr(t.lineLike,e.center,e.radius));if(ft(e))return Me(Cu(t.lineLike,e));if(We(e))return Xu(t,e);if(qe(e))return Wu(t,e)}else if(Xe(t)){if(be(e)||Oe(e))return Ye(e,t);if(Xe(e))return qu(t,e);if(Ie(e))return ju(t,e);if(Le(e))return $u(t,e);if(ft(e))return Qu(t,e);if(We(e))return Ku(t,e);if(qe(e))return Ju(t,e)}else if(Ie(t)){if(be(e)||Oe(e)||Xe(e))return Ye(e,t);if(Ie(e))return Vs(Or(t.planeLike,e.planeLike));if(Le(e))return Vs(xs(t.planeLike,e.center,e.radius));if(ft(e))return tp(t,e);if(We(e))return ep(t,e);if(qe(e))return ip(t,e)}else if(Le(t)){if(be(e)||Oe(e)||Xe(e)||Ie(e))return Ye(e,t);if(Le(e))return Vs(bs(t.center,t.radius,e.center,e.radius));if(ft(e))return;if(We(e))return np(t,e);if(qe(e))return}else if(ft(t)){if(be(e)||Oe(e)||Xe(e)||Ie(e)||Le(e))return Ye(e,t);if(ft(e))return;if(We(e))return e.asCircle(),void 0;if(qe(e))return}else if(We(t)){if(be(e)||Oe(e)||Xe(e)||Ie(e)||Le(e)||ft(e))return Ye(e,t);if(We(e))return sp(e,t);if(qe(e))return}else if(qe(t)){if(be(e)||Oe(e)||Xe(e)||Ie(e)||Le(e)||We(e))return Ye(e,t);if(qe(e))return}}const Yu=(()=>{const t=oe();return(e,i)=>{const{start:n,end:s}=e;if(Ur(n,s)&&R(n[2],i.z))return e;const o=j();return rs(i.getPlane(t),n,s,o)?new Yt(o):void 0}})();function Xu({lineLike:t},{center:e,radius:i}){const n=e[2];return Me(Dr(t,e,i).filter(s=>R(s[2],n)))}function Wu({lineLike:t},{sphere:e}){return Me(Eh(e,t.start,t.end))}const Rs=(()=>{const t=cr(),e=g(),i=g();return(n,s,o)=>{const{normal:r,center:l,radius:h}=s;ur(r,e,i);const u=Ut(n),p=h*Z(u,e),d=h*Z(u,i);fh(t,l[0],l[1],l[2],1);const m=gh(n,t),f=Math.hypot(p,d),_=R(f,0);if(R(os(n,l),0)){if(_)return s;if(R(h,0))return!o||dt(o,l)?new Yt(Nt(l)):void 0;ke(e,u,r),ht(e,e);const W=new Array,me=ot(l);H(me,me,e,h),o&&!dt(o,me)||W.push(me);const le=ot(l);return H(le,le,e,-h),o&&!dt(o,le)||W.push(le),Me(W)}if(_)return;const y=-m/f;if(Math.abs(y)>1||R(y,1))return;const w=Math.atan(p/d),b=Wl(y)-w,S=Math.PI-b,I=new Array,K=g();H(K,l,e,h*Math.cos(b)),H(K,K,i,h*Math.sin(b)),I.push(K);const te=g();return H(te,l,e,h*Math.cos(S)),H(te,te,i,h*Math.sin(S)),I.push(te),Me(o?Ru(o,I):I)}})();function qu(t,e){return R(t.z,e.z)?t:void 0}function ju({z:t},{planeLike:e}){const[i,n]=e.start,[s,o]=e.end,r=ut(i,n,t),l=ut(s,o,t);return e.type===ve.PLANE?new Zr(r,l):new Iu(r,l)}function $u(t,e){const[i,n]=e.center;return new Ms(ut(i,n,t.z),e.radius)}function Ku(t,e){return R(e.center[2],t.z)?e:void 0}const Qu=(()=>{const t=oe();return(e,i)=>Rs(e.getPlane(t),i,i.slicePlane)})();function Ju(t,{center:e,radius:i}){const n=Math.abs(e[2]-t.z);if(n>i&&!R(n,i))return;const s=ut(e[0],e[1],t.z),o=Math.sqrt(i**2-n**2);return R(o,0)?void 0:new Ms(s,o)}const ep=(()=>{const t=oe();return(e,{center:i,radius:n})=>{const s=xs(e.planeLike,i,n),o=i[2];e.getSlicePlane(t);const r=new Array;for(const[l,h]of s){const u=[l,h,o];dt(t,u)&&r.push(u)}return Me(r)}})(),tp=(()=>{const t=oe(),e=oe();return(i,n)=>Rs(i.getPlane(t),n,i.getSlicePlane(e))})(),ip=(()=>{const t=oe();return(e,{center:i,radius:n})=>{const s=e.getPlane(t),o=zt(s,i),r=Math.abs(o);if(r>n&&!R(r,n))return;const l=Math.sqrt(n**2-o**2);if(R(l,0)){const p=j();return as(s,i,p),new Yt(p)}const h=j(),u=ot(Ut(s));return H(h,i,u,o),new Ps(h,l,u,e.getSlicePlane())}})();function np(t,e){const i=Di(t.center,e.center);return R(i,0)&&R(t.radius,e.radius)?e:Jr(bs(t.center,t.radius,e.center,e.radius),e.center[2])}function sp(t,e){if(!Ur(t.center,e.center))return;const i=Di(t.center,e.center);return R(i,0)&&R(t.radius,e.radius)?t:Jr(bs(t.center,t.radius,e.center,e.radius),t.center[2])}function Qr(t,e){const{planeLike:i,getZ:n}=t,s=new Array;if(be(e))t.addIfOnTheGround(s,Pu(i,e.point));else if(Oe(e))t.addIfOnTheGround(s,Ar(i,e.lineLike));else if(Le(e))for(const[o,r]of xs(i,e.center,e.radius)){const l=n(o,r);l!=null&&s.push(nt(o,r,l))}else if(Ie(e)||on(e))for(const[o,r]of Or(i,e.planeLike)){const l=n(o,r)??ea;s.push(nt(o,r,l))}return Me(s)}function Vs(t){return Si(t.map(([e,i])=>{const n=ut(e,i,0),s=ut(e,i,1);return new Zr(n,s)}))}function Me(t){return Si(t.map(e=>e?new Yt(e):void 0))}function Jr(t,e){return Me(t.map(([i,n])=>[i,n,e]))}function Si(t){if(t.length!==0)return t.length===1?t[0]??void 0:new Br(t.filter(ri))}function As(t){return t instanceof Br}function be(t){return t instanceof Yt}function Oe(t){return t instanceof Ss}function Xe(t){return t instanceof Xr}function Ie(t){return t instanceof qr}function Le(t){return t instanceof Yr}function We(t){return t instanceof Ms}function ft(t){return t instanceof Ps}function qe(t){return t instanceof Uu}function on(t){return t instanceof Hu}function op(t){return t instanceof Kr}function rp(t){return t instanceof ks}const ea=0;var O;function Os(t,e){if(t==null||e==null)return;const i=Is(t,e);return i!=null?Re(i,"radians","geographic"):void 0}(function(t){t.Absolute="absolute",t.Relative="relative",t.RelativeBilateral="relative-bilateral"})(O||(O={}));const Is=(()=>{const t=g(),e=g();return(i,n)=>(U(t,i.x,i.y,i.z??0),U(e,n.x,n.y,n.z??0),ap(t,e,i.spatialReference,n.spatialReference))})(),ap=(()=>{const t=L(),e=g(),i=g();return(n,s,o,r)=>{if(z(n,s))return;const l=Fi(o),h=Fi(r);if(l&&h&&kt(l,h)&&ye(n,o,e,l)&&ye(s,r,i,h)){const{azimuth:p}=Hi(up,e,i,l);return p!=null?Gi(p,"degrees","radians"):void 0}t[0]=s[0]-n[0],t[1]=s[1]-n[1];let u=bc(Cc,t);return t[0]<0&&(u=pp-u),u}})();function lp(t,e,i,n=O.Absolute){if(e&&i)switch(n){case O.Absolute:return Os(e,i);case O.Relative:return rn(ta(t,e,i),O.Relative);case O.RelativeBilateral:return rn(ta(t,e,i),O.RelativeBilateral)}}function ta(t,e,i){if(!t||!e||!i)return;const n=Is(t,e),s=Is(e,i);return n!=null&&s!=null?Re(s-n,"radians","geographic"):void 0}function rn(t,e){if(t!=null)switch(e){case O.Absolute:return Ls(t);case O.Relative:{const i=Pe(t);let n=ia.normalize(i,0,!0);return n===-180&&(n=180),Re(n,"degrees","geographic")}case O.RelativeBilateral:{const i=Pe(t),n=Math.abs(ia.normalize(i,0,!0));return Re(n,"degrees","geographic")}}}function Ls(t){const e=Pe(t),i=dp.normalize(e,0,!0);return Re(i,"degrees","geographic")}const cp=(()=>{const t=g();return(e,i,n,s,o,r="geodesic")=>{se(t,i);const l=Pe(o);if(r==="geodesic"){const f=Fi(n);if(f&&ye(t,n,t,f))return ui(e,t,l,s,f),e[2]=i[2],!!ye(e,f,e,n)}const h=lr(l,"geographic","arithmetic"),u=Gi(h,"degrees","radians"),p=i[0]+s*Math.cos(u),d=i[1]+s*Math.sin(u),m=i[2];return U(e,p,d,m),!0}})();function Pe(t){if(t!=null)return lr(hp(t),t.rotationType,"geographic")}function hp(t){return Gi(t.value,t.unit,"degrees")}const up=new Ni,pp=2*Math.PI,dp=fr,ia=new cs(-180,180);function fp(t,e,i,n,s,o){let r="geodesic",l=Fi(i);const h=j();return ds(t,e,n,h),h[2]=0,l&&ye(h,i,h,l)||(r="euclidean",l=i),{mode:r,view:e,elevationInfo:n,hasZ:s,directionMode:o,spatialReference:t.spatialReference,measurementSR:l,origin:h}}function gp(t,e,i){if(e==null||t==null)return;const n=Bn(i.measurementSR);if(n==null)return;const s=an(t,i);if(s==null)return;const o=Zi(e,n);return new Yr(s,o)}function mp(t,e,i,n){if(i==null||t==null)return;const s=an(t,n);if(s==null)return;const o=Pe(i),r=10,l=u=>{if(u==null)return;const p=j(),d=Re(u,"degrees","geographic");return cp(p,s,n.measurementSR,r,d,n.mode)?new zu(s,p):void 0},h=()=>{if(e!=null&&t!=null)return Pe(Os(e,t))};switch(n.directionMode){case O.Absolute:return l(o);case O.Relative:{const u=h();return u==null?void 0:l(u+o)}case O.RelativeBilateral:{const u=h();return u==null?void 0:Si([l(u+o),l(u-o)])}}}function na(t,e){const i=ln(t,e);return i!=null?new Xr(i):void 0}function sa(t,e,i){const{context:n,longitude:s,latitude:o,direction:r,distance:l,elevation:h}=i;if(s!=null||o!=null||l!=null||h!=null||r!=null){if(s!=null||o!=null){const u=Pe(s),p=Pe(o),d=ln(h,n);return new ks(u,p,d)}return yp(t,e,i)}}function yp(t,e,{context:i,direction:n,distance:s,elevation:o}){if(e==null)return na(o,i);const{view:r,elevationInfo:l,measurementSR:h}=i,u=ds(e,r,l);if(!h||!ye(u,e.spatialReference,ra,h))return;const[p,d]=ra,m=s!=null?Zi(s,"meters"):void 0,f=Pe(n),_=ln(o,i),y=b=>{const S=new Kr([p,d],h,m,_,b);return m==null||b==null||_==null&&i.hasZ?S:new Yt(S.closestTo(u))};if(f==null)return y(void 0);const w=()=>{if(t!=null&&e!=null)return Pe(Os(t,e))};switch(i.directionMode){case O.Absolute:return y(f);case O.Relative:{const b=w();return b==null?void 0:y(b+f)}case O.RelativeBilateral:{const b=w();return b==null?void 0:Si([y(b+f),y(b-f)])}}}function _p(t){return t.context.mode==="geodesic"?sa(null,null,t):oa(t)}function vp(t,e,i){const{context:n,x:s,y:o,distance:r,direction:l,elevation:h}=i;return n.mode==="geodesic"?sa(e,t,i):s!=null||o!=null?oa(i):xp([gp(t,r,n),mp(t,e,l,n),na(h,n)])}function oa({x:t,y:e,elevation:i,context:n}){cn.x=t?.value??0,cn.y=e?.value??0,cn.spatialReference=n.spatialReference;const s=an(cn,n,Tp);return new ks(t!=null&&s!=null?s[0]:void 0,e!=null&&s!=null?s[1]:void 0,ln(i,n))}function xp(t){let e;for(const i of t)i&&(e=e?.intersect(i)??i);return e}function an(t,e,i=j()){const{view:n,elevationInfo:s,measurementSR:o,origin:r,mode:l}=e;if(ds(t,n,s,i),ye(i,t.spatialReference,i,o))return l!=="geodesic"&&Ee(i,i,r),i}function bp(t,e,i,n){const{view:s,measurementSR:o,spatialReference:r,origin:l,mode:h}=i;if(h==="geodesic"?se(Mi,t):ue(Mi,t,l),ye(Mi,o,Mi,r))return Yh(Mi,s,e,i,n)}function ln(t,e){return wp(t,e)?.value??void 0}function wp(t,{view:e,origin:i,elevationInfo:n,hasZ:s,measurementSR:o}){if(t==null||!s)return;const r=Ro(o);if(r==null)return;const[l,h]=i,u=Zi(t,r),p=e?.type==="3d"?jo(e,l,h,u,o,n):u;return p!=null?pe(p,r):void 0}const ra=j(),Tp=j(),Mi=j(),cn=Jn(0,0,0,st.WGS84),Ep="z",Sp="r",aa={toggle:"Control"},Xt={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},Ge={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:or,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:Ep,redo:Sp};let Mp=class{constructor(){this._bindings=new Map}add(t,e){return this.addToggle(t,i=>{i.type==="key-down"&&e(i)})}addToggle(t,e){const i=Pp.fromDefinition(t,e),n=ql(this._bindings,i.key,()=>[]);return n.push(i),Y(()=>Vo(n,i))}register(t,e=rr.WIDGET){return So([t.on("key-down",i=>this.dispatch(t.inputManager,i),e),t.on("key-up",i=>this.dispatch(t.inputManager,i),e)])}dispatch(t,e){const i=e.key,n=this._bindings.get(i);if(n)for(const s of n)s.process(t,e)}},Pp=class wo{constructor(e,i,n,s,o){this.key=e,this.modifiers=i,this.repeats=n,this.continuePropagation=s,this.callback=o}process(e,i){if(!(i.key!==this.key||"repeat"in i&&i.repeat&&!this.repeats)){for(const n of this.modifiers)if(!e.isModifierKeyDown(n))return;this.continuePropagation||i.stopPropagation(),this.callback(i)}}static fromDefinition(e,i){if(typeof e=="string")return new wo(e,[],!1,!1,i);const{key:n,modifier:s,repeats:o,continuePropagation:r}=e;return new wo(n,s?Array.isArray(s)?s:[s]:[],!!o,!!r,i)}};const Q="esri-tooltip",Cp=`${Q}-content`,kp=`${Q}-content--input`,Rp=`${Q}-content__header`,Vp=`${Q}-content__header__spacer`,la=`${Q}-content__header__actions`,ca=`${Q}-draw-header-actions`,Ap=`${Q}-table`,Op=`${Q}-help-message`,Ip=`${Q}-help-message__text`,Lp=`${Q}-help-message__icon`,hn=`${Q}-field`,un={base:hn,inputMode:`${hn}--input`,title:`${hn}__title`,value:`${hn}__value`};let N=class extends gi{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return v("div",{class:this.classes({[un.base]:!0,[un.inputMode]:this.mode==="input"})},v("div",{class:un.title,key:"title"},this.title),v("div",{class:un.value,key:"value"},this.value))}};a([c()],N.prototype,"hidden",void 0),a([c()],N.prototype,"mode",void 0),a([c()],N.prototype,"title",void 0),a([c()],N.prototype,"value",void 0),N=a([x("esri.views.interactive.tooltip.components.TooltipField")],N);const Gp={base:`${Q}-value-by-value`};let je=class extends gi{constructor(){super(...arguments),this.divider="\xD7"}render(){return v("div",{class:Gp.base},v("span",null,this.left),v("span",null,this.divider),v("span",null,this.right))}};a([c()],je.prototype,"left",void 0),a([c()],je.prototype,"divider",void 0),a([c()],je.prototype,"right",void 0),je=a([x("esri.views.interactive.tooltip.components.ValueByValue")],je);function Gs(t){let e,i,n=[],s=!1;function o(...r){return s&&e===this&&Dp(r,n)||(i=t.apply(this,r),e=this,n=r,s=!0),i}return o}function Dp(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}function ha(t){const e="metric";if(t==null)return e;const i=t.map,n=(i&&"portalItem"in i?i.portalItem?.portal:null)??jl.getDefault();switch(n.user?.units??n.units){case e:return e;case"english":return"imperial"}return $l(t.spatialReference)??e}function Ds(t,e,i,n=2,s="abbr"){return Jc(t,Ne(e,i).value,i,n,s)}function ua(t,e,i,n=2,s="abbr"){return eh(t,Ne(e,i).value,i,n,s)}function zp(t,e,i=2,n="abbr"){return th(t,e.value,e.unit,i,n)}function Up(t,e,i=2,n="abbr"){return ih(t,e.value,e.unit,i,n)}function Hp(t,e,i=2,n="abbr"){return nh(t,e.value,e.unit,i,n)}function Np(t,e,i=2,n="abbr"){return sh(t,e.value,e.unit,i,n)}function Fp(t,e,i=2,n="abbr"){return oh(t,e.value,e.unit,i,n)}function Zp(t,e,i=2,n="abbr"){return rh(t,e.value,e.unit,i,n)}function Bp(t,e,i=2,n="abbr"){return ah(t,e.value,e.unit,i,n)}function Yp(t,e,i=2,n="abbr"){return lh(t,e.value,e.unit,i,n)}function Xp(t,e,i=2,n="abbr"){return ch(t,e.value,e.unit,i,n)}function Wp(t,e,i=2,n="abbr"){return hh(t,e.value,e.unit,i,n)}function pn(t,e,i,n=fr,s=!0){return Qc(t.value,t.unit,t.rotationType,e,i,n,s)}function pa(t,e,i,n,s="abbr"){switch(n=n??2,i){case"imperial":return Zp(t,e,n,s);case"metric":return zp(t,e,n,s);default:return Ds(t,e,i,n,s)}}function qp(t,e,i,n=2,s="abbr"){switch(i){case"imperial":return Bp(t,e,n,s);case"metric":return Up(t,e,n,s);default:return ua(t,e,i,n,s)}}function jp(t,e,i,n=2,s="abbr"){switch(i){case"imperial":return Yp(t,e,n,s);case"metric":return Hp(t,e,n,s);default:return Ds(t,e,i,n,s)}}function $p(t,e,i,n=2,s="abbr"){switch(i){case"imperial":return Xp(t,e,n,s);case"metric":return Np(t,e,n,s);default:return ua(t,e,i,n,s)}}function Kp(t,e,i,n=2,s="abbr"){switch(i){case"imperial":return Wp(t,e,n,s);case"metric":return Fp(t,e,n,s);default:return Ds(t,e,i,n,s)}}const dn=1,da=6;function Qp(t,e){return{angleRelative:Jp,direction:ed,directionRelative:td,directionRelativeBilateral:id,latitudeDecimalDegrees:sd,longitudeDecimalDegrees:nd,area:(i,n)=>Kp(t,i,n??e.area),length:(i,n,s)=>pa(t,i,n??e.length,s),lengthRelative:(i,n)=>qp(t,i,n??e.length),totalLength:(i,n)=>pa(t,i,n??e.length),verticalLength:(i,n)=>jp(t,i,n??e.verticalLength),verticalLengthRelative:(i,n)=>$p(t,i,n??e.verticalLength),percentage:ad,scalar:ma,scale:ld}}function Jp(t){return li(t,{signDisplay:"exceptZero",...zs(dn)})}function ed(t){return pn(t,t.rotationType,dn)}function td(t){const e=Pe(t);return li(e,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:e>0?"never":"exceptZero",...zs(dn)})}function id(t){return pn(t,t.rotationType,dn)}function nd(t){return fa(t,xa)}function sd(t){return fa(t,ba)}function od(t){return ga(t,xa)}function rd(t){return ga(t,ba)}function fa(t,e){return pn(Ne(t,"degrees"),"geographic",da,e,!1)}function ga(t,e){const i=e.normalize(Ne(t,"degrees").value,void 0,!1);return ma(Fe(i),da)}function ad(t){return li(t.value,{style:"percent"})}function ld(t){return li(t,{style:"percent",maximumFractionDigits:0})}function ma(t,e){return li(t.value,zs(e))}function zs(t){return{minimumFractionDigits:t,maximumFractionDigits:t}}function gt({createQuantity:t,sanitize:e}){return(i,n)=>{if(i==null)return null;e&&(i=e(i));const s=Vt(i);return s==null?null:t(s,n)}}function ya(t){return t.replaceAll(/[*^~]/g,"")}const cd=t=>{let e=`[-+]?[0-9${t.thousands}]+`;return t.decimal!==""&&(e+=`${t.decimal}[0-9]+`),new RegExp(`^(${e}\\s*)${t.separator}(\\s*${e})$`,"i")},hd="\u202F",_a=[];for(const t of[",","\\|","\\s+"])for(const e of["\\.",",",""])for(const i of["",",","\\.",hd,"\\s+"])t!==e&&t!==i&&e!==i&&_a.push({separator:t,decimal:e,thousands:i,pattern:cd({decimal:e,thousands:i,separator:t})});function ud(t){for(const{decimal:e,thousands:i,pattern:n}of _a){n.lastIndex=0;const s=t.match(n);if(!s)continue;const o=Vt(va(s[1],e,i)),r=Vt(va(s[2],e,i));if(o!=null&&r!=null)return{x:Fe(o),y:Fe(r)}}return null}function va(t,e,i){let n=t.replaceAll(/[\s+]/g,"");return i!==""&&(n=n.replaceAll(i,"")),e!==""&&(n=n.replaceAll(e,".")),n}function pd(t){if(!t||Vt(t)!=null||!ms())return null;const e=bi(t),i=Wt(e?.latitude),n=Wt(e?.longitude);return n!=null&&i!=null?{latitude:i,longitude:n}:null}function dd(t){return Wt(ru(t))}function fd(t){return Wt(au(t))}function Wt(t){return t!=null?Re(t,"degrees","geographic"):null}const xa=new cs(-180,180),ba=new cs(-90,90),Us=Symbol("dragHandles");let E=class extends gi{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=Gs(Qp),this._onHeaderPointerDown=t=>{const e=t.target;e instanceof HTMLElement&&e?.tagName?.toLowerCase()!=="calcite-button"&&(this.removeHandles(Us),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([ci(e,"pointermove",({clientX:i,clientY:n})=>{this.tooltip.onDrag(i,n)}),ci(e,["pointerup","pointercancel"],i=>{this.removeHandles(Us),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()}),ci(e,"touchstart",i=>i.preventDefault())],Us))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),e==="commit-and-exit")return void this.exitInputMode();if(e==="commit-on-blur")return;const i=this._getFocusableElements(),n=i.length,s=i.indexOf(t);if(s===-1)return void this.exitInputMode();const o=((s+(e==="commit-and-next"?1:-1))%n+n)%n;fn(i.at(o))},this._onKeyDown=t=>{switch(t.code){case Xt.next:return this._onNextKey(t);case Xt.discard:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=ha(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=l=>({unit:l,abbreviation:uh(t,l,"abbr")}),{inputUnits:i}=this.info.sketchOptions.values,n=ha(this.tooltip.view),s=i.length??n,o=i.verticalLength??n,r=i.area??n;return{length:e(Jl(s)),verticalLength:e(ec(o)),area:e(tc(r)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,i=this._renderedActions,n=this._renderedHelpMessage,s=e.length>0,o=s||!!n,r=this.mode==="input";return v("div",{class:Rh(Cp,r&&kp),onkeydown:this._onKeyDown,tabIndex:-1},r&&o&&t.header?v("div",{class:Rp,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},v("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),i.length>0?v(_e,null,v("div",{class:Vp,key:"spacer"}),v("div",{class:la,key:"actions"},i)):null):null,s?v("div",{class:Ap,key:"content"},...e):null,n)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return us({button:()=>import("./calcite-button-AOhLfZYI.js"),icon:()=>import("./calcite-icon-Cgh_RJp2.js"),input:()=>import("./calcite-input-zc7NthS1.js")})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(i){Ao(i)}}async exitInputMode({focusOnView:t=!0}={}){try{const{container:e,info:i}=this;i.clearInputValues();const n=t?e?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),n instanceof HTMLElement&&n.focus()}catch(e){Ao(e)}}_onNextKey(t){const e=this._getFocusableElements(),i=e.at(0),n=e.at(-1);i&&n&&(t.shiftKey?document.activeElement===i&&(t.preventDefault(),t.stopPropagation(),fn(n)):document.activeElement===n&&(t.preventDefault(),t.stopPropagation(),fn(i)))}get _renderedContent(){return wa(this._renderContent())}get _renderedActions(){return wa(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const i=t.tooltips.helpMessage??this._defaultHelpMessage;if(!i)return null;const n=t.tooltips.helpMessageIcon??"information";return v("div",{class:Op,key:"help-message"},n?v("calcite-icon",{class:Lp,icon:n,scale:"s"}):null,v("div",{class:Ip},i))}get _defaultHelpMessage(){const{helpMessage:t,viewType:e}=this.info;if(t==null)return null;const i=e==="3d"?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[i]?.[t]}async _focusField(t){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),Kl(e);const i=this._getFocusableInputs(),n=t?i.find(s=>s.getAttribute("data-field-name")===t):i.at(0);await fn(n)}async _transitionTo(t,e){if(this._mode===t&&!this._transitionInfo)return;if(this._transitionInfo?.mode===t)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const i=async()=>{this.destroyed||(this._mode=t,await Io(),this.destroyed||(this.renderNow(),await Io(),this.destroyed||e?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||qc())return void await i();this.autoRenderingEnabled=!1;const n=this._transitionInfo={transition:document.startViewTransition(async()=>{this.destroyed||n!==this._transitionInfo||(this.autoRenderingEnabled=!0,await i())}),mode:t};try{await n.transition.finished}finally{n===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;t().length===0;)await Ql(gd);await Oo()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const t=this.domNode?.querySelector(`.${ca}`);return[...Array.from(t?.querySelectorAll(`.${la} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function fn(t){await t?.setFocus()}function wa(t){return(Array.isArray(t)?t:[t]).flat(10).filter(e=>!!e)}a([hs("esri/core/t9n/Units"),c()],E.prototype,"_messagesUnits",void 0),a([hs("esri/views/interactive/tooltip/t9n/Tooltip"),c()],E.prototype,"_messagesTooltip",void 0),a([c()],E.prototype,"info",void 0),a([c()],E.prototype,"tooltip",void 0),a([c()],E.prototype,"_mode",void 0),a([c()],E.prototype,"mode",null),a([c()],E.prototype,"_displayUnits",null),a([c()],E.prototype,"_inputUnitInfos",null),a([c()],E.prototype,"_formatters",null),a([c()],E.prototype,"fieldContext",null),a([c()],E.prototype,"_renderedContent",null),a([c()],E.prototype,"_renderedActions",null),a([c()],E.prototype,"_renderedHelpMessage",null),a([c()],E.prototype,"_defaultHelpMessage",null),E=a([x("esri.views.interactive.tooltip.content.TooltipContent")],E);const gd=20;let Hs=class extends E{_renderContent(){const{area:t,radius:e,xSize:i,ySize:n,visibleElements:s}=this.info,o=this._messagesTooltip.sketch,r=this._formatters;return v(_e,null,s.radius&&e!=null?v(N,{title:o.radius,value:r.length(e)}):null,s.size&&i!=null&&n!=null?v(N,{title:o.size,value:v(je,{left:r.length(i),right:r.length(n)})}):null,s.area?v(N,{title:o.area,value:r.area(t)}):null)}};Hs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],Hs);const fe=`${Q}-editable-field`,re={base:fe,inputMode:`${fe}--input`,feedbackMode:`${fe}--feedback`,readOnly:`${fe}--read-only`,locked:`${fe}--locked`,title:`${fe}__title`,value:`${fe}__value`,valueContent:`${fe}__value__content`,valueContentReadOnly:`${fe}__value__content--read-only`,lockIcon:`${fe}__lock-icon`,input:`${fe}__input`,inputSuffix:`${fe}__input-suffix`,button:`${fe}__button`},Ns={lock:"lock",unlock:"unlock"};let we=class extends gi{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===Xt.discard&&this.mode==="input"&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case Xt.commit:return this.field.onCommit("commit-and-exit",e,this.context);case Xt.next:{t.preventDefault(),t.stopPropagation();const i=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(i,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.target.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),Oo().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{const e=t.clipboardData?.getData("text");e&&this.field.parse(e,this.context)!=null&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{(t.inputType==="historyUndo"||t.inputType==="historyRedo")&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles(D(()=>this._rawDisplayValue,()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()}))}loadDependencies(){return us({button:()=>import("./calcite-button-AOhLfZYI.js"),icon:()=>import("./calcite-icon-Cgh_RJp2.js"),input:()=>import("./calcite-input-zc7NthS1.js")})}render(){const{field:t,mode:e}=this,i=e==="input",{locked:n,readOnly:s}=t;return v("div",{class:this.classes({[re.base]:!0,[re.feedbackMode]:e==="feedback",[re.inputMode]:e==="input",[re.locked]:n,[re.readOnly]:s})},v("div",{class:re.title,key:"title"},this._title),v("div",{class:re.value,key:"value",onkeydown:this._onKeyDown},i?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||Ta}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return typeof t=="string"?t:t(this.context)}_renderValueFeedbackMode(){return v(_e,null,v("div",{class:re.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&this.mode!=="input"?v("calcite-icon",{class:re.lockIcon,icon:Ns.lock,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return v("div",{class:this.classes(re.valueContent,re.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:t}=this,{name:e,invalid:i,locked:n}=t,s=this.context?.messages.sketch??{},o=n?s.unlockConstraint:s.lockConstraint;return v(_e,null,v("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:re.input,"data-field-name":e,"data-testid":`tooltip-field-${e}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:i?"invalid":"idle",type:"text",value:this._rawDisplayValue??Ta,onCalciteInputInput:this._onInput}),v("div",{class:re.inputSuffix,key:"suffix"},this._suffix),t.lockable?v("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:re.button,"data-testid":`tooltip-field-${e}-lock`,iconStart:n?Ns.lock:Ns.unlock,key:"lock",kind:"neutral",label:o,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:o}):v("div",{key:"lock-empty"}))}};a([c()],we.prototype,"field",void 0),a([c()],we.prototype,"context",void 0),a([c()],we.prototype,"mode",void 0),a([c()],we.prototype,"_input",void 0),a([c()],we.prototype,"_lock",void 0),a([c()],we.prototype,"_formattedValue",null),a([c()],we.prototype,"_rawDisplayValue",null),a([c()],we.prototype,"_suffix",null),a([c()],we.prototype,"_title",null),we=a([x("esri.views.interactive.tooltip.components.TooltipEditableField")],we);const Ta="\u2014";function $e(t){const e=t.fields.filter(i=>i?.visible===!0);return e.length===0?null:v(_e,null,e.map(i=>v(we,{context:t.context,field:i,key:i.id,mode:t.mode})))}let Fs=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return v($e,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0,n.orientation?e.orientation:void 0,n.scale?e.scale:void 0],mode:i})}};Fs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],Fs);let Zs=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{elevation:n,visibleElements:s}=e;return v($e,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?n:void 0],mode:i})}};Zs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],Zs);const Bs={absolute:"absolute-direction",relative:"relative-direction"};let Mt=class extends gi{constructor(t){super(t),this.visibleElements={}}render(){return v("div",{class:ca},this._isElementVisible("direction")?v(md,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return us({button:()=>import("./calcite-button-AOhLfZYI.js"),dropdown:()=>import("./calcite-dropdown-pc_2IJkP.js"),"dropdown-item":()=>import("./calcite-dropdown-item-B9XCYpny.js"),"dropdown-group":()=>import("./calcite-dropdown-group-DG7gFIue.js")})}_isElementVisible(t){return this.visibleElements?.[t]??this.sketchOptions.tooltips.visibleElements[t]}};function md(t){const{directionMode:e}=t.sketchOptions.values,i=t.messages?.sketch,n=i?.directionModeSelect?.title,s="absolute",o="relative";return v("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:r=>{const l=r.target.selectedItems?.[0]?.getAttribute("data-mode");t.sketchOptions.values.directionMode=l??"absolute"}},v("calcite-button",{alignment:"end",appearance:"transparent",iconStart:Bs[e],kind:"neutral",label:n,scale:"s",slot:"trigger",title:n}),v("calcite-dropdown-group",{selectionMode:"single"},v("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-relative",iconStart:Bs.relative,key:"relative",selected:e===o},i?.directionModeSelect?.relative),v("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-absolute",iconStart:Bs.absolute,key:"absolute",selected:e===s},i?.directionModeSelect?.absolute)))}a([hs("esri/views/interactive/tooltip/t9n/Tooltip"),c()],Mt.prototype,"messages",void 0),a([c()],Mt.prototype,"sketchOptions",void 0),a([c()],Mt.prototype,"visibleElements",void 0),Mt=a([x("esri.views.interactive.tooltip.components.DrawHeaderActions")],Mt);let Ys=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{xyMode:n,visibleElements:s}=e;return v($e,{context:t,fields:[...n==="direction-distance"?[s.direction?e.direction:void 0,s.distance?e.distance:void 0]:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0],s.elevation?e.elevation:void 0,s.area?e.area:void 0],mode:i})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return v(Mt,{sketchOptions:e,visibleElements:{direction:t==="direction-distance"}})}};Ys=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],Ys);let Xs=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{xyMode:n,visibleElements:s}=e;return v($e,{context:t,fields:[...n==="direction-distance"?[s.direction?e.direction:void 0,s.distance?e.distance:void 0]:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0],s.elevation?e.elevation:void 0,s.totalLength?e.totalLength:void 0],mode:i})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return v(Mt,{sketchOptions:e,visibleElements:{direction:t==="direction-distance"}})}};Xs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],Xs);let Ws=class extends E{_renderContent(){const{area:t,xSize:e,ySize:i,visibleElements:n}=this.info,s=this._messagesTooltip.sketch,o=this._formatters;return v(_e,null,n.size&&e!=null&&i!=null?v(N,{title:s.size,value:v(je,{left:o.length(e),right:o.length(i)})}):null,n.area?v(N,{title:s.area,value:o.area(t)}):null)}};Ws=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],Ws);let qs=class extends E{_renderContent(){const{angle:t,visibleElements:e}=this.info,i=this._messagesTooltip.sketch;return v(_e,null,e.rotation?v(N,{title:i.rotation,value:this._formatters.angleRelative(t)}):null)}};qs=a([x("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],qs);let js=class extends E{_renderContent(){const t=this.info,{visibleElements:e}=t,i=this._messagesTooltip.sketch,n=this._formatters;return v(_e,null,e.size?v(N,{title:i.size,value:v(je,{left:n.length(t.xSize),right:n.length(t.ySize)})}):null,e.scale?v(N,{title:i.scale,value:v(je,{left:n.scale(t.xScale),right:n.scale(t.yScale)})}):null)}};js=a([x("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],js);let $s=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return v($e,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0],mode:i})}};$s=a([x("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],$s);let Ks=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return v($e,{context:t,fields:[n.distance?e.distance:void 0,n.area?e.area:void 0,n.totalLength?e.totalLength:void 0],mode:i})}};Ks=a([x("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],Ks);let Qs=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return v($e,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0,n.area&&e.geometryType==="polygon"?e.area:null,n.totalLength&&e.geometryType==="polyline"?e.totalLength:null],mode:i})}};Qs=a([x("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],Qs);let Js=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return v($e,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0,n.orientation?e.orientation:void 0,n.scale?e.scale:void 0],mode:i})}};Js=a([x("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],Js);let eo=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return v($e,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0,n.orientation?e.orientation:void 0,n.size?e.size:void 0],mode:i})}};eo=a([x("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],eo);let to=class extends E{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch,n=this._formatters;return v(_e,null,e.distance?v(N,{title:i.distance,value:n.length(t.distance)}):null)}};to=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslate")],to);let io=class extends E{_renderContent(){const{distance:t,elevation:e,area:i,totalLength:n,visibleElements:s}=this.info,o=this._messagesTooltip.sketch,r=this._formatters;return v(_e,null,s.distance?v(N,{title:o.distance,value:r.length(t)}):null,s.elevation&&e?.actual!=null?v(N,{title:o.elevation,value:r.verticalLength(e.actual)}):null,s.area&&i!=null?v(N,{title:o.area,value:r.area(i)}):null,s.totalLength&&n!=null?v(N,{title:o.totalLength,value:r.length(n)}):null)}};io=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],io);let no=class extends E{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch,n=this._formatters;return v(_e,null,e.distance?v(N,{title:i.distance,value:n.length(t.distance)}):null)}};no=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],no);let so=class extends E{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch;return v(_e,null,e.distance?v(N,{title:i.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};so=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],so);function yd(t,e){if(e==null)return null;const i=document.createElement("div");switch(e.type){case"draw-point":return new Zs({tooltip:t,info:e,container:i});case"draw-polygon":return new Ys({tooltip:t,info:e,container:i});case"draw-polyline":return new Xs({tooltip:t,info:e,container:i});case"draw-mesh":return new Fs({tooltip:t,info:e,container:i});case"draw-rectangle":return new Ws({tooltip:t,info:e,container:i});case"draw-circle":return new Hs({tooltip:t,info:e,container:i});case"extent-rotate":return new qs({tooltip:t,info:e,container:i});case"extent-scale":return new js({tooltip:t,info:e,container:i});case"move-point":return new $s({tooltip:t,info:e,container:i});case"selected-vertex":return new Qs({tooltip:t,info:e,container:i});case"transform-point":return new eo({tooltip:t,info:e,container:i});case"transform-mesh":return new Js({tooltip:t,info:e,container:i});case"translate":return new to({tooltip:t,info:e,container:i});case"translate-vertex":return new io({tooltip:t,info:e,container:i});case"translate-z":return new so({tooltip:t,info:e,container:i});case"translate-xy":return new no({tooltip:t,info:e,container:i});case"reshape-edge-offset":return new Ks({tooltip:t,info:e,container:i})}}const Pi={base:`${Q}`,ltr:`${Q}--ltr`,rtl:`${Q}--rtl`,debug:`${Q}--debug`},_d=20,vd=16,xd="bottom-end";let B=class extends bt.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([D(()=>this.view.overlay?.surface,e=>{t.remove(),e?.appendChild(t),this._rtl=Vh(e)},wt),D(()=>this.info,(e,i)=>{if(this.content!=null&&e!=null&&i!=null&&e.type===i.type)this.content.info=e;else{ce(this.content);const n=yd(this,e);n?(this.content=n,n.container&&t.appendChild(n.container),this.exitInputMode()):this.content=null}},wt),D(()=>({container:this.outerContainer,style:this._outerContainerStyle}),({container:e,style:i})=>{Object.assign(e.style,i)},Yn),D(()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug}),({outerContainer:e,placement:i,effectiveOffset:n,rtl:s,debug:o})=>{const{classList:r}=e;r.add(Pi.base),r.toggle(Pi.rtl,s),r.toggle(Pi.ltr,!s),r.toggle(Pi.debug,o),this.outerContainer.style.setProperty("--offset",`${n}px`),Ah(e),Td(e,i)},Yn),ic(()=>this.mode==="feedback",()=>{this.position=null,this._clearOverride("effectivePlacement")},Xn),ci(this.outerContainer,"paste",e=>{this.emit("paste",e)}),ci(this.outerContainer,["focusin","focusout"],()=>{setTimeout(()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1})})])}destroy(){this.info=null,this.content=ce(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return this._outerContainerStyle.display!=="none"}get contentContainer(){return this.content?.container}get effectivePlacement(){const t=this.options?.placement;return t==="auto"?"bottom-end":t??xd}get _screenPoint(){const{inputManager:t}=this.view;return t?.multiTouchActive?null:t?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??_d}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=Lo(t),t!=null&&this.content!=null?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){const e=this.position??this._lastPosition??this._screenPoint,i=this.position=Lo(e),{effectivePlacement:n}=this;this._override("effectivePlacement",n);const s=()=>{i&&(this.position=bd(this.contentContainer,i,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))};await this.content?.enterInputMode(t,s)}async exitInputMode(t){await this.content?.exitInputMode(t)}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const i=t-this._prevXY[0],n=e-this._prevXY[1];this._prevXY=[t,e];const{position:s}=this;if(s){const{view:o}=this,r=t-o.position[0],l=e-o.position[1];if(r<0||r>o.width||l<0||l>o.height-vd)return;this.position=Wn(s.x+i,s.y+n)}}onDragEnd(){this._prevXY=[0,0]}};function bd(t,e,i,n){if(!t||!n.container)return e;const s=t.getBoundingClientRect(),{left:o,top:r}=n.container.getBoundingClientRect();let{x:l,y:h}=e;const u=s.left-o-i;u<0&&(l-=u);const p=s.right-o+i-n.width;p>0&&(l-=p);const d=s.top-r-i;d<0&&(h-=d);const m=s.bottom-r+i-n.height;return m>0&&(h-=m),Wn(l,h)}a([c({nonNullable:!0})],B.prototype,"view",void 0),a([c()],B.prototype,"info",void 0),a([c()],B.prototype,"options",void 0),a([c()],B.prototype,"position",void 0),a([c()],B.prototype,"content",void 0),a([c({readOnly:!0})],B.prototype,"mode",null),a([c()],B.prototype,"_focused",void 0),a([c({readOnly:!0})],B.prototype,"focused",null),a([c({readOnly:!0})],B.prototype,"outerContainer",void 0),a([c({readOnly:!0})],B.prototype,"contentContainer",null),a([c({readOnly:!0})],B.prototype,"effectivePlacement",null),a([c()],B.prototype,"debug",void 0),a([c()],B.prototype,"_lastPosition",void 0),a([c()],B.prototype,"_screenPoint",null),a([c()],B.prototype,"_rtl",void 0),a([c()],B.prototype,"_effectiveOffset",null),a([c()],B.prototype,"_outerContainerStyle",null),B=a([x("esri.views.interactive.Tooltip")],B);const wd=["top","bottom","leading","trailing"].flatMap(t=>[gn(`${t}-start`),gn(t),gn(`${t}-end`)]);function gn(t){return`${Pi.base}--${t}`}function Td({classList:t},e){wd.forEach(i=>t.remove(i)),t.add(gn(e))}const Ed=B;function Sd(t){const e=new Ed(t());return e.addHandles(D(()=>t(),({view:i,options:n,info:s})=>{e.view=i,n!==void 0&&(e.options=n),s!==void 0&&(e.info=s)})),e}function Md(t,e){const i=kh(e.vertexSpace),{scale:n,orientation:s}=t,{transform:o}=e,r=Pd(o);i&&r!=null?(s.actual=Re(r,"degrees","arithmetic"),s.visible=!0):(s.actual=null,s.visible=!1),i?(n.actual=Fe(Rd(o)),n.visible=!0):(n.actual=null,n.visible=!1)}function Pd(t){if(!t)return 0;const e=Cd(t.rotationAxis);return e!=null?e*t.rotationAngle:null}function Cd(t){return Gt(t,Zn)?1:Gt(t,kd)?-1:null}const kd=ts(g(),Zn);function Rd(t){return t?Math.max(...t.scale):1}function Vd(t,e){return!(t.type!=="key-down"||t.key!==Xt.enterInputMode||!e||!Ad(e.info))&&(e.enterInputMode(),t.preventDefault(),t.stopPropagation(),!0)}function Ad(t){const e=t?.sketchOptions;if(!e)return!1;const{inputEnabled:i,visibleElements:n}=e.tooltips;return i&&t.editableFields.some(({name:s})=>s==="x"||s==="y"?n.coordinates:n[s])===!0}function Od(t,e,i){if(!e||!("geographic"in e))return;const n=t.clipboardData?.getData("text");if(!n)return;const s=o=>{t.stopPropagation(),t.preventDefault(),o()};if(e.geographic){const o=pd(n);o&&s(()=>{e.longitude.applyValue(o.longitude),e.latitude.applyValue(o.latitude)})}else{const o=ud(n);o&&s(()=>{e.x.applyValue(o.x),e.y.applyValue(o.y)})}}let ae=class extends J{constructor(t){super(t),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter(t=>t.visible&&!t.readOnly)}clearInputValues(){this.allFields.forEach(t=>t.clearInputValue())}};a([c()],ae.prototype,"sketchOptions",void 0),a([c()],ae.prototype,"visibleElements",null),a([c()],ae.prototype,"helpMessage",void 0),a([c()],ae.prototype,"viewType",void 0),a([c()],ae.prototype,"allFields",null),a([c()],ae.prototype,"editableFields",null),ae=a([x("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],ae);let Ke=class extends ae{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=Dt}get allFields(){return[]}};a([c()],Ke.prototype,"type",void 0),a([c()],Ke.prototype,"radius",void 0),a([c()],Ke.prototype,"xSize",void 0),a([c()],Ke.prototype,"ySize",void 0),a([c()],Ke.prototype,"area",void 0),a([c()],Ke.prototype,"allFields",null),Ke=a([x("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],Ke);let P=class extends J{constructor(t){super(t),this.actual=null,this.lockable=!0,this.id=Oh(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(t){this.lockable&&this._set("committed",t)}get dirty(){return this.inputValue!=null}get locked(){return this.lockable&&this.committed!=null}onInput(t){this.inputValue=t}onCommit(t,e,i){this.lockable?this._onCommitLockable(t,i):this._onCommitNonLockable(i),this.invalid&&t==="commit-and-exit"||i.onCommit(e,t)}_onCommitLockable(t,e){const{inputValue:i,locked:n}=this;n&&mn(i)?this.unlock():(t==="commit-and-exit"&&!n||i!=null)&&this._parseInputAndLock(e)}_onCommitNonLockable(t){const{inputValue:e}=this;mn(e)?this.setActual(null):e!=null&&this._parseInputAndSetActual(t)}applyValue(t){this.lockable?this.lock(t):this.setActual(t)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(t){this.actual=t,this.clearInputValue()}lock(t){this.lockable&&(this.committed=t??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(t){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(t))}getSuffix(t){const{suffix:e}=this;return typeof e=="function"?e(t):e}getFormattedValue(t){const{actual:e,committed:i,format:n}=this;return i!=null?n(i,t):e!=null?n(e,t):null}getRawDisplayValue(t){const{actual:e,committed:i,inputValue:n}=this;return n??(this.lockable&&i!=null?this.formatForInputMode(i,t):e!=null?this.formatForInputMode(e,t):null)}_parseInputAndSetActual(t){const{inputValue:e}=this;if(e==null||mn(e))return this.setActual(null);const i=this.parse(e,t);i!=null?this.setActual(i):this.invalid=!0}_parseInputAndLock(t){const{inputValue:e,actual:i}=this;if(mn(e))return this.unlock();if(e==null)return this.lock(i);const n=this.parse(e,t);n!=null?this.lock(n):this.invalid=!0}};function mn(t){return t!=null&&t.trim()===""}a([c()],P.prototype,"actual",void 0),a([c()],P.prototype,"committed",null),a([c()],P.prototype,"dirty",null),a([c()],P.prototype,"format",void 0),a([c()],P.prototype,"formatForInputMode",void 0),a([c()],P.prototype,"lockable",void 0),a([c()],P.prototype,"locked",null),a([c()],P.prototype,"id",void 0),a([c()],P.prototype,"inputValue",void 0),a([c()],P.prototype,"name",void 0),a([c()],P.prototype,"parse",void 0),a([c()],P.prototype,"readOnly",void 0),a([c()],P.prototype,"suffix",void 0),a([c()],P.prototype,"title",void 0),a([c()],P.prototype,"visible",void 0),a([c()],P.prototype,"invalid",void 0),a([c()],P.prototype,"unlockOnVertexPlacement",void 0),P=a([x("esri.views.interactive.tooltip.fields.TooltipField")],P);let yn=class extends P{constructor(t){super(t),this.showAsZ=!1}normalizeCtorArgs(t){const e=i=>i.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:Ze,parse:gt({createQuantity:(i,n)=>pe(i,e(n))}),format:(i,n)=>n.formatters.verticalLength(i),formatForInputMode:(i,n)=>n.formatters.scalar(Ne(i,e(n))),suffix:i=>i.inputUnitInfos.verticalLength.abbreviation,title:i=>i.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...t}}};a([c()],yn.prototype,"showAsZ",void 0),yn=a([x("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],yn);let _n=class extends P{constructor(t){super(t),this.precision=1}normalizeCtorArgs(t){const e=i=>i.inputUnitInfos.angle.unit;return{name:"orientation",actual:null,parse:gt({createQuantity:(i,n)=>Re(i,e(n),"geographic"),sanitize:ya}),format:i=>{const n=Ls(i);return pn(n,"geographic",this.precision)},formatForInputMode:(i,n)=>{const s=Ls(i);return n.formatters.scalar(s)},suffix:i=>i.inputUnitInfos.angle.abbreviation,title:i=>i.messages.sketch.orientation,...t}}};a([c()],_n.prototype,"precision",void 0),_n=a([x("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],_n);let oo=class extends P{constructor(t){super(t),this.precision=null}normalizeCtorArgs(t){const e=i=>i.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:gt({createQuantity:(i,n)=>pe(i,e(n))}),format:(i,n)=>n.formatters.length(i),formatForInputMode:(i,n)=>n.formatters.scalar(Ne(i,e(n))),suffix:i=>i.inputUnitInfos.length.abbreviation,title:i=>i.messages.sketch.size,...t}}};a([c()],oo.prototype,"precision",void 0),oo=a([x("esri.views.interactive.tooltip.fields.TooltipFieldSize")],oo);function Ea(t){const e=n=>n.inputUnitInfos.angle.unit,i=n=>n.sketchOptions.values.effectiveDirectionMode;return new P({name:"direction",actual:ns,parse:gt({createQuantity:(n,s)=>Re(n,e(s),"geographic"),sanitize:ya}),format:(n,s)=>{const o=i(s),r=rn(n,o);switch(o){case O.Absolute:return s.formatters.direction(r);case O.Relative:return s.formatters.directionRelative(r);case O.RelativeBilateral:return s.formatters.directionRelativeBilateral(r)}},formatForInputMode:(n,s)=>{const o=rn(n,i(s));return s.formatters.scalar(Ne(o,e(s)))},suffix:n=>n.inputUnitInfos.angle.abbreviation,title:n=>{const s=i(n),{absolute:o,relative:r}=n.messages.sketch.direction;switch(s){case O.Absolute:return o;case O.Relative:case O.RelativeBilateral:return r}},...t})}function Sa(t){const e=i=>i.inputUnitInfos.length.unit;return new P({name:"distance",actual:Ze,parse:gt({createQuantity:(i,n)=>pe(Math.max(i,0),e(n))}),format:(i,n)=>n.formatters.length(i),formatForInputMode:(i,n)=>n.formatters.scalar(Ne(i,e(n))),suffix:i=>i.inputUnitInfos.length.abbreviation,title:i=>i.messages.sketch.distance,...t})}function Id(t){return Sa({format:(e,i)=>i.formatters.totalLength(e),title:e=>e.messages.sketch.totalLength,readOnly:!0,...t})}function Ma(t){return Sa({...t})}function Ld(t){return new yn(t)}function Gd(t){return new _n(t)}function Dd(t){return ro("scale",{name:"scale",actual:null,parse:gt({createQuantity:e=>Fe(Math.abs(e))}),...t})}function zd(t){const e=i=>i.inputUnitInfos.area.unit;return new P({name:"area",actual:Dt,parse:gt({createQuantity:(i,n)=>Bi(i,e(n))}),format:(i,n)=>n.formatters.area(i),formatForInputMode:(i,n)=>n.formatters.scalar(Ne(i,e(n))),suffix:i=>i.inputUnitInfos.area.abbreviation,title:i=>i.messages.sketch.area,readOnly:!0,...t})}function Ud(t){return new P({name:"x",actual:ns,parse:dd,format:(e,i)=>i.formatters.longitudeDecimalDegrees(e),formatForInputMode:e=>od(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.longitude,...t})}function Hd(t){return new P({name:"y",actual:ns,parse:fd,format:(e,i)=>i.formatters.latitudeDecimalDegrees(e),formatForInputMode:e=>rd(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.latitude,...t})}function Nd(t){return ro("x",{name:"x",...t})}function Fd(t){return ro("y",{name:"y",...t})}function ro(t,e){return new P({actual:Fe(0),parse:gt({createQuantity:i=>Fe(i)}),format:(i,n)=>n.formatters.scalar(i),formatForInputMode:(i,n)=>n.formatters.scalar(i),title:i=>i.messages.sketch[t],...e})}function Zd(t){return ir(t)||qn(t)}function ao(t,e,i,...n){return ir(t)?e.apply(void 0,n):qn(t)?i.apply(void 0,n):null}const vn=t=>{let e=class extends t{constructor(){super(...arguments),this.longitude=Ud(),this.latitude=Hd(),this.x=Nd(),this.y=Fd(),this.elevation=Ld(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(i,n=i?.spatialReference){if(this.geographic=!!n&&Zd(n),i==null)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const s=nc(i,Bd);this._setActualLonLat(Wt(s?.[0]),Wt(s?.[1]))}else this._setActualXY(Fe(i.x),Fe(i.y))}_setActualLonLat(i,n){this.longitude.actual=i,this.latitude.actual=n}_setActualXY(i,n){this.x.actual=i,this.y.actual=n}};return a([c()],e.prototype,"geographic",void 0),a([c()],e.prototype,"effectiveX",null),a([c()],e.prototype,"effectiveY",null),a([c()],e.prototype,"key",null),e=a([x("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],e),e},Bd=[0,0];let Ci=class extends vn(ae){constructor(t){super(t),this.type="draw-mesh",this.orientation=Gd({lockable:!1}),this.scale=Dd({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};a([c()],Ci.prototype,"helpMessage",void 0),a([c()],Ci.prototype,"allFields",null),Ci=a([x("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],Ci);let ki=class extends vn(ae){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([c()],ki.prototype,"helpMessage",void 0),a([c()],ki.prototype,"allFields",null),ki=a([x("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],ki);let qt=class extends vn(ae){constructor(t){super(t),this.type="draw-polygon",this.direction=Ea(),this.distance=Ma(),this.area=zd(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};a([c()],qt.prototype,"xyMode",void 0),a([c()],qt.prototype,"helpMessage",void 0),a([c()],qt.prototype,"allFields",null),qt=a([x("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],qt);let jt=class extends vn(ae){constructor(t){super(t),this.type="draw-polyline",this.direction=Ea(),this.distance=Ma(),this.totalLength=Id(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};a([c()],jt.prototype,"helpMessage",void 0),a([c()],jt.prototype,"xyMode",void 0),a([c()],jt.prototype,"allFields",null),jt=a([x("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],jt);let mt=class extends ae{constructor(t){super(t),this.type="draw-rectangle",this.xSize=Ze,this.ySize=Ze,this.area=Dt}get allFields(){return[]}};a([c()],mt.prototype,"type",void 0),a([c()],mt.prototype,"xSize",void 0),a([c()],mt.prototype,"ySize",void 0),a([c()],mt.prototype,"area",void 0),a([c()],mt.prototype,"allFields",null),mt=a([x("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],mt);function lo(t){return sc(t)?oc(t)||qn(t)||rc(t)||ac(t)?Gh:t:Dh(t)}function Yd(t,e=co()){return Xd(t,e,!1)}function Xd(t,e,i=t.hasZ){const n=lo(t.spatialReference),s=lc(n);if(s==null)return null;const o=(l,h)=>!(h.length<2)&&(U(l,h[0],h[1],i&&h[2]||0),!0);let r=0;for(const l of t.rings){const h=l.length;if(h<3)continue;const{positionsWorldCoords:u}=e;for(;u.length<h;)u.push(g());const p=Wd,d=U(qd,0,0,0),m=1/h;for(let y=0;y<h;y++){if(!o(p,l[y])||!ye(p,t.spatialReference,u[y],n))return null;H(d,d,u[y],m)}const f=pr(u[0],u[1],d,bh());if(Qo(Ut(f))===0)continue;for(let y=0;y<h;y++)wh(f,d,u[y],u[y]);const _=jd(u);for(let y=0;y<_.length;y+=3)r+=Lh(u[_[y]],u[_[y+1]],u[_[y+2]])}return Bi(r,s)}const Wd=g(),qd=g();function co(){return{positionsWorldCoords:[]}}function jd(t){return Ih($d(t),[],2)}function $d(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const n=t[i],s=2*i;e[s]=n[0],e[s+1]=n[1]}return e}function Kd(t){const{spatialReference:e}=t;return ao(e,Qd,Jd,t)}function Qd(t){return Bi(Math.abs(Nc([t],"square-meters")[0]),"square-meters")}function Jd(t){try{return Bi(Math.abs(Yc(t,"square-meters")),"square-meters")}catch{return null}}function ef(t,e,i=co()){return Kd(t)??Yd(t,i)}function Pa(t,e=co()){return ef(t,"on-the-ground",e)}var Qe;function tf(t){return nf(t,Qe.Horizontal)}function nf(t,e){const{hasZ:i,spatialReference:n}=t,s=lo(n);let o=0;const r=Bn(s);if(r==null)return null;const l=e===Qe.Direct?rf:ka;for(const h of t.paths){if(h.length<2)continue;const u=h.length-1;for(let p=0;p<u;++p){const d=h[p];yt[0]=d[0],yt[1]=d[1],yt[2]=i?d[2]:0;const m=h[p+1];_t[0]=m[0],_t[1]=m[1],_t[2]=i?m[2]:0;const f=l(yt,_t,n);if(f==null)return null;o+=f.value}}return pe(o,r)}function sf(t,e){const{spatialReference:i}=t;return kt(i,e.spatialReference)?(yt[0]=t.x,yt[1]=t.y,yt[2]=t.hasZ?t.z:0,_t[0]=e.x,_t[1]=e.y,_t[2]=e.hasZ?e.z:0,ka(yt,_t,i)):null}function of(t){return t!=null?Ca(t.hasZ?t.z:0,t.spatialReference):null}function Ca(t,e){const i=Ro(e);return i!=null?pe(t??0,i):null}function rf(t,e,i){const n=Ra(t,e,i,Qe.Direct);return n!=null?pe(n.direct,n.unit):null}function ka(t,e,i){const n=Ra(t,e,i,Qe.Horizontal);return n!=null?pe(n.horizontal,n.unit):null}function Ra(t,e,i,n){const s=lo(i),o=Bn(s);if(o==null)return null;const r=e[2]-t[2];if(n===Qe.Vertical)return{verticalSigned:r,unit:o};if(!ye(t,i,ho,s)||!ye(e,i,xn,s))return null;if(n===Qe.Direct)return{direct:lt(xn,ho),unit:o};if(U(bn,t[0],t[1],e[2]),!ye(bn,i,bn,s))return null;const l=lt(bn,xn);return n===Qe.Horizontal?{horizontal:l,unit:o}:{direct:lt(xn,ho),horizontal:l,vertical:Math.abs(r),unit:o}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(Qe||(Qe={}));const yt=g(),_t=g(),ho=g(),xn=g(),bn=g();function af(t){const{spatialReference:e}=t;return ao(e,pf,df,t)}function lf(t,e){if(!kt(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return wn[0]=t.x,wn[1]=t.y,wn[2]=t.hasZ?t.z:0,Tn[0]=e.x,Tn[1]=e.y,Tn[2]=e.hasZ?e.z:0,cf(wn,Tn,i)}function cf(t,e,i){return ao(i,hf,uf,t,e,i)}function hf(t,e,i){return pe(Hi(gf,t,e,i).distance,"meters")}function uf(t,e,i){return pe(nr(ff(t,e,i),"meters"),"meters")}function pf(t){return pe(Fc([t],"meters")[0],"meters")}function df(t){return pe(nr(t,"meters"),"meters")}function ff(t,e,i){return{type:"polyline",spatialReference:i,paths:[[[...t],[...e]]]}}const gf=new Ni,wn=g(),Tn=g();function mf(t){return af(t)??tf(t)}function En(t,e){return lf(t,e)??sf(t,e)}function yf(t,e){return{point:new ki({sketchOptions:e,viewType:t}),polyline:new jt({sketchOptions:e,viewType:t}),polygon:new qt({sketchOptions:e,viewType:t}),mesh:new Ci({sketchOptions:e,viewType:t}),rectangle:new mt({sketchOptions:e}),circle:new Ke({sketchOptions:e})}}function Va(t){const{directionOptions:e,geometryType:i,sketchOptions:n,tooltipInfos:s}=t,o=l=>{const h=Sn(t).mode,u=s[l].elevation;h==="relative-to-ground"||h==="relative-to-scene"||h==="on-the-ground"?u.lock(po(t)):u.unlock()},r=l=>{if(e){const h=s[l].direction;h.committed=e.angle,h.unlockOnVertexPlacement=!1,n.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":o(i),r(i);break;case"point":case"mesh":o(i)}}function _f(t,e){const{drawOperation:i,view:n}=e,s=uo(e),o=Sn(e);if(n.type==="2d"||!t||o.mode!=="absolute-height"||i?.numCommittedVertices!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[r,l,h]=t,u=Rf(r,l,h,o,e);u!=null&&s.elevation.lock(u)}function Aa(t){uo(t)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function uo({geometryType:t,graphic:e,tooltipInfos:i}){return t==="multipoint"||e?.geometry?.type!==vf[t]?null:i[t]}const vf={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function xf(t,e){switch(t?.type){case"draw-point":bf(t,e);break;case"draw-polyline":Tf(t,e);break;case"draw-polygon":Ef(t,e);break;case"draw-rectangle":Mf(t,e);break;case"draw-circle":Pf(t,e);break;case"draw-mesh":wf(t,e)}}function bf(t,e){const i=e.graphic?.geometry;i?.type==="point"&&(Oa(t,i,e),t.helpMessage=_s("point",i))}function wf(t,e){const{graphic:i,view:n}=e,s=i?.geometry;n.type!=="3d"||s&&s.type!=="mesh"||(Oa(t,s?.origin,e),s&&Md(t,s),t.helpMessage=xu(i,n))}function Oa(t,e,i){const{drawOperation:n,view:s,sketchOptions:o}=i,{cursorVertex:r}=n;if(t.sketchOptions=o,t.viewType=s.type,t.setLocationFromPoint(e,$t(i)),La(t.elevation,i),!r)return void(n.constraints=void 0);const l=r;n.constraints={context:Ua(l,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function Tf(t,e){const{createOperationGeometry:i,drawOperation:n}=e,s=i!=null?i.full:null;s&&s.type!=="polyline"||(Ia(t,e),t.totalLength.actual=n.lastVertex?(s?mf(s):null)??Ze:null,t.helpMessage=_s("polyline",s))}function Ef(t,e){const{createOperationGeometry:i,drawOperation:n}=e,s=i!=null?i.full:null;s&&s.type!=="polygon"||(Ia(t,e),t.area.actual=n.lastVertex?(s?Pa(s):null)??Dt:null,t.helpMessage=_s("polygon",s))}function Ia(t,e){const{drawOperation:i,sketchOptions:n,view:s}=e,{cursorVertex:o,lastVertex:r,secondToLastVertex:l}=i,h=n.values.effectiveDirectionMode;t.sketchOptions=n,t.viewType=s.type;const u=r&&o?En(r,o)??Ze:null;if(t.distance.actual=u,t.distance.readOnly=r==null,t.direction.actual=null,t.direction.readOnly=!0,r&&o&&(h==="absolute"||l)){const m=lp(l,r,o,h);t.direction.actual=m??ph,t.direction.readOnly=!1}t.setLocationFromPoint(o,$t(e)),La(t.elevation,e);const p=Sf(r,e);t.xyMode=p,t.direction.visible=p==="direction-distance",t.distance.visible=p==="direction-distance",t.effectiveX.visible=p==="coordinates",t.effectiveY.visible=p==="coordinates";const d=o??r;i.constraints=d?{context:Ua(d,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Sf(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Mf(t,e){t.sketchOptions=e.sketchOptions,t.xSize=Da(e),t.ySize=za(e),t.area=Ga(e)}function Pf(t,e){const{forceUniformSize:i,sketchOptions:n}=e;t.sketchOptions=n,t.radius=i?Cf(e):null,t.xSize=i?null:Da(e),t.ySize=i?null:za(e),t.area=Ga(e)}function La(t,e){const{drawOperation:i}=e,n=i?.cursorVertex??i?.lastVertex;t.actual=of(n)??po(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Ga(t){const e=t.createOperationGeometry?.full;return e?.type!=="polygon"?Dt:Pa(e)??Dt}function Da(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?En(e.left,e.right):null)??Ze}function za(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?En(e.top,e.bottom):null)??Ze}function Cf({createOperationGeometry:t}){return(t?.circle?.center!=null&&t.circle.edge!=null?En(t.circle.center,t.circle.edge):null)??Ze}function kf(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"mesh":case"polyline":case"polygon":{const n=i[e].elevation.committed;return n?Zi(n,"meters")/Fn($t(t)):void 0}default:return}}function Rf(t,e,i,n,s){const{view:o,drawOperation:r}=s;if(o.type!=="3d"||!r)return;i??=0;const l=$t(s),h=Sn(s),u=jo(o,t,e,i,l,h,n);return Ca(u,l)??po(s)}function Sn(t){return t.drawOperation.elevationInfo??Ui}function $t(t){return t.drawOperation.coordinateHelper.spatialReference}function po(t){const e=Fn($t(t));return pe(t.defaultZ*e,"meters")}function Ua(t,e){return fp(t,e.view,$t(e),Sn(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var Pt;(function(t){t[t.WhenToolEditable=0]="WhenToolEditable",t[t.WhenToolNotEditable=1]="WhenToolNotEditable",t[t.Always=2]="Always"})(Pt||(Pt={}));let Vf=class{constructor(){this._isToolEditable=!0,this._manipulators=new Dn,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,e=Pt.WhenToolEditable){this.addMany([t],e)}addMany(t,e=Pt.WhenToolEditable){for(const i of t){const n={manipulator:i,visibilityPredicate:e,attached:!1};this._manipulators.add(n),this._attached&&this._updateManipulatorAttachment(n)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const i=this._manipulators.splice(e,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(t=>{this._updateManipulatorAttachment(t)}),this._attached=!0}detach(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:t})=>t.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,i=>{e(i)})}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach(e=>t.push(e.manipulator)),t}intersect(t,e){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:s,attached:o})=>{if(!o||!s.interactive)return;const r=s.intersectionDistance(t,e);r!=null&&r<n&&(n=r,i=s)}),i}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===Pt.Always||(this._isToolEditable?t.visibilityPredicate===Pt.WhenToolEditable:t.visibilityPredicate===Pt.WhenToolNotEditable)}},X=class extends J{constructor(t){super(t),this.manipulators=new Vf,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[Et.MANAGER,!0],[Et.USER,!0]]),this._creationFinishedResolver=cc()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(Et.USER)}set editable(t){this.setEditableFlag(Et.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===Et.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}endDrag(){const t=this.view.inputManager.latestPointerLocation;if(!t)return;let e=!1;this.manipulators.forEach(({manipulator:i})=>{i.dragging&&(e=!0,i.events.emit("drag",{action:"end",start:t,screenPoint:t}))}),e&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(Et.USER)&&this.getEditableFlag(Et.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};a([c({constructOnly:!0})],X.prototype,"view",void 0),a([c({readOnly:!0})],X.prototype,"active",null),a([c({value:!0})],X.prototype,"visible",null),a([c({value:!0})],X.prototype,"editable",null),a([c({readOnly:!0})],X.prototype,"manipulators",void 0),a([c({readOnly:!0})],X.prototype,"updating",null),a([c()],X.prototype,"cursor",null),a([c({readOnly:!0})],X.prototype,"automaticManipulatorSelection",void 0),a([c()],X.prototype,"hasFocusedManipulators",null),a([c()],X.prototype,"hasGrabbedManipulators",void 0),a([c()],X.prototype,"hasHoveredManipulators",void 0),a([c()],X.prototype,"firstGrabbedManipulator",void 0),a([c({readOnly:!0})],X.prototype,"created",void 0),a([c({readOnly:!0})],X.prototype,"removeIncompleteOnCancel",void 0),X=a([x("esri.views.interactive.InteractiveToolBase")],X);let Mn=class extends J{constructor(t){super(t),this.enabled=!1}};a([c({type:Boolean,nonNullable:!0})],Mn.prototype,"enabled",void 0),Mn=a([x("esri.views.interactive.sketch.SketchLabelOptions")],Mn);const Pn=Mn;let Ri=class extends J{constructor(t){super(t),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};a([c({type:String,nonNullable:!0})],Ri.prototype,"mode",void 0),Ri=a([x("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Ri);let ee=class extends J{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};a([c({type:Boolean,nonNullable:!0})],ee.prototype,"area",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"coordinates",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"direction",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"distance",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"elevation",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"header",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"helpMessage",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"orientation",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"radius",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"rotation",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"scale",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"size",void 0),a([c({type:Boolean,nonNullable:!0})],ee.prototype,"totalLength",void 0),ee=a([x("esri.views.interactive.sketch.SketchTooltipVisibleElements")],ee);const Ha=ee;let ie=class extends J{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Ri,this.placement="auto",this.offset=null,this.visibleElements=new Ha,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};a([c({type:Boolean,nonNullable:!0})],ie.prototype,"enabled",void 0),a([c()],ie.prototype,"forceEnabled",void 0),a([c()],ie.prototype,"effectiveEnabled",null),a([c()],ie.prototype,"helpMessage",void 0),a([c()],ie.prototype,"helpMessageIcon",void 0),a([c({type:Boolean,nonNullable:!0})],ie.prototype,"inputEnabled",void 0),a([c({type:Ri,nonNullable:!0})],ie.prototype,"elevation",void 0),a([c()],ie.prototype,"placement",void 0),a([c()],ie.prototype,"offset",void 0),a([c({type:Ha,nonNullable:!0})],ie.prototype,"visibleElements",void 0),a([c()],ie.prototype,"visualVariables",void 0),a([c()],ie.prototype,"xyMode",void 0),ie=a([x("esri.views.interactive.sketch.SketchTooltipOptions")],ie);const Na=ie;let Kt=class extends J{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};a([c()],Kt.prototype,"length",void 0),a([c()],Kt.prototype,"verticalLength",void 0),a([c()],Kt.prototype,"area",void 0),Kt=a([x("esri.views.interactive.sketch.Units")],Kt);const Cn=Kt;let vt=class extends J{constructor(t){super(t),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?O.RelativeBilateral:O.Relative;case"absolute":return O.Absolute}}get displayUnits(){return this._get("displayUnits")??new Cn}set displayUnits(t){this._set("displayUnits",t)}get inputUnits(){return this._get("inputUnits")??new Cn}set inputUnits(t){this._set("inputUnits",t)}};a([c({type:String,nonNullable:!0})],vt.prototype,"directionMode",void 0),a([c({type:Boolean,nonNullable:!0})],vt.prototype,"relativeDirectionIsBilateral",void 0),a([c()],vt.prototype,"effectiveDirectionMode",null),a([c({type:Cn,nonNullable:!0})],vt.prototype,"displayUnits",null),a([c({type:Cn,nonNullable:!0})],vt.prototype,"inputUnits",null),vt=a([x("esri.views.interactive.sketch.SketchValueOptions")],vt);const Fa=vt;let Qt=class extends J{constructor(t){super(t),this.labels=new Pn,this.tooltips=new Na,this.values=new Fa}};a([c({nonNullable:!0,type:Pn})],Qt.prototype,"labels",void 0),a([c({nonNullable:!0,type:Na})],Qt.prototype,"tooltips",void 0),a([c({nonNullable:!0,type:Fa})],Qt.prototype,"values",void 0),Qt=a([x("esri.views.interactive.sketch.SketchOptions")],Qt);const Za=Qt;let M=class extends bt.EventedMixin(X){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Za}initialize(){const{view:t}=this;this.internalGraphicsLayer=new is({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=yf(t.type,this.sketchOptions);const i=Sd(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,Va(this._tooltipsContext),this._coordinateFormatterLoadTask=hc(()=>ou()),this.addHandles([e.on("vertex-add",n=>this.onVertexAdd(n)),e.on("vertex-remove",n=>this.onVertexRemove(n)),e.on("vertex-update",n=>this.onVertexUpdate(n)),e.on("cursor-update",n=>this.onCursorUpdate(n)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",n=>this.onComplete(n)),this._coordinateFormatterLoadTask,i.on("paste",n=>Od(n,this.activeTooltipInfo)),D(()=>this.cursor,n=>{e.cursor=n},wt),Go(()=>{const{activeTooltipInfo:n,sketchOptions:s}=this;xf(n,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?n:null}),Go(()=>{e.constraintZ=kf(this._tooltipsContext)},Xn)]),this.finishToolCreation()}destroy(){this.drawOperation=ce(this.drawOperation),this.tooltip=ce(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=ce(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof Ae?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Vd(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Va(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(Te.outline),this.removeHandles(Te.regularVertices),this.removeHandles(Te.activeVertex),this.removeHandles(Te.activeEdge),this.removeHandles(fo)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new Ce({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(Y(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),fo),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:n,lastVertex:s,committedVertices:o,geometryIncludingUncommittedVertices:r,numCommittedVertices:l}=this.drawOperation;if(!(l>0||n!=null))return;const h=t.operationComplete?o:r,u=h.length,p=n!=null?e.pointToArray(n):null,d=this._drawSpatialReference,m=i.type==="3d"&&i.viewingMode==="global",f=new cu;f.committedVertices=o,f.cursorVertex=p;const{geometryType:_}=this;switch(_){case"point":case"mesh":f.full=e.arrayToPoint(h[0]);break;case"multipoint":f.full=u>0?fu(h,d):null;break;case"polyline":case"polygon":u>0&&(f.full=_==="polygon"?wi([h],d,m,!0):Sr([h],d,m),f.cursorEdge=p!=null&&s&&!_i(n,s)?Sr([[p,e.pointToArray(s)]],d,m):null,f.outline=u>1?f.full:null);break;case"circle":case"rectangle":{if(f.committedVertices=f.cursorVertex=null,!u)break;const y=du(i,h[0]),w=h[0],b=y.makeMapPoint(w[0]+Of*i.resolution,w[1]);_==="circle"?u===1&&t.operationComplete?f.circle=Cr([w,b],y,!0):u===2&&(this.forceUniformSize?f.circle=Cr(h,y,this.centered):f.rectangle=mu(h,y,this.centered)):u===1&&t.operationComplete?f.rectangle=Mr([w,b],y,!0):u===2&&(f.rectangle=this.forceUniformSize?Mr(h,y,this.centered):gu(h,y,this.centered)),f.full=f.circle!=null?f.circle.geometry:f.rectangle?.geometry,f.outline=f.full?.type==="polygon"?f.full:null;break}default:return null}return f}initializeGraphic(t){return Y()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return Y()}onCursorEdgeChanged(t){return Y()}onVertexAdd(t){Aa(this._tooltipsContext),this._updateGraphic(),_f(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){Aa(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),Te.activeEdge):this.removeHandles(Te.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),Te.outline):this.removeHandles(Te.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),Te.regularVertices):this.removeHandles(Te.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),Te.activeVertex):this.removeHandles(Te.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(fo)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?uo(this._tooltipsContext):null}};a([c()],M.prototype,"_coordinateFormatterLoadTask",void 0),a([c()],M.prototype,"_createOperationGeometry",void 0),a([c()],M.prototype,"_tooltipsContext",null),a([c({value:!0})],M.prototype,"centered",null),a([c()],M.prototype,"cursor",null),a([c({nonNullable:!0})],M.prototype,"defaultZ",void 0),a([c({constructOnly:!0})],M.prototype,"directionOptions",void 0),a([c()],M.prototype,"drawOperation",void 0),a([c({value:!0})],M.prototype,"enabled",null),a([c({value:!0})],M.prototype,"forceUniformSize",null),a([c({constructOnly:!0})],M.prototype,"geometryType",void 0),a([c()],M.prototype,"graphic",null),a([c({constructOnly:!0})],M.prototype,"graphicProperties",void 0),a([c()],M.prototype,"graphicSymbol",null),a([c({constructOnly:!0})],M.prototype,"hasZ",void 0),a([c({constructOnly:!0})],M.prototype,"geometryToPlace",void 0),a([c()],M.prototype,"mode",null),a([c()],M.prototype,"snappingManager",void 0),a([c()],M.prototype,"snapToScene",void 0),a([c()],M.prototype,"tooltip",void 0),a([c()],M.prototype,"tooltipInfos",void 0),a([c({constructOnly:!0,type:Za})],M.prototype,"sketchOptions",void 0),a([c()],M.prototype,"updating",null),a([c({constructOnly:!0,nonNullable:!0})],M.prototype,"view",void 0),a([c({constructOnly:!0})],M.prototype,"undoRedo",null),a([c()],M.prototype,"activeTooltipInfo",null),M=a([x("esri.views.draw.DrawGraphicTool")],M);const fo=Symbol("create-operation-graphic"),Te={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Af(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Of=48,Ba="click";let If=class{constructor({consumesClicks:t,grabbableForEvent:e}){this.events=new bt,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=e}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};var F;(function(t){t[t.Z=0]="Z",t[t.M=1]="M"})(F||(F={}));let Lf=class{constructor(t){this.spatialReference=t}createVector(){return this._tag(L())}pointToVector(t){return this._tag(at(t.x,t.y))}arrayToVector(t){return this._tag(at(t[0],t[1]))}vectorToArray(t){return[t[0],t[1]]}pointToArray(t){return[t.x,t.y]}vectorToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.hasZ=!1,e.hasM=!1,e.spatialReference=this.spatialReference,e}lerp(t,e,i,n){return Yo(n,t,e,i)}addDelta(t,e,i){t[0]+=e,t[1]+=i}distance(t,e){return Wo(t,e)}getZ(t,e=void 0){return e}hasZ(){return!1}getM(t,e=void 0){return e}hasM(){return!1}clone(t){return this._tag(kc(t))}copy(t,e){return wc(e,t)}fromXYZ(t){return this._tag(at(t[0],t[1]))}toXYZ(t,e=g()){return U(e,t[0],t[1],0)}pointToXYZ(t,e=g()){return U(e,t.x,t.y,0)}equals(t,e){return Tc(t,e)}_tag(t){return t}};class Ya{constructor(e,i){this._valueType=e,this.spatialReference=i}createVector(){return this._tag(g())}pointToVector(e){return this._tag(nt(e.x,e.y,this._valueType===F.Z?e.z:e.m))}arrayToVector(e){return this._tag(nt(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===F.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,i=new C){return i.x=e[0],i.y=e[1],i.z=this._valueType===F.Z?e[2]:void 0,i.m=this._valueType===F.M?e[2]:void 0,i.spatialReference=this.spatialReference,i}arrayToPoint(e,i=new C){return i.x=e[0],i.y=e[1],i.z=this._valueType===F.Z?e[2]:void 0,i.m=this._valueType===F.M?e[2]:void 0,i.spatialReference=this.spatialReference,i}vectorToDehydratedPoint(e,i){if(!e)return;i??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const n=this._valueType===F.Z,s=this._valueType===F.M;return i.x=e[0],i.y=e[1],i.z=n?e[2]:void 0,i.m=s?e[2]:void 0,i.hasZ=n,i.hasM=s,i.spatialReference=this.spatialReference,i}lerp(e,i,n,s){return Tt(s,e,i,n)}addDelta(e,i,n,s){e[0]+=i,e[1]+=n,this._valueType===F.Z&&(e[2]+=s)}distance(e,i){return this._valueType===F.Z?lt(e,i):Wo(e,i)}getZ(e,i=void 0){return this._valueType===F.Z?e[2]:i}hasZ(){return this._valueType===F.Z}getM(e,i=void 0){return this._valueType===F.M?e[2]:i}hasM(){return this._valueType===F.M}clone(e){return this._tag(uc(e))}copy(e,i){return se(i,e)}fromXYZ(e,i=0,n=0){return this._tag(nt(e[0],e[1],this._valueType===F.Z?e.length>2?e[2]:i:n))}toXYZ(e,i=g()){return U(i,e[0],e[1],this._valueType===F.Z?e[2]:0)}pointToXYZ(e,i=g()){return U(i,e.x,e.y,this._valueType===F.Z?e.z??0:0)}equals(e,i){return Gt(e,i)}_tag(e){return e}}let Gf=class{constructor(t){this.spatialReference=t}createVector(){return this._tag(cr())}pointToVector(t){return this._tag(ss(t.x,t.y,t.z,t.m))}arrayToVector(t){return this._tag(ss(t[0],t[1],t[2]||0,t[3]||0))}vectorToArray(t){return[t[0],t[1],t[2],t[3]]}pointToArray(t){return[t.x,t.y,t.z,t.m]}vectorToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.hasZ=!0,e.hasM=!0,e.spatialReference=this.spatialReference,e}lerp(t,e,i,n){return mh(n,t,e,i)}addDelta(t,e,i,n){t[0]+=e,t[1]+=i,t[2]+=n}distance(t,e){return lt(t,e)}getZ(t){return t[2]}hasZ(){return!0}getM(t){return t[3]}hasM(){return!0}clone(t){return this._tag(vh(t))}copy(t,e){return yh(e,t)}fromXYZ(t,e=0,i=0){return this._tag(ss(t[0],t[1],t.length>2?t[2]:e,i))}toXYZ(t,e=g()){return U(e,t[0],t[1],t[2])}pointToXYZ(t,e=g()){return U(e,t.x,t.y,t.z??0)}equals(t,e){return _h(t,e)}_tag(t){return t}};function Xa(t,e,i){return t&&e?new Gf(i):e?new Ya(F.M,i):t?new Ya(F.Z,i):new Lf(i)}function Df(t,e){if(!e.supported)return;let i=1/0,n=-1/0;const s=e.upperBoundX-e.lowerBoundX;t.forEach(r=>{let l=r.pos[0];for(;l<e.lowerBoundX;)l+=s;for(;l>e.upperBoundX;)l-=s;i=Math.min(i,l),n=Math.max(n,l),r.pos[0]=l});const o=n-i;s-o<o&&t.forEach(r=>{r.pos[0]<0&&(r.pos[0]+=s)})}function zf(t,e){const i=Do(t);return e===mi.Global&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}let Vi=class{constructor(t){this.component=t,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(t){this._pos=t,this.component.unnormalizeVertexPositions()}};class Je{constructor(e,i,n){this.component=e,this.leftVertex=i,this.rightVertex=n,this.type="edge",i.rightEdge=this,n.leftEdge=this}}class kn{constructor(e,i){this._spatialReference=e,this._viewingMode=i,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||Df(this.vertices,zf(this._spatialReference,this._viewingMode))}updateVertexIndex(e,i){if(this.vertices.length===0)return;const n=this.vertices[0];let s=null,o=e,r=i;do s=o,s.index=r++,o=s.rightEdge?s.rightEdge.rightVertex:null;while(o!=null&&o!==n);s.leftEdge&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&this.vertices[0].leftEdge!==null}swapVertices(e,i){const n=this.vertices[e];this.vertices[e]=this.vertices[i],this.vertices[i]=n}iterateVertices(e){if(this.vertices.length===0)return;const i=this.vertices[0];let n=i;do e(n,n.index),n=n.rightEdge!=null?n.rightEdge.rightVertex:null;while(n!==i&&n!=null)}}let Rn=class Tl extends bt{constructor(e,i){super(),this.type=e,this.coordinateHelper=i,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:Hh(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const e of this.components)for(const i of e.vertices)yield i}notifyChanges(e){this._dirty=!0,this.emit("change",e)}_toPoint(){return this.components.length===0||this.components[0].vertices.length===0?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],i=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[];let o=n.vertices.find(l=>l.leftEdge==null);const r=o;do s.push(i(o.pos)),o=o.rightEdge?o.rightEdge.rightVertex:null;while(o&&o!==r);e.push(s)}return new si({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],i=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[],o=n.vertices[0];let r=o;const l=r;do s.push(i(r.pos)),r=r.rightEdge!=null?r.rightEdge.rightVertex:null;while(r&&r!==l);n.isClosed()&&s.push(i(o.pos)),e.push(s)}return new At({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,i){const n=e.spatialReference,s=Xa(e.hasZ,e.hasM,n),o=new Tl(e.type,s);switch(e.type){case"polygon":Uf(o,e,i);break;case"polyline":Hf(o,e,i);break;case"point":Wa(o,e,i);break;case"mesh":Wa(o,e.origin,i),o._geometry=e,o._dirty=!1}return o}};function Uf(t,e,i){const n=e.spatialReference,s=t.coordinateHelper,o=e.rings;for(let r=0;r<o.length;++r){const l=o[r],h=new kn(n,i);h.index=r;const u=l.length>2&&Ot(l[0],l[l.length-1]),p=u?l.length-1:l.length;for(let m=0;m<p;++m){const f=s.arrayToVector(l[m]),_=new Vi(h);h.vertices.push(_),_.pos=f,_.index=m}const d=h.vertices.length-1;for(let m=0;m<d;++m){const f=h.vertices[m],_=h.vertices[m+1],y=new Je(h,f,_);h.edges.push(y)}if(u){const m=new Je(h,h.vertices[h.vertices.length-1],h.vertices[0]);h.edges.push(m)}t.components.push(h)}}function Hf(t,e,i){const n=e.spatialReference,s=t.coordinateHelper,o=e.paths;for(let r=0;r<o.length;++r){const l=o[r],h=new kn(n,i);h.index=r;const u=l.length;for(let d=0;d<u;++d){const m=s.arrayToVector(l[d]),f=new Vi(h);h.vertices.push(f),f.pos=m,f.index=d}const p=h.vertices.length-1;for(let d=0;d<p;++d){const m=h.vertices[d],f=h.vertices[d+1],_=new Je(h,m,f);h.edges.push(_)}t.components.push(h)}}function Wa(t,e,i){const n=e.spatialReference,s=t.coordinateHelper,o=new kn(n,i);o.index=0;const r=new Vi(o);r.index=0,r.pos=s.pointToVector(e),o.vertices.push(r),t.components.push(o)}function Ai(t){return t.type==="mesh"}var G;(function(t){t[t.NEW_STEP=0]="NEW_STEP",t[t.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"})(G||(G={}));let Nf=class{constructor(t,e,i){this._editGeometry=t,this._component=e,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let t="redo";this._addedVertex==null&&(t="apply",this._addedVertex=new Vi(this._component));const e=this._component.getLastVertex();if(e==null)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let i=null;e.rightEdge&&(this._originalEdge=e.rightEdge,i=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._left==null&&(this._left=new Je(this._component,e,this._addedVertex)),this._component.edges.push(this._left),e.rightEdge=this._left,this._originalEdge!=null&&i!=null&&(this._right==null&&(this._right=new Je(this._component,this._addedVertex,i)),this._component.edges.push(this._right),i.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,e.index+1)}this._editGeometry.notifyChanges({operation:t,addedVertices:[this._addedVertex]})}undo(){this._addedVertex!=null&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),this._left!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),this._right!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),this._originalEdge!=null&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),this._left!=null?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},qa=class El{constructor(e,i,n){this._editGeometry=e,this._vertices=i,this.operation=n,this._undone=!1}apply(){this._vertices.forEach(e=>this.operation.apply(e)),this._editGeometry.components.forEach(e=>e.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach(e=>this.operation.undo(e)),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(e){if(this._undone||e._vertices.length!==this._vertices.length)return!1;for(let i=0;i<e._vertices.length;++i)if(e._vertices[i]!==this._vertices[i])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){return!!(e instanceof El&&this.canAccumulate(e))&&(this._vertices.forEach(i=>this.operation.accumulate(i,e.operation)),this.operation.accumulateParams(e.operation),this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}};var ne;(function(t){t[t.CUMULATIVE=0]="CUMULATIVE",t[t.REPLACE=1]="REPLACE"})(ne||(ne={}));let Ff=class{constructor(t,e,i=0){this._editGeometry=t,this._vertices=e,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let t="redo";if(this.removedVertices==null){const e=this.removedVertices=[];this._vertices.forEach(i=>{const n=this._removeVertex(i);n!=null&&e.push(n)}),t="apply"}else this.removedVertices.forEach(e=>{this._removeVertex(e.removedVertex)});this._editGeometry.notifyChanges({operation:t,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach(t=>{this._undoRemoveVertex(t)}),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(t){const e=t.component;if(e.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:t,createdEdge:null},n=t.leftEdge,s=t.rightEdge;return e.vertices.splice(e.vertices.indexOf(t),1),n&&(e.edges.splice(e.edges.indexOf(n),1),n.leftVertex.rightEdge=null),s&&(e.edges.splice(e.edges.indexOf(s),1),s.rightVertex.leftEdge=null),t.index===0&&s&&this._vertices.length>0&&e.swapVertices(e.vertices.indexOf(s.rightVertex),0),n&&s&&(i.createdEdge=new Je(e,n.leftVertex,s.rightVertex),e.edges.push(i.createdEdge)),s&&e.updateVertexIndex(s.rightVertex,s.rightVertex.index-1),i}_undoRemoveVertex(t){const e=t.removedVertex,i=t.removedVertex.component,n=e.leftEdge,s=e.rightEdge;t.createdEdge&&i.edges.splice(i.edges.indexOf(t.createdEdge),1),i.vertices.push(e),n&&(i.edges.push(n),n.leftVertex.rightEdge=n),s&&(i.edges.push(s),s.rightVertex.leftEdge=s),i.updateVertexIndex(e,e.index)}},Zf=class{constructor(t,e,i){this._editGeometry=t,this._edge=e,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let t="redo";const e=this._edge,i=e.component,n=e.leftVertex,s=e.rightVertex;i.edges.splice(i.edges.indexOf(e),1),this.createdVertex==null&&(t="apply",this.createdVertex=new Vi(e.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(e.leftVertex.pos,e.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),this._left==null&&(this._left=new Je(i,n,this.createdVertex)),this._left.leftVertex.leftEdge?i.edges.push(this._left):i.edges.unshift(this._left),n.rightEdge=this._left,this._right==null&&(this._right=new Je(i,this.createdVertex,s)),i.edges.push(this._right),s.leftEdge=this._right,i.updateVertexIndex(this.createdVertex,n.index+1),this._editGeometry.notifyChanges({operation:t,addedVertices:[this.createdVertex]})}undo(){if(this.createdVertex==null||this._left==null||this._right==null)return null;const t=this._edge,e=t.component,i=this.createdVertex.leftEdge,n=this.createdVertex.rightEdge,s=i?.leftVertex,o=n?.rightVertex;e.vertices.splice(e.vertices.indexOf(this.createdVertex),1),e.edges.splice(e.edges.indexOf(this._left),1),e.edges.splice(e.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?e.edges.push(this._edge):e.edges.unshift(this._edge),s&&(s.rightEdge=t),o&&(o.leftEdge=t),s&&e.updateVertexIndex(s,s.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},Bf=class Sl{constructor(e,i,n){this._editGeometry=e,this._vertex=i,this._pos=n}apply(){const e=this._originalPosition==null;e&&(this._originalPosition=this._vertex.pos),this._apply(e?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(e){return e instanceof Sl&&e._vertex===this._vertex&&(this._pos=e._pos,this._apply("apply"),!0)}_apply(e){this._vertex.pos=this._pos,this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:e,updatedVertices:[this._vertex]})}},Yf=class{constructor(t,e){this._editGeometry=t,this._component=e,this._createdEdge=null}apply(){let t="redo";if(this._createdEdge==null){t="apply";const e=this._component.getFirstVertex(),i=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||e==null||i==null)return;this._createdEdge=new Je(this._component,i,e)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:t})}undo(){this._createdEdge!=null&&(Vo(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},ja=class Ml{constructor(e,i,n,s){this._editGeometry=e,this.dx=i,this.dy=n,this.dz=s,this._firstTime=!0}apply(){const e=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(e,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(e){const i=this._editGeometry.geometry;return e instanceof Ml&&e._editGeometry.geometry===i&&(this._apply("apply",e.dx,e.dy,e.dz),this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz,!0)}_apply(e,i,n,s){const o=this._editGeometry.geometry;o.offset(i,n,s);const r=this._editGeometry.components[0].getFirstVertex();if(!r)return;const l=this._editGeometry.coordinateHelper;r.pos=l.pointToVector(o.origin),this._editGeometry.notifyChanges({operation:e,updatedVertices:[r]})}},$a=class Pl{constructor(e,i,n,s){this._helper=e,this.dx=i,this.dy=n,this.dz=s}_move(e,i,n,s){this._helper.addDelta(e.pos,i,n,s)}apply(e){this._move(e,this.dx,this.dy,this.dz)}undo(e){this._move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof Pl}accumulate(e,i){this._move(e,i.dx,i.dy,i.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}},Xf=class To{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(e,i,n,s=0,o=Oi.IMMEDIATE){this._helper=e,this._planeType=i,this._edge=n,this.distance=s,this._plane=oe(),this._offsetPlane=oe(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,o===Oi.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const e=this._toXYZ(this._edge.leftVertex.pos),i=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),n=this._toXYZ(this._edge.rightVertex.pos),s=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=Jo(g(),e,n),i?(this._left=this._computeNeighbor(e,i,this._edgeDirection),this._right=this._computeNeighbor(n,s,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(n,s,this._edgeDirection),this._left=this._computeNeighbor(e,i,this._edgeDirection,this._right))}_toXYZ(e){return e!=null?this._helper.toXYZ(e):null}_pointToXYZ(e){return this._toXYZ(this._helper.pointToVector(e))}_computeNeighbor(e,i,n,s){const o=g();if(i){Jo(o,e,i);const r=!this._passesBisectingAngleThreshold(o,n);return{start:e,end:i,direction:r?this._bisectVectorsPerpendicular(n,o):o,isOriginalDirection:!r}}return this._helper.hasZ()?s&&(ke(o,n,s.direction),ke(o,o,n),ht(o,o),Math.sign(o[1])!==Math.sign(n[0])&&ct(o,o,-1)):U(o,-n[1],n[0],0),{start:e,end:i,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(e,i){const n=Math.abs(Th(i,e));return n>=Ka&&n<=Math.PI-Ka}_bisectVectorsPerpendicular(e,i){const n=Z(e,i)<0?e:ts(g(),e),s=Math.abs(Z(n,i));if(!(s<Qa||s>1-Qa))return this._bisectDirection(n,i);const o=ke(g(),n,[0,0,1]);return ht(o,o)}_bisectDirection(e,i){const n=ue(g(),e,i);return ht(n,n)}_initializePlane(){const e=this._computeNormalDirection(this._left),i=this._computeNormalDirection(this._right);Z(e,i)<0&&ts(i,i),pi(this._left.start,this._bisectDirection(e,i),this._plane)}_computeNormalDirection(e){const i=ke(g(),e.direction,this._edgeDirection);ht(i,i);const n=ke(g(),this._edgeDirection,i);return this._planeType===go.XY&&(n[2]=0),ht(n,n)}_initializeDistanceConstraints(){this._left.end==null||this.requiresSplitEdgeLeft||this._updateDistanceConstraint(zt(this._plane,this._left.end)),this._right.end==null||this.requiresSplitEdgeRight||this._updateDistanceConstraint(zt(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}_updateIntersectDistanceConstraint(e){const i=Ut(e),n=this._edgeDirection,s=ue(g(),this._left.start,this._left.direction),o=ue(g(),this._right.start,this._right.direction),r=this._pointInBasis2D(L(),i,n,this._left.start),l=this._pointInBasis2D(L(),i,n,s),h=this._pointInBasis2D(L(),i,n,this._right.start),u=this._pointInBasis2D(L(),i,n,o),[p]=Eu({start:l,end:r,type:A.LINE},{start:u,end:h,type:A.LINE});if(!p)return;const d=q(L(),r,l);Kn(d,d);const m=q(L(),p,l),f=rt(d,m),_=ue(g(),s,ct(g(),this._left.direction,-f)),y=zt(e,_);this._updateDistanceConstraint(y)}_pointInBasis2D(e,i,n,s){return e[0]=dr(i,s),e[1]=dr(n,s),e}_offset(e,i){Number.isFinite(this._minDistance)&&(i=Math.max(this._minDistance,i)),Number.isFinite(this._maxDistance)&&(i=Math.min(this._maxDistance,i)),ls(this._offsetPlane,this._plane),this._offsetPlane[3]-=i;const n=(o,r,l)=>r!=null&&rs(this._offsetPlane,o,ue(g(),o,r),l),s=g();(e===this._edge.leftVertex?n(this._left.start,this._left.direction,s):n(this._right.start,this._right.direction,s))&&this._helper.copy(this._helper.fromXYZ(s,void 0,this._helper.getM(e.pos)),e.pos)}selectArrowFromStartPoint(e){this._selectedArrow=hr(this.plane,this._pointToXYZ(e))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(e){return zt(this.plane,this._pointToXYZ(e))}clampedStartAndEnd(e){const i=this._helper.toXYZ(this._helper.pointToVector(e)),n=as(this._plane,i,g()),s=zt(this._plane,i),o=pc(s,this._minDistance,this._maxDistance);return Tt(i,n,i,o/s),{start:n,end:i}}apply(e){this._offset(e,this.distance)}undo(e){this._offset(e,0)}canAccumulate(e){return e instanceof To&&this._edge.leftVertex.index===e._edge.leftVertex.index&&this._edge.rightVertex.index===e._edge.rightVertex.index&&this._edge.component===e._edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&Gt(Ut(this._plane),Ut(e._plane))}accumulate(e,i){const n=this._plane[3]-i._plane[3]+i.distance;this._offset(e,n)}accumulateParams(e){const i=e.distance-e._plane[3];this.distance=i+this._plane[3]}clone(){const e=new To(this._helper,this._planeType,this._edge,this.distance,Oi.DEFERRED);return ls(e._plane,this._plane),ls(e._offsetPlane,this._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=se(g(),this._edgeDirection),e}_maybeEqualsVec3(e,i){return e==null&&i==null||e!=null&&i!=null&&Gt(e,i)}_cloneNeighbor({start:e,end:i,direction:n,isOriginalDirection:s}){return{start:se(g(),e),end:i!=null?se(g(),i):null,direction:se(g(),n),isOriginalDirection:s}}};const Ka=zo(15),Qa=.001;var go,Oi;(function(t){t[t.XYZ=0]="XYZ",t[t.XY=1]="XY"})(go||(go={})),function(t){t[t.IMMEDIATE=0]="IMMEDIATE",t[t.DEFERRED=1]="DEFERRED"}(Oi||(Oi={}));let Ja=class Cl{constructor(e,i,n=ne.CUMULATIVE){this.origin=e,this.angle=i,this._accumulationType=n}_rotate(e,i){Ec(e.pos,e.pos,this.origin,i)}apply(e){this._rotate(e,this.angle)}undo(e){this._rotate(e,-this.angle)}canAccumulate(e){return e instanceof Cl&&Ot(this.origin,e.origin)}accumulate(e,i){const n=i._accumulationType===ne.REPLACE;this._rotate(e,n?i.angle-this.angle:i.angle)}accumulateParams(e){const i=e._accumulationType===ne.REPLACE;this.angle=i?e.angle:this.angle+e.angle}};class On{constructor(e,i,n,s,o=ne.CUMULATIVE){this.origin=e,this.axis1=i,this.factor1=n,this.factor2=s,this._accumulationType=o,this.axis2=at(i[1],-i[0])}_scale(e,i,n){zi(e.pos,e.pos,this.origin,this.axis1,i),zi(e.pos,e.pos,this.origin,this.axis2,n)}apply(e){this._scale(e,this.factor1,this.factor2)}undo(e){this._scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof On&&Ot(this.origin,e.origin)&&Ot(this.axis1,e.axis1)}accumulate(e,i){i._accumulationType===ne.REPLACE?this._scale(e,i.factor1/this.factor1,i.factor2/this.factor2):this._scale(e,i.factor1,i.factor2)}accumulateParams(e){const i=e._accumulationType===ne.REPLACE;this.factor1=i?e.factor1:this.factor1*e.factor1,this.factor2=i?e.factor2:this.factor2*e.factor2}}let Wf=class kl{constructor(e,i){this._editGeometry=e,this._newPositions=i}apply(){const e=this._originalPositions==null?"apply":"redo";if(!this._originalPositions){const i=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map(n=>i.clone(n.pos))}this._apply(e,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(e){return e instanceof kl&&(this._newPositions=e._newPositions,this._apply("apply",this._newPositions),!0)}_apply(e,i){const n=this._editGeometry.coordinateHelper,s=this._editGeometry.allVertices;for(let o=0;o<s.length;o++)n.copy(i[o],s[o].pos);this._editGeometry.components.forEach(o=>o.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:e,updatedVertices:s})}};var el;const qf=Symbol();let jf=class{constructor(t){this._operations=[],this._closed=!1,this[el]=!0,t&&(this._operations=t,this._closed=!0)}close(){this._closed=!0}apply(){for(const t of this._operations)t.apply()}undo(){for(let t=this._operations.length-1;t>=0;t--)this._operations[t].undo()}accumulate(t){if(this._closed)return!1;const e=this._operations.length?this._operations[this._operations.length-1]:null;return e&&e.accumulate(t)||(this._operations.push(t),t.apply()),!0}};el=qf;let mo=class Rl extends bt{constructor(e,i){super(),this.data=e,this.viewingMode=i,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",n=>{n.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:n.addedVertices,operation:n.operation}),n.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:n.removedVertices,operation:n.operation}),n.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:n.updatedVertices,operation:n.operation})})}destroy(){this._listener.remove()}splitEdge(e,i){return this._apply(new Zf(this.data,e,i))}updateVertices(e,i,n=G.ACCUMULATE_STEPS){return this._apply(new qa(this.data,e,i),n)}move(e,i,n,s=G.ACCUMULATE_STEPS){return Ai(this.data)?this._apply(new ja(this.data,e,i,n),s):this.moveVertices(this.data.allVertices,e,i,n,s)}moveVertices(e,i,n,s,o=G.ACCUMULATE_STEPS){return Ai(this.data)?this._apply(new ja(this.data,i,n,s),o):this.updateVertices(e,new $a(this.data.coordinateHelper,i,n,s),o)}scale(e,i,n,s,o=G.ACCUMULATE_STEPS,r=ne.CUMULATIVE){return this.scaleVertices(this.data.allVertices,e,i,n,s,o,r)}scaleVertices(e,i,n,s,o,r=G.ACCUMULATE_STEPS,l=ne.CUMULATIVE){return this.updateVertices(e,new On(i,n,s,o,l),r)}rotate(e,i,n=G.ACCUMULATE_STEPS,s=ne.CUMULATIVE){return this.rotateVertices(this.data.allVertices,e,i,n,s)}rotateVertices(e,i,n,s=G.ACCUMULATE_STEPS,o=ne.CUMULATIVE){return this.updateVertices(e,new Ja(i,n,o),s)}removeVertices(e){return this._apply(new Ff(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return this.data.components.length===0?null:this._apply(new Nf(this.data,this.data.components[0],e))}setVertexPosition(e,i){return this._apply(new Bf(this.data,e,i))}offsetEdge(e,i,n,s=G.ACCUMULATE_STEPS){return this.updateVertices([i.leftVertex,i.rightVertex],new Xf(this.data.coordinateHelper,e,i,n),s)}trySetGeometry(e,i=G.ACCUMULATE_STEPS){const{data:n}=this,{coordinateHelper:s}=n;if(n.type!==e.type||!n.spatialReference.equals(e.spatialReference)||s.hasZ()!==e.hasZ||s.hasM()!==e.hasM||!dc(n.geometry,e)||Ai(n))return;const o=Array.from(Rn.fromGeometry(e,this.viewingMode).iterateVertices(),r=>r.pos);return this.setVertexPositions(o,i)}setVertexPositions(e,i=G.ACCUMULATE_STEPS){return this._apply(new Wf(this.data,e),i)}createResetState(){if(Ai(this.data))return this._createResetStateMesh();const e=this.data.geometry.clone();return Y(()=>this.trySetGeometry(e))}closeComponent(e){return this.data.components.includes(e)?this._apply(new Yf(this.data,e)):null}canRemoveVertex(e){return e.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new jf;return this._apply(e),Y(()=>e.close())}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();return e.undo(),this._redoStack.push(e),e}return null}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();return e.apply(),this._undoStack.push(e),e}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,i=G.ACCUMULATE_STEPS){return i!==G.NEW_STEP&&this.lastOperation!=null&&this.lastOperation.accumulate(e)||(e.apply(),this._undoStack.push(e),this._redoStack=[]),e}_createResetStateMesh(){if(!Ai(this.data))return Y();const e=this.data.geometry,{vertexSpace:i}=e;if(i.origin){const s=ot(i.origin);return Y(()=>{e.vertexSpace.origin=s})}const n=e.vertexAttributes.clonePositional();return Y(()=>{e.vertexAttributes=n,e.vertexAttributesChanged()})}static fromGeometry(e,i){return new Rl(Rn.fromGeometry(e,i),i)}};function $f(t,e){let i=null,n=null;return s=>{if(s.action==="cancel")return void(n!=null&&(n.execute({action:"cancel"}),i=null,n=null));const o={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};s.action==="start"&&i==null&&(i=new Ii,n=new Ii,e(t,i,n,s.pointerType,o)),i?.execute(o),s.action==="end"&&i!=null&&(i=null,n=null)}}function Jt(t,e){return t.events.on("drag",$f(t,e))}function yo(t,e=null,i){let n=null;const s=e==null||t.spatialReference?.equals(e)?r=>r:r=>r!=null?Ht(r,e):r,o={exclude:[],...i};return r=>{if(r.action==="start"&&(n=s(t.toMap(r.screenStart,o))),n==null)return null;const l=s(t.toMap(r.screenEnd,o));return l!=null?{...r,mapStart:n,mapEnd:l}:null}}const Kf=()=>{};let Ii=class Vl{constructor(){this.execute=Kf}next(e,i=new Vl){return e!=null&&(this.execute=n=>{const s=e(n);s!=null&&i.execute(s)}),i}};function Qf(t,e,i=[]){if(t.type==="2d")return s=>s;let n=null;return s=>{s.action==="start"&&(n=t.toMap(s.screenStart,{exclude:i}),n!=null&&(n.z=$o(n,t,e)));const o=t.toMap(s.screenEnd,{exclude:i});o!=null&&(o.z=$o(o,t,e));const r=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...s,scenePoints:r}}}let _o=class{constructor(t){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.feature=t.feature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ,this.drawConstraints=t.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}};function Jf({predicate:t=()=>!0,snappingManager:e,snappingContext:i,updatingHandles:n,useZ:s=!0}){const o=new Ii;if(e==null)return{snappingStep:[nl,o],cancelSnapping:nl};let r,l=null,h=null,u=null;const p=()=>{l=jn(l),e.doneSnapping(),h?.frameTask.remove(),h=null,r=Uo(r),u=null},d=eg(e,s,o);let m=null,f=null,_=null;return{snappingStep:[y=>{if(!t(y))return y;const{action:w}=y;if(w==="start"){const{info:b}=y,S=tg(e.view);if(h=ig(i,y,S),h.context.selfSnappingZ=null,!s&&b!=null){const I=sg(i.coordinateHelper,b.handle.component);I!=null&&(h.context.selfSnappingZ={value:I,elevationInfo:i.elevationInfo??Ui})}}if(h!=null){const{context:b,originalScenePos:S,originalPos:I}=h,{mapEnd:K,mapStart:te,scenePoints:W}=y,me=tl(I,vo(K,te)),le=vo(te,I),ti={...y,action:"update"},ze=h.context,it=ng(S,W),xt=e.update({point:me,scenePoint:it,context:b});if(_=xt,il(K,xt,le,s),m=me,f=it,w!=="end"){const{frameTask:In}=h;l==null&&(l=new AbortController),u=Al=>{n.addPromise($n(d({frameTask:In,event:ti,context:ze,point:me,scenePoint:it,delta:le,getLastState:()=>({point:m,scenePoint:f,updatePoint:Al.forceUpdate?null:_})},l.signal)))},u({forceUpdate:!1}),r==null&&(r=D(()=>e.options.effectiveEnabled,()=>u?.({forceUpdate:!0})))}}return w==="end"&&p(),y},o],cancelSnapping:y=>(p(),y)}}function eg(t,e,i){return Ho(async({frameTask:n,point:s,scenePoint:o,context:r,event:l,delta:h,getLastState:u},p)=>{const d=await n.schedule(()=>t.snap({point:s,scenePoint:o,context:r,signal:p}),p);if(d.valid){let m=await n.schedule(()=>d.apply(),p);const f=u();f.point!=null&&s!==f.point&&(m=t.update({point:f.point,scenePoint:f.scenePoint,context:r})),f.updatePoint!=null&&_i(m,f.updatePoint)||(il(l.mapEnd,m,h,e),i.execute(l))}})}function tg(t){return t.type==="3d"?t.resourceController.scheduler.registerTask(mr.SNAPPING):yr}function ig(t,e,i){return{context:new _o({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:e.info!=null?e.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:e.snapOrigin!=null?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:e.scenePoints!=null?e.scenePoints.sceneStart:null,frameTask:i}}function tl(t,[e,i,n]){const s=xr(t);return s.x+=e,s.y+=i,s.hasZ&&(s.z+=n),s}function ng(t,e){return t==null||e==null?null:tl(t,vo(e.sceneEnd,e.sceneStart))}function vo(t,e){const i=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,i]}function il(t,e,[i,n,s],o){t.x=e.x+i,t.y=e.y+n,o&&t.hasZ&&e.hasZ&&(t.z=e.z+s)}function sg(t,e){if(!t.hasZ())return null;const i=e.vertices;let n=null;for(const s of i){const o=t.getZ(s.pos);if(n!=null&&o!=null&&Math.abs(o-n)>1e-6)return null;n==null&&(n=o)}return n}function nl(t){return t}let Ct=class extends J{constructor(t){super(t),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=Ho(async(e,i,n,s)=>{const o=this._frameTask;if(o==null)return;const r=await o.schedule(()=>i.snap({...e,context:n,signal:s}),s);r.valid&&await o.schedule(()=>{this.stagedPoint=r.apply(),e!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=i.update({...this._snapPoints,context:n}))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){const t=this.view.type==="3d"?this.view?.resourceController?.scheduler:null;this._frameTask=t!=null?t.registerTask(mr.SNAPPING):yr}destroy(){this._abortController=jn(this._abortController),this._frameTask=Uo(this._frameTask)}update(t,e,i){this._snapPoints=t;const{point:n,scenePoint:s}=t,o=e.update({point:n,scenePoint:s,context:i});return this.stagedPoint=o,o}async snap(t,e,i){const{point:n,scenePoint:s}=t;return this.stagedPoint=e.update({point:n,scenePoint:s,context:i}),this._snapPoints=t,this._abortController==null&&(this._abortController=new AbortController),this._snap(t,e,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(t,e){this._snapPoints!=null&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=jn(this._abortController),this._snapPoints=null}};a([c({constructOnly:!0})],Ct.prototype,"view",void 0),a([c()],Ct.prototype,"stagedPoint",null),a([c()],Ct.prototype,"constrainResult",void 0),a([c()],Ct.prototype,"_stagedPoint",void 0),Ct=a([x("esri.views.interactive.snapping.SnappingOperation")],Ct);var sl;(function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(sl||(sl={}));const ol=Symbol("snapping-toggle");function og(t,e=()=>{}){const i=D(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:n,snappingOptions:s})=>{if(t.removeHandles(ol),!n||!s)return;const o=rr.TOOL,r=[n.on("key-down",l=>{l.key!==aa.toggle||l.repeat||(s.enabledToggled=!0,e())},o),n.on("key-up",l=>{l.key===aa.toggle&&(s.enabledToggled=!1,e())},o),n.on("pointer-move",l=>{const h=l.native.ctrlKey;s.enabledToggled!==h&&(s.enabledToggled=h,e())},o)];t.addHandles(r,ol)},wt);t.addHandles(i)}const rg="crosshair",ag="progress",rl=Symbol(),al=Symbol();let T=class extends bt.EventedMixin(J){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new dh,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new tr,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Gs(_p),this._getPolylineOrPolygonConstraint=Gs(vp),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Pn,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=zc(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,i=e.spatialReference,n="viewingMode"in e.state?e.state.viewingMode:mi.Local,s=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=Xa(this.hasZ,this.hasM,i),this._editGeometryOperations=new mo(new Rn(s,this.coordinateHelper),n),this._snappingOperation=new Ct({view:e}),this.addHandles([D(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:l,constraint:h},u)=>{const{snappingOptions:p}=this;if(p&&(p.forceDisabled=h!=null&&be(h)),u!=null&&l===u.stagedPoint&&h!==u.constraint)return this._onKeyboardBasedChange();this._processCursor(l??this._screenToMap(this._stagedScreenPoint))},{equals:(l,h)=>l.stagedPoint===h.stagedPoint&&fc(l.constraint,h.constraint)}),D(()=>this.view.viewpoint,(l,h)=>{l&&h&&zh(l,h)&&this._onKeyboardBasedChange()})]),this._activeComponent=new kn(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;o!=null&&(o.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(D(()=>this.labelOptions.enabled,l=>{o.visible=l},wt))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],l=>{const h=l.vertices.map(f=>({componentIndex:0,vertexIndex:f.index,coordinates:this.coordinateHelper.vectorToArray(f.pos)})),u=h.map(f=>f.coordinates),p=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;_i(p,this.firstVertex)||(this.firstVertex=p);const d=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;_i(d,this.lastVertex)||(this.lastVertex=d);const m=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(_i(m,this.secondToLastVertex)||(this.secondToLastVertex=m),this._processCursor(this.cursorVertex),l.type){case"vertex-add":this.emit(l.type,{...l,added:u,vertices:h});break;case"vertex-update":this.emit(l.type,{...l,updated:u,vertices:h});break;case"vertex-remove":this.emit(l.type,{...l,removed:u,vertices:h})}}));const r=this._manipulator=new If({consumesClicks:!1,grabbableForEvent:l=>this.drawingMode!=="click"||l.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(r),r.grabbable=t!=="point",this.addHandles([r.events.on("immediate-click",l=>this._onImmediateClick(l)),r.events.on("immediate-double-click",l=>this._onImmediateDoubleClick(l)),D(()=>this.drawingMode,()=>{this.removeHandles(rl),this.addHandles(this._createManipulatorDragPipeline(r),rl)},wt),D(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:l})=>{r.cursor=l},wt)]),og(this,()=>{const l=this.view.inputManager.latestPointerType??"mouse",h=this._getSnappingContext(l);if(this.snappingManager!=null){const u=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,h);this._updatingHandles.addPromise($n(u))}})}destroy(){ce(this.segmentLabels),ce(this._snappingOperation),this._editGeometryOperations=ce(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:e}=this;return t!=null&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}get _constraint(){const{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??Ba)}get effectiveCursor(){return this.loading?ag:this._hideDefaultCursor?null:this.cursor||rg}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:e,firstVertex:i,geometryType:n}=this;return n==="polygon"&&ps(t,i)||ps(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:e,coordinateHelper:i}=this,n=t.slice();return e!=null&&n.push(i.pointToArray(e)),n}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){const e=t?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:i,numCommittedVertices:n}=this,s=i==="multipoint"&&n===0||i==="polyline"&&n<2||i==="polygon"&&n<3;i!=="segment"&&i!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!s,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((o,r)=>({componentIndex:0,vertexIndex:r,coordinates:o})),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){const e=Hn(this.cursorVertex),i=Hn(t),n=i&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(i)??i),s=this._snapToClosingVertex(n),o=this._applyConstraints(s);ps(e,o)||(this._set("cursorVertex",o),this.segmentLabels?.set("stagedVertex",o!=null?this.coordinateHelper.pointToVector(o):null),o==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;const e=this._mapToScreen(t);if(!e)return t;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return Jt(t,(e,i,n,s)=>{const o=s==="touch"&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:r,cancelSnapping:l}=Jf({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new _o({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:s,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next(h=>(o&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),h)).next(l),i.next(this._screenToMapDragEventStep()).next(h=>(h.action==="start"&&(this._processCursor(h.mapStart),(this.geometryType==="segment"||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),h)).next(Qf(this.view,this.elevationInfo)).next(...r).next(h=>(o&&(this._processCursor(h.mapEnd),h.action==="end"&&this.commitStagedVertex()),h)).next(h=>(h.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),h))})}_createManipulatorDragPipelineFreehand(t){return Jt(t,(e,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(n.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this._processCursor(n.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return n})})}_createManipulatorDragPipelineHybrid(t){return Jt(t,(e,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),al),this._processCursor(n.mapStart),this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this._processCursor(n.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(al),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return n})})}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:e,geometryType:i,numCommittedVertices:n}=this;return t?e!=null||i==="segment"&&n>0:(i==="segment"||i==="polygon")&&n>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:t,coordinateHelper:e,drawSurface:i,elevationDrawSurface:n,snapToSceneEnabled:s}=this;if(n==null)return i;if(!this.hasZ)return n.defaultZ=null,n;const o=this.elevationInfo?.mode;let r=this.defaultZ,l=t||o==="absolute-height";return s!=null&&(l=s),o==="on-the-ground"&&(l=!1),this._drawAtFixedElevation&&(r=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),l=!1),l?i:(n.defaultZ=r,n)}_mapToScreen(t){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{const{drawingMode:e,geometryType:i}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const n=this._screenToMap(t.screenPoint);if(n==null||n==null||e==="freehand"&&i!=="point")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(n),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(e==="freehand"||i==="point"||i==="segment"&&this.numCommittedVertices===2||i==="segment"&&e==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=Wn(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){const i=this._snappingOperation,n=this._screenToMap(t),s=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(n==null)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const o=this.snappingManager;if(o==null)return this._processCursor(n),void i.abort();const r=this._getSnappingContext(e);this._updatingHandles.addPromise($n(i.snap({point:n,scenePoint:s},o,r)))}_applyConstraints(t){const{_constraint:e,constraints:i}=this;if(!t||!i||!e)return t;const{context:n}=i,s=an(t,n),o=s?e.closestTo(s):void 0;if(!o)return t;const r=bp(o,t,n),l=this.view.type==="2d"||n.elevationInfo.mode!=="absolute-height";return r!=null&&l&&this.constraintZ!=null&&this.hasZ&&(r.z=this.constraintZ),r}_screenToMap(t){return t?this._updateAndGetEffectiveDrawSurface()?.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;const i=this._screenToMap(e.screenEnd);return i!=null?{...e,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,e){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return i!=null&&lg(i,e,25)}_getSnappingContext(t){const e=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new _o({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function lg(t,e,i){const n=t.x-e.x,s=t.y-e.y;return n*n+s*s<=i}a([c()],T.prototype,"_hideDefaultCursor",void 0),a([c()],T.prototype,"_stagedPointerId",void 0),a([c()],T.prototype,"_isDragging",null),a([c()],T.prototype,"_snappingOperation",void 0),a([c()],T.prototype,"_snappingEnabled",null),a([c({constructOnly:!0})],T.prototype,"graphic",void 0),a([c()],T.prototype,"constraintsEnabled",void 0),a([c()],T.prototype,"constraints",void 0),a([c()],T.prototype,"_constraint",null),a([c()],T.prototype,"constraintZ",void 0),a([c()],T.prototype,"defaultZ",void 0),a([c()],T.prototype,"isDraped",void 0),a([c({value:Ba})],T.prototype,"drawingMode",null),a([c({constructOnly:!0})],T.prototype,"elevationDrawSurface",void 0),a([c({constructOnly:!0})],T.prototype,"elevationInfo",void 0),a([c({constructOnly:!0,type:Pn})],T.prototype,"labelOptions",void 0),a([c({constructOnly:!0})],T.prototype,"geometryType",void 0),a([c({constructOnly:!0})],T.prototype,"hasM",void 0),a([c({constructOnly:!0})],T.prototype,"hasZ",void 0),a([c()],T.prototype,"cursor",void 0),a([c()],T.prototype,"effectiveCursor",null),a([c()],T.prototype,"loading",void 0),a([c({constructOnly:!0})],T.prototype,"manipulators",void 0),a([c({constructOnly:!0})],T.prototype,"drawSurface",void 0),a([c({constructOnly:!0})],T.prototype,"segmentLabels",void 0),a([c({constructOnly:!0})],T.prototype,"snappingManager",void 0),a([c({constructOnly:!0})],T.prototype,"snappingVisualizer",void 0),a([c()],T.prototype,"snapToSceneEnabled",void 0),a([c({readOnly:!0})],T.prototype,"cursorVertex",null),a([c({readOnly:!0})],T.prototype,"visualizationCursorVertex",null),a([c()],T.prototype,"committableVertex",null),a([c()],T.prototype,"firstVertex",void 0),a([c()],T.prototype,"lastVertex",void 0),a([c()],T.prototype,"secondToLastVertex",void 0),a([c()],T.prototype,"updating",null),a([c({constructOnly:!0})],T.prototype,"view",void 0),T=a([x("esri.views.draw.DrawOperation")],T);let cg=class{constructor(t,e=!1,i=0){this.view=t,this.hasZ=e,this.defaultZ=i,this.mapToScreen=n=>t.toScreen(n),this.screenToMap=e?n=>{const s=t.toMap(n);return s.z=i,s}:n=>t.toMap(n)}constrainZ(t){const{defaultZ:e}=this;return this.hasZ&&t.z!==e&&((t=xr(t)).z=e),t}};new st;let ei=class extends M{constructor(t){super(t),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:t.activeLineSymbol??tu,regularVertices:t.regularVerticesSymbol??iu,activeVertex:t.activeVertexSymbol??nu,fill:t.activeFillSymbol},t.activeVertexSymbol||this.addHandles(D(()=>this.view?.effectiveTheme?.accentColor,e=>{if(!e)return;const i=this._visualElementSymbols.activeVertex.clone().set({color:e});this._visualElementGraphics.activeVertex?.set("symbol",i),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:i}},Yn))}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return this._visualElementSymbols.fill!=null&&(t.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(Vn),Y()}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:i}=this;return this._createOrUpdateGraphic(null),new T({view:i,manipulators:this.manipulators,geometryType:Af(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new cg(i,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new Jh(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){if(this.geometryType==="point")return Y();const[e,i]=t,n=new C({x:e,y:i,spatialReference:this.view.spatialReference});return this._visualElementGraphics.activeVertex!=null?(this._visualElementGraphics.activeVertex.geometry=n,Y()):(this._visualElementGraphics.activeVertex=new Ce({geometry:n,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(Vn),Y(()=>{this._visualElementGraphics.activeVertex!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=ce(this._visualElementGraphics.activeVertex))}))}onCursorEdgeChanged(t){return this._visualElementGraphics.activeEdge!=null?(this._visualElementGraphics.activeEdge.geometry=t,Y()):(this._visualElementGraphics.activeEdge=new Ce({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(Vn),Y(()=>{this._visualElementGraphics.activeEdge!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=ce(this._visualElementGraphics.activeEdge))}))}onRegularVerticesChanged(t){const e=new Co({points:t,spatialReference:this.view.spatialReference});return this._visualElementGraphics.regularVertices!=null?(this._visualElementGraphics.regularVertices.geometry=e,Y()):(this._visualElementGraphics.regularVertices=new Ce({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(Vn),Y(()=>{this._visualElementGraphics.regularVertices!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=ce(this._visualElementGraphics.regularVertices))}))}};function Vn(t,e){return(t.attributes?.displayOrder??-1/0)-(e.attributes?.displayOrder??-1/0)}a([c()],ei.prototype,"activeFillSymbol",void 0),a([c({readOnly:!0})],ei.prototype,"type",void 0),a([c({constructOnly:!0,nonNullable:!0})],ei.prototype,"view",void 0),ei=a([x("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],ei);let xo=class{get hovering(){return this.someManipulator(t=>t.hovering)}get grabbing(){return this.someManipulator(t=>t.grabbing)}get dragging(){return this.someManipulator(t=>t.dragging)}hasManipulator(t){return this.someManipulator(e=>e===t)}someManipulator(t){let e=!1;return this.forEachManipulator(i=>{!e&&t(i)&&(e=!0)}),e}};var Li;(function(t){t[t.TRANSLATE_XY=0]="TRANSLATE_XY",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE"})(Li||(Li={}));function ll(t){let e=0,i=0,n=0;return t?(t.type==="cim"&&t.data.symbol&&"symbolLayers"in t.data.symbol&&t.data.symbol.symbolLayers&&t.data.symbol.symbolLayers.map(s=>{s.type==="CIMVectorMarker"&&s.anchorPoint&&(Math.abs(s.anchorPoint.x)>e&&(e=s.anchorPoint.x),Math.abs(s.anchorPoint.y)>i&&(i=s.anchorPoint.y),s.size!=null&&s.size>n&&(n=s.size))}),e=It(e),i=It(i),n=It(n),{offsetX:e,offsetY:i,size:n}):{offsetX:e,offsetY:i,size:n}}let $=class extends J{set graphic(t){this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set("graphic",t),this.attachSymbolChanged()}get elevationInfo(){const{layer:t}=this.graphic,e=t&&"elevationInfo"in t?t.elevationInfo:null,i=Uc(this.graphic),n=e?e.offset:0;return new Nh({mode:i,offset:n})}set focusedSymbol(t){t!==this._get("focusedSymbol")&&(this._set("focusedSymbol",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get("grabbing")&&(this._set("grabbing",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get("hovering")&&(this._set("hovering",t),this._updateGraphicSymbol())}set selected(t){t!==this._get("selected")&&(this._set("selected",t),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new bt.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(t){const e=this.graphic;if(e.visible===!1)return null;const i=e.geometry;if(i==null)return null;const n=this._get("focusedSymbol"),s=n??e.symbol;return this.view.type==="2d"?this._intersectDistance2D(this.view,t,i,s):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=D(()=>this.graphic?.symbol,t=>{t!=null&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},Xn)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,i,n){if((n=n||gc(i))==null)return null;const s=1;let o=this._circleCollisionCache;if(i.type==="point"&&n.type==="cim"&&n.data.symbol?.type==="CIMPointSymbol"&&n.data.symbol.symbolLayers){const{offsetX:r,offsetY:l,size:h}=ll(n),u=No(e,hl),p=h/2,d=t.toScreen(i),m=d.x+r,f=d.y+l;return Di(u,[m,f])<p*p?s:null}if(i.type!=="point"||n.type!=="simple-marker")return Zh(e,i,t)?s:null;if(o==null||!o.originalPoint.equals(i)){const r=i,l=t.spatialReference;if(Uh(r.spatialReference,l)){const h=Ht(r,l);o={originalPoint:r.clone(),mapPoint:h,radiusPx:It(n.size)},this._circleCollisionCache=o}}if(o!=null){const r=No(e,hl),l=t.toScreen?.(o.mapPoint);if(!l)return null;const h=o.radiusPx,u=l.x+It(n.xoffset),p=l.y-It(n.yoffset);return Di(r,[u,p])<h*h?s:null}return null}_intersectDistance3D(t,e,i){const n=t.toMap(e,{include:[i]});return n&&Fh(n,cl,t.renderSpatialReference)?lt(cl,t.state.camera.eye):null}};a([c({constructOnly:!0,nonNullable:!0})],$.prototype,"graphic",null),a([c()],$.prototype,"elevationInfo",null),a([c({constructOnly:!0,nonNullable:!0})],$.prototype,"view",void 0),a([c({value:null})],$.prototype,"focusedSymbol",null),a([c({constructOnly:!0})],$.prototype,"layer",void 0),a([c()],$.prototype,"interactive",void 0),a([c()],$.prototype,"selectable",void 0),a([c()],$.prototype,"grabbable",void 0),a([c({value:!1})],$.prototype,"grabbing",null),a([c()],$.prototype,"dragging",void 0),a([c()],$.prototype,"hovering",null),a([c({value:!1})],$.prototype,"selected",null),a([c()],$.prototype,"cursor",void 0),$=a([x("esri.views.interactive.GraphicManipulator")],$);const cl=g(),hl=mc();let ul=class extends xo{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,Li.TRANSLATE_XY)}createDragPipeline(t,e){let i=null,n=null,s=0,o=0,r=0;const{offsetX:l,offsetY:h,size:u}=ll(this._graphic.symbol);return Jt(this._manipulator,(p,d)=>{d.next(m=>{if(m.action==="start"){const f=t();i=f.editGeometryOperations,n=f.constraints}return m}).next(yo(this._view)).next(m=>{const{x:f,y:_,z:y}=m.mapEnd;if(n&&(f+l<n.xmin||_+h-u<n.ymin||f+l>n.xmax||_+h-u>n.ymax))return m;(m.action==="start"||s===0&&o===0&&r===0)&&(s=m.mapStart.x,o=m.mapStart.y,r=m.mapStart.z);const w=f-s,b=_-o,S=y-r;s=f,o=_,r=y;const I=m.action==="start"?G.NEW_STEP:G.ACCUMULATE_STEPS,K=i.move(w,b,S,I);return e(m,K),m})})}_createManipulator(){const t=this._view,e=this._graphic;return new $({view:t,graphic:e,selectable:!0,cursor:"move"})}};const et={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",toggleOpacity:"t",shift:"Shift",primaryKey:or},hg=1,ug=10,pl=new ni("#009af2");let De=class extends X{constructor(t){super(t),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new is({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._controlPointManipulations.forEach(e=>e.destroy()),this._controlPointEditGeometryOperations.forEach(e=>e.destroy()),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=ce(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return Nn(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const t=this._undoStack[this._undoStack.length-1];return t!=null&&this._controlPointEditGeometryOperations[t].canUndo}canRedo(){const t=this._redoStack[this._redoStack.length-1];return t!=null&&this._controlPointEditGeometryOperations[t].canRedo}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();this._controlPointEditGeometryOperations[t].undo(),this.updateGraphics(),this._redoStack.push(t)}}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();this._controlPointEditGeometryOperations[t].redo(),this.updateGraphics(),this._undoStack.push(t)}}refresh(){const{mediaElement:t}=this;if(t.georeference==null)return;const e=t.georeference;e.type==="control-points"&&e.coords!=null&&(this._georeference=e,this._georeference.controlPoints.forEach(({mapPoint:i},n)=>{const s=this._controlPointEditGeometryOperations[n],o=s.data.components[0].vertices[0];s.setVertexPosition(o,s.data.coordinateHelper.pointToVector(i))}),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._georeference,e=t.controlPoints,i=e[0].mapPoint.spatialReference,n=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map((s,o)=>{const r=s.data.geometry;return this._controlPointGraphics[o].geometry=r,{mapPoint:Ht(r,i),sourcePoint:n?e[o].sourcePoint:t.toSource(r)}})}updateActiveHandle(t){if(this.activeHandle===t)return;const e=this._controlPointGraphics[this.activeHandle].symbol.clone();_r(e,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=e;const i=this._controlPointGraphics[t].symbol.clone();_r(i,pl),this._controlPointGraphics[t].symbol=i,this.activeHandle=t,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const t=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=t.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,mediaElement:e}=this;if(e.georeference==null)return;const i=e.georeference;i.type==="control-points"&&i.coords!=null&&(this._georeference=i,this._initialControlPoints=this._georeference.controlPoints,t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map(({mapPoint:n})=>mo.fromGeometry(Ht(n,t.spatialReference),mi.Local)),this._controlPointGraphics=this._controlPointEditGeometryOperations.map((n,s)=>new Ce({symbol:new oi({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:s===this.activeHandle?pl.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:n.data.geometry})),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map(n=>new ul({tool:this,view:t,graphic:n})),this.addHandles([...this._controlPointManipulations.map((n,s)=>n.createDragPipeline(this._getInfo.bind(this,s),(o,r)=>{o.action==="start"&&(this._undoStack.push(s),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:r}),this._sharedRedoStack.length=0),this.updateGraphics()})),D(()=>this.view.scale,()=>this.active?this.updateGraphics():null)]),this._controlPointManipulations.forEach((n,s)=>{const o=r=>{this.addHandles([r.events.on(["click","grab-changed"],l=>this.updateActiveHandle(s))])};n.forEachManipulator(o)}),this.addHandles([t.on("key-down",n=>{t.activeTool===this&&(n.key!==et.shift||n.repeat||(this._isModifierActive=!0,n.stopPropagation()),n.key!==et.toggleOpacity||n.repeat||(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,n.stopPropagation()),n.key!==et.primaryKey||n.repeat||(this._factor=ug,n.stopPropagation()),this._isModifierActive&&(n.key===et.up&&(this._move(0,this._factor),n.stopPropagation()),n.key===et.down&&(this._move(0,-this._factor),n.stopPropagation()),n.key===et.left&&(this._move(-this._factor,0),n.stopPropagation()),n.key===et.right&&(this._move(this._factor,0),n.stopPropagation())))}),t.on("key-up",n=>{t.activeTool===this&&(n.key===et.shift&&(this._isModifierActive=!1,n.stopPropagation()),n.key===et.primaryKey&&(this._factor=hg,n.stopPropagation()))})]))}async _loadProjectionEngine(){const t=this._georeference.controlPoints[0].mapPoint;return gr(t.spatialReference,this.view.spatialReference)}_getInfo(t){return{editGeometryOperations:this._controlPointEditGeometryOperations[t],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(t,e){const i=this._controlPointEditGeometryOperations[this.activeHandle].move(t*this.view.resolution,e*this.view.resolution,0,G.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};a([c()],De.prototype,"_hasValidSpatialReference",null),a([c()],De.prototype,"activeHandle",void 0),a([c({constructOnly:!0,nonNullable:!0})],De.prototype,"mediaElement",void 0),a([c({readOnly:!0})],De.prototype,"type",void 0),a([c({constructOnly:!0})],De.prototype,"view",void 0),De=a([x("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],De);function dl(t,e){t.action==="start"?e.cursor="grabbing":e.cursor="grab"}class pg{constructor(){this._lastDragEvent=null,this.next=new Ii,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null){const i={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(i),this.next.execute(i)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent=e.action!=="end"?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const i=e.direction[0]!==0&&e.direction[1]!==0?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-i:i,e.factor2=e.factor2<0?-i:i}}let dg=class{constructor(){this._lastDragEvent=null,this.next=new Ii,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null){const e={...this._lastDragEvent,action:"update"};t&&this._adjustRotateAngle(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent=t.action!=="end"?{...t}:null,this._enabled&&this._adjustRotateAngle(t),t)}_adjustRotateAngle(t){const e=Fo(t.rotateAngle);t.rotateAngle=zo(5*Math.round(e/5))}};function fg(t,e,i,n=!1){const s=Math.atan2(e.y-i.y,e.x-i.x)-Math.atan2(t.y-i.y,t.x-i.x),o=Math.atan2(Math.sin(s),Math.cos(s));return n?o:Fo(o)}function fl(t,e){return gg(t,e,!1)}function gg(t,e,i){if(t instanceof qa){if(t.operation instanceof $a)return mg(t.operation,e,i),!0;if(t.operation instanceof Ja)return yg(t.operation,e,i),!0;if(t.operation instanceof On)return _g(t.operation,e,i),!0}return!1}function mg(t,e,i=!1){const n=i?-1:1,s=nt(n*t.dx,n*t.dy,n*t.dz);ue(e.origin,e.origin,s),Yi(e)}function yg(t,e,i=!1){const n=i?-t.angle:t.angle;er(e.basis1,e.basis1,Zo,n),er(e.basis2,e.basis2,Zo,n),Yi(e)}function _g(t,e,i=!1){const n=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;ct(e.basis1,e.basis1,n),ct(e.basis2,e.basis2,s),zi(e.origin,e.origin,t.origin,t.axis1,n),zi(e.origin,e.origin,t.origin,t.axis2,s),Yi(e)}function vg(t,e,i,n){n||(n=yi());const s=He(di.get(),t[1],-t[0]),o=He(di.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=He(di.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=di.get();e.components.forEach(p=>p.vertices.forEach(({pos:d})=>{He(l,rt(t,d),rt(s,d)),Sc(o,o,l),Mc(r,r,l)}));const h=1e-6,u=He(di.get(),r[0]-o[0]<h?i/2:0,r[1]-o[1]<h?i/2:0);return q(o,o,u),Qn(r,r,u),qo(n.basis1,t,(r[0]-o[0])/2),qo(n.basis2,s,(r[1]-o[1])/2),He(n.origin,o[0]*t[0]+o[1]*s[0],o[0]*t[1]+o[1]*s[1]),Qn(n.origin,n.origin,n.basis1),Qn(n.origin,n.origin,n.basis2),Yi(n),n}class xg extends xo{constructor(e){super(),this._handles=new Bo,this._originCache=g(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._snapRotation=e.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",i=>dl(i,this._manipulator))]),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(e){e(this._manipulator,Li.ROTATE)}createDragPipeline(e,i){let n=null,s=null;return Jt(this._manipulator,(o,r)=>{r.next(l=>{if(l.action==="start"){o.cursor="grabbing";const h=e();n=h.plane,s=h.editGeometryOperations}return l}).next(yo(this._view)).next(l=>({...l,rotateAngle:fg(l.mapStart,l.mapEnd,{x:n.origin[0],y:n.origin[1]},!0)})).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next(l=>{const h=se(this._originCache,n.origin),u=l.action==="start"?G.NEW_STEP:G.ACCUMULATE_STEPS,p=s.rotate(h,l.rotateAngle,u,ne.REPLACE);return fl(p,n),i(l,p),l}).next(l=>(l.action==="end"&&(o.cursor="grab"),l))})}_createManipulator(){const e=this._view,i=this._graphic;return new $({view:e,graphic:i,selectable:!0,cursor:"grab"})}}const bo=10,gl=1e-6,bg=.3;function ml(t){const e=hi(t.basis1),i=hi(t.basis2);return bg*Math.min(e,i)}class wg extends xo{constructor(e){super(),this._handles=new Bo,this._planeStart=yi(),this._displayPlaneStart=yi(),this._originCache=g(),this._axisCache=L(),this._renderStartCache=g(),this._renderEndCache=g(),this._resizeOriginCache=g(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._direction=e.direction,this._preserveAspectRatio=e.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",i=>dl(i,this._manipulator))]),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(e){e(this._manipulator,Li.SCALE)}createDragPipeline(e,i){let n=null,s=null,o=null,r=0,l=null,h=null;const u=this._planeStart,p=this._displayPlaneStart,d=this._direction;return Jt(this._manipulator,(m,f)=>{f.next(_=>{if(_.action==="start"){m.cursor="grabbing";const y=e();n=y.plane,s=y.displayPlane,o=y.editGeometryOperations,r=bo*this._view.resolution,Xi(n,u),Xi(s,p);const w=Do(o.data.spatialReference);l=w?w.valid[1]-w.valid[0]-3*bo*this._view.resolution:null}return _}).next(yo(this._view)).next(_=>{const y=se(this._renderStartCache,[_.mapStart.x,_.mapStart.y,0]),w=se(this._renderEndCache,[_.mapEnd.x,_.mapEnd.y,0]),b=se(this._resizeOriginCache,p.origin);H(b,b,p.basis1,-d[0]),H(b,b,p.basis2,-d[1]),Ee(w,w,b),Ee(y,y,b);const S=d[0]!==0&&d[1]!==0,I=ml(p),K=ml(s)/I,te=(le,ti)=>{if(le===0)return 1;let ze=hi(ti),it=.5*le*Z(ti,w)/ze;const xt=it<0?-1:1;S&&(it+=(ze-.5*le*Z(ti,y)/ze)*xt*K);const In=ze<1.5*r?1:gl;return ze=Math.max(ze-r,gl),xt>0&&(it-=bo*this._view.resolution),xt*Math.max(xt*(it/ze),In)},W=te(d[0],p.basis1),me=te(d[1],p.basis2);return{..._,direction:d,factor1:W,factor2:me}}).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(_=>{const y=se(this._originCache,u.origin);H(y,y,u.basis1,-d[0]),H(y,y,u.basis2,-d[1]);const w=He(this._axisCache,u.basis1[0],u.basis1[1]);Kn(w,w);const b=o.data.allVertices,S=_.action==="start"?G.NEW_STEP:G.ACCUMULATE_STEPS,I=o.scaleVertices(b,y,w,_.factor1,_.factor2,S,ne.REPLACE);return l&&l<o.data.geometry.extent.width&&h?o.updateVertices(b,h):(Xi(u,n),fl(I,n),h=I.operation,i(_,I)),_}).next(_=>(_.action==="end"&&(m.cursor="grab"),_))})}_createManipulator(){return new $({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}function Tg(t){return t?.type==="graphic"}function Eg(t){return t.find(Tg)??null}const Sg=80,Mg=10,Pg=30,Cg=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],yl=1,kg=10;let ge=class extends X{constructor(t){super(t),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=yi(),this._displayPlaneCache=yi(),this._mainAxisCache=L(),this._rotationHandleCache=g(),this._cornerA=g(),this._cornerB=g(),this._cornerC=g(),this._cornerD=g(),this._avgAB=g(),this._avgBC=g(),this._avgCD=g(),this._avgDA=g(),this._preserveAspectRatio=new pg,this._snapRotation=new dg,this._graphicsLayer=new is({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=yl,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach(e=>e.destroy()),this._editGeometryOperations.destroy(),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=ce(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const t=this._graphic.geometry;if(t==null)return null;const e=this._editGeometryOperations.data,i=e.components[0].edges[0],n=q(this._mainAxisCache,i.leftVertex.pos,i.rightVertex.pos);Kn(n,n);let s=Sg*this.view.resolution;const o=this.view.spatialReference;return kt(o,t.spatialReference)&&(s*=ai(o)/ai(t.spatialReference)),vg(n,e,s,this._planeCache)}get _displayPlane(){const t=this._plane;if(!t)return null;const e=this._displayPlaneCache;Xi(t,e);const i=Mg*this.view.resolution;return ct(e.basis1,e.basis1,1+i/hi(e.basis1)),ct(e.basis2,e.basis2,1+i/hi(e.basis2)),e}get _backgroundGraphicGeometry(){const t=this._displayPlane;if(!t)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(t),new At({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const t=this._plane;if(!t)return null;const e=this._rotationHandleCache;return ht(e,t.basis1),ct(e,e,Pg*this.view.resolution),ue(e,e,t.origin),ue(e,e,t.basis1),new C({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const t=this._displayPlane;if(!t)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(t);const{_cornerA:i,_cornerB:n,_cornerC:s,_cornerD:o}=this,r=Tt(this._avgAB,i,n,.5),l=Tt(this._avgBC,n,s,.5),h=Tt(this._avgCD,s,o,.5),u=Tt(this._avgDA,o,i,.5);return[new C({x:i[0],y:i[1],spatialReference:e}),new C({x:n[0],y:n[1],spatialReference:e}),new C({x:s[0],y:s[1],spatialReference:e}),new C({x:o[0],y:o[1],spatialReference:e}),new C({x:r[0],y:r[1],spatialReference:e}),new C({x:l[0],y:l[1],spatialReference:e}),new C({x:h[0],y:h[1],spatialReference:e}),new C({x:u[0],y:u[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:t,target:e}=this,i="georeference"in e?e.georeference.coords:e.geometry,n=this._editGeometryOperations,s=n.data.components[0].vertices,o=Rn.fromGeometry(Ht(i,t.spatialReference),mi.Local).components[0].vertices;s.forEach((r,l)=>{n.setVertexPosition(r,o[l].pos)}),this.updateGraphics()}reset(){const{target:t}=this;if("georeference"in t){const e=t.georeference;e.type==="control-points"&&(e.controlPoints=this._initialControlPoints)}else t.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=t),this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach((e,i)=>{this._scaleGraphics[i].geometry=e})}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,target:e}=this;if("georeference"in e){const s=e.georeference;this._graphic=new Ce({geometry:s.coords}),this._initialControlPoints=s.type==="control-points"?s.controlPoints:null}else this._graphic=e,this._initialGeometry=e.geometry;t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=mo.fromGeometry(Ht(this._graphic.geometry,t.spatialReference),mi.Local),this._backgroundGraphic=new Ce({symbol:new yc({color:"transparent",outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new Ce({symbol:new Rt({color:vr(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map(s=>new Ce({symbol:new Rt({size:6,style:"square",color:vr(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:s})),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new ul({tool:this,view:t,graphic:this._graphic}),this._rotateManipulation=new xg({tool:this,view:t,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map((s,o)=>new wg({tool:this,view:t,graphic:s,direction:Cg[o],preserveAspectRatio:this._preserveAspectRatio})),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map(s=>s.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this))),D(()=>this.view.scale,()=>this.active?this.updateGraphics():null),t.on("click",async s=>{if(t.activeTool!=null&&t.activeTool!==this)return;const o=jc(s),r=[];t.map.allLayers.forEach(u=>{u.type!=="vector-tile"&&u.type!=="imagery"||r.push(u)});const l=await this.view.hitTest(o,{exclude:r}),h=l.results;if(h.length===0)t.activeTool=null;else{const u=Eg(l.results),p="georeference"in e,d=h.map(f=>f.type==="media"?f.element:null).filter(Boolean),m=new Set([...this._graphicsLayer.graphics,p?null:e].filter(Boolean));p&&d.includes(e)||u!=null&&m.has(u.graphic)?t.activeTool==null&&(t.activeTool=this):t.activeTool=null}})]);const i=s=>{this.addHandles(s.events.on("grab-changed",o=>{"georeference"in e&&(o.action==="start"?e.opacity*=.5:o.action==="end"&&(e.opacity*=2))}))};this._dragManipulation.forEachManipulator(i),this._rotateManipulation.forEachManipulator(i),this._scaleManipulations.forEach(s=>s.forEachManipulator(i));const n=new Mp;n.addToggle(Ge.preserveAspectRatio,()=>{this.preserveAspectRatio==null&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)}),n.addToggle(Ge.rotateIncrements,()=>{this.snapRotation==null&&(this._snapRotation.enabled=!this._snapRotation.enabled)}),n.add(Ge.toggleOpacity,()=>{"georeference"in e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)}),n.addToggle(Ge.factorModifier,s=>this._factor=s.type==="key-down"?kg:yl),n.add(Ge.scaleUp,()=>this._scale(this._factor)),n.add(Ge.scaleDown,()=>this._scale(-this._factor)),n.add(Ge.moveUp,()=>this._move(0,this._factor)),n.add(Ge.moveDown,()=>this._move(0,-this._factor)),n.add(Ge.moveLeft,()=>this._move(-this._factor,0)),n.add(Ge.moveRight,()=>this._move(this._factor,0)),this.addHandles([t.on("key-down",s=>{t.activeTool===this&&n.dispatch(t.inputManager,s)}),t.on("key-up",s=>{t.activeTool===this&&n.dispatch(t.inputManager,s)})])}async _loadProjectionEngine(){const t=this._graphic.geometry;return gr(t.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(t){const{basis1:e,basis2:i,origin:n}=t,s=this._cornerA;ue(s,n,e),ue(s,s,i);const o=this._cornerB;ue(o,n,e),Ee(o,o,i);const r=this._cornerC;Ee(r,n,e),Ee(r,r,i);const l=this._cornerD;Ee(l,n,e),ue(l,l,i)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(t,e){t.action==="start"&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(t){const e=this._editGeometryOperations,i=e.data.geometry.extent?.width,n=(i+t*this.view.resolution)/i,s=e.scale(this._plane.origin,Rc,n,n,G.NEW_STEP,ne.REPLACE);this._sharedUndoStack.push({tool:this,operation:s}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(t,e){const i=this._editGeometryOperations.move(t*this.view.resolution,e*this.view.resolution,0,G.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};a([c()],ge.prototype,"_plane",null),a([c()],ge.prototype,"_backgroundGraphicGeometry",null),a([c()],ge.prototype,"_rotateGraphicGeometry",null),a([c()],ge.prototype,"_scaleGraphicGeometries",null),a([c()],ge.prototype,"preserveAspectRatio",void 0),a([c()],ge.prototype,"snapRotation",void 0),a([c({constructOnly:!0,nonNullable:!0})],ge.prototype,"target",void 0),a([c({readOnly:!0})],ge.prototype,"type",void 0),a([c({constructOnly:!0})],ge.prototype,"view",void 0),ge=a([x("esri.views.2d.interactive.editingTools.TransformTool")],ge);const An={redo:"r",undo:"z"};let tt=class extends J{constructor(t){super(t),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:t,mediaElement:e,preserveAspectRatio:i,snapRotation:n,advancedMode:s}=this;this._originalOpacity=e.opacity,this._transformTool=new ge({target:e,view:t,preserveAspectRatio:i,snapRotation:n}),this._controlPointsTransformTool=new De({mediaElement:e,view:t}),this._advancedModeTransformTool=new De({mediaElement:s.mediaElement,view:s.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const o=e.georeference,r=s.mediaElement.georeference;s.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in r&&"controlPoints"in o&&this.addHandles([s.view.on("key-down",l=>{l.key===An.undo&&this.canUndo()&&(this.undo(),l.stopPropagation()),l.key===An.redo&&this.canRedo()&&(this.redo(),l.stopPropagation())}),s.view.on("focus",async l=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()}),D(()=>r.controlPoints,l=>{o.controlPoints=l.map(({sourcePoint:h},u)=>({sourcePoint:h,mapPoint:o.controlPoints[u].mapPoint})),this._activeTool?.refresh()}),D(()=>this._controlPointsTransformTool.activeHandle,l=>{this._advancedModeTransformTool.updateActiveHandle(l),this.activeHandle=l}),D(()=>this._advancedModeTransformTool.activeHandle,l=>{this._controlPointsTransformTool.updateActiveHandle(l),this.activeHandle=l})]),this.addHandles([t.on("key-down",l=>{l.key===An.undo&&this.canUndo()&&(this.undo(),l.stopPropagation()),l.key===An.redo&&this.canRedo()&&(this.redo(),l.stopPropagation())}),t.on("focus",async l=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()})]),t.tools.addMany([this._transformTool,this._controlPointsTransformTool]),t.activeTool=this._transformTool,this._activeTool=this._transformTool,t.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:t,operation:e}=this._sharedUndoStack.pop();t!==this._activeTool&&t.refresh(),e.undo(),t.updateGraphics(),this._sharedRedoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:t,operation:e}=this._sharedRedoStack.pop();t!==this._activeTool&&t.refresh(),e.apply(),t.updateGraphics(),this._sharedUndoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};a([c()],tt.prototype,"activeHandle",void 0),a([c({constructOnly:!0})],tt.prototype,"advancedMode",void 0),a([c()],tt.prototype,"preserveAspectRatio",void 0),a([c()],tt.prototype,"snapRotation",void 0),a([c({constructOnly:!0,nonNullable:!0})],tt.prototype,"mediaElement",void 0),a([c({constructOnly:!0})],tt.prototype,"view",void 0),tt=a([x("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],tt);export{De as ControlPointsTransformTool,ei as DrawGraphicTool2D,tt as MediaTransformToolsWrapper,ge as TransformTool};
