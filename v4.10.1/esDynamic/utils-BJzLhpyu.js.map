{"version":3,"file":"utils-BJzLhpyu.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../../core/handleUtils.js\";import{Milliseconds as e}from\"../../../../../core/time.js\";import{imageTypeToCanvas as r}from\"../../../../../geometry/support/meshUtils/exporters/gltf/imageutils.js\";import{AnimatedSymbolRepeatType as i}from\"../../../../../symbols/cim/enums.js\";import{getRandomValue as a}from\"../grouping.js\";function n(t){return e(t.frameDurations.reduce(((t,e)=>t+e),0))}function o(t){const{width:e,height:r}=t,i=t.frameDurations.reverse(),a=e=>{const r=t.frameDurations.length-1-e;return t.getFrame(r)};return{frameCount:t.frameCount,duration:t.duration,frameDurations:i,getFrame:a,width:e,height:r}}function s(t,r){const{width:i,height:a,getFrame:n}=t,o=r/t.duration,s=t.frameDurations.map((t=>e(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:n,width:i,height:a}}function m(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.shift();return o.unshift(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}function u(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.pop();return o.push(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}class h{constructor(t,e,r,i){this._animation=t,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;e>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=0;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function c(t,r,c,f){let l,{repeatType:d}=r;if(null==d&&(d=i.Loop),!0===r.reverseAnimation&&(t=o(t)),null!=r.duration&&(t=s(t,e(1e3*r.duration))),null!=r.repeatDelay){const a=1e3*r.repeatDelay;d===i.Loop?t=u(t,e(a)):d===i.Oscillate&&(t=m(u(t,e(a/2)),e(a/2)))}if(null!=r.startTimeOffset)l=e(1e3*r.startTimeOffset);else if(null!=r.randomizeStartTime){const i=82749913,o=null!=r.randomizeStartSeed?r.randomizeStartSeed:i,s=a(c,o);l=e(s*n(t))}else l=e(0);return new h(t,l,d,f)}function f(e,r,i,a){const n=null==r.playAnimation||r.playAnimation,o=c(e,r,i,a);let s,m=o.timeToFrame;function u(){s=n?setTimeout((()=>{o.nextFrame(),m=o.timeToFrame,u()}),m):void 0}return u(),t((()=>n&&clearTimeout(s)))}let l,d;function g(){return l??=document.createElement(\"canvas\"),d??=l.getContext(\"2d\"),{canvas:l,ctx:d}}function F(t,e,i){const{canvas:a,ctx:n}=g();a.width=e,a.height=i;const o=[],s=t.frameDurations.length;for(let m=0;m<s;m++){const a=t.getFrame(m);n.clearRect(0,0,e,i),a instanceof ImageData?n.drawImage(r(a),0,0,e,i):n.drawImage(a,0,0,e,i),o.push(n.getImageData(0,0,e,i))}return{width:e,height:i,frameDurations:t.frameDurations,getFrame:t=>o[t],frameCount:t.frameCount,duration:t.duration}}export{h as Player,s as adjustDuration,u as appendDelay,c as createPlayer,n as getDuration,f as play,m as prependDelay,F as resize,o as reverse};\n"],"names":["n","t","e","o","r","i","a","s","m","u","h","c","f","l","d"],"mappings":"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","x_google_ignoreList":[0]}