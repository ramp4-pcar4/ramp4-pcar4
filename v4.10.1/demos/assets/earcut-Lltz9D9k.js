function A(t,r,n){n=n||2;var x,i,e,u,v,f,s,l=r&&r.length,c=l?r[0]*n:t.length,a=C(t,0,c,n,!0),o=[];if(!a||a.next===a.prev)return o;if(l&&(a=J(t,r,a,n)),t.length>80*n){x=e=t[0],i=u=t[1];for(var y=n;y<c;y+=n)(v=t[y])<x&&(x=v),(f=t[y+1])<i&&(i=f),v>e&&(e=v),f>u&&(u=f);s=(s=Math.max(e-x,u-i))!==0?1/s:0}return g(a,o,n,x,i,s),o}function C(t,r,n,x,i){var e,u;if(i===q(t,r,n,x)>0)for(e=r;e<n;e+=x)u=B(e,t[e],t[e+1],u);else for(e=n-x;e>=r;e-=x)u=B(e,t[e],t[e+1],u);if(u&&b(u,u.next)){var v=u.next;w(u),u=v}return u}function h(t,r){if(!t)return t;r||(r=t);var n,x=t;do if(n=!1,x.steiner||!b(x,x.next)&&p(x.prev,x,x.next)!==0)x=x.next;else{var i=x.prev;if(w(x),(x=r=i)===x.next)break;n=!0}while(n||x!==r);return r}function g(t,r,n,x,i,e,u){if(t){!u&&e&&P(t,x,i,e);for(var v,f,s=t;t.prev!==t.next;)if(v=t.prev,f=t.next,e?G(t,x,i,e):F(t))r.push(v.i/n),r.push(t.i/n),r.push(f.i/n),w(t),t=f.next,s=f.next;else if((t=f)===s){u?u===1?g(t=H(h(t),r,n),r,n,x,i,e,2):u===2&&I(t,r,n,x,i,e):g(h(t),r,n,x,i,e,1);break}}}function F(t){var r=t.prev,n=t,x=t.next;if(p(r,n,x)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Z(r.x,r.y,n.x,n.y,x.x,x.y,i.x,i.y)&&p(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function G(t,r,n,x){var i=t.prev,e=t,u=t.next;if(p(i,e,u)>=0)return!1;for(var v=i.x<e.x?i.x<u.x?i.x:u.x:e.x<u.x?e.x:u.x,f=i.y<e.y?i.y<u.y?i.y:u.y:e.y<u.y?e.y:u.y,s=i.x>e.x?i.x>u.x?i.x:u.x:e.x>u.x?e.x:u.x,l=i.y>e.y?i.y>u.y?i.y:u.y:e.y>u.y?e.y:u.y,c=k(v,f,r,n,x),a=k(s,l,r,n,x),o=t.prevZ,y=t.nextZ;o&&o.z>=c&&y&&y.z<=a;){if(o!==t.prev&&o!==t.next&&Z(i.x,i.y,e.x,e.y,u.x,u.y,o.x,o.y)&&p(o.prev,o,o.next)>=0||(o=o.prevZ,y!==t.prev&&y!==t.next&&Z(i.x,i.y,e.x,e.y,u.x,u.y,y.x,y.y)&&p(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;o&&o.z>=c;){if(o!==t.prev&&o!==t.next&&Z(i.x,i.y,e.x,e.y,u.x,u.y,o.x,o.y)&&p(o.prev,o,o.next)>=0)return!1;o=o.prevZ}for(;y&&y.z<=a;){if(y!==t.prev&&y!==t.next&&Z(i.x,i.y,e.x,e.y,u.x,u.y,y.x,y.y)&&p(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function H(t,r,n){var x=t;do{var i=x.prev,e=x.next.next;!b(i,e)&&D(i,x,x.next,e)&&d(i,e)&&d(e,i)&&(r.push(i.i/n),r.push(x.i/n),r.push(e.i/n),w(x),w(x.next),x=t=e),x=x.next}while(x!==t);return h(x)}function I(t,r,n,x,i,e){var u=t;do{for(var v=u.next.next;v!==u.prev;){if(u.i!==v.i&&S(u,v)){var f=E(u,v);return u=h(u,u.next),f=h(f,f.next),g(u,r,n,x,i,e),void g(f,r,n,x,i,e)}v=v.next}u=u.next}while(u!==t)}function J(t,r,n,x){var i,e,u,v=[];for(i=0,e=r.length;i<e;i++)(u=C(t,r[i]*x,i<e-1?r[i+1]*x:t.length,x,!1))===u.next&&(u.steiner=!0),v.push(R(u));for(v.sort(K),i=0;i<v.length;i++)n=h(n=L(v[i],n),n.next);return n}function K(t,r){return t.x-r.x}function m(t){if(t.next.prev===t)return t;let r=t;for(;;){const n=r.next;if(n.prev===r||n===r||n===t)break;r=n}return r}function L(t,r){var n=N(t,r);if(!n)return r;var x=E(n,t),i=h(n,n.next);let e=m(x);return h(e,e.next),i=m(i),m(r===n?i:r)}function N(t,r){var n,x=r,i=t.x,e=t.y,u=-1/0;do{if(e<=x.y&&e>=x.next.y&&x.next.y!==x.y){var v=x.x+(e-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(v<=i&&v>u){if(u=v,v===i){if(e===x.y)return x;if(e===x.next.y)return x.next}n=x.x<x.next.x?x:x.next}}x=x.next}while(x!==r);if(!n)return null;if(i===u)return n;var f,s=n,l=n.x,c=n.y,a=1/0;x=n;do i>=x.x&&x.x>=l&&i!==x.x&&Z(e<c?i:u,e,l,c,e<c?u:i,e,x.x,x.y)&&(f=Math.abs(e-x.y)/(i-x.x),d(x,t)&&(f<a||f===a&&(x.x>n.x||x.x===n.x&&O(n,x)))&&(n=x,a=f)),x=x.next;while(x!==s);return n}function O(t,r){return p(t.prev,t,r.prev)<0&&p(r.next,t,t.next)<0}function P(t,r,n,x){var i=t;do i.z===null&&(i.z=k(i.x,i.y,r,n,x)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,Q(i)}function Q(t){var r,n,x,i,e,u,v,f,s=1;do{for(n=t,t=null,e=null,u=0;n;){for(u++,x=n,v=0,r=0;r<s&&(v++,x=x.nextZ);r++);for(f=s;v>0||f>0&&x;)v!==0&&(f===0||!x||n.z<=x.z)?(i=n,n=n.nextZ,v--):(i=x,x=x.nextZ,f--),e?e.nextZ=i:t=i,i.prevZ=e,e=i;n=x}e.nextZ=null,s*=2}while(u>1);return t}function k(t,r,n,x,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-x)*i)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function R(t){var r=t,n=t;do(r.x<n.x||r.x===n.x&&r.y<n.y)&&(n=r),r=r.next;while(r!==t);return n}function Z(t,r,n,x,i,e,u,v){return(i-u)*(r-v)-(t-u)*(e-v)>=0&&(t-u)*(x-v)-(n-u)*(r-v)>=0&&(n-u)*(e-v)-(i-u)*(x-v)>=0}function S(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!T(t,r)&&(d(t,r)&&d(r,t)&&U(t,r)&&(p(t.prev,t,r.prev)||p(t,r.prev,r))||b(t,r)&&p(t.prev,t,t.next)>0&&p(r.prev,r,r.next)>0)}function p(t,r,n){return(r.y-t.y)*(n.x-r.x)-(r.x-t.x)*(n.y-r.y)}function b(t,r){return t.x===r.x&&t.y===r.y}function D(t,r,n,x){var i=z(p(t,r,n)),e=z(p(t,r,x)),u=z(p(n,x,t)),v=z(p(n,x,r));return i!==e&&u!==v||!(i!==0||!M(t,n,r))||!(e!==0||!M(t,x,r))||!(u!==0||!M(n,t,x))||!(v!==0||!M(n,r,x))}function M(t,r,n){return r.x<=Math.max(t.x,n.x)&&r.x>=Math.min(t.x,n.x)&&r.y<=Math.max(t.y,n.y)&&r.y>=Math.min(t.y,n.y)}function z(t){return t>0?1:t<0?-1:0}function T(t,r){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==r.i&&n.next.i!==r.i&&D(n,n.next,t,r))return!0;n=n.next}while(n!==t);return!1}function d(t,r){return p(t.prev,t,t.next)<0?p(t,r,t.next)>=0&&p(t,t.prev,r)>=0:p(t,r,t.prev)<0||p(t,t.next,r)<0}function U(t,r){var n=t,x=!1,i=(t.x+r.x)/2,e=(t.y+r.y)/2;do n.y>e!=n.next.y>e&&n.next.y!==n.y&&i<(n.next.x-n.x)*(e-n.y)/(n.next.y-n.y)+n.x&&(x=!x),n=n.next;while(n!==t);return x}function E(t,r){var n=new j(t.i,t.x,t.y),x=new j(r.i,r.x,r.y),i=t.next,e=r.prev;return t.next=r,r.prev=t,n.next=i,i.prev=n,x.next=n,n.prev=x,e.next=x,x.prev=e,x}function B(t,r,n,x){var i=new j(t,r,n);return x?(i.next=x.next,i.prev=x,x.next.prev=i,x.next=i):(i.prev=i,i.next=i),i}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function j(t,r,n){this.i=t,this.x=r,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q(t,r,n,x){for(var i=0,e=r,u=n-x;e<n;e+=x)i+=(t[u]-t[e])*(t[e+1]+t[u+1]),u=e;return i}A.deviation=function(t,r,n,x){var i=r&&r.length,e=i?r[0]*n:t.length,u=Math.abs(q(t,0,e,n));if(i)for(var v=0,f=r.length;v<f;v++){var s=r[v]*n,l=v<f-1?r[v+1]*n:t.length;u-=Math.abs(q(t,s,l,n))}var c=0;for(v=0;v<x.length;v+=3){var a=x[v]*n,o=x[v+1]*n,y=x[v+2]*n;c+=Math.abs((t[a]-t[y])*(t[o+1]-t[a+1])-(t[a]-t[o])*(t[y+1]-t[a+1]))}return u===0&&c===0?0:Math.abs((c-u)/u)},A.flatten=function(t){for(var r=t[0][0].length,n={vertices:[],holes:[],dimensions:r},x=0,i=0;i<t.length;i++){for(var e=0;e<t[i].length;e++)for(var u=0;u<r;u++)n.vertices.push(t[i][e][u]);i>0&&(x+=t[i-1].length,n.holes.push(x))}return n};export{A as e};
