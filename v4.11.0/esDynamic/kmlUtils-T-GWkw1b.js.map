{"version":3,"file":"kmlUtils-T-GWkw1b.js","sources":["../../node_modules/@arcgis/core/layers/support/kmlUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../config.js\";import{id as o}from\"../../kernel.js\";import t from\"../../PopupTemplate.js\";import r from\"../../request.js\";import{clone as s}from\"../../core/lang.js\";import{addQueryParameters as n}from\"../../core/urlUtils.js\";import i from\"../../geometry/SpatialReference.js\";import{create as f,negativeInfinity as a,expandWithAABB as l,equals as u}from\"../../geometry/support/aaBoundingBox.js\";import{getBoundsXYZ as m}from\"../../geometry/support/boundsUtils.js\";import{fromJSON as p}from\"../../renderers/support/jsonUtils.js\";import y from\"../../rest/support/FeatureSet.js\";const c={esriGeometryPoint:\"points\",esriGeometryPolyline:\"polylines\",esriGeometryPolygon:\"polygons\"};function d(e){const o=e.folders||[],t=o.slice(),r=new Map,n=new Map,i=new Map,f=new Map,a=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:i,esriGeometryPolygon:f};(e.featureCollection?.layers||[]).forEach((e=>{const o=s(e);o.featureSet.features=[];const t=e.featureSet.geometryType;r.set(t,o);const a=e.layerDefinition.objectIdField;\"esriGeometryPoint\"===t?h(n,a,e.featureSet.features):\"esriGeometryPolyline\"===t?h(i,a,e.featureSet.features):\"esriGeometryPolygon\"===t&&h(f,a,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{a.set(e.id,e)})),o.forEach((o=>{o.networkLinkIds.forEach((r=>{const s=P(r,o.id,e.networkLinks);s&&t.push(s)}))})),t.forEach((e=>{if(e.featureInfos){e.points=s(r.get(\"esriGeometryPoint\")),e.polylines=s(r.get(\"esriGeometryPolyline\")),e.polygons=s(r.get(\"esriGeometryPolygon\")),e.mapImages=[];for(const o of e.featureInfos)switch(o.type){case\"esriGeometryPoint\":case\"esriGeometryPolyline\":case\"esriGeometryPolygon\":{const t=l[o.type].get(o.id);t&&e[c[o.type]]?.featureSet.features.push(t);break}case\"GroundOverlay\":{const t=a.get(o.id);t&&e.mapImages.push(t);break}}e.fullExtent=j([e])}}));const u=j(t);return{folders:o,sublayers:t,extent:u}}function g(t,s,i,f){const a=o?.findCredential(t);t=n(t,{token:a?.token});const l=e.kmlServiceUrl;return r(l,{query:{url:t,model:\"simple\",folders:\"\",refresh:0!==i||void 0,outSR:JSON.stringify(s)},responseType:\"json\",signal:f})}function S(e,o,t=null,r=[]){const s=[],n={},i=o.sublayers,f=new Set(o.folders.map((e=>e.id)));return i.forEach((o=>{const i=new e;if(t?i.read(o,t):i.read(o),r.length&&f.has(i.id)&&(i.visible=r.includes(i.id)),n[o.id]=i,null!=o.parentFolderId&&-1!==o.parentFolderId){const e=n[o.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers?.unshift(i)}else s.unshift(i)})),s}function h(e,o,t){t.forEach((t=>{e.set(t.attributes[o],t)}))}function G(e,o){let t;return o.some((o=>o.id===e&&(t=o,!0))),t}function P(e,o,t){const r=G(e,t);return r&&(r.parentFolderId=o,r.networkLink=r),r}async function b(e){const o=y.fromJSON(e.featureSet).features,r=e.layerDefinition,s=p(r.drawingInfo.renderer),n=t.fromJSON(e.popupInfo),i=[];for(const t of o){const e=await s.getSymbolAsync(t);t.symbol=e,t.popupTemplate=n,t.visible=!0,i.push(t)}return i}function j(e){const o=f(a),t=f(a);for(const r of e){if(r.polygons?.featureSet?.features)for(const e of r.polygons.featureSet.features)m(o,e.geometry),l(t,o);if(r.polylines?.featureSet?.features)for(const e of r.polylines.featureSet.features)m(o,e.geometry),l(t,o);if(r.points?.featureSet?.features)for(const e of r.points.featureSet.features)m(o,e.geometry),l(t,o);if(r.mapImages)for(const e of r.mapImages)m(o,e.extent),l(t,o)}return u(t,a)?void 0:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:i.WGS84}}export{j as computeExtent,g as fetchService,b as getGraphics,d as parseKML,S as sublayersFromJSON};\n"],"names":["c","d","e","o","r","a","s","t","P","j","g","i","f","n","l","S","G","b","y","p","m","u"],"mappings":"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","x_google_ignoreList":[0]}