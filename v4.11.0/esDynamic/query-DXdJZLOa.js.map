{"version":3,"file":"query-DXdJZLOa.js","sources":["../../node_modules/@arcgis/core/rest/operations/urlUtils.js","../../node_modules/@arcgis/core/rest/query/operations/query.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nfunction t(n){const o={};for(const e in n){if(\"declaredClass\"===e)continue;const r=n[e];if(null!=r&&\"function\"!=typeof r)if(Array.isArray(r)){o[e]=[];for(let n=0;n<r.length;n++)o[e][n]=t(r[n])}else\"object\"==typeof r?r.toJSON&&(o[e]=JSON.stringify(r)):o[e]=r}return o}export{t as mapParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport t from\"../../../request.js\";import{urlToObject as e,join as n}from\"../../../core/urlUtils.js\";import{getJsonType as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{srToRESTValue as a}from\"../../../geometry/support/spatialReferenceUtils.js\";import{mapParameters as o}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as u}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as l}from\"./queryZScale.js\";const s=\"Layer does not support extent calculation.\";function m(t,e){if(e&&\"extent\"===t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&\"point\"===t.type)return`${t.x},${t.y}`;const n=t.toJSON();return delete n.spatialReference,JSON.stringify(n)}function y(t,e){const n=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const o=i;let u,l,s;if(null!=n&&(l=n.spatialReference,s=a(l),o.geometryType=r(n),o.geometry=m(n,t.compactGeometryEnabled),o.inSR=s),i.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(\",\")),i.objectIds&&(o.objectIds=i.objectIds.join(\",\")),i.orderByFields&&(o.orderByFields=i.orderByFields.join(\",\")),!i.outFields||!i.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete o.outFields:i.outFields.includes(\"*\")?o.outFields=\"*\":o.outFields=i.outFields.join(\",\"),i.outSR?(o.outSR=a(i.outSR),u=t.outSpatialReference):n&&(i.returnGeometry||i.returnCentroid)&&(o.outSR=o.inSR,u=l),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(o.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(o.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(o.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=l&&null!=t.quantizationParameters?.extent&&l.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,o.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(o.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(o.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(o.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const t=i.timeExtent,{start:e,end:n}=t;null==e&&null==n||(o.time=e===n?e:`${e??\"null\"},${n??\"null\"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&null!=l&&null!=u&&l.equals(u)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function c(t,e,n,r){const i=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await E(t,e,\"json\",r);return l(e,n,i.data),i}async function f(t,e,n,r){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:n.createFeatureResult()};const i=await d(t,e,r),a=i;return a.data=u(i.data,n),a}function d(t,e,n){return E(t,e,\"pbf\",n)}function p(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E(t,e,\"json\",n,{returnIdsOnly:!0})}function S(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E(t,e,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}async function x(t,e,n){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await E(t,e,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty(\"extent\"))return r;if(i.features)throw new Error(s);if(i.hasOwnProperty(\"count\"))throw new Error(s);return r}async function E(r,a,u,l={},s={}){const m=\"string\"==typeof r?e(r):r,c=a.geometry?[a.geometry]:[],f=await i(c,null,{signal:l.signal}),d=f?.[0];null!=d&&((a=a.clone()).geometry=d);const p=o({...m.query,f:u,...s,...y(a,s)});return t(n(m.path,g(a,s)?\"query3d\":\"query\"),{...l,responseType:\"pbf\"===u?\"array-buffer\":\"json\",query:{...p,...l.query}})}function g(t,e){return null!=t.formatOf3DObjects&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}export{m as encodeGeometry,c as executeQuery,S as executeQueryForCount,x as executeQueryForExtent,p as executeQueryForIds,f as executeQueryPBF,d as executeQueryPBFBuffer,y as queryToQueryStringParameters,E as runQuery};\n"],"names":["t","n","o","e","r","s","m","y","i","u","l","a","c","E","f","d","p","S","x","g"],"mappings":"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","x_google_ignoreList":[0,1]}